var WORKFLOW_KEYS={FORM_ID:""},activitiApp=angular.module("activitiApp",["http-auth-interceptor","ngCookies","ngResource","ngSanitize","ngRoute","ngDragDrop","mgcrea.ngStrap","ngFileUpload","pascalprecht.translate","ui.grid","ui.grid.edit","ui.grid.selection","ui.grid.autoResize","angular-loading-bar","cfp.hotkeys","ui.bootstrap","dndLists","nvd3ChartDirectives","activiti.common"]);angular.module("activiti.common",[]);var activitiModule=activitiApp;activitiApp.config(["$provide","$routeProvider","$selectProvider","$datepickerProvider","cfpLoadingBarProvider","$translateProvider","licenseStatusProvider",function(e,t,o,n,r,i,a){var s="workflow";e.value("appName",s);var l=ACTIVITI.CONFIG.webContextRoot+"/"+s+"/";e.value("appResourceRoot",l),e.value("appSettings",{appName:s,appResourceRoot:l,reporting:{embedded:!0,appPath:ACTIVITI.CONFIG.webContextRoot+"/analytics/",viewsPath:ACTIVITI.CONFIG.webContextRoot+"/analytics/",allowRemove:!1}}),angular.extend(o.defaults,{caretHtml:'&nbsp;<i class="icon icon-caret-down"></i>'}),angular.extend(n.defaults,{iconLeft:"icon icon-caret-left",iconRight:"icon icon-caret-right"});var c=["$rootScope","AuthenticationSharedService",function(e,t){return e.authenticated?(e.authenticated=!0,!0):t.authenticate()}];t.when("/start-process",{templateUrl:l+"views/start-process.html",controller:"StartProcessController",resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/apps/:appDefinitionId/start-process",{templateUrl:l+"views/start-process.html",controller:"StartProcessController",resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/tasks",{templateUrl:l+"views/tasks.html",controller:"TasksController",reloadOnSearch:!1,resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/apps/:appDefinitionId/tasks",{templateUrl:l+"views/tasks.html",controller:"TasksController",reloadOnSearch:!1,resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/apps/:appDefinitionId/reports",{templateUrl:ACTIVITI.CONFIG.webContextRoot+"/analytics/views/reports.html",controller:"ReportsController",reloadOnSearch:!1,resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/reports",{templateUrl:ACTIVITI.CONFIG.webContextRoot+"/analytics/views/reports.html",controller:"ReportsController",reloadOnSearch:!1,resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/task/:taskId",{templateUrl:l+"views/task.html",controller:"TaskController",resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/processDefinition/:processDefinitionId/start-process",{templateUrl:l+"views/start-process-by-definition.html",controller:"StartProcessController",resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/apps/:appDefinitionId/task/:taskId",{templateUrl:l+"views/task.html",controller:"TaskController",resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/processes",{templateUrl:l+"views/processes.html",controller:"ProcessesController",reloadOnSearch:!1,resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/apps/:appDefinitionId/processes",{templateUrl:l+"views/processes.html",controller:"ProcessesController",reloadOnSearch:!1,resolve:{verify:c,licenseStatus:a.licenseStatusResolver}}).when("/process/:processId",{templateUrl:l+"views/process.html",controller:"ProcessController",resolve:{verify:c}}).when("/apps/:appDefinitionId/process/:processId",{templateUrl:l+"views/process.html",controller:"ProcessController",resolve:{verify:c}}).otherwise({redirectTo:ACTIVITI.CONFIG.appDefaultRoute||"/tasks"}),r.includeSpinner=!1,i.useSanitizeValueStrategy("sanitizeParameters"),i.useStaticFilesLoader({prefix:l+"/i18n/",suffix:".json"}),i.preferredLanguage(window.ACTIVITI_PREFERRED_LOCALE)}]).config(["$httpProvider",function(e){function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e16]+1e16).replace(/[01]/g,t)}e.interceptors.push(function(){return{request:function(e){return document.cookie="CSRF-TOKEN="+t()+";path=/",e}}})}]).run(["$rootScope","$routeParams","$timeout","$translate","$location","$http","$window","appResourceRoot","AppDefinitionService",function(e,t,o,n,r,i,a,s){e.restRootUrl=function(){return ACTIVITI.CONFIG.contextRoot},e.config=ACTIVITI.CONFIG,e.appResourceRoot=s,e.activitiFieldIdPrefix="activiti-";var l=ACTIVITI.CONFIG.locales||["en","de","es","fr","it","nl","ja","nb","ru","zh-CN","pt-BR"],c=n.proposedLanguage();-1===l.indexOf(c)?n.use("en").then(function(e){moment.lang(e)}):moment.lang(c),e.window={};var d=function(){e.window.width=a.innerWidth,e.window.height=a.innerHeight};angular.element(a).bind("resize",function(){e.$apply(d())}),e.$watch("window.forceRefresh",function(t){t&&o(function(){d(),e.window.forceRefresh=!1})}),d();var u=function(t){return e.account&&e.account.capabilities?e.account.capabilities.indexOf(t)>-1:!1};e.hasAccessReportsCapability=function(){return u("access-reports")},e.mainNavigation=[{id:"login",title:"GENERAL.NAVIGATION.LOGIN",unauthenticated:!0},{id:"tasks",title:"GENERAL.NAVIGATION.TASKS",path:"/tasks"},{id:"processes",title:"GENERAL.NAVIGATION.PROCESSES",path:"/processes"}],e.mainPage=e.mainNavigation[0],e.mainNavigationActions=[],e.$watch("readOnly",function(t,o){if(t!==o)if(t)e.mainNavigationActions=e.mainNavigationActions.filter(function(e){return"processes"!==e.id});else{var n=e.mainNavigationActions.filter(function(e){return"processes"===e.id});n.length||(e.mainNavigationActions=[{id:"processes",icon:"plus",title:"GENERAL.NAVIGATION.START-PROCESS",path:"/processes",params:{mode:"start"}}])}}),e.$watch("account",function(t){t&&e.hasAccessReportsCapability()&&e.mainNavigation.push({id:"reports",title:"GENERAL.NAVIGATION.REPORTS",path:"/reports"})}),e.appDefinitions={},e.setMainPage=function(t){e.mainPage=t;var o;if(o=e.activeAppDefinition?"/apps/"+e.activeAppDefinition.id+t.path:e.mainPage.path,r.url(o),t.params)for(var n in t.params)r.search(n,t.params[n])},e.setMainPageById=function(t){for(var o=0;e.mainNavigation.length>o;o++)if(t===e.mainNavigation[o].id){e.mainPage=e.mainNavigation[o];break}},e.alerts={queue:[]},e.showAlert=function(t){t.queue.length>0?(t.current=t.queue.shift(),t.timeout=o(function(){0===t.queue.length?(t.current=void 0,t.timeout=void 0):e.showAlert(t)},"error"===t.current.type?5e3:1e3)):e.alerts.current=void 0},e.addAlert=function(t,o){var n={message:t,type:o};e.alerts.timeout?e.alerts.queue.push(n):(e.alerts.queue.push(n),e.showAlert(e.alerts))},e.dismissAlert=function(){e.alerts.timeout?(o.cancel(e.alerts.timeout),e.alerts.timeout=void 0,e.showAlert(e.alerts)):e.alerts.current=void 0},e.addAlertPromise=function(t,o){t&&t.then(function(t){e.addAlert(t,o)})},e.model={},e.root={},e.officeLauncher=new OfficeLauncher,e.officeLauncher.setConsoleLoggingEnabled(!0),e.openOfficeDocument=function(t){var o=a.location.protocol+"//"+a.location.hostname;if(a.location.port&&80!==window.location.port&&(o+=":"+window.location.port),!e.officeLauncher.EditDocument(o+t.officeUrl)){var n;"word"===t.simpleType?n="ms-word":"excel"===t.simpleType&&(n="ms-excel"),"powerpoint"===t.simpleType&&(n="ms-powerpoint");var r=n+":ofe%7Cu%7C"+e.officeLauncher.encodeUrl(o+t.officeUrl);a.location.href=r}},e.loadProcessDefinitions=function(t){var o=ACTIVITI.CONFIG.contextRoot+"/app/rest/process-definitions?latest=true";t&&(o+="&appDefinitionId="+t),i({method:"GET",url:o}).success(function(t){e.root.processDefinitions=t.data}).error(function(e){console.log("Something went wrong: "+e)})},e.$on("$locationChangeStart",function(t,o){e.root.headless=o.indexOf("headless")>=0?!0:!1}),e.safeApply=function(e){var t=this.$root.$$phase;"$apply"===t||"$digest"===t?e&&"function"==typeof e&&e():this.$apply(e)}}]).run(["$rootScope","$location","$window","AuthenticationSharedService","$translate","appName","$modal",function(e,t,o,n,r,i,a){var s="/"+i+"/";e.logout=function(){n.logout()},e.showAboutActiviti=function(){_internalCreateModal({template:"../views/modal/about-activiti.html?"+(new Date).getTime(),show:!0},a,e)};var l=function(e){var n,r=t.absUrl(),i=r.indexOf(s);n=null!==e&&void 0!==e&&void 0!==e.isFromLogout&&e.isFromLogout===!0?r.substring(0,i)+"/#login":r.substring(0,i)+"/#login?redirectUrl="+encodeURIComponent(o.location.pathname+o.location.hash),o.location.href===n?window.location.reload():o.location.href=n};e.$on("event:auth-loginRequired",function(){e.authenticated=!1,e.authenticationChecked=!0,l()}),e.$on("event:auth-authConfirmed",function(){e.authenticated=!0,e.authenticationChecked=!0,(""===t.path()||"#"===t.path()||"/login"===t.path())&&t.path("/")}),e.$on("event:auth-loginConfirmed",function(){n.authenticate()}),e.$on("event:auth-loginCancelled",function(t,o){e.authenticated=!1,l(o)}),e.$on("event:auth-loginFailed",function(){e.addAlertPromise(r("LOGIN.MESSAGES.ERROR.AUTHENTICATION"),"error")}),e.backToLanding=function(){var e=t.absUrl(),n=e.indexOf(s);n>=0&&(e=e.substring(0,n)+"/"),o.location.href=e}}]).run(["$http",function(e){e.defaults.xsrfHeaderName="X-CSRF-TOKEN",e.defaults.xsrfCookieName="CSRF-TOKEN"}]).filter("duration",["$translate",function(e){return function(t){if(t){var o=moment.duration(t),n="",r=o.hours();r>0&&(n=n+r+" "+e.instant("GENERAL.TIME.HOURS")+" ");var i=o.minutes();return i>0&&(n=n+i+" "+e.instant("GENERAL.TIME.MINUTES")),0===r&&0===i&&(n=o.seconds()+" "+e.instant("GENERAL.TIME.SECONDS")),n}return t}}]).filter("amount",function(){return function(e,t,o){if(e!==void 0&&null!==e&&""!==e){var n=e+"",r=n.split(".");return n=o||"",n+=r[0],t&&(r.length>1?(n+=".",n+=r[1],1===r[1].length&&(n+="0")):n+=".00"),n}return e}}).filter("pdfViewerUrl",["appResourceRoot",function(e){return function(t){var o=encodeURIComponent(t);return e+"views/templates/viewer.html?file="+o}}]),angular.module("activitiApp").service("NavigationService",["$rootScope","$location","$q","$translate","AppDefinitionService",function(e,t){function o(){var t="";return e.activeAppDefinition&&!ACTIVITI.CONFIG.integrationProfile&&(t="/apps/"+e.activeAppDefinition.id),t}function n(e,n){if(t.url(o()+e),n)for(var r in n)t.search(r,n[r])}this.openTaskPage=function(e){e?n("/tasks",{taskId:e}):n("/tasks")},this.openProcessPage=function(e){e?n("/processes",{processId:e}):n("/processes")},this.openProcessPageInStartMode=function(){n("/processes",{mode:"start"})}}]),angular.module("activitiApp").service("FilterService",["$rootScope","$http","$q","$translate","AppDefinitionService",function(e,t,o,n){function r(){return e.activeAppDefinition||null}function i(e){return e.appId||r()}function a(e,t,o){o.filter=angular.copy(t.filter),e.filters.push(o),e.order.push(o.id)}function s(e,t,o){for(var n=0;e.length>n;n++)if(e[n].id===t.id){e[n]=o,e[n].filter=angular.extend({},t.filter);break}}function l(e,t){if(t.filterId)for(var o=0;e.filters.length>o;o++)e.filters[o].id===t.filterId?e.filters[o].recent=!0:(e.filters[o].recent&&(e.previousFilterId=e.filters[o].id),e.filters[o].recent=!1)}function c(e){if(0===e.filters.length)return void 0;for(var t=void 0,o=0;e.filters.length>o;o++){if(e.filters[o].recent)return e.filters[o];e.filters[o].id===e.previousFilterId&&(t=e.filters[o])}return t||e.filters[0]}function d(e,t){for(var o=0;e.filters.length>o;o++)if(e.filters[o].id===t){e.filters.splice(o,1),e.order.splice(o,1);break}}var u={tasks:{},processes:{}},p=["glyphicon-asterisk","glyphicon-plus","glyphicon-euro","glyphicon-cloud","glyphicon-envelope","glyphicon-pencil","glyphicon-glass","glyphicon-music","glyphicon-search","glyphicon-heart","glyphicon-star","glyphicon-star-empty","glyphicon-user","glyphicon-film","glyphicon-th-large","glyphicon-th","glyphicon-th-list","glyphicon-ok","glyphicon-remove","glyphicon-zoom-in","glyphicon-zoom-out","glyphicon-off","glyphicon-signal","glyphicon-cog","glyphicon-trash","glyphicon-home","glyphicon-file","glyphicon-time","glyphicon-road","glyphicon-download-alt","glyphicon-download","glyphicon-upload","glyphicon-inbox","glyphicon-play-circle","glyphicon-repeat","glyphicon-refresh","glyphicon-list-alt","glyphicon-lock","glyphicon-flag","glyphicon-headphones","glyphicon-volume-up","glyphicon-tag","glyphicon-tags","glyphicon-book","glyphicon-bookmark","glyphicon-print","glyphicon-camera","glyphicon-list","glyphicon-facetime-video","glyphicon-picture","glyphicon-map-marker","glyphicon-adjust","glyphicon-tint","glyphicon-edit","glyphicon-share","glyphicon-check","glyphicon-move","glyphicon-play","glyphicon-eject","glyphicon-plus-sign","glyphicon-minus-sign","glyphicon-remove-sign","glyphicon-ok-sign","glyphicon-question-sign","glyphicon-info-sign","glyphicon-screenshot","glyphicon-remove-circle","glyphicon-ok-circle","glyphicon-ban-circle","glyphicon-share-alt","glyphicon-exclamation-sign","glyphicon-gift","glyphicon-leaf","glyphicon-fire","glyphicon-eye-open","glyphicon-eye-close","glyphicon-warning-sign","glyphicon-plane","glyphicon-calendar","glyphicon-random","glyphicon-comment","glyphicon-magnet","glyphicon-retweet","glyphicon-shopping-cart","glyphicon-folder-close","glyphicon-folder-open","glyphicon-hdd","glyphicon-bullhorn","glyphicon-bell","glyphicon-certificate","glyphicon-thumbs-up","glyphicon-thumbs-down","glyphicon-hand-left","glyphicon-globe","glyphicon-wrench","glyphicon-tasks","glyphicon-filter","glyphicon-briefcase","glyphicon-dashboard","glyphicon-paperclip","glyphicon-heart-empty","glyphicon-link","glyphicon-phone","glyphicon-pushpin","glyphicon-usd","glyphicon-gbp","glyphicon-sort","glyphicon-flash","glyphicon-record","glyphicon-save","glyphicon-open","glyphicon-saved","glyphicon-send","glyphicon-floppy-disk","glyphicon-credit-card","glyphicon-cutlery","glyphicon-earphone","glyphicon-phone-alt","glyphicon-tower","glyphicon-stats","glyphicon-cloud-download","glyphicon-cloud-upload","glyphicon-tree-conifer","glyphicon-tree-deciduous"],m=function(e){var n=o.defer();return t(e).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.createTaskFilter=function(e){var n=o.defer();return t({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/tasks",data:e}).success(function(t){a(u.tasks[i(e)],e,t),n.resolve(t)}),n.promise},this.updateTaskFilter=function(e,n){var r=o.defer();return t({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/tasks/"+e,data:n}).success(function(e){s(u.tasks[i(n)].filters,n,e),r.resolve(e)}),r.promise},this.deleteTaskFilter=function(e){return d(u.tasks[i(e)],e.id),m({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/tasks/"+e.id})},this.createDefaultTaskFilters=function(r,i){o.all([n("TASK.FILTER.INVOLVED-FILTER-NAME"),n("TASK.FILTER.ASSIGNEE-FILTER-NAME"),n("TASK.FILTER.CANDIDATE-FILTER-NAME"),n("TASK.FILTER.COMPLETED-FILTER-NAME")]).then(function(n){var a=[],s=[{id:"involved",name:n[0],icon:"glyphicon-align-left",filter:{name:"",sort:"created-desc",state:"open",assignment:"involved"},settings:{required:!0}},{id:"assignee",name:n[1],icon:"glyphicon-inbox",filter:{name:"",sort:"created-desc",state:"open",assignment:"assignee"},settings:{selected:!0}},{id:"candidate",name:n[2],icon:"glyphicon-record",filter:{name:"",sort:"created-desc",state:"open",assignment:"candidate"}},{id:"completed",name:n[3],icon:"glyphicon-ok-sign",filter:{name:"",sort:"created-desc",state:"completed",assignment:"involved"},settings:{selected:!0}}];if(e.readOnly){for(var l=u.tasks[r]||{filters:[],order:[]},c=0;s.length>c;c++){var d=s[c];d.filter=angular.copy(s[c].filter),l.filters.push(d),l.order.push(d.id)}return i({filters:l.filters,recent:l.filters[0]}),void 0}for(var c=0;s.length>c;c++){var d={name:s[c].name,index:c,icon:s[c].icon,filter:s[c].filter,appId:r};a.push(t({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/tasks",data:d}))}o.all(a).then(function(e){for(var t=u.tasks[r]||{filters:[],order:[]},o=0;s.length>o;o++){var n=e[o].data;n.filter=angular.copy(s[o].filter),t.filters.push(n),t.order.push(n.id)}i({filters:t.filters,recent:t.filters[0]})})})},this.getRecentTaskFilter=function(e){return c(u.tasks[e])},this.getTaskFilters=function(e){var n=o.defer();return u.tasks[e]&&u.tasks[e].filters?n.resolve({filters:u.tasks[e].filters,recent:c(u.tasks[e])}):t({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/tasks",params:{appId:e}}).success(function(t){u.tasks[e]={filters:t.data,order:[]};for(var o=void 0,r=0;t.data.length>r;r++)u.tasks[e].order[r]=t.data[r].id,(t.data[r].recent||0===r)&&(o=t.data[r]);n.resolve({filters:t.data,recent:o})}),n.promise},this.filterTasks=function(e){return l(u.tasks[e.appDefinitionId],e),m({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filter/tasks",data:e})},this.checkTaskFiltersOrder=function(e){for(var t=u.tasks[e].filters,o=u.tasks[e].order,n=!1,r=0;t.length>r;r++)o[r]!==t[r].id&&(n=!0,o[r]=t[r].id);n&&m({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/tasks",data:{appId:e,order:o}})},this.getFilterIcons=function(){return p},this.createProcessInstanceFilter=function(e){var n=o.defer();return t({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/processes",data:e}).success(function(t){a(u.processes[i(e)],e,t),n.resolve(t)}),n.promise},this.createDefaultProcessFilters=function(r,i){o.all([n("PROCESS.FILTER.RUNNING-FILTER-NAME"),n("PROCESS.FILTER.COMPLETED-FILTER-NAME"),n("PROCESS.FILTER.ALL-FILTER-NAME")]).then(function(n){var a=[],s=[{id:"running",name:n[0],icon:"glyphicon-random",filter:{name:"",sort:"created-desc",state:"running"},settings:{required:!0}},{id:"completed",name:n[1],icon:"glyphicon-ok-sign",filter:{name:"",sort:"created-desc",state:"completed"},settings:{selected:!0}},{id:"all",name:n[2],icon:"glyphicon-th",filter:{name:"",sort:"created-desc",state:"all"}}];if(e.readOnly){for(var l=u.processes[r]||{filters:[],order:[]},c=0;s.length>c;c++){var d=s[c];d.filter=angular.copy(s[c].filter),l.filters.push(d),l.order.push(d.id)}return i({filters:l.filters,recent:l.filters[0]}),void 0}for(var c=0;s.length>c;c++){var d={name:s[c].name,index:c,icon:s[c].icon,filter:s[c].filter,appId:r};a.push(t({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/processes",data:d}))}o.all(a).then(function(e){for(var t=u.processes[r]||{filters:[],order:[]},o=0;s.length>o;o++){var n=e[o].data;n.filter=angular.copy(s[o].filter),t.filters.push(n),t.order.push(n.id)}i({filters:t.filters,recent:t.filters[0]})})})},this.getProcessFilters=function(e){var n=o.defer();return u.processes[e]&&u.processes[e].filters?n.resolve({filters:u.processes[e].filters,recent:c(u.processes[e])}):t({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/processes",params:{appId:e}}).success(function(t){u.processes[e]={filters:t.data,order:[]};for(var o=void 0,r=0;t.data.length>r;r++)u.processes[e].order[r]=t.data[r].id,(t.data[r].recent||0===r)&&(o=t.data[r]);n.resolve({filters:t.data,recent:o})}),n.promise},this.filterProcesses=function(e){return l(u.processes[e.appDefinitionId],e),m({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filter/process-instances",data:e})},this.updateProcessInstanceFilter=function(e,n){var r=o.defer();return t({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/processes/"+e,data:n}).success(function(e){s(u.processes[i(n)].filters,n,e),r.resolve(e)}),r.promise},this.deleteProcessInstanceFilter=function(e){return d(u.processes[i(e)],e.id),m({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/processes/"+e.id})},this.getRecentProcessInstanceFilter=function(e){return c(u.processes[e])},this.checkProcessInstanceFiltersOrder=function(e){for(var t=u.processes[e].filters,o=u.processes[e].order,n=!1,r=0;t.length>r;r++)o[r]!==t[r].id&&(n=!0,o[r]=t[r].id);n&&m({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/filters/processes",data:{appId:e,order:o}})}}]),angular.module("activitiApp").service("CommentService",["$http","$q","EventTrackingService",function(e,t,o){this.getTaskComments=function(o){var n=t.defer();return e({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+o+"/comments",params:{latestFirst:!0}}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.createTaskComment=function(n,r){var i=t.defer(),a={message:r};e({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+n+"/comments",data:a}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)});var s=i.promise;return o.trackEvent("workflow","task-add-comment"),s},this.getProcessInstanceComments=function(o){var n=t.defer();return e({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+o+"/comments",params:{latestFirst:!0}}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.createProcessInstanceComment=function(n,r){var i=t.defer(),a={message:r};e({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+n+"/comments",data:a}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)});var s=i.promise;return o.trackEvent("workflow","processinstance-add-comment"),s}}]),angular.module("activitiApp").service("ProcessService",["$http","$q","$rootScope","RelatedContentService","EventTrackingService",function(e,t,o,n,r){var i=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.queryProcessInstances=function(e){return i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/query/process-instances",data:e})},this.getProcessDefinitions=function(e){var t=ACTIVITI.CONFIG.contextRoot+"/app/rest/process-definitions?latest=true";return e&&(t+="&appDefinitionId="+e),i({method:"GET",url:t})},this.getProcessDefinitionById=function(e){var t=ACTIVITI.CONFIG.contextRoot+"/app/rest/process-definition/"+e;return i({method:"GET",url:t})},this.getProcess=function(e){return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+e})},this.createProcess=function(n){var i=t.defer();e({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances",data:n}).success(function(e){o.$broadcast("new-process-created",e),i.resolve(e)}).error(function(e){o.addAlert(e.message,"error"),i.reject(e)});var a=i.promise;return r.trackEvent("workflow","create-standalone-process"),a},this.deleteProcess=function(n){var i=t.defer();e({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+n}).success(function(e){o.$broadcast("processinstance-deleted",e),i.resolve(e)}).error(function(e){o.addAlert(e.message,"error"),i.reject(e)});var a=i.promise;return r.trackEvent("workflow","delete-processinstance"),a},this.getHistoricProcessInstanceDecisionTasks=function(e){return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+e+"/decision-tasks"})}}]),angular.module("activitiApp").service("TaskService",["$http","$q","$rootScope","RelatedContentService","EventTrackingService",function(e,t,o,n,r){var i=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getProcessInstanceTasks=function(e,t,o){var n={processInstanceId:e};return t&&(n.state="completed"),null!=o&&void 0!=o&&(n.start=o),i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/query/tasks",data:n})},this.involveUserInTask=function(e,t){var o={userId:e},n=i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+t+"/action/involve",data:o});return n.then(function(){r.trackEvent("workflow","task-involve-person")}),n},this.involveUserInTaskByEmail=function(e,t){var o={email:e},n=i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+t+"/action/involve",data:o});return n.then(function(){r.trackEvent("workflow","task-involve-by-email")}),n},this.removeInvolvedUserInTask=function(e,t){var o={};null!==e.id&&void 0!==e.id?o.userId=e.id:o.email=e.email;var n=i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+t+"/action/remove-involved",data:o});return n.then(function(){r.trackEvent("workflow","task-remove-involved-person")}),n},this.involveGroup=function(e,t){var o=i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/groups/"+t});return o.then(function(){r.trackEvent("workflow","task-involve-group")}),o},this.removeInvolvedGroup=function(e,t){var o=i({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/groups/"+t});return o.then(function(){r.trackEvent("workflow","task-remove-involved-group")}),o},this.queryTasks=function(e){return i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/query/tasks",data:e})},this.completeTask=function(n){var i=t.defer();e({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+n+"/action/complete"}).success(function(e){o.$broadcast("task-completed",{taskId:n}),"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.taskCompleted!==void 0&&ALFRESCO.formExtensions.taskCompleted(n),i.resolve(e)}).error(function(e){o.addAlert(e.message,"error"),"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.taskCompletedError!==void 0&&ALFRESCO.formExtensions.taskCompletedError(n,e.message),i.reject(e)});var a=i.promise;return r.trackEvent("workflow","task-complete-no-form"),a},this.claimTask=function(e){var t=i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/action/claim"});return r.trackEvent("workflow","task-claim"),t},this.unClaimTask=function(e){var t=i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/action/unclaim"});return t},this.getRelatedContent=function(o){var r=t.defer();return e({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+o+"/content"}).success(function(e){if(e&&e.data)for(var t=0;e.data.length>t;t++)n.addUrlToContent(e.data[t]);r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},this.assignTask=function(e,t){var o={assignee:t},n=i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/action/assign",data:o});return n.then(function(){r.trackEvent("workflow","task-assign-by-user")}),n},this.assignTaskByEmail=function(e,t){var o=i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/action/assign",data:{email:t}});return o.then(function(){r.trackEvent("workflow","task-assign-by-email")}),o},this.updateTask=function(e,t){return i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e,data:t})},this.getTask=function(e){return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e})},this.getChecklist=function(e){return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/checklist"})},this.orderChecklist=function(e,t){return i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/checklist",data:t})},this.attachForm=function(e,t){return i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/action/attach-form",data:{formId:t}})},this.removeForm=function(e){return i({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/action/remove-form"})},this.createTask=function(n){var i=t.defer();e({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks",data:n}).success(function(e){o.$broadcast("new-task-created",e),i.resolve(e)}).error(function(e){o.addAlert(e.message,"error"),i.reject(e)});var a=i.promise;return r.trackEvent("workflow","create-standalone-task"),a},this.createChecklistTask=function(n,r){var i=t.defer();e({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+n+"/checklist",data:r}).success(function(e){i.resolve(e)}).error(function(e){o.addAlert(e.message,"error"),i.reject(e)});var a=i.promise;return a},this.deleteChecklistTask=function(e){return i({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e})},this.getProcessInstanceVariables=function(e){var t={taskId:e};return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/task-forms/"+e+"/variables",data:t})}}]),angular.module("activitiApp").service("FormService",["$http","$q","EventTrackingService",function(e,t,o){var n=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getTaskForm=function(e){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/task-forms/"+e})},this.completeTaskForm=function(e,t){var r=n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/task-forms/"+e,data:t});return r.then(function(){o.trackEvent("workflow","task-complete-with-form")}),r},this.saveTaskForm=function(e,t){var r=n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/task-forms/"+e+"/save-form",data:t});return r.then(function(){o.trackEvent("workflow","task-save-with-form")}),r},this.getStartForm=function(e){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-definitions/"+e+"/start-form"})},this.getTaskFormFieldValues=function(e,t){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/task-forms/"+e+"/form-values/"+t})},this.getStartFormFieldValues=function(e,t){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-definitions/"+e+"/start-form-values/"+t})},this.getStartFormInstance=function(e){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+e+"/start-form"})},this.completeStartForm=function(e){var t=n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/",data:e});return t.then(function(){o.trackEvent("workflow","processinstance-start-with-form")}),t},this.getHistoricInstanceVariables=function(e){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+e+"/historic-variables"})}}]),angular.module("activitiApp").service("AppDefinitionService",["$http","$q","$rootScope","$location","$translate",function(e,t,o,n,r){var i=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.setActiveAppDefinitionId=function(e){e?o.appDefinitions[e]?o.activeAppDefinition=o.appDefinitions[e]:(o.activeAppDefinition={id:e},o.appDefinitions[e]=o.activeAppDefinition,this.getAppDefinition(e).then(function(e){o.appDefinitions[e.id]=e,o.activeAppDefinition&&o.activeAppDefinition.id==e.id&&(o.activeAppDefinition=e)},function(){o.addAlertPromise(r("APP-DEFINITION.MESSAGE.NOT-FOUND"),"error"),n.path("/")})):o.activeAppDefinition=void 0},this.getAppDefinition=function(e){return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/runtime/app-definitions/"+e})},this.getIntegrationAppDefinitionId=function(){if(ACTIVITI.CONFIG.integrationProfile){for(var e=o.account.apps,t=0,n=e.length;n>t;t++)if(e[t].name===ACTIVITI.CONFIG.integrationProfile)return e[t].id;return!1}return null}}]),activitiApp.controller("AddCommentController",["$scope","$location","AuthenticationSharedService","$timeout",function(e){e.popupModel={newComment:"",added:!1},e.createComment=function(){e.popupModel.added=!0,e.$emit("new-comment-confirm",e.popupModel.newComment),e.$$childHead&&e.$$childHead.$hide()},e.$on("tooltip.hide",function(){e.popupModel.added?e.popupModel.added=!1:e.$emit("new-comment-cancelled",e.popupModel.newComment)})}]),angular.module("activitiApp").controller("DocumentPreviewController",["$rootScope","$scope","$modal","appResourceRoot","RelatedContentService","ContentAccountService",function(e,t,o,n,r,i){t.contentAccounts={},i.getAccounts().then(function(e){if(e&&e.data)for(var o=0;e.data.length>o;o++){var n=e.data[o];t.contentAccounts[n.serviceId]=n}}),r.checkRenditions(t.content),t.openOfficeDocument=e.openOfficeDocument,t.showDetails=function(){var e=_internalCreateModal({template:n+"views/modal/content-details.html",show:!0},o,t);e.$scope.content=t.content,e.$scope.contentAccounts=t.contentAccounts,e.$scope.editable=t.editable,e.$scope.readOnly=t.readOnly,e.$scope.$on("content-deleted",function(){e.$scope.$hide(),t.deleted({content:t.content})})},t.deleteContent=function(e,i){var a=_internalCreateModal({template:n+"views/modal/delete-content.html",show:!0},o,t);a.$scope.popup={content:e,loading:!1},a.$scope.ok=function(){r.deleteContent(e.id,i&&i.id).then(function(){t.deleted({content:e}),t.content=null
})}}}]),angular.module("activitiApp").controller("TasksController",["$rootScope","$scope","$translate","$timeout","$location","$modal","$popover","filterFilter","appResourceRoot","CommentService","TaskService","$routeParams","AppDefinitionService","FilterService","NavigationService","$q",function(e,t,o,n,r,i,a,s,l,c,d,u,p,m,f,v){function g(){t.model.filter.loading=!0,d.queryTasks({appDefinitionId:t.appDefinitionId,taskId:t.model.filter.taskId}).then(function(e){t.model.tasks=e.data,t.model.hasNextPage=!1,t.selectedTask=e.data.length>0?e.data[0]:void 0,t.model.filter.loading=!1},function(){t.model.tasks=[],t.model.filter.loading=!1})}function h(e){m.getTaskFilters(t.appDefinitionId).then(function(o){t.model.filters=o.filters,o.filters.length>0?T(o,e):I(e)})}function I(e){m.createDefaultTaskFilters(t.appDefinitionId,function(t){T(t,e)})}function T(e,o){o?t.selectFilter(e.recent):t.applyFilter(e.recent)}function C(e){r.search().taskId&&(e&&(t.model.filter.taskId=void 0),r.search("taskId",null))}e.setMainPageById("tasks"),t.$on("$routeUpdate",function(){t.model.filter.taskId!==r.search().taskId&&(t.model.filter.taskId=r.search().taskId,t.model.filter.taskId?(t.model.filter.expanded=!1,g(t.model.filter.taskId)):t.filterTasks({page:0,filter:t.model.filter.edit.filter}))}),t.model={page:0,filter:{previousName:null,loading:!1,expanded:!1,taskId:r.search().taskId},filterIconsHeader:{expanded:!1},filterIconsFooter:{expanded:!1},createTask:{expanded:!1},filterSearchTerm:{expanded:!1}},v.all([o("TASK.FILTER.CREATED-DESC"),o("TASK.FILTER.CREATED-ASC"),o("TASK.FILTER.DUE-DESC"),o("TASK.FILTER.DUE-ASC")]).then(function(e){t.model.sorts=[{id:"created-desc",title:e[0],icon:"glyphicon-sort-by-attributes-alt"},{id:"created-asc",title:e[1],icon:"glyphicon-sort-by-attributes"},{id:"due-desc",title:e[2],icon:"glyphicon-sort-by-attributes-alt"},{id:"due-asc",title:e[3],icon:"glyphicon-sort-by-attributes"}]}),t.model.stateFilterOptions=[{id:"open",title:"TASK.FILTER.STATE-OPEN"},{id:"completed",title:"TASK.FILTER.STATE-COMPLETED"}],v.all([o("TASK.FILTER.ASSIGNMENT-INVOLVED"),o("TASK.FILTER.ASSIGNMENT-ASSIGNEE"),o("TASK.FILTER.ASSIGNMENT-CANDIDATE")]).then(function(e){if(t.model.assignmentOptions=[{id:"involved",title:e[0]},{id:"assignee",title:e[1]},{id:"candidate",title:e[2]}],t.account&&t.account.groups&&t.account.groups.length>0)for(var n=0;t.account.groups.length>n;n++)1==t.account.groups[n].type&&t.model.assignmentOptions.push({id:"group_"+t.account.groups[n].id,title:o.instant("TASK.FILTER.ASSIGNMENT-GROUP",t.account.groups[n])})}),t.appDefinitionId=u.appDefinitionId||p.getIntegrationAppDefinitionId(),t.missingAppdefinition=t.appDefinitionId===!1,p.setActiveAppDefinitionId(t.appDefinitionId),t.nextPage=function(){t.model.page=t.model.page+1,t.refreshFilter()},t.resetPaging=function(){t.model.page=0},t.selectFilter=function(o,n){n&&t.model.filter.selected&&o.id===t.model.filter.selected.id||(C(!0),t.collapseTaskForm(),t.applyFilter(o),e.readOnly?t.filterTasks({page:0,filter:o.filter}):t.filterTasks({page:0,filterId:o.id,filter:o.filter}))},t.applyFilter=function(e){t.model.filter.selected=e,t.model.filter.edit=angular.copy(e),t.model.page=0},t.resetFilter=function(){t.model.page=0,t.model.filter.edit=angular.copy(t.model.filter.selected),t.filterTasks({page:0,filter:t.model.filter.edit.filter}),t.model.filter.modified=!1},t.filterChanged=function(){C(!0),t.model.page=0,t.filterTasks({page:0,filter:t.model.filter.edit.filter}),t.model.filter.modified=!0},t.editFilter=function(){t.model.filter.expanded=!0,t.collapseTaskForm()},t.createNewFilter=function(){var e={icon:"glyphicon-filter"};e.filter=angular.copy(t.model.filter.edit.filter),t.model.filter.edit=e,t.model.filter.expanded=!0,C()},t.saveFilter=function(e){e.id?t.updateFilter(e):t.createFilter(e),t.model.filter.modified=!1},t.createFilter=function(e){var o={name:e.name,filter:e.filter,appId:t.appDefinitionId};o.icon=e.icon||"glyphicon-filter",m.createTaskFilter(o).then(function(e){t.selectFilter(e)})},t.updateFilter=function(e){m.updateTaskFilter(e.id,e).then(function(e){t.selectFilter(e)})},t.deleteFilter=function(e){m.deleteTaskFilter(e).then(function(){0===t.model.filters.length?I(!0):t.selectFilter(m.getRecentTaskFilter(t.appDefinitionId))})},t.reloadTaskList=function(){C(!0),t.filterTasks({page:0,filter:t.model.filter.edit.filter})},t.refreshFilter=function(){C(!0),t.filterTasks({page:t.model.page,filter:t.model.filter.edit.filter})},t.filterTasks=function(e){e.appDefinitionId=t.appDefinitionId,t.model.filter.loading=!0,e.page&&0!==e.page||(t.model.tasks=[]),m.filterTasks(e).then(function(e){if(t.model.filter.loading=!1,0===e.start)t.model.tasks=e.data,t.selectedTask=t.model.tasks[0];else for(var o=0;e.data.length>o;o++)t.model.tasks.push(e.data[o]);t.model.hasNextPage=e.start+e.size<e.total})},t.selectTask=function(e){t.selectedTask=e},t.createTask=function(){var e=o.instant("TASK.TITLE.NEW-TASK-NAME");t.newTask={name:e},t.model.createTask.expanded=!0},t.confirmTaskCreation=function(n){if(n||(n=t.newTask),n&&n.name){var r={name:n.name,description:n.description,assignee:{id:e.account.id}};e.activeAppDefinition&&(r.category=""+e.activeAppDefinition.id),n.loading=!0,d.createTask(r).then(function(r){n.loading=!1,e.addAlertPromise(o("TASK.ALERT.CREATED",r)),t.collapseTaskForm(),f.openTaskPage(r.id)})}},t.startProcess=function(){f.openProcessPageInStartMode()},t.collapseFilter=function(){t.model.filter.expanded=!1,t.model.filter.editName=!1,t.model.filter.modified?t.resetFilter():t.model.filter.edit=angular.copy(t.model.filter.selected)},t.collapseTaskForm=function(){t.model.createTask.expanded=!1},t.$on("task-completed",function(n,r){e.addAlertPromise(o("TASK.ALERT.COMPLETED",r)),r&&r.taskId==t.selectedTask.id&&(t.selectedTask=void 0,t.resetPaging(),t.refreshFilter())}),t.$on("task-saved",function(t,n){e.addAlertPromise(o("TASK.ALERT.SAVED",n))}),t.$on("task-completed-error",function(t,o){e.addAlert(o.error.message,"error")}),t.$on("task-save-error",function(t,o){e.addAlert(o.error.message,"error")}),t.$on("checklist-task-deleted",function(e,o){if(t.model.tasks&&t.model.tasks.length>0)for(var n=0;t.model.tasks.length>n;n++)if(t.model.tasks[n].id===o){t.model.tasks.splice(n,1);break}}),e.loadProcessDefinitions(t.appDefinitionId);var F=t.$watch("root.processDefinitions",function(e){if(null!==e&&void 0!=e&&e.length>0){var o=angular.copy(e);o.splice(0,0,{name:""}),t.model.processDefinitions=o,F()}});t.model.filter.taskId?(h(!1),g(t.model.filter.taskId)):h(!0),t.toggleChangeName=function(){t.model.filter.editName||(t.model.filter.previousName=t.model.filter.edit.name),t.model.filter.editName=!t.model.filter.editName,t.model.filterIconsFooter.expanded=!1},t.toggleChangeIcon=function(e){t.model[e].expanded||t.icons||(t.icons=m.getFilterIcons(),t.currentIconPage=1,t.iconPageSize=35),t.model[e].expanded=!t.model[e].expanded,t.model.filter.editName=!1},t.selectIcon=function(e){t.model.filter.edit.icon=e,t.model.filterIconsHeader.expanded=!1,t.model.filterIconsFooter.expanded=!1},t.orderFilterlist=function(e){t.model.filters.splice(e,1),m.checkTaskFiltersOrder(t.appDefinitionId)}}]),angular.module("activitiApp").controller("TaskController",["$rootScope","$scope","$translate","$timeout","$location","$modal","$popover","appResourceRoot","CommentService","TaskService","$routeParams","AppDefinitionService","NavigationService",function(e,t,o,n,r,i,a,s,l,c,d,u,p){e.setMainPageById("tasks"),t.selectedTask={id:d.taskId},t.appDefinitionId=d.appDefinitionId||u.getIntegrationAppDefinitionId(),t.$on("task-completed",function(n,r){e.addAlertPromise(o("TASK.ALERT.COMPLETED",r)),t.openTasks()}),t.openTasks=function(){p.openTaskPage()}}]),angular.module("activitiApp").controller("TaskDetailController",["$rootScope","$scope","$translate","$http","$location","$routeParams","appResourceRoot","CommentService","TaskService","FormService","RelatedContentService","EventTrackingService","$timeout","$modal","$popover","NavigationService","ProcessService","SystemPropertiesService","$filter",function(e,t,o,n,r,i,a,s,l,c,d,u,p,m,f,v,g,h,I){t.model={task:t.selectedTask,completeButtonDisabled:!1,claimButtonDisabled:!1,uploadInProgress:!1,involvedUsersCanEditForms:!0,involvementSummary:{loading:!1},contentSummary:{loading:!1},commentSummary:{loading:!1},checklistSummary:{loading:!1}},t.activeTab="form";var T=null;void 0!==t.account&&(T=t.account.tenantId),h.canInvolvedUsersEditForms(T).then(function(e){void 0!==e&&(t.model.involvedUsersCanEditForms=e)}),t.resetModel=function(){t.taskTabs=[],null!=t.model.task.formKey?(t.taskTabs.push({id:"form",title:"TASK.TITLE.FORM"}),t.activeTab="form"):t.activeTab="details",t.taskTabs.push({id:"details",title:"TASK.TITLE.DETAILS"}),t.model.involvementSummary={loading:!0},t.model.contentSummary={loading:!0},t.model.commentSummary={loading:!0},t.model.checklistSummary={loading:!0},t.model.content=void 0,t.model.comments=void 0,p(function(){e.window.forceRefresh=!0},100);var o=new Date;t.today=new Date(o.getFullYear(),o.getMonth(),o.getDate(),0,0,0,0)},t.showDetails=function(){t.activeTab="details"},t.toggleForm=function(){t.activeTab="form"==t.activeTab?"details":"form"},t.$watch("selectedTask",function(e){e&&e.id?(t.model.taskUpdating=!0,t.model.task=e,t.model.task.formKey&&t.resetModel(),t.getTask(e.id)):t.model={}}),e.setMainPageById("tasks"),t.setTaskAssignee=function(n){var r={userName:I("username")(n),taskName:t.model.task.name};l.assignTask(t.model.task.id,n.id).then(function(n){e.addAlertPromise(o("TASK.ALERT.ASSIGNED",r)),t.model.task=n})},t.setTaskAssigneeByEmail=function(e){l.assignTaskByEmail(t.model.task.id,e).then(function(){t.model.task.assignee={email:e}})},t.isUserInvolved=function(e){if(!e)return!1;if(!t.model.task.involvedPeople)return!1;var o=!1;return angular.forEach(t.model.task.involvedPeople,function(t){t.id==e&&(o=!0)}),o},t.involvePerson=function(n){var r={userName:I("username")(n),taskName:t.model.task.name};l.involveUserInTask(n.id,t.model.task.id).then(function(){e.addAlertPromise(o("TASK.ALERT.PERSON-INVOLVED",r)),t.model.task.involvedPeople?t.model.task.involvedPeople.push(n):t.model.task.involvedPeople=[n]})},t.involvePersonByEmail=function(n){l.involveUserInTaskByEmail(n,t.model.task.id).then(function(){t.model.task.involvedPeople?t.model.task.involvedPeople.push({email:n}):t.model.task.involvedPeople={email:n}},function(){e.addAlertPromise(o("TASK.ALERT.PERSON-INVOLVED-EMAIL-NOT-ALLOWED",{emailAddress:n}),"error")})},t.removeInvolvedUser=function(n){var r={userName:I("username")(n),taskName:t.model.task.name};l.removeInvolvedUserInTask(n,t.model.task.id).then(function(){e.addAlertPromise(o("TASK.ALERT.PERSON-NO-LONGER-INVOLVED",r)),t.model.task.involvedPeople.splice($.inArray(n,t.model.task.involvedPeople),1)})},t.currentGroupIds=[],t.involveGroup=function(n){l.involveGroup(t.model.task.id,n.id).then(function(){e.addAlertPromise(o("TASK.ALERT.GROUP-INVOLVED",{groupName:n.name,taskName:t.model.task.name}));var r=t.model.task.involvedGroups;if(r){var i=r.indexOf(n);0>i&&r.push(n)}else r=[n],t.model.task.involvedGroups=r;t.currentGroupIds.push(n.id)})},t.removeInvolvedGroup=function(n){l.removeInvolvedGroup(t.model.task.id,n.id).then(function(){var r=t.model.task.involvedGroups||[],i=r.indexOf(n);r.splice(i,1);var a=t.currentGroupIds.indexOf(n.id);t.currentGroupIds.splice(a,1),e.addAlertPromise(o("TASK.ALERT.GROUP-NO-LONGER-INVOLVED",{groupName:n.name,taskName:t.model.task.name}))})},t.hasGroupsInvolved=function(){var e=t.model.task.involvedGroups;return e&&e.length>0},t.getTask=function(e){t.model.loading=!0,t.model.formData=void 0,t.model.hasFormKey=!1,t.model.comments=void 0,t.model.content=void 0,t.model.checklist=void 0,t.model.task.formKey&&(t.model.hasFormKey=!0),l.getTask(e).then(function(e){return angular.extend(t.model.task,e),t.noSuchTask=!1,t.model.hasFormKey||t.resetModel(),t.loadComments(),t.loadChecklist(),t.loadRelatedContent(),t.model.task.processInstanceId?t.loadProcessInstance():(t.model.processInstance=null,t.refreshInvolvmentSummary(),void 0)}).then(function(){return null!==t.model.task.formKey&&void 0!==t.model.task.formKey?c.getTaskForm(t.model.task.id).then(function(e){t.model.formData=e}):(t.model.formData=void 0,void 0)}).then(function(){t.model.loading=!1,t.model.taskUpdating=!1}).catch(function(){t.model.loading=!1,t.noSuchTask=!0})},t.$watch("model.task.involvedPeople",function(){t.refreshInvolvmentSummary()},!0),t.refreshInvolvmentSummary=function(){if(t.model.task){var e=t.model.task.involvedPeople;if(t.model.involvementSummary.loading=!1,e&&e.length>0)if(t.model.involvementSummary.count=e.length,e.length>8){t.model.involvementSummary.overflow=!0,t.model.involvementSummary.items=[];for(var o=0;8>o;o++)t.model.involvementSummary.items.push(e[o])}else t.model.involvementSummary.overflow=!1,t.model.involvementSummary.items=e;else t.model.involvementSummary.count=0}},t.$watch("model.content.data",function(e){if(t.model.task)if(t.model.contentSummary.loading=!1,e&&e.length>0)if(t.model.contentSummary.count=e.length,e.length>8){t.model.contentSummary.overflow=!0,t.model.contentSummary.items=[];for(var o=0;8>o;o++)t.model.contentSummary.items.push(e[o])}else t.model.contentSummary.overflow=!1,t.model.contentSummary.items=e;else t.model.contentSummary.count=0},!0),t.$watch("model.comments.data",function(){t.refreshCommentSummary()},!0),t.refreshCommentSummary=function(){if(t.model.task){var e=t.model.comments?t.model.comments.data:void 0;t.model.commentSummary.loading=!1,e?t.model.commentSummary.count=e.length:(t.model.commentSummary.loading=!0,t.model.commentSummary.count=void 0)}},t.$watch("model.checklist.data",function(){t.refreshChecklistSummary()},!0),t.refreshChecklistSummary=function(){if(t.model.task){var e=t.model.checklist?t.model.checklist.data:void 0;t.model.checklistSummary.loading=!1,e?t.model.checklistSummary.count=e.length:(t.model.checklistSummary.loading=!0,t.model.checklistSummary.count=void 0)}},t.dragOverContent=function(e){e&&!t.model.contentSummary.addContent&&(t.model.contentSummary.addContent=!0)},t.$watch("model.content.data",function(){t.model.task},!0),t.loadComments=function(){s.getTaskComments(t.model.task.id).then(function(e){t.model.comments=e,t.refreshCommentSummary()})},t.loadChecklist=function(e){l.getChecklist(t.model.task.id).then(function(o){t.model.checklist=o;for(var n=[],r=0;o.data.length>r;r++)n.push(o.data[r].id);t.model.checklistSummary.order=n,t.refreshChecklistSummary(),e&&e()})},t.toggleCreateComment=function(){t.model.commentSummary.addComment&&(t.model.commentSummary.newComment=void 0),t.model.commentSummary.addComment=!t.model.commentSummary.addComment,t.model.commentSummary.addComment&&p(function(){angular.element(".comment-input .focusable").focus()},100)},t.checkTaskStatusAndToggleCreateContent=function(){!t.model.task||t.model.task.endDate||t.readOnly||t.toggleCreateContent()},t.toggleCreateContent=function(){t.model.contentSummary.addContent=!t.model.contentSummary.addContent},t.toggleCreateChecklistTask=function(){t.model.task.endDate||(t.model.checklistSummary.addTask&&(t.model.checklistSummary.newTask=void 0),t.model.checklistSummary.addTask=!t.model.checklistSummary.addTask,t.model.checklistSummary.addTask&&p(function(){angular.element(".checklist-input .focusable").focus()},100))},t.orderChecklist=function(e){t.model.checklist.data.splice(e,1);for(var o={order:[]},n=!1,r=0;t.model.checklist.data.length>r;r++)t.model.checklistSummary.order[r]!==t.model.checklist.data[r].id&&(n=!0),o.order.push(t.model.checklist.data[r].id);n&&(t.model.checklistSummary.order=o.order,l.orderChecklist(t.model.task.id,o).then(function(){}))},t.showSelectForm=function(){var n=_internalCreateModal({template:a+"views/modal/select-form.html",scope:t,show:!0},m,t);t.model.formData&&(n.$scope.currentForm=angular.extend({},t.model.formData)),n.$scope.attachForm=function(n){t.model.taskUpdating=!0,l.attachForm(t.model.task.id,n.id).then(function(){t.model.taskUpdating=!1,t.getTask(t.model.task.id),e.addAlertPromise(o("TASK.ALERT.FORM-ATTACHED",{name:n.name}),"info")})},n.$scope.removeForm=function(){t.model.taskUpdating=!0;var n=t.model.formData.name;l.removeForm(t.model.task.id).then(function(){t.model.taskUpdating=!1,t.getTask(t.model.task.id),e.addAlertPromise(o("TASK.ALERT.FORM-REMOVED",{name:n}),"info")})}},t.editTaskNamePopup=function(){t.editTaskNamePopover||(t.editTaskName={name:t.model.task.name,description:t.model.task.description},t.editTaskNamePopover=f(angular.element("#toggle-edit-task-name"),{template:a+"views/popover/edit-task-name-popover.html",placement:"bottom-left",show:!0,scope:t}),t.editTaskNamePopover.$scope.$on("tooltip.hide",function(){t.editTaskNamePopover.$scope.$destroy(),t.editTaskNamePopover.destroy(),t.editTaskNamePopover=void 0,t.editTaskName=void 0}))},t.confirmEditTaskName=function(){t.editTaskName&&t.editTaskName.name&&(t.editTaskName.loading=!0,l.updateTask(t.model.task.id,{name:t.editTaskName.name,description:t.editTaskName.description}).then(function(){t.editTaskName.loading=!1,t.editTaskNamePopover&&(t.editTaskNamePopover.$scope.$destroy(),t.editTaskNamePopover.destroy(),t.editTaskNamePopover=void 0),t.model.task.name=t.editTaskName.name,t.model.task.description=t.editTaskName.description}))},t.onContentUploaded=function(n){t.model.content&&t.model.content.data&&(t.model.content.data.push(n),d.checkRenditions(n),t.model.selectedContent=n),e.addAlertPromise(o("TASK.ALERT.RELATED-CONTENT-ADDED",n),"info"),t.toggleCreateContent()},t.onContentDeleted=function(e){t.model.content&&t.model.content.data&&t.model.content.data.forEach(function(t,o,n){e===t&&n.splice(o,1)})},t.selectContent=function(e){t.model.selectedContent=t.model.selectedContent==e?void 0:e},t.confirmNewComment=function(){t.model.commentSummary.loading=!0,s.createTaskComment(t.model.task.id,t.model.commentSummary.newComment.trim()).then(function(){t.model.commentSummary.newComment=void 0,t.model.commentSummary.addComment=!1,t.model.commentSummary.loading=!1,e.addAlertPromise(o("TASK.ALERT.COMMENT-ADDED",t.model.task)),t.loadComments()})},t.confirmChecklistNewTask=function(){if(void 0!==t.model.checklistSummary.newTask&&null!==t.model.checklistSummary.newTask&&0!=t.model.checklistSummary.newTask.length){t.model.checklistSummary.loading=!0;var n={parentTaskId:t.model.task.id,name:t.model.checklistSummary.newTask.trim(),assignee:{id:e.account.id},dueDate:t.model.task.dueDate};e.activeAppDefinition&&(n.category=""+e.activeAppDefinition.id),l.createChecklistTask(t.model.task.id,n).then(function(n){t.model.checklistSummary.newTask=void 0,e.addAlertPromise(o("TASK.ALERT.CHECKLIST-ADDED",n)),t.loadChecklist(function(){p(function(){t.model.checklistSummary.loading=!1,angular.element(".checklist-input .focusable").focus()},100)})})}},t.deleteChecklistTask=function(n){t.model.checklistSummary.loading=!0,l.deleteChecklistTask(n.id).then(function(){e.$broadcast("checklist-task-deleted",n.id),t.model.checklistSummary.newTask=void 0,t.model.checklistSummary.addTask=!1,t.model.checklistSummary.loading=!1,e.addAlertPromise(o("TASK.ALERT.CHECKLIST-REMOVED",n)),t.loadChecklist()})},t.$watch("model.task.dueDate",function(e,o){if(!t.model.taskUpdating&&t.model.task){if(null===o&&null===e||null===o&&void 0===e||void 0===o&&void 0===e||void 0===o&&null===e)return;if(e&&void 0!==e&&e.getHours&&23!=e.getHours()&&(e.setHours(23),e.setMinutes(59),e.setSeconds(59),t.model.task.dueDate=e),new Date(o).getTime()!=new Date(e).getTime()||null!=o&&null!=e){t.model.taskUpdating=!0;var n={dueDate:e?e:null};l.updateTask(t.model.task.id,n).then(function(){u.trackEvent("workflow","task-due-date-set"),t.model.taskUpdating=!1})}}}),t.createTaskInline=function(){t.newTask||(t.newTask={name:"New task",inline:!0})},t.createProcess=function(){e.createProcessInstance=!0,t.openProcessInstance()},t.selectProcessDefinition=function(e){t.newProcessInstance.processDefinitionId=e.id,t.newProcessInstance.name=e.name+" - "+(new moment).format("MMMM Do YYYY"),p(function(){angular.element("#start-process-name").focus()},20)},t.closeInlineTaskCreation=function(e){t.newTask=void 0,e.stopPropagation()},t.completeTask=function(){t.model.completeButtonDisabled=!0,l.completeTask(t.model.task.id)},t.claimTask=function(){t.model.loading=!0,t.model.claimButtonDisabled=!0,l.claimTask(t.model.task.id).then(function(){i.taskId||r.search().taskId?t.getTask(t.model.task.id):v.openTaskPage(t.model.task.id),t.model.claimButtonDisabled=!1})},t.unClaimTask=function(){t.model.loading=!0,t.model.unClaimButtonDisabled=!0,l.unClaimTask(t.model.task.id).then(function(){i.taskId||r.search().taskId?t.getTask(t.model.task.id):v.openTaskPage(t.model.task.id),t.model.unClaimButtonDisabled=!1})},t.loadProcessInstance=function(){return g.getProcess(t.model.task.processInstanceId).then(function(e){t.model.processInstance=e})},t.openTask=function(e){v.openTaskPage(e)},t.openProcessInstance=function(e){v.openProcessPage(e)},t.returnToTaskList=function(){i.taskId?v.openTaskPage():t.reloadTaskList()},t.loadRelatedContent=function(){return t.model.content=void 0,l.getRelatedContent(t.model.task.id).then(function(e){t.model.content=e})},t.$watch("model.content",function(e){if(e&&e.data&&e.data.length>0)for(var t=!1,o=0;e.data.length>o;o++){var n=e.data[o];if(!n.contentAvailable){t=!0;break}}},!0),t.editComment=function(){t.model.editingComment=!0},t.stopEditComment=function(){t.model.editingComment=!1},t.userInvolved=function(n){var r={userName:I("username")(n),taskName:t.model.task.name};l.involveUserInTask(n.id,t.model.task.id).then(function(){e.addAlertPromise(o("TASK.ALERT.PERSON-INVOLVED",r)),t.model.task.involvedPeople?t.model.task.involvedPeople.push(n):t.model.task.involvedPeople=[n]})},t.assigneeSelected=function(n){var r={userName:I("username")(n),taskName:t.model.task.name};l.assignTask(t.model.task.id,n.id).then(function(){e.addAlertPromise(o("TASK.ALERT.ASSIGNED",r)),t.model.task.assignee=n})},t.revealContent=function(e){t.model.activeTab="content",t.model.selectedContent=e},t.hasDetails=function(){if(t.model.loading||!t.model.involvementSummary||t.model.involvementSummary.loading||!t.model.contentSummary||t.model.contentSummary.loading||!t.model.commentSummary||t.model.commentSummary.loading||!t.model.checklistSummary||t.model.checklistSummary.loading)return!1;if(t.model.task){if(t.model.task.involvedPeople&&t.model.task.involvedPeople.length>0)return!0;if(t.model.task.involvedGroups&&t.model.task.involvedGroups.length>0)return!0;if(t.model.content&&t.model.content.data.length>0)return!0;if(t.model.comments&&t.model.comments.data.length>0)return!0;if(t.model.checklist&&t.model.checklist.data.length>0)return!0}return!1},t.uploadInProgress=function(e){"undefined"!==e&&(t.model.uploadInProgress=e)}}]),angular.module("activitiApp").controller("CreateTaskController",["$rootScope","$scope","$translate","$http","$location","TaskService",function(e,t,o,n,r,i){t.createTask=function(){t.newTask.assignee={id:e.account.id},i.createTask(t.newTask).then(function(n){t.resetModel(),e.addAlertPromise(o("TASK.ALERT.CREATED",n))})},t.resetModel=function(){t.newTask={name:"",description:""}},t.resetModel()}]),angular.module("activitiApp").controller("ContentDetailsController",["$rootScope","$scope","$translate","$modal","appResourceRoot","RelatedContentService",function(e,t,o,n,r,i){t.model={selectedContent:t.content,selectedTask:t.task};var a;a=t.content?"CONTENT.SIMPLE-TYPE."+t.content.simpleType.toUpperCase():"CONTENT.SIMPLE-TYPE.CONTENT",o(a).then(function(e){t.model.contentType=e}),t.deleteContent=function(e,o){var a=_internalCreateModal({template:r+"views/modal/delete-content.html",show:!0},n,t);a.$scope.popup={content:e,loading:!1},a.$scope.ok=function(){i.deleteContent(e.id,o&&o.id).then(function(){t.$emit("content-deleted",{content:e}),t.model.selectedContent=null,t.model.selectedTask=null})}}}]),angular.module("activitiApp").controller("ProcessesController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","appResourceRoot","AppDefinitionService","EventTrackingService","FilterService","ProcessService","NavigationService",function(e,t,o,n,r,i,a,s,l,c,d,u,p,m,f){function v(e){t.model.filter.loading=!0,m.queryProcessInstances({appDefinitionId:t.appDefinitionId,processInstanceId:e}).then(function(e){t.model.processInstances=e.data,t.model.hasNextPage=!1,e.data.length>0?(t.selectedProcessInstance=e.data[0],t.state={noProcesses:!1},t.startForm={}):(t.selectedProcessInstance=void 0,t.state={noProcesses:!0},t.startForm={}),t.model.filter.loading=!1})}function g(e){p.getProcessFilters(t.appDefinitionId).then(function(o){t.model.filters=o.filters,o.filters.length>0?I(o,e):h(e)})}function h(e){p.createDefaultProcessFilters(t.appDefinitionId,function(t){I(t,e)})}function I(e,o){o?t.selectFilter(e.recent):t.applyFilter(e.recent)}e.setMainPageById("processes"),t.startForm={},t.model={page:0,filter:{previousName:null,loading:!1,expanded:!1,processId:i.search().processId},filterIconsHeader:{expanded:!1},filterIconsFooter:{expanded:!1},mode:i.search().mode?"process-create":"process-list"},t.$on("$routeUpdate",function(){i.search().mode?t.createProcessInstance():(i.search().processId?(t.collapseFilter(!0),t.newProcessInstance=void 0,t.startFormError=void 0,v(i.search().processId)):("process-list"!==t.model.mode||t.model.filter.processId)&&(t.resetToListMode(),t.filterProcessInstances({page:0,filter:t.model.filter.edit.filter})),t.model.filter.processId=i.search().processId,t.model.mode="process-list")}),t.model.runtimeSorts=[{id:"created-desc",title:"PROCESS.FILTER.CREATED-DESC",icon:"glyphicon-sort-by-attributes-alt"},{id:"created-asc",title:"PROCESS.FILTER.CREATED-ASC",icon:"glyphicon-sort-by-attributes"}],t.model.completedSorts=[],t.model.completedSorts.push(t.model.runtimeSorts[0]),t.model.completedSorts.push(t.model.runtimeSorts[1]),t.model.completedSorts.push({id:"ended-asc",title:"PROCESS.FILTER.ENDED-DESC",icon:"glyphicon-sort-by-attributes-alt"}),t.model.completedSorts.push({id:"ended-desc",title:"PROCESS.FILTER.ENDED-ASC",icon:"glyphicon-sort-by-attributes"}),t.model.sorts=t.model.runtimeSorts,t.model.stateFilterOptions=[{id:"running",title:"PROCESS.FILTER.STATE-RUNNING"},{id:"completed",title:"PROCESS.FILTER.STATE-COMPLETED"},{id:"all",title:"PROCESS.FILTER.STATE-ALL"}],t.model.stateSortOptions={running:t.model.runtimeSorts,completed:t.model.completedSorts,all:t.model.runtimeSorts},t.appDefinitionId=s.appDefinitionId||d.getIntegrationAppDefinitionId(),t.missingAppdefinition=t.appDefinitionId===!1,d.setActiveAppDefinitionId(t.appDefinitionId),t.selectProcessInstance=function(e){t.selectedProcessInstance=e,t.state={noProcesses:!1},t.startForm={}},t.nextPage=function(){t.loadProcessInstances(!0)},t.loadProcessInstances=function(e){e?t.model.page+=1:t.model.page=0,t.filterProcessInstances({page:t.model.page,filter:t.model.filter.edit.filter})},t.selectProcessDefinition=function(e){t.newProcessInstance.processDefinitionId=e.id,t.newProcessInstance.name=e.name+" - "+(new moment).format("MMMM Do YYYY"),t.newProcessInstance.processDefinition=e},t.sortChanged=function(){t.selectedProcessInstance=void 0},t.selectDefaultDefinition=function(){if(t.model.processDefinitions&&t.model.processDefinitions.length>0)for(var e=0;t.model.processDefinitions.length>e;e++){var o=t.model.processDefinitions[e];if(o.id&&"default"!=o.id){t.selectProcessDefinition(o);break}}},t.resetToListMode=function(){t.newProcessInstance=void 0,t.model.mode="process-list",t.model.filter.processId=void 0,t.startFormError=void 0},t.reloadProcessList=function(){t.resetToListMode(),t.filterProcessInstances({page:0,filter:t.model.filter.edit.filter})},t.backToList=function(e){t.resetToListMode(),f.openProcessPage(),e&&(t.selectedProcessInstance=void 0,t.loadProcessInstances())},t.createProcessInstance=function(){t.collapseFilter(!0),t.model.mode="process-create",t.model.filter.processId=void 0,t.newProcessInstance={},t.selectDefaultDefinition(),f.openProcessPageInStartMode()},t.$on("process-started",function(e,o){t.newProcessInstance=void 0,t.startFormError=void 0,f.openProcessPage(o.id)}),t.startProcessInstanceWithoutForm=function(){t.newProcessInstance.loading=!0;var e={processDefinitionId:t.newProcessInstance.processDefinition.id,name:t.newProcessInstance.name};n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances",data:e}).success(function(e){t.newProcessInstance=void 0,t.startFormError=void 0,u.trackEvent("workflow","processinstance-start-no-form"),f.openProcessPage(e.id)}).error(function(e){t.newProcessInstance.loading=!1,e&&e.messageKey&&o(e.messageKey,e.customData).then(function(e){t.errorMessage=e,console.log(e)})})},e.loadProcessDefinitions(t.appDefinitionId);var T=t.$watch("root.processDefinitions",function(e){if(null!==e&&void 0!=e&&e.length>0){var o=angular.copy(e);o.splice(0,0,{name:""}),t.model.processDefinitions=o,T()}"process-create"===t.model.mode&&t.createProcessInstance()});t.selectFilter=function(o,n){n&&t.model.filter.selected&&o.id===t.model.filter.selected.id||(t.applyFilter(o),(t.model.filter.processId||"process-create"===t.model.mode)&&t.backToList(),e.readOnly?t.filterProcessInstances({page:0,filter:o.filter}):t.filterProcessInstances({page:0,filterId:o.id,filter:o.filter}))},t.applyFilter=function(e){t.model.filter.selected=e,t.model.filter.edit=angular.copy(e),t.model.page=0},t.filterProcessInstances=function(o){t.model.filter.loading=!0,o.appDefinitionId=t.appDefinitionId,o.page&&0!==o.page||(t.model.processInstances=[]),p.filterProcesses(o).then(function(o){var n=o.data;if(o.start>0)for(var r=0;n.length>r;r++)t.model.processInstances.push(n[r]);else t.model.processInstances=n,0===n.length?(t.state={noProcesses:!0},t.selectedProcessInstance=void 0,t.startForm={}):(t.state={noProcesses:!1},t.selectedProcessInstance=n[0],t.startForm={});t.model.hasNextPage=o.start+o.size<o.total,t.model.filter.loading=!1,e.window.forceRefresh=!0})},t.collapseFilter=function(e){t.model.filter.expanded=!1,t.model.filter.editName=!1,t.resetFilter(e)},t.resetFilter=function(e){t.model.page=0,t.model.filter.edit=angular.copy(t.model.filter.selected),t.model.filter.modified&&!e&&t.filterProcessInstances({page:0,filter:t.model.filter.edit.filter}),t.model.filter.modified=!1},t.filterChanged=function(){t.model.page=0,t.filterProcessInstances({page:0,filter:t.model.filter.edit.filter}),t.model.filter.modified=!0,(t.model.filter.processId||"process-create"===t.model.mode)&&t.backToList()},t.editFilter=function(){t.model.filter.expanded=!0},t.createNewFilter=function(){var e={icon:"glyphicon-filter"};e.filter=angular.copy(t.model.filter.edit.filter),t.model.filter.edit=e,t.model.filter.expanded=!0,(t.model.filter.processId||"process-create"===t.model.mode)&&t.backToList(t.model.filter.processId||"process-create"===t.model.mode)},t.saveFilter=function(e){e.id?t.updateFilter(e):t.createFilter(e),t.model.filter.modified=!1},t.createFilter=function(e){var o={name:e.name,filter:e.filter,appId:t.appDefinitionId};o.icon=e.icon||"glyphicon-filter",p.createProcessInstanceFilter(o).then(function(e){t.selectFilter(e)})},t.updateFilter=function(e){p.updateProcessInstanceFilter(e.id,e).then(function(e){t.selectFilter(e)})},t.deleteFilter=function(e){p.deleteProcessInstanceFilter(e).then(function(){0===t.model.filters.length?h(!0):t.selectFilter(p.getRecentProcessInstanceFilter(t.appDefinitionId))})},t.refreshFilter=function(){t.filterProcessInstances({page:t.model.page,filter:t.model.filter.edit.filter})},"process-create"===t.model.mode?g(!1):t.model.filter.processId?(g(!1),v(t.model.filter.processId)):g(!0),t.toggleChangeName=function(){t.model.filter.editName||(t.model.filter.previousName=t.model.filter.edit.name),t.model.filter.editName=!t.model.filter.editName,t.model.filterIconsFooter.expanded=!1},t.toggleChangeIcon=function(e){t.model[e].expanded||t.icons||(t.icons=p.getFilterIcons(),t.currentIconPage=1,t.iconPageSize=35),t.model[e].expanded=!t.model[e].expanded,t.model.filter.editName=!1
},t.selectIcon=function(e){t.model.filter.edit.icon=e,t.model.filterIconsHeader.expanded=!1,t.model.filterIconsFooter.expanded=!1},t.orderFilterlist=function(e){t.model.filters.splice(e,1),p.checkProcessInstanceFiltersOrder(t.appDefinitionId)}}]),angular.module("activitiApp").controller("ProcessController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","AppDefinitionService","NavigationService",function(e,t,o,n,r,i,a,s,l,c){e.setMainPageById("processes"),t.startForm={},t.selectedProcessInstance={id:s.processId},t.appDefinitionId=s.appDefinitionId||l.getIntegrationAppDefinitionId(),t.$on("processinstance-deleted",function(){t.openProcesses()}),t.openProcesses=function(){c.openProcessPage()}}]),angular.module("activitiApp").controller("ProcessDetailController",["$rootScope","$scope","$translate","$http","$timeout","$location","$route","$modal","$routeParams","$popover","appResourceRoot","TaskService","CommentService","RelatedContentService","EventTrackingService","ProcessService","NavigationService",function(e,t,o,n,r,i,a,s,l,c,d,u,p,m,f,v,g){t.model={page:0,taskPage:0,processInstance:t.selectedProcessInstance,showingForm:!1,showingDecisionTable:!1,decisionTableAudit:{}},t.$watch("selectedProcessInstance",function(e){e&&e.id?(t.model.processUpdating=!0,t.model.processInstance=e,t.model.showingForm=!1,t.model.showingDecisionTable=!1,t.noSuchProcess=!1,t.getProcessInstance(e.id)):(t.model.processInstance=void 0,t.model.showingForm=!1,t.model.showingDecisionTable=!1)}),t.getProcessInstance=function(e){v.getProcess(e).then(function(e){t.model.processInstance?angular.extend(t.model.processInstance,e):t.model.processInstance=e,t.loadProcessTasks(),t.loadComments(),t.loadContent()},function(){t.noSuchProcess=!0})},t.nextPage=function(){t.loadCompletedProcessTasks(!0)},t.nextTaskPage=function(){t.loadActiveProcessTasks(!0)},t.loadProcessTasks=function(){t.model.taskPage=0,t.loadActiveProcessTasks(!1),t.model.page=0,t.loadCompletedProcessTasks(!1),v.getHistoricProcessInstanceDecisionTasks(t.model.processInstance.id,!1).then(function(e){t.model.completedDecisionTasks=e})},t.loadActiveProcessTasks=function(e){e?t.model.taskPage+=1:t.model.taskPage=0,u.getProcessInstanceTasks(t.model.processInstance.id,!1,t.model.taskPage).then(function(e){if(0===e.start)t.model.processTasks=e.data;else for(var o=0;e.data.length>o;o++)t.model.processTasks.push(e.data[o]);t.model.hasNextTaskPage=e.start+e.size<e.total})},t.loadCompletedProcessTasks=function(e){e?t.model.page+=1:t.model.page=0,u.getProcessInstanceTasks(t.model.processInstance.id,!0,t.model.page).then(function(e){if(0===e.start)t.model.completedProcessTasks=e.data&&e.data.length>0?e.data:[];else for(var o=0;e.data.length>o;o++)t.model.completedProcessTasks.push(e.data[o]);t.model.hasNextPage=e.start+e.size<e.total;for(var n=0;e.data.length>n;n++){var r=e.data[n];r.duration&&(r.duration=moment.duration(r.duration).humanize())}})},t.toggleCreateComment=function(){t.model.addComment=!t.model.addComment,t.model.addComment&&r(function(){angular.element(".focusable").focus()},100)},t.cancelProcess=function(e){if(t.model.processInstance){var o=_internalCreateModal({template:d+"views/modal/process-cancel.html",scope:t,show:!0},s,t);e&&(o.$scope.finalDelete=!0)}},t.deleteProcess=function(){t.cancelProcess(!0)},t.$on("processinstance-deleted",function(){a.reload()}),t.openTask=function(e){g.openTaskPage(e.id)},t.openStartForm=function(){t.startForm.processInstanceId=t.model.processInstance.id},t.openDecisionTableAudit=function(e){t.model.showingDecisionTable=!0,t.model.decisionTableAudit.id=e.id,t.model.decisionTableAudit.activityId=e.activityId,t.model.decisionTableAudit.executionId=e.executionId,t.model.decisionTableAudit.decisionKey=e.decisionKey},t.popupShown=function(){},t.closeDiagramPopup=function(){jQuery(".qtip").qtip("destroy",!0)},t.loadComments=function(){p.getProcessInstanceComments(t.model.processInstance.id).then(function(e){t.model.comments=e})},t.loadContent=function(){m.getProcessContent(t.model.processInstance.id).then(function(e){t.model.content=e})},t.confirmNewComment=function(){t.model.commentLoading=!0,p.createProcessInstanceComment(t.model.processInstance.id,t.model.newComment.trim()).then(function(){t.model.newComment=void 0,t.model.commentLoading=!1,e.addAlertPromise(o("PROCESS.ALERT.COMMENT-ADDED")),t.toggleCreateComment(),t.loadComments()})},t.showDiagram=function(){_internalCreateModal({template:d+"views/modal/process-instance-graphical.html",scope:t,show:!0},s,t),f.trackEvent("workflow","processinstance-show-diagram")},t.returnToProcessList=function(){l.processId?g.openProcessPage():t.reloadProcessList()}}]),angular.module("activitiApp").controller("ShowProcessDiagramCtrl",["$scope","$timeout","ResourceService","appResourceRoot",function(e,t,o,n){t(function(){jQuery("#bpmnModel").attr("data-model-id",e.model.processInstance.id),jQuery("#bpmnModel").attr("data-model-type","runtime"),jQuery("#bpmnModel").attr("message-container");var t=n+"../display/displaymodel.html?version="+Date.now(),r=window.define;window.define=void 0,o.loadFromHtml(t,function(){window.define=r})},100)}]),angular.module("activitiApp").controller("CancelProcessCtrl",["$scope","$http","$route","EventTrackingService","ProcessService",function(e,t,o,n,r){e.popup={loading:!1},e.ok=function(){e.popup.loading=!0,r.deleteProcess(e.model.processInstance.id).then(function(){e.$hide(),n.trackEvent("workflow","processinstance-cancel")}).finally(function(){e.popup.loading=!1})},e.cancel=function(){e.$hide()}}]),angular.module("activitiApp").controller("RenderFormController",["$rootScope","$scope","$http","$translate","$modal","appResourceRoot","FormService","RelatedContentService","$sce","$timeout","TaskService","FormUtilService","hotkeys","uiGridConstants","$filter",function($rootScope,$scope,$http,$translate,$modal,appResourceRoot,FormService,RelatedContentService,$sce,$timeout,TaskService,FormUtilService,hotkeys,uiGridConstants,$filter){function focusFormElement(e,t){e&&null!=e&&(e="radio-buttons"==e.type?angular.element("#activiti-"+e.id+">div>label>input:nth-child(1)"):angular.element("#activiti-"+e.id),e[0]&&(typeOf("HTMLLIElement",e[0])?t.preventDefault():(e[0].focus(),t.preventDefault())))}function typeOf(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"}function initModel(){$scope.model={loading:!1,valid:!1,uploads:{},collapsedGroups:{},completeButtonDisabled:!1,saveButtonDisabled:!1,uploadInProgress:!1,isTaskForm:!1,customFieldListeners:[]},$scope.restData={restValues:{}}}function filterAndSortElements(e){for(var t=3,o=[],n=0;e.length>n;n++)o.push(e[n]);return o=o.filter(function(e){return!(!e.isVisible||"people"===e.type||"functional-group"===e.type||"readonly-text"===e.type||"upload"===e.type||"readonly"===e.type||"container"===e.type||"dynamic-table"===e.type||"group"===e.type)}),o=o.sort(function(e,o){var n=angular.element("#activiti-"+e.id),r=angular.element("#activiti-"+o.id),i=999999,a=999999,s=999999,l=999999;if(n&&n.length>0){var c=n[0].getBoundingClientRect();i=c.left,a=c.top}if(r&&r.length>0){var d=r[0].getBoundingClientRect();s=d.left,l=d.top}return t>Math.abs(a-l)?i===s?0:(i-s)/Math.abs(i-s):(a-l)/Math.abs(a-l)})}function processRestUrlValues(e,t){if($scope.restData.restValues[e.id]=t,e.value&&t&&t.length)for(var o=0;t.length>o;o++)if(t[o].id===e.value){e.value=t[o];break}if($scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)$scope.model.customFieldListeners[o].formFieldRestValuesSet&&$scope.model.customFieldListeners[o].formFieldRestValuesSet($scope.formData,e,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldRestValuesSet!==void 0&&ALFRESCO.formExtensions.formFieldRestValuesSet($scope.formData,e,$scope),$scope.customJavascriptEvents.formFieldRestValuesSet&&$scope.customJavascriptEvents.formFieldRestValuesSet($scope.formData,e,$scope),$scope.validateField()}function _prepareFormField(e){var t=angular.copy(e);if($scope.formData.customFieldsValueInfo[t.type]){var o=$scope.formData.customFieldsValueInfo[t.type].value;if(t.type=$scope.formData.customFieldsValueInfo[t.type].type,"number"===t.type&&(t.type="integer"),o.indexOf(".")>0){var n=o.split("."),r=t[n[0]];if(r)for(var i=1;n.length>i;i++){if(!r){r=void 0;break}r=r[n[i]]}t.value=r}else t.value=t[o]}return t}hotkeys.bindTo($scope).add({combo:"tab",description:"forward tab navigation",allowIn:["INPUT","SELECT","TEXTAREA"],callback:function(e){var t=$scope.detectCurrentFormElement(e.target);if(!t||"amount"!==t.type){var o=e.target.closest("[ng-controller]");if(o&&o.dataset.customFocus){for(var n,r=o.querySelectorAll("[tabindex]"),i=0;r.length>i;i++)if(r[i]===e.target){n=r[i+1];break}if(n)return n.focus(),e.preventDefault(),void 0;t=angular.element(e.target).scope().field}var a=$scope.getNextTabFormElement(t);focusFormElement(a,e)}}}).add({combo:"shift+tab",description:"Backward tab navigation",allowIn:["INPUT","SELECT","TEXTAREA"],callback:function(e){var t=$scope.detectCurrentFormElement(e.target),o=e.target.closest("[ng-controller]");if(o&&o.dataset.customFocus){for(var n,r=o.querySelectorAll("[tabindex]"),i=r.length;i>=0;i--)if(r[i]===e.target){n=r[i-1];break}if(n)return n.focus(),e.preventDefault(),void 0;t=angular.element(e.target).scope().field}var a=$scope.getPrevTabFormElement(t);if(a){var s=document.getElementById("activiti-"+a.id);if(s){var l=s.closest("[ng-controller]");if(l&&l.dataset.customFocus){var c,d=o.querySelectorAll("[tabindex]");if(d.length>0&&(c=d[d.length-1]),c)return c.focus(),e.preventDefault(),void 0}}if("amount"===a.type&&a.enableFractions){var u=angular.element("#activiti-"+a.id+"_fractions");if(u.length>0)return u[0].focus(),e.preventDefault(),void 0}focusFormElement(a,e)}}}),initModel(),$scope.registerCustomFieldListener=function(e){$scope.model.customFieldListeners.push(e)},$scope.removeCustomFieldListener=function(e){var t=$scope.model.customFieldListeners.indexOf(e);$scope.model.customFieldListeners.splice(t,1)},$scope.detectCurrentFormElement=function(e){var t=e.id;typeOf("HTMLInputElement",e)&&"radio"==e.type&&(t="activiti-"+e.name);var o=$scope.allFormFields,n=0,r=null;for(n=0;o.length>n&&null==r;n++)null==r&&"activiti-"+o[n].id==t&&(r=o[n]);return r},$scope.getNextTabFormElement=function(e){var t=null;if(e&&null!=e){var o=$scope.allFormFields,n=filterAndSortElements(o),r=0,i=-1;for(r=0;n.length>r&&-1==i;r++)n[r].id==e.id&&(i=r);if(i>=0&&n.length>i)for(;n.length-1>i&&null==t;)t=n[++i]}return t},$scope.getPrevTabFormElement=function(e){var t=null;if(e&&null!=e){var o=$scope.allFormFields,n=filterAndSortElements(o),r=0,i=-1;for(r=0;n.length>r&&-1==i;r++)n[r].id==e.id&&(i=r);if(i>0)for(;i>0&&null==t;)t=n[--i]}return t},$scope.isEmpty=function(e){return void 0===e.value||null==e.value||0==e.value.length},$scope.isEmptyRadio=function(e){if("rest"===e.optionType){if($scope.restData.restValues&&$scope.restData.restValues[e.id]&&$scope.restData.restValues[e.id].length>0)for(var t=$scope.restData.restValues[e.id],o=0;t.length>o;o++)if(t[o].id===e.value.id)return!1;return!0}if(null!==e.hasEmptyValue&&void 0!==e.hasEmptyValue&&e.hasEmptyValue===!0&&null!==e.options&&void 0!==e.options&&e.options.length>0){var n=e.options[0];if(n===e.value)return!0}var r=void 0;void 0!=e.value&&(void 0!=e.value.id?r="name":void 0!=e.value.id&&(r="id"));for(var t=e.options,o=0;t.length>o;o++)if(void 0!=r){if(t[o][r]==e.value[r])return!1}else if(t[o].name===e.value)return!1;return!0},$scope.isEmptyDropdown=function(e){if("rest"===e.optionType){if($scope.restData.restValues&&$scope.restData.restValues[e.id]&&$scope.restData.restValues[e.id].length>0)for(var t=$scope.restData.restValues[e.id],o=0;t.length>o;o++)if(t[o].id===e.value.id)return!1;return!0}if(null!==e.hasEmptyValue&&void 0!==e.hasEmptyValue&&e.hasEmptyValue===!0){if(null!==e.options&&void 0!==e.options&&e.options.length>0){var n=e.options[0];if(n===e.value)return!0}}else if(""===e.value)return!0;return!1},$scope.appResourceRoot=appResourceRoot,$scope.showContentDetails=function(e,t){var o=_internalCreateModal({template:appResourceRoot+"views/modal/content-details.html",show:!0},$modal,$scope),n=t&&t.params&&t.params.documentsEditable;o.$scope.content=e,o.$scope.readOnly=!0,o.$scope.editable=n},$scope.model.outcomesOnly=null!==$scope.outcomesOnly&&void 0!==$scope.outcomesOnly&&($scope.outcomesOnly===!0||"true"===$scope.outcomesOnly),$scope.customJavascriptEvents={},$scope.clearDate=function(e,t){e.value="",t&&t(e.value),jQuery("#"+$rootScope.activitiFieldIdPrefix+e.id).blur()},$scope.selectToday=function(e,t){var o=new Date;e.value=o.toJSON().split("T")[0]+"T00:00:00.000Z",t&&t(o),jQuery("#"+$rootScope.activitiFieldIdPrefix+e.id).blur()},$scope.closeDatePopup=function(e){jQuery("#"+$rootScope.activitiFieldIdPrefix+e.id).blur()},$scope.invokeRestUrl=function(e){$scope.restData.restValues[e.id]=[],$scope.taskId?FormService.getTaskFormFieldValues($scope.taskId,e.id).then(function(t){processRestUrlValues(e,t)}):$scope.processDefinitionId?FormService.getStartFormFieldValues($scope.processDefinitionId,e.id).then(function(t){processRestUrlValues(e,t)}):$scope.processInstanceId&&$http({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+$scope.processInstanceId}).success(function(t){t&&FormService.getStartFormFieldValues(t.processDefinitionId,e.id).then(function(t){processRestUrlValues(e,t)})})},$scope.evaluateAllItemVisibilityConditions=function(){var e=$scope.allFormFields;if(e)for(var t=0;e.length>t;t++)e[t].isVisible=e[t].visibilityCondition&&(e[t].visibilityCondition.leftFormFieldId||e[t].visibilityCondition.leftRestResponseId)?$scope.setItemVisibility(e[t].visibilityCondition):!0;var o=$scope.formData.tabs;if(o){for(var n=0;o.length>n;n++)o[n].isVisible=o[n].visibilityCondition&&(o[n].visibilityCondition.leftFormFieldId||o[n].visibilityCondition.leftRestResponseId)?$scope.setItemVisibility(o[n].visibilityCondition):!0;if($scope.activeFormTab&&$scope.activeFormTab.isVisible===!1)for(var n=0;o.length>n;n++)if(o[n].isVisible){$scope.activeFormTab=o[n];break}}},$scope.combineFormVariables=function(e){for(var t=$scope.allFormFields,o=[],n=0;t.length>n;n++)"readonly-text"!==t[n].type&&"group"!==t[n].type&&"dynamic-table"!==t[n].type&&o.push(t[n]);$scope.currentAndHistoricFormFields=e&&e.length>0?e.concat(o):o},$scope.setItemVisibility=function(visibilityCondition){if(visibilityCondition){for(var conditionResults=[];visibilityCondition;)conditionResults.push($scope.evaluateItemCondition(visibilityCondition)),conditionResults.push(visibilityCondition.nextConditionOperator),visibilityCondition=visibilityCondition.nextCondition;for(var expression="",i=0;conditionResults.length>i;i++){var conditionResult=conditionResults[i];0==i||0==i%2?expression+=conditionResult:"and"===conditionResult?expression+=" && ":"and-not"===conditionResult?expression+=" && !":"or"===conditionResult?expression+=" || ":"or-not"===conditionResult&&(expression+=" || !")}return eval(expression)}return!0},$scope.findPreviousVisibleField=function(e,t){if(e.previousField&&e.previousField.length>0){var o=$scope.findFormFieldWithId($scope.allFormFields,e.previousField);return o?o.isVisible?t.sameRowAsField&&t.sameRowAsField==o.id?o.row+(o.sizeY-1):o.row+1+(o.sizeY-1):$scope.findPreviousVisibleField(o,t):0}return 0},$scope.evaluateItemCondition=function(e){function t(e){if(e.constructor===Date)return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.valueOf();var t=e.split("T")[0],o=t.split("-"),n=new Date;return n.setFullYear(parseInt(o[0])),n.setMonth(parseInt(o[1])-1),n.setDate(parseInt(o[2])),n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),n.valueOf()}var o=!1;if(e&&(e.leftFormFieldId||e.leftRestResponseId)){var n;if(e.leftFormFieldId){var r=$scope.findFormFieldWithId($scope.currentAndHistoricFormFields,e.leftFormFieldId);if(!r)return e.operator&&"empty"===e.operator?!0:!1;var i=_prepareFormField(r);if("dropdown"===i.type||"radio-buttons"===i.type||"typeahead"===i.type||i&&i.params&&i.params.field&&"dropdown"===i.params.field.type||i&&i.params&&i.params.field&&"radio-buttons"===i.params.field.type||i&&i.params&&i.params.field&&"typeahead"===i.params.field.type){if(!i.value)return!1;n=-1!==e.leftFormFieldId.indexOf("_LABEL",e.leftFormFieldId-"_LABEL".length)?i.value.name:i.value.id?i.value.id:i.value}else"boolean"===i.type||i&&i.params&&i.params.field&&"boolean"===i.params.field.type?(n=i.value,(null===n||void 0===n||""===n)&&(n=!1)):n=i.value}else{if(!e.leftRestResponseId)return!0;var a=$scope.findFormFieldWithId($scope.currentAndHistoricFormFields,e.leftRestResponseId);if(!a)return e.operator&&"empty"===e.operator?!0:!1;n=a.value}var s;if(e.rightValue&&""!=e.rightValue||0===e.rightValue)s=e.rightValue;else if(e.rightFormFieldId){var l=$scope.findFormFieldWithId($scope.currentAndHistoricFormFields,e.rightFormFieldId);if(!l)return!1;var c=_prepareFormField(l);if("dropdown"===c.type||"radio-buttons"===c.type||"typeahead"===c.type||c&&c.params&&c.params.field&&"dropdown"===c.params.field.type||c&&c.params&&c.params.field&&"radio-buttons"===c.params.field.type||c&&c.params&&c.params.field&&"typeahead"===c.params.field.type){if(!c.value)return!1;s=-1!==e.rightFormFieldId.indexOf("_LABEL",e.rightFormFieldId-"_LABEL".length)?c.value.name:c.value.id?c.value.id:c.value}else"boolean"===c.type||c&&c.params&&c.params.field&&"boolean"===c.params.field.type?(s=c.value,s=null===s||void 0===s||""===s?!1:c.value):s=c.value}else{if(!e.rightRestResponseId){if(e.operator){if("empty"===e.operator)return!(n&&""!==n);if("!empty"===e.operator)return!(!n||""===n)}return!0}var d=$scope.findFormFieldWithId($scope.currentAndHistoricFormFields,e.rightRestResponseId);if(!d)return!1;s=d.value}if(i&&"boolean"===i.type||i&&i.params&&i.params.field&&"boolean"===i.params.field.type||a&&"boolean"===a.type){(null===n||void 0===n)&&(n=!1);var u=function(e){return e?"TRUE"===e||"true"===e||e===!0?!0:"FALSE"===e||"false"===e||e===!1?!1:null:!1};n=u(n),s=u(s),n=n?"true":"false",s=s?"true":"false"}if(i&&"date"===i.type||i&&i.params&&i.params.field&&"date"===i.params.field.type||a&&"date"===a.type||c&&"date"===c.type||c&&c.params&&c.params.field&&"date"===c.params.field.type||d&&"date"===d.type){if(!n||0==n.length||!s||0==s.length)return!1;try{n=t(n),s=t(s)}catch(p){return!1}}var m=!1;if(i&&"integer"===i.type||i&&i.params&&i.params.field&&"integer"===i.params.field.type||a&&"integer"===a.type||c&&"integer"===c.type||c&&c.params&&c.params.field&&"integer"===c.params.field.type||d&&"integer"===d.type){m=!0;try{n=parseInt(n),s=parseInt(s)}catch(p){return!1}}if(i&&"amount"===i.type||i&&i.params&&i.params.field&&"amount"===i.params.field.type||a&&"amount"===a.type||c&&"amount"===c.type||c&&c.params&&c.params.field&&"amount"===c.params.field.type||d&&"amount"===d.type){m=!0;try{n=parseFloat(n),s=parseFloat(s)}catch(p){return!1}}var f=e.operator;return f&&("=="===f?o=m?_valueIsNaN(n)&&_valueIsNaN(s)?!0:_valueIsNaN(n)&&""===s||""===n&&_valueIsNaN(s)?!0:n===s:n===s:"!="===f?o=m?_valueIsNaN(n)&&_valueIsNaN(s)===!1||_valueIsNaN(n)===!1&&_valueIsNaN(s)?!0:_valueIsNaN(n)&&_valueIsNaN(s)?!1:n!==s:n!==s:"<"===f?o=s>n:"<="===f?o=s>=n:">"===f?o=n>s:">="===f&&(o=n>=s)),o}return!0};var _valueIsNaN=function(e){return e!==e};$scope.findFormFieldWithId=function(e,t){if(t.indexOf(".")>0)for(var o=t.split("."),n=o[0],r=o[1],i=0;e.length>i;i++)if(e[i].id===n&&"data-model-type"===e[i].type)return{value:e[i].value.entity[r]};if(t){var a=$scope.formData.variables||[],s=a.filter(function(e){return e.name===t});if(s.length>0)return s[0]}if(e&&e.length>0){var l,c=!1;-1!==t.indexOf("_LABEL",t-"_LABEL".length)?(c=!0,l=t.substr(0,t.length-"_LABEL".length)):l=t;for(var i=0;e.length>i;i++)if(e[i].id===l&&e[i].hasOwnProperty("isVisible")){if(c&&e[i].value&&e[i].value.name)return e[i];if(!c)return e[i]}for(var i=0;e.length>i;i++)if(e[i].id===t)return e[i]}return void 0},$scope.openRowEditor=function(e,t,o){$rootScope.currentField=t,$scope.dynamicTableReadOnly=o,$rootScope.selectedRow=e?e.entity:$scope["selectedRow"+t.id],$scope.showRowEditor(t)},$scope.showRowEditor=function(e){$rootScope.currentField=e,$scope.tableRowEditModal=_internalCreateModal({template:appResourceRoot+"views/templates/dynamic-table-row-edit-template.html?version="+Date.now(),scope:$scope,backdrop:"static"},$modal,$scope)},$scope.preProcessFields=function(e,t){for(var o=0;e.length>o;o++){var n=e[o];if(n.visibilityCondition||(n.isVisible=!0),"amount"===n.type||n.params&&n.params.field&&"amount"===n.params.field.type){if(n.numberValue="",n.fractionsValue="",n.value!==void 0&&null!==n.value&&""!==n.value){var r=n.value+"",i=r.split(".");n.numberValue=i[0],(n.enableFractions||n.params&&n.params.field&&n.params.field.enableFractions)&&(n.fractionsValue=i[1]||"00",1===n.fractionsValue.length&&(n.fractionsValue+="0")),"string"==typeof n.value&&(n.value=parseFloat(n.value))}}else if("group"==n.type&&n.params&&n.params.allowCollapse)$scope.model.collapsedGroups[n.id]=n.params.collapseByDefault;else if("typeahead"==n.type||("dropdown"==n.type||"radio-buttons"==n.type)&&"rest"==n.optionType&&(n.restUrl||n.endpoint))$scope.invokeRestUrl(n);else if(("dropdown"==n.type||"radio-buttons"==n.type)&&"rest"!=n.optionType&&n.value&&n.options)for(var a=0;n.options.length>a;a++){if(n.options[a].id&&n.options[a].id===n.value){n.value=n.options[a];break}if(n.options[a].name===n.value){n.value=n.options[a];break}}else if("upload"==n.type&&n.value)if($scope.model.uploads[n.id]=[],Array.isArray(n.value)){for(var s="",a=0;n.value.length>a;a++)$scope.model.uploads[n.id].push(n.value[a]),s.length>0&&(s+=","),s+=n.value[a].id;n.value=s}else t&&t.model&&t.model.uploads&&t.model.uploads[n.id]&&($scope.model.uploads[n.id]=t.model.uploads[n.id]);else if("select-folder"==n.type)n.value&&($scope.model.folder[n.id]=n.value,t&&t.model&&t.model.folder&&t.model.folder[n.id]&&($scope.model.folder[n.id]=t.model.folder[n.id]));else if("readonly"==n.type&&n.params&&n.params.field)if("upload"==n.params.field.type){if(n.value&&n.value.length>0)for(var a=0;n.value.length>a;a++)RelatedContentService.addUrlToContent(n.value[a])}else"dynamic-table"==n.params.field.type&&(n.params.tableEditable?$scope.addTable(n,!1):$scope.addTable(n,!0));else if("readonly-text"==n.type&&n.params&&n.params.placeholders){for(var a=0;n.params.placeholders.length>a;a++){var l=n.params.placeholders[a];if("date"==l.type)n.value=n.value.replace(l.placeholder,new moment(l.value).format($scope.formData.globalDateFormat));else if("upload"==l.type){for(var c="",d=0;l.value.length>d;d++){var u=l.value[d];RelatedContentService.addUrlToContent(u),RelatedContentService.checkRenditions(u),0!=d&&(c+=", "),c=c+'<a id="content-'+u.id+'">'+u.name+"</a>"}n.value&&(n.value=n.value.replace(l.placeholder,c))}}n.value&&(n.value=$sce.trustAsHtml(n.value))}else"dynamic-table"===n.type&&n.columnDefinitions?$scope.addTable(n,!1):"readonly-text"==n.type&&angular.isString(n.value)&&(n.value=n.value.replace(/\n/g,"<br/>"))}};var prepareFormFields=function(e){if($scope.allFormFields=FormUtilService.flattenFields(e.fields),$scope.restData.restValues={},$scope.outcomesOnly)for(var t=0;$scope.allFormFields.length>t;t++){var o=$scope.allFormFields[t];("typeahead"==o.type||("dropdown"==o.type||"radio-buttons"==o.type)&&"rest"==o.optionType&&(o.restUrl||o.endpoint))&&$scope.invokeRestUrl(o)}else $scope.preProcessFields($scope.allFormFields,e)};$scope.moveRows=function(e,t,o){for(var n=0;e.length>n;n++)e[n].layout&&e[n].layout.row>t&&(e[n].layout.row=e[n].layout.row+o)},$scope.validateField=function(){function e(e,t,o){var n=!1;if(e&&e.length>0)for(var r=0;e.length>r;r++)if(e[r][t]===o){n=!0;break}return n}function t(e,t,o){var n=void 0;if(e&&e.length>0)for(var r=0;e.length>r;r++)if(e[r][t]===o){n=e[r];break}return n}if((void 0==$scope.hideButtons||!$scope.hideButtons)&&$scope.allFormFields){for(var o=!0,n=0;$scope.allFormFields.length>n;n++){var r=$scope.allFormFields[n];if(r.isRequiredAndVisible=function(){return this?this.isVisible&&this.required:void 0},r){if(r.isRequiredAndVisible()){switch(r.type){case"boolean":(void 0===r.value||0==r.value||null==r.value)&&(o=!1);break;case"radio-buttons":var i=[];if(i="rest"===r.optionType?$scope.restData.restValues[r.id]:r.options,void 0===r.value||""==r.value||null==r.value)o=!1;else if(r.value.name){var a=e(i,"name",r.value.name);a===!1&&(o=!1)}else if(r.value){var a=e(i,"name",r.value);a===!1&&(o=!1)}break;case"dropdown":if("rest"===r.optionType&&$scope.restData.restValues&&$scope.restData.restValues[r.id]&&$scope.restData.restValues[r.id].length>0){for(var s=$scope.restData.restValues[r.id],l=!1,c=0;s.length>c;c++)if(s[c].id===r.value.id){l=!0;break}l||(o=!1)}var d;if(null!==r.hasEmptyValue&&void 0!==r.hasEmptyValue&&r.hasEmptyValue===!0&&null!==r.options&&null!==r.options&&r.options.length>0&&(d=r.options[0]),void 0!==d&&null!==d)if(r.value.name&&r.value.name!==d.name){if(r.value.name&&"rest"!==r.optionType){var a=e(r.options,"name",r.value.name);a===!1&&(o=!1)}}else o=!1;break;case"typeahead":if(void 0===r.value||""===r.value||null===r.value)o=!1;else if(!r.value.id){var u=t($scope.restData.restValues[r.id],"name",r.value);u?r.value=u:o=!1}break;case"text":case"multi-line-text":if(void 0===r.value||""===r.value||null===r.value||0===r.value.length){o=!1;break}if(r.minLength&&!r.value||r.value&&r.value.length<r.minLength){o=!1;break}if(r.regexPattern&&r.value){var p=RegExp("^"+r.regexPattern+"$");if(!p.test||!p.test(r.value)){o=!1;break}}break;case"integer":case"amount":if(void 0===r.value||""===r.value||null===r.value||0===r.value.length){o=!1;break}if(r.minValue&&(""===r.value||null===r.value||0===r.value.length)){o=!1;break}if("undefined"!==r.minValue&&null!==r.value&&0!==r.value.length&&parseFloat(r.value)<parseFloat(r.minValue)){o=!1;break}if(r.maxValue&&null!==r.value&&0!==r.value.length&&parseFloat(r.value)>parseFloat(r.maxValue)){o=!1;break}break;case"date":if(void 0===r.value||""===r.value||null===r.value||0===r.value.length){o=!1;break}if(r.value){var m="DD-MM-YYYY",f=moment(r.value.split("T")[0]);if(!f.isValid()){o=!1;break}if(r.minValue){var v=moment(r.minValue,m);if(f.isBefore(v)){o=!1;break}}if(r.maxValue){var g=moment(r.maxValue,m);if(f.isAfter(g)){o=!1;break}}}break;default:(void 0===r.value||""===r.value||null===r.value||0===r.value.length)&&(o=!1)}if(o===!1)break}else{if("typeahead"===r.type&&void 0!==r.value&&""!==r.value&&null!==r.value&&!r.value.id){var u=t($scope.restData.restValues[r.id],"name",r.value);if(!u){o=!1;break}r.value=u}switch(r.type){case"text":case"multi-line-text":if(r.minLength&&r.value&&r.value.length>0&&r.value.length<r.minLength){o=!1;break}if(r.regexPattern&&r.value){var p=RegExp("^"+r.regexPattern+"$");if(!p.test||!p.test(r.value)){o=!1;break}}break;case"integer":case"amount":if("undefined"!==r.minValue&&"undefined"!==r.value&&null!==r.value&&parseFloat(r.value)<parseFloat(r.minValue)){o=!1;break}if("undefined"!==r.maxValue&&"undefined"!==r.value&&null!==r.value&&parseFloat(r.value)>parseFloat(r.maxValue)){o=!1;break}break;case"date":if(r.value){var m="DD-MM-YYYY",f=moment(r.value.split("T")[0]);if(!f.isValid()){o=!1;break}if(r.minValue){var v=moment(r.minValue,m);if(f.isBefore(v)){o=!1;break}}if(r.maxValue){var g=moment(r.maxValue,m);if(f.isAfter(g)){o=!1;break}}}}}if($scope.model.customFieldListeners.length>0)for(var h=0;$scope.model.customFieldListeners.length>h;h++)if($scope.model.customFieldListeners[h].formValidateField){var I=$scope.model.customFieldListeners[h].formValidateField($scope.formData,r,$scope);if(I===!1){o=I;break}}if("undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formValidateField!==void 0&&o){var I=ALFRESCO.formExtensions.formValidateField($scope.formData,r,$scope);I===!1&&(o=I)}if($scope.customJavascriptEvents.formValidateField&&o){var I=$scope.customJavascriptEvents.formValidateField($scope.formData,r,$scope);I===!1&&(o=I)}if(o===!1)break}}(o===!1||o===!0)&&($scope.model.formCompleteButtonDisabled=!o,$scope.model.formStartButtonDisabled=!o),$scope.model.valid=o}},$scope.addTable=function(e){var t,o=[];if(e.columnDefinitions?t=e.columnDefinitions:e.params&&e.params.field&&e.params.field.columnDefinitions&&(t=e.params.field.columnDefinitions),t)for(var n=0;t.length>n;n++){var r=t[n];if(r.visible)if("Date"===r.type)o.push({field:r.id,displayName:r.name,sortable:r.sortable,cellFilter:"date:'dd-MM-yyyy':'UTC'"});else if("Dropdown"===r.type)o.push({field:r.id+".name",displayName:r.name,sortable:r.sortable});else if("Boolean"===r.type)o.push({field:r.id,displayName:r.name,sortable:r.sortable,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity[col.field] ? "'+$translate.instant("GENERAL.MESSAGE.YES")+'" : "'+$translate.instant("GENERAL.MESSAGE.NO")+'"}}</div>'});else if("Amount"===r.type){var i="amount:"+(r.amountEnableFractions||!1)+':"'+(r.amountCurrency||"$")+'"';o.push({field:r.id,displayName:r.name,sortable:r.sortable,cellFilter:i})}else o.push({field:r.id,displayName:r.name,sortable:r.sortable})}$scope["selectedRow"+e.id]=void 0,e.value||(e.value=[]),$scope["gridOptions"+e.id]={data:e.value,enableRowSelection:!0,headerRowHeight:28,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableColumnMenus:!1,enableSorting:!1,columnDefs:o,enableHorizontalScrollbar:uiGridConstants.scrollbars.NEVER},$scope["gridOptions"+e.id].onRegisterApi=function(t){$scope["gridApi"+e.id]=t,t.selection.on.rowSelectionChanged($scope,function(t){$scope["selectedRow"+e.id]=t.isSelected?t.entity:void 0})}},$scope.getGridOptions=function(e){return $scope[e]},$scope.$watch("formData",function(){$scope.validateField()},!0),$scope.isTableColumnInvalid=function(e,t){var o=!1;if(e&&t){var n=e[t];o=n.$invalid}return o},$scope.processFormDataWithVariables=function(e){$scope.processJavascriptEvents(e),$scope.formData=e,$scope.formData.tabs&&$scope.formData.tabs.length>0&&($scope.activeFormTab=$scope.formData.tabs[0]),prepareFormFields($scope.formData),$scope.model.outcomesOnly!==!0&&($scope.taskId&&$scope.formDefinition.processDefinitionId?TaskService.getProcessInstanceVariables($scope.taskId).then(function(e){$scope.combineFormVariables(e),$scope.evaluateAllItemVisibilityConditions(),$scope.model.loading=!1}):($scope.combineFormVariables(void 0),$scope.evaluateAllItemVisibilityConditions(),$scope.model.loading=!1),$scope.processFormRenderedEvent()),$scope.model.loading=!1},$scope.processFormDataWithProvidedVariables=function(e,t){$scope.processJavascriptEvents(e),$scope.formData=e,$scope.formData.tabs&&$scope.formData.tabs.length>0&&($scope.activeFormTab=$scope.formData.tabs[0]),prepareFormFields($scope.formData),$scope.model.loading=!1,$scope.combineFormVariables(t),$scope.evaluateAllItemVisibilityConditions(),$scope.processFormRenderedEvent()},$scope.processJavascriptEvents=function(e){if($scope.customJavascriptEvents={},e.javascriptEvents&&e.javascriptEvents.length>0)for(var t=0;e.javascriptEvents.length>t;t++){var o=e.javascriptEvents[t].event,n=e.javascriptEvents[t].javascriptLogic;"formRendered"===o?$scope.customJavascriptEvents[o]=Function("form","scope",n):"formFieldValueChanged"===o||"formFieldFocus"===o||"formFieldBlur"===o||"formFieldPersonSelected"===o||"formFieldPersonEmailSelected"===o||"formFieldPersonRemoved"===o||"formFieldGroupSelected"===o||"formFieldGroupRemoved"===o||"formFieldContentUploaded"===o||"formFieldContentRemoved"===o||"formFieldRestValuesSet"===o||"formValidateField"===o||"formValidateFieldValueChanged"===o?$scope.customJavascriptEvents[o]=Function("form","field","scope",n):"formBeforeComplete"===o||"formValidateBeforeSubmit"===o?$scope.customJavascriptEvents[o]=Function("form","outcome","scope",n):"formTableFieldValueChanged"===o||"formTableFieldFocus"===o||"formTableFieldBlur"===o||"formTableFieldRestValuesSet"===o||"formTableRendered"===o||"formTableValidateField"===o||"formTableValidateFieldValueChanged"===o?$scope.customJavascriptEvents[o]=Function("form","field","columnDefinition","editRow","scope",n):"formTableBeforeComplete"===o||"formTableBeforeCancel"===o||"formTableValidateBeforeComplete"===o?$scope.customJavascriptEvents[o]=Function("form","field","editRow","scope",n):"taskCompleted"===o||"taskSaved"===o?$scope.customJavascriptEvents[o]=Function("taskId","form","scope",n):"taskCompletedError"===o||"taskSavedError"===o?$scope.customJavascriptEvents[o]=Function("taskId","errorResponse","form","scope",n):"taskBeforeSaved"===o?$scope.customJavascriptEvents[o]=Function("taskId","form","data","scope",n):"formTabActivated"==o&&($scope.customJavascriptEvents[o]=Function("form","tab","scope",n))
}},$scope.processFormRenderedEvent=function(){$timeout(function(){if($scope.model.customFieldListeners.length>0)for(var e=0;$scope.model.customFieldListeners.length>e;e++)$scope.model.customFieldListeners[e].formRendered&&$scope.model.customFieldListeners[e].formRendered($scope.formData,$scope)}),"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formRendered!==void 0&&$timeout(function(){ALFRESCO.formExtensions.formRendered($scope.formData,$scope)}),$scope.customJavascriptEvents.formRendered&&$timeout(function(){$scope.customJavascriptEvents.formRendered($scope.formData,$scope)})};var fetchAndRenderForm=function(){$scope.model.loading=!0,$scope.activeFormTab=void 0,$scope.formDefinition?$scope.processFormDataWithVariables($scope.formDefinition):$scope.taskId?FormService.getTaskForm($scope.taskId).then(function(e){$scope.processFormDataWithVariables(e)}):$scope.processInstanceId?FormService.getStartFormInstance($scope.processInstanceId).then(function(e){FormService.getHistoricInstanceVariables($scope.processInstanceId).then(function(t){$scope.processFormDataWithProvidedVariables(e,t)})}):$scope.processDefinitionId&&FormService.getStartForm($scope.processDefinitionId).then(function(e){$scope.processFormDataWithProvidedVariables(e,void 0)})};fetchAndRenderForm(),$scope.$watch("processDefinitionId",function(e,t){e!==t&&(initModel(),fetchAndRenderForm())},!0),$scope.$watch("processInstanceId",function(e,t){e!==t&&(initModel(),fetchAndRenderForm())},!0),$scope.getDefaultCompleteButtonText=function(){return $scope.processDefinitionId?$translate.instant("FORM.DEFAULT-OUTCOME.START-PROCESS"):$translate.instant("FORM.DEFAULT-OUTCOME.COMPLETE")},$scope.completeForm=function(e){$scope.model.loading=!0,$scope.model.completeButtonDisabled=!0;var t=!0;if($scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)if($scope.model.customFieldListeners[o].formValidateBeforeSubmit){var n=$scope.model.customFieldListeners[o].formValidateBeforeSubmit($scope.formData,e,$scope);if(void 0!==n&&(t=n),t===!1)break}if("undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formValidateBeforeSubmit!==void 0&&t){var n=ALFRESCO.formExtensions.formValidateBeforeSubmit($scope.formData,e,$scope);void 0!==n&&(t=n)}if($scope.customJavascriptEvents.formValidateBeforeSubmit&&t){var n=$scope.customJavascriptEvents.formValidateBeforeSubmit($scope.formData,e,$scope);void 0!==n&&(t=n)}if(t===!1)return $scope.model.loading=!1,$scope.model.completeButtonDisabled=!1,void 0;if($scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)$scope.model.customFieldListeners[o].formBeforeComplete&&$scope.model.customFieldListeners[o].formBeforeComplete($scope.formData,e,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formBeforeComplete!==void 0&&ALFRESCO.formExtensions.formBeforeComplete($scope.formData,e,$scope),$scope.customJavascriptEvents.formBeforeComplete&&$scope.customJavascriptEvents.formBeforeComplete($scope.formData,e,$scope);var r=$scope.createPostData();e&&(r.outcome=e.name),$scope.processDefinitionId?(r.processDefinitionId=$scope.processDefinitionId,$scope.processName&&(r.name=$scope.processName),FormService.completeStartForm(r).then(function(e){$scope.$emit("process-started",e),$scope.model.completeButtonDisabled=!1,$scope.model.loading=!1},function(e){$scope.model.completeButtonDisabled=!1,$scope.model.loading=!1,$scope.$emit("process-started-error",{processDefinitionId:$scope.processDefinitionId,error:e})})):FormService.completeTaskForm($scope.taskId,r).then(function(){if($scope.$emit("task-completed",{taskId:$scope.taskId}),$scope.model.customFieldListeners.length>0)for(var e=0;$scope.model.customFieldListeners.length>e;e++)$scope.model.customFieldListeners[e].taskCompleted&&$scope.model.customFieldListeners[e].taskCompleted($scope.taskId,$scope.formData,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.taskCompleted!==void 0&&ALFRESCO.formExtensions.taskCompleted($scope.taskId,$scope.formData,$scope),$scope.customJavascriptEvents.taskCompleted&&$scope.customJavascriptEvents.taskCompleted($scope.taskId,$scope.formData,$scope),$scope.model.completeButtonDisabled=!1,$scope.model.loading=!1},function(e){if($scope.model.completeButtonDisabled=!1,$scope.model.loading=!1,$scope.$emit("task-completed-error",{taskId:$scope.taskId,error:e}),$scope.model.customFieldListeners.length>0)for(var t=0;$scope.model.customFieldListeners.length>t;t++)$scope.model.customFieldListeners[t].taskCompletedError&&$scope.model.customFieldListeners[t].taskCompletedError($scope.taskId,e.message,$scope.formData,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.taskCompletedError!==void 0&&ALFRESCO.formExtensions.taskCompletedError($scope.taskId,e.message,$scope.formData,$scope),$scope.customJavascriptEvents.taskCompletedError&&$scope.customJavascriptEvents.taskCompletedError($scope.taskId,e.message,$scope.formData,$scope)})},$scope.saveForm=function(){$scope.model.loading=!0,$scope.model.saveButtonDisabled=!0;var e=$scope.createPostData(),t=!1;if("undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.taskBeforeSaved!==void 0&&(t=ALFRESCO.formExtensions.taskBeforeSaved($scope.taskId,$scope.formData,e,$scope),t===!0))return $scope.model.saveButtonDisabled=!1,$scope.model.loading=!1,void 0;if($scope.customJavascriptEvents.taskBeforeSaved&&(t=$scope.customJavascriptEvents.taskBeforeSaved($scope.taskId,$scope.formData,e,$scope),t===!0))return $scope.model.saveButtonDisabled=!1,$scope.model.loading=!1,void 0;if($scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)if($scope.model.customFieldListeners[o].taskBeforeSaved&&(t=$scope.model.customFieldListeners[o].taskBeforeSaved($scope.taskId,$scope.formData,e,$scope),t===!0))return $scope.model.saveButtonDisabled=!1,$scope.model.loading=!1,void 0;FormService.saveTaskForm($scope.taskId,e).then(function(){if($scope.$emit("task-saved",{taskId:$scope.taskId}),$scope.model.customFieldListeners.length>0)for(var e=0;$scope.model.customFieldListeners.length>e;e++)$scope.model.customFieldListeners[e].taskSaved&&$scope.model.customFieldListeners[e].taskSaved($scope.taskId,$scope.formData,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.taskSaved!==void 0&&ALFRESCO.formExtensions.taskSaved($scope.taskId,$scope.formData,$scope),$scope.customJavascriptEvents.taskSaved&&$scope.customJavascriptEvents.taskSaved($scope.taskId,$scope.formData,$scope),$scope.model.saveButtonDisabled=!1,$scope.model.loading=!1},function(e){if($scope.model.saveButtonDisabled=!1,$scope.model.loading=!1,$scope.$emit("task-save-error",{taskId:$scope.taskId,error:e}),$scope.model.customFieldListeners.length>0)for(var t=0;$scope.model.customFieldListeners.length>t;t++)$scope.model.customFieldListeners[t].taskSavedError&&$scope.model.customFieldListeners[t].taskSavedError($scope.taskId,e.message,$scope.formData,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.taskSavedError!==void 0&&ALFRESCO.formExtensions.taskSavedError($scope.taskId,e.message,$scope.formData,$scope),$scope.customJavascriptEvents.taskSavedError&&$scope.customJavascriptEvents.taskSavedError($scope.taskId,e.message,$scope.formData,$scope)})},$scope.fieldPersonSelected=function(e,t){if(t.value=e,$scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)$scope.model.customFieldListeners[o].formFieldPersonSelected&&$scope.model.customFieldListeners[o].formFieldPersonSelected($scope.formData,t,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldPersonSelected!==void 0&&ALFRESCO.formExtensions.formFieldPersonSelected($scope.formData,t,$scope),$scope.customJavascriptEvents.formFieldPersonSelected&&$scope.customJavascriptEvents.formFieldPersonSelected($scope.formData,t,$scope)},$scope.fieldPersonEmailSelected=function(e,t){if(t.value=e,$scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)$scope.model.customFieldListeners[o].formFieldPersonEmailSelected&&$scope.model.customFieldListeners[o].formFieldPersonEmailSelected($scope.formData,t,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldPersonEmailSelected!==void 0&&ALFRESCO.formExtensions.formFieldPersonEmailSelected($scope.formData,t,$scope),$scope.customJavascriptEvents.formFieldPersonEmailSelected&&$scope.customJavascriptEvents.formFieldPersonEmailSelected($scope.formData,t,$scope)},$scope.fieldPersonRemoved=function(e,t){if(t.value=void 0,$scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)$scope.model.customFieldListeners[o].formFieldPersonRemoved&&$scope.model.customFieldListeners[o].formFieldPersonRemoved($scope.formData,t,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldPersonRemoved!==void 0&&ALFRESCO.formExtensions.formFieldPersonRemoved($scope.formData,t,$scope),$scope.customJavascriptEvents.formFieldPersonRemoved&&$scope.customJavascriptEvents.formFieldPersonRemoved($scope.formData,t,$scope)},$scope.fieldGroupSelected=function(e,t){if(t.value=e,$scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)$scope.model.customFieldListeners[o].formFieldGroupSelected&&$scope.model.customFieldListeners[o].formFieldGroupSelected($scope.formData,t,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldGroupSelected!==void 0&&ALFRESCO.formExtensions.formFieldGroupSelected($scope.formData,t,$scope),$scope.customJavascriptEvents.formFieldGroupSelected&&$scope.customJavascriptEvents.formFieldGroupSelected($scope.formData,t,$scope)},$scope.fieldGroupRemoved=function(e,t){if(t.value=void 0,$scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)$scope.model.customFieldListeners[o].formFieldGroupRemoved&&$scope.model.customFieldListeners[o].formFieldGroupRemoved($scope.formData,t,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldGroupRemoved!==void 0&&ALFRESCO.formExtensions.formFieldGroupRemoved($scope.formData,t,$scope),$scope.customJavascriptEvents.formFieldGroupRemoved&&$scope.customJavascriptEvents.formFieldGroupRemoved($scope.formData,t,$scope)},$scope.contentUploaded=function(e,t){if($scope.model.uploads[t.id]||($scope.model.uploads[t.id]=[]),$scope.model.uploads[t.id].push(e),$scope.updateContentValue(t),$scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)$scope.model.customFieldListeners[o].formFieldContentUploaded&&$scope.model.customFieldListeners[o].formFieldContentUploaded($scope.formData,t,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldContentUploaded!==void 0&&ALFRESCO.formExtensions.formFieldContentUploaded($scope.formData,t,$scope),$scope.customJavascriptEvents.formFieldContentUploaded&&$scope.customJavascriptEvents.formFieldContentUploaded($scope.formData,t,$scope)},$scope.folderSelected=function(e,t){if(t.value=e,$scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)$scope.model.customFieldListeners[o].formFieldFolderSelected&&$scope.model.customFieldListeners[o].formFieldFolderSelected($scope.formData,t,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldContentUploaded!==void 0&&ALFRESCO.formExtensions.formFieldContentUploaded($scope.formData,t,$scope),$scope.customJavascriptEvents.formFieldFolderSelected&&$scope.customJavascriptEvents.formFieldFolderSelected($scope.formData,t,$scope)},$scope.removeContent=function(e,t){if($scope.model.uploads[t.id]){if($scope.model.uploads[t.id]=jQuery.grep($scope.model.uploads[t.id],function(t){return t!==e}),$scope.updateContentValue(t),$scope.model.customFieldListeners.length>0)for(var o=0;$scope.model.customFieldListeners.length>o;o++)$scope.model.customFieldListeners[o].formFieldContentRemoved&&$scope.model.customFieldListeners[o].formFieldContentRemoved($scope.formData,t,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldContentRemoved!==void 0&&ALFRESCO.formExtensions.formFieldContentRemoved($scope.formData,t,$scope),$scope.customJavascriptEvents.formFieldContentRemoved&&$scope.customJavascriptEvents.formFieldContentRemoved($scope.formData,t,$scope)}},$scope.removeFolder=function(e,t){t.value=void 0},$scope.updateContentValue=function(e){if($scope.model.uploads[e.id]){for(var t="",o=0;$scope.model.uploads[e.id].length>o;o++)o>0&&(t+=","),t+=$scope.model.uploads[e.id][o].id;e.value=t}else e.value=void 0},$scope.handleReadonlyClick=function(e,t){if(0==e.target.id.indexOf("content-")){var o,n=e.target.id.substring(8);if(t.params&&t.params.placeholders)for(var r=0;t.params.placeholders.length>r;r++){var i=t.params.placeholders[r];if("upload"==i.type)for(var a=0;i.value.length>a;a++){var s=i.value[a];if(s.id==n){o=s;break}}if(o)break}o&&$scope.showContentDetails(o)}},$scope.onFieldValueChange=function(e){if("amount"===e.type)if(""===e.numberValue||void 0===e.numberValue)e.value=null;else{var t=e.numberValue||"0";e.enableFractions?(t+="."+(e.fractionsValue||"0"),e.value=parseFloat(t)):e.value=parseInt(t)}var o=!0,n=!1;if($scope.model.customFieldListeners.length>0)for(var r=0;$scope.model.customFieldListeners.length>r;r++)if($scope.model.customFieldListeners[r].formValidateFieldValueChanged){var i=$scope.model.customFieldListeners[r].formValidateFieldValueChanged($scope.formData,e,$scope);void 0!==i&&(o=i),n=!0}if("undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formValidateFieldValueChanged!==void 0&&o){var i=ALFRESCO.formExtensions.formValidateFieldValueChanged($scope.formData,e,$scope);void 0!==i&&(o=i),n=!0}if($scope.customJavascriptEvents.formValidateFieldValueChanged&&o){var i=$scope.customJavascriptEvents.formValidateFieldValueChanged($scope.formData,e,$scope);void 0!==i&&(o=i),n=!0}if(n&&(o===!1||o===!0)&&($scope.model.formCompleteButtonDisabled=!o,$scope.model.formStartButtonDisabled=!o),$scope.model.customFieldListeners.length>0)for(var r=0;$scope.model.customFieldListeners.length>r;r++)$scope.model.customFieldListeners[r].formFieldValueChanged&&$scope.model.customFieldListeners[r].formFieldValueChanged($scope.formData,e,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldValueChanged!==void 0&&ALFRESCO.formExtensions.formFieldValueChanged($scope.formData,e,$scope),$scope.customJavascriptEvents.formFieldValueChanged&&$scope.customJavascriptEvents.formFieldValueChanged($scope.formData,e,$scope),$scope.evaluateAllItemVisibilityConditions()},$scope.onFieldFocus=function(e){if($scope.model.customFieldListeners.length>0)for(var t=0;$scope.model.customFieldListeners.length>t;t++)$scope.model.customFieldListeners[t].formFieldFocus&&$scope.model.customFieldListeners[t].formFieldFocus($scope.formData,e,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldFocus!==void 0&&ALFRESCO.formExtensions.formFieldFocus($scope.formData,e,$scope),$scope.customJavascriptEvents.formFieldFocus&&$scope.customJavascriptEvents.formFieldFocus($scope.formData,e,$scope)},$scope.onFieldBlur=function(e){if($scope.model.customFieldListeners.length>0)for(var t=0;$scope.model.customFieldListeners.length>t;t++)$scope.model.customFieldListeners[t].formFieldBlur&&$scope.model.customFieldListeners[t].formFieldBlur($scope.formData,e,$scope);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formFieldBlur!==void 0&&ALFRESCO.formExtensions.formFieldBlur($scope.formData,e,$scope),$scope.customJavascriptEvents.formFieldBlur&&$scope.customJavascriptEvents.formFieldBlur($scope.formData,e,$scope)},$scope.addDynamicTableRow=function(e){delete $rootScope.selectedRow,$scope.showRowEditor(e)},$scope.removeDynamicTableRow=function(e){if($scope["selectedRow"+e.id]){var t=e.value.indexOf($scope["selectedRow"+e.id]);$scope["gridApi"+e.id].selection.toggleRowSelection($scope["selectedRow"+e.id]),e.value.splice(t,1),$timeout(function(){e.value.length>0?$scope["gridApi"+e.id].selection.toggleRowSelection(e.value[0]):$scope["selectedRow"+e.id]=void 0})}},$scope.noRowSelected=function(e){var t=!0;return $scope["selectedRow"+e.id]&&(t=!1),t},$scope.moveDynamicTableRowUp=function(e){if($scope["selectedRow"+e.id]){var t=e.value.indexOf($scope["selectedRow"+e.id]);if(0!=t){var o=e.value[t];e.value.splice(t,1),$scope["gridApi"+e.id].selection.clearSelectedRows(),$timeout(function(){e.value.splice(t+-1,0,o),$timeout(function(){$scope["gridApi"+e.id].selection.toggleRowSelection(o)})})}}},$scope.moveDynamicTableRowDown=function(e){if($scope["selectedRow"+e.id]){var t=e.value.indexOf($scope["selectedRow"+e.id]);if(t!=e.value.length-1){var o=e.value[t];e.value.splice(t,1),$scope["gridApi"+e.id].selection.clearSelectedRows(),$timeout(function(){e.value.splice(t+1,0,o),$timeout(function(){$scope["gridApi"+e.id].selection.toggleRowSelection(o)})})}}},$scope.formTabClicked=function(e){$scope.activeFormTab=e,"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTabActivated!==void 0&&$timeout(function(){ALFRESCO.formExtensions.formTabActivated($scope.formData,e,$scope)}),$scope.customJavascriptEvents.formTabActivated&&$scope.customJavascriptEvents.formTabActivated($scope.formData,e,$scope)},$scope.uploadInProgress=function(e){"undefined"!==e&&($scope.model.uploadInProgress=e)},$scope.createPostData=function(){var e={values:{}};if($scope.allFormFields)for(var t=0;$scope.allFormFields.length>t;t++){var o=$scope.allFormFields[t];if(o&&o.isVisible&&"container"!=o.type&&o&&"readonly-text"!==o.type&&("boolean"===o.type&&null==o.value&&(o.value=!1),"readonly"!==o.type||o.params&&(o.params.tableEditable||o.params.documentsEditable)))if("readonly"===o.type&&o.params&&o.params.documentsEditable){if(o.value&&o.value.length>0){for(var n="",r=0;o.value.length>r;r++)n.length>0&&(n+=","),n+=o.value[r].id;var i=o.id;"readonly"===o.type&&(i=o.params.field.id),e.values[i]=n}}else if("dropdown"===o.type&&null!==o.hasEmptyValue&&void 0!==o.hasEmptyValue&&o.hasEmptyValue===!0||"radio-buttons"===o.type){if("rest"===o.optionType)if(o.value&&o.value.id){if($scope.restData.restValues&&$scope.restData.restValues[o.id]&&$scope.restData.restValues[o.id].length>0)for(var a=$scope.restData.restValues[o.id],s=0;a.length>s;s++)if(a[s].id===o.value.id){e.values[o.id]=o.value;break}}else e.values[o.id]={id:void 0,name:void 0};else if(null!==o.options&&void 0!==o.options&&o.options.length>0)if("dropdown"===o.type){var l=o.options[0];e.values[o.id]=l.name!==o.value.name?o.value:{id:void 0,name:void 0}}else"radio-buttons"===o.type&&(e.values[o.id]=o.value)}else e.values[o.id]="typeahead"===o.type&&"string"==typeof o.value?null:o.value}return e},$scope.getFieldLabelDisplayValue=function(e){if(e&&e.id&&e.params&&e.params.field&&e.params.field.id&&$scope.currentAndHistoricFormFields&&0!==$scope.currentAndHistoricFormFields.length){if(-1===e.params.field.id.indexOf("_LABEL",e.params.field.id-"_LABEL".length))for(var t=e.params.field.id+"_LABEL",o=0;$scope.currentAndHistoricFormFields.length>o;o++)if($scope.currentAndHistoricFormFields[o].id===t){var n=e.value+" ("+$scope.currentAndHistoricFormFields[o].value+")";return n}return e.value}},$scope.getGlobalDateFormat=function(){return $scope.formData.globalDateFormat},$scope.getGlobalAngularDateFormat=function(){var e=$filter("momentToAngularFormat")($scope.formData.globalDateFormat);return e},$scope.controlCallbacks={onFieldValueChange:$scope.onFieldValueChange,onFieldFocus:$scope.onFieldFocus,onFieldBlur:$scope.onFieldBlur,isEmpty:$scope.isEmpty,isEmptyDropdown:$scope.isEmptyDropdown,isEmptyRadio:$scope.isEmptyRadio,fieldPersonSelected:$scope.fieldPersonSelected,fieldPersonEmailSelected:$scope.fieldPersonEmailSelected,fieldPersonRemoved:$scope.fieldPersonRemoved,fieldGroupSelected:$scope.fieldGroupSelected,fieldGroupRemoved:$scope.fieldGroupRemoved,getGridOptions:$scope.getGridOptions,noRowSelected:$scope.noRowSelected,moveDynamicTableRowUp:$scope.moveDynamicTableRowUp,moveDynamicTableRowDown:$scope.moveDynamicTableRowDown,addDynamicTableRow:$scope.addDynamicTableRow,removeDynamicTableRow:$scope.removeDynamicTableRow,openRowEditor:$scope.openRowEditor,removeContent:$scope.removeContent,contentUploaded:$scope.contentUploaded,removeFolder:$scope.removeFolder,folderSelected:$scope.folderSelected,uploadInProgress:$scope.uploadInProgress,handleReadonlyClick:$scope.handleReadonlyClick,clearDate:$scope.clearDate,selectToday:$scope.selectToday,closeDatePopup:$scope.closeDatePopup,registerCustomFieldListener:$scope.registerCustomFieldListener,removeCustomFieldListener:$scope.removeCustomFieldListener,getFieldLabelDisplayValue:$scope.getFieldLabelDisplayValue,getGlobalDateFormat:$scope.getGlobalDateFormat,getGlobalAngularDateFormat:$scope.getGlobalAngularDateFormat},$scope.taskId&&($scope.model.isTaskForm=!0),$scope.shareModel&&($scope.formData.model=$scope.model,$scope.formData.saveForm=$scope.saveForm,$scope.formData.completeForm=$scope.completeForm)}]),angular.module("activitiApp").controller("DynamicTableRowEditController",["$rootScope","$scope","$http","$translate","$modal","$timeout","appResourceRoot",function(e,t,o,n,r,i,a){t.readOnly=e.readOnly,t.popup={model:{valid:!1}};var s={},l=[];t.tableRestValues={},t.tableAmountValues={},t.invokeDynamicTableRestUrl=function(e,n,r){t.tableRestValues[n.id]=[],t.taskId?o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/task-forms/"+t.taskId+"/form-values/"+e.id+"/"+n.id}).success(function(o){if(t.tableRestValues[n.id]=o,r&&o&&o.length)for(var i=0;o.length>i;i++)o[i].id===r&&(t.editRow[n.id]=o[i]);if(t.model.customFieldListeners.length>0)for(var i=0;t.model.customFieldListeners.length>i;i++)t.model.customFieldListeners[i].formTableFieldRestValuesSet&&t.model.customFieldListeners[i].formTableFieldRestValuesSet(t.formData,e,n,t.editRow,t);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableFieldRestValuesSet!==void 0&&ALFRESCO.formExtensions.formTableFieldRestValuesSet(t.formData,e,n,t.editRow,t),t.customJavascriptEvents.formTableFieldRestValuesSet&&t.customJavascriptEvents.formTableFieldRestValuesSet(t.formData,e,n,t.editRow,t)}):t.processDefinitionId&&o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-definitions/"+t.processDefinitionId+"/start-form-values/"+e.id+"/"+n.id}).success(function(o){if(t.tableRestValues[n.id]=o,r&&o&&o.length)for(var i=0;o.length>i;i++)o[i].id===r&&(t.editRow[n.id]=o[i]);if(t.model.customFieldListeners.length>0)for(var i=0;t.model.customFieldListeners.length>i;i++)t.model.customFieldListeners[i].formTableFieldRestValuesSet&&t.model.customFieldListeners[i].formTableFieldRestValuesSet(t.formData,e,n,t.editRow,t);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableFieldRestValuesSet!==void 0&&ALFRESCO.formExtensions.formTableFieldRestValuesSet(t.formData,e,n,t.editRow,t),t.customJavascriptEvents.formTableFieldRestValuesSet&&t.customJavascriptEvents.formTableFieldRestValuesSet(t.formData,e,n,t.editRow,t)})},e.currentField.columnDefinitions?(l=e.currentField.columnDefinitions,t.currentField=e.currentField):e.currentField.params.field.columnDefinitions&&(l=e.currentField.params.field.columnDefinitions,t.currentField=e.currentField.params.field);for(var c=0;l.length>c;c++){var d=l[c].id;if("Dropdown"===l[c].type){var u;if(u=e.selectedRow&&e.selectedRow[d]&&e.selectedRow[d].name?e.selectedRow[d].name:l[c].value,"rest"===l[c].optionType&&(l[c].endpoint&&l[c].endpoint.id||l[c].restUrl)){var p;if(e.selectedRow&&e.selectedRow[d]&&e.selectedRow[d].id&&(p=e.selectedRow[d]),l[c].editable&&!t.dynamicTableReadOnly){var m;p&&p.id&&(m=p.id),t.invokeDynamicTableRestUrl(e.currentField,l[c],m)}else p&&p.name&&(s[d]=p.name)}else if(l[c].options&&l[c].options.length>1&&u){for(var f=0;l[c].options.length>f;f++)if(l[c].options[f].name===u){s[d]=l[c].options[f];break}s[d]||(s[d]=l[c].options[0])}}else if("Amount"===l[c].type){var v=e.selectedRow?e.selectedRow[d]:void 0,g={numberValue:"",fractionsValue:""};if(v!==void 0&&null!==v){var h=v+"",I=h.split(".");g.numberValue=I[0],l[c].amountEnableFractions&&(g.fractionsValue=I[1]||"00",1===g.fractionsValue.length&&(g.fractionsValue+="0")),"string"==typeof v&&(v=parseFloat(v))}t.tableAmountValues[d]=g,s[d]=v}else s[d]=e.selectedRow?e.selectedRow[d]:""}if(t.appResourceRoot=a,t.editRow=s,t.cancelForm=function(o){if(t.model.customFieldListeners.length>0)for(var n=0;t.model.customFieldListeners.length>n;n++)t.model.customFieldListeners[n].formTableBeforeCancel&&t.model.customFieldListeners[n].formTableBeforeCancel(t.formData,e.currentField,t.editRow,t);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableBeforeCancel!==void 0&&ALFRESCO.formExtensions.formTableBeforeCancel(t.formData,e.currentField,t.editRow,t),t.customJavascriptEvents.formTableBeforeCancel&&t.customJavascriptEvents.formTableBeforeCancel(t.formData,e.currentField,t.editRow,t),o.hide()},t.completeForm=function(o){if(t.model.customFieldListeners.length>0)for(var n=0;t.model.customFieldListeners.length>n;n++)if(t.model.customFieldListeners[n].formTableValidateBeforeComplete){var r=t.model.customFieldListeners[n].formTableValidateBeforeComplete(t.formData,e.currentField,t.editRow,t);if(r===!1)return}if("undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableValidateBeforeComplete!==void 0){var r=ALFRESCO.formExtensions.formTableValidateBeforeComplete(t.formData,e.currentField,t.editRow,t);if(r===!1)return}if(t.customJavascriptEvents.formTableValidateBeforeComplete){var r=t.customJavascriptEvents.formTableValidateBeforeComplete(t.formData,e.currentField,t.editRow,t);if(r===!1)return}if(t.model.customFieldListeners.length>0)for(var n=0;t.model.customFieldListeners.length>n;n++)t.model.customFieldListeners[n].formTableBeforeComplete&&t.model.customFieldListeners[n].formTableBeforeComplete(t.formData,e.currentField,t.editRow,t);if("undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableBeforeComplete!==void 0&&ALFRESCO.formExtensions.formTableBeforeComplete(t.formData,e.currentField,t.editRow,t),t.customJavascriptEvents.formTableBeforeComplete&&t.customJavascriptEvents.formTableBeforeComplete(t.formData,e.currentField,t.editRow,t),e.selectedRow){var i=[];e.currentField.columnDefinitions?i=e.currentField.columnDefinitions:e.currentField.params.field.columnDefinitions&&(i=e.currentField.params.field.columnDefinitions);for(var n=0;i.length>n;n++){var a=i[n].id;e.selectedRow[a]=s[a]}}else e.currentField.value||(e.currentField.value=[]),e.currentField.value.push(s);delete t.editRow,o.hide()},t.$watch("editRow",function(){t.validateField()},!0),t.validateField=function(){if(t.editRow){var o=!0,n=[];e.currentField.columnDefinitions?n=e.currentField.columnDefinitions:e.currentField.params.field.columnDefinitions&&(n=e.currentField.params.field.columnDefinitions);for(var r=0;n.length>r;r++){var i=t.editRow[n[r].id];if(n[r].required&&!i){if("Boolean"===n[r].type||"Amount"===n[r].type&&0===i)continue;o=!1;break}if(t.model.customFieldListeners.length>0)for(var a=0;t.model.customFieldListeners.length>a;a++)if(t.model.customFieldListeners[r].formTableValidateField){var s=t.model.customFieldListeners[a].formTableValidateField(t.formData,i,n[r],t.editRow,t);if(s===!1){o=s;break}}if("undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableValidateField!==void 0&&o){var s=ALFRESCO.formExtensions.formTableValidateField(t.formData,i,n[r],t.editRow,t);s===!1&&(o=s)}if(t.customJavascriptEvents.formTableValidateField&&o){var s=t.customJavascriptEvents.formTableValidateField(t.formData,i,n[r],t.editRow,t);s===!1&&(o=s)}if(o===!1)break}t.popup.model.valid=o}},t.clearDateEditRow=function(e,o){t.editRow[e.id]="",o&&o(t.editRow[e.id]),jQuery("#"+e.id).blur()},t.selectTodayEditRow=function(e,o){var n=new Date;t.editRow[e.id]=n.toJSON().split("T")[0]+"T00:00:00.000Z",o&&o(n),jQuery("#"+e.id).blur()},t.closeDatePopupEditRow=function(e){jQuery("#"+e.id).blur()},t.onTableFieldValueChange=function(o){if("Amount"===o.type){var n,r=t.tableAmountValues[o.id];o.amountEnableFractions?(n=r.fractionsValue?(r.numberValue?r.numberValue:"0")+"."+r.fractionsValue:r.numberValue,n&&(n=parseFloat(n))):(n=r.numberValue,n&&(n=parseInt(n))),t.editRow[o.id]=n===n?n:0}var i=!0,a=!1;if(t.model.customFieldListeners.length>0)for(var s=0;t.model.customFieldListeners.length>s;s++)if(t.model.customFieldListeners[s].formTableValidateFieldValueChanged){var l=t.model.customFieldListeners[s].formTableValidateFieldValueChanged(t.formData,e.currentField,o,t.editRow,t);if(void 0!==l&&(i=l),a=!0,0==i)break}if("undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableValidateFieldValueChanged!==void 0&&i){var l=ALFRESCO.formExtensions.formTableValidateFieldValueChanged(t.formData,e.currentField,o,t.editRow,t);void 0!==l&&(i=l),a=!0}if(t.customJavascriptEvents.formTableValidateFieldValueChanged&&i){var l=t.customJavascriptEvents.formTableValidateFieldValueChanged(t.formData,e.currentField,o,t.editRow,t);void 0!==l&&(i=l),a=!0}if(a&&(i===!1||i===!0)&&(t.tableFormCompleteButtonDisabled=!i),t.model.customFieldListeners.length>0)for(var s=0;t.model.customFieldListeners.length>s;s++)t.model.customFieldListeners[s].formTableFieldValueChanged&&t.model.customFieldListeners[s].formTableFieldValueChanged(t.formData,e.currentField,o,t.editRow,t);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableFieldValueChanged!==void 0&&ALFRESCO.formExtensions.formTableFieldValueChanged(t.formData,e.currentField,o,t.editRow,t),t.customJavascriptEvents.formTableFieldValueChanged&&t.customJavascriptEvents.formTableFieldValueChanged(t.formData,e.currentField,o,t.editRow,t)},t.onTableFieldFocus=function(o){if(t.model.customFieldListeners.length>0)for(var n=0;t.model.customFieldListeners.length>n;n++)t.model.customFieldListeners[n].formTableFieldFocus&&t.model.customFieldListeners[n].formTableFieldFocus(t.formData,e.currentField,o,t.editRow,t);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableFieldFocus!==void 0&&ALFRESCO.formExtensions.formTableFieldFocus(t.formData,e.currentField,o,t.editRow,t),t.customJavascriptEvents.formTableFieldFocus&&t.customJavascriptEvents.formTableFieldFocus(t.formData,e.currentField,o,t.editRow,t)},t.onTableFieldBlur=function(o){if(t.model.customFieldListeners.length>0)for(var n=0;t.model.customFieldListeners.length>n;n++)t.model.customFieldListeners[n].formTableFieldBlur&&t.model.customFieldListeners[n].formTableFieldBlur(t.formData,e.currentField,o,t.editRow,t);"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableFieldBlur!==void 0&&ALFRESCO.formExtensions.formTableFieldBlur(t.formData,e.currentField,o,t.editRow,t),t.customJavascriptEvents.formTableFieldBlur&&t.customJavascriptEvents.formTableFieldBlur(t.formData,e.currentField,o,t.editRow,t)},t.model.customFieldListeners.length>0)for(var c=0;t.model.customFieldListeners.length>c;c++)t.model.customFieldListeners[c].formTableRendered&&i(function(){t.model.customFieldListeners[c].formTableRendered(t.formData,e.currentField,l,t.editRow,t)
});"undefined"!=typeof ALFRESCO&&ALFRESCO.formExtensions!==void 0&&ALFRESCO.formExtensions.formTableRendered!==void 0&&i(function(){ALFRESCO.formExtensions.formTableRendered(t.formData,e.currentField,l,t.editRow,t)}),t.customJavascriptEvents.formTableRendered&&i(function(){t.customJavascriptEvents.formTableRendered(t.formData,e.currentField,l,t.editRow,t)})}]),angular.module("activitiApp").controller("StartFormController",["$rootScope","$scope","$translate","$http","$location","NavigationService",function(e,t,o,n,r,i){t.$watch("processInstanceId",function(){t.getProcessInstance(t.processInstanceId)}),t.getProcessInstance=function(e){n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+e}).success(function(e){t.model.processInstance=e}).error(function(e){console.log("Something went wrong: "+e)})},t.openProcessInstance=function(e){i.openProcessPage(e)},t.backToProcessInstance=function(){t.$parent.startForm={}}}]),angular.module("activitiApp").controller("StartProcessController",["$rootScope","$scope","$translate","$http","$timeout","$location","$route","$modal","$routeParams","$q","AppDefinitionService","ProcessService","FormService","RelatedContentService","FormUtilService","NavigationService",function(e,t,o,n,r,i,a,s,l,c,d,u,p,m,f,v){e.setMainPageById("start"),t.processDefinitionId=l.processDefinitionId,t.appDefinitionId=l.appDefinitionId||d.getIntegrationAppDefinitionId(),t.missingAppdefinition=t.appDefinitionId===!1,d.setActiveAppDefinitionId(t.appDefinitionId),l.processDefinitionId?u.getProcessDefinitionById(t.processDefinitionId).then(function(e){t.processDefinitions=[e],t.selectProcessDefinition(e)}):u.getProcessDefinitions(t.appDefinitionId).then(function(e){t.processDefinitions=e.data}),t.processName="",t.processDefinition=null,t.processDefinitionWithStartFormId=null,t.startFormDefinition=null,ACTIVITI.CONFIG.workflow&&ACTIVITI.CONFIG.workflow.addStartProcessContent&&(t.startProcessContent=ACTIVITI.CONFIG.workflow.addStartProcessContent,t.startProcessContentQueued=!1),t.addedStartProcessContent=null,t.selectProcessDefinition=function(e){t.processDefinition==e?(t.processDefinition=null,t.processDefinitionWithStartFormId=null,t.startFormDefinition=null):(t.processDefinition=e,e.hasStartForm?t.loadStartForm(e):(t.processName=e.name+" - "+(new moment).format("MMMM Do YYYY"),t.processDefinitionWithStartFormId=null,t.startFormDefinition=null))},t.loadStartForm=function(){t.startProcessContent?t.startProcessContent&&(t.addedStartProcessContent?t.setStartForm():t.startProcessContentQueued||(t.startProcessContentQueued=!0,"function"==typeof t.startProcessContent?t.startProcessContent(function(e){t.startProcessContent=e,t.queueStartProcessContent().then(function(){t.setStartForm()})},function(t,o){e.addAlert(o,"error")}):t.queueStartProcessContent().then(function(){t.setStartForm()}))):t.setStartForm()},t.queueStartProcessContent=function(){for(var n,r=[],i=c.defer(),a=t.startProcessContent,s=0;a.length>s;s++)n=a[s],m.addRelatedContentFromSource(null,null,n.source,n.sourceId,n.name,null,null,n.link,null).then(function(e){r.push(e),r.length==a.length&&(t.addedStartProcessContent=r,i.resolve())},function(){e.addAlert(o("PROCESS.ALERT.START-PROCESS-CONTENT-ADD-FAILED",{noOfFiles:a.length}),"error"),i.reject()});return i.promise},t.setStartForm=function(){var e=t.processDefinition;e.hasStartForm&&p.getStartForm(e.id).then(function(o){if(t.addedStartProcessContent){var n,r=f.flattenFields(o.fields);for(var i in r)if(n=r[i],"upload"==n.type){n.value=t.addedStartProcessContent;break}}t.processName=e.name+" - "+(new moment).format("MMMM Do YYYY"),t.processDefinition=e,t.processDefinitionWithStartFormId=e.id,t.startFormDefinition=o})},t.navigateToView=function(e){t.appDefinitionId&&!ACTIVITI.CONFIG.integrationProfile?i.path("/apps/"+encodeURIComponent(t.appDefinitionId)+e):i.path(e)},t.createProcessInstance=function(){u.createProcess({processDefinitionId:t.processDefinition.id,name:t.processName}).then(function(){v.openProcessPage(t.processDefinition.id)})};var g=t.$on("process-started",function(e,t){g(),v.openProcessPage(t.id)})}]),angular.module("activitiApp").controller("FormSelectPopupCrtl",["$rootScope","$scope","$http","$q","$filter",function(e,t,o){function n(e){t.activeFormTab=e.tabs&&e.tabs.length>0?e.tabs[0]:void 0}t.state={loadingForms:!0,formsError:!1},t.currentForm?(n(t.currentForm),t.selectedForm=t.currentForm):t.selectedForm={loading:!0},t.formTabClicked=function(e){t.activeFormTab=e},t.selectForm=function(e){null===e.fields?t.loadForm(e):(n(e),t.selectedForm=e)},t.loadForms=function(){o.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/editor/form-models").success(function(e){t.state.loadingForms=!1,t.state.formsError=!1,t.forms=e.data;for(var o=0;t.forms.length>o;o++)t.forms[o].fields=null;t.selectedForm.loading&&t.forms.length>0&&t.selectForm(t.forms[0])}).error(function(){t.state.loadingForms=!1,t.state.formsError=!0})},t.loadForm=function(e){e.loading=!0,o.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+e.id).success(function(o){e.loadingError=!1,e.loading=!1,e.customFieldTemplates=o.formDefinition.customFieldTemplates,e.tabs=o.formDefinition.tabs,e.fields=o.formDefinition.fields,e.outcomes=o.formDefinition.outcomes,n(e),t.selectedForm=e}).error(function(){e.loading=!1,e.loadingError=!0})},t.loadForms()}]),angular.module("activitiApp").controller("DecisionTableDisplayController",["$scope","$rootScope","$translate","$http","uiGridConstants","appResourceRoot",function(e,t,o,n,r,i){e.model={loading:!0,decisionTableDefinition:{},decisionTableRules:[],columnDefs:[],columnVariableIdMap:{},columnVariableTypeVariableIdMap:{},decisionTableExpanded:!0,metadataVariablesColumnDefs:[],inputVariableValues:[],inputListExpanded:!1,outputVariableValues:[],outputListExpanded:!1},e.model.metadataVariablesColumnDefs.push({name:"name",displayName:o.instant("PROCESS.DECISION.TABLE.METADATA-NAME"),field:"name",type:"string",headerCellClass:"header-expression",sort:{direction:r.ASC,priority:1}}),e.model.metadataVariablesColumnDefs.push({name:"value",displayName:o.instant("PROCESS.DECISION.TABLE.METADATA-VALUE"),field:"value",type:"string",headerCellClass:"header-expression",cellTemplate:'<div class="ui-grid-cell-contents">       <span class="contents-value">{{grid.appScope.formatVariableValue(COL_FIELD, row)}}</span>   </div>'}),e.gridOptions={data:e.model.decisionTableRules,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!0,enableSorting:!1,enableCellEditOnFocus:!1,columnDefs:e.model.columnDefs,headerTemplate:i+"views/templates/decision-table-header-template.html"},e.gridOptions.onRegisterApi=function(t){e.gridApi=t;var o=l();e.gridApi.core.addRowHeaderColumn({name:"rowHeaderCol",displayName:"",width:35,cellTemplate:o})},e.inputVariablesGridOptions={data:e.model.inputVariableValues,columnDefs:e.model.metadataVariablesColumnDefs,headerTemplate:i+"views/templates/decision-table-header-template.html",enableSorting:!0,enableCellEditOnFocus:!1,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1},e.inputVariablesGridOptions.onRegisterApi=function(t){e.inputVariableGridApi=t;var o=l();e.inputVariableGridApi.core.addRowHeaderColumn({name:"rowHeaderCol",displayName:"",width:35,cellTemplate:o})},e.outputVariablesGridOptions={data:e.model.outputVariableValues,columnDefs:e.model.metadataVariablesColumnDefs,headerTemplate:i+"views/templates/decision-table-header-template.html",enableSorting:!0,enableCellEditOnFocus:!1,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1},e.outputVariablesGridOptions.onRegisterApi=function(t){e.outputVariableGridApi=t;var o=l();e.outputVariableGridApi.core.addRowHeaderColumn({name:"rowHeaderCol",displayName:"",width:35,cellTemplate:o})},e.getDecisionTableInfo=function(i,a,s){n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/decisions/audits/"+encodeURIComponent(i)}).success(function(t){function o(){var e=a[l];return void 0==e&&(e=i.inputVariables[l]),e}e.model.loading=!1;var n=JSON.parse(t.decisionModelJson),i=JSON.parse(t.auditTrailJson),a=t.renderedVariables;i.ruleExecutions&&n.outputExpressions&&i.ruleExecutions.forEach(function(e,t){n.outputExpressions.forEach(function(o,n){var r=o.id.replace("outputExpression_","outputEntry_")+"_"+(t+1);if(e.conclusionResults){var i=e.conclusionResults.filter(function(e){return e.id==r}).length>0;i||e.conclusionResults.splice(n,0,{})}})}),e.auditTrail=i,e.model.decisionTableDefinition=n;var s=[];for(var l in i.inputVariables)i.inputVariables.hasOwnProperty(l)&&s.push({name:l,value:o(i,l)});Array.prototype.push.apply(e.model.inputVariableValues,s),e.inputVariableGridApi.core.notifyDataChange(r.dataChange.ALL);var c=[];for(var l in i.outputVariables)i.outputVariables.hasOwnProperty(l)&&c.push({name:l,value:i.outputVariables[l]});Array.prototype.push.apply(e.model.outputVariableValues,c),e.outputVariableGridApi.core.notifyDataChange(r.dataChange.ALL),n.inputExpressions.forEach(function(t){t.id+="",e.model.columnVariableIdMap[t.id]=t.variableId,e.model.columnVariableTypeVariableIdMap[t.variableId]=t.type}),n.outputExpressions.forEach(function(t){t.id+="",e.model.columnVariableIdMap[t.id]=t.variableId,e.model.columnVariableTypeVariableIdMap[t.variableId]=t.type}),n.rules&&n.rules.length>0&&Array.prototype.push.apply(e.model.decisionTableRules,n.rules),e.getColumnDefinitions(n)}).error(function(){var e=o.instant("PROCESS.DECISION.TABLE.LOAD-ERROR",{executionId:s,activityId:a});t.addAlert(e,"error")})},e.backToProcessInstance=function(){e.$parent.model.decisionTableAudit={}},e.getVariableNameColumnId=function(t){var o=t.name;return o?e.model.columnVariableIdMap[o]?e.model.columnVariableIdMap[o]:"":""},e.getVariableValueColumnId=function(t){var o=t.name;if(!o)return"";if(e.model.columnVariableIdMap[o]){var n=e.model.columnVariableIdMap[o];if(e.auditTrail&&e.auditTrail.inputVariables&&e.auditTrail.inputVariables.hasOwnProperty(n)){var r=e.auditTrail.inputVariables[n],i=e.model.columnVariableTypeVariableIdMap[n];return r&&"date"==i&&(r=new moment(r).format("L")),r}}return""},e.formatVariableValue=function(t,o){var n=o.entity.name,r=e.model.columnVariableTypeVariableIdMap[n];return r||(r=e.auditTrail.inputVariableTypes[n]),e.formatValue(t,r)},e.formatValue=function(e,t){return e&&"date"==t&&(e=new moment(e).format("L")),e};var a=function(){return'<div role="columnheader" ui-grid-one-bind-aria-labelledby-grid="col.uid + \'-header-text \' + col.uid + \'-sortdir-text\'">   <div class="ui-grid-cell-contents ui-grid-header-cell-primary-focus" col-index="renderIndex" title="TOOLTIP">       <div class="text-center text-label" title="{{ col.displayName CUSTOM_FILTERS }}"><span>{{ col.displayName CUSTOM_FILTERS }}</span></div>       <div class="text-center text-value" title="{{ grid.appScope.getVariableNameColumnId(col) }}"><span ui-grid-one-bind-id-grid="col.uid + \'-header-text\'">{{ grid.appScope.getVariableNameColumnId(col) }}</span></div>       <div class="text-center text-value" title="{{ grid.appScope.getVariableValueColumnId(col) }}"><span ui-grid-one-bind-id-grid="col.uid + \'-header-text\'">{{ grid.appScope.getVariableValueColumnId(col) }}</span></div>       <div class="text-center subtle"><span>{{ \'PROCESS.DECISION.TABLE.INPUT-VARIABLE\' | translate }}</span></div>   </div></div>'},s=function(){return'<div role="columnheader" ui-grid-one-bind-aria-labelledby-grid="col.uid + \'-header-text \' + col.uid + \'-sortdir-text\'">   <div class="ui-grid-cell-contents ui-grid-header-cell-primary-focus" col-index="renderIndex" title="TOOLTIP">       <div class="text-center text-label" title="{{ col.displayName CUSTOM_FILTERS }}"><span>{{ col.displayName CUSTOM_FILTERS }}</span></div>       <div class="text-center text-value" title="{{ grid.appScope.getVariableNameColumnId(col) }}"><span ui-grid-one-bind-id-grid="col.uid + \'-header-text\'">{{ grid.appScope.getVariableNameColumnId(col) }}</span></div>       <div class="text-center text-value"><span></span></div>       <div class="text-center subtle"><span>{{ \'PROCESS.DECISION.TABLE.OUTPUT-VARIABLE\' | translate }}</span></div>   </div></div>'},l=function(){return'<div class="ui-grid-disable-selection"><div class="ui-grid-cell-contents text-center customRowHeader">{{rowRenderIndex + 1}}</div></div>'},c=function(){var e='<div class="ui-grid-cell-contents" ng-class="grid.appScope.getInputClass(rowRenderIndex, colRenderIndex)" title="{{grid.appScope.getInputTooltip(rowRenderIndex, colRenderIndex, COL_FIELD)}}">   <span class="contents-value">{{COL_FIELD}}</span></div>';return e},d=function(){var e='<div class="ui-grid-cell-contents" ng-class="grid.appScope.getOutputClass(rowRenderIndex, colRenderIndex, COL_FIELD)" title="{{grid.appScope.getOutputTooltip(rowRenderIndex, colRenderIndex, COL_FIELD)}}">   <span class="contents-value">{{grid.appScope.getResult(rowRenderIndex, colRenderIndex, row)}}</span></div>';return e},u="decision-table-display";e.getInputClass=function(t,o){var n=o,r=e.auditTrail.ruleExecutions;if(r&&r[t]&&r[t].conditionResults&&r[t].conditionResults.length>n){var i=r[t].conditionResults[n];return i.exception?u+"-cell-exception":u+(i.result?"-cell-match":"-cell-nomatch")}return u+"-cell-notexecuted"},e.getInputTooltip=function(t,n,r){var i=n,a=e.auditTrail.ruleExecutions;if(a&&a[t]&&a[t].conditionResults&&a[t].conditionResults.length>i){var s=a[t].conditionResults[i];return s.exception?o.instant("PROCESS.DECISION.TABLE.TOOLTIP.INPUT-EXCEPTION",{error:s.exception}):s.result?r&&r.trim().length>0?o.instant("PROCESS.DECISION.TABLE.TOOLTIP.INPUT-MATCH"):o.instant("PROCESS.DECISION.TABLE.TOOLTIP.INPUT-EMPTYEXPRESSION",{expression:r}):o.instant("PROCESS.DECISION.TABLE.TOOLTIP.INPUT-NOMATCH")}return o.instant("PROCESS.DECISION.TABLE.TOOLTIP.INPUT-NOTEXECUTED")},e.getOutputClass=function(t,o,n){var r=o-e.model.decisionTableDefinition.inputExpressions.length,i=e.auditTrail.ruleExecutions;if(i&&i[t]&&i[t].conclusionResults&&i[t].conclusionResults.length>r){var a=i[t].conclusionResults[r];if(a.exception)return u+"-cell-exception";if(n)return u+(a.hasOwnProperty("result")?"-cell-match":"-cell-nomatch")}return u+"-cell-notexecuted"},e.getOutputTooltip=function(t,n,r){var i=n-e.model.decisionTableDefinition.inputExpressions.length,a=e.auditTrail.ruleExecutions;if(r&&(r=r.replace(/"/g,"'")),a&&a[t]&&a[t].conclusionResults&&a[t].conclusionResults.length>i){var s=a[t].conclusionResults[i];if(s.exception)return o.instant("PROCESS.DECISION.TABLE.TOOLTIP.OUTPUT-EXCEPTION",{expression:r,error:s.exception});if(r)return s.hasOwnProperty("result")?o.instant("PROCESS.DECISION.TABLE.TOOLTIP.OUTPUT-RESULT",{expression:r}):o.instant("PROCESS.DECISION.TABLE.TOOLTIP.OUTPUT-NOTEXECUTED",{expression:r})}return o.instant("PROCESS.DECISION.TABLE.TOOLTIP.OUTPUT-NOEXPRESSION")},e.getResult=function(t,o){var n=o-e.model.decisionTableDefinition.inputExpressions.length,r=e.auditTrail.ruleExecutions;if(r&&r[t]&&r[t].conclusionResults&&r[t].conclusionResults.length>n){var i=r[t].conclusionResults[n];if(!i.exception&&i.hasOwnProperty("result")){var a=e.model.decisionTableDefinition.outputExpressions[n].type,s=e.formatValue(i.result,a);return s}}return""},e.getColumnDefinitions=function(t){if(t){var o=[];t.inputExpressions&&t.inputExpressions.length>0&&t.inputExpressions.forEach(function(e,n){o.push({name:e.id,displayName:e.label?e.label:"",field:e.id,type:"string",headerCellClass:"header-expression header-input-expression"+(n==t.inputExpressions.length-1?" header-input-expression-last":""),headerCellTemplate:a(),cellClass:"cell-expression cell-input-expression"+(0==n?" cell-input-expression-first":""),cellTemplate:c(),enableHiding:!1,enableCellEditOnFocus:!1})}),t.outputExpressions&&t.outputExpressions.length>0&&t.outputExpressions.forEach(function(e,t){o.push({name:e.id,displayName:e.label?e.label:"",field:e.id,type:"string",headerCellTemplate:s(),headerCellClass:"header-expression header-output-expression"+(0==t?" header-output-expression-first":""),cellClass:"cell-expression cell-output-expression"+(0==t?" cell-output-expression-first":""),cellTemplate:d(),enableHiding:!1,enableCellEditOnFocus:!1})}),e.model.columnDefs?e.model.columnDefs.length=0:e.model.columnDefs=[],Array.prototype.push.apply(e.model.columnDefs,o),e.gridApi.core.notifyDataChange(r.dataChange.ALL)}},e.$watch("id",function(){e.getDecisionTableInfo(e.id,e.activityId,e.executionId,e.decisionKey)})}]),angular.module("activitiApp").directive("documentPreview",["$parse","appResourceRoot",function(e,t){"use strict";return{restrict:"E",templateUrl:t+"views/templates/document-preview.html",scope:{content:"=",task:"=",deleted:"&onDelete",editable:"=",readOnly:"=",embedded:"="},controller:"DocumentPreviewController"}}]),angular.module("activitiApp").directive("activitiForm",["$rootScope","appResourceRoot",function(e,t){"use strict";return{restrict:"E",templateUrl:t+"views/templates/form-template.html",scope:{taskId:"=taskId",formDefinition:"=formDefinition",shareModel:"=shareModel",processName:"=processName",processInstanceId:"=processInstanceId",processDefinitionId:"=processDefinitionId",outcomesOnly:"=outcomesOnly",disableForm:"=disableForm",disableFormText:"=disableFormText",hideButtons:"=hideButtons",currentUserInvolved:"=currentUserInvolved"},link:function(){e.window.forceRefresh=!0}}}]),angular.module("activitiApp").directive("activitiFormOutcomes",["$rootScope","appResourceRoot",function(e,t){"use strict";return{restrict:"E",templateUrl:t+"views/templates/form-outcomes-template.html",scope:{formData:"=formData",model:"=model",saveForm:"=saveForm",completeForm:"=completeForm",disableForm:"=disableForm",hideButtons:"=hideButtons",unClaim:"=unClaim",unClaimButtonDisabled:"=unClaimButtonDisabled",onUnclaim:"=onUnclaim",currentUserInvolved:"=currentUserInvolved"},link:function(t){t.readOnly=e.readOnly}}}]),angular.module("activitiApp").directive("input",["$parse","$translate",function(e,t){"use strict";return{restrict:"E",require:"?ngModel",link:function(o,n,r,i){function a(e){return e.format(l.format)}function s(e){return[a(e.startDate),a(e.endDate)].join(l.separator)}if("daterange"===r.type&&null!==i){var l={};l.format=r.format||"YYYY-MM-DD",l.separator=r.separator||" - ",l.minDate=r.minDate&&moment(r.minDate),l.maxDate=r.maxDate&&moment(r.maxDate),l.dateLimit=r.limit&&moment.duration.apply(this,r.limit.split(" ").map(function(e,t){return 0===t&&parseInt(e,10)||e})),l.ranges=r.ranges&&e(r.ranges)(o),l.locale=r.locale&&e(r.locale)(o),l.opens=r.opens&&e(r.opens)(o),void 0===l.locale&&(l.locale={applyLabel:t.instant("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.APPLY"),cancelLabel:t.instant("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.CANCEL"),fromLabel:t.instant("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.FROM"),toLabel:t.instant("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.TO"),customRangeLabel:t.instant("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.CUSTOM-RANGE")}),i.$formatters.unshift(function(e){return e?e:""}),i.$parsers.unshift(function(e){return e}),i.$render=function(){i.$viewValue&&i.$viewValue.startDate&&n.val(s(i.$viewValue))},o.$watch(r.ngModel,function(e){return e&&e.startDate?(n.data("daterangepicker").startDate=e.startDate,n.data("daterangepicker").endDate=e.endDate,n.data("daterangepicker").updateView(),n.data("daterangepicker").updateCalendars(),n.data("daterangepicker").updateInputText(),void 0):(i.$setViewValue({startDate:moment().startOf("day"),endDate:moment().startOf("day")}),void 0)}),n.daterangepicker(l,function(e,t,n){o.$apply(function(){i.$setViewValue({startDate:e,endDate:t,rangeName:n}),i.$render()})})}}}}]),angular.module("activitiApp").directive("userPicture",[function(){"use strict";var e={};return e.restrict="A",e.replace=!0,e.transclude=!1,e.template='<div class="{{userPic.class}}" ng-style="{\'background-image\': userPic.style}" title="{{userPic.userName}}"><span>{{userPic.text}}</span></div>',e.scope={user:"=userPicture"},e.controller=["$scope","$element",function(e,t){e.$watch("user",function(t){e.refreshUser(t)}),t.bind("error",function(){console.log("No picture")}),e.refreshUser=function(t){var o={text:""};t&&(t.pictureId?(o.class="user-picture",o.style='url("'+ACTIVITI.CONFIG.contextRoot+"/app/rest/users/"+t.id+'/picture")'):o.class="user-picture no-picture",t.firstName&&t.lastName?(o.text=t.firstName.substring(0,1).toUpperCase()+t.lastName.substring(0,1).toUpperCase(),o.userName=t.firstName+" "+t.lastName):void 0!==t.lastName&&null!==t.lastName?(t.lastName.length>1?o.text=t.lastName.substring(0,2).toUpperCase():1===t.lastName.length&&(o.text=t.lastName.substring(0,1).toUpperCase()),o.userName=t.lastName):void 0!==t.firstName&&null!==t.firstName?(t.firstName.length>1?o.text=t.firstName.substring(0,2).toUpperCase():1===t.firstName.length&&(o.text=t.firstName.substring(0,1).toUpperCase()),o.userName=t.firstName):(o.text="??",o.userName="")),e.userPic=o},e.refreshUser(e.user)}],e}]),angular.module("activitiApp").directive("formElement",["$rootScope","$timeout","$modal","$http","$templateCache","$translate","$compile","$interpolate","appResourceRoot","RecursionHelper",function(e,t,o,n,r,i,a,s,l,c){"use strict";return{restrict:"E",templateUrl:l+"views/templates/form-element-template.html",transclude:!1,scope:{field:"=",customFieldTemplates:"=",taskId:"=",taskForm:"=",controlCallbacks:"=",model:"=",restData:"="},compile:function(e){return c.compile(e,this.link)},link:function(t){t.appResourceRoot=l,t.activitiFieldIdPrefix=e.activitiFieldIdPrefix,t.getHtmlTemplate=function(e){return t.customFieldTemplates[e.type]},t.toFormFieldColumnArray=function(e){var t=[],o=[];for(var n in e)e[n]&&o.push(parseInt(n));o.sort(function(e,t){return e-t});for(var r=0;o.length>r;r++)t.push(e[""+o[r]]);return t},t.determineColumnClass=function(e,t){var o=2;e.numberOfColumns&&(o=e.numberOfColumns);var n=1;return t&&t.length>0&&t[0].colspan&&(n=t[0].colspan),1===o?"col-sm-12":2===o?n>=2?"col-sm-12":"col-sm-6":3===o?n>=3?"col-sm-12":n>=2?"col-sm-8":"col-sm-4":4===o?n>=4?"col-sm-12":n>=3?"col-sm-9":n>=2?"col-sm-6":"col-sm-3":6===o?n>=6?"col-sm-12":n>=5?"col-sm-10":n>=4?"col-sm-8":n>=3?"col-sm-6":n>=2?"col-sm-4":"col-sm-2":12===o?n>=12?"col-sm-12":n>=11?"col-sm-11":n>=10?"col-sm-10":n>=9?"col-sm-9":n>=8?"col-sm-8":n>=7?"col-sm-7":n>=6?"col-sm-6":n>=5?"col-sm-5":n>=4?"col-sm-4":n>=3?"col-sm-3":n>=2?"col-sm-2":"col-sm-1":"col-sm-6"},t.onFieldValueChange=function(e){return t.controlCallbacks.onFieldValueChange(e)},t.onFieldBlur=function(e){return t.controlCallbacks.onFieldBlur(e)},t.onFieldFocus=function(e){return t.controlCallbacks.onFieldFocus(e)},t.isEmpty=function(e){return t.controlCallbacks.isEmpty(e)},t.isEmptyDropdown=function(e){return t.controlCallbacks.isEmptyDropdown(e)},t.isEmptyRadio=function(e){return t.controlCallbacks.isEmptyRadio(e)},t.fieldPersonSelected=function(e,o){return t.controlCallbacks.fieldPersonSelected(e,o)},t.fieldPersonEmailSelected=function(e,o){return t.controlCallbacks.fieldPersonEmailSelected(e,o)},t.fieldPersonRemoved=function(e,o){return t.controlCallbacks.fieldPersonRemoved(e,o)},t.fieldGroupSelected=function(e,o){return t.controlCallbacks.fieldGroupSelected(e,o)},t.fieldGroupRemoved=function(e,o){return t.controlCallbacks.fieldGroupRemoved(e,o)},t.getGridOptions=function(e){return t.controlCallbacks.getGridOptions(e)},t.noRowSelected=function(e){return t.controlCallbacks.noRowSelected(e)},t.moveDynamicTableRowUp=function(e){return t.controlCallbacks.moveDynamicTableRowUp(e)},t.moveDynamicTableRowDown=function(e){return t.controlCallbacks.moveDynamicTableRowDown(e)},t.addDynamicTableRow=function(e){return t.controlCallbacks.addDynamicTableRow(e)},t.removeDynamicTableRow=function(e){return t.controlCallbacks.removeDynamicTableRow(e)},t.openRowEditor=function(e,o,n){return t.controlCallbacks.openRowEditor(e,o,n)},t.removeContent=function(e,o){return t.controlCallbacks.removeContent(e,o)},t.contentUploaded=function(e,o){return t.controlCallbacks.contentUploaded(e,o)},t.removeFolder=function(e,o){return t.controlCallbacks.removeFolder(e,o)},t.folderSelected=function(e,o){return t.controlCallbacks.folderSelected(e,o)},t.uploadInProgress=function(e){return t.controlCallbacks.uploadInProgress(e)},t.handleReadonlyClick=function(e,o){return t.controlCallbacks.handleReadonlyClick(e,o)},t.clearDate=function(e,o){return t.controlCallbacks.clearDate(e,o)},t.selectToday=function(e,o){return t.controlCallbacks.selectToday(e,o)},t.closeDatePopup=function(e){return t.controlCallbacks.closeDatePopup(e)},t.registerCustomFieldListener=function(e){return t.controlCallbacks.registerCustomFieldListener(e)},t.removeCustomFieldListener=function(e){return t.controlCallbacks.removeCustomFieldListener(e)},t.getFieldLabelDisplayValue=function(e){return t.controlCallbacks.getFieldLabelDisplayValue(e)},t.getGlobalDateFormat=function(){return t.controlCallbacks.getGlobalDateFormat()},t.getGlobalAngularDateFormat=function(){return t.controlCallbacks.getGlobalAngularDateFormat()}}}}]),angular.module("activitiApp").directive("fieldPreview",["appResourceRoot","RecursionHelper",function(e,t){"use strict";return{restrict:"E",templateUrl:e+"views/templates/field-preview-template.html",transclude:!1,scope:{field:"=",customFieldTemplates:"="},compile:function(e){return t.compile(e,this.link)},link:function(e){function t(t){for(var o=[],n=0;t.length>n;n++)t[n].visible&&o.push({field:t[n].name,displayName:t[n].name,enableColumnMenu:!1});e.gridOptions={columnDefs:o,enableRowSelection:!1,enableSorting:!1,enableRowHeaderSelection:!1,multiSelect:!1,enableHorizontalScrollbar:0,modifierKeysToMultiSelect:!1}}e.getHtmlTemplate=function(t){return e.customFieldTemplates[t.type]},"dynamic-table"===e.field.type?e.field.columnDefinitions&&e.field.columnDefinitions.length>0&&t(e.field.columnDefinitions):"readonly"===e.field.type&&e.field.params&&e.field.params.field.columnDefinitions&&e.field.params.field.columnDefinitions.length>0&&t(e.field.params.field.columnDefinitions)}}}]),angular.module("activitiApp").directive("compileHtml",["$compile",function(e){"use strict";return{restrict:"A",replace:!0,link:function(t,o,n){t.$watch(n.compileHtml,function(n){o.html(n),e(o.contents())(t)})}}}]),angular.module("activitiApp").directive("decisionTableDisplay",["appResourceRoot",function(e){"use strict";return{restrict:"E",templateUrl:e+"views/templates/decision-table-display.html",scope:{id:"=",activityId:"=",executionId:"=",decisionKey:"="},controller:"DecisionTableDisplayController"}}]),angular.module("activiti.common").directive("input",["$parse","$translate",function(e,t){"use strict";return{restrict:"E",require:"?ngModel",link:function(o,n,r,i){function a(e){return e.format(l.format)}function s(e){return[a(e.startDate),a(e.endDate)].join(l.separator)}if("daterange"===r.type&&null!==i){var l={};l.format=r.format||"YYYY-MM-DD",l.separator=r.separator||" - ",l.minDate=r.minDate&&moment(r.minDate),l.maxDate=r.maxDate&&moment(r.maxDate),l.dateLimit=r.limit&&moment.duration.apply(this,r.limit.split(" ").map(function(e,t){return 0===t&&parseInt(e,10)||e})),l.ranges=r.ranges&&e(r.ranges)(o),l.locale=r.locale&&e(r.locale)(o),l.opens=r.opens&&e(r.opens)(o),void 0===l.locale&&(l.locale={applyLabel:t.instant("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.APPLY"),cancelLabel:t.instant("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.CANCEL"),fromLabel:t.instant("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.FROM"),toLabel:t.instant("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.TO"),customRangeLabel:t.instant("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.CUSTOM-RANGE")}),i.$formatters.unshift(function(e){return e?e:""}),i.$parsers.unshift(function(e){return e}),i.$render=function(){i.$viewValue&&i.$viewValue.startDate&&n.val(s(i.$viewValue))},o.$watch(r.ngModel,function(e){return e&&e.startDate?(n.data("daterangepicker").startDate=e.startDate,n.data("daterangepicker").endDate=e.endDate,n.data("daterangepicker").updateView(),n.data("daterangepicker").updateCalendars(),n.data("daterangepicker").updateInputText(),void 0):(i.$setViewValue({startDate:moment().startOf("day"),endDate:moment().startOf("day")}),void 0)}),n.daterangepicker(l,function(e,t,n){o.$apply(function(){i.$setViewValue({startDate:e,endDate:t,rangeName:n}),i.$render()})})}}}}]),angular.module("activiti.common").directive("datepickerTimezone",["$filter",function(e){"use strict";return{restrict:"A",priority:1,require:"ngModel",link:function(t,o,n,r){r.$formatters.push(function(e){if(null!==e&&void 0!==e){var t=e.split("T")[0],o=t.split("-"),n=new Date;return n.setDate(parseInt(o[2])),n.setMonth(parseInt(o[1])-1),n.setFullYear(parseInt(o[0])),n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),n}}),r.$parsers.push(function(t){if(t&&t.constructor===Date){var o=e("date")(t,"yyyy-MM-dd");return n.excludeTime&&"true"===n.excludeTime?o:o+"T00:00:00.000Z"}})}}}]),angular.module("activiti.common").filter("dateformat",function(){"use strict";return function(e,t){return e?"fromNow"===t?moment(e).fromNow():"fromNowFull"===t?moment(e).fromNow()+" ("+moment(e).format("MMMM Do YYYY")+")":t?moment(e).format(t):moment(e).calendar():""}}).filter("dateonlyformat",function(){"use strict";return function(e,t){return e?(e=e.split("T")[0],"fromNow"===t?moment(e).fromNow():"fromNowFull"===t?moment(e).fromNow()+" ("+moment(e).format("MMMM Do YYYY")+")":t?moment(e).format(t):moment(e).calendar()):""}}).filter("validdateformat",function(){"use strict";return function(e,t){var o;return e&&(o="fromNow"===t?moment(e).fromNow():"fromNowFull"===t?moment(e).fromNow()+" ("+moment(e).format("MMMM Do YYYY")+")":t?moment(e).format(t):moment(e).calendar(),0==moment(o).isValid()&&(o="")),o}}).filter("momentToAngularFormat",function(){"use strict";return function(e){return e?(e=e.replace(/D/g,"d"),e=e.replace(/Y/g,"y")):void 0}}),angular.module("activiti.common").filter("username",function(){"use strict";return function(e){return e?e.firstName?e.firstName+" "+e.lastName:e.lastName:""}}),function(){angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(e,t){return{loginConfirmed:function(o,n){var r=n||function(e){return e};e.$broadcast("event:auth-loginConfirmed",o),t.retryAll(r)},loginCancelled:function(o,n){t.rejectAll(n),e.$broadcast("event:auth-loginCancelled",o)}}}]).config(["$httpProvider",function(e){var t=["$rootScope","$q","httpBuffer","$translate",function(e,t,o,n){return{responseError:function(r){if(401===r.status&&!r.config.ignoreAuthModule){var i=t.defer();return o.append(r.config,i),e.$broadcast("event:auth-loginRequired",r),i.promise}return 401===r.status&&(e.invalidCredentials=!0),r.status>=500&&599>=r.status&&r.config&&!r.config.ignoreErrors&&(r.data&&r.data.messageKey?e.addAlertPromise(n(r.data.messageKey),"error"):r.data&&r.data.message?e.addAlert(r.data.message,"error"):e.addAlertPromise(n("GENERAL.ERROR.GENERIC"),"error")),t.reject(r)}}}];e.interceptors.push(t)}]),angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(e){function t(t,n){function r(e){n.resolve(e)}function i(e){n.reject(e)}o=o||e.get("$http"),o(t).then(r,i)}var o,n=[];return{append:function(e,t){n.push({config:e,deferred:t})},rejectAll:function(e){if(e)for(var t=0;n.length>t;++t)n[t].deferred.reject(e);n=[]},retryAll:function(e){for(var o=0;n.length>o;++o)t(e(n[o].config),n[o].deferred);n=[]}}}])}(),activitiApp.factory("AuthenticationSharedService",["$rootScope","$http","authService","$q","$location","$window",function(e,t,o,n){return{authenticate:function(){var o=n.defer();return t.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/authenticate",{ignoreErrors:!0,ignoreAuthModule:"ignoreAuthModule"}).success(function(){var n=ACTIVITI.CONFIG.contextRoot+"/app/rest/account";ACTIVITI.CONFIG.integrationProfile&&(n+="?includeApps=true"),t.get(n).success(function(t){e.account=t,e.invalidCredentials=!1,e.$broadcast("event:auth-authConfirmed"),o.resolve()
}).error(function(t){o.reject(t),e.$broadcast("event:auth-loginRequired")})}).error(function(t){o.reject(t),e.$broadcast("event:auth-loginRequired")}),o.promise},login:function(n){var r="j_username="+encodeURIComponent(n.username)+"&j_password="+encodeURIComponent(n.password)+"&_spring_security_remember_me=true&submit=Login";t.post(ACTIVITI.CONFIG.contextRoot+"/app/authentication",r,{headers:{"Content-Type":"application/x-www-form-urlencoded"},ignoreAuthModule:"ignoreAuthModule"}).success(function(t,r,i,a){e.authenticationError=!1,n.success&&n.success(t,r,i,a),o.loginConfirmed()}).error(function(t,o,r,i){e.$broadcast("event:auth-loginFailed"),n.error&&n.error(t,o,r,i)})},logout:function(){e.authenticated=!1,e.authenticationError=!1,t.get(ACTIVITI.CONFIG.contextRoot+"/app/logout").success(function(){e.login=null,e.authenticated=!1,o.loginCancelled({isFromLogout:!0})})},hasCapability:function(t){return e.account&&e.account.capabilities?e.account.capabilities.indexOf(t)>-1:!1},hasTenantManagementCapability:function(){return this.hasCapability("tenant-mgmt")},hasTenantAdminCapability:function(){return this.hasCapability("tenant-admin")},hasAccessReportsCapability:function(){return this.hasCapability("access-reports")}}}]),activitiModule.service("UserService",["$http","$q",function(e,t){var o=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getFilteredUsers=function(e,t,n,r,i){var a={};return"string"==typeof e?a.filter=e:a=e,t&&(a.excludeTaskId=t),n&&(a.excludeProcessId=n),r&&r>0&&(a.tenantId=r),i&&i.id&&(a.groupId=i.id),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/workflow-users",params:a})},this.getFilteredUsersStrict=function(e,t,n){var r={};return r.status="active",null!==e&&void 0!==e&&(r.filter=e),null!==t&&void 0!==t&&t>-1&&(r.tenantId=t),n&&n.id&&(r.groupId=n.id),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/users",params:r})},this.getRecentUsers=function(e,t){var n={};return t&&(n.excludeTaskId=t),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/workflow-users/"+e+"/recent-users",params:n})}}]),activitiModule.service("FunctionalGroupService",["$http","$q",function(e,t){var o=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getFilteredGroups=function(e,t,n){var r={};return null!==e&&void 0!==e&&(r.filter=e),t&&t.id&&(r.groupId=t.id),null!==n&&void 0!==n&&(r.tenantId=n),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/workflow-groups",params:r})}}]),activitiModule.service("RelatedContentService",["$http","$q","$rootScope","$translate","$location","Upload","EventTrackingService","$timeout",function(e,t,o,n,r,i,a,s){var l=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.deleteContent=function(e,t){var o=l({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/content/"+e});return o.then(function(){t?a.trackEvent("workflow","task-remove-related-content"):a.trackEvent("workflow","remove-related-content")}),o},this.addRelatedContent=function(e,o,n,r,s){var l,c,d=n.name.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"}),u=t.defer();if(e){var p="";s&&(p+="?isRelatedContent=true"),c=r?ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/raw-content/text"+p:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/raw-content"+p,l=i.upload({url:c,method:"POST",file:n,fileName:d})}else o?(c=r?ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+o+"/raw-content/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+o+"/raw-content",l=i.upload({url:c,method:"POST",file:n,fileName:d})):(c=r?ACTIVITI.CONFIG.contextRoot+"/app/rest/content/raw/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/content/raw",l=i.upload({url:c,method:"POST",file:n,fileName:d}));var m=this;l.success(function(e){e&&e.id&&m.addUrlToContent(e),u.resolve(e)}).error(function(e){u.reject(e)});var f=u.promise;return f.progress=function(e){return l.progress(e),f},f.then(function(){e?a.trackEvent("workflow","task-add-related-content"):o?a.trackEvent("workflow","processinstance-add-related-content"):a.trackEvent("workflow","add-related-content")}),f},this.addRelatedContentFromSource=function(o,n,r,i,s,l,c,d,u){var p,m="";u&&(m+="?isRelatedContent=true"),p=o?ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+o+"/content"+m:n?ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+n+"/content":ACTIVITI.CONFIG.contextRoot+"/app/rest/content",d=1==d;var f={source:r,sourceId:i,name:s,link:d,mimeType:l,simpleType:c},v=this,g=t.defer();e({method:"POST",url:p,data:f}).success(function(e){e&&e.id&&v.addUrlToContent(e),g.resolve(e)}).error(function(e){g.reject(e)});var h=g.promise;return h.then(function(){o?a.trackEvent("workflow","task-add-related-content"):n?a.trackEvent("workflow","processinstance-add-related-content"):a.trackEvent("workflow","add-related-content")}),h},this.getRelatedContent=function(o){var n=ACTIVITI.CONFIG.contextRoot+"/app/rest/content/"+o,r=t.defer();e({method:"GET",url:n}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)});var i=r.promise;return i},this.checkRenditions=function(e,t){void 0==t?t=10:0==t&&(e.previewStatus="unsupported",e.thumbnailStatus="unsupported"),"processing"==e.previewStatus||"queued"==e.previewStatus||"processing"==e.thumbnailStatus||"queued"==e.thumbnailStatus?this.scheduleRefresh(e,t):this.addUrlToContent(e)},this.scheduleRefresh=function(e,t){var o=this;e&&t>0&&s(function(){o.getRelatedContent(e.id).then(function(n){angular.extend(e,n),o.checkRenditions(e,t-1)})},2e3)},this.getProcessContent=function(o){var n=this,r=t.defer();return e({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+o+"/field-content"}).success(function(e){if(e.data&&e.data.length>0)for(var t=0;e.data.length>t;t++){var o=e.data[t];if(o.content&&o.content.length>0)for(var i=0;o.content.length>i;i++)n.addUrlToContent(o.content[i])}r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},this.addUrlToContent=function(e){if(e&&e.id){e.rawUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/content/"+e.id+"/raw";var t=e.name.split(".").pop();e.link||"word"!=e.simpleType&&"excel"!=e.simpleType&&"powerpoint"!=e.simpleType||(e.officeUrl=ACTIVITI.CONFIG.contextRoot+"/aos/"+e.id+"/"+e.name),"created"==e.thumbnailStatus&&(e.thumbnailUrl||(e.thumbnailUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/content/"+e.id+"/rendition/thumbnail?noCache="+(new Date).getTime())),"created"==e.previewStatus?e.pdfUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/content/"+e.id+"/rendition/preview?noCache="+(new Date).getTime():"image"===e.simpleType||"jpg"===t||"jpeg"===t||"png"===t?(e.imageUrl=e.rawUrl,!e.thumbnailUrl&&e.contentAvailable&&(e.thumbnailUrl=e.rawUrl)):"pdf"==e.simpleType&&(e.pdfUrl=e.rawUrl)}}}]),activitiModule.service("ContentAccountService",["$http","$q","$rootScope","$translate","$location",function(e,t,o,n){var r=function(n,r){var i=t.defer();return e(n).success(function(e){i.resolve(e)}).error(function(e,t){409==t?o.$broadcast("integration.account.autherror",r):o.$broadcast("integration.account.error",r),i.reject(e)}),i.promise};this.getAccounts=function(){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration",transformResponse:function(e){return angular.isString(e)&&(e=JSON.parse(e)),angular.isArray(e.data)&&e.data.forEach(function(e){var t="COMMON.ACCOUNTS."+e.serviceId;e.serviceName=n.instant(t,e),e.serviceName==t&&(e.serviceName=n.instant(t.replace(/[0-9]+/g,"*"),e))}),e}})},this.getNetworks=function(){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco-cloud/networks"},"alfresco-cloud")},this.getCloudSites=function(e){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco-cloud/networks/"+e+"/sites"},"alfresco-cloud")},this.getAlfrescoServiceIdsMatch=function(e,t){return e===t||this.getRepoIdFromAlfrescoServiceId(e)===this.getRepoIdFromAlfrescoServiceId(t)||this.getRepoNameFromAlfrescoServiceId(e)&&this.getRepoNameFromAlfrescoServiceId(e)===this.getRepoNameFromAlfrescoServiceId(t)},this.getRepoIdFromAlfrescoServiceId=function(e){if(a(e))return e;var t=i(e),o=t.indexOf("-");return-1===o?t:t.substring(0,o)},this.getRepoNameFromAlfrescoServiceId=function(e){if(a(e))return e;var t=i(e),o=t.indexOf("-");return-1===o?null:t.substring(o+1)};var i=function(e){return e.replace("alfresco-","")},a=function(e){return!e.startsWith("alfresco")||e.startsWith("alfresco-cloud")};this.getSites=function(e){var t=this.getRepoIdFromAlfrescoServiceId(e);return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+t+"/sites"},e)},this.getCloudContentInSite=function(e,t){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco-cloud/networks/"+e+"/sites/"+t+"/content"},"alfresco-cloud")},this.getContentInSite=function(e,t){var o=this.getRepoIdFromAlfrescoServiceId(e);return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+o+"/sites/"+t+"/content"},e)},this.getCloudContentInFolder=function(e,t){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco-cloud/networks/"+e+"/folders/"+t+"/content"},"alfresco-cloud")},this.getContentInFolder=function(e,t){var o=this.getRepoIdFromAlfrescoServiceId(e);return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+o+"/folders/"+t+"/content"},e)},this.getCloudContentInFolderByPath=function(e,t,o){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco-cloud/networks/"+e+"/sites/"+t+"/folderpath/"+o+"/content"},"alfresco-cloud")},this.getContentInFolderByPath=function(e,t,o){var n=this.getRepoIdFromAlfrescoServiceId(e);return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+n+"/sites/"+t+"/folderpath/"+o+"/content"},e)},this.getGoogleDriveFiles=function(e,t,o){var n={filter:e,parent:t,currentFolderOnly:o};return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/google-drive/files",params:n},"google-drive")},this.getBoxFiles=function(e,t){var o={filter:e,parent:t};return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/box/files",params:o},"box")},this.isBoxMetaDataAllowed=function(){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/box/metadata-status"})}}]),activitiApp.service("RuntimeAppDefinitionService",["$http","$q","$location","EventTrackingService","AuthenticationSharedService","appName",function(e,t,o,n,r,i){var a=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getApplications=function(){var e=r.hasTenantManagementCapability()||r.hasTenantAdminCapability(),t=[],n=o.absUrl(),s=n.indexOf("/#");s>=0&&(n=n.substring(0,s)),s=n.indexOf("?"),s>=0&&(n=n.substring(0,s)),"/"==n[n.length-1]&&(n=n.substring(0,n.length-1)),i.length>0&&n.substring(n.length-i.length)==i&&(n=n.substring(0,n.length-i.length-1));var l={editor:n+"/editor/",identity:n+"/idm/",workflow:n+"/workflow/",admin:"http://localhost:8080/activiti-admin",analytics:n+"/analytics/"},c=function(o){for(var r=JSON.parse(o),i=[],a=0;r.data.length>a;a++){var s=r.data[a];if(void 0!==s.defaultAppId&&null!==s.defaultAppId)if("kickstart"===s.defaultAppId)t.push({id:"kickstart",titleKey:"APP.KICKSTART.TITLE",descriptionKey:"APP.KICKSTART.DESCRIPTION",defaultAppId:s.defaultAppId,theme:"theme-1",icon:"icon icon-choice",fixedBaseUrl:l.editor+"/#/",fixedUrl:l.editor,pages:["processes","forms","apps","stencils","decision-tables","data-models"]});else if("tasks"===s.defaultAppId)t.push({id:"tasks",titleKey:"APP.TASKS.TITLE",descriptionKey:"APP.TASKS.DESCRIPTION",defaultAppId:s.defaultAppId,theme:"theme-2",icon:"icon icon-clock",fixedBaseUrl:l.workflow+"/#/",fixedUrl:l.workflow,pages:["tasks","processes","processes?mode=start"]});else if("identity"===s.defaultAppId){var c={id:"identity",titleKey:e?"APP.IDENTITY-MANAGEMENT.TITLE-TENANT-ADMIN":"APP.IDENTITY-MANAGEMENT.TITLE",descriptionKey:e?"APP.IDENTITY-MANAGEMENT.DESCRIPTION-TENANT-ADMIN":"APP.IDENTITY-MANAGEMENT.DESCRIPTION",defaultAppId:s.defaultAppId,theme:"theme-3",icon:"icon icon-user",fixedBaseUrl:l.identity+"/#/",fixedUrl:l.identity};e&&(c.pages=["tenant-mgmt","user-mgmt","system-group-mgmt","functional-group-mgmt","profile"]),t.push(c)}else"analytics"===s.defaultAppId&&t.push({id:"analytics",titleKey:"APP.ANALYTICS.TITLE",descriptionKey:"APP.ANALYTICS.DESCRIPTION",defaultAppId:s.defaultAppId,theme:"theme-6",icon:"glyphicon glyphicon-stats",fixedBaseUrl:l.analytics+"/#/",fixedUrl:l.analytics});else s.icon="glyphicon "+s.icon,s.fixedBaseUrl=n+"/workflow/#/apps/"+s.id+"/",s.fixedUrl=s.fixedBaseUrl+"tasks",s.pages=["tasks","processes","processes?mode=start"],s.deletable=!0,i.push(s)}return{defaultApps:t,customApps:i}};return a({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/runtime/app-definitions",transformResponse:c})},this.deleteAppDefinition=function(e){var t=a({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/runtime/app-definitions/"+e});return t.then(function(){n.trackEvent("landing","runtime-app-delete")}),t}}]),angular.module("activitiApp").service("ReportService",["$http","$q","EventTrackingService",function(e,t,o){var n=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getReports=function(e){return n({method:"GET",params:{appId:e},url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/reports"})},this.generateDefaultReports=function(){return n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/default-reports"})},this.getReportParameters=function(e){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/report-params/"+e})},this.generateReport=function(e,t){var r=n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/report-params/"+e,data:t});return r.then(function(){o.trackEvent("reporting","generate-report")}),r},this.saveReport=function(e,t,r){r.__reportName=t;var i=n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/reports/"+e,data:r});return i.then(function(){o.trackEvent("reporting","save-report")}),i},this.exportReport=function(e,t,r){r.__reportName=t;var i=n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/reports/"+e+"/export-to-csv",data:r});return i.then(function(e){if(window.navigator.msSaveOrOpenBlob){var n=new Blob([e]);window.navigator.msSaveBlob(n,t+".csv")}else{var r=angular.element("<a/>");r.css({display:"none"}),angular.element(document.body).append(r),r.attr({href:"data:attachment/csv;charset=utf-8,"+encodeURI(e),target:"_blank",download:t+".csv"})[0].click(),r.remove()}o.trackEvent("reporting","export-report")},function(){console.log("Export Report error")}),i},this.updateReport=function(e,t){return n({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/reports/"+e,data:{name:t}})},this.deleteReport=function(e){var t=n({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/reports/"+e});return t.then(function(){o.trackEvent("reporting","delete-report")}),t},this.getTasksForProcessDefinitionId=function(e,t){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/report-params/"+e+"/tasks?processDefinitionId="+t})},this.getProcessDefinitions=function(){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/process-definitions"})},this.getGenerators=function(){return e.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/generators")},this.createReport=function(t){return e.post(ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/generators/"+t)},this.resetReports=function(){return e.delete(ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/reports")}}]),angular.module("activitiApp").service("Utils",[function(){this.getCurrentDateAsFormattedShortString=function(){var e={"ar-SA":"DD/MM/YY","bg-BG":"DD.M.YYYY","ca-ES":"DD/MM/YYYY","zh-TW":"YYYY/M/DD","cs-CZ":"DD.M.YYYY","da-DK":"DD-MM-YYYY","de-DE":"DD.MM.YYYY","el-GR":"d/M/YYYY","en-US":"M/DD/YYYY","fi-FI":"DD.M.YYYY","fr-FR":"DD/MM/YYYY","he-IL":"DD/MM/YYYY","hu-HU":"YYYY. MM. DD.","is-IS":"DD.M.YYYY","it-IT":"DD/MM/YYYY","ja-JP":"YYYY/MM/DD","ko-KR":"YYYY-MM-DD","nl-NL":"DD-M-YYYY","nb-NO":"DD.MM.YYYY","pl-PL":"YYYY-MM-DD","pt-BR":"DD/M/YYYY","ro-RO":"DD.MM.YYYY","ru-RU":"DD.MM.YYYY","hr-HR":"DD.M.YYYY","sk-SK":"DD. M. YYYY","sq-AL":"YYYY-MM-DD","sv-SE":"YYYY-MM-DD","th-TH":"DD/M/YYYY","tr-TR":"DD.MM.YYYY","ur-PK":"DD/MM/YYYY","id-ID":"DD/MM/YYYY","uk-UA":"DD.MM.YYYY","be-BY":"DD.MM.YYYY","sl-SI":"DD.M.YYYY","et-EE":"DD.MM.YYYY","lv-LV":"YYYY.MM.DD.","lt-LT":"YYYY.MM.DD","fa-IR":"MM/DD/YYYY","vi-VN":"DD/MM/YYYY","hY-AM":"DD.MM.YYYY","az-Latn-AZ":"DD.MM.YYYY","eu-ES":"YYYY/MM/DD","mk-MK":"DD.MM.YYYY","af-ZA":"YYYY/MM/DD","ka-GE":"DD.MM.YYYY","fo-FO":"DD-MM-YYYY","hi-IN":"DD-MM-YYYY","ms-MY":"DD/MM/YYYY","kk-KZ":"DD.MM.YYYY","kY-KG":"DD.MM.YY","sw-KE":"M/d/YYYY","uz-Latn-UZ":"DD/MM YYYY","tt-RU":"DD.MM.YYYY","pa-IN":"DD-MM-YY","gu-IN":"DD-MM-YY","ta-IN":"DD-MM-YYYY","te-IN":"DD-MM-YY","kn-IN":"DD-MM-YY","mr-IN":"DD-MM-YYYY","sa-IN":"DD-MM-YYYY","mn-MN":"YY.MM.DD","gl-ES":"DD/MM/YY","kok-IN":"DD-MM-YYYY","sYr-SY":"DD/MM/YYYY","dv-MV":"DD/MM/YY","ar-IQ":"DD/MM/YYYY","zh-CN":"YYYY/M/DD","de-CH":"DD.MM.YYYY","en-GB":"DD/MM/YYYY","es-MX":"DD/MM/YYYY","fr-BE":"d/MM/YYYY","it-CH":"DD.MM.YYYY","nl-BE":"d/MM/YYYY","nn-NO":"DD.MM.YYYY","pt-PT":"DD-MM-YYYY","sr-Latn-CS":"DD.M.YYYY","sv-FI":"DD.M.YYYY","az-CYrl-AZ":"DD.MM.YYYY","ms-BN":"DD/MM/YYYY","uz-CYrl-UZ":"DD.MM.YYYY","ar-EG":"DD/MM/YYYY","zh-HK":"d/M/YYYY","de-AT":"DD.MM.YYYY","en-AU":"d/MM/YYYY","es-ES":"DD/MM/YYYY","fr-CA":"YYYY-MM-DD","sr-CYrl-CS":"d.M.YYYY","ar-LY":"DD/MM/YYYY","zh-SG":"d/M/YYYY","de-LU":"DD.MM.YYYY","en-CA":"DD/MM/YYYY","es-GT":"DD/MM/YYYY","fr-CH":"DD.MM.YYYY","ar-DZ":"DD-MM-YYYY","zh-MO":"DD/M/YYYY","de-LI":"DD.MM.YYYY","en-NZ":"DD/MM/YYYY","es-CR":"DD/MM/YYYY","fr-LU":"DD/MM/YYYY","ar-MA":"DD-MM-YYYY","en-IE":"DD/MM/YYYY","es-PA":"MM/DD/YYYY","fr-MC":"DD/MM/YYYY","ar-TN":"DD-MM-YYYY","en-ZA":"YYYY/MM/DD","es-DO":"DD/MM/YYYY","ar-OM":"DD/MM/YYYY","en-JM":"DD/MM/YYYY","es-VE":"DD/MM/YYYY","ar-YE":"DD/MM/YYYY","en-029":"MM/DD/YYYY","es-CO":"DD/MM/YYYY","ar-SY":"DD/MM/YYYY","en-BZ":"DD/MM/YYYY","es-PE":"DD/MM/YYYY","ar-JO":"DD/MM/YYYY","en-TT":"DD/MM/YYYY","es-AR":"DD/MM/YYYY","ar-LB":"DD/MM/YYYY","en-ZW":"M/DD/YYYY","es-EC":"DD/MM/YYYY","ar-KW":"DD/MM/YYYY","en-PH":"M/DD/YYYY","es-CL":"DD-MM-YYYY","ar-AE":"DD/MM/YYYY","es-UY":"DD/MM/YYYY","ar-BH":"DD/MM/YYYY","es-PY":"DD/MM/YYYY","ar-QA":"DD/MM/YYYY","es-BO":"DD/MM/YYYY","es-SV":"DD/MM/YYYY","es-HN":"DD/MM/YYYY","es-NI":"DD/MM/YYYY","es-PR":"DD/MM/YYYY","am-ET":"d/M/YYYY","tzm-Latn-DZ":"DD-MM-YYYY","iu-Latn-CA":"d/MM/YYYY","sma-NO":"DD.MM.YYYY","mn-Mong-CN":"YYYY/M/DD","gd-GB":"DD/MM/YYYY","en-MY":"DD/M/YYYY","prs-AF":"DD/MM/YY","bn-BD":"DD-MM-YY","wo-SN":"DD/MM/YYYY","rw-RW":"M/d/YYYY","qut-GT":"DD/MM/YYYY","sah-RU":"MM.DD.YYYY","gsw-FR":"DD/MM/YYYY","co-FR":"DD/MM/YYYY","oc-FR":"DD/MM/YYYY","mi-NZ":"DD/MM/YYYY","ga-IE":"DD/MM/YYYY","se-SE":"YYYY-MM-DD","br-FR":"DD/MM/YYYY","smn-FI":"DD.M.YYYY","moh-CA":"M/DD/YYYY","arn-CL":"DD-MM-YYYY","ii-CN":"YYYY/M/DD","dsb-DE":"d. M. YYYY","ig-NG":"d/M/YYYY","kl-GL":"DD-MM-YYYY","lb-LU":"DD/MM/YYYY","ba-RU":"DD.MM.YY","nso-ZA":"YYYY/MM/DD","quz-BO":"DD/MM/YYYY","Yo-NG":"DD/M/YYYY","ha-Latn-NG":"DD/M/YYYY","fil-PH":"M/DD/YYYY","ps-AF":"DD/MM/YY","fY-NL":"DD-M-YYYY","ne-NP":"M/DD/YYYY","se-NO":"DD.MM.YYYY","iu-Cans-CA":"DD/M/YYYY","sr-Latn-RS":"DD.M.YYYY","si-LK":"YYYY-MM-DD","sr-CYrl-RS":"DD.M.YYYY","lo-LA":"DD/MM/YYYY","km-KH":"YYYY-MM-DD","cY-GB":"DD/MM/YYYY","bo-CN":"YYYY/M/DD","sms-FI":"DD.M.YYYY","as-IN":"DD-MM-YYYY","ml-IN":"DD-MM-YY","en-IN":"DD-MM-YYYY","or-IN":"DD-MM-YY","bn-IN":"DD-MM-YY","tk-TM":"DD.MM.YY","bs-Latn-BA":"DD.M.YYYY","mt-MT":"DD/MM/YYYY","sr-CYrl-ME":"DD.M.YYYY","se-FI":"DD.M.YYYY","zu-ZA":"YYYY/MM/DD","xh-ZA":"YYYY/MM/DD","tn-ZA":"YYYY/MM/DD","hsb-DE":"DD. M. YYYY","bs-CYrl-BA":"DD.M.YYYY","tg-CYrl-TJ":"DD.MM.YY","sr-Latn-BA":"DD.M.YYYY","smj-NO":"DD.MM.YYYY","rm-CH":"DD/MM/YYYY","smj-SE":"YYYY-MM-DD","quz-EC":"DD/MM/YYYY","quz-PE":"DD/MM/YYYY","hr-BA":"DD.M.YYYY.","sr-Latn-ME":"DD.M.YYYY","sma-SE":"YYYY-MM-DD","en-SG":"DD/M/YYYY","ug-CN":"YYYY-M-DD","sr-CYrl-BA":"DD.M.YYYY","es-US":"M/DD/YYYY"};return moment().format(e[navigator.language]||"DD/MM/YYYY")}}]),activitiModule.directive("appLinks",["$popover","$timeout","appResourceRoot",function(e){return{restrict:"E",templateUrl:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/app-links-button.html",replace:!0,link:function(){},scope:{},controller:["$scope","$element","RuntimeAppDefinitionService","$translate",function(t,o,n,r){var i;t.goToLink=function(e){t.onDestroyPopover(),window.location.href=e},t.onDestroyPopover=function(){i&&(i.$scope.$destroy(),i.destroy(),i=void 0)},t.showAppLinks=function(){t.apps=[],n.getApplications().then(function(e){for(var o=e.defaultApps.concat(e.customApps),n=0;o.length>n;n++){var i=o[n];if(null!==i.pages&&void 0!==i.pages&&i.pages.length>0){for(var a=0,s=0;i.pages.length>s;s++){var l={};l.name=i.pages[s],l.theme=i.theme,l.icon=i.icon,null!==i.defaultAppId&&void 0!==i.defaultAppId?(l.titleKey=i.titleKey+"-"+l.name.toUpperCase(),l.fixedUrl=i.fixedUrl+"#/"+i.pages[s]):(l.titleKey=r.instant("APP.CUSTOM-APP.TITLE-"+l.name.toUpperCase(),i),l.fixedUrl=i.fixedBaseUrl+i.pages[s]),o.splice(n+s+1,0,l),a++}o.splice(n,1),n=n+a-1}}t.apps=o}),i=e(o,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/app-links-popover.html",placement:"bottom-right",show:!0,scope:t,autoClose:!0}),i.$scope.$on("tooltip.hide",function(){t.onDestroyPopover()})}}]}}]),activitiModule.directive("variableIdentifier",["$rootScope","$timeout",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){function r(e,t){var o="",n=0;for(n=0;e.length>n;n++)t.test(o+e[n])&&(o+=e[n]);return o}e.identifierRegExp=/^[a-zA-Z][_a-zA-Z0-9]*$/,e.forbidenNames=["abstract","continue","for","new","switch","assert","default","if","package","synchronized","boolean","do","goto","private","this","break","double","implements","protected","throw","byte","else","import","public","throws","case","enum","instanceof","return","transient","catch","extends","int","short","try","char","final","interface","static","void","class","finally","long","strictfp","volatile","const","float","native","super","while","null"],e.$watch(o.ngModel,function(t){var i=!0;if(t&&t.length>0){var a=r(t,e.identifierRegExp);a!=t?(n.$setViewValue(a),n.$render()):i=e.identifierRegExp.test(a)?-1==e.forbidenNames.indexOf(a):!1}n.$setValidity(o.ngModel,i)})}}}]),activitiModule.directive("ngTrim",function(){return{require:"ngModel",priority:300,link:function(e,t,o,n){"false"===o.ngTrim&&n.$parsers.unshift(function(){return t.val()})}}}),activitiModule.directive("spacelessValue",["$rootScope","$timeout",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){function r(e,t){var o="",n=0;for(n=0;e.length>n;n++)t.test(o+e[n])&&(o+=e[n]);return o}e.identifierRegExp=/^\S*$/,e.$watch(o.ngModel,function(t){var i=!0;if(t&&t.length>0){var a=r(t,e.identifierRegExp);a!=t?(n.$setViewValue(a),n.$render()):e.identifierRegExp.test(a)||(i=!1)}n.$setValidity(o.ngModel,i)})}}}]),activitiModule.directive("restrictInput",["$parse",function(){return{restrict:"A",require:"ngModel",priority:1002,link:function(e,t,o,n){function r(e){var t=e.toUpperCase(),o=t.replace(/-D-/,"-DD-").replace(/^D-/,"DD-").replace(/-D$/,"-DD"),n=t.replace(/-M-/,"-MM-").replace(/^M-/,"MM-").replace(/-M$/,"-MM"),r=o.replace(/-M-/,"-MM-").replace(/^M-/,"MM-").replace(/-M$/,"-MM");return[t,o,n,r]}function i(e,t){if(void 0===e||null==e||""===e)return!0;if(e.length>t.length)return!1;for(var o=0;Math.min(t.length,e.length)>o;o++){var n=t[o];if(n.toUpperCase().match(/D|M|Y/)){if(null==e[o].match(/\d/))return!1}else if(e[o]!=n)return!1}return!0}var a=o.restrictInput;(void 0==a||null==a||""==a)&&(a=o.dateFormat),e.field&&(e.field.acceptedFormat=a);var s=r(a),l=!1;(void 0==a||null==a||""==a)&&(l=!0);var c=n.$render;n.$render=function(){t.val(n.$viewValue),n.$dateValue&&!isNaN(n.$dateValue.getTime())&&c&&c()},n.$parsers.unshift(function(e){if(l)return e;for(var t=!1,o=0;s.length>o&&!t;o++)t|=i(e,s[o]);return t?(n.$lastValidText=e,(void 0===e||null==e||""===e)&&(n.$dateValue=null),e):(n.$dateValue=null,n.$setViewValue(n.$lastValidText),n.$render(),n.$lastValidText)})}}}]),activitiModule.directive("autoHeight",["$rootScope","$timeout",function(e,t){return{restrict:"AC",scope:{toWatch:"=autoHeight"},compile:function(){return function(o,n,r){var i=0;r.offset&&(i=parseInt(r.offset),(0/0==i||void 0==i)&&(i=0));var a=function(e){t(function(){var t=e.parent().outerHeight()-i,o=!1;e.parent().children().filter(":visible").each(function(){o||(e[0]==this?o=!0:t-=angular.element(this).outerHeight())}),o&&e.height(t)},0)};o.$watch("toWatch",function(){a(n)}),o.unregisterWatcher&&o.unregisterWatcher(),o.unregisterWatcher=e.$watch("window.height",function(){a(n)}),o.unregisterForceWatcher&&o.unregisterForceWatcher(),o.unregisterForceWatcher=e.$watch("window.forceRefresh",function(){a(n)}),o.$on("$destroy",function(){o.unregisterWatcher&&o.unregisterWatcher(),o.unregisterForceWatcher&&o.unregisterForceWatcher()})}}}}]),activitiModule.directive("scrollToActive",["$timeout",function(e){return{restrict:"AC",scope:{toWatch:"=scrollToActiveModel"},compile:function(){return function(t,o,n){t.$watch("toWatch",function(){e(function(){var e=n.useParent,t=n.offsetTop;t&&(t=parseInt(t),0/0==t&&(t=0)),t||(t=0);var r=o.children(".active");if(r&&r.length>0){var i=angular.element(r[0]);e&&(o=angular.element(o.parent()));var a=i.position().top-o.position().top+o.scrollTop(),s=a+i.outerHeight(),l=o.scrollTop()+o.innerHeight(),c=l-o.innerHeight();c>=a?o.scrollTop(a-i.outerHeight()-t):s>l&&o.scrollTop(c+i.outerHeight()-t)}},0)})}}}}]),activitiModule.directive("autoScroll",["$timeout",function(e){return{restrict:"AC",compile:function(){return function(t,o){t.$on("tooltip.show",function(){e(function(){for(var e=o[0];e&&!(e.className&&e.className.indexOf("scroll-container")>=0);)e=e.parentNode;if(e){e=angular.element(e);var t=o.offset().top-e.offset().top+o.scrollTop(),n=t+o.outerHeight();n+30>=e.outerHeight()&&e.scrollTop(t)}},50)})}}}}]),activitiModule.directive("userName",function(){var e={};return e.template='{{user.firstName && user.firstName || ""}} {{user.lastName && user.lastName || ""}} {{ (user.email && !user.firstName && !user.lastName) && user.email || ""}}',e.scope={user:"=userName"},e}),activitiModule.directive("clickAnywhere",["$document","$parse",function(e,t){var o=function(o,n,r){var i=r.clickAnywhere,a=t(i),s=r.ignore,l=r.ignoreClass,c="true"==r.ignorePopupEvents,d=function(e){for(var t=e.target;t;){if(t==n[0]||s&&t.id==s||l&&t.className&&t.className.indexOf(l)>=0)return e.stopPropagation(),e.preventDefault(),void 0;t=t.parentNode}o.$apply(function(){a(o,{$event:e})})};e.on("click",d),o.$on("$destroy",function(){e.off("click",d)});var u=o.$on("tooltip.hide",function(){c||(e.off("click",d),u())})};return o}]),activitiModule.directive("autoFocus",["$timeout","$parse",function(e,t){return{restrict:"AC",compile:function(o,n){var r;return n.selectText&&(r=t(n.selectText)),function(t,o,n){var i=void 0!==n.focusFirstChild;e(function(){if(i){var e=o.find("input");e&&e.length>0&&(e[0].focus(),r&&r(t.$parent)&&input[0].setSelectionRange(0,input[0].value.length))}else o[0].focus(),r&&r(t.$parent)&&o[0].setSelectionRange(0,o[0].value.length)},100)}}}}]),activitiModule.directive("focusWhen",["$timeout",function(e){return{link:function(t,o,n){t.$watch(n.ngFocus,function(t){angular.isDefined(t)&&t&&e(function(){o[0].focus()})},!0),o.bind("blur",function(){angular.isDefined(n.ngFocusLost)&&t.safeApply(n.ngFocusLost)})}}}]),activitiModule.directive("loading",[function(){var e={};return e.restrict="A",e.template='<div class="loading" ng-show="loading"><div class="l1"></div><div class="l2"></div><div class="l3"></div></div>',e.scope={loading:"=loading",loadingText:"=loadingText"},e}]),activitiModule.directive("activitiFixDropdownBug",function(){return{restrict:"AEC",link:function(e,t){t.on("hidden.bs.dropdown	",function(){t.show()})}}}),activitiModule.directive("userLink",function(){var e={};return e.template='{{user.firstName && user.firstName || ""}} {{user.lastName && user.lastName || ""}} {{ (user.email && !user.firstName && !user.lastName) && user.email || ""}}',e.scope={user:"=userLink"},e.compile=function(e){e.addClass("people-link")},e}),activitiModule.directive("formField",function(){var e={};return e.template=' {{field.name || ""}} - {{field.id}}',e.scope={field:"=formField"},e.compile=function(e){e.addClass("form-field")},e}),activitiModule.directive("customKeys",["$parse",function(e){var t={};return t.compile=function(t,o){var n,r,i,a;return o.upPressed&&(n=e(o.upPressed)),o.downPressed&&(r=e(o.downPressed)),o.enterPressed&&(i=e(o.enterPressed)),o.escapePressed&&(a=e(o.escapePressed)),function(e,t){t.on("keyup",function(t){38===t.keyCode?e.$apply(function(){n&&n(e,{$event:t})}):40===t.keyCode?e.$apply(function(){r&&r(e,{$event:t})}):13===t.keyCode?e.$apply(function(){i&&i(e,{$event:t})}):27===t.keyCode&&e.$apply(function(){a&&a(e,{$event:t})})}),t.on("keydown",t,function(e){(38===e.keyCode||40===e.keyCode||13===e.keyCode||27===e.keyCode)&&e.preventDefault()})}},t}]),activitiModule.directive("delayedModel",["$timeout",function(e){return{scope:{targetModel:"=delayedModel"},link:function(t,o,n){o.val(t.targetModel),t.$watch("targetModel",function(n,i){r&&e.cancel(r),n!==i&&o.val(t.targetModel)});var r;o.on("keyup paste search",function(){o.val()!==t.targetModel&&(r&&e.cancel(r),r=e(function(){t.targetModel=o[0].value,o.val(t.targetModel),t.$apply()},n.delay||200))})}}}]),activitiModule.directive("ngDebounce",["$timeout",function(e){return{restrict:"A",require:"ngModel",priority:99,link:function(t,o,n,r){if("radio"!==n.type&&"checkbox"!==n.type){o.unbind("input");var i;o.bind("input",function(){e.cancel(i),i=e(function(){t.$apply(function(){r.$setViewValue(o.val())})},n.ngDebounce||1e3)}),o.bind("blur",function(){t.$apply(function(){r.$setViewValue(o.val())})})}}}}]),activitiModule.directive("externalContentAuthenticator",["$parse","$timeout",function(){var e={};return e.restrict="A",e.templateUrl=ACTIVITI.CONFIG.webContextRoot+"/views/common/templates/external-content-authenticator-template.html",e.scope={taskId:"=taskId",accountType:"@accountType"},e.controller=["$scope","$element","ContentAccountService","$modal","$window","$translate","$rootScope",function(e,t,o,n,r,i,a){e.$on("integration.account.error",function(t,o){e.currentAccount&&o==e.currentAccount.serviceId&&e.contentBrowseModal&&("alfresco-cloud"===o?i("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"google-drive"===o?i("INTEGRATION.ALERT.GOOGLE-DRIVE-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"box"===o&&i("INTEGRATION.ALERT.BOX-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}))}),e.openAuthenticationPopup=function(t,o){e.openContentAccountAuth(t,o)},e.clearPopupError=function(){e.contentBrowseModal&&(e.contentBrowseModal.$scope.errorMessage=void 0)},e.$on("integration.account.autherror",function(t,o){o&&(e.contentAccounts[o].authorized=!1,"alfresco-cloud"===o?i("INTEGRATION.ALERT.ALFRESCO-CLOUD-NOT-AUTHORIZED").then(function(t){a.addAlert(t,"error"),e.errorMessage=t}):"google-drive"===o?i("INTEGRATION.ALERT.GOOGLE-DRIVE-NOT-AUTHORIZED").then(function(t){a.addAlert(t,"error"),e.errorMessage=t}):"box"===o&&i("INTEGRATION.ALERT.BOX-NOT-AUTHORIZED").then(function(t){a.addAlert(t,"error"),e.errorMessage=t
}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide())}),e.openContentAccountAuth=function(t,o){var n=angular.element(r),i=(n.width()-500)/2,a=(n.height()-400)/2,s=r.open(e.contentAccounts[o].authorizationUrl,o,"width= 500, height=400, toolbar=no, status=no, titlebar=no, location=no, menubar=no, top="+a+", left="+i);r.contentAccountAuthConfirmed=function(){e.$apply(function(){e.contentAccounts[o].authorizationUrl=void 0,e.contentAccounts[o].authorized=!0,e.currentAccount=e.contentAccounts[o],s.close(),e.$emit("task-completed",{taskId:e.taskId})})},r.contentAccountAuthFailed=function(t,o){e.$apply(function(){s.close(),e.showErrorModal(t,o)})}},e.showErrorModal=function(t,o){e.errorModel={error:t,details:o},_internalCreateModal({scope:e,template:"views/popup/error-popup.html",show:!0},n,e)},e.loadAccounts=function(){e.contentAccounts={loading:!0},o.getAccounts().then(function(t){if(t&&t.data)for(var o=0;t.data.length>o;o++){var n=t.data[o];e.contentAccounts[n.serviceId]=n}e.contentAccounts.rawList=t.data,e.contentAccounts.loading=!1})},e.loadAccounts()}],e}]),activitiModule.directive("externalContent",["$rootScope","$parse","$timeout",function(e,t,o){var n={};return n.restrict="A",n.templateUrl=ACTIVITI.CONFIG.webContextRoot+"/views/common/templates/external-content-template.html",n.scope={taskId:"=taskId",processInstanceId:"=formDefinition",folderSelect:"=folderSelect",linkOnly:"=linkOnly",preSelectedAccount:"=account",uploadInProgress:"=uploadInProgress",isRelatedContent:"=isRelatedContent",contentSource:"=?contentSource",allowMultiple:"=allowMultiple"},n.link=function(n,r,i){n.readOnly=e.readOnly,i.onContentUpload&&(n.uploadedCallback=t(i.onContentUpload)),i.onFolderSelect&&(n.folderSelectCallback=t(i.onFolderSelect)),i.onUploadInProgress&&(n.uploadInProgressCallback=t(i.onUploadInProgress)),o(function(){r.find("div.select-file").click(function(){r.find('input[type="file"]').click()})},200)},n.controller=["$scope","$element","RelatedContentService","ContentAccountService","$modal","$window","$translate","$rootScope",function(e,t,o,n,r,i,a,s){e.uploadModel={uploading:!1},e.BOX_DRIVE_ACCOUNT_ID="box",e.GOOGLE_DRIVE_ACCOUNT_ID="google-drive",e.ALFRESCO_ACCOUNT_ID_PREFIX="alfresco-",e.ALFRESCO_CLOUD_ACCOUNT_ID="alfresco-cloud",e.ALL_SOURCES_ACCOUNT_ID="all-file-sources",e.LOCAL_FILE_ACCOUNT_ID="local-file",e.filterNavigableContent=function(t){return!t.folder||(!e.contentSource||e.contentSource&&!e.contentSource.notAllowNavigateFolders)&&t.folder},e.browseButtonIsVisible=function(){return!e.linkOnly&&(e.contentSource&&(e.contentSource.serviceId===e.ALL_SOURCES_ACCOUNT_ID||e.contentSource.serviceId===e.LOCAL_FILE_ACCOUNT_ID)||!e.contentSource)},e.contentAccountsByServiceId=function(t){return!e.contentSource||e.contentSource.serviceId===e.ALL_SOURCES_ACCOUNT_ID||e.contentSource.serviceId===t.serviceId||e.contentSource.serviceId.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX&&t.name&&e.contentSource.name===t.name},e.selectFolder=function(t){if(e.preSelectedAccount||e.folderSelect){var o=e.folderSelect;if(o.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX){if(e.preSelectedAccount.name){var n=!1;for(var r in e.contentAccounts){var i=e.contentAccounts[r];i.serviceId&&e.preSelectedAccount.serviceId===i.serviceId&&(n=!0)}if(!n)for(var r in e.contentAccounts){var i=e.contentAccounts[r];i.serviceId&&i.name&&e.preSelectedAccount.name===i.name&&(e.preSelectedAccount=i)}}o=e.ALFRESCO_CLOUD_ACCOUNT_ID}(o===e.ALFRESCO_CLOUD_ACCOUNT_ID||o===e.GOOGLE_DRIVE_ACCOUNT_ID||o===e.BOX_DRIVE_ACCOUNT_ID)&&e.browseRepositoryContent(t,o,e.preSelectedAccount)}},e.$on("integration.account.error",function(t,o){e.currentAccount&&o==e.currentAccount.serviceId&&e.contentBrowseModal&&("alfresco-cloud"===o?a("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"google-drive"===o?a("INTEGRATION.ALERT.GOOGLE-DRIVE-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"box"===o?a("INTEGRATION.ALERT.BOX-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):a("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}))}),e.clearPopupError=function(){e.contentBrowseModal&&(e.contentBrowseModal.$scope.errorMessage=void 0)},e.$on("integration.account.autherror",function(t,o){o&&(e.contentAccounts[o].authorized=!1,o===e.ALFRESCO_CLOUD_ACCOUNT_ID?(a("INTEGRATION.ALERT.ALFRESCO-CLOUD-NOT-AUTHORIZED").then(function(t){s.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()):o==e.GOOGLE_DRIVE_ACCOUNT_ID?(a("INTEGRATION.ALERT.GOOGLE-DRIVE-NOT-AUTHORIZED").then(function(t){s.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()):"box"==o&&(a("INTEGRATION.ALERT.BOX-NOT-AUTHORIZED").then(function(t){s.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()))}),e.openFileSelect=function(t){e.errorMessage=void 0;var o=angular.element(t).parent();o.children("input").click()},e.confirmFolderSelection=function(){if(e.currentFolderTree&&e.folderSelectCallback){var t=e.createContentBrowserPayload(e.currentAccount);e.folderSelectCallback(e.$parent,{folder:t}),e.contentBrowseModal.$scope.$hide()}},e.confirmBoxFolderSelection=function(){var t=0;if(e.folderSelectCallback){var o="";e.currentFolderTree&&e.currentFolderTree.length>0?(o=e.pathFromFolderTree(e.currentFolderTree),t=e.currentFolderTree[e.currentFolderTree.length-1].id):(o+="/",t=0);var n={account:{id:e.currentAccount.serviceId,name:e.currentAccount.name},path:{id:t,title:o}};e.folderSelectCallback(e.$parent,{folder:n}),e.contentBrowseModal.$scope.$hide()}},e.onFileSelect=function(t,n){if(e.errorMessage=void 0,!e.linkOnly&&(e.errorMessage=void 0,!e.folderSelect&&!e.uploadModel.uploading&&t.length>0))for(var r=0;t.length>r;r++){e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!0}),e.uploadModel.uploading=!0;var i=t[r];e.clearPopupError(),o.addRelatedContent(e.taskId,e.processInstanceId,i,n,e.isRelatedContent).progress(function(t){e.uploadModel.uploadProgress=parseInt(100*t.loaded/t.total)}).then(function(t){e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!1}),e.uploadModel.uploading=!1,e.uploadedCallback&&e.uploadedCallback(e.$parent,{content:t})},function(t){if(e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!1}),t&&t.messageKey){var o={};t.customData&&(o.quota=e.formatFileSize(t.customData.quota)),a(t.messageKey,o).then(function(t){e.errorMessage=t})}e.uploadModel.uploading=!1})}},e.selectAccountContent=function(t,o){e.currentAccount=o,o.serviceId===e.GOOGLE_DRIVE_ACCOUNT_ID?e.selectGoogleDriveContent(t):o.serviceId==e.BOX_DRIVE_ACCOUNT_ID?e.selectBoxContent(t):e.browseRepositoryContent(t,e.ALFRESCO_CLOUD_ACCOUNT_ID,o)},e.selectGoogleDriveContent=function(t){e.errorMessage=void 0,e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].authorized?e.openGoogleDriveBrowser(t):e.openContentAccountAuth(t,e.GOOGLE_DRIVE_ACCOUNT_ID))},e.selectBoxContent=function(t){e.errorMessage=void 0,e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].authorized?e.openBoxBrowser(t):e.openContentAccountAuth(t,e.BOX_DRIVE_ACCOUNT_ID))},e.browseRepositoryContent=function(t,o,n){n&&n.serviceId!==e.BOX_DRIVE_ACCOUNT_ID&&n.serviceId!==e.ALFRESCO_CLOUD_ACCOUNT_ID&&n.serviceId!==e.GOOGLE_DRIVE_ACCOUNT_ID?(e.currentAccount=n,e.openContentAccountBrowser(t,o)):(e.errorMessage=void 0,e.account&&e.account.authorized?(e.currentAccount=n,e.openContentAccountBrowser(t,o)):e.contentAccounts[o]&&e.contentAccounts[o].authorized?(e.currentAccount=e.contentAccounts[o],e.openContentAccountBrowser(t,o)):e.openContentAccountAuth(t,o))},e.openContentAccountAuth=function(t,o){var n=angular.element(i),r=(n.width()-500)/2,a=(n.height()-400)/2,s=i.open(e.contentAccounts[o].authorizationUrl,o,"width= 500, height=400, toolbar=no, status=no, titlebar=no, location=no, menubar=no, top="+a+", left="+r);i.contentAccountAuthConfirmed=function(){e.$apply(function(){e.contentAccounts[o].authorizationUrl=void 0,e.contentAccounts[o].authorized=!0,e.currentAccount=e.contentAccounts[o],s.close(),e.openContentAccountBrowser(t,o)})},i.contentAccountAuthFailed=function(t,o){e.$apply(function(){s.close(),e.showErrorModal(t,o)})}},e.showErrorModal=function(t,o){e.errorModel={error:t,details:o},_internalCreateModal({scope:e,template:"views/popup/error-popup.html",show:!0},r,e)},e.openContentAccountBrowser=function(t,o){o===e.GOOGLE_DRIVE_ACCOUNT_ID?e.openGoogleDriveBrowser(t):o===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.openAlfrescoBrowser(t):o===e.BOX_DRIVE_ACCOUNT_ID&&e.openBoxBrowser(t)},e.loadLastPath=function(t){e.currentFolderTree=angular.copy(e.currentAccount.lastPath.currentFolderTree),e.selectedNetwork=angular.copy(e.currentAccount.lastPath.selectedNetwork),e.selectedSite=angular.copy(e.currentAccount.lastPath.selectedSite),e.alfrescoSites=angular.copy(e.currentAccount.lastPath.alfrescoSites),t===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.loadLastPathAlfrescoCloud():t===e.BOX_DRIVE_ACCOUNT_ID?e.loadLastPathBox():t===e.GOOGLE_DRIVE_ACCOUNT_ID&&e.loadLastPathGoogleDrive()},e.loadLastPathAlfrescoCloud=function(){e.currentContent.data=[angular.copy(e.currentAccount.lastPath.currentContent)]},e.loadLastPathGoogleDrive=function(){e.googleDriveFiles.data=[angular.copy(e.currentAccount.lastPath.googleDriveFiles)]},e.loadLastPathBox=function(){e.boxFiles.data=[angular.copy(e.currentAccount.lastPath.boxFiles)]},e.saveLastPath=function(t,o){e.currentAccount.lastPath={},e.currentAccount.rememberPath=!0,e.currentAccount.lastPath.currentFolderTree=angular.copy(e.currentFolderTree),e.currentAccount.lastPath.selectedNetwork=angular.copy(e.selectedNetwork),e.currentAccount.lastPath.selectedSite=angular.copy(e.selectedSite),e.currentAccount.lastPath.alfrescoSites=angular.copy(e.alfrescoSites),t===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.saveLastPathAlfrescoCloud(o):t===e.BOX_DRIVE_ACCOUNT_ID?e.saveLastPathBox(o):t===e.GOOGLE_DRIVE_ACCOUNT_ID&&e.saveLastPathGoogleDrive(o)},e.saveLastPathAlfrescoCloud=function(t){e.currentAccount.lastPath.currentContent=angular.copy(t)},e.saveLastPathGoogleDrive=function(t){e.currentAccount.lastPath.googleDriveFiles=angular.copy(t)},e.saveLastPathBox=function(t){e.currentAccount.lastPath.boxFiles=angular.copy(t)},e.openAlfrescoBrowser=function(){if(e.currentAccount.rememberPath?e.loadLastPath(e.ALFRESCO_CLOUD_ACCOUNT_ID):(e.currentFolderTree=[],e.selectedNetwork=void 0,e.selectedSite=void 0,e.selectedFolder=void 0,e.alfrescoSites=void 0),e.contentSource&&e.contentSource.serviceId.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX){var t=e.contentSource.selectedFolder;t&&(e.selectedNetwork={id:t.network},e.selectedSite={id:t.siteId,title:t.site},e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.currentAccount.rememberPath?e.loadFolderContent():e.contentSource&&e.contentSource.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.loadAlfrescoNetworks(function(){e.loadAlfrescoSites(e.loadFolderContent)}):e.currentAccount&&e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?(e.uploadModel.noNetwork=!1,e.loadAlfrescoNetworks()):(e.uploadModel.noNetwork=!0,e.loadAlfrescoSites(e.loadFolderContent)),e.createContentBrowserPayload=function(t){var o=e.pathFromFolderTree(e.currentFolderTree),n=null;e.currentFolderTree.length>0&&(n=e.currentFolderTree[e.currentFolderTree.length-1].id);var r={path:{id:n,title:o,folderTree:e.currentFolderTree}};return e.uploadModel.noNetwork?r.account={id:t.serviceId,name:t.name}:r.network=e.selectedNetwork.id,r.site={id:e.selectedSite.id,title:e.selectedSite.title},r},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-alfresco-cloud.html",show:!0,scope:e},r,e)},e.selectNetwork=function(t){e.currentAccount.loading||e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID&&(e.selectedNetwork=t,e.selectedSite=void 0,e.alfrescoSites=void 0,t&&e.loadAlfrescoSites())},e.selectSite=function(t){e.currentAccount.loading||(e.selectedSite=t,e.alfrescoFolders=void 0,t?e.loadSiteContent():e.currentFolderTree=[])},e.loadAlfrescoNetworks=function(t){e.currentAccount.loading||(e.currentAccount.loading=!0,e.clearPopupError(),n.getNetworks().then(function(o){e.alfrescoNetworks=o,e.currentAccount.loading=!1,t&&t()}))},e.loadAlfrescoSites=function(t){e.currentAccount.loading||(e.currentAccount.loading=!0,e.clearPopupError(),e.currentAccount&&e.currentAccount.serviceId!==e.ALFRESCO_CLOUD_ACCOUNT_ID?n.getSites(e.currentAccount.serviceId).then(function(o){e.alfrescoSites=o,e.currentAccount.loading=!1,t&&t()}):e.selectedNetwork?n.getCloudSites(e.selectedNetwork.id).then(function(o){e.alfrescoSites=o,e.currentAccount.loading=!1,t&&t()}):(e.currentAccount.loading=!1,t&&t()))},e.loadSiteContent=function(){e.currentAccount.loading||(e.currentAccount.loading=!0,e.currentFolderTree=[],e.currentContent=void 0,e.clearPopupError(),e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?n.getCloudContentInSite(e.selectedNetwork.id,e.selectedSite.id).then(function(t){e.currentContent=t,e.currentAccount.loading=!1}):n.getContentInSite(e.currentAccount.serviceId,e.selectedSite.id).then(function(t){e.currentContent=t,e.currentAccount.loading=!1}))},e.navigateToFolder=function(t){var o=e.currentFolderTree[t];o&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),e.selectedFolder=o,e.loadFolderContent())},e.pathFromFolderTree=function(e){for(var t="",o=0;e.length>o;o++)o>0&&(t+=" > "),t+=e[o].title;return t},e.loadFolderContent=function(t){if(e.selectedFolder&&!e.currentAccount.loading){e.currentContent=void 0,e.currentAccount.loading=!0,e.clearPopupError();var o=e.pathFromFolderTree(e.currentFolderTree);e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?n.getCloudContentInFolderByPath(e.selectedNetwork.id,e.selectedSite.id,o).then(function(o){e.currentContent=o,e.currentAccount.loading=!1,t&&t()}).catch(function(){n.getCloudContentInFolder(e.selectedNetwork.id,e.selectedFolder.id).then(function(o){e.currentContent=o,e.currentAccount.loading=!1,t&&t()})}):n.getContentInFolderByPath(e.currentAccount.serviceId,e.selectedSite.id,o).then(function(o){e.currentContent=o,e.currentAccount.loading=!1,t&&t()}).catch(function(){n.getContentInFolder(e.currentAccount.serviceId,e.selectedFolder.id).then(function(o){e.currentContent=o,e.currentAccount.loading=!1,t&&t()})})}},e.openBoxBrowser=function(){if(e.currentAccount.rememberPath?e.loadLastPath(e.BOX_DRIVE_ACCOUNT_ID):e.currentFolderTree=[],e.contentSource&&e.contentSource.serviceId===e.BOX_DRIVE_ACCOUNT_ID){var t=e.contentSource.selectedFolder;t&&(e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.createContentBrowserPayload=function(t){var o=e.pathFromFolderTree(e.currentFolderTree),n=null;return e.currentFolderTree.length>0&&(n=e.currentFolderTree[e.currentFolderTree.length-1].id),{path:{id:n,title:o,folderTree:e.currentFolderTree},account:{id:t.serviceId,name:t.name}}},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-box.html",show:!0,scope:e},r,e),e.contentBrowseModal.$scope.$watch("filter",function(t){e.loadBoxFiles(t)})},e.navigateToBoxFolder=function(t){var o=e.currentFolderTree[t];o&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles(""))},e.navigateToBoxRoot=function(){e.currentFolderTree=[],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles("")},e.loadBoxFiles=function(t){e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].loading=!0),t||(e.boxFiles=void 0);var o;e.currentFolderTree&&e.currentFolderTree.length>0&&(o=e.currentFolderTree[e.currentFolderTree.length-1].id),n.getBoxFiles(t,o).then(function(t){e.boxFiles=t,e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].loading=!1})},e.openGoogleDriveBrowser=function(){if(e.currentAccount.rememberPath?e.loadLastPath(e.GOOGLE_DRIVE_ACCOUNT_ID):e.currentFolderTree=[],e.contentSource&&e.contentSource.serviceId===e.GOOGLE_DRIVE_ACCOUNT_ID){var t=e.contentSource.selectedFolder;t&&(e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.createContentBrowserPayload=function(t){var o=e.pathFromFolderTree(e.currentFolderTree),n=null;return e.currentFolderTree.length>0&&(n=e.currentFolderTree[e.currentFolderTree.length-1].id),{path:{id:n,title:o,folderTree:e.currentFolderTree},account:{id:t.serviceId,name:t.name}}},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-google-drive.html",show:!0,scope:e},r,e),e.contentBrowseModal.$scope.$watch("filter",function(t){e.loadGoogleDriveFiles(t)})},e.navigateToGoogleDriveFolder=function(t){var o=e.currentFolderTree[t];o&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles(""))},e.navigateToGoogleDriveRoot=function(){e.currentFolderTree=[],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles("")},e.loadGoogleDriveFiles=function(t){e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!0),t||(e.googleDriveFiles=void 0);var o;e.currentFolderTree&&e.currentFolderTree.length>0&&(o=e.currentFolderTree[e.currentFolderTree.length-1].id);var r=!1;e.contentSource&&e.contentSource.notAllowNavigateFolders&&1==e.contentSource.notAllowNavigateFolders&&(r=!0),n.getGoogleDriveFiles(t,o,r).then(function(t){e.googleDriveFiles=t,e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!1})},e.addContentFromSource=function(t,n,r,i,a,s,l){o.addRelatedContentFromSource(e.taskId,e.processInstanceId,t,n,r,i,a,e.linkOnly,e.isRelatedContent).then(function(t){e.uploadedCallback&&e.uploadedCallback(e.$parent,{content:t}),s&&s(t)},function(e){l&&l(e)})},e.boxContentSelected=function(t){t.folder?(e.currentFolderTree&&0!=e.currentFolderTree.length?e.currentFolderTree.push(t):e.currentFolderTree=[t],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles("")):(e.contentAccounts.box.loading=!0,e.saveLastPath(e.BOX_DRIVE_ACCOUNT_ID,t),e.addContentFromSource("box",t.id,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide()},function(){e.contentBrowseModal.$scope.$hide()}),t.title="Uploading: "+t.title,e.boxFiles.data=[t])},e.googleDriveContentSelected=function(t){t.folder?(e.currentFolderTree&&0!=e.currentFolderTree.length?e.currentFolderTree.push(t):e.currentFolderTree=[t],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles("")):(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!0,e.saveLastPath(e.GOOGLE_DRIVE_ACCOUNT_ID,t),e.addContentFromSource(e.GOOGLE_DRIVE_ACCOUNT_ID,t.id,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide()},function(){e.contentBrowseModal.$scope.$hide()}),t.title="Uploading: "+t.title,e.googleDriveFiles.data=[t])},e.selectAlfrescoContent=function(t){if(!e.currentAccount.loading)if(e.clearPopupError(),t.folder)e.currentFolderTree.push(t),e.selectedFolder=t,e.loadFolderContent();else if(!e.folderSelect){e.currentAccount.loading=!0,e.saveLastPath(e.ALFRESCO_CLOUD_ACCOUNT_ID,t);var o;o=e.currentAccount&&e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?t.id+"@"+e.selectedSite.id+"@"+e.selectedNetwork.id:t.id+"@"+e.selectedSite.id,e.addContentFromSource(e.currentAccount.serviceId,o,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide(),e.currentAccount.loading=!1},function(){e.contentBrowseModal.$scope.$hide(),e.currentAccount.loading=!1}),t.title="Uploading: "+t.title,e.currentContent.data=[t]}},e.formatFileSize=function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]},e.loadAccounts=function(){e.contentAccounts={loading:!0},n.getAccounts().then(function(t){if(t&&t.data)for(var o=0;t.data.length>o;o++){var n=t.data[o];e.contentAccounts[n.serviceId]=n}e.contentAccounts.rawList=t.data,e.contentAccounts.loading=!1})},e.loadAccounts()}],n}]),activitiModule.directive("selectPeoplePopover",["$rootScope","$http","$popover","appResourceRoot","UserService","SystemPropertiesService","$parse",function(e,t,o,n,r,i,a){var s={};return s.restrict="A",s.scope={excludeTaskId:"=excludeTaskId",excludeProcessId:"=excludeProcessId",excludeUserId:"=excludeUserId",excludeUserIds:"=excludeUserIds",tenantId:"=tenantId",type:"=type",restrictWithGroup:"=restrictWithGroup",selectPeopleFormFields:"=selectPeopleFormFields",ignoreContainer:"=ignoreContainer",emailModeDisabled:"=emailModeDisabled"},s.link=function(t,n,s){function l(e){g.popupModel.emailDisabled="true"===e||e===!0?!0:"false"===e||e===!1?!1:t.$eval(e)}var c="bottom";n.addClass("toggle-people-select"),s.placement&&(c=s.placement);var d=s.selectYourselfMode,u=!0;void 0!==s.closeOnSelect&&(u=s.closeOnSelect),t.popover=o(n,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/select-people-popover.html?"+Date.now(),placement:c});var p,m,f;s.onPeopleSelected&&(p=a(s.onPeopleSelected)),s.onCancel&&(m=a(s.onCancel)),s.onEmailSelected&&(f=a(s.onEmailSelected));var v="workflow";null!==t.type&&void 0!==t.type&&(v=t.type);var g=t.popover.$scope;g.title=s.popoverTitle,g.popupModel={emailMode:!1,showRecentResults:!1,userResults:[],userField:{},userFieldFilter:["people"],loading:!1},t.selectPeopleFormFields&&(g.popupModel.formFields=t.selectPeopleFormFields),(s.emailModeDisabled||t.emailModeDisabled)&&(l(t.emailModeDisabled||s.emailModeDisabled),s.hasOwnProperty("emailModeDisabled")&&t.$watch(s.emailModeDisabled,l),t.hasOwnProperty("emailModeDisabled")&&t.$watch("emailModeDisabled",l)),(void 0==g.popupModel.emailDisabled||0==g.popupModel.emailDisabled)&&i.getSystemProperties().then(function(e){g.popupModel.emailDisabled=!e.allowInvolveByEmail});var h=function(){if(g.popupModel.emailMode=!1,e.account&&e.account.capabilities){var t=e.account.capabilities.indexOf("tenant-mgmt")>-1||e.account.capabilities.indexOf("tenant-admin")>-1;t===!1&&(null===g.account.tenantId||void 0===g.account.tenantId)&&(g.popupModel.emailMode=!0)}};h(),g.setSearchType=function(){g.popupModel.userSourceType="search"},g.setFormFieldType=function(){g.popupModel.userSourceType="field"},g.$watch("popupModel.userField",function(){if(g.popupModel.userField&&g.popupModel.userField.id){if(p){var e={id:g.popupModel.userField.id,name:g.popupModel.userField.name,email:g.popupModel.userField.email,type:g.popupModel.userField.type};p(t.$parent,{userField:e}),g.popupModel.userField={}}(u||"true"===u)&&g.$hide()}}),g.$watch("popupModel.filter",function(){if(g.popupModel.filter&&g.popupModel.filter.length>0){g.popupModel.loading=!0;var e;e="idm"===v?r.getFilteredUsersStrict(g.popupModel.filter,t.tenantId,t.restrictWithGroup):r.getFilteredUsers(g.popupModel.filter,t.excludeTaskId,t.excludeProcessId,t.tenantId,t.restrictWithGroup),e.then(function(e){g.popupModel.showRecentResults=!1,g.popupModel.loading=!1;var o=[],n=null!==t.excludeUserId&&void 0!==t.excludeUserId,r=null!==t.excludeUserIds&&void 0!==t.excludeUserIds;if(n===!0||r===!0)for(var i=0;e.data.length>i;i++){var a=!1;n===!0&&e.data[i].id===t.excludeUserId&&(a=!0),r===!0&&t.excludeUserIds.indexOf(e.data[i].id)>=0&&(a=!0),a||o.push(e.data[i])}else o=e.data;g.popupModel.userResults=o,g.resetSelection()})}else g.resetSelection(),g.popupModel.userResults=[]}),g.resetSelection=function(){g.popupModel.selectedUser=void 0,g.popupModel.selectedIndex=-1},g.nextUser=function(){var e=g.popupModel.userResults;e&&e.length>0&&g.popupModel.selectedIndex<e.length-1&&(g.popupModel.selectedIndex+=1,g.popupModel.selectedUser=e[g.popupModel.selectedIndex])},g.previousUser=function(){var e=g.popupModel.userResults;e&&e.length>0&&g.popupModel.selectedIndex>0&&(g.popupModel.selectedIndex-=1,g.popupModel.selectedUser=e[g.popupModel.selectedIndex])},g.confirmUser=function(e){if(!e){var o=g.popupModel.userResults;g.popupModel.selectedIndex>=0&&g.popupModel.selectedIndex<o.length&&(e=o[g.popupModel.selectedIndex])}if(e)if(p&&p(t.$parent,{user:e}),"true"===u)g.$hide();else{var o=g.popupModel.userResults;o.splice(jQuery.inArray(e,o),1),g.popupModel.selectedIndex=0,g.popupModel.selectedUser=o[g.popupModel.selectedIndex]}},g.selectPersonByEmail=function(e){e&&f&&(f(t.$parent,{email:g.popupModel.email}),g.$hide())},g.getSelectYourselfLabelKey=function(){return"INVOLVE-PEOPLE."+d.toUpperCase()+"-YOURSELF"},g.isCurrentUserSelectable=function(){return d&&!(t.excludeUserId&&t.excludeUserId==e.account.id||t.excludeUserIds&&-1!=t.excludeUserIds.indexOf(e.account.id))},g.selectYourself=function(){p&&(p(t.$parent,{user:e.account}),g.$hide())},g.$on("tooltip.hide",function(){g.popupModel.showRecentResults&&g.popupModel.added&&(g.popupModel.recentUsers=[]),g.popupModel.userResults=[],g.popupModel.filter="",g.popupModel.emailMode=!1,h(),g.popupModel.added?g.popupModel.added=!1:m&&m(t.$parent)})},s}]),activitiModule.directive("selectFunctionalGroupPopover",["$rootScope","$http","$popover","FunctionalGroupService","$parse",function(e,t,o,n,r){var i={};return i.restrict="A",i.scope={type:"=type",restrictWithGroup:"=restrictWithGroup",excludeGroupIds:"=excludeGroupIds"},i.link=function(t,i,a){var s="bottom";i.addClass("toggle-functional-group-select"),a.placement&&(s=a.placement);var l=!0;void 0!==a.closeOnSelect&&(l=a.closeOnSelect),t.popover=o(i,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/select-functional-group-popover.html?"+Date.now(),placement:s});var c,d;a.onGroupSelected&&(c=r(a.onGroupSelected)),a.onCancel&&(d=r(a.onCancel));var u=t.popover.$scope;u.title=a.popoverTitle,u.popupModel={groupResults:[]},u.$watch("popupModel.filter",function(){if(u.popupModel.filter&&u.popupModel.filter.length>0){var o;null!==e.common&&void 0!==e.common&&null!==e.common.selectedTenantId&&void 0!==e.common.selectedTenantId&&(o=e.common.selectedTenantId>0?e.common.selectedTenantId:void 0),n.getFilteredGroups(u.popupModel.filter,t.restrictWithGroup,o).then(function(e){var o=[];if(null!=t.excludeGroupId&&t.excludeGroupId)for(var n=0;e.data.length>n;n++)e.data[n].id!==t.excludeGroupId&&o.push(e.data[n]);else if(null!=t.excludeGroupIds&&void 0!==t.excludeGroupIds)for(var n=0;e.data.length>n;n++)0>t.excludeGroupIds.indexOf(e.data[n].id)&&o.push(e.data[n]);else o=e.data;u.popupModel.groupResults=o,u.resetSelection()})}else u.resetSelection(),u.popupModel.groupResults=[]}),u.resetSelection=function(){u.popupModel.selectedGroup=void 0,u.popupModel.selectedIndex=-1},u.nextGroup=function(){var e=u.popupModel.groupResults;e&&e.length>0&&u.popupModel.selectedIndex<e.length-1&&(u.popupModel.selectedIndex+=1,u.popupModel.groupUser=e[u.popupModel.selectedIndex])},u.previousGroup=function(){var e=u.popupModel.groupResults;e&&e.length>0&&u.popupModel.selectedIndex>0&&(u.popupModel.selectedIndex-=1,u.popupModel.selectedGroup=e[u.popupModel.selectedIndex])},u.confirmGroup=function(e){if(!e){var o=u.popupModel.groupResults;u.popupModel.selectedIndex>=0&&u.popupModel.selectedIndex<o.length&&(e=o[u.popupModel.selectedIndex])}if(e)if(c&&c(t.$parent,{group:e}),"true"===l)u.$hide();else{var o=u.popupModel.groupResults;o.splice(jQuery.inArray(e,o),1),u.popupModel.selectedIndex=0,u.popupModel.selectedGroup=o[u.popupModel.selectedIndex]}},u.$on("tooltip.hide",function(){u.popupModel.groupResults=[],u.popupModel.filter="",u.popupModel.added?u.popupModel.added=!1:d&&d(t.$parent)})},i}]),activitiModule.directive("tabControl",["$compile","$http","$templateCache",function(e,t,o){var n=function(n,r){if(!n.activeTemplate||n.activeTemplate!=n.activeTab.id){var i=$(r.children()[1]),a=angular.element(r.children()[1]).scope();if(n.activeTemplate&&a!=n&&a.$destroy(),n.activeTab&&n.activeTab.templateUrl){var s=t.get(n.activeTab.templateUrl,{cache:o});s.success(function(e){i.html(e)}).then(function(){n.activeTemplate=n.activeTab.id,i.replaceWith(e(i.html())(n))})}else i.empty()}},r={};return r.restrict="A",r.replace=!0,r.transclude=!0,r.template='<div><div class="clearfix"><ul class="tabs clearfix"><li ng-repeat="tab in tabs" ng-class="{\'active\': tab.id == activeTab.id}"><a ng-click="tabClicked(tab)">{{tab.title && (tab.title | translate) || (tab.name | translate)}}</a></li></ul></div><div></div></div>',r.scope={possibleTabs:"=tabControl",model:"=model",activeTabReference:"=activeTab"},r.controller=["$scope","$element",function(e,t){e.refreshTabs=function(){for(var t=[],o=0;e.possibleTabs.length>o;o++){var n=e.possibleTabs[o];n.hide||t.push(n)}e.tabs=t},e.$watch("possibleTabs",function(){e.refreshTabs()},!0),e.$watch("activeTabReference",function(t){if(!e.activeTab||e.activeTab.id!=t){var o=e.findTab(t);o&&e.tabClicked(o)}}),e.findTab=function(t){if(e.possibleTabs)for(var o=0;e.possibleTabs.length>o;o++)if(e.possibleTabs[o].id==t)return e.possibleTabs[o];return void 0},e.tabClicked=function(o){o.hide&&(o.hide=!1,e.refreshTabs()),e.activeTab=o,e.activeTabReference=o?o.id:void 0,n(e,t)},e.refreshTabs(),e.tabs&&e.tabs.length>0&&(e.activeTabReference&&(e.activeTab=e.findTab(e.activeTabReference)),e.activeTab||(e.activeTab=e.tabs[0]),e.tabClicked(e.activeTab))}],r.link=n,r}]),activitiModule.directive("toggleDragover",["$document","$parse",function(e,t){var o=function(e,o,n){var r=n.toggleDragover,i=t(r),a=o[0];a.addEventListener("dragenter",function(){return e.$apply(function(){i(e,{over:!0})}),!1},!1),a.addEventListener("dragleave",function(){return e.$apply(function(){i(e,{over:!1})}),!1},!1)};return o}]),activitiModule.directive("editInPlace",function(){return{restrict:"E",scope:{value:"="},template:'<span ng-click="edit()" ng-bind="value"></span><span class="glyphicon glyphicon-pencil edit-in-place-icon"></span><input ng-model="value" class="inline-edit-value form-control" ng-blur="stopEdit()" custom-keys enter-pressed="stopEdit()">',link:function(e,t){angular.element(t.children()[1]);var o=angular.element(t.children()[2]);t.addClass("edit-in-place"),e.editing=!1,e.edit=function(){e.editing=!0,t.addClass("active"),o[0].focus()},e.stopEdit=function(){e.editing=!1,t.removeClass("active")}}}});var _internalCreateModal=function(e,t,o){return null!==o&&void 0!==o?(o.modal=t(e),o.$on("$routeChangeStart",function(){o.modal&&o.modal.hide()}),o.modal):t(e)};activitiModule.directive("modalPropertyEditor",["$modal",function(e){return{restrict:"E",scope:!1,link:function(t,o,n){var r={template:n.template?n.template+"?version="+Date.now():null,scope:t};n.backdrop&&(r.backdrop=n.backdrop),n.keyboard&&(r.keyboard="true"===n.keyboard),_internalCreateModal(r,e,t)}}}]),activitiModule.directive("numberInputCheck",function(){return{require:"ngModel",link:function(e,t,o,n){var r={positiveOnly:o.numberPositiveOnly?!0:!1,moneyFraction:o.numberMoneyFraction?!0:!1};n.$parsers.push(function(e){var t;e&&0===e.indexOf("-")&&!r.positiveOnly?(t=e.substr(1).replace(/([^0-9])/g,""),t="-"+t):t=e.replace(/([^0-9])/g,"");var o=parseInt(t);return isNaN(o)||r.moneyFraction||(t=""+o),t!=e&&(n.$setViewValue(t),n.$render()),t})}}}),activitiModule.directive("numberMinValue",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){var r=function(e){var t=!0;if(o.numberMinValue)if(e){var r=parseFloat(o.numberMinValue),i=parseFloat(e);r>i&&(t=!1)}else t=!0;return n.$setValidity("numberMinValue",t),e};n.$parsers.push(r),o.$observe("numberMinValue",function(){return r(n.$viewValue)})}}}),activitiModule.directive("numberMaxValue",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){var r=function(e){var t=!0;if(o.numberMaxValue&&e){var r=parseFloat(o.numberMaxValue),i=parseFloat(e);i>r&&(t=!1)}return n.$setValidity("numberMaxValue",t),e
};n.$parsers.push(r),o.$observe("numberMaxValue",function(){return r(n.$viewValue)})}}}),activitiModule.directive("maskedInput",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n){e(function(){var e=n.maskedInput;e&&o.mask(e,{placeholder:n.maskedInputPlaceholder,reverse:"true"===n.maskedInputReversed})})}}}]),activitiModule.directive("columnListScroll",["$rootScope","$timeout","$interval",function(e,t,o){return{restrict:"A",scope:{},link:function(e,n,r){n.addClass("column-container-scroll"),e.columnHeaderClass=r.columnListScroll||"column-header",e.updateHeight=function(){var t;e.header?t=e.header.outerHeight():n.parent().children("."+e.columnHeaderClass).each(function(){if(e.header=angular.element(this),e.header.addClass("column-header-fixed"),e.resizeSensor=new ResizeSensor(this,e.updateHeight),e.header.hasClass("ng-hide"))var n=o(function(){e.header.hasClass("ng-hide")||(o.cancel(n),e.updateHeight())},20,400,!1);else t=e.header.outerHeight()}),t&&(e.emptyChild||(e.emptyChild=n.children(".column-list-scroll-push")),e.emptyChild&&e.emptyChild.height(t))},t(e.updateHeight,1),e.$on("$destroy",function(){e.header&&e.resizeSensor.detach(e.header[0])})}}}]),activitiModule.directive("externalTarget",function(){return{restrict:"A",scope:{href:"@"},link:function(e,t,o){var n=t[0];e.$watch("href",function(){(n.protocol!=location.protocol||n.host!=location.host)&&(n.target=o.externalTarget)})}}}),activitiModule.filter("startFrom",function(){return function(e,t){return e?(t=+t,e.slice(t)):[]}}),activitiModule.filter("regex",function(){return function(e,t,o){2==arguments.length&&(o=t);for(var n=RegExp(o),r=[],i=0;e.length>i;i++)n.test(e[i][t])&&r.push(e[i]);return r}}),activitiModule.filter("toDate",function(){return function(e,t){return e?moment(e,t||"DD-MM-YYYY").toDate():void 0}}),activitiModule.filter("decodeHtml",["$sce",function(e){var t=document.createElement("div");return function(o){return t.innerHTML=o,e.getTrustedHtml(e.trustAsHtml(t.textContent))}}]),activitiModule.config(["$httpProvider","$translateProvider",function(e){e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.get["Cache-Control"]="no-cache, no-store, must-revalidate",e.defaults.headers.get.Pragma="no-cache",e.defaults.headers.get.Expires="0"}]),function(){if(null!==ACTIVITI.CONFIG.isEventTrackingEnabled&&void 0!==ACTIVITI.CONFIG.isEventTrackingEnabled&&ACTIVITI.CONFIG.isEventTrackingEnabled===!0)if(null!==ACTIVITI.CONFIG.trackingCode&&void 0!==ACTIVITI.CONFIG.trackingCode){(function(e,t,o,n,r,i,a){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,i=t.createElement(o),a=t.getElementsByTagName(o)[0],i.async=1,i.src=n,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");var e;e=null!==ACTIVITI.CONFIG.isDevMode&&void 0!==ACTIVITI.CONFIG.isDevMode&&ACTIVITI.CONFIG.isDevMode===!0?{cookieDomain:"none"}:"auto",ga("create",ACTIVITI.CONFIG.trackingCode,e),ga("require","displayfeatures"),ga("send","pageview")}else console.log("Could not initialise event tracking: no tracking code found (set property in ACTIVITI.CONFIG.trackingCode)")}(),activitiModule.run(["$rootScope","$location","EventTrackingService",function(e,t,o){e.$on("$locationChangeSuccess",function(){var e=t.url();null!==e&&void 0!==e&&e.length>0&&o.trackPageView(t.url())})}]),activitiModule.config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate","EventTrackingService",function(e,t){return function(o,n){if(e(o,n),o){var r;o&&o.stack&&(r=angular.toJson(o.stack)),r&&t.trackException(r,!1)}}}])}]),activitiModule.service("EventTrackingService",[function(){var e=function(){return null!==ACTIVITI.CONFIG.isEventTrackingEnabled&&void 0!==ACTIVITI.CONFIG.isEventTrackingEnabled&&ACTIVITI.CONFIG.isEventTrackingEnabled===!0},t=function(e){null!==ACTIVITI.CONFIG.isDevMode&&void 0!==ACTIVITI.CONFIG.isDevMode&&ACTIVITI.CONFIG.isDevMode===!0&&console.log("[Event Tracker] "+e)};this.trackPageView=function(o){e()&&(t("pageview : "+o),ga("set","page",o),ga("send","pageview"))},this.trackEvent=function(o,n,r,i){e()&&(t("custom event : "+o+" - "+n),ga("send","event",o,n,r,i))},this.trackException=function(o,n){e()&&(t("exception : "+o+", is fatal: "+n),ga("send","event","exception","webapp",o.substring(0,400)))}}]),activitiModule.filter("trackEvent",["EventTrackingService",function(e){return function(t,o,n,r,i){return e.trackEvent(o,n,r,i),t}}]),activitiModule.service("ResourceService",["$http","$q","appResourceRoot",function(e,t,o){function n(e,t){var n=o+e;if(!t||!s[n])if(t&&(s[n]=!0),document.createStyleSheet)try{document.createStyleSheet(e)}catch(r){}else{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.media="all",i.href=n,document.getElementsByTagName("head")[0].appendChild(i)}}function r(e,t,n){var r=o+e;if(n&&s[r]&&t)t();else{n&&(s[r]=!0);var i=document.createElement("script");if(i.type="text/javascript",i.src=r,t){var a=!1;i.onload=i.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,t())}}var l=document.getElementsByTagName("head")[0];l.appendChild(i)}}function i(e,t,o){function n(){var i=e.shift();i?r.call(this,i,n.bind(this),o):t&&t()}n.call(this)}function a(t,o,r){e.get(t).success(function(e){var t;if(window.DOMParser){var a=new DOMParser;t=a.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e);for(var s,l=t.getElementsByTagName("link"),c=[],d=0,u=l.length;u>d;d++)s=l[d].getAttribute("href"),s&&n(s,r);for(l=t.getElementsByTagName("script"),d=0,u=l.length;u>d;d++)s=l[d].getAttribute("src"),s&&c.push(s);i(c,o,r)})}var s={};this.loadFromHtml=a,this.loadScript=r,this.loadStylesheet=n}]),activitiModule.factory("RecursionHelper",["$compile",function(e){return{compile:function(t,o){angular.isFunction(o)&&(o={post:o});var n,r=t.contents().remove();return{pre:o&&o.pre?o.pre:null,post:function(t,i){n||(n=e(r)),n(t,function(e){i.append(e)}),o&&o.post&&o.post.apply(null,arguments)}}}}}]),activitiApp.service("FormUtilService",[function(){var e=function(t,o){var o=o||[];return t&&t.forEach(function(t){if(o.push(t),("container"===t.type||"group"===t.type)&&t.fields)for(var n in t.fields)e(t.fields[n],o)}),o};this.flattenFields=e;var t=function(e,t){var o=e.indexOf(t);if(o>=0)return o;for(var n=0;e.length>n;n++)if("container"===e[n].type)for(var r in e[n].fields)if(e[n].fields[r].indexOf(t)>=0)return n};this.determineContainerIndex=t;var o=function(e,t){var o=e.indexOf(t);o>=0&&e.splice(o,1);for(var n=function(t){var o;e.forEach(function(e,n){if("container"===e.type&&e.fields){var r=!1,i=!0;for(var a in e.fields)e.fields[a]===t&&(r=!0),e.fields[a]&&e.fields[a].length>0&&(i=!1);r&&i&&(o=n)}}),void 0!==o&&o>-1&&e.splice(o,1)},r=0;e.length>r;r++)if("container"===e[r].type)for(var i in e[r].fields)if(e[r].fields[i].indexOf(t)>=0){e[r].fields[i].splice(e[r].fields[i].indexOf(t),1),n(e[r].fields[i]);break}};this.removeFormElement=o}]),activitiApp.service("SystemPropertiesService",["$http","$q",function(e,t){var o=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getSystemProperties=function(){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties"})},this.getPasswordValidationConstraints=function(e){return(void 0===e||null===e)&&(e="-1"),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties/password-validation-constraints/"+e})},this.canInvolvedUsersEditForms=function(e){return(void 0===e||null===e)&&(e="-1"),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties/involved-users-can-edit-forms/"+e})},this.getGlobalDateFormat=function(e){return(void 0===e||null===e)&&(e="-1"),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties/global-date-format/"+e})}}]),activitiApp.provider("licenseStatus",function licenseStatusProvider(){var e=null;this.licenseStatusResolver=["$q","$rootScope","$http","$translate",function(t,o,n,r){if(o.licenseStatus)return e;var i=function(i){var a=t.defer();return n(i).success(function(t){o.readOnly="valid"!==t.status,o.multiTenantMode=t.multiTenant,o.allowLicenseUpload=t.allowUpload,t.warning?(o.licenseWarning=t.warning,o.addAlert(r.instant("COMMON.WARNING.APP-LICENSE-WARNING-"+t.warning.toUpperCase()),"error")):null==e&&o.readOnly&&(o.licenseStatus=t.status,o.addAlert(r.instant("COMMON.WARNING.APP-LICENSE-ISSUE-"+t.status.toUpperCase()),"error")),e=t.status,a.resolve(e)}).error(function(){o.authenticated&&o.addAlert(r.instant("COMMON.WARNING.APP-LICENSE-ISSUE-NOT-FOUND"),"error"),a.resolve("not-found")}),a.promise};return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/license"})}],this.$get=[function(){}]}),activitiApp.controller("AboutActivitiPopupCrtl",["$rootScope","$scope","$http","$translate","$interval","$dateFormatter",function(e,t,o,n,r,i){t.popup={loading:!0,activitiVersion:{},licenseHolder:""},o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/about-info"}).success(function(e){t.popup.licenseHolder=e.holder,t.popup.activitiVersion=e.versionInfo.edition+" v"+e.versionInfo.majorVersion+"."+e.versionInfo.minorVersion+"."+e.versionInfo.revisionVersion,t.popup.activitiVersionType=e.versionInfo.type,e.goodBeforeDate&&(t.popup.goodBeforeDate=i.formatDate(new Date(e.goodBeforeDate))),t.popup.loading=!1}).error(function(){t.popup.loading=!1}),t.cancel=function(){t.close()},t.close=function(){t.$hide()}}]),activitiApp.factory("httpUtils",[function(){"use strict";var e={};return e.encode=function(e){var t=[];if(e)for(var o in e){var n=e[o];void 0!==n&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(n))}return t.join("&")},e}]),angular.module("activitiApp").controller("ReportsController",["$rootScope","$scope","$route","$translate","$q","$modal","ReportService","Utils","appSettings","$routeParams","AppDefinitionService","$location","$window",function(e,t,o,n,r,i,a,s,l,c,d,u,p){t.appDefinitionId=c.appDefinitionId||d.getIntegrationAppDefinitionId(),d.setActiveAppDefinitionId(t.appDefinitionId),t.templates={processDefinition:l.reporting.viewsPath+"views/reporting/parameters/process-definition-select.html?version="+Date.now(),status:l.reporting.viewsPath+"views/reporting/parameters/process-status-select.html?version="+Date.now(),task:l.reporting.viewsPath+"views/reporting/parameters/task-select.html?version="+Date.now(),dateRange:l.reporting.viewsPath+"views/reporting/parameters/daterange-picker.html?version="+Date.now(),dateInterval:l.reporting.viewsPath+"views/reporting/parameters/date-interval-select.html?version="+Date.now(),duration:l.reporting.viewsPath+"views/reporting/parameters/duration.html?version="+Date.now(),integer:l.reporting.viewsPath+"views/reporting/parameters/integer.html?version="+Date.now(),"boolean":l.reporting.viewsPath+"views/reporting/parameters/boolean.html?version="+Date.now()},t.hasAccessReportsCapability()||t.backToLanding(),t.setMainPageById("reports"),t.model={loading:!0,canRemove:l.reporting.allowRemove,isEmbeddedMode:l.reporting.embedded,appPath:l.reporting.appPath},t.generateDefaultReports=function(){t.model.loading=!0,a.generateDefaultReports().then(function(){o.reload()})},t.goToConfigurationTab=function(){u.path("/configure/")},t.goToAnalyticsApp=function(){p.location.href=l.reporting.appPath},t.editTitle=function(){!l.reporting.embedded&&t.model.currentReport&&(t.model.currentReport.editingName=!0)};var m=function(){delete t.model.currentReport,delete t.model.currentReportData};t.showParameters=function(){return null!==t.model.currentReport&&void 0!==t.model.currentReport&&null!==t.model.currentReport.definition&&void 0!==t.model.currentReport.definition&&null!==t.model.currentReport.definition.parameters&&void 0!==t.model.currentReport.definition.parameters&&t.model.currentReport.definition.parameters.length>0},t.showReport=function(e){t.model.loading=!0,m(),a.getReportParameters(e).then(function(e){if(e.definition=JSON.parse(e.definition),null!==e.definition.parameters&&void 0!==e.definition.parameters)for(var o=0;e.definition.parameters.length>o;o++){var n=e.definition.parameters[o];if("dateRange"===n.type){if(null!==n.value&&void 0!==n.value){var r=n.value.rangeId;null!==r||void 0!==r?"today"===r?(n.value.startDate=moment().startOf("day"),n.value.endDate=moment().startOf("day")):"yesterday"===r?(n.value.startDate=moment().subtract("days",1).startOf("day"),n.value.endDate=moment().subtract("days",1).startOf("day")):"last7Days"===r?(n.value.startDate=moment().subtract("days",6).startOf("day"),n.value.endDate=moment().startOf("day")):"previousMonth"===r?(n.value.startDate=moment().subtract("month",1).startOf("month"),n.value.endDate=moment().subtract("month",1).endOf("month")):"currentYear"===r?(n.value.startDate=moment().startOf("year"),n.value.endDate=moment().startOf("day")):(n.value.startDate=moment(n.value.startDate),n.value.endDate=moment(n.value.endDate)):(n.value.startDate=moment(n.value.startDate),n.value.endDate=moment(n.value.endDate))}}else"duration"===n.type&&(n.durationUnit="sec",n.valueForUser=n.value)}t.model.currentReport=e,t.parameterValueUpdated()})};var f=function(){var e={};if(t.model.currentReport&&t.model.currentReport.definition&&t.model.currentReport.definition.parameters)for(var o=0;t.model.currentReport.definition.parameters.length>o;o++){var n=t.model.currentReport.definition.parameters[o];e[n.id]=n.value}return e};t.generateCurrentReport=function(){t.model.loading=!0;var e=f();a.generateReport(t.model.currentReport.id,e).then(function(e){t.model.currentReportData=e,t.model.loading=!1})},t.parameterValueUpdated=function(){var e=function(){if(t.model.currentReport&&t.model.currentReport.definition&&t.model.currentReport.definition.parameters){for(var e=0;t.model.currentReport.definition.parameters.length>e;e++)if(null===t.model.currentReport.definition.parameters[e].value||void 0===t.model.currentReport.definition.parameters[e].value||""===t.model.currentReport.definition.parameters[e].value)return!1;return!0}return!1};e()?t.generateCurrentReport():t.model.loading=!1},t.statusProcessFilter=function(){var e=function(){if(t.model.currentReport&&t.model.currentReport.definition&&t.model.currentReport.definition.parameters){for(var e=0;t.model.currentReport.definition.parameters.length>e;e++)if(null===t.model.currentReport.definition.parameters[e].value||void 0==t.model.currentReport.definition.parameters[e].value||""===t.model.currentReport.definition.parameters[e].value)return!1;return!0}return!1};e()?t.generateCurrentReport():t.model.loading=!1},t.reportTitleChanged=function(){a.updateReport(t.model.currentReport.id,t.model.currentReport.name).then(function(){for(var e=0;t.model.reports.length>e;e++)t.model.reports[e].id===t.model.currentReport.id&&(t.model.reports[e].name=t.model.currentReport.name);t.model.currentReport.editingName=!1})},t.showSaveReportModal=function(){t.model.newReportName=t.model.currentReport.name+" ("+s.getCurrentDateAsFormattedShortString()+")",_internalCreateModal({scope:t,template:l.reporting.viewsPath+"views/modal/save-report-modal.html",show:!0},i,t)},t.showExportReportModal=function(){t.model.newExportName=t.model.currentReport.name,_internalCreateModal({scope:t,template:l.reporting.viewsPath+"views/modal/export-report-modal.html",show:!0},i,t)};var v=function(){"ENTERPRISE"===t.account.type.toUpperCase()?(t.model.loadingList=!0,a.getReports(t.appDefinitionId).then(function(e){t.model.reports=e,t.model.loadingList=!1})):t.model.reports=[]};t.saveReport=function(){t.model.loading=!0;var e=f();a.saveReport(t.model.currentReport.id,t.model.newReportName,e).then(function(){t.model.loading=!1,v()})},t.exportReport=function(){t.model.loading=!0;var e=f();a.exportReport(t.model.currentReport.id,t.model.newExportName,e).then(function(){}),t.model.loading=!1},t.showDeleteReportModal=function(){_internalCreateModal({scope:t,template:l.reporting.viewsPath+"views/modal/delete-report-modal.html",show:!0},i,t)},t.deleteReport=function(){t.model.loadingList=!0,a.deleteReport(t.model.currentReport.id).then(function(){m(),v()})},v()}]),angular.module("activitiApp").controller("ReportConfigurationController",["$rootScope","$scope","$location","ReportService",function(e,t,o,n){function r(){o.path("/reports/")}e.setMainPageById("configure"),t.model={generators:[]},n.getGenerators().then(function(e){t.model.generators=e.data||[]}),t.generateDefaultReports=function(){n.generateDefaultReports().then(r)},t.generateReport=function(e){e&&e.id&&n.createReport(e.id).then(r)},t.resetReports=function(){n.resetReports().then(r)}}]),angular.module("activitiApp").controller("ReportImportController",["$scope","$http","Upload","$location",function(e,t,o,n){e.model={loading:!1},e.onFileSelect=function(t){t&&t.length>0&&o.upload({url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/report-definitions",method:"POST",file:t[0]}).progress(function(t){e.model.loading=!0,e.model.uploadProgress=parseInt(100*t.loaded/t.total)}).success(function(){e.model.loading=!1,n.path("/reports/"),e.$hide()}).error(function(t){t&&t.message&&(e.model.errorMessage=t.message),e.model.error=!0,e.model.loading=!1})}}]),angular.module("activitiApp").controller("ReportingParamProcessDefinitionSelectController",["$rootScope","$scope","ReportService","$http",function(e,t,o,n){function r(e){for(var t=[],o=0;e.length>o;o++)t.push({id:e[o].id,name:e[o].name+"(v "+e[o].version+")",version:e[o].version});return t}if(e.activeAppDefinition){var i=e.activeAppDefinition.id,a=ACTIVITI.CONFIG.contextRoot+"/app/rest/process-definitions?&appDefinitionId="+i;n.get(a).then(function(e){t.model.processDefinitions=r(e.data.data||[])})}else o.getProcessDefinitions().then(function(e){t.model.processDefinitions=r(e)})}]),angular.module("activitiApp").controller("ReportingParamTaskSelectController",["$rootScope","$scope","ReportService",function(e,t,o){t.setParameter=function(e){if(e.dependsOn){for(var n,r=0;t.model.currentReport.definition.parameters.length>r;r++)if(e.dependsOn===t.model.currentReport.definition.parameters[r].id){n=r;break}void 0!==n&&n>=0&&t.$watch("model.currentReport.definition.parameters["+n+"].value",function(n){null!==n&&void 0!==n&&""!==n&&(e.taskNames&&(e.taskNames.length=0),o.getTasksForProcessDefinitionId(t.model.currentReport.id,n).then(function(t){e.taskNames=t}))},!1)}}}]),angular.module("activitiApp").controller("ReportingParamDateIntervalController",["$rootScope","$scope","$q","$translate",function(e,t,o,n){o.all([n("REPORTING.PARAMETER-WIDGETS.DATE-INTERVAL-OPTIONS.HOUR"),n("REPORTING.PARAMETER-WIDGETS.DATE-INTERVAL-OPTIONS.DAY"),n("REPORTING.PARAMETER-WIDGETS.DATE-INTERVAL-OPTIONS.WEEK"),n("REPORTING.PARAMETER-WIDGETS.DATE-INTERVAL-OPTIONS.MONTH"),n("REPORTING.PARAMETER-WIDGETS.DATE-INTERVAL-OPTIONS.YEAR")]).then(function(e){var o=[];o.push({id:"byHour",name:e[0]}),o.push({id:"byDay",name:e[1]}),o.push({id:"byWeek",name:e[2]}),o.push({id:"byMonth",name:e[3]}),o.push({id:"byYear",name:e[4]}),t.model.dateIntervalOptions=o})}]),angular.module("activitiApp").controller("ReportingParamDurationController",["$rootScope","$scope","$translate","$q",function(e,t,o,n){t.setParameter=function(e){e.durationUnit||(e.durationUnit="day")},n.all([o("REPORTING.PARAMETER-WIDGETS.DURATION.DAYS"),o("REPORTING.PARAMETER-WIDGETS.DURATION.HOURS"),o("REPORTING.PARAMETER-WIDGETS.DURATION.MINUTES"),o("REPORTING.PARAMETER-WIDGETS.DURATION.SECONDS")]).then(function(e){t.model.durationOptions=[{id:"day",name:e[0]},{id:"hour",name:e[1]},{id:"min",name:e[2]},{id:"sec",name:e[3]}]}),t.reportingParamDurationChanged=function(e){if(null===e.valueForUser||void 0===e.valueForUser)e.valueForUser=0;else{if(angular.isString(e.valueForUser))try{e.valueForUser=parseInt(e.valueForUser),isNaN(e.valueForUser)&&(e.valueForUser=0)}catch(o){e.valueForUser=0}"day"===e.durationUnit?e.value=60*60*24*e.valueForUser:"hour"===e.durationUnit?e.value=60*60*e.valueForUser:"min"===e.durationUnit?e.value=60*e.valueForUser:"sec"===e.durationUnit&&(e.value=e.valueForUser)}t.parameterValueUpdated()}}]),angular.module("activitiApp").controller("ReportingParamIntegerController",["$rootScope","$scope",function(e,t){t.reportingParamIntegerChanged=function(e){if(null===e.value||void 0===e.value)e.value=0;else if(angular.isString(e.value))try{e.value=parseInt(e.value),isNaN(e.value)&&(e.value=0)}catch(o){e.value=0}t.parameterValueUpdated()}}]),angular.module("activitiApp").controller("ReportingParamBooleanController",["$rootScope","$scope",function(e,t){t.reportingParamBooleanChanged=function(e){(null===e.value||void 0===e.value)&&(e.value=0),t.parameterValueUpdated()}}]),angular.module("activitiApp").controller("ReportingParamDateRangeController",["$rootScope","$scope","$q","$translate",function(e,t,o,n){var r={},i=[n("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.TODAY"),n("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.YESTERDAY"),n("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.LAST-7-DAYS"),n("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.PREVIOUS-MONTH"),n("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.CURRENT-YEAR")];o.all(i).then(function(e){var o={};o[e[0]]=[moment().startOf("day"),moment().endOf("day")],r[e[0]]="today",o[e[1]]=[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],r[e[1]]="yesterday",o[e[2]]=[moment().subtract("days",7).startOf("day"),moment().startOf("day")],r[e[2]]="last7Days",o[e[3]]=[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")],r[e[3]]="previousMonth",o[e[4]]=[moment().startOf("year"),moment().startOf("day")],r[e[4]]="currentYear",t.model.specialRanges=o}),t.dateRangeChanged=function(e){o.all(i).then(function(){var o;e&&e.value&&e.value.rangeName&&(o=r[e.value.rangeName]),(null===o||void 0===o)&&e&&e.value&&e.value.startDate.startOf("day").isSame(moment().startOf("day"))&&e.value.endDate.startOf("day").isSame(moment().startOf("day"))&&(o="today",e.value.endDate=moment().endOf("day")),null!==o&&void 0!==o&&(delete e.value.rangeName,e.value.rangeId=o),t.parameterValueUpdated()})}}]),angular.module("activitiApp").controller("ChartWidgetController",["$scope","$q","$translate","appSettings",function(e,t,o,n){e.templates={pieChart:n.reporting.viewsPath+"views/reporting/widgets/piechart.html?version="+Date.now(),barChart:n.reporting.viewsPath+"views/reporting/widgets/barchart.html?version="+Date.now(),multiBarChart:n.reporting.viewsPath+"views/reporting/widgets/multibarchart.html?version="+Date.now(),table:n.reporting.viewsPath+"views/reporting/widgets/table.html?version="+Date.now(),masterDetailTable:n.reporting.viewsPath+"views/reporting/widgets/master-detail-table.html?version="+Date.now(),processDefinitionHeatMap:n.reporting.viewsPath+"views/reporting/widgets/process-definition-heat-map.html?version="+Date.now()},e.getTranslationOrValue=function(e){return null!==e&&void 0!==e&&e.length>0&&"__KEY_"===e.substring(0,6)?o.instant(e.substring(6,e.length)):e},e.xFunction=function(){return function(e){return e.key}},e.yFunction=function(){return function(e){return e.y}},e.xAxisTickFormatFunction=function(e){return function(t){if(null!==e&&void 0!==e){if("date_day"===e)return moment(new Date(t)).format("DD");if("date_month"===e)return moment(new Date(t)).format("MMMM");if("date_year"===e)return moment(new Date(t)).format("YYYY")}return t}},e.yAxisTickFormatFunction=function(e){return function(t){if(null!==e&&void 0!==e&&"count"===e){var o=""+t;if(-1!==o.indexOf("."))return""}return t}},e.toolTipContentFunctionXtoY=function(){return function(e,t,o){return" "+e+" : "+o.value+" "}},e.toolTipContentFunction=function(e){return function(t,o,n,r){if("date"===e){var i=n;return i&&".0"===i.match(".0$")&&(i=i.substring(0,i.length-2)),d3.time.format("%B %e, %Y")(new Date(r.point[0]))+" : "+i}return n}},e.generateChartId=function(){e.model.nextChartId||(e.model.nextChartId=0);var t=e.model.nextChartId++;return t},e.calculateChartWidth=function(){var e=jQuery("#report").width();return e>300&&(e-=100),100>e&&(e=100),e>700&&(e=700),e},e.calculateChartHeight=function(){return 3*(e.calculateChartWidth()/4)},e.colorFunction=function(e){return function(t,o){return e.customColors[o]}}}]),angular.module("activitiApp").controller("ReportingProcessDefinitionHeatMapController",["$rootScope","$scope","$timeout","$translate","appResourceRoot","ResourceService",function(e,t,o,n,r,i){var a=function(e,n,a){t.element.loading=!0,t.element&&n&&o(function(){var o=jQuery("#bpmnModel"),s=function(){o.empty();var e=jQuery(".qtip");e&&e.length>0&&e.qtip("destroy",!0)};s(),t.$on("$destroy",function(){s()}),o.attr("data-process-definition-id",t.element.processDefinitionId),o.attr("data-model-type","process-definition");var l={};for(var c in n)if(n.hasOwnProperty(c)){var d=n[c],u=(120-1.2*d)/360;l[c]="hsb("+u+", 1, 1)"}o.attr("data-activity-color-mapping",JSON.stringify(l)),o.attr("data-activity-opacity","0.6");var p={};for(var c in e)e.hasOwnProperty(c)&&(p[c]=" "+e[c]+" "+a);o.attr("data-activity-tooltips",JSON.stringify(p));var m=r+"../display/displaymodel.html?version="+Date.now(),f=window.define;window.define=void 0,i.loadFromHtml(m,function(){window.define=f,t.element.loading=!1})},100)};t.metricChanged=function(){"totalCount"===t.element.currentMetric?a(t.element.totalCountValues,t.element.totalCountsPercentages,n.instant("REPORTING.DEFAULT-REPORTS.PROCESS-HEAT-MAP.METRIC-TOTAL-COUNT-TOOLTIP")):"totalTime"===t.element.currentMetric?a(t.element.totalTimeValues,t.element.totalTimePercentages,n.instant("REPORTING.DEFAULT-REPORTS.PROCESS-HEAT-MAP.METRIC-TOTAL-TIME-TOOLTIP")):"avgTime"===t.element.currentMetric&&a(t.element.avgTimeValues,t.element.avgTimePercentages,n.instant("REPORTING.DEFAULT-REPORTS.PROCESS-HEAT-MAP.METRIC-AVERAGE-TIME-TOOLTIP"))},t.element.currentMetric="totalCount",t.metricChanged()}]);