function assert(e,t){if(!e)throw t}function DMCommand(e,t){this.action=e,this.triple=t,this.toString=function(){return"Command("+e+", "+t+")"}}function DMCommandHandler(e){this.__setNext=function(){var t=this.__next;return this.__next=e,t?t:!0},this.__setNext(e),this.__invokeNext=function(e){return this.__next?this.__next.handle(e):!1},this.handle=function(e){return this.process(e)?!0:this.__invokeNext(e)},this.process=function(){return!1}}function MetaTagHandler(next){DMCommandHandler.apply(this,[next]),this.process=function(command){with(command.triple)if(!(subject instanceof ERDF.Resource&&subject.isCurrentDocument()&&object instanceof ERDF.Literal))return!1}}function printf(){for(var e=arguments[0],t=1;arguments.length>t;t++)e=e.replace("%"+(t-1),arguments[t]);return e}function _evenMoreEvilHack(e,t){if(window.ActiveXObject){var i=new ActiveXObject("MSXML.DomDocument");return i.loadXML(e),i}if(window.XMLHttpRequest){var o=new XMLHttpRequest;return o.open("GET","data:"+(t||"application/xml")+";charset=utf-8,"+encodeURIComponent(e),!1),o.overrideMimeType&&o.overrideMimeType(t),o.send(null),o.responseXML}}function _evilSafariHack(e){var t=e,i="data:text/xml;charset=utf-8,"+encodeURIComponent(t),o=null,n=new XMLHttpRequest;return n.open("GET",i),n.onload=function(){o=n.responseXML},n.send(null),o}function init(){if(ORYX.Log.debug("Querying editor instances"),ORYX.Editor.setMissingClasses(),window.onOryxResourcesLoaded)window.onOryxResourcesLoaded();else{var e=window.location.search.substring(4),t="./service/model/"+e+"/json";ORYX.Editor.createByUrl(t)}}function wireServices(e){e.factory("Account",["$rootScope","$http","$q",function(e,t,i){return{get:function(){var o=i.defer();return t.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/account",{ignoreErrors:!0}).success(function(t){e.account=t,o.resolve()}).error(function(e){o.reject(e)}),o.promise}}}]),e.factory("AuthenticationSharedService",["$rootScope","$http","authService","$q",function(e,t,i,o){return{authenticate:function(){var i=o.defer();return t.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/authenticate",{ignoreErrors:!0,ignoreAuthModule:"ignoreAuthModule"}).success(function(t){e.account=t,e.$broadcast("event:auth-authConfirmed"),i.resolve()}).error(function(t){i.reject(t),e.$broadcast("event:auth-loginRequired")}),i.promise},login:function(o){var n="j_username="+encodeURIComponent(o.username)+"&j_password="+encodeURIComponent(o.password)+"&_spring_security_remember_me=true&submit=Login";t.post(ACTIVITI.CONFIG.contextRoot+"/app/authentication",n,{headers:{"Content-Type":"application/x-www-form-urlencoded"},ignoreAuthModule:"ignoreAuthModule",ignoreErrors:!0}).success(function(t,n,r,a){e.authenticationError=!1,o.success&&o.success(t,n,r,a),i.loginConfirmed()}).error(function(t,i,n,r){e.$broadcast("event:auth-loginFailed"),o.error&&o.error(t,i,n,r)})},logout:function(){e.authenticated=!1,e.authenticationError=!1,t.get(ACTIVITI.CONFIG.contextRoot+"/app/logout").success(function(){e.login=null,i.loginCancelled({isFromLogout:!0})})}}}]),e.controller("LoginController",["$scope","$location","AuthenticationSharedService",function(e,t,i){e.status={loading:!1},e.login=function(){e.status.loading=!0,i.login({username:e.username,password:e.password,success:function(){e.status.loading=!1},error:function(){e.status.loading=!1}})}}]),e.controller("LogoutController",["$location","AuthenticationSharedService","$cookieStore",function(e,t){t.logout()}])}if(!ORYX)var ORYX={};if(ORYX.I18N||(ORYX.I18N={}),ORYX.I18N.Language="en_us",ORYX.I18N.Oryx||(ORYX.I18N.Oryx={}),ORYX.I18N.Oryx.title="Oryx",ORYX.I18N.Oryx.noBackendDefined="Caution! \nNo Backend defined.\n The requested model cannot be loaded. Try to load a configuration with a save plugin.",ORYX.I18N.Oryx.pleaseWait="Please wait while loading...",ORYX.I18N.Oryx.notLoggedOn="Not logged on",ORYX.I18N.Oryx.editorOpenTimeout="The editor does not seem to be started yet. Please check, whether you have a popup blocker enabled and disable it or allow popups for this site. We will never display any commercials on this site.",ORYX.I18N.AddDocker||(ORYX.I18N.AddDocker={}),ORYX.I18N.AddDocker.group="Docker",ORYX.I18N.AddDocker.add="Add Docker",ORYX.I18N.AddDocker.addDesc="Add a Docker to an edge, by clicking on it",ORYX.I18N.AddDocker.del="Delete Docker",ORYX.I18N.AddDocker.delDesc="Delete a Docker",ORYX.I18N.Arrangement||(ORYX.I18N.Arrangement={}),ORYX.I18N.Arrangement.groupZ="Z-Order",ORYX.I18N.Arrangement.btf="Bring To Front",ORYX.I18N.Arrangement.btfDesc="Bring to Front",ORYX.I18N.Arrangement.btb="Bring To Back",ORYX.I18N.Arrangement.btbDesc="Bring To Back",ORYX.I18N.Arrangement.bf="Bring Forward",ORYX.I18N.Arrangement.bfDesc="Bring Forward",ORYX.I18N.Arrangement.bb="Bring Backward",ORYX.I18N.Arrangement.bbDesc="Bring Backward",ORYX.I18N.Arrangement.groupA="Alignment",ORYX.I18N.Arrangement.ab="Alignment Bottom",ORYX.I18N.Arrangement.abDesc="Bottom",ORYX.I18N.Arrangement.am="Alignment Middle",ORYX.I18N.Arrangement.amDesc="Middle",ORYX.I18N.Arrangement.at="Alignment Top",ORYX.I18N.Arrangement.atDesc="Top",ORYX.I18N.Arrangement.al="Alignment Left",ORYX.I18N.Arrangement.alDesc="Left",ORYX.I18N.Arrangement.ac="Alignment Center",ORYX.I18N.Arrangement.acDesc="Center",ORYX.I18N.Arrangement.ar="Alignment Right",ORYX.I18N.Arrangement.arDesc="Right",ORYX.I18N.Arrangement.as="Alignment Same Size",ORYX.I18N.Arrangement.asDesc="Same Size",ORYX.I18N.Edit||(ORYX.I18N.Edit={}),ORYX.I18N.Edit.group="Edit",ORYX.I18N.Edit.cut="Cut",ORYX.I18N.Edit.cutDesc="Cuts the selection into an Oryx clipboard",ORYX.I18N.Edit.copy="Copy",ORYX.I18N.Edit.copyDesc="Copies the selection into an Oryx clipboard",ORYX.I18N.Edit.paste="Paste",ORYX.I18N.Edit.pasteDesc="Pastes the Oryx clipboard to the canvas",ORYX.I18N.Edit.del="Delete",ORYX.I18N.Edit.delDesc="Deletes all selected shapes",ORYX.I18N.EPCSupport||(ORYX.I18N.EPCSupport={}),ORYX.I18N.EPCSupport.group="EPC",ORYX.I18N.EPCSupport.exp="Export EPC",ORYX.I18N.EPCSupport.expDesc="Export diagram to EPML",ORYX.I18N.EPCSupport.imp="Import EPC",ORYX.I18N.EPCSupport.impDesc="Import an EPML file",ORYX.I18N.EPCSupport.progressExp="Exporting model",ORYX.I18N.EPCSupport.selectFile="Select an EPML (.empl) file to import.",ORYX.I18N.EPCSupport.file="File",ORYX.I18N.EPCSupport.impPanel="Import EPML File",ORYX.I18N.EPCSupport.impBtn="Import",ORYX.I18N.EPCSupport.close="Close",ORYX.I18N.EPCSupport.error="Error",ORYX.I18N.EPCSupport.progressImp="Import...",ORYX.I18N.ERDFSupport||(ORYX.I18N.ERDFSupport={}),ORYX.I18N.ERDFSupport.exp="Export to ERDF",ORYX.I18N.ERDFSupport.expDesc="Export to ERDF",ORYX.I18N.ERDFSupport.imp="Import from ERDF",ORYX.I18N.ERDFSupport.impDesc="Import from ERDF",ORYX.I18N.ERDFSupport.impFailed="Request for import of ERDF failed.",ORYX.I18N.ERDFSupport.impFailed2="An error while importing occurs! <br/>Please check error message: <br/><br/>",ORYX.I18N.ERDFSupport.error="Error",ORYX.I18N.ERDFSupport.noCanvas="The xml document has no Oryx canvas node included!",ORYX.I18N.ERDFSupport.noSS="The Oryx canvas node has no stencil set definition included!",ORYX.I18N.ERDFSupport.wrongSS="The given stencil set does not fit to the current editor!",ORYX.I18N.ERDFSupport.selectFile="Select an ERDF (.xml) file or type in the ERDF to import it!",ORYX.I18N.ERDFSupport.file="File",ORYX.I18N.ERDFSupport.impERDF="Import ERDF",ORYX.I18N.ERDFSupport.impBtn="Import",ORYX.I18N.ERDFSupport.impProgress="Importing...",ORYX.I18N.ERDFSupport.close="Close",ORYX.I18N.ERDFSupport.deprTitle="Really export to eRDF?",ORYX.I18N.ERDFSupport.deprText="Exporting to eRDF is not recommended anymore because the support will be stopped in future versions of the Oryx editor. If possible, export the model to JSON. Do you want to export anyway?",ORYX.I18N.jPDLSupport||(ORYX.I18N.jPDLSupport={}),ORYX.I18N.jPDLSupport.group="ExecBPMN",ORYX.I18N.jPDLSupport.exp="Export to jPDL",ORYX.I18N.jPDLSupport.expDesc="Export to jPDL",ORYX.I18N.jPDLSupport.imp="Import from jPDL",ORYX.I18N.jPDLSupport.impDesc="Import jPDL File",ORYX.I18N.jPDLSupport.impFailedReq="Request for import of jPDL failed.",ORYX.I18N.jPDLSupport.impFailedJson="Transformation of jPDL failed.",ORYX.I18N.jPDLSupport.impFailedJsonAbort="Import aborted.",ORYX.I18N.jPDLSupport.loadSseQuestionTitle="jBPM stencil set extension needs to be loaded",ORYX.I18N.jPDLSupport.loadSseQuestionBody="In order to import jPDL, the stencil set extension has to be loaded. Do you want to proceed?",ORYX.I18N.jPDLSupport.expFailedReq="Request for export of model failed.",ORYX.I18N.jPDLSupport.expFailedXml="Export to jPDL failed. Exporter reported: ",ORYX.I18N.jPDLSupport.error="Error",ORYX.I18N.jPDLSupport.selectFile="Select an jPDL (.xml) file or type in the jPDL to import it!",ORYX.I18N.jPDLSupport.file="File",ORYX.I18N.jPDLSupport.impJPDL="Import jPDL",ORYX.I18N.jPDLSupport.impBtn="Import",ORYX.I18N.jPDLSupport.impProgress="Importing...",ORYX.I18N.jPDLSupport.close="Close",ORYX.I18N.Save||(ORYX.I18N.Save={}),ORYX.I18N.Save.group="File",ORYX.I18N.Save.save="Save",ORYX.I18N.Save.saveDesc="Save",ORYX.I18N.Save.saveAs="Save As...",ORYX.I18N.Save.saveAsDesc="Save As...",ORYX.I18N.Save.unsavedData="There are unsaved data, please save before you leave, otherwise your changes get lost!",ORYX.I18N.Save.newProcess="New Process",ORYX.I18N.Save.saveAsTitle="Save as...",ORYX.I18N.Save.saveBtn="Save",ORYX.I18N.Save.close="Close",ORYX.I18N.Save.savedAs="Saved As",ORYX.I18N.Save.saved="Saved!",ORYX.I18N.Save.failed="Saving failed.",ORYX.I18N.Save.noRights="You have no rights to save changes.",ORYX.I18N.Save.saving="Saving",ORYX.I18N.Save.saveAsHint="The process diagram is stored under:",ORYX.I18N.File||(ORYX.I18N.File={}),ORYX.I18N.File.group="File",ORYX.I18N.File.print="Print",ORYX.I18N.File.printDesc="Print current model",ORYX.I18N.File.pdf="Export as PDF",ORYX.I18N.File.pdfDesc="Export as PDF",ORYX.I18N.File.info="Info",ORYX.I18N.File.infoDesc="Info",ORYX.I18N.File.genPDF="Generating PDF",ORYX.I18N.File.genPDFFailed="Generating PDF failed.",ORYX.I18N.File.printTitle="Print",ORYX.I18N.File.printMsg="We are currently experiencing problems with the printing function. We recommend using the PDF Export to print the diagram. Do you really want to continue printing?",ORYX.I18N.Grouping||(ORYX.I18N.Grouping={}),ORYX.I18N.Grouping.grouping="Grouping",ORYX.I18N.Grouping.group="Group",ORYX.I18N.Grouping.groupDesc="Groups all selected shapes",ORYX.I18N.Grouping.ungroup="Ungroup",ORYX.I18N.Grouping.ungroupDesc="Deletes the group of all selected Shapes",ORYX.I18N.Loading||(ORYX.I18N.Loading={}),ORYX.I18N.Loading.waiting="Please wait...",ORYX.I18N.PropertyWindow||(ORYX.I18N.PropertyWindow={}),ORYX.I18N.PropertyWindow.name="Name",ORYX.I18N.PropertyWindow.value="Value",ORYX.I18N.PropertyWindow.selected="selected",ORYX.I18N.PropertyWindow.clickIcon="Click Icon",ORYX.I18N.PropertyWindow.add="Add",ORYX.I18N.PropertyWindow.rem="Remove",ORYX.I18N.PropertyWindow.complex="Editor for a Complex Type",ORYX.I18N.PropertyWindow.text="Editor for a Text Type",ORYX.I18N.PropertyWindow.ok="Ok",ORYX.I18N.PropertyWindow.cancel="Cancel",ORYX.I18N.PropertyWindow.dateFormat="m/d/y",ORYX.I18N.ShapeMenuPlugin||(ORYX.I18N.ShapeMenuPlugin={}),ORYX.I18N.ShapeMenuPlugin.drag="Drag",ORYX.I18N.ShapeMenuPlugin.clickDrag="Click or drag",ORYX.I18N.ShapeMenuPlugin.morphMsg="Morph shape",ORYX.I18N.SyntaxChecker||(ORYX.I18N.SyntaxChecker={}),ORYX.I18N.SyntaxChecker.group="Verification",ORYX.I18N.SyntaxChecker.name="Syntax Checker",ORYX.I18N.SyntaxChecker.desc="Check Syntax",ORYX.I18N.SyntaxChecker.noErrors="There are no syntax errors.",ORYX.I18N.SyntaxChecker.invalid="Invalid answer from server.",ORYX.I18N.SyntaxChecker.checkingMessage="Checking ...",ORYX.I18N.FormHandler||(ORYX.I18N.FormHandler={}),ORYX.I18N.FormHandler.group="FormHandling",ORYX.I18N.FormHandler.name="FormHandler",ORYX.I18N.FormHandler.desc="Testing from handling",ORYX.I18N.Deployer||(ORYX.I18N.Deployer={}),ORYX.I18N.Deployer.group="Deployment",ORYX.I18N.Deployer.name="Deployer",ORYX.I18N.Deployer.desc="Deploy to engine",ORYX.I18N.Tester||(ORYX.I18N.Tester={}),ORYX.I18N.Tester.group="Testing",ORYX.I18N.Tester.name="Test process",ORYX.I18N.Tester.desc="Open the test component to test this process definition",ORYX.I18N.Undo||(ORYX.I18N.Undo={}),ORYX.I18N.Undo.group="Undo",ORYX.I18N.Undo.undo="Undo",ORYX.I18N.Undo.undoDesc="Undo the last action",ORYX.I18N.Undo.redo="Redo",ORYX.I18N.Undo.redoDesc="Redo the last undone action",ORYX.I18N.View||(ORYX.I18N.View={}),ORYX.I18N.View.group="Zoom",ORYX.I18N.View.zoomIn="Zoom In",ORYX.I18N.View.zoomInDesc="Zoom into the model",ORYX.I18N.View.zoomOut="Zoom Out",ORYX.I18N.View.zoomOutDesc="Zoom out of the model",ORYX.I18N.View.zoomStandard="Zoom Standard",ORYX.I18N.View.zoomStandardDesc="Zoom to the standard level",ORYX.I18N.View.zoomFitToModel="Zoom fit to model",ORYX.I18N.View.zoomFitToModelDesc="Zoom to fit the model size",ORYX.I18N.XFormsSerialization||(ORYX.I18N.XFormsSerialization={}),ORYX.I18N.XFormsSerialization.group="XForms Serialization",ORYX.I18N.XFormsSerialization.exportXForms="XForms Export",ORYX.I18N.XFormsSerialization.exportXFormsDesc="Export XForms+XHTML markup",ORYX.I18N.XFormsSerialization.importXForms="XForms Import",ORYX.I18N.XFormsSerialization.importXFormsDesc="Import XForms+XHTML markup",ORYX.I18N.XFormsSerialization.noClientXFormsSupport="No XForms support",ORYX.I18N.XFormsSerialization.noClientXFormsSupportDesc='<h2>Your browser does not support XForms. Please install the <a href="https://addons.mozilla.org/firefox/addon/824" target="_blank">Mozilla XForms Add-on</a> for Firefox.</h2>',ORYX.I18N.XFormsSerialization.ok="Ok",ORYX.I18N.XFormsSerialization.selectFile="Select a XHTML (.xhtml) file or type in the XForms+XHTML markup to import it!",ORYX.I18N.XFormsSerialization.selectCss="Please insert url of css file",ORYX.I18N.XFormsSerialization.file="File",ORYX.I18N.XFormsSerialization.impFailed="Request for import of document failed.",ORYX.I18N.XFormsSerialization.impTitle="Import XForms+XHTML document",ORYX.I18N.XFormsSerialization.expTitle="Export XForms+XHTML document",ORYX.I18N.XFormsSerialization.impButton="Import",ORYX.I18N.XFormsSerialization.impProgress="Importing...",ORYX.I18N.XFormsSerialization.close="Close",ORYX.I18N.PropertyWindow.title="Properties",ORYX.I18N.ShapeRepository||(ORYX.I18N.ShapeRepository={}),ORYX.I18N.ShapeRepository.title="Shape Repository",ORYX.I18N.Save.dialogDesciption="Please enter a name, a description and a comment.",ORYX.I18N.Save.dialogLabelTitle="Title",ORYX.I18N.Save.dialogLabelDesc="Description",ORYX.I18N.Save.dialogLabelType="Type",ORYX.I18N.Save.dialogLabelComment="Revision comment",ORYX.I18N.Perspective||(ORYX.I18N.Perspective={}),ORYX.I18N.Perspective.no="No Perspective",ORYX.I18N.Perspective.noTip="Unload the current perspective",ORYX.I18N.JSONSupport={imp:{name:"Import from JSON",desc:"Imports a model from JSON",group:"Export",selectFile:"Select an JSON (.json) file or type in JSON to import it!",file:"File",btnImp:"Import",btnClose:"Close",progress:"Importing ...",syntaxError:"Syntax error"},exp:{name:"Export to JSON",desc:"Exports current model to JSON",group:"Export"}},ORYX.I18N.JSONImport||(ORYX.I18N.JSONImport={}),ORYX.I18N.JSONImport.title="JSON Import",ORYX.I18N.JSONImport.wrongSS="The stencil set of the imported file ({0}) does not match to the loaded stencil set ({1}).",ORYX.I18N.RDFExport||(ORYX.I18N.RDFExport={}),ORYX.I18N.RDFExport.group="Export",ORYX.I18N.RDFExport.rdfExport="Export to RDF",ORYX.I18N.RDFExport.rdfExportDescription="Exports current model to the XML serialization defined for the Resource Description Framework (RDF)",ORYX.I18N.SyntaxChecker.BPMN||(ORYX.I18N.SyntaxChecker.BPMN={}),ORYX.I18N.SyntaxChecker.BPMN_NO_SOURCE="An edge must have a source.",ORYX.I18N.SyntaxChecker.BPMN_NO_TARGET="An edge must have a target.",ORYX.I18N.SyntaxChecker.BPMN_DIFFERENT_PROCESS="Source and target node must be contained in the same process.",ORYX.I18N.SyntaxChecker.BPMN_SAME_PROCESS="Source and target node must be contained in different pools.",ORYX.I18N.SyntaxChecker.BPMN_FLOWOBJECT_NOT_CONTAINED_IN_PROCESS="A flow object must be contained in a process.",ORYX.I18N.SyntaxChecker.BPMN_ENDEVENT_WITHOUT_INCOMING_CONTROL_FLOW="An end event must have an incoming sequence flow.",ORYX.I18N.SyntaxChecker.BPMN_STARTEVENT_WITHOUT_OUTGOING_CONTROL_FLOW="A start event must have an outgoing sequence flow.",ORYX.I18N.SyntaxChecker.BPMN_STARTEVENT_WITH_INCOMING_CONTROL_FLOW="Start events must not have incoming sequence flows.",ORYX.I18N.SyntaxChecker.BPMN_ATTACHEDINTERMEDIATEEVENT_WITH_INCOMING_CONTROL_FLOW="Attached intermediate events must not have incoming sequence flows.",ORYX.I18N.SyntaxChecker.BPMN_ATTACHEDINTERMEDIATEEVENT_WITHOUT_OUTGOING_CONTROL_FLOW="Attached intermediate events must have exactly one outgoing sequence flow.",ORYX.I18N.SyntaxChecker.BPMN_ENDEVENT_WITH_OUTGOING_CONTROL_FLOW="End events must not have outgoing sequence flows.",ORYX.I18N.SyntaxChecker.BPMN_EVENTBASEDGATEWAY_BADCONTINUATION="Event-based gateways must not be followed by gateways or subprocesses.",ORYX.I18N.SyntaxChecker.BPMN_NODE_NOT_ALLOWED="Node type is not allowed.",ORYX.I18N.SyntaxChecker.IBPMN||(ORYX.I18N.SyntaxChecker.IBPMN={}),ORYX.I18N.SyntaxChecker.IBPMN_NO_ROLE_SET="Interactions must have a sender and a receiver role set",ORYX.I18N.SyntaxChecker.IBPMN_NO_INCOMING_SEQFLOW="This node must have incoming sequence flow.",ORYX.I18N.SyntaxChecker.IBPMN_NO_OUTGOING_SEQFLOW="This node must have outgoing sequence flow.",ORYX.I18N.SyntaxChecker.InteractionNet||(ORYX.I18N.SyntaxChecker.InteractionNet={}),ORYX.I18N.SyntaxChecker.InteractionNet_SENDER_NOT_SET="Sender not set",ORYX.I18N.SyntaxChecker.InteractionNet_RECEIVER_NOT_SET="Receiver not set",ORYX.I18N.SyntaxChecker.InteractionNet_MESSAGETYPE_NOT_SET="Message type not set",ORYX.I18N.SyntaxChecker.InteractionNet_ROLE_NOT_SET="Role not set",ORYX.I18N.SyntaxChecker.EPC||(ORYX.I18N.SyntaxChecker.EPC={}),ORYX.I18N.SyntaxChecker.EPC_NO_SOURCE="Each edge must have a source.",ORYX.I18N.SyntaxChecker.EPC_NO_TARGET="Each edge must have a target.",ORYX.I18N.SyntaxChecker.EPC_NOT_CONNECTED="Node must be connected with edges.",ORYX.I18N.SyntaxChecker.EPC_NOT_CONNECTED_2="Node must be connected with more edges.",ORYX.I18N.SyntaxChecker.EPC_TOO_MANY_EDGES="Node has too many connected edges.",ORYX.I18N.SyntaxChecker.EPC_NO_CORRECT_CONNECTOR="Node is no correct connector.",ORYX.I18N.SyntaxChecker.EPC_MANY_STARTS="There must be only one start event.",ORYX.I18N.SyntaxChecker.EPC_FUNCTION_AFTER_OR="There must be no functions after a splitting OR/XOR.",ORYX.I18N.SyntaxChecker.EPC_PI_AFTER_OR="There must be no process interface after a splitting OR/XOR.",ORYX.I18N.SyntaxChecker.EPC_FUNCTION_AFTER_FUNCTION="There must be no function after a function.",ORYX.I18N.SyntaxChecker.EPC_EVENT_AFTER_EVENT="There must be no event after an event.",ORYX.I18N.SyntaxChecker.EPC_PI_AFTER_FUNCTION="There must be no process interface after a function.",ORYX.I18N.SyntaxChecker.EPC_FUNCTION_AFTER_PI="There must be no function after a process interface.",ORYX.I18N.SyntaxChecker.EPC_SOURCE_EQUALS_TARGET="Edge must connect two distinct nodes.",ORYX.I18N.SyntaxChecker.PetriNet||(ORYX.I18N.SyntaxChecker.PetriNet={}),ORYX.I18N.SyntaxChecker.PetriNet_NOT_BIPARTITE="The graph is not bipartite",ORYX.I18N.SyntaxChecker.PetriNet_NO_LABEL="Label not set for a labeled transition",ORYX.I18N.SyntaxChecker.PetriNet_NO_ID="There is a node without id",ORYX.I18N.SyntaxChecker.PetriNet_SAME_SOURCE_AND_TARGET="Two flow relationships have the same source and target",ORYX.I18N.SyntaxChecker.PetriNet_NODE_NOT_SET="A node is not set for a flowrelationship",ORYX.I18N.Edge="Edge",ORYX.I18N.Node="Node",ORYX.I18N.SyntaxChecker.notice="Move the mouse over a red cross icon to see the error message.",ORYX.I18N.RESIZE||(ORYX.I18N.RESIZE={}),ORYX.I18N.RESIZE.tipGrow="Increase canvas size:",ORYX.I18N.RESIZE.tipShrink="Decrease canvas size:",ORYX.I18N.RESIZE.N="Top",ORYX.I18N.RESIZE.W="Left",ORYX.I18N.RESIZE.S="Down",ORYX.I18N.RESIZE.E="Right",ORYX.I18N.Layouting||(ORYX.I18N.Layouting={}),ORYX.I18N.Layouting.doing="Layouting...",ORYX.I18N.SyntaxChecker.MULT_ERRORS="Multiple Errors",ORYX.I18N.PropertyWindow||(ORYX.I18N.PropertyWindow={}),ORYX.I18N.PropertyWindow.oftenUsed="Often used",ORYX.I18N.PropertyWindow.moreProps="More Properties",ORYX.I18N.SyntaxChecker.BPMN2||(ORYX.I18N.SyntaxChecker.BPMN2={}),ORYX.I18N.SyntaxChecker.BPMN2_DATA_INPUT_WITH_INCOMING_DATA_ASSOCIATION="A Data Input must not have any incoming Data Associations.",ORYX.I18N.SyntaxChecker.BPMN2_DATA_OUTPUT_WITH_OUTGOING_DATA_ASSOCIATION="A Data Output must not have any outgoing Data Associations.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_TARGET_WITH_TOO_MANY_INCOMING_SEQUENCE_FLOWS="Targets of Event-based Gateways may only have one incoming Sequence Flow.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_WITH_TOO_LESS_OUTGOING_SEQUENCE_FLOWS="An Event-based Gateway must have two or more outgoing Sequence Flows.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_EVENT_TARGET_CONTRADICTION="If Message Intermediate Events are used in the configuration, then Receive Tasks must not be used and vice versa.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_WRONG_TRIGGER="Only the following Intermediate Event triggers are valid: Message, Signal, Timer, Conditional and Multiple.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_WRONG_CONDITION_EXPRESSION="The outgoing Sequence Flows of the Event Gateway must not have a condition expression.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_NOT_INSTANTIATING="The Gateway does not meet the conditions to instantiate the process. Please use a start event or an instantiating attribute for the gateway.",ORYX.I18N.SyntaxChecker.BPMN2_GATEWAYDIRECTION_MIXED_FAILURE="The Gateway must have both multiple incoming and outgoing Sequence Flows.",ORYX.I18N.SyntaxChecker.BPMN2_GATEWAYDIRECTION_CONVERGING_FAILURE="The Gateway must have multiple incoming but most NOT have multiple outgoing Sequence Flows.",ORYX.I18N.SyntaxChecker.BPMN2_GATEWAYDIRECTION_DIVERGING_FAILURE="The Gateway must NOT have multiple incoming but must have multiple outgoing Sequence Flows.",ORYX.I18N.SyntaxChecker.BPMN2_GATEWAY_WITH_NO_OUTGOING_SEQUENCE_FLOW="A Gateway must have a minimum of one outgoing Sequence Flow.",ORYX.I18N.SyntaxChecker.BPMN2_RECEIVE_TASK_WITH_ATTACHED_EVENT="Receive Tasks used in Event Gateway configurations must not have any attached Intermediate Events.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_SUBPROCESS_BAD_CONNECTION="An Event Subprocess must not have any incoming or outgoing Sequence Flow.",ORYX.I18N.SyntaxChecker.BPMN_MESSAGE_FLOW_NOT_CONNECTED="At least one side of the Message Flow has to be connected.",ORYX.I18N.SyntaxChecker.BPMN2_TOO_MANY_INITIATING_MESSAGES="A Choreography Activity may only have one initiating message.",ORYX.I18N.SyntaxChecker.BPMN_MESSAGE_FLOW_NOT_ALLOWED="A Message Flow is not allowed here.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_WITH_TOO_LESS_INCOMING_SEQUENCE_FLOWS="An Event-based Gateway that is not instantiating must have a minimum of one incoming Sequence Flow.",ORYX.I18N.SyntaxChecker.BPMN2_TOO_FEW_INITIATING_PARTICIPANTS="A Choreography Activity must have one initiating Participant (white).",ORYX.I18N.SyntaxChecker.BPMN2_TOO_MANY_INITIATING_PARTICIPANTS="A Choreography Acitivity must not have more than one initiating Participant (white).",ORYX.I18N.SyntaxChecker.COMMUNICATION_AT_LEAST_TWO_PARTICIPANTS="The communication must be connected to at least two participants.",ORYX.I18N.SyntaxChecker.MESSAGEFLOW_START_MUST_BE_PARTICIPANT="The message flow's source must be a participant.",ORYX.I18N.SyntaxChecker.MESSAGEFLOW_END_MUST_BE_PARTICIPANT="The message flow's target must be a participant.",ORYX.I18N.SyntaxChecker.CONV_LINK_CANNOT_CONNECT_CONV_NODES="The conversation link must connect a communication or sub conversation node with a participant.",ORYX.I18N.PropertyWindow.dateFormat="d/m/y",ORYX.I18N.View.East="Attributes",ORYX.I18N.View.West="Modeling Elements",ORYX.I18N.Oryx.title="Signavio",ORYX.I18N.Oryx.pleaseWait="Please wait while the Signavio Process Editor is loading...",ORYX.I18N.Edit.cutDesc="Cuts the selection into the clipboard",ORYX.I18N.Edit.copyDesc="Copies the selection into the clipboard",ORYX.I18N.Edit.pasteDesc="Pastes the clipboard to the canvas",ORYX.I18N.ERDFSupport.noCanvas="The xml document has no canvas node included!",ORYX.I18N.ERDFSupport.noSS="The Signavio Process Editor canvas node has no stencil set definition included!",ORYX.I18N.ERDFSupport.deprText="Exporting to eRDF is not recommended anymore because the support will be stopped in future versions of the Signavio Process Editor. If possible, export the model to JSON. Do you want to export anyway?",ORYX.I18N.Save.pleaseWait="Please wait<br/>while saving...",ORYX.I18N.Save.saveAs="Save a copy...",ORYX.I18N.Save.saveAsDesc="Save a copy...",ORYX.I18N.Save.saveAsTitle="Save a copy...",ORYX.I18N.Save.savedAs="Copy saved",ORYX.I18N.Save.savedDescription="The process diagram is stored under",ORYX.I18N.Save.notAuthorized="You are currently not logged in. Please <a href='/p/login' target='_blank'>log in</a> in a new window so that you can save the current diagram.",ORYX.I18N.Save.transAborted="The saving request took too long. You may use a faster internet connection. If you use wireless LAN, please check the strength of your connection.",ORYX.I18N.Save.noRights="You do not have the required rights to store that model. Please check in the <a href='/p/explorer' target='_blank'>Signavio Explorer</a>, if you still have the rights to write in the target directory.",ORYX.I18N.Save.comFailed="The communication with the Signavio server failed. Please check your internet connection. If the problem resides, please contact the Signavio Support via the envelope symbol in the toolbar.",ORYX.I18N.Save.failed="Something went wrong when trying to save your diagram. Please try again. If the problem resides, please contact the Signavio Support via the envelope symbol in the toolbar.",ORYX.I18N.Save.exception="Some exceptions are raised while trying to save your diagram. Please try again. If the problem resides, please contact the Signavio Support via the envelope symbol in the toolbar.",ORYX.I18N.Save.retrieveData="Please wait, data is retrieving.",ORYX.I18N.ShapeMenuPlugin||(ORYX.I18N.ShapeMenuPlugin={}),ORYX.I18N.ShapeMenuPlugin.morphMsg="Transform shape",ORYX.I18N.ShapeMenuPlugin.morphWarningTitleMsg="Transform shape",ORYX.I18N.ShapeMenuPlugin.morphWarningMsg="There are child shape which can not be contained in the transformed element.<br/>Do you want to transform anyway?",!Signavio)var Signavio={};if(Signavio.I18N||(Signavio.I18N={}),Signavio.I18N.Editor||(Signavio.I18N.Editor={}),Signavio.I18N.Editor.Linking||(Signavio.I18N.Editor.Linking={}),Signavio.I18N.Editor.Linking.CreateDiagram="Create a new diagram",Signavio.I18N.Editor.Linking.UseDiagram="Use existing diagram",Signavio.I18N.Editor.Linking.UseLink="Use web link",Signavio.I18N.Editor.Linking.Close="Close",Signavio.I18N.Editor.Linking.Cancel="Cancel",Signavio.I18N.Editor.Linking.UseName="Adopt diagram name",Signavio.I18N.Editor.Linking.UseNameHint="Replaces the current name of the modeling element ({type}) with the name of the linked diagram.",Signavio.I18N.Editor.Linking.CreateTitle="Establish link",Signavio.I18N.Editor.Linking.AlertSelectModel="You have to select a model.",Signavio.I18N.Editor.Linking.ButtonLink="Link diagram",Signavio.I18N.Editor.Linking.LinkNoAccess="You have no access to this diagram.",Signavio.I18N.Editor.Linking.LinkUnavailable="The diagram is unavailable.",Signavio.I18N.Editor.Linking.RemoveLink="Remove link",Signavio.I18N.Editor.Linking.EditLink="Edit Link",Signavio.I18N.Editor.Linking.OpenLink="Open",Signavio.I18N.Editor.Linking.BrokenLink="The link is broken!",Signavio.I18N.Editor.Linking.PreviewTitle="Preview",Signavio.I18N.Glossary_Support||(Signavio.I18N.Glossary_Support={}),Signavio.I18N.Glossary_Support.renameEmpty="No dictionary entry",Signavio.I18N.Glossary_Support.renameLoading="Searching...",ORYX.I18N.PropertyWindow||(ORYX.I18N.PropertyWindow={}),ORYX.I18N.PropertyWindow.oftenUsed="Main properties",ORYX.I18N.PropertyWindow.moreProps="More properties",ORYX.I18N.PropertyWindow.btnOpen="Open",ORYX.I18N.PropertyWindow.btnRemove="Remove",ORYX.I18N.PropertyWindow.btnEdit="Edit",ORYX.I18N.PropertyWindow.btnUp="Move up",ORYX.I18N.PropertyWindow.btnDown="Move down",ORYX.I18N.PropertyWindow.createNew="Create new",ORYX.I18N.PropertyWindow||(ORYX.I18N.PropertyWindow={}),ORYX.I18N.PropertyWindow.oftenUsed="Main attributes",ORYX.I18N.PropertyWindow.moreProps="More attributes",ORYX.I18N.PropertyWindow.characteristicNr="Cost &amp; Resource Analysis",ORYX.I18N.PropertyWindow.meta="Custom attributes",ORYX.I18N.PropertyWindow.Category||(ORYX.I18N.PropertyWindow.Category={}),ORYX.I18N.PropertyWindow.Category.popular="Main Attributes",ORYX.I18N.PropertyWindow.Category.characteristicnr="Cost &amp; Resource Analysis",ORYX.I18N.PropertyWindow.Category.others="More Attributes",ORYX.I18N.PropertyWindow.Category.meta="Custom Attributes",ORYX.I18N.PropertyWindow.ListView||(ORYX.I18N.PropertyWindow.ListView={}),ORYX.I18N.PropertyWindow.ListView.title="Edit: ",ORYX.I18N.PropertyWindow.ListView.dataViewLabel="Already existing entries.",ORYX.I18N.PropertyWindow.ListView.dataViewEmptyText="No list entries.",ORYX.I18N.PropertyWindow.ListView.addEntryLabel="Add a new entry",ORYX.I18N.PropertyWindow.ListView.buttonAdd="Add",ORYX.I18N.PropertyWindow.ListView.save="Save",ORYX.I18N.PropertyWindow.ListView.cancel="Cancel",Signavio.I18N.Buttons||(Signavio.I18N.Buttons={}),Signavio.I18N.Buttons.save="Save",Signavio.I18N.Buttons.cancel="Cancel",Signavio.I18N.Buttons.remove="Remove",Signavio.I18N.btn||(Signavio.I18N.btn={}),Signavio.I18N.btn.btnEdit="Edit",Signavio.I18N.btn.btnRemove="Remove",Signavio.I18N.btn.moveUp="Move up",Signavio.I18N.btn.moveDown="Move down",Signavio.I18N.field||(Signavio.I18N.field={}),Signavio.I18N.field.Url="URL",Signavio.I18N.field.UrlLabel="Label",!ORYX)var ORYX={};ORYX.Utils={getParamFromUrl:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",i=RegExp(t),o=i.exec(window.location.href);return null==o?null:o[1]},adjustLightness:function(){return arguments[0]},adjustGradient:function(e,t){if(ORYX.CONFIG.DISABLE_GRADIENT&&e){var i=t.getAttributeNS(null,"stop-color")||"#ffffff";$A(e.getElementsByTagName("stop")).each(function(e){e!=t&&e.setAttributeNS(null,"stop-color",i)})}}},XMLNS={ATOM:"http://www.w3.org/2005/Atom",XHTML:"http://www.w3.org/1999/xhtml",ERDF:"http://purl.org/NET/erdf/profile",RDFS:"http://www.w3.org/2000/01/rdf-schema#",RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RAZIEL:"http://b3mn.org/Raziel",SCHEMA:""};var Kickstart={started:!1,callbacks:[],alreadyLoaded:[],PATH:"",load:function(){Kickstart.kick()},kick:function(){Kickstart.started||(Kickstart.started=!0,Kickstart.callbacks.each(function(e){window.setTimeout(e,1)}))},register:function(callback){with(Kickstart)started?window.setTimeout(callback,1):Kickstart.callbacks.push(callback)},require:function(e){return Kickstart.alreadyLoaded.member(e)?!1:Kickstart.include(e)},include:function(e){var t=document.getElementsByTagNameNS(XMLNS.XHTML,"head")[0],i=document.createElementNS(XMLNS.XHTML,"script");return i.setAttributeNS(XMLNS.XHTML,"type","text/javascript"),i.src=Kickstart.PATH+e,t.appendChild(i),Kickstart.alreadyLoaded.push(e),!0}};Event.observe(window,"load",Kickstart.load);var ERDF={LITERAL:1,RESOURCE:2,DELIMITERS:[".","-"],HASH:"#",HYPHEN:"-",schemas:[],callback:void 0,log:void 0,init:function(e){ERDF.callback=e,ERDF.registerSchema("schema",XMLNS.SCHEMA),ERDF.registerSchema("rdfs",XMLNS.RDFS)},run:function(){return ERDF._checkProfile()&&ERDF.parse()},parse:function(){ERDF.__startTime=new Date;var e=document.getElementsByTagNameNS(XMLNS.XHTML,"body"),t={type:ERDF.RESOURCE,value:""},i=ERDF._parseDocumentMetadata()&&ERDF._parseFromTag(e[0],t);
return ERDF.__stopTime=new Date,(ERDF.__stopTime-ERDF.__startTime)/1e3,i},_parseDocumentMetadata:function(){var e=document.getElementsByTagNameNS(XMLNS.XHTML,"head"),t=e[0].getElementsByTagNameNS(XMLNS.XHTML,"link"),i=e[0].getElementsByTagNameNS(XMLNS.XHTML,"meta");return $A(t).each(function(e){var t=e.getAttribute("rel"),i=e.getAttribute("rev"),o=e.getAttribute("href");ERDF._parseTriplesFrom(ERDF.RESOURCE,"",t,ERDF.RESOURCE,o),ERDF._parseTriplesFrom(ERDF.RESOURCE,o,i,ERDF.RESOURCE,"")}),$A(i).each(function(e){var t=e.getAttribute("name"),i=e.getAttribute("content");ERDF._parseTriplesFrom(ERDF.RESOURCE,"",t,ERDF.LITERAL,i)}),!0},_parseFromTag:function(e,t,i){if(e&&e.namespaceURI&&e.namespaceURI==XMLNS.XHTML){i||(i=0);var o=e.getAttribute("id");if(e.nodeName.endsWith(":a")||"a"==e.nodeName){var n=e.getAttribute("rel"),r=e.getAttribute("rev"),a=e.getAttribute("href"),s=e.getAttribute("title"),l=e.textContent;ERDF._parseTriplesFrom(t.type,t.value,n,ERDF.RESOURCE,a,function(e){var t=s?s:l;ERDF._parseTriplesFrom(e.object.type,e.object.value,"rdfs.label",ERDF.LITERAL,t)}),ERDF._parseTriplesFrom(t.type,t.value,r,ERDF.RESOURCE,""),ERDF._parseTypeTriplesFrom(t.type,t.value,n)}else if(e.nodeName.endsWith(":img")||"img"==e.nodeName){var n=e.getAttribute("class"),a=e.getAttribute("src"),d=e.getAttribute("alt");ERDF._parseTriplesFrom(t.type,t.value,n,ERDF.RESOURCE,a,function(e){var t=d;ERDF._parseTriplesFrom(e.object.type,e.object.value,"rdfs.label",ERDF.LITERAL,t)})}var n=e.getAttribute("class"),s=e.getAttribute("title"),l=e.textContent,c=s?s:l;ERDF._parseTriplesFrom(t.type,t.value,n,ERDF.LITERAL,c),o&&(t={type:ERDF.RESOURCE,value:ERDF.HASH+o}),ERDF._parseTypeTriplesFrom(t.type,t.value,n);var p=e.childNodes;p&&$A(p).each(function(e){e.nodeType==e.ELEMENT_NODE&&ERDF._parseFromTag(e,t,i+1)})}},_parseTriplesFrom:function(e,t,i,o,n,r){i&&i.toLowerCase().split(" ").each(function(e){var i=ERDF.schemas.find(function(t){return!1||ERDF.DELIMITERS.find(function(i){return e.startsWith(t.prefix+i)})});if(i&&n){e=e.substring(i.prefix.length+1,e.length);var a=ERDF.registerTriple(new ERDF.Resource(t),{prefix:i.prefix,name:e},o==ERDF.RESOURCE?new ERDF.Resource(n):new ERDF.Literal(n));r&&r(a)}})},_parseTypeTriplesFrom:function(e,t,i,o){i&&i.toLowerCase().split(" ").each(function(i){var n=ERDF.schemas.find(function(e){return!1||ERDF.DELIMITERS.find(function(t){return i.startsWith(ERDF.HYPHEN+e.prefix+t)})});if(n&&t){i=i.substring(n.prefix.length+2,i.length);var r=ERDF.registerTriple(e==ERDF.RESOURCE?new ERDF.Resource(t):new ERDF.Literal(t),{prefix:"rdf",name:"type"},new ERDF.Resource(n.namespace+i));o&&o(r)}})},_checkProfile:function(){var e=document.getElementsByTagNameNS(XMLNS.XHTML,"head"),t=e[0].getAttribute("profile");return t&&t.split(" ").member(XMLNS.ERDF)?!0:!1},__stripHashes:function(e){return e&&"function"==typeof e.substring&&"#"==e.substring(0,1)?e.substring(1,e.length):e},registerSchema:function(e,t){ERDF.schemas.push({prefix:e,namespace:t})},registerTriple:function(e,t,i){"schema"==t.prefix.toLowerCase()&&this.registerSchema(t.name,i.value);var o=new ERDF.Triple(e,t,i);return ERDF.callback(o),o},__enhanceObject:function(){this.isResource=function(){return this.type==ERDF.RESOURCE},this.isLocal=function(){return this.isResource()&&this.value.startsWith("#")},this.isCurrentDocument=function(){return this.isResource()&&""==this.value},this.getId=function(){return this.isLocal()?ERDF.__stripHashes(this.value):!1},this.isLiteral=function(){return this.type==ERDF.LIITERAL}},serialize:function(e){return e?e.constructor==String?e:e.constructor==Boolean?e?"true":"false":""+e:""}};ERDF.Triple=function(e,t,i){this.subject=e,this.predicate=t,this.object=i,this.toString=function(){return"[ERDF.Triple] "+(""+this.subject)+" "+this.predicate.prefix+":"+this.predicate.name+" "+(""+this.object)}},ERDF.Resource=function(e){this.type=ERDF.RESOURCE,this.value=e,ERDF.__enhanceObject.apply(this),this.toString=function(){return"&lt;"+this.value+"&gt;"}},ERDF.Literal=function(e){this.type=ERDF.LITERAL,this.value=ERDF.serialize(e),ERDF.__enhanceObject.apply(this),this.toString=function(){return'"'+this.value+'"'}};var USE_ASYNCHRONOUS_REQUESTS=!0,DISCARD_UNUSED_TRIPLES=!0,PREFER_SPANS_OVER_DIVS=!0,PREFER_TITLE_OVER_TEXTNODE=!1,RESOURCE_ID_PREFIX="resource",SHOW_DEBUG_ALERTS_WHEN_SAVING=!1,SHOW_EXTENDED_DEBUG_INFORMATION=!1,USE_ARESS_WORKAROUNDS=!0,RESOURCE_CREATED=1,RESOURCE_REMOVED=2,RESOURCE_SAVED=4,RESOURCE_RELOADED=8,RESOURCE_SYNCHRONIZED=16,TRIPLE_REMOVE=1,TRIPLE_ADD=2,TRIPLE_RELOAD=4,TRIPLE_SAVE=8,PROCESSDATA_REF="processdata",DataManager={init:function(){ERDF.init(DataManager._registerTriple),DataManager.__synclocal()},_triples:[],_registerTriple:function(e){DataManager._triples.push(e)},__synclocal:function(){DataManager._triples=[],ERDF.run()},__synchronizeShape:function(e){var t=ResourceManager.getResource(e.resourceId),i=e.serialize();return i.each(function(t){var i="resource"==t.type,o=new ERDF.Triple(new ERDF.Resource(e.resourceId),{prefix:t.prefix,name:t.name},i?new ERDF.Resource(t.value):new ERDF.Literal(t.value));DataManager.setObject(o)}),t},__storeShape:function(e){var t=DataManager.__synchronizeShape(e);t.save()},__forceExistance:function(e){if($(e.resourceId)){var t=$(e.resourceId),i=$A(t.childNodes);i.each(function(e){t.removeChild(e)})}else $$("."+PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{"class":PROCESSDATA_REF,style:"display:none;"}]),DataManager.graft(XMLNS.XHTML,$$("."+PROCESSDATA_REF)[0],["div",{id:e.resourceId,"class":e instanceof ORYX.Core.Canvas?"-oryx-canvas":void 0}])},__persistShape:function(e){var t=e.serialize(),i=new ERDF.Resource(e.resourceId);DataManager.removeTriples(DataManager.query(i,void 0,void 0)),t.each(function(e){var t="resource"==e.type?new ERDF.Resource(e.value):new ERDF.Literal(e.value);DataManager.addTriple(new ERDF.Triple(i,{prefix:e.prefix,name:e.name},t))})},__persistDOM:function(e){var t=e.getCanvas(),i=t.getChildShapes(!0),o="";return i.each(function(e){DataManager.__forceExistance(e)}),DataManager.__renderCanvas(e),o+=DataManager.serialize($(ERDF.__stripHashes(e.getCanvas().resourceId)),!0),i.each(function(e){DataManager.__persistShape(e),o+=DataManager.serialize($(ERDF.__stripHashes(e.resourceId)),!0)}),o},__renderCanvas:function(e){var t=e.getCanvas(),i=e.getStencilSets(),o=t.getChildShapes(!0);DataManager.__forceExistance(t),DataManager.__persistShape(t);var n=new ERDF.Resource(t.resourceId);DataManager.removeTriples(DataManager.query(n,void 0,void 0)),DataManager.addTriple(new ERDF.Triple(n,{prefix:"oryx",name:"mode"},new ERDF.Literal("writable"))),DataManager.addTriple(new ERDF.Triple(n,{prefix:"oryx",name:"mode"},new ERDF.Literal("fullscreen"))),i.values().each(function(e){DataManager.addTriple(new ERDF.Triple(n,{prefix:"oryx",name:"stencilset"},new ERDF.Resource(e.source().replace(/&/g,"%26")))),DataManager.addTriple(new ERDF.Triple(n,{prefix:"oryx",name:"ssnamespace"},new ERDF.Resource(e.namespace()))),e.extensions().keys().each(function(e){DataManager.addTriple(new ERDF.Triple(n,{prefix:"oryx",name:"ssextension"},new ERDF.Literal(e)))})}),o.each(function(e){DataManager.addTriple(new ERDF.Triple(n,{prefix:"oryx",name:"render"},new ERDF.Resource("#"+e.resourceId)))})},__counter:0,__provideId:function(){for(;$(RESOURCE_ID_PREFIX+DataManager.__counter);)DataManager.__counter++;return RESOURCE_ID_PREFIX+DataManager.__counter},serializeDOM:function(e){return DataManager.__persistDOM(e)},syncGlobal:function(e){return DataManager.__syncglobal(e)},__syncglobal:function(e){var t=e.getCanvas(),i=t.getChildShapes(!0);i.select(function(e){return!$(e.resourceId)}).each(function(e){if(USE_ARESS_WORKAROUNDS){var t=e.properties["raziel-type"],i='<div xmlns="http://www.w3.org/1999/xhtml"><span class="raziel-type">'+t+"</span></div>",o=ResourceManager.__createResource(i);e.resourceId=o.id()}else{var o=ResourceManager.__createResource();e.resourceId=o.id()}}),i.each(function(e){DataManager.__storeShape(e)})},serialize:function(e,t){if(e.nodeType==e.ELEMENT_NODE){var i=$A(e.childNodes),o=$A(e.attributes),n=new String(e.getAttribute("class")),r=n.split(" ").member("transient");if(r)return"";var a="<"+e.nodeName;return t||(a+=' xmlns="'+(e.namespaceURI?e.namespaceURI:XMLNS.XHTML)+'" xmlns:oryx="http://oryx-editor.org"'),o.each(function(e){a+=" "+e.nodeName+'="'+e.nodeValue+'"'}),0==i.length?a+="/>":(a+=">",i.each(function(e){a+=DataManager.serialize(e,!0)}),a+="</"+e.nodeName+">"),a}return e.nodeType==e.TEXT_NODE?e.nodeValue:void 0},addTriple:function(e){if(!e.subject.type==ERDF.LITERAL)throw"Cannot add the triple "+(""+e)+" because the subject is not a resource.";var t=ERDF.__stripHashes(e.subject.value),i=$(t);if(!i)throw"Cannot add the triple "+(""+e)+' because the subject "'+t+'" is not in the document.';return e.object.type==ERDF.LITERAL?DataManager.graft(XMLNS.XHTML,i,["span",{"class":e.predicate.prefix+"-"+e.predicate.name},e.object.value.escapeHTML()]):DataManager.graft(XMLNS.XHTML,i,["a",{rel:e.predicate.prefix+"-"+e.predicate.name,href:e.object.value}]),!0},removeTriples:function(e){var t=e.select(function(e){return DataManager.__removeTriple(e)});return t},removeTriple:function(e){var t=DataManager.__removeTriple(e);return t},__removeTriple:function(e){if(!e.subject.type==ERDF.LITERAL)throw"Cannot remove the triple "+(""+e)+" because the subject is not a resource.";var t=ERDF.__stripHashes(e.subject.value),i=$(t);if(!i)throw"Cannot remove the triple "+(""+e)+" because the subject is not in the document.";if(e.object.type==ERDF.LITERAL){var o=DataManager.__removeTripleRecursively(e,i);return o}},__removeTripleRecursively:function(e,t){if(t.nodeType!=t.ELEMENT_NODE)return!1;var i=new String(t.getAttribute("class")),o=$A(t.childNodes);if(i.include(e.predicate.prefix+"-"+e.predicate.name)){var n=t.textContent;return e.object.type==ERDF.LITERAL&&e.object.value==n&&t.parentNode.removeChild(t),!0}return o.each(function(t){DataManager.__removeTripleRecursively(e,t)}),!1},graft:function(e,t,i,o){o=o||t&&t.ownerDocument||document;var n;if(void 0===i)echo("Can't graft an undefined value");else if(i.constructor==String)n=o.createTextNode(i);else for(var r=0;i.length>r;r++){if(0===r&&i[r].constructor==String){var a=i[r].match(/^([a-z][a-z0-9]*)\.([^\s\.]+)$/i);if(a){n=o.createElementNS(e,a[1]),n.setAttributeNS(null,"class",a[2]);continue}if(a=i[r].match(/^([a-z][a-z0-9]*)$/i)){n=o.createElementNS(e,a[1]);continue}n=o.createElementNS(e,"span"),n.setAttribute(null,"class","namelessFromLOL")}if(void 0===i[r])echo("Can't graft an undefined value in a list!");else if(i[r].constructor==String||i[r].constructor==Array)this.graft(e,n,i[r],o);else if(i[r].constructor==Number)this.graft(e,n,""+i[r],o);else if(i[r].constructor==Object)for(var s in i[r])n.setAttributeNS(null,s,i[r][s]);else{if(i[r].constructor!=Boolean)throw"Object "+i[r]+" is inscrutable as an graft arglet.";this.graft(e,n,i[r]?"true":"false",o)}}return t&&t.appendChild(n),Element.extend(n)},setObject:function(e){var t=DataManager.query(e.subject,e.predicate,void 0);return DataManager.removeTriples(t),DataManager.addTriple(e),!0},query:function(e,t,i){return DataManager._triples.select(function(o){var n=e?o.subject.type==e.type&&o.subject.value==e.value:!0;return t&&(n=n&&(t.prefix?o.predicate.prefix==t.prefix:!0),n=n&&(t.name?o.predicate.name==t.name:!0)),n=n&&(i?o.object.type==i.type&&o.object.value==i.value:!0)})}};Kickstart.register(DataManager.init);var chain=new MetaTagHandler,command=new DMCommand(TRIPLE_ADD,new ERDF.Triple(new ERDF.Resource(""),"rdf:tool",new ERDF.Literal("")));ResourceManager={__corrupt:!1,__latelyCreatedResource:void 0,__listeners:$H(),__token:1,addListener:function(e,t){if(!(e instanceof Function))throw"Resource event listener is not a function!";if(!t)throw"Invalid mask for resource event listener registration.";var i={listener:e,mask:t},o=ResourceManager.__token++;return ResourceManager.__listeners[o]=i,o},removeListener:function(e){return ResourceManager.__listners.remove(e)},__Event:function(e,t){this.action=e,this.resourceId=t},__dispatchEvent:function(e){ResourceManager.__listeners.values().each(function(t){return e.action&t.mask?t.listener(e):void 0})},getResource:function(e){e=ERDF.__stripHashes(e);var t=DataManager.query(new ERDF.Resource("#"+e),{prefix:"raziel",name:"entry"},void 0);if(1==t.length&&t[0].object.isResource()){var i=t[0].object.value;return new ResourceManager.__Resource(e,i)}throw"Resource with id "+e+" not recognized as such. "+(t.length>1?" There is more than one raziel:entry URL.":" There is no raziel:entry URL.")},__createResource:function(e){var t=DataManager.query(new ERDF.Resource(""),{prefix:"raziel",name:"collection"},void 0);if(1==t.length&&t[0].object.isResource()){var i=t[0].object.value,o=void 0,n=e?e:'<div xmlns="http://www.w3.org/1999/xhtml"></div>';return ResourceManager.__request("POST",i,n,function(){var e=this.responseXML,t=e.childNodes[0],i=t.getAttribute("id");$$("."+PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{"class":PROCESSDATA_REF,style:"display:none;"}]),$$("."+PROCESSDATA_REF)[0].appendChild(t.cloneNode(!0)),DataManager.__synclocal(),o=new ResourceManager.getResource(i),ResourceManager.__resourceActionSucceeded(this,RESOURCE_CREATED,void 0)},function(){ResourceManager.__resourceActionFailed(this,RESOURCE_CREATED,void 0)},!1),o}throw"Could not create resource! raziel:collection URL is missing!"},__Resource:function(e,t){this.__id=e,this.__url=t,this.id=function(){return this.__id},this.url=function(){return this.__url},this.reload=function(){var e=this.__url,t=this.__id;ResourceManager.__request("GET",e,null,function(){ResourceManager.__resourceActionSucceeded(this,RESOURCE_RELOADED,t)},function(){ResourceManager.__resourceActionFailed(this,RESURCE_RELOADED,t)},USE_ASYNCHRONOUS_REQUESTS)},this.save=function(e){var t=this.__url,i=this.__id;data=DataManager.serialize($(i)),ResourceManager.__request("PUT",t,data,function(){ResourceManager.__resourceActionSucceeded(this,e?RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:RESOURCE_SAVED,i)},function(){ResourceManager.__resourceActionFailed(this,e?RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:RESOURCE.SAVED,i)},USE_ASYNCHRONOUS_REQUESTS)},this.remove=function(){var e=this.__url,t=this.__id;ResourceManager.__request("DELETE",e,null,function(){ResourceManager.__resourceActionSucceeded(this,RESOURCE_REMOVED,t)},function(){ResourceManager.__resourceActionFailed(this,RESOURCE_REMOVED,t)},USE_ASYNCHRONOUS_REQUESTS)}},request:function(e,t){var i={method:"get",asynchronous:!0,parameters:{}};Object.extend(i,t||{});var o=Hash.toQueryString(i.parameters);return o&&(e+=(e.include("?")?"&":"?")+o),ResourceManager.__request(i.method,e,i.data,i.onSuccess instanceof Function?function(){i.onSuccess(this)}:void 0,i.onFailure instanceof Function?function(){i.onFailure(this)}:void 0,i.asynchronous&&USE_ASYNCHRONOUS_REQUESTS,i.headers)},__request:function(e,t,i,o,n,r,a){var s=Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")});if(!s){if(!this.__corrupt)throw"This browser does not provide any AJAX functionality. You will not be able to use the software provided with the page you are viewing. Please consider installing appropriate extensions.";return this.__corrupt=!0,!1}o instanceof Function&&(s.onload=o),n instanceof Function&&(s.onerror=n);var l=$H(a);l.keys().each(function(e){s.setRequestHeader(e,l[e])});try{SHOW_DEBUG_ALERTS_WHEN_SAVING&&alert(e+" "+t+"\n"+SHOW_EXTENDED_DEBUG_INFORMATION?i:""),s.open(e,t,r?!0:!1),s.send(i)}catch(d){return!1}return!0},__resourceActionSucceeded:function(e,t,i){var o=e.status,n=e.responseText;if(SHOW_DEBUG_ALERTS_WHEN_SAVING&&alert(o+" "+url+"\n"+SHOW_EXTENDED_DEBUG_INFORMATION?data:""),o>=300)throw"The server responded with an error: "+o+"\n"+(SHOW_EXTENDED_DEBUG_INFORMATION?+data:"If you need additional information here, including the data sent by the server, consider setting SHOW_EXTENDED_DEBUG_INFORMATION to true.");switch(t){case RESOURCE_REMOVED:var n=e.responseXML,r=n.childNodes[0],i=r.getAttribute("id"),a=document.getElementById(i);a.parentNode.removeChild(a);break;case RESOURCE_CREATED:break;case RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:DataManager.__synclocal();case RESOURCE_SAVED:break;case RESOURCE_RELOADED:var n=e.responseXML,r=n.childNodes[0],i=r.getAttribute("id"),a=document.getElementById(i);a.parentNode.removeChild(a),$$(PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{"class":PROCESSDATA_REF,style:"display:none;"}]),$$(PROCESSDATA_REF)[0].appendChild(r.cloneNode(!0)),DataManager.__synclocal();break;default:DataManager.__synclocal()}ResourceManager.__dispatchEvent(new ResourceManager.__Event(t,i))},__resourceActionFailed:function(){throw"Fatal: Resource action failed. There is something horribly wrong with either the server, the transport protocol or your online status. Sure you're online?"}};var Clazz=function(){};if(Clazz.prototype.construct=function(){},Clazz.extend=function(e){var t=function(){arguments[0]!==Clazz&&this.construct.apply(this,arguments)},i=new this(Clazz),o=this.prototype;for(var n in e){var r=e[n];r instanceof Function&&(r.$=o),i[n]=r}return t.prototype=i,t.extend=this.extend,t},!ORYX)var ORYX={};if(ORYX.CONFIG||(ORYX.CONFIG={}),ORYX.CONFIG.ROOT_PATH="editor/",ORYX.CONFIG.EXPLORER_PATH="explorer",ORYX.CONFIG.LIBS_PATH="libs",ORYX.CONFIG.SERVER_HANDLER_ROOT="service",ORYX.CONFIG.SERVER_EDITOR_HANDLER=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor",ORYX.CONFIG.SERVER_MODEL_HANDLER=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/model",ORYX.CONFIG.STENCILSET_HANDLER=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor_stencilset?embedsvg=true&url=true&namespace=",ORYX.CONFIG.STENCIL_SETS_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor_stencilset",ORYX.CONFIG.PLUGINS_CONFIG="editor-app/plugins.xml",ORYX.CONFIG.SYNTAXCHECKER_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/syntaxchecker",ORYX.CONFIG.DEPLOY_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/model/deploy",ORYX.CONFIG.MODEL_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/models",ORYX.CONFIG.FORM_FLOW_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/formflows",ORYX.CONFIG.FORM_FLOW_IMAGE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/formflow",ORYX.CONFIG.FORM_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/forms",ORYX.CONFIG.FORM_IMAGE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/form",ORYX.CONFIG.SUB_PROCESS_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/subprocesses",ORYX.CONFIG.SUB_PROCESS_IMAGE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/subprocess",ORYX.CONFIG.TEST_SERVICE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/service/",ORYX.CONFIG.SERVICE_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/services",ORYX.CONFIG.CONDITION_ELEMENT_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/conditionelements",ORYX.CONFIG.VARIABLEDEF_ELEMENT_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/variabledefinitionelements",ORYX.CONFIG.VALIDATOR_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/validators",ORYX.CONFIG.SS_EXTENSIONS_FOLDER=ORYX.CONFIG.ROOT_PATH+"stencilsets/extensions/",ORYX.CONFIG.SS_EXTENSIONS_CONFIG=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor_ssextensions",ORYX.CONFIG.ORYX_NEW_URL="/new",ORYX.CONFIG.BPMN_LAYOUTER=ORYX.CONFIG.ROOT_PATH+"bpmnlayouter",ORYX.CONFIG.EXPRESSION_METADATA_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/expression-metadata",ORYX.CONFIG.DATASOURCE_METADATA_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/datasource-metadata",!ORYX)var ORYX={};ORYX.CONFIG||(ORYX.CONFIG={}),ORYX.CONFIG.BACKEND_SWITCH=!0,ORYX.CONFIG.PANEL_LEFT_WIDTH=250,ORYX.CONFIG.PANEL_RIGHT_COLLAPSED=!0,ORYX.CONFIG.PANEL_RIGHT_WIDTH=300,ORYX.CONFIG.APPNAME="KISBPM",ORYX.CONFIG.WEB_URL=".",ORYX.CONFIG.BLANK_IMAGE=ORYX.CONFIG.LIBS_PATH+"/ext-2.0.2/resources/images/default/s.gif",ORYX.CONFIG.OFFSET_HEADER=61,ORYX.CONFIG.SHOW_GRIDLINE=!0,ORYX.CONFIG.MODE_READONLY="readonly",ORYX.CONFIG.MODE_FULLSCREEN="fullscreen",ORYX.CONFIG.WINDOW_HEIGHT=800,ORYX.CONFIG.PREVENT_LOADINGMASK_AT_READY=!1,ORYX.CONFIG.PLUGINS_ENABLED=!0,ORYX.CONFIG.PLUGINS_FOLDER="Plugins/",ORYX.CONFIG.BPMN20_SCHEMA_VALIDATION_ON=!0,ORYX.CONFIG.NAMESPACE_ORYX="http://www.b3mn.org/oryx",ORYX.CONFIG.NAMESPACE_SVG="http://www.w3.org/2000/svg",ORYX.CONFIG.CANVAS_WIDTH=1200,ORYX.CONFIG.CANVAS_HEIGHT=1050,ORYX.CONFIG.CANVAS_RESIZE_INTERVAL=100,ORYX.CONFIG.CANVAS_MIN_WIDTH=800,ORYX.CONFIG.CANVAS_MIN_HEIGHT=300,ORYX.CONFIG.SELECTED_AREA_PADDING=4,ORYX.CONFIG.CANVAS_BACKGROUND_COLOR="none",ORYX.CONFIG.GRID_DISTANCE=30,ORYX.CONFIG.GRID_ENABLED=!0,ORYX.CONFIG.ZOOM_OFFSET=.1,ORYX.CONFIG.DEFAULT_SHAPE_MARGIN=60,ORYX.CONFIG.SCALERS_SIZE=7,ORYX.CONFIG.MINIMUM_SIZE=20,ORYX.CONFIG.MAXIMUM_SIZE=1e4,ORYX.CONFIG.OFFSET_MAGNET=15,ORYX.CONFIG.OFFSET_EDGE_LABEL_TOP=8,ORYX.CONFIG.OFFSET_EDGE_LABEL_BOTTOM=8,ORYX.CONFIG.OFFSET_EDGE_BOUNDS=5,ORYX.CONFIG.COPY_MOVE_OFFSET=30,ORYX.CONFIG.BORDER_OFFSET=14,ORYX.CONFIG.MAX_NUM_SHAPES_NO_GROUP=20,ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER=30,ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET=45,ORYX.CONFIG.SHAPEMENU_RIGHT="Oryx_Right",ORYX.CONFIG.SHAPEMENU_BOTTOM="Oryx_Bottom",ORYX.CONFIG.SHAPEMENU_LEFT="Oryx_Left",ORYX.CONFIG.SHAPEMENU_TOP="Oryx_Top",ORYX.CONFIG.MORPHITEM_DISABLED="Oryx_MorphItem_disabled",ORYX.CONFIG.TYPE_STRING="string",ORYX.CONFIG.TYPE_BOOLEAN="boolean",ORYX.CONFIG.TYPE_INTEGER="integer",ORYX.CONFIG.TYPE_FLOAT="float",ORYX.CONFIG.TYPE_COLOR="color",ORYX.CONFIG.TYPE_DATE="date",ORYX.CONFIG.TYPE_CHOICE="choice",ORYX.CONFIG.TYPE_URL="url",ORYX.CONFIG.TYPE_DIAGRAM_LINK="diagramlink",ORYX.CONFIG.TYPE_COMPLEX="complex",ORYX.CONFIG.TYPE_MULTIPLECOMPLEX="multiplecomplex",ORYX.CONFIG.TYPE_TEXT="text",ORYX.CONFIG.TYPE_KISBPM_MULTIINSTANCE="kisbpm-multiinstance",ORYX.CONFIG.TYPE_MODEL_LINK="modellink",ORYX.CONFIG.TYPE_FORM_FLOW_LINK="formflowlink",ORYX.CONFIG.TYPE_FORM_LINK="formlink",ORYX.CONFIG.TYPE_SUB_PROCESS_LINK="subprocess-link",ORYX.CONFIG.TYPE_SERVICE_LINK="servicelink",ORYX.CONFIG.TYPE_CONDITIONS="conditions",ORYX.CONFIG.TYPE_VARIABLES="variables",ORYX.CONFIG.TYPE_LISTENER="listener",ORYX.CONFIG.TYPE_EPC_FREQ="epcfrequency",ORYX.CONFIG.TYPE_GLOSSARY_LINK="glossarylink",ORYX.CONFIG.TYPE_EXPRESSION="expression",ORYX.CONFIG.TYPE_DATASOURCE="datasource",ORYX.CONFIG.TYPE_DATASOURCE_MINIMAL="datasource-minimal",ORYX.CONFIG.TYPE_VALIDATORS="validators",ORYX.CONFIG.LABEL_LINE_DISTANCE=2,ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT=12,ORYX.CONFIG.ENABLE_MORPHMENU_BY_HOVER=!1,ORYX.CONFIG.EDITOR_ALIGN_BOTTOM=1,ORYX.CONFIG.EDITOR_ALIGN_MIDDLE=2,ORYX.CONFIG.EDITOR_ALIGN_TOP=4,ORYX.CONFIG.EDITOR_ALIGN_LEFT=8,ORYX.CONFIG.EDITOR_ALIGN_CENTER=16,ORYX.CONFIG.EDITOR_ALIGN_RIGHT=32,ORYX.CONFIG.EDITOR_ALIGN_SIZE=48,ORYX.CONFIG.EVENT_MOUSEDOWN="mousedown",ORYX.CONFIG.EVENT_MOUSEUP="mouseup",ORYX.CONFIG.EVENT_MOUSEOVER="mouseover",ORYX.CONFIG.EVENT_MOUSEOUT="mouseout",ORYX.CONFIG.EVENT_MOUSEMOVE="mousemove",ORYX.CONFIG.EVENT_DBLCLICK="dblclick",ORYX.CONFIG.EVENT_KEYDOWN="keydown",ORYX.CONFIG.EVENT_KEYUP="keyup",ORYX.CONFIG.EVENT_LOADED="editorloaded",ORYX.CONFIG.EVENT_SAVED="editorSaved",ORYX.CONFIG.EVENT_EXECUTE_COMMANDS="executeCommands",ORYX.CONFIG.EVENT_STENCIL_SET_LOADED="stencilSetLoaded",ORYX.CONFIG.EVENT_SELECTION_CHANGED="selectionchanged",ORYX.CONFIG.EVENT_SHAPEADDED="shapeadded",ORYX.CONFIG.EVENT_SHAPEREMOVED="shaperemoved",ORYX.CONFIG.EVENT_PROPERTY_CHANGED="propertyChanged",ORYX.CONFIG.EVENT_DRAGDROP_START="dragdrop.start",ORYX.CONFIG.EVENT_SHAPE_MENU_CLOSE="shape.menu.close",ORYX.CONFIG.EVENT_DRAGDROP_END="dragdrop.end",ORYX.CONFIG.EVENT_RESIZE_START="resize.start",ORYX.CONFIG.EVENT_RESIZE_END="resize.end",ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED="dragDocker.docked",ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW="highlight.showHighlight",ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE="highlight.hideHighlight",ORYX.CONFIG.EVENT_LOADING_ENABLE="loading.enable",ORYX.CONFIG.EVENT_LOADING_DISABLE="loading.disable",ORYX.CONFIG.EVENT_LOADING_STATUS="loading.status",ORYX.CONFIG.EVENT_OVERLAY_SHOW="overlay.show",ORYX.CONFIG.EVENT_OVERLAY_HIDE="overlay.hide",ORYX.CONFIG.EVENT_ARRANGEMENT_TOP="arrangement.setToTop",ORYX.CONFIG.EVENT_ARRANGEMENT_BACK="arrangement.setToBack",ORYX.CONFIG.EVENT_ARRANGEMENT_FORWARD="arrangement.setForward",ORYX.CONFIG.EVENT_ARRANGEMENT_BACKWARD="arrangement.setBackward",ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED="propertyWindow.propertyChanged",ORYX.CONFIG.EVENT_LAYOUT_ROWS="layout.rows",ORYX.CONFIG.EVENT_LAYOUT_BPEL="layout.BPEL",ORYX.CONFIG.EVENT_LAYOUT_BPEL_VERTICAL="layout.BPEL.vertical",ORYX.CONFIG.EVENT_LAYOUT_BPEL_HORIZONTAL="layout.BPEL.horizontal",ORYX.CONFIG.EVENT_LAYOUT_BPEL_SINGLECHILD="layout.BPEL.singlechild",ORYX.CONFIG.EVENT_LAYOUT_BPEL_AUTORESIZE="layout.BPEL.autoresize",ORYX.CONFIG.EVENT_AUTOLAYOUT_LAYOUT="autolayout.layout",ORYX.CONFIG.EVENT_UNDO_EXECUTE="undo.execute",ORYX.CONFIG.EVENT_UNDO_ROLLBACK="undo.rollback",ORYX.CONFIG.EVENT_BUTTON_UPDATE="toolbar.button.update",ORYX.CONFIG.EVENT_LAYOUT="layout.dolayout",ORYX.CONFIG.EVENT_GLOSSARY_LINK_EDIT="glossary.link.edit",ORYX.CONFIG.EVENT_GLOSSARY_SHOW="glossary.show.info",ORYX.CONFIG.EVENT_GLOSSARY_NEW="glossary.show.new",ORYX.CONFIG.EVENT_DOCKERDRAG="dragTheDocker",ORYX.CONFIG.EVENT_CANVAS_SCROLL="canvas.scroll",ORYX.CONFIG.EVENT_SHOW_PROPERTYWINDOW="propertywindow.show",ORYX.CONFIG.EVENT_ABOUT_TO_SAVE="file.aboutToSave",ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE=5,ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR="#4444FF",ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR2="#9999FF",ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_CORNER="corner",ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE="rectangle",ORYX.CONFIG.SELECTION_VALID_COLOR="#00FF00",ORYX.CONFIG.SELECTION_INVALID_COLOR="#FF0000",ORYX.CONFIG.DOCKER_DOCKED_COLOR="#00FF00",ORYX.CONFIG.DOCKER_UNDOCKED_COLOR="#FF0000",ORYX.CONFIG.DOCKER_SNAP_OFFSET=10,ORYX.CONFIG.EDIT_OFFSET_PASTE=10,ORYX.CONFIG.KEY_CODE_X=88,ORYX.CONFIG.KEY_CODE_C=67,ORYX.CONFIG.KEY_CODE_V=86,ORYX.CONFIG.KEY_CODE_DELETE=46,ORYX.CONFIG.KEY_CODE_META=224,ORYX.CONFIG.KEY_CODE_BACKSPACE=8,ORYX.CONFIG.KEY_CODE_LEFT=37,ORYX.CONFIG.KEY_CODE_RIGHT=39,ORYX.CONFIG.KEY_CODE_UP=38,ORYX.CONFIG.KEY_CODE_DOWN=40,ORYX.CONFIG.KEY_Code_enter=12,ORYX.CONFIG.KEY_Code_left=37,ORYX.CONFIG.KEY_Code_right=39,ORYX.CONFIG.KEY_Code_top=38,ORYX.CONFIG.KEY_Code_bottom=40,ORYX.CONFIG.META_KEY_META_CTRL="metactrl",ORYX.CONFIG.META_KEY_ALT="alt",ORYX.CONFIG.META_KEY_SHIFT="shift",ORYX.CONFIG.KEY_ACTION_DOWN="down",ORYX.CONFIG.KEY_ACTION_UP="up",ORYX.CONFIG.FORM_ROW_WIDTH=350,ORYX.CONFIG.FORM_GROUP_MARGIN=5,ORYX.CONFIG.FORM_GROUP_EMPTY_HEIGHT=100,ORYX.CONFIG.FORM_ELEMENT_ID_PREFIX="http://b3mn.org/stencilset/xforms",ORYX.CONFIG.FORM_ELEMENT_TYPE_ROOT="http://b3mn.org/stencilset/xforms#XForm",ORYX.CONFIG.FORM_ELEMENT_TYPE_GROUP="http://b3mn.org/stencilset/xforms#Group",ORYX.CONFIG.FORM_ELEMENT_TYPE_REPEATING_GROUP="http://b3mn.org/stencilset/xforms#RepeatingGroup",ORYX.CONFIG.FORM_ELEMENT_TYPE_LABEL_FIELD="http://b3mn.org/stencilset/xforms#LabelField";var ORYX_LOGLEVEL_TRACE=5,ORYX_LOGLEVEL_DEBUG=4,ORYX_LOGLEVEL_INFO=3,ORYX_LOGLEVEL_WARN=2,ORYX_LOGLEVEL_ERROR=1,ORYX_LOGLEVEL_FATAL=0,ORYX_LOGLEVEL=3,ORYX_CONFIGURATION_DELAY=100,ORYX_CONFIGURATION_WAIT_ATTEMPTS=10;if(!ORYX)var ORYX={};if(ORYX=Object.extend(ORYX,{PATH:ORYX.CONFIG.ROOT_PATH,URLS:[],alreadyLoaded:[],configrationRetries:0,Version:"0.1.1",availablePlugins:[],Log:{__appenders:[{append:function(e){"undefined"!=typeof console&&void 0!==console.log&&console.log(e)}}],trace:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_TRACE&&ORYX.Log.__log("TRACE",arguments)},debug:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_DEBUG&&ORYX.Log.__log("DEBUG",arguments)},info:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_INFO&&ORYX.Log.__log("INFO",arguments)},warn:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_WARN&&ORYX.Log.__log("WARN",arguments)},error:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_ERROR&&ORYX.Log.__log("ERROR",arguments)},fatal:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_FATAL&&ORYX.Log.__log("FATAL",arguments)},__log:function(e,t){t[0]=(new Date).getTime()+" "+e+" "+t[0];var i=printf.apply(null,t);ORYX.Log.__appenders.each(function(e){e.append(i)})},addAppender:function(e){ORYX.Log.__appenders.push(e)}},load:function(){if(ORYX.Log.debug("Oryx begins loading procedure."),"undefined"==typeof Prototype||"undefined"==typeof Element||Element.Methods===void 0||1.5>parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1]))throw"Application requires the Prototype JavaScript framework >= 1.5.3";ORYX.Log.debug("Prototype > 1.5 found."),ORYX._load()},_load:function(){ORYX.loadPlugins()},loadPlugins:function(){ORYX.CONFIG.PLUGINS_ENABLED?ORYX._loadPlugins():ORYX.Log.warn("Ignoring plugins, loading Core only."),init()},_loadPlugins:function(){var e=ORYX.CONFIG.PLUGINS_CONFIG;ORYX.Log.debug("Loading plugin configuration from '%0'.",e),new Ajax.Request(e,{asynchronous:!1,method:"get",onSuccess:function(e){ORYX.Log.info("Plugin configuration file loaded.");var t=e.responseXML,i=[],o=$A(t.getElementsByTagName("properties"));o.each(function(e){var t=$A(e.childNodes);t.each(function(e){var t=new Hash,o=$A(e.attributes);o.each(function(e){t[e.nodeName]=e.nodeValue}),o.length>0&&i.push(t)})});var n=t.getElementsByTagName("plugin");$A(n).each(function(e){var t=new Hash;if($A(e.attributes).each(function(e){t[e.nodeName]=e.nodeValue}),!t.name)return ORYX.Log.error("A plugin is not providing a name. Ingnoring this plugin."),void 0;if(!t.source)return ORYX.Log.error("Plugin with name '%0' doesn't provide a source attribute.",t.name),void 0;var o=e.getElementsByTagName("property"),n=[];$A(o).each(function(e){var t=new Hash,i=$A(e.attributes);i.each(function(e){t[e.nodeName]=e.nodeValue}),i.length>0&&n.push(t)}),n=n.concat(i),t.properties=n;var r,a=e.getElementsByTagName("requires");$A(a).each(function(e){var t=$A(e.attributes).find(function(e){return"namespace"==e.name});t&&t.nodeValue&&(r||(r={namespaces:[]}),r.namespaces.push(t.nodeValue))}),r&&(t.requires=r);var s,l=e.getElementsByTagName("notUsesIn");$A(l).each(function(e){var t=$A(e.attributes).find(function(e){return"namespace"==e.name});t&&t.nodeValue&&(s||(s={namespaces:[]}),s.namespaces.push(t.nodeValue))}),s&&(t.notUsesIn=s);var d=ORYX.PATH+ORYX.CONFIG.PLUGINS_FOLDER+t.source;ORYX.Log.debug("Requireing '%0'",d),ORYX.Log.info("Plugin '%0' successfully loaded.",t.name),ORYX.availablePlugins.push(t)})},onFailure:this._loadPluginsOnFails})},_loadPluginsOnFails:function(){ORYX.Log.error("Plugin configuration file not available.")}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.EditPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.x=0,this.y=0,this.oldX=0,this.oldY=0,this.deltaWidth=1,this.deltaHeight=1,this.d=""},init:function(e,t,i,o,n,r){this.x=e,this.y=t,this.oldX=i,this.oldY=o,this.deltaWidth=n,this.deltaHeight=r,this.d=""},editPointsAbs:function(e){if(e instanceof Array){for(var t,i,o=[],n=0;e.length>n;n++)t=(parseFloat(e[n])-this.oldX)*this.deltaWidth+this.x,n++,i=(parseFloat(e[n])-this.oldY)*this.deltaHeight+this.y,o.push(t),o.push(i);return o}},editPointsRel:function(e){if(e instanceof Array){for(var t,i,o=[],n=0;e.length>n;n++)t=parseFloat(e[n])*this.deltaWidth,n++,i=parseFloat(e[n])*this.deltaHeight,o.push(t),o.push(i);return o}},arcAbs:function(e,t,i,o,n,r,a){var s=this.editPointsAbs([r,a]),l=this.editPointsRel([e,t]);this.d=this.d.concat(" A"+l[0]+" "+l[1]+" "+i+" "+o+" "+n+" "+s[0]+" "+s[1]+" ")},arcRel:function(e,t,i,o,n,r,a){var s=this.editPointsRel([e,t,r,a]);this.d=this.d.concat(" a"+s[0]+" "+s[1]+" "+i+" "+o+" "+n+" "+s[2]+" "+s[3]+" ")},curvetoCubicAbs:function(e,t,i,o,n,r){var a=this.editPointsAbs([e,t,i,o,n,r]);this.d=this.d.concat(" C"+a[0]+" "+a[1]+" "+a[2]+" "+a[3]+" "+a[4]+" "+a[5]+" ")},curvetoCubicRel:function(e,t,i,o,n,r){var a=this.editPointsRel([e,t,i,o,n,r]);this.d=this.d.concat(" c"+a[0]+" "+a[1]+" "+a[2]+" "+a[3]+" "+a[4]+" "+a[5]+" ")},linetoHorizontalAbs:function(e){var t=this.editPointsAbs([e,0]);
this.d=this.d.concat(" H"+t[0]+" ")},linetoHorizontalRel:function(e){var t=this.editPointsRel([e,0]);this.d=this.d.concat(" h"+t[0]+" ")},linetoAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" L"+i[0]+" "+i[1]+" ")},linetoRel:function(e,t){var i=this.editPointsRel([e,t]);this.d=this.d.concat(" l"+i[0]+" "+i[1]+" ")},movetoAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" M"+i[0]+" "+i[1]+" ")},movetoRel:function(e,t){var i;i=""===this.d?this.editPointsAbs([e,t]):this.editPointsRel([e,t]),this.d=this.d.concat(" m"+i[0]+" "+i[1]+" ")},curvetoQuadraticAbs:function(e,t,i,o){var n=this.editPointsAbs([e,t,i,o]);this.d=this.d.concat(" Q"+n[0]+" "+n[1]+" "+n[2]+" "+n[3]+" ")},curvetoQuadraticRel:function(e,t,i,o){var n=this.editPointsRel([e,t,i,o]);this.d=this.d.concat(" q"+n[0]+" "+n[1]+" "+n[2]+" "+n[3]+" ")},curvetoCubicSmoothAbs:function(e,t,i,o){var n=this.editPointsAbs([e,t,i,o]);this.d=this.d.concat(" S"+n[0]+" "+n[1]+" "+n[2]+" "+n[3]+" ")},curvetoCubicSmoothRel:function(e,t,i,o){var n=this.editPointsRel([e,t,i,o]);this.d=this.d.concat(" s"+n[0]+" "+n[1]+" "+n[2]+" "+n[3]+" ")},curvetoQuadraticSmoothAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" T"+i[0]+" "+i[1]+" ")},curvetoQuadraticSmoothRel:function(e,t){var i=this.editPointsRel([e,t]);this.d=this.d.concat(" t"+i[0]+" "+i[1]+" ")},linetoVerticalAbs:function(e){var t=this.editPointsAbs([0,e]);this.d=this.d.concat(" V"+t[1]+" ")},linetoVerticalRel:function(e){var t=this.editPointsRel([0,e]);this.d=this.d.concat(" v"+t[1]+" ")},closePath:function(){this.d=this.d.concat(" z")}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.MinMaxPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.minX=void 0,this.minY=void 0,this.maxX=void 0,this.maxY=void 0,this._lastAbsX=void 0,this._lastAbsY=void 0},calculateMinMax:function(e){if(e instanceof Array)for(var t,i,o=0;e.length>o;o++)t=parseFloat(e[o]),o++,i=parseFloat(e[o]),this.minX=void 0!==this.minX?Math.min(this.minX,t):t,this.maxX=void 0!==this.maxX?Math.max(this.maxX,t):t,this.minY=void 0!==this.minY?Math.min(this.minY,i):i,this.maxY=void 0!==this.maxY?Math.max(this.maxY,i):i,this._lastAbsX=t,this._lastAbsY=i},arcAbs:function(e,t,i,o,n,r,a){this.calculateMinMax([r,a])},arcRel:function(e,t,i,o,n,r,a){this.calculateMinMax([this._lastAbsX+r,this._lastAbsY+a])},curvetoCubicAbs:function(e,t,i,o,n,r){this.calculateMinMax([e,t,i,o,n,r])},curvetoCubicRel:function(e,t,i,o,n,r){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+o,this._lastAbsX+n,this._lastAbsY+r])},linetoHorizontalAbs:function(e){this.calculateMinMax([e,this._lastAbsY])},linetoHorizontalRel:function(e){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY])},linetoAbs:function(e,t){this.calculateMinMax([e,t])},linetoRel:function(e,t){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t])},movetoAbs:function(e,t){this.calculateMinMax([e,t])},movetoRel:function(e,t){this._lastAbsX&&this._lastAbsY?this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t]):this.calculateMinMax([e,t])},curvetoQuadraticAbs:function(e,t,i,o){this.calculateMinMax([e,t,i,o])},curvetoQuadraticRel:function(e,t,i,o){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+o])},curvetoCubicSmoothAbs:function(e,t,i,o){this.calculateMinMax([e,t,i,o])},curvetoCubicSmoothRel:function(e,t,i,o){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+o])},curvetoQuadraticSmoothAbs:function(e,t){this.calculateMinMax([e,t])},curvetoQuadraticSmoothRel:function(e,t){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t])},linetoVerticalAbs:function(e){this.calculateMinMax([this._lastAbsX,e])},linetoVerticalRel:function(e){this.calculateMinMax([this._lastAbsX,this._lastAbsY+e])},closePath:function(){}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.PointsPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.points=[],this._lastAbsX=void 0,this._lastAbsY=void 0},addPoints:function(e){if(e instanceof Array)for(var t,i,o=0;e.length>o;o++)t=parseFloat(e[o]),o++,i=parseFloat(e[o]),this.points.push(t),this.points.push(i),this._lastAbsX=t,this._lastAbsY=i},arcAbs:function(e,t,i,o,n,r,a){this.addPoints([r,a])},arcRel:function(e,t,i,o,n,r,a){this.addPoints([this._lastAbsX+r,this._lastAbsY+a])},curvetoCubicAbs:function(e,t,i,o,n,r){this.addPoints([n,r])},curvetoCubicRel:function(e,t,i,o,n,r){this.addPoints([this._lastAbsX+n,this._lastAbsY+r])},linetoHorizontalAbs:function(e){this.addPoints([e,this._lastAbsY])},linetoHorizontalRel:function(e){this.addPoints([this._lastAbsX+e,this._lastAbsY])},linetoAbs:function(e,t){this.addPoints([e,t])},linetoRel:function(e,t){this.addPoints([this._lastAbsX+e,this._lastAbsY+t])},movetoAbs:function(e,t){this.addPoints([e,t])},movetoRel:function(e,t){this._lastAbsX&&this._lastAbsY?this.addPoints([this._lastAbsX+e,this._lastAbsY+t]):this.addPoints([e,t])},curvetoQuadraticAbs:function(e,t,i,o){this.addPoints([i,o])},curvetoQuadraticRel:function(e,t,i,o){this.addPoints([this._lastAbsX+i,this._lastAbsY+o])},curvetoCubicSmoothAbs:function(e,t,i,o){this.addPoints([i,o])},curvetoCubicSmoothRel:function(e,t,i,o){this.addPoints([this._lastAbsX+i,this._lastAbsY+o])},curvetoQuadraticSmoothAbs:function(e,t){this.addPoints([e,t])},curvetoQuadraticSmoothRel:function(e,t){this.addPoints([this._lastAbsX+e,this._lastAbsY+t])},linetoVerticalAbs:function(e){this.addPoints([this._lastAbsX,e])},linetoVerticalRel:function(e){this.addPoints([this._lastAbsX,this._lastAbsY+e])},closePath:function(){}}),NAMESPACE_ORYX="http://www.b3mn.org/oryx",NAMESPACE_SVG="http://www.w3.org/2000/svg/",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.SVGMarker=Clazz.extend({construct:function(e){arguments.callee.$.construct.apply(this,arguments),this.id=void 0,this.element=e,this.refX=void 0,this.refY=void 0,this.markerWidth=void 0,this.markerHeight=void 0,this.oldRefX=void 0,this.oldRefY=void 0,this.oldMarkerWidth=void 0,this.oldMarkerHeight=void 0,this.optional=!1,this.enabled=!0,this.minimumLength=void 0,this.resize=!1,this.svgShapes=[],this._init()},_init:function(){if("[object SVGMarkerElement]"!=this.element)throw"SVGMarker: Argument is not an instance of SVGMarkerElement.";this.id=this.element.getAttributeNS(null,"id");var e=this.element.getAttributeNS(null,"refX");this.refX=e?parseFloat(e):0;var t=this.element.getAttributeNS(null,"refY");this.refY=t?parseFloat(t):0;var i=this.element.getAttributeNS(null,"markerWidth");this.markerWidth=i?parseFloat(i):3;var o=this.element.getAttributeNS(null,"markerHeight");this.markerHeight=o?parseFloat(o):3,this.oldRefX=this.refX,this.oldRefY=this.refY,this.oldMarkerWidth=this.markerWidth,this.oldMarkerHeight=this.markerHeight;var n=this.element.getAttributeNS(NAMESPACE_ORYX,"optional");n?(n=n.strip(),this.optional="yes"===n.toLowerCase()):this.optional=!1;var r=this.element.getAttributeNS(NAMESPACE_ORYX,"enabled");r?(r=r.strip(),this.enabled=!("no"===r.toLowerCase())):this.enabled=!0;var a=this.element.getAttributeNS(NAMESPACE_ORYX,"minimumLength");a&&(this.minimumLength=parseFloat(a));var s=this.element.getAttributeNS(NAMESPACE_ORYX,"resize");s?(s=s.strip(),this.resize="yes"===s.toLowerCase()):this.resize=!1},_getSVGShapes:function(e){if(e.hasChildNodes){var t=[],i=this;return $A(e.childNodes).each(function(e){try{var o=new ORYX.Core.SVG.SVGShape(e);t.push(o)}catch(n){t=t.concat(i._getSVGShapes(e))}}),t}},update:function(){this.oldRefX=this.refX,this.oldRefY=this.refY,this.oldMarkerWidth=this.markerWidth,this.oldMarkerHeight=this.markerHeight},toString:function(){return this.element?"SVGMarker "+this.element.id:"SVGMarker "+this.element}}),NAMESPACE_ORYX="http://www.b3mn.org/oryx",NAMESPACE_SVG="http://www.w3.org/2000/svg/",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.SVGShape=Clazz.extend({construct:function(e){arguments.callee.$.construct.apply(this,arguments),this.type,this.element=e,this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.oldX=void 0,this.oldY=void 0,this.oldWidth=void 0,this.oldHeight=void 0,this.radiusX=void 0,this.radiusY=void 0,this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1,this.anchorLeft=!1,this.anchorRight=!1,this.anchorTop=!1,this.anchorBottom=!1,this.allowDockers=!0,this.resizeMarkerMid=!1,this.editPathParser,this.editPathHandler,this.init()},init:function(){if(ORYX.Editor.checkClassType(this.element,SVGRectElement)||ORYX.Editor.checkClassType(this.element,SVGImageElement)){this.type="Rect";var e=this.element.getAttributeNS(null,"x");if(!e)throw"Missing attribute in element "+this.element;this.oldX=parseFloat(e);var t=this.element.getAttributeNS(null,"y");if(!t)throw"Missing attribute in element "+this.element;this.oldY=parseFloat(t);var i=this.element.getAttributeNS(null,"width");if(!i)throw"Missing attribute in element "+this.element;this.oldWidth=parseFloat(i);var o=this.element.getAttributeNS(null,"height");if(!o)throw"Missing attribute in element "+this.element;this.oldHeight=parseFloat(o)}else if(ORYX.Editor.checkClassType(this.element,SVGCircleElement)){this.type="Circle";var n=void 0,r=void 0,a=this.element.getAttributeNS(null,"cx");if(!a)throw"Missing attribute in element "+this.element;n=parseFloat(a);var s=this.element.getAttributeNS(null,"cy");if(!s)throw"Missing attribute in element "+this.element;r=parseFloat(s);var l=this.element.getAttributeNS(null,"r");if(!l)throw"Missing attribute in element "+this.element;this.radiusX=parseFloat(l),this.oldX=n-this.radiusX,this.oldY=r-this.radiusX,this.oldWidth=2*this.radiusX,this.oldHeight=2*this.radiusX}else if(ORYX.Editor.checkClassType(this.element,SVGEllipseElement)){this.type="Ellipse";var n=void 0,r=void 0,a=this.element.getAttributeNS(null,"cx");if(!a)throw"Missing attribute in element "+this.element;n=parseFloat(a);var s=this.element.getAttributeNS(null,"cy");if(!s)throw"Missing attribute in element "+this.element;r=parseFloat(s);var d=this.element.getAttributeNS(null,"rx");if(!d)throw"Missing attribute in element "+this.element;this.radiusX=parseFloat(d);var c=this.element.getAttributeNS(null,"ry");if(!c)throw"Missing attribute in element "+this.element;this.radiusY=parseFloat(c),this.oldX=n-this.radiusX,this.oldY=r-this.radiusY,this.oldWidth=2*this.radiusX,this.oldHeight=2*this.radiusY}else if(ORYX.Editor.checkClassType(this.element,SVGLineElement)){this.type="Line";var p=void 0,u=void 0,m=void 0,h=void 0,f=this.element.getAttributeNS(null,"x1");if(!f)throw"Missing attribute in element "+this.element;p=parseFloat(f);var g=this.element.getAttributeNS(null,"y1");if(!g)throw"Missing attribute in element "+this.element;u=parseFloat(g);var v=this.element.getAttributeNS(null,"x2");if(!v)throw"Missing attribute in element "+this.element;m=parseFloat(v);var S=this.element.getAttributeNS(null,"y2");if(!S)throw"Missing attribute in element "+this.element;h=parseFloat(S),this.oldX=Math.min(p,m),this.oldY=Math.min(u,h),this.oldWidth=Math.abs(p-m),this.oldHeight=Math.abs(u-h)}else if(ORYX.Editor.checkClassType(this.element,SVGPolylineElement)||ORYX.Editor.checkClassType(this.element,SVGPolygonElement)){this.type="Polyline";var I=[];if(this.element.points&&this.element.points.numberOfItems)for(var O=0,b=this.element.points.numberOfItems;b>O;O++)I.push(this.element.points.getItem(O).x),I.push(this.element.points.getItem(O).y);else{var E=this.element.getAttributeNS(null,"points");if(!E)throw"Missing attribute in element "+this.element;E=E.replace(/,/g," "),I=E.split(" "),I=I.without("")}if(!(I&&I.length&&I.length>1))throw"Missing attribute in element "+this.element;for(var y=parseFloat(I[0]),R=parseFloat(I[1]),T=parseFloat(I[0]),C=parseFloat(I[1]),O=0;I.length>O;O++)y=Math.min(y,parseFloat(I[O])),T=Math.max(T,parseFloat(I[O])),O++,R=Math.min(R,parseFloat(I[O])),C=Math.max(C,parseFloat(I[O]));this.oldX=y,this.oldY=R,this.oldWidth=T-y,this.oldHeight=C-R}else{if(!ORYX.Editor.checkClassType(this.element,SVGPathElement))throw"Element is not a shape.";this.type="Path",this.editPathParser=new PathParser,this.editPathHandler=new ORYX.Core.SVG.EditPathHandler,this.editPathParser.setHandler(this.editPathHandler);var A=new PathParser,N=new ORYX.Core.SVG.MinMaxPathHandler;A.setHandler(N),A.parsePath(this.element),this.oldX=N.minX,this.oldY=N.minY,this.oldWidth=N.maxX-N.minX,this.oldHeight=N.maxY-N.minY,delete A,delete N}var F=this.element.getAttributeNS(NAMESPACE_ORYX,"resize");F?(F=F.toLowerCase(),this.isHorizontallyResizable=F.match(/horizontal/)?!0:!1,this.isVerticallyResizable=F.match(/vertical/)?!0:!1):(this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1);var M=this.element.getAttributeNS(NAMESPACE_ORYX,"anchors");if(M){M=M.replace("/,/g"," ");for(var D=M.split(" ").without(""),O=0;D.length>O;O++)switch(D[O].toLowerCase()){case"left":this.anchorLeft=!0;break;case"right":this.anchorRight=!0;break;case"top":this.anchorTop=!0;break;case"bottom":this.anchorBottom=!0}}if(ORYX.Editor.checkClassType(this.element,SVGPathElement)){var P=this.element.getAttributeNS(NAMESPACE_ORYX,"allowDockers");P&&(this.allowDockers="no"===P.toLowerCase()?!1:!0);var w=this.element.getAttributeNS(NAMESPACE_ORYX,"resizeMarker-mid");w&&(this.resizeMarkerMid="yes"===w.toLowerCase()?!0:!1)}this.x=this.oldX,this.y=this.oldY,this.width=this.oldWidth,this.height=this.oldHeight},update:function(){if(this.x!==this.oldX||this.y!==this.oldY||this.width!==this.oldWidth||this.height!==this.oldHeight){switch(this.type){case"Rect":this.x!==this.oldX&&this.element.setAttributeNS(null,"x",this.x),this.y!==this.oldY&&this.element.setAttributeNS(null,"y",this.y),this.width!==this.oldWidth&&this.element.setAttributeNS(null,"width",this.width),this.height!==this.oldHeight&&this.element.setAttributeNS(null,"height",this.height);break;case"Circle":this.radiusX=(this.width<this.height?this.width:this.height)/2,this.element.setAttributeNS(null,"cx",this.x+this.width/2),this.element.setAttributeNS(null,"cy",this.y+this.height/2),this.element.setAttributeNS(null,"r",this.radiusX);break;case"Ellipse":this.radiusX=this.width/2,this.radiusY=this.height/2,this.element.setAttributeNS(null,"cx",this.x+this.radiusX),this.element.setAttributeNS(null,"cy",this.y+this.radiusY),this.element.setAttributeNS(null,"rx",this.radiusX),this.element.setAttributeNS(null,"ry",this.radiusY);break;case"Line":this.x!==this.oldX&&this.element.setAttributeNS(null,"x1",this.x),this.y!==this.oldY&&this.element.setAttributeNS(null,"y1",this.y),(this.x!==this.oldX||this.width!==this.oldWidth)&&this.element.setAttributeNS(null,"x2",this.x+this.width),(this.y!==this.oldY||this.height!==this.oldHeight)&&this.element.setAttributeNS(null,"y2",this.y+this.height);break;case"Polyline":var e=this.element.getAttributeNS(null,"points");if(e&&(e=e.replace(/,/g," ").split(" ").without(""),e&&e.length&&e.length>1)){for(var t=0===this.oldWidth?0:this.width/this.oldWidth,i=0===this.oldHeight?0:this.height/this.oldHeight,o="",n=0;e.length>n;n++){var r=(parseFloat(e[n])-this.oldX)*t+this.x;n++;var a=(parseFloat(e[n])-this.oldY)*i+this.y;o+=r+" "+a+" "}this.element.setAttributeNS(null,"points",o)}break;case"Path":var t=0===this.oldWidth?0:this.width/this.oldWidth,i=0===this.oldHeight?0:this.height/this.oldHeight;this.editPathHandler.init(this.x,this.y,this.oldX,this.oldY,t,i),this.editPathParser.parsePath(this.element),this.element.setAttributeNS(null,"d",this.editPathHandler.d)}this.oldX=this.x,this.oldY=this.y,this.oldWidth=this.width,this.oldHeight=this.height}delete this.visible,delete this.handler},isPointIncluded:function(e,t){if(!e||!t||!this.isVisible())return!1;switch(this.type){case"Rect":return e>=this.x&&this.x+this.width>=e&&t>=this.y&&this.y+this.height>=t;case"Circle":return ORYX.Core.Math.isPointInEllipse(e,t,this.x+this.width/2,this.y+this.height/2,this.radiusX,this.radiusX);case"Ellipse":return ORYX.Core.Math.isPointInEllipse(e,t,this.x+this.radiusX,this.y+this.radiusY,this.radiusX,this.radiusY);case"Line":return ORYX.Core.Math.isPointInLine(e,t,this.x,this.y,this.x+this.width,this.y+this.height);case"Polyline":var i=this.element.getAttributeNS(null,"points");return i?(i=i.replace(/,/g," ").split(" ").without(""),i=i.collect(function(e){return parseFloat(e)}),ORYX.Core.Math.isPointInPolygone(e,t,i)):!1;case"Path":if(!this.handler){var o=new PathParser;this.handler=new ORYX.Core.SVG.PointsPathHandler,o.setHandler(this.handler),o.parsePath(this.element)}return ORYX.Core.Math.isPointInPolygone(e,t,this.handler.points);default:return!1}},isVisible:function(e){if(void 0!==this.visible)return this.visible;e||(e=this.element);var t=!1;try{t=!!e.ownerSVGElement}catch(i){}if(t){if(ORYX.Editor.checkClassType(e,SVGGElement)&&e.className&&"me"==e.className.baseVal)return this.visible=!0,this.visible;var o=e.getAttributeNS(null,"fill"),n=e.getAttributeNS(null,"stroke");if(o&&"none"==o&&n&&"none"==n)this.visible=!1;else{var r=e.getAttributeNS(null,"display");this.visible=r?"none"==r?!1:!0:this.isVisible(e.parentNode)}}else this.visible=!0;return this.visible},toString:function(){return this.element?"SVGShape "+this.element.id:"SVGShape "+this.element}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.Label=Clazz.extend({_characterSets:["%W","@","m","wDGMOQ#+=<>~^","ABCHKNRSUVXZ&","bdghnopquxETY1234567890_${}*`","aeksvyzFLP?","c-",'rtJ"/()[]:;!|\\',"fjI., ","'","il"],_characterSetValues:[15,14,13,11,10,9,8,7,6,5,4,3],construct:function(e){if(arguments.callee.$.construct.apply(this,arguments),!e.textElement)throw"Label: No parameter textElement.";if(!ORYX.Editor.checkClassType(e.textElement,SVGTextElement))throw"Label: Parameter textElement is not an SVGTextElement.";this.invisibleRenderPoint=-5e3,this.node=e.textElement,this.node.setAttributeNS(null,"stroke-width","0pt"),this.node.setAttributeNS(null,"letter-spacing","-0.01px"),this.shapeId=e.shapeId,this.id,this.fitToElemId,this.edgePosition,this.x,this.y,this.oldX,this.oldY,this.isVisible=!0,this._text,this._verticalAlign,this._horizontalAlign,this._rotate,this._rotationPoint,this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this._isChanged=!0;var t=this.node.getAttributeNS(null,"id");t&&(this.id=t),this.fitToElemId=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"fittoelem"),this.fitToElemId&&(this.fitToElemId=this.shapeId+this.fitToElemId);var i=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"align");i&&(i=i.replace(/,/g," "),i=i.split(" "),i=i.without(""),i.each(function(e){switch(e){case"top":case"middle":case"bottom":this._verticalAlign||(this._originVerticalAlign=this._verticalAlign=e);break;case"left":case"center":case"right":this._horizontalAlign||(this._originHorizontalAlign=this._horizontalAlign=e)}}.bind(this))),this.edgePosition=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"edgePosition"),this.edgePosition&&(this.originEdgePosition=this.edgePosition=this.edgePosition.toLowerCase()),this.offsetTop=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"offsetTop")||ORYX.CONFIG.OFFSET_EDGE_LABEL_TOP,this.offsetTop&&(this.offsetTop=parseInt(this.offsetTop)),this.offsetBottom=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"offsetBottom")||ORYX.CONFIG.OFFSET_EDGE_LABEL_BOTTOM,this.offsetBottom&&(this.offsetBottom=parseInt(this.offsetBottom));var o=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"rotate");if(o)try{this._rotate=parseFloat(o)}catch(n){this._rotate=0}else this._rotate=0;var r=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(r){r=r.replace("/,/g"," ");for(var a=r.split(" ").without(""),s=0;a.length>s;s++)switch(a[s].toLowerCase()){case"left":this.originAnchorLeft=this.anchorLeft=!0;break;case"right":this.originAnchorRight=this.anchorRight=!0;break;case"top":this.originAnchorTop=this.anchorTop=!0;break;case"bottom":this.originAnchorBottom=this.anchorBottom=!0}}this._verticalAlign||(this._verticalAlign="bottom"),this._horizontalAlign||(this._horizontalAlign="left");var l=this.node.getAttributeNS(null,"x");l&&(this.oldX=this.x=parseFloat(l));var d=this.node.getAttributeNS(null,"y");d&&(this.oldY=this.y=parseFloat(d)),this.text(this.node.textContent)},resetAnchorPosition:function(){this.anchorLeft=this.originAnchorLeft||!1,this.anchorRight=this.originAnchorRight||!1,this.anchorTop=this.originAnchorTop||!1,this.anchorBottom=this.originAnchorBottom||!1},isOriginAnchorLeft:function(){return this.originAnchorLeft||!1},isOriginAnchorRight:function(){return this.originAnchorRight||!1},isOriginAnchorTop:function(){return this.originAnchorTop||!1},isOriginAnchorBottom:function(){return this.originAnchorBottom||!1},isAnchorLeft:function(){return this.anchorLeft||!1},isAnchorRight:function(){return this.anchorRight||!1},isAnchorTop:function(){return this.anchorTop||!1},isAnchorBottom:function(){return this.anchorBottom||!1},getX:function(){try{var e=this.node.x.baseVal.getItem(0).value;switch(this.horizontalAlign()){case"left":return e;case"center":return e-this.getWidth()/2;case"right":return e-this.getWidth()}return this.node.getBBox().x}catch(t){return this.x}},setX:function(e){this.position?this.position.x=e:this.setOriginX(e)},getY:function(){try{return this.node.getBBox().y}catch(e){return this.y}},setY:function(e){this.position?this.position.y=e:this.setOriginY(e)},setOriginX:function(e){this.x=e},setOriginY:function(e){this.y=e},getWidth:function(){try{try{var e,t=this.node.childNodes;if(0==t.length)e=this.node.getBBox().width;else for(var i=0,o=t.length;o>i;++i){var n=t[i].getComputedTextLength();(e===void 0||n>e)&&(e=n)}return e+(0==e%2?0:1)}catch(r){return this.node.getBBox().width}}catch(a){return 0}},getOriginUpperLeft:function(){var e=this.x,t=this.y;switch(this._horizontalAlign){case"center":e-=this.getWidth()/2;break;case"right":e-=this.getWidth()}switch(this._verticalAlign){case"middle":t-=this.getHeight()/2;break;case"bottom":t-=this.getHeight()}return{x:e,y:t}},getHeight:function(){try{return this.node.getBBox().height}catch(e){return 0}},getCenter:function(){var e={x:this.getX(),y:this.getY()};return e.x+=this.getWidth()/2,e.y+=this.getHeight()/2,e},setPosition:function(e){e&&void 0!==e.x&&void 0!==e.y?this.position=e:delete this.position,this.position&&(delete this._referencePoint,delete this.edgePosition),this._isChanged=!0,this.update()},getPosition:function(){return this.position},setReferencePoint:function(e){e?this._referencePoint=e:delete this._referencePoint,this._referencePoint&&delete this.position},getReferencePoint:function(){return this._referencePoint||void 0},changed:function(){this._isChanged=!0},registerOnChange:function(e){this.changeCallbacks||(this.changeCallbacks=[]),e instanceof Function&&!this.changeCallbacks.include(e)&&this.changeCallbacks.push(e)},unregisterOnChange:function(e){this.changeCallbacks&&e instanceof Function&&this.changeCallbacks.include(e)&&(this.changeCallbacks=this.changeCallbacks.without(e))},isUpdating:function(){return!!this._isUpdating},getOriginEdgePosition:function(){return this.originEdgePosition},getEdgePosition:function(){return this.edgePosition||null},setEdgePosition:function(e){["starttop","startmiddle","startbottom","midtop","midbottom","endtop","endbottom"].include(e)?(this.edgePosition=e,delete this.position,delete this._referencePoint):delete this.edgePosition},update:function(e){var t=this.x,i=this.y;if(this.position&&(t=this.position.x,i=this.position.y),t=Math.floor(t),i=Math.floor(i),this._isChanged||t!==this.oldX||i!==this.oldY||e===!0)if(this.isVisible){this._isChanged=!1,this._isUpdating=!0,this.node.setAttributeNS(null,"x",t),this.node.setAttributeNS(null,"y",i),this.node.removeAttributeNS(null,"fill-opacity"),this.oldX=t,this.oldY=i,this.position||this.getReferencePoint()?this.node.removeAttributeNS(null,"transform"):void 0!==this._rotate&&(this._rotationPoint?this.node.setAttributeNS(null,"transform","rotate("+this._rotate+" "+Math.floor(this._rotationPoint.x)+" "+Math.floor(this._rotationPoint.y)+")"):this.node.setAttributeNS(null,"transform","rotate("+this._rotate+" "+Math.floor(t)+" "+Math.floor(i)+")"));for(var o=this._text.split("\n");""==o.last();)o.pop();if(this.node.ownerDocument)if((this.fitToElemId||this._textHasChanged)&&(this.node.textContent="",o.each(function(e){var t=this.node.ownerDocument.createElementNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan");t.textContent=e.trim(),this.fitToElemId&&(t.setAttributeNS(null,"x",this.invisibleRenderPoint),t.setAttributeNS(null,"y",this.invisibleRenderPoint)),""===t.textContent&&(t.textContent=" "),this.node.appendChild(t)}.bind(this)),delete this._textHasChanged,delete this.indices),this.isVisible&&this.fitToElemId&&this.node.setAttributeNS(null,"visibility","hidden"),this.fitToElemId)window.setTimeout(this._checkFittingToReferencedElem.bind(this),0);else{var n=parseInt(this.node.getAttributeNS("http://activiti.org/bpmn","max-width")),r=parseInt(this.node.getAttributeNS("http://activiti.org/bpmn","max-height"));isNaN(r)||isNaN(n)?window.setTimeout(this._positionText.bind(this),0):window.setTimeout(function(){this._checkFittingToReferencedElem({getBBox:function(){return{width:n,height:r}}})}.bind(this),0)}}else this.node.textContent=""},_checkFittingToReferencedElem:function(e){try{var t=$A(this.node.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan")),i=[],o=e||this.node.ownerDocument.getElementById(this.fitToElemId);if(o){for(var n=o.getBBox(),r=this.getFontSize(),a=0;t.length>a;a++){var s=t[a],l=this._getRenderedTextLength(s,void 0,void 0,r),d=0!=this._rotate&&0!=this._rotate%180&&0==this._rotate%90?n.height:n.width;if(l>d){for(var c=0,p=0,u=this.getTrimmedTextLength(s.textContent),m=0;u>m;m++){var h=this._getRenderedTextLength(s,c,m-c,r);if(h>d-2){var f=this.node.ownerDocument.createElementNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan");c>=p?(p=0==m?m:m-1,f.textContent=s.textContent.slice(c,p).trim()):f.textContent=s.textContent.slice(c,++p).trim(),f.setAttributeNS(null,"x",this.invisibleRenderPoint),f.setAttributeNS(null,"y",this.invisibleRenderPoint),i.push(f),c=p}else{var g=s.textContent.charAt(m);(" "==g||"-"==g||"."==g||","==g||";"==g||":"==g)&&(p=m)}}s.textContent=s.textContent.slice(c).trim()}i.push(s)}for(;this.node.hasChildNodes();)this.node.removeChild(this.node.childNodes[0]);for(var v=Math.floor(n.height/r)-1,S=0;i.length>0;)if(this.node.appendChild(i.shift()),S++,S>v){var I=this.node.lastChild;I.textContent=I.textContent.length>3?I.textContent.substring(0,I.textContent.length-4)+" ...":"...";break}}}catch(O){ORYX.Log.fatal("Error "+O)}window.setTimeout(this._positionText.bind(this),0)},_positionText:function(){try{var e=this.node.childNodes,t=this.getFontSize(this.node),i=[],o=this.x,n=this.y;this.position&&(o=this.position.x,n=this.position.y),o=Math.floor(o),n=Math.floor(n);var r=0,a=[],s=this.indices||$R(0,e.length-1).toArray(),l=s.length;switch(s.each(function(s){if(void 0!==s){var d=e[r++];if(""===d.textContent.trim())i.push(d);else{var c=0;switch(this._verticalAlign){case"bottom":c=-(l-s-1)*t;break;case"middle":c=-(l/2-s-1)*t,c-=ORYX.CONFIG.LABEL_LINE_DISTANCE/2;break;case"top":c=s*t,c+=t}d.setAttributeNS(null,"dy",Math.floor(c)),d.setAttributeNS(null,"x",o),d.setAttributeNS(null,"y",n),a.push(s)}}}.bind(this)),a.length=e.length,this.indices=this.indices||a,i.each(function(e){this.node.removeChild(e)}.bind(this)),this._horizontalAlign){case"left":this.node.setAttributeNS(null,"text-anchor","start");break;case"center":this.node.setAttributeNS(null,"text-anchor","middle");break;case"right":this.node.setAttributeNS(null,"text-anchor","end")}}catch(d){this._isChanged=!0}this.isVisible&&this.node.removeAttributeNS(null,"visibility"),delete this._isUpdating,(this.changeCallbacks||[]).each(function(e){e.apply(e)})},_getRenderedTextLength:function(e,t,i){return void 0===t?e.getComputedTextLength():e.getSubStringLength(t,i)},_estimateTextWidth:function(e,t){for(var i=0,o=0;e.length>o;o++)i+=this._estimateCharacterWidth(e.charAt(o));return i*(t/14)},_estimateCharacterWidth:function(e){for(var t=0;this._characterSets.length>t;t++)if(this._characterSets[t].indexOf(e)>=0)return this._characterSetValues[t];return 9},getReferencedElementWidth:function(){var e=this.node.ownerDocument.getElementById(this.fitToElemId);if(e){var t=e.getBBox();if(t)return 0!=this._rotate&&0!=this._rotate%180&&0==this._rotate%90?t.height:t.width}return void 0},text:function(){switch(arguments.length){case 0:return this._text;case 1:var e=this._text;arguments[0]?(this._text=""+arguments[0],null!=this._text&&void 0!=this._text&&(this._text=this._text.replace(/ {2,}/g," "))):this._text="",e!==this._text&&(this._isChanged=!0,this._textHasChanged=!0);break;default:}},getOriginVerticalAlign:function(){return this._originVerticalAlign},verticalAlign:function(){switch(arguments.length){case 0:return this._verticalAlign;case 1:if(["top","middle","bottom"].member(arguments[0])){var e=this._verticalAlign;this._verticalAlign=arguments[0],this._verticalAlign!==e&&(this._isChanged=!0)}break;default:}},getOriginHorizontalAlign:function(){return this._originHorizontalAlign},horizontalAlign:function(){switch(arguments.length){case 0:return this._horizontalAlign;case 1:if(["left","center","right"].member(arguments[0])){var e=this._horizontalAlign;this._horizontalAlign=arguments[0],this._horizontalAlign!==e&&(this._isChanged=!0)}break;default:}},rotate:function(){switch(arguments.length){case 0:return this._rotate;case 1:this._rotate!=arguments[0]&&(this._rotate=arguments[0],this._rotationPoint=void 0,this._isChanged=!0);case 2:this._rotate==arguments[0]&&this._rotationPoint&&this._rotationPoint.x==arguments[1].x&&this._rotationPoint.y==arguments[1].y||(this._rotate=arguments[0],this._rotationPoint=arguments[1],this._isChanged=!0)}},hide:function(){this.isVisible&&(this.isVisible=!1,this._isChanged=!0)},show:function(){this.isVisible||(this.isVisible=!0,this._isChanged=!0,this._textHasChanged=!0)},getInheritedFontSize:function(e){if(e&&e.getAttributeNS){var t=e.getAttributeNS(null,"font-size");return t?parseFloat(t):ORYX.Editor.checkClassType(e,SVGSVGElement)?void 0:this.getInheritedFontSize(e.parentNode)}},getFontSize:function(){var e=this.node.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan"),t=this.getInheritedFontSize(this.node);return t||(t=e[0]&&/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)>=3?e[0].getExtentOfChar(0).height:ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT,0>=t&&(t=ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT)),t&&this.node.setAttribute("oryx:fontSize",t),t},getTrimmedTextLength:function(e){e=e.strip().gsub("  "," ");var t;do t=e.length,e=e.gsub("  "," ");while(t>e.length);return e.length},getOffsetBottom:function(){return this.offsetBottom},getOffsetTop:function(){return this.offsetTop},deserialize:function(e,t){if(e&&e.x!==void 0&&e.y!==void 0){if(this.setPosition({x:e.x,y:e.y}),e.distance!==void 0){var i=t.dockers[e.from],o=t.dockers[e.to];i&&o&&this.setReferencePoint({dirty:!0,distance:e.distance,intersection:{x:e.x,y:e.y},orientation:e.orientation,segment:{from:i,fromIndex:e.from,fromPosition:i.bounds.center(),to:o,toIndex:e.to,toPosition:o.bounds.center()}})}e.left&&(this.anchorLeft=!0),e.right&&(this.anchorRight=!0),e.top&&(this.anchorTop=!0),e.bottom&&(this.anchorBottom=!0),e.valign&&this.verticalAlign(e.valign),e.align&&this.horizontalAlign(e.align)}else e&&e.edge!==void 0&&this.setEdgePosition(e.edge)},serialize:function(){if(this.getEdgePosition())return this.getOriginEdgePosition()!==this.getEdgePosition()?{edge:this.getEdgePosition()}:null;if(this.position){var e={x:this.position.x,y:this.position.y};return this.isAnchorLeft()&&this.isAnchorLeft()!==this.isOriginAnchorLeft()&&(e.left=!0),this.isAnchorRight()&&this.isAnchorRight()!==this.isOriginAnchorRight()&&(e.right=!0),this.isAnchorTop()&&this.isAnchorTop()!==this.isOriginAnchorTop()&&(e.top=!0),this.isAnchorBottom()&&this.isAnchorBottom()!==this.isOriginAnchorBottom()&&(e.bottom=!0),this.getOriginVerticalAlign()!==this.verticalAlign()&&(e.valign=this.verticalAlign()),this.getOriginHorizontalAlign()!==this.horizontalAlign()&&(e.align=this.horizontalAlign()),e
}if(this.getReferencePoint()){var t=this.getReferencePoint();return{distance:t.distance,x:t.intersection.x,y:t.intersection.y,from:t.segment.fromIndex,to:t.segment.toIndex,orientation:t.orientation,valign:this.verticalAlign(),align:this.horizontalAlign()}}return null},toString:function(){return"Label "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Math||(ORYX.Core.Math={}),ORYX.Core.Math.midPoint=function(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}},ORYX.Core.Math.isPointInLine=function(e,t,i,o,n,r,a){if(a=a?Math.abs(a):1,a>=Math.abs(i-n)&&a>=Math.abs(e-i)&&a>=t-Math.max(o,r)&&a>=Math.min(o,r)-t)return!0;if(a>=Math.abs(o-r)&&a>=Math.abs(t-o)&&a>=e-Math.max(i,n)&&a>=Math.min(i,n)-e)return!0;if(e>Math.max(i,n)||Math.min(i,n)>e)return!1;if(t>Math.max(o,r)||Math.min(o,r)>t)return!1;var s=(o-r)/(i-n);return a>Math.abs(t-(s*e+o-s*i))},ORYX.Core.Math.isPointInEllipse=function(e,t,i,o,n,r){if(void 0===i||void 0===o||void 0===n||void 0===r)throw"ORYX.Core.Math.isPointInEllipse needs a ellipse with these properties: x, y, radiusX, radiusY";var a=(e-i)/n,s=(t-o)/r;return 1>a*a+s*s},ORYX.Core.Math.isPointInPolygone=function(e,t,i){if(3>arguments.length)throw"ORYX.Core.Math.isPointInPolygone needs two arguments";var o=i.length-1;(i[0]!==i[o-1]||i[1]!==i[o])&&(i.push(i[0]),i.push(i[1]));for(var n,r,a,s,l,d=0,c=0;i.length-3>c;)if(n=i[c],r=i[++c],a=i[++c],s=i[c+1],l=(t-r)*(a-n)-(e-n)*(s-r),r>=t!=s>=t&&(d+=s-r>=0?l>=0:0>=l),!l&&e>=Math.min(n,a)&&Math.max(n,a)>=e&&t>=Math.min(r,s)&&Math.max(r,s)>=t)return!0;return d%2?!0:!1},ORYX.Core.Math.distancePointLinie=function(e,t,i,o){var n=ORYX.Core.Math.getPointOfIntersectionPointLine(e,t,i,o);return n?ORYX.Core.Math.getDistancePointToPoint(i,n):null},ORYX.Core.Math.getDistancePointToPoint=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},ORYX.Core.Math.getDistanceBetweenTwoPoints=function(e,t,i){return ORYX.Core.Math.getDistancePointToPoint(i,e)/ORYX.Core.Math.getDistancePointToPoint(e,t)},ORYX.Core.Math.pointIsLeftOfLine=function(e,t,i){var o=ORYX.Core.Math.getVector(e,t),n=ORYX.Core.Math.getVector(e,i);return o.x*n.y-n.x*o.y>0},ORYX.Core.Math.getPointBetweenTwoPoints=function(e,t,i){return i=Math.max(Math.min(i||0,1),0),0===i?e:1===i?t:{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}},ORYX.Core.Math.getVector=function(e,t){return{x:t.x-e.x,y:t.y-e.y}},ORYX.Core.Math.getIdentityVector=function(e){2==arguments.length&&(e=ORYX.Core.Math.getVector(arguments[0],arguments[1]));var t=Math.sqrt(e.x*e.x+e.y*e.y);return{x:e.x/(t||1),y:e.y/(t||1)}},ORYX.Core.Math.getOrthogonalIdentityVector=function(e,t){var i=1==arguments.length?e:ORYX.Core.Math.getIdentityVector(e,t);return{x:i.y,y:-i.x}},ORYX.Core.Math.getPointOfIntersectionPointLine=function(e,t,i,o){var n=Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2);if(0==n)return void 0;var r=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/n;return!o||r>=0&&1>=r?(pointOfIntersection={},pointOfIntersection.x=e.x+r*(t.x-e.x),pointOfIntersection.y=e.y+r*(t.y-e.y),pointOfIntersection):void 0},ORYX.Core.Math.getTranslatedPoint=function(e,t){var i=t.a*e.x+t.c*e.y+1*t.e,o=t.b*e.x+t.d*e.y+1*t.f;return{x:i,y:o}},ORYX.Core.Math.getInverseMatrix=function(e){var t=ORYX.Core.Math.getDeterminant(e),i=e;return{a:t*(1*i.d-0*i.f),b:t*(0*i.f-1*i.b),c:t*(0*i.e-1*i.c),d:t*(1*i.a-0*i.e),e:t*(i.c*i.f-i.e*i.d),f:t*(i.e*i.b-i.a*i.f)}},ORYX.Core.Math.getDeterminant=function(e){return 1*e.a*e.d+0*e.c*e.f+0*e.e*e.b-0*e.e*e.d-1*e.c*e.b-0*e.a*e.f},ORYX.Core.Math.getTranslatedBoundingBox=function(e){var t=e.getCTM(),i=e.getBBox(),o=ORYX.Core.Math.getTranslatedPoint({x:i.x,y:i.y},t),n=ORYX.Core.Math.getTranslatedPoint({x:i.x,y:i.y+i.height},t),r=ORYX.Core.Math.getTranslatedPoint({x:i.x+i.width,y:i.y},t),a=ORYX.Core.Math.getTranslatedPoint({x:i.x+i.width,y:i.y+i.height},t),s={x:Math.min(o.x,n.x,r.x,a.x),y:Math.min(o.y,n.y,r.y,a.y)},l={x:Math.max(o.x,n.x,r.x,a.x),y:Math.max(o.y,n.y,r.y,a.y)};return{x:s.x,y:s.y,width:l.x-s.x,height:l.y-s.y}},ORYX.Core.Math.getAngle=function(e,t){if(e.x==t.x&&e.y==t.y)return 0;var i=180*Math.asin(Math.sqrt(Math.pow(e.y-t.y,2))/Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(e.y-t.y,2)))/Math.PI;return t.x>=e.x&&t.y<=e.y?i:t.x<e.x&&t.y<=e.y?180-i:t.x<e.x&&t.y>e.y?180+i:360-i},new function(){function e(e,r,a,s,l,d){var c=0;return r>d?c|=i:s>r&&(c|=o),e>l?c|=t:a>e&&(c|=n),c}var t=2,i=8,o=4,n=1;ORYX.Core.Math.isRectOverLine=function(){return!!ORYX.Core.Math.clipLineOnRect.apply(ORYX.Core.Math,arguments)},ORYX.Core.Math.clipLineOnRect=function(r,a,s,l,d,c,p,u){var m,h,f,g=0,v=!1,S=!1;m=e(r,a,d,c,p,u),h=e(s,l,d,c,p,u);do{if(0==(m|h))v=!0,S=!0;else if((m&h)>0)S=!0;else{var I=0,O=0;f=0!=m?m:h,(f&i)>0?(I=r+(s-r)*(u-a)/(l-a),O=u):(f&o)>0?(I=r+(s-r)*(c-a)/(l-a),O=c):(f&t)>0?(O=a+(l-a)*(p-r)/(s-r),I=p):(f&n)>0&&(O=a+(l-a)*(d-r)/(s-r),I=d),f==m?(r=I,a=O,m=e(r,a,d,c,p,u)):(s=I,l=O,h=e(s,l,d,c,p,u))}g++}while(1!=S&&5e3>g);return v?{a:{x:r,y:a},b:{x:s,y:l}}:null}},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Stencil={construct:function(e,t,i,o,n,r){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"Stencilset seems corrupt.";if(!t)throw"Stencil does not provide namespace.";if(!i)throw"Stencil does not provide SVG source.";if(!o)throw"Fatal internal error loading stencilset.";if(this._source=i,this._jsonStencil=e,this._stencilSet=o,this._namespace=t,this._propertyPackages=n,r&&!this._jsonStencil.position&&(this._jsonStencil.position=r),this._view,this._properties=new Hash,!this._jsonStencil.type||"edge"!==this._jsonStencil.type&&"node"!==this._jsonStencil.type)throw"ORYX.Core.StencilSet.Stencil(construct): Type is not defined.";if(!this._jsonStencil.id||""===this._jsonStencil.id)throw"ORYX.Core.StencilSet.Stencil(construct): Id is not defined.";if(!this._jsonStencil.title||""===this._jsonStencil.title)throw"ORYX.Core.StencilSet.Stencil(construct): Title is not defined.";this._jsonStencil.description||(this._jsonStencil.description=""),this._jsonStencil.groups||(this._jsonStencil.groups=[]),this._jsonStencil.roles||(this._jsonStencil.roles=[]),this._jsonStencil.roles.push(this._jsonStencil.id),this._jsonStencil.roles.each(function(e,i){this._jsonStencil.roles[i]=t+e}.bind(this)),this._jsonStencil.roles=this._jsonStencil.roles.uniq(),this._jsonStencil.id=t+this._jsonStencil.id,this.postProcessProperties(),this._jsonStencil.serialize||(this._jsonStencil.serialize={}),this._jsonStencil.deserialize||(this._jsonStencil.deserialize={}),this._jsonStencil.layout||(this._jsonStencil.layout=[]);var a=i+"view/"+e.view;if(this._jsonStencil.view.trim().match(/</)){var s=new DOMParser,l=s.parseFromString(this._jsonStencil.view,"text/xml");if(!ORYX.Editor.checkClassType(l.documentElement,SVGSVGElement))throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnSuccess): The response is not a SVG document.";this._view=l.documentElement}else new Ajax.Request(a,{asynchronous:!1,method:"get",onSuccess:this._loadSVGOnSuccess.bind(this),onFailure:this._loadSVGOnFailure.bind(this)})},postProcessProperties:function(){if(this._jsonStencil.icon=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/stencilsetitem/"+this._jsonStencil.objectId+"/image",this._jsonStencil.propertyPackages&&this._jsonStencil.propertyPackages instanceof Array){var e=this._jsonStencil.hiddenPropertyPackages;this._jsonStencil.propertyPackages.each(function(t){var i=this._propertyPackages[t];i&&i.each(function(t){var i=new ORYX.Core.StencilSet.Property(t,this._namespace,this);this._properties[i.prefix()+"-"+i.id()]=i,e.indexOf(i.id())>-1&&i.hide()}.bind(this))}.bind(this))}this._jsonStencil.properties&&this._jsonStencil.properties instanceof Array&&this._jsonStencil.properties.each(function(e){var t=new ORYX.Core.StencilSet.Property(e,this._namespace,this);this._properties[t.prefix()+"-"+t.id()]=t}.bind(this))},equals:function(e){return this.id()===e.id()},stencilSet:function(){return this._stencilSet},type:function(){return this._jsonStencil.type},namespace:function(){return this._namespace},id:function(){return this._jsonStencil.id},idWithoutNs:function(){return this.id().replace(this.namespace(),"")},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"title")},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"description")},groups:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"groups")},position:function(){return isNaN(this._jsonStencil.position)?0:this._jsonStencil.position},view:function(){return this._view.cloneNode(!0)||this._view},icon:function(){return this._jsonStencil.icon},fixedAspectRatio:function(){return this._jsonStencil.fixedAspectRatio===!0},hasMultipleRepositoryEntries:function(){return this.getRepositoryEntries().length>0},getRepositoryEntries:function(){return this._jsonStencil.repositoryEntries?$A(this._jsonStencil.repositoryEntries):$A([])},properties:function(){return this._properties.values()},property:function(e){return this._properties[e]},roles:function(){return this._jsonStencil.roles},defaultAlign:function(){return this._jsonStencil.defaultAlign?this._jsonStencil.defaultAlign:"east"},serialize:function(){return this._jsonStencil.serialize},deserialize:function(){return this._jsonStencil.deserialize},layout:function(){return this._jsonStencil.layout},addProperty:function(e,t){if(e&&t){var i=new ORYX.Core.StencilSet.Property(e,t,this);this._properties[i.prefix()+"-"+i.id()]=i}},removeProperty:function(e){if(e){var t=this._properties.values().find(function(t){return e==t.id()});t&&delete this._properties[t.prefix()+"-"+t.id()]}},_loadSVGOnSuccess:function(e){var t=null;if(t=e.responseXML,!ORYX.Editor.checkClassType(t.documentElement,SVGSVGElement))throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnSuccess): The response is not a SVG document.";this._view=t.documentElement},_loadSVGOnFailure:function(){throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnFailure): Loading SVG document failed."},toString:function(){return"Stencil "+this.title()+" ("+this.id()+")"}},ORYX.Core.StencilSet.Stencil=Clazz.extend(ORYX.Core.StencilSet.Stencil),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Property=Clazz.extend({construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this._jsonProp=e||ORYX.Log.error("Parameter jsonProp is not defined."),this._namespace=t||ORYX.Log.error("Parameter namespace is not defined."),this._stencil=i||ORYX.Log.error("Parameter stencil is not defined."),this._items={},this._complexItems={},this._hidden=!1,e.id=e.id||ORYX.Log.error("ORYX.Core.StencilSet.Property(construct): Id is not defined."),e.id=e.id.toLowerCase(),e.type?e.type=e.type.toLowerCase():(ORYX.Log.info("Type is not defined for stencil '%0', id '%1'. Falling back to 'String'.",i,e.id),e.type="string"),e.prefix=e.prefix||"oryx",e.title=e.title||"",e.value=e.value||"",e.description=e.description||"",e.readonly=e.readonly||!1,e.optional=e.optional!==!1,this._jsonProp.refToView?this._jsonProp.refToView instanceof Array||(this._jsonProp.refToView=[this._jsonProp.refToView]):this._jsonProp.refToView=[];var o=this.getMinForType(e.type);void 0===e.min||null===e.min?e.min=o:o>e.min&&(e.min=o);var n=this.getMaxForType(e.type);if(void 0===e.max||null===e.max?e.max=n:e.max>n&&(e.min=n),e.fillOpacity||(e.fillOpacity=!1),e.lightness="number"!=typeof e.lightness?1:Math.max(0,Math.min(1,e.lightness)),e.strokeOpacity||(e.strokeOpacity=!1),(void 0===e.length||null===e.length)&&(e.length=Number.MAX_VALUE),e.wrapLines||(e.wrapLines=!1),e.dateFormat||(e.dateFormat=ORYX.I18N.PropertyWindow.dateFormat||"m/d/y"),e.fill||(e.fill=!1),e.stroke||(e.stroke=!1),e.inverseBoolean||(e.inverseBoolean=!1),e.directlyEditable||0==e.directlyEditable||(e.directlyEditable=!0),e.visible!==!1&&(e.visible=!0),e.isList!==!0&&(e.isList=!1,e.list&&e.list instanceof Array||(e.list=[])),e.category||(e.category=e.popular?"popular":"others"),e.alwaysAppearInMultiselect||(e.alwaysAppearInMultiselect=!1),e.type===ORYX.CONFIG.TYPE_CHOICE){if(!(e.items&&e.items instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.items.each(function(e){this._items[e.value.toLowerCase()]=new ORYX.Core.StencilSet.PropertyItem(e,t,this)}.bind(this))}else(e.type===ORYX.CONFIG.TYPE_COMPLEX||e.type==ORYX.CONFIG.TYPE_MULTIPLECOMPLEX)&&e.complexItems&&e.complexItems instanceof Array&&e.complexItems.each(function(e){this._complexItems[e.id.toLowerCase()]=new ORYX.Core.StencilSet.ComplexPropertyItem(e,t,this)}.bind(this))},getMinForType:function(e){return e.toLowerCase()==ORYX.CONFIG.TYPE_INTEGER?-Math.pow(2,31):-Number.MAX_VALUE+1},getMaxForType:function(e){return e.toLowerCase()==ORYX.CONFIG.TYPE_INTEGER?Math.pow(2,31)-1:Number.MAX_VALUE},equals:function(e){return this._namespace===e.namespace()&&this.id()===e.id()?!0:!1},namespace:function(){return this._namespace},stencil:function(){return this._stencil},id:function(){return this._jsonProp.id},prefix:function(){return this._jsonProp.prefix},type:function(){return this._jsonProp.type},inverseBoolean:function(){return this._jsonProp.inverseBoolean},category:function(){return this._jsonProp.category},setCategory:function(e){this._jsonProp.category=e},directlyEditable:function(){return this._jsonProp.directlyEditable},visible:function(){return this._jsonProp.visible},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonProp,"title")},value:function(){return this._jsonProp.value},readonly:function(){return this._jsonProp.readonly},optional:function(){return this._jsonProp.optional},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonProp,"description")},refToView:function(){return this._jsonProp.refToView},min:function(){return this._jsonProp.min},max:function(){return this._jsonProp.max},fillOpacity:function(){return this._jsonProp.fillOpacity},strokeOpacity:function(){return this._jsonProp.strokeOpacity},length:function(){return this._jsonProp.length?this._jsonProp.length:Number.MAX_VALUE},wrapLines:function(){return this._jsonProp.wrapLines},dateFormat:function(){return this._jsonProp.dateFormat},fill:function(){return this._jsonProp.fill},lightness:function(){return this._jsonProp.lightness},stroke:function(){return this._jsonProp.stroke},items:function(){return $H(this._items).values()},item:function(e){return e?this._items[e.toLowerCase()]:null},toString:function(){return"Property "+this.title()+" ("+this.id()+")"},complexItems:function(){return $H(this._complexItems).values()},complexItem:function(e){return e?this._complexItems[e.toLowerCase()]:null},complexAttributeToView:function(){return this._jsonProp.complexAttributeToView||""},isList:function(){return!!this._jsonProp.isList},getListItems:function(){return this._jsonProp.list},linkableType:function(){return this._jsonProp.linkableType||""},alwaysAppearInMultiselect:function(){return this._jsonProp.alwaysAppearInMultiselect},popular:function(){return this._jsonProp.popular||!1},setPopular:function(){this._jsonProp.popular=!0},hide:function(){this._hidden=!0},isHidden:function(){return this._hidden}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.PropertyItem=Clazz.extend({construct:function(e,t,i){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter jsonItem is not defined.";if(!t)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter namespace is not defined.";if(!i)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter property is not defined.";if(this._jsonItem=e,this._namespace=t,this._property=i,!e.value)throw"ORYX.Core.StencilSet.PropertyItem(construct): Value is not defined.";this._jsonItem.refToView?this._jsonItem.refToView instanceof Array||(this._jsonItem.refToView=[this._jsonItem.refToView]):this._jsonItem.refToView=[]},equals:function(e){return this.property().equals(e.property())&&this.value()===e.value()},namespace:function(){return this._namespace},property:function(){return this._property},value:function(){return this._jsonItem.value},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonItem,"title")},refToView:function(){return this._jsonItem.refToView},icon:function(){return this._jsonItem.icon?this.property().stencil()._source+"icons/"+this._jsonItem.icon:""},toString:function(){return"PropertyItem "+this.property()+" ("+this.value()+")"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.ComplexPropertyItem=Clazz.extend({construct:function(e,t,i){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter jsonItem is not defined.";if(!t)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter namespace is not defined.";if(!i)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter property is not defined.";if(this._jsonItem=e,this._namespace=t,this._property=i,this._items=new Hash,this._complexItems=new Hash,!e.name)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Name is not defined.";if(!e.type)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Type is not defined.";if(e.type=e.type.toLowerCase(),e.type===ORYX.CONFIG.TYPE_CHOICE){if(!(e.items&&e.items instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.items.each(function(e){this._items[e.value]=new ORYX.Core.StencilSet.PropertyItem(e,t,this)}.bind(this))}else if(e.type===ORYX.CONFIG.TYPE_COMPLEX){if(!(e.complexItems&&e.complexItems instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.complexItems.each(function(e){this._complexItems[e.id]=new ORYX.Core.StencilSet.ComplexPropertyItem(e,t,this)}.bind(this))}},equals:function(e){return this.property().equals(e.property())&&this.name()===e.name()},namespace:function(){return this._namespace},property:function(){return this._property},name:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonItem,"name")},id:function(){return this._jsonItem.id},type:function(){return this._jsonItem.type},optional:function(){return this._jsonItem.optional},width:function(){return this._jsonItem.width},value:function(){return this._jsonItem.value},items:function(){return this._items.values()},complexItems:function(){return this._complexItems.values()},disable:function(){return this._jsonItem.disable}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Rules={construct:function(){arguments.callee.$.construct.apply(this,arguments),this._stencilSets=[],this._stencils=[],this._containerStencils=[],this._cachedConnectSET=new Hash,this._cachedConnectSE=new Hash,this._cachedConnectTE=new Hash,this._cachedCardSE=new Hash,this._cachedCardTE=new Hash,this._cachedContainPC=new Hash,this._cachedMorphRS=new Hash,this._connectionRules=new Hash,this._cardinalityRules=new Hash,this._containmentRules=new Hash,this._morphingRules=new Hash,this._layoutRules=new Hash},initializeRules:function(e){var t=this._stencilSets.find(function(t){return t.namespace()==e.namespace()});if(t){var o=this._stencilSets.clone();return o=o.without(t),o.push(e),this._stencilSets=[],this._stencils=[],this._containerStencils=[],this._cachedConnectSET=new Hash,this._cachedConnectSE=new Hash,this._cachedConnectTE=new Hash,this._cachedCardSE=new Hash,this._cachedCardTE=new Hash,this._cachedContainPC=new Hash,this._cachedMorphRS=new Hash,this._connectionRules=new Hash,this._cardinalityRules=new Hash,this._containmentRules=new Hash,this._morphingRules=new Hash,this._layoutRules=new Hash,o.each(function(e){this.initializeRules(e)}.bind(this)),void 0}this._stencilSets.push(e);var n=new Hash(e.jsonRules()),r=e.namespace(),a=e.stencils();e.extensions().values().each(function(e){e.rules&&(e.rules.connectionRules&&(n.connectionRules=n.connectionRules.concat(e.rules.connectionRules)),e.rules.cardinalityRules&&(n.cardinalityRules=n.cardinalityRules.concat(e.rules.cardinalityRules)),e.rules.containmentRules&&(n.containmentRules=n.containmentRules.concat(e.rules.containmentRules)),e.rules.morphingRules&&(n.morphingRules=n.morphingRules.concat(e.rules.morphingRules))),e.stencils&&(a=a.concat(e.stencils))}),this._stencils=this._stencils.concat(e.stencils());var s=this._connectionRules;n.connectionRules&&n.connectionRules.each(function(e){this._isRoleOfOtherNamespace(e.role)?s[e.role]||(s[e.role]=new Hash):s[r+e.role]||(s[r+e.role]=new Hash),e.connects.each(function(t){var i=[];t.to&&(t.to instanceof Array||(t.to=[t.to]),t.to.each(function(e){this._isRoleOfOtherNamespace(e)?i.push(e):i.push(r+e)}.bind(this)));var o,n;o=this._isRoleOfOtherNamespace(e.role)?e.role:r+e.role,n=this._isRoleOfOtherNamespace(t.from)?t.from:r+t.from,s[o][n]=s[o][n]?s[o][n].concat(i):i}.bind(this))}.bind(this));var l=this._cardinalityRules;n.cardinalityRules&&n.cardinalityRules.each(function(e){var t;if(t=this._isRoleOfOtherNamespace(e.role)?e.role:r+e.role,!l[t]){l[t]={};for(i in e)l[t][i]=e[i]}var o=new Hash;e.outgoingEdges&&e.outgoingEdges.each(function(e){this._isRoleOfOtherNamespace(e.role)?o[e.role]=e:o[r+e.role]=e}.bind(this)),l[t].outgoingEdges=o;var n=new Hash;e.incomingEdges&&e.incomingEdges.each(function(e){this._isRoleOfOtherNamespace(e.role)?n[e.role]=e:n[r+e.role]=e}.bind(this)),l[t].incomingEdges=n}.bind(this));var d=this._containmentRules;n.containmentRules&&n.containmentRules.each(function(e){var t;this._isRoleOfOtherNamespace(e.role)?t=e.role:(this._containerStencils.push(r+e.role),t=r+e.role),d[t]||(d[t]=[]),(e.contains||[]).each(function(e){this._isRoleOfOtherNamespace(e)?d[t].push(e):d[t].push(r+e)}.bind(this))}.bind(this));var c=this._morphingRules;n.morphingRules&&n.morphingRules.each(function(e){var t;t=this._isRoleOfOtherNamespace(e.role)?e.role:r+e.role,c[t]||(c[t]=[]),e.preserveBounds||(e.preserveBounds=!1),e.baseMorphs.each(function(e){var i=this._getStencilById(r+e);i&&c[t].push(i)}.bind(this))}.bind(this));var p=this._layoutRules;if(n.layoutRules){var u=function(e){return{edgeRole:e.edgeRole||void 0,t:e.t||1,r:e.r||1,b:e.b||1,l:e.l||1}};n.layoutRules.each(function(e){var t;t=this._isRoleOfOtherNamespace(e.role)?e.role:r+e.role,p[t]||(p[t]={}),e["in"]&&(p[t]["in"]=u(e["in"])),e.ins&&(p[t].ins=(e.ins||[]).map(function(e){return u(e)})),e.out&&(p[t].out=u(e.out)),e.outs&&(p[t].outs=(e.outs||[]).map(function(e){return u(e)}))}.bind(this))}},_getStencilById:function(e){return this._stencils.find(function(t){return t.id()==e})},_cacheConnect:function(e){if(result=this._canConnect(e),e.sourceStencil&&e.targetStencil){var t=this._cachedConnectSET[e.sourceStencil.id()];t||(t=new Hash,this._cachedConnectSET[e.sourceStencil.id()]=t);var i=t[e.edgeStencil.id()];i||(i=new Hash,t[e.edgeStencil.id()]=i),i[e.targetStencil.id()]=result}else if(e.sourceStencil){var t=this._cachedConnectSE[e.sourceStencil.id()];t||(t=new Hash,this._cachedConnectSE[e.sourceStencil.id()]=t),t[e.edgeStencil.id()]=result}else{var o=this._cachedConnectTE[e.targetStencil.id()];o||(o=new Hash,this._cachedConnectTE[e.targetStencil.id()]=o),o[e.edgeStencil.id()]=result}return result},_cacheCard:function(e){if(e.sourceStencil){var t=this._cachedCardSE[e.sourceStencil.id()];t||(t=new Hash,this._cachedCardSE[e.sourceStencil.id()]=t);var i=this._getMaximumNumberOfOutgoingEdge(e);void 0==i&&(i=-1),t[e.edgeStencil.id()]=i}if(e.targetStencil){var o=this._cachedCardTE[e.targetStencil.id()];o||(o=new Hash,this._cachedCardTE[e.targetStencil.id()]=o);var i=this._getMaximumNumberOfIncomingEdge(e);void 0==i&&(i=-1),o[e.edgeStencil.id()]=i}},_cacheContain:function(e){var t=[this._canContain(e),this._getMaximumOccurrence(e.containingStencil,e.containedStencil)];void 0==t[1]&&(t[1]=-1);var i=this._cachedContainPC[e.containingStencil.id()];return i||(i=new Hash,this._cachedContainPC[e.containingStencil.id()]=i),i[e.containedStencil.id()]=t,t},_cacheMorph:function(e){var t=this._cachedMorphRS[e];return t||(t=[],this._morphingRules.keys().include(e)&&(t=this._stencils.select(function(t){return t.roles().include(e)})),this._cachedMorphRS[e]=t),t},outgoingEdgeStencils:function(e){if(!e.sourceShape&&!e.sourceStencil)return[];e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil());var t=[];return this._stencils.each(function(i){if("edge"===i.type()){var o=Object.clone(e);o.edgeStencil=i,this.canConnect(o)&&t.push(i)}}.bind(this)),t},incomingEdgeStencils:function(e){if(!e.targetShape&&!e.targetStencil)return[];e.targetShape&&(e.targetStencil=e.targetShape.getStencil());var t=[];return this._stencils.each(function(i){if("edge"===i.type()){var o=Object.clone(e);o.edgeStencil=i,this.canConnect(o)&&t.push(i)}}.bind(this)),t},sourceStencils:function(e){if(!e||!e.edgeShape&&!e.edgeStencil)return[];e.targetShape&&(e.targetStencil=e.targetShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t=[];return this._stencils.each(function(i){var o=Object.clone(e);o.sourceStencil=i,this.canConnect(o)&&t.push(i)}.bind(this)),t},targetStencils:function(e){if(!e||!e.edgeShape&&!e.edgeStencil)return[];e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t=[];return this._stencils.each(function(i){var o=Object.clone(e);o.targetStencil=i,this.canConnect(o)&&t.push(i)}.bind(this)),t},canConnect:function(e){if(!e||!e.sourceShape&&!e.sourceStencil&&!e.targetShape&&!e.targetStencil||!e.edgeShape&&!e.edgeStencil)return!1;e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.targetShape&&(e.targetStencil=e.targetShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t;if(e.sourceStencil&&e.targetStencil){var i=this._cachedConnectSET[e.sourceStencil.id()];if(i){var o=i[e.edgeStencil.id()];if(o){var n=o[e.targetStencil.id()];t=void 0==n?this._cacheConnect(e):n}else t=this._cacheConnect(e)}else t=this._cacheConnect(e)}else if(e.sourceStencil){var i=this._cachedConnectSE[e.sourceStencil.id()];if(i){var o=i[e.edgeStencil.id()];t=void 0==o?this._cacheConnect(e):o}else t=this._cacheConnect(e)}else{var n=this._cachedConnectTE[e.targetStencil.id()];if(n){var o=n[e.edgeStencil.id()];t=void 0==o?this._cacheConnect(e):o}else t=this._cacheConnect(e)}if(t){if(e.sourceShape){var i=this._cachedCardSE[e.sourceStencil.id()];i||(this._cacheCard(e),i=this._cachedCardSE[e.sourceStencil.id()]);var r=i[e.edgeStencil.id()];void 0==r&&this._cacheCard(e),r=i[e.edgeStencil.id()],-1!=r&&(t=e.sourceShape.getOutgoingShapes().all(function(t){return t.getStencil().id()!==e.edgeStencil.id()||(e.edgeShape?t===e.edgeShape:0)?!0:(r--,r>0?!0:!1)}))}if(e.targetShape){var n=this._cachedCardTE[e.targetStencil.id()];n||(this._cacheCard(e),n=this._cachedCardTE[e.targetStencil.id()]);var r=n[e.edgeStencil.id()];void 0==r&&this._cacheCard(e),r=n[e.edgeStencil.id()],-1!=r&&(t=e.targetShape.getIncomingShapes().all(function(t){return t.getStencil().id()!==e.edgeStencil.id()||(e.edgeShape?t===e.edgeShape:0)?!0:(r--,r>0?!0:!1)}))}}return t},_canConnect:function(e){if(!e||!e.sourceShape&&!e.sourceStencil&&!e.targetShape&&!e.targetStencil||!e.edgeShape&&!e.edgeStencil)return!1;e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.targetShape&&(e.targetStencil=e.targetShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t,i=this._getConnectionRulesOfEdgeStencil(e.edgeStencil);return t=0===i.keys().length?!1:e.sourceStencil?e.sourceStencil.roles().any(function(t){var o=i[t];return o?e.targetStencil?o.any(function(t){return e.targetStencil.roles().member(t)}):!0:!1}):i.values().any(function(t){return e.targetStencil.roles().any(function(e){return t.member(e)})})},isContainer:function(e){return this._containerStencils.member(e.getStencil().id())},canContain:function(e){if(!e||!e.containingStencil&&!e.containingShape||!e.containedStencil&&!e.containedShape)return!1;if(e.containedShape&&(e.containedStencil=e.containedShape.getStencil()),e.containingShape&&(e.containingStencil=e.containingShape.getStencil()),"edge"==e.containedStencil.type())return!1;var t,i=this._cachedContainPC[e.containingStencil.id()];if(i?(t=i[e.containedStencil.id()],t||(t=this._cacheContain(e))):t=this._cacheContain(e),t[0]){if(-1==t[1])return!0;if(e.containingShape){var o=t[1];return e.containingShape.getChildShapes(!1).all(function(t){return t.getStencil().id()===e.containedStencil.id()?(o--,o>0?!0:!1):!0})}return!0}return!1},_canContain:function(e){if(!e||!e.containingStencil&&!e.containingShape||!e.containedStencil&&!e.containedShape)return!1;e.containedShape&&(e.containedStencil=e.containedShape.getStencil()),e.containingShape&&(e.containingStencil=e.containingShape.getStencil());var t;return t=e.containingStencil.roles().any(function(t){var i=this._containmentRules[t];return i?i.any(function(t){return e.containedStencil.roles().member(t)}):!1}.bind(this))},morphStencils:function(e){if(!e.stencil&&!e.shape)return[];e.shape&&(e.stencil=e.shape.getStencil());var t=[];e.stencil.roles().each(function(e){this._cacheMorph(e).each(function(e){t.push(e)})}.bind(this));var i=this.baseMorphs();return t=t.uniq().sort(function(e,t){return i.include(e)&&!i.include(t)?-1:i.include(t)&&!i.include(e)?1:0})},baseMorphs:function(){var e=[];return this._morphingRules.each(function(t){t.value.each(function(t){e.push(t)})}),e},containsMorphingRules:function(){return this._stencilSets.any(function(e){return!!e.jsonRules().morphingRules})},connectMorph:function(e){if(!e||!e.sourceShape&&!e.sourceStencil&&!e.targetShape&&!e.targetStencil)return!1;e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.targetShape&&(e.targetStencil=e.targetShape.getStencil());var t=this.incomingEdgeStencils(e),i=this.outgoingEdgeStencils(e),o=t.select(function(e){return i.member(e)}),n=this.baseMorphs().select(function(e){return o.member(e)});return n.size()>0?n[0]:o.size()>0?o[0]:null},showInShapeMenu:function(e){return this._stencilSets.any(function(t){return t.jsonRules().morphingRules.any(function(i){return e.roles().include(t.namespace()+i.role)&&i.showInShapeMenu!==!1})})},preserveBounds:function(e){return this._stencilSets.any(function(t){return t.jsonRules().morphingRules.any(function(i){return e.roles().include(t.namespace()+i.role)&&i.preserveBounds})})},getLayoutingRules:function(e,t){if(e&&e instanceof ORYX.Core.Shape){var i={"in":{},out:{}},o=function(e,o){e&&e[o]&&["t","r","b","l"].each(function(t){i[o][t]=Math.max(e[o][t],i[o][t]||0)}),e&&e[o+"s"]instanceof Array&&["t","r","b","l"].each(function(n){var r,a=e[o+"s"].find(function(e){return!e.edgeRole});t instanceof ORYX.Core.Edge&&(r=e[o+"s"].find(function(e){return this._hasRole(t,e.edgeRole)}.bind(this))),i[o][n]=Math.max(r?r[n]:a[n],i[o][n]||0)}.bind(this))}.bind(this);return e.getStencil().roles().each(function(e){this._layoutRules[e]&&(o(this._layoutRules[e],"in"),o(this._layoutRules[e],"out"))}.bind(this)),["in","out"].each(function(e){["t","r","b","l"].each(function(t){i[e][t]=void 0!==i[e][t]?i[e][t]:1})}),i}},_hasRole:function(e,t){if(e instanceof ORYX.Core.Shape&&t){var i=e.getStencil().roles().any(function(e){return e==t});return i||e.getStencil().id()==e.getStencil().namespace()+t}},_stencilsWithRole:function(e){return this._stencils.findAll(function(t){return t.roles().member(e)?!0:!1})},_edgesWithRole:function(e){return this._stencils.findAll(function(t){return t.roles().member(e)&&"edge"===t.type()?!0:!1})},_nodesWithRole:function(e){return this._stencils.findAll(function(t){return t.roles().member(e)&&"node"===t.type()?!0:!1})},_getMaximumOccurrence:function(e,t){var i;return t.roles().each(function(e){var t=this._cardinalityRules[e];t&&t.maximumOccurrence&&(i=i?Math.min(i,t.maximumOccurrence):t.maximumOccurrence)}.bind(this)),i},_getMaximumNumberOfOutgoingEdge:function(e){if(!e||!e.sourceStencil||!e.edgeStencil)return!1;var t;return e.sourceStencil.roles().each(function(i){var o=this._cardinalityRules[i];
o&&o.outgoingEdges&&e.edgeStencil.roles().each(function(e){var i=o.outgoingEdges[e];i&&i.maximum&&(t=t?Math.min(t,i.maximum):i.maximum)})}.bind(this)),t},_getMaximumNumberOfIncomingEdge:function(e){if(!e||!e.targetStencil||!e.edgeStencil)return!1;var t;return e.targetStencil.roles().each(function(i){var o=this._cardinalityRules[i];o&&o.incomingEdges&&e.edgeStencil.roles().each(function(e){var i=o.incomingEdges[e];i&&i.maximum&&(t=t?Math.min(t,i.maximum):i.maximum)})}.bind(this)),t},_getConnectionRulesOfEdgeStencil:function(e){var t=new Hash;return e.roles().each(function(e){this._connectionRules[e]&&this._connectionRules[e].each(function(e){t[e.key]=t[e.key]?t[e.key].concat(e.value):e.value})}.bind(this)),t},_isRoleOfOtherNamespace:function(e){return e.indexOf("#")>0},toString:function(){return"Rules"}},ORYX.Core.StencilSet.Rules=Clazz.extend(ORYX.Core.StencilSet.Rules),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.StencilSet=Clazz.extend({construct:function(e,t){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.StencilSet(construct): Parameter 'source' is not defined.";if(e.endsWith("/")&&(e=e.substr(0,e.length-1)),this._extensions=new Hash,this._source=e,this._baseUrl=e.substring(0,e.lastIndexOf("/")+1),this._jsonObject={},this._stencils=new Hash,this._availableStencils=new Hash,ORYX.CONFIG.BACKEND_SWITCH){var i;-1!==this._source.indexOf("xforms")?(i="xforms",this._baseUrl="editor/stencilsets/xforms/",this._source="stencilsets/xforms/xforms.json"):"form-flow"==t.model.modelType?(i="form-flow",this._baseUrl="editor/stencilsets/bpmn2.0/",this._source="stencilsets/bpmn2.0/bpmn2.0.json"):(i="bpmn",this._baseUrl="editor/stencilsets/bpmn2.0/",this._source="stencilsets/bpmn2.0/bpmn2.0.json"),new Ajax.Request(ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+t.stencilSetId+"/editor?version="+Date.now(),{asynchronous:!1,method:"get",onSuccess:this._init.bind(this),onFailure:this._cancelInit.bind(this)})}else new Ajax.Request(e,{asynchronous:!1,method:"get",onSuccess:this._init.bind(this),onFailure:this._cancelInit.bind(this)});if(this.errornous)throw"Loading stencil set "+e+" failed."},findRootStencilName:function(){var e=this._stencils.values().find(function(e){return e._jsonStencil.mayBeRoot});return e||(ORYX.Log.warn("Did not find any stencil that may be root. Taking a guess."),e=this._stencils.values()[0]),e.id()},equals:function(e){return this.namespace()===e.namespace()},stencils:function(e,t,i){if(e&&t){for(var o=this._availableStencils.values(),n=[e],r=[],a=[];n.size()>0;){var s=n.pop();r.push(s);for(var l=o.findAll(function(e){var i={containingStencil:s,containedStencil:e};return t.canContain(i)}),d=0;l.size()>d;d++)r.member(l[d])||n.push(l[d]);a=a.concat(l).uniq()}a=a.sortBy(function(e){return o.indexOf(e)}),i&&(a=a.sortBy(function(e){return e.groups().first()}));var c=o.findAll(function(e){return"edge"==e.type()});return a=a.concat(c)}return i?this._availableStencils.values().sortBy(function(e){return e.groups().first()}):this._availableStencils.values()},nodes:function(){return this._availableStencils.values().findAll(function(e){return"node"===e.type()})},edges:function(){return this._availableStencils.values().findAll(function(e){return"edge"===e.type()})},stencil:function(e){return this._stencils[e]},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonObject,"title")},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonObject,"description")},namespace:function(){return this._jsonObject?this._jsonObject.namespace:null},jsonRules:function(){return this._jsonObject?this._jsonObject.rules:null},source:function(){return this._source},extensions:function(){return this._extensions},addExtension:function(e){new Ajax.Request(e,{method:"GET",asynchronous:!1,onSuccess:function(e){this.addExtensionDirectly(e.responseText)}.bind(this),onFailure:function(e){ORYX.Log.debug("Loading stencil set extension file failed. The request returned an error."+e)}.bind(this),onException:function(e){ORYX.Log.debug("Loading stencil set extension file failed. The request returned an error."+e)}.bind(this)})},addExtensionDirectly:function(str){try{if(eval("var jsonExtension = "+str),jsonExtension["extends"].endsWith("#")||(jsonExtension["extends"]+="#"),jsonExtension["extends"]==this.namespace()){this._extensions[jsonExtension.namespace]=jsonExtension;var defaultPosition=this._stencils.keys().size();if(jsonExtension.stencils&&$A(jsonExtension.stencils).each(function(e){defaultPosition++;var t=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this,void 0,defaultPosition);this._stencils[t.id()]=t,this._availableStencils[t.id()]=t}.bind(this)),jsonExtension.properties){var stencils=this._stencils.values();stencils.each(function(e){var t=e.roles();jsonExtension.properties.each(function(i){i.roles.any(function(o){return o=jsonExtension["extends"]+o,t.member(o)?(i.properties.each(function(t){e.addProperty(t,jsonExtension.namespace)}),!0):!1})})}.bind(this))}jsonExtension.removeproperties&&jsonExtension.removeproperties.each(function(e){var t=this.stencil(jsonExtension["extends"]+e.stencil);t&&e.properties.each(function(e){t.removeProperty(e)})}.bind(this)),jsonExtension.removestencils&&$A(jsonExtension.removestencils).each(function(e){delete this._availableStencils[jsonExtension["extends"]+e]}.bind(this))}}catch(e){ORYX.Log.debug("StencilSet.addExtension: Something went wrong when initialising the stencil set extension. "+e)}},removeExtension:function(e){var t=this._extensions[e];if(t){if(t.stencils&&$A(t.stencils).each(function(e){var t=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this);delete this._stencils[t.id()],delete this._availableStencils[t.id()]}.bind(this)),t.properties){var i=this._stencils.values();i.each(function(e){var i=e.roles();t.properties.each(function(o){o.roles.any(function(n){return n=t["extends"]+n,i.member(n)?(o.properties.each(function(t){e.removeProperty(t.id)}),!0):!1})})}.bind(this))}t.removeproperties&&t.removeproperties.each(function(e){var i=this.stencil(t["extends"]+e.stencil);if(i){var o=$A(this._jsonObject.stencils).find(function(e){return e.id==i.id()});e.properties.each(function(e){var t=$A(o.properties).find(function(t){return t.id==e});i.addProperty(t,this.namespace())}.bind(this))}}.bind(this)),t.removestencils&&$A(t.removestencils).each(function(e){var i=t["extends"]+e;this._availableStencils[i]=this._stencils[i]}.bind(this))}delete this._extensions[e]},__handleStencilset:function(response){try{eval("this._jsonObject ="+response.responseText)}catch(e){throw"Stenciset corrupt: "+e}if(!this._jsonObject)throw"Error evaluating stencilset. It may be corrupt.";with(this._jsonObject){if(!namespace||""===namespace)throw"Namespace definition missing in stencilset.";if(!(stencils instanceof Array))throw"Stencilset corrupt.";namespace.endsWith("#")||(namespace+="#"),title||(title=""),description||(description="")}},_init:function(e){this.__handleStencilset(e);var t=new Hash;this._jsonObject.propertyPackages&&$A(this._jsonObject.propertyPackages).each(function(e){t[e.name]=e.properties}.bind(this));var i=0;$A(this._jsonObject.stencils).each(function(e){i++;var o=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this,t,i);this._stencils[o.id()]=o,this._availableStencils[o.id()]=o}.bind(this))},_cancelInit:function(){this.errornous=!0},toString:function(){return"StencilSet "+this.title()+" ("+this.namespace()+")"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet._stencilSetsByNamespace=new Hash,ORYX.Core.StencilSet._stencilSetsByUrl=new Hash,ORYX.Core.StencilSet._StencilSetNSByEditorInstance=new Hash,ORYX.Core.StencilSet._rulesByEditorInstance=new Hash,ORYX.Core.StencilSet.stencilSets=function(e){var t=ORYX.Core.StencilSet._StencilSetNSByEditorInstance[e],i=new Hash;return t&&t.each(function(e){var t=ORYX.Core.StencilSet.stencilSet(e);i[t.namespace()]=t}),i},ORYX.Core.StencilSet.stencilSet=function(e){ORYX.Log.trace("Getting stencil set %0",e);var t=e.split("#",1);return 1===t.length?(ORYX.Log.trace("Getting stencil set %0",t[0]),ORYX.Core.StencilSet._stencilSetsByNamespace[t[0]+"#"]):void 0},ORYX.Core.StencilSet.stencil=function(e){ORYX.Log.trace("Getting stencil for %0",e);var t=ORYX.Core.StencilSet.stencilSet(e);return t?t.stencil(e):(ORYX.Log.trace("Cannot fild stencil for %0",e),void 0)},ORYX.Core.StencilSet.rules=function(e){return ORYX.Core.StencilSet._rulesByEditorInstance[e]||(ORYX.Core.StencilSet._rulesByEditorInstance[e]=new ORYX.Core.StencilSet.Rules),ORYX.Core.StencilSet._rulesByEditorInstance[e]},ORYX.Core.StencilSet.loadStencilSet=function(e,t,i){stencilSet=new ORYX.Core.StencilSet.StencilSet(e,t,i),ORYX.Core.StencilSet._stencilSetsByNamespace[stencilSet.namespace()]=stencilSet,ORYX.Core.StencilSet._stencilSetsByUrl[e]=stencilSet;var o=stencilSet.namespace();if(ORYX.Core.StencilSet._StencilSetNSByEditorInstance[i]?ORYX.Core.StencilSet._StencilSetNSByEditorInstance[i].push(o):ORYX.Core.StencilSet._StencilSetNSByEditorInstance[i]=[o],ORYX.Core.StencilSet._rulesByEditorInstance[i])ORYX.Core.StencilSet._rulesByEditorInstance[i].initializeRules(stencilSet);else{var n=new ORYX.Core.StencilSet.Rules;n.initializeRules(stencilSet),ORYX.Core.StencilSet._rulesByEditorInstance[i]=n}},ORYX.Core.StencilSet.getTranslation=function(e,t){var i=ORYX.I18N.Language.toLowerCase(),o=e[t+"_"+i];return o?o:(o=e[t+"_"+i.substr(0,2)],o?o:e[t])},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Command=Clazz.extend({construct:function(){},execute:function(){throw"Command.execute() has to be implemented!"},rollback:function(){throw"Command.rollback() has to be implemented!"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Bounds={construct:function(){this._changedCallbacks=[],this.a={},this.b={},this.set.apply(this,arguments),this.suspendChange=!1,this.changedWhileSuspend=!1},_changed:function(e){this.suspendChange?this.changedWhileSuspend=!0:(this._changedCallbacks.each(function(t){t(this,e)}.bind(this)),this.changedWhileSuspend=!1)},registerCallback:function(e){this._changedCallbacks.member(e)||this._changedCallbacks.push(e)},unregisterCallback:function(e){this._changedCallbacks=this._changedCallbacks.without(e)},set:function(){var e=!1;switch(arguments.length){case 1:this.a.x!==arguments[0].a.x&&(e=!0,this.a.x=arguments[0].a.x),this.a.y!==arguments[0].a.y&&(e=!0,this.a.y=arguments[0].a.y),this.b.x!==arguments[0].b.x&&(e=!0,this.b.x=arguments[0].b.x),this.b.y!==arguments[0].b.y&&(e=!0,this.b.y=arguments[0].b.y);break;case 2:var t=Math.min(arguments[0].x,arguments[1].x),i=Math.min(arguments[0].y,arguments[1].y),o=Math.max(arguments[0].x,arguments[1].x),n=Math.max(arguments[0].y,arguments[1].y);this.a.x!==t&&(e=!0,this.a.x=t),this.a.y!==i&&(e=!0,this.a.y=i),this.b.x!==o&&(e=!0,this.b.x=o),this.b.y!==n&&(e=!0,this.b.y=n);break;case 4:var t=Math.min(arguments[0],arguments[2]),i=Math.min(arguments[1],arguments[3]),o=Math.max(arguments[0],arguments[2]),n=Math.max(arguments[1],arguments[3]);this.a.x!==t&&(e=!0,this.a.x=t),this.a.y!==i&&(e=!0,this.a.y=i),this.b.x!==o&&(e=!0,this.b.x=o),this.b.y!==n&&(e=!0,this.b.y=n)}e&&this._changed(!0)},moveTo:function(){var e=this.upperLeft();switch(arguments.length){case 1:this.moveBy({x:arguments[0].x-e.x,y:arguments[0].y-e.y});break;case 2:this.moveBy({x:arguments[0]-e.x,y:arguments[1]-e.y});break;default:}},moveBy:function(){var e=!1;switch(arguments.length){case 1:var t=arguments[0];(0!==t.x||0!==t.y)&&(e=!0,this.a.x+=t.x,this.b.x+=t.x,this.a.y+=t.y,this.b.y+=t.y);break;case 2:var i=arguments[0],o=arguments[1];(0!==i||0!==o)&&(e=!0,this.a.x+=i,this.b.x+=i,this.a.y+=o,this.b.y+=o);break;default:}e&&this._changed()},include:function(e){if(void 0===this.a.x&&void 0===this.a.y&&void 0===this.b.x&&void 0===this.b.y)return e;var t=Math.min(this.a.x,e.a.x),i=Math.min(this.a.y,e.a.y),o=Math.max(this.b.x,e.b.x),n=Math.max(this.b.y,e.b.y);this.set(t,i,o,n)},extend:function(e){(0!==e.x||0!==e.y)&&(this.b.x+=e.x,this.b.y+=e.y,this._changed(!0))},widen:function(e){0!==e&&(this.suspendChange=!0,this.moveBy({x:-e,y:-e}),this.extend({x:2*e,y:2*e}),this.suspendChange=!1,this.changedWhileSuspend&&this._changed(!0))},upperLeft:function(){var e={};return e.x=this.a.x,e.y=this.a.y,e},lowerRight:function(){var e={};return e.x=this.b.x,e.y=this.b.y,e},width:function(){return this.b.x-this.a.x},height:function(){return this.b.y-this.a.y},center:function(){var e={};return e.x=(this.a.x+this.b.x)/2,e.y=(this.a.y+this.b.y)/2,e},midPoint:function(){var e={};return e.x=(this.b.x-this.a.x)/2,e.y=(this.b.y-this.a.y)/2,e},centerMoveTo:function(){var e=this.center();switch(arguments.length){case 1:this.moveBy(arguments[0].x-e.x,arguments[0].y-e.y);break;case 2:this.moveBy(arguments[0]-e.x,arguments[1]-e.y)}},isIncluded:function(e,t){var i,o,t;switch(arguments.length){case 1:i=arguments[0].x,o=arguments[0].y,t=0;break;case 2:arguments[0].x&&arguments[0].y?(i=arguments[0].x,o=arguments[0].y,t=Math.abs(arguments[1])):(i=arguments[0],o=arguments[1],t=0);break;case 3:i=arguments[0],o=arguments[1],t=Math.abs(arguments[2]);break;default:throw"isIncluded needs one, two or three arguments"}var n=this.upperLeft(),r=this.lowerRight();return i>=n.x-t&&r.x+t>=i&&o>=n.y-t&&r.y+t>=o?!0:!1},clone:function(){return new ORYX.Core.Bounds(this)},toString:function(){return"( "+this.a.x+" | "+this.a.y+" )/( "+this.b.x+" | "+this.b.y+" )"},serializeForERDF:function(){return this.a.x+","+this.a.y+","+this.b.x+","+this.b.y}},ORYX.Core.Bounds=Clazz.extend(ORYX.Core.Bounds),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.UIObject={construct:function(e){this.isChanged=!0,this.isResized=!0,this.isVisible=!0,this.isSelectable=!1,this.isResizable=!1,this.isMovable=!1,this.id=ORYX.Editor.provideId(),this.parent=void 0,this.node=void 0,this.children=[],this.bounds=new ORYX.Core.Bounds,this._changedCallback=this._changed.bind(this),this.bounds.registerCallback(this._changedCallback),e&&e.eventHandlerCallback&&(this.eventHandlerCallback=e.eventHandlerCallback)},_changed:function(e,t){this.isChanged=!0,this.bounds==e&&(this.isResized=t||this.isResized)},update:function(){this.isChanged&&(this.refresh(),this.isChanged=!1,this.children.each(function(e){e.update()}))},refresh:function(){},getChildren:function(){return this.children.clone()},getParents:function(){for(var e=[],t=this.parent;t;)e.push(t),t=t.parent;return e},isParent:function(e){for(var t=this;t;){if(t===e)return!0;t=t.parent}return!1},getId:function(){return this.id},getChildById:function(e,t){return this.children.find(function(i){if(i.getId()===e)return i;if(t){var o=i.getChildById(e,t);if(o)return o}})},add:function(e){this.children.member(e)?ORYX.Log.info("add: ORYX.Core.UIObject is already a child of this object."):(e.parent&&e.remove(e),this.children.push(e),e.parent=this,e.node=this.node.appendChild(e.node),e.bounds.registerCallback(this._changedCallback))},remove:function(e){this.children.member(e)?(this.children=this._uiObjects.without(e),e.parent=void 0,e.node=this.node.removeChild(e.node),e.bounds.unregisterCallback(this._changedCallback)):ORYX.Log.info("remove: ORYX.Core.UIObject is not a child of this object.")},absoluteBounds:function(){if(this.parent){var e=this.absoluteXY();return new ORYX.Core.Bounds(e.x,e.y,e.x+this.bounds.width(),e.y+this.bounds.height())}return this.bounds.clone()},absoluteXY:function(){if(this.parent){var e=this.parent.absoluteXY(),t={};return t.x=e.x+this.bounds.upperLeft().x,t.y=e.y+this.bounds.upperLeft().y,t}var t={};return t.x=this.bounds.upperLeft().x,t.y=this.bounds.upperLeft().y,t},absoluteCenterXY:function(){if(this.parent){var e=this.parent.absoluteXY(),t={};return t.x=e.x+this.bounds.center().x,t.y=e.y+this.bounds.center().y,t}var t={};return t.x=this.bounds.center().x,t.y=this.bounds.center().y,t},hide:function(){this.node.setAttributeNS(null,"display","none"),this.isVisible=!1,this.children.each(function(e){e.hide()})},show:function(){this.node.setAttributeNS(null,"display","inherit"),this.isVisible=!0,this.children.each(function(e){e.show()})},addEventHandlers:function(e){e.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEOUT,this._delegateEvent.bind(this),!1),e.addEventListener("click",this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_DBLCLICK,this._delegateEvent.bind(this),!1)},_delegateEvent:function(e){this.eventHandlerCallback&&this.eventHandlerCallback(e,this)},toString:function(){return"UIObject "+this.id}},ORYX.Core.UIObject=Clazz.extend(ORYX.Core.UIObject),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.AbstractShape=ORYX.Core.UIObject.extend({construct:function(e,t){arguments.callee.$.construct.apply(this,arguments),this.resourceId=ORYX.Editor.provideId(),this._stencil=t,this._stencil._jsonStencil.superId&&(stencilId=this._stencil.id(),superStencilId=stencilId.substring(0,stencilId.indexOf("#")+1)+t._jsonStencil.superId,stencilSet=this._stencil.stencilSet(),this._stencil=stencilSet.stencil(superStencilId)),this.properties=new Hash,this.propertiesChanged=new Hash,this.hiddenProperties=new Hash,this._stencil.properties().each(function(e){var t=e.prefix()+"-"+e.id();this.properties[t]=e.value(),this.propertiesChanged[t]=!0}.bind(this));var i=["UserTask","ServiceTask","ScriptTask"];if(i.indexOf(this._stencil.idWithoutNs())>=0){var o="oryx-isforcompensation";this.properties[o]||(this.propertiesChanged["activiti-bpmn-disable-compensation"]=!0);var n="oryx-multiinstance_type";this.properties[n]||(this.propertiesChanged["activiti-bpmn-disable-multiinstance"]=!0)}t._jsonStencil.superId&&t.properties().each(function(e){var t=e.prefix()+"-"+e.id(),i=e.value(),o=this.properties[t];this.properties[t]=i,this.propertiesChanged[t]=!0,this._delegateEvent({type:ORYX.CONFIG.EVENT_PROPERTY_CHANGED,name:t,value:i,oldValue:o})}.bind(this))},layout:function(){},getStencil:function(){return this._stencil},getChildShapeByResourceId:function(e){return e=ERDF.__stripHashes(e),this.getChildShapes(!0).find(function(t){return t.resourceId==e})},getChildShapes:function(e,t){var i=[];return this.children.each(function(o){o instanceof ORYX.Core.Shape&&o.isVisible&&(t&&t(o),i.push(o),e&&(i=i.concat(o.getChildShapes(e,t))))}),i},hasChildShape:function(e){return this.getChildShapes().any(function(t){return t===e||t.hasChildShape(e)})},getChildNodes:function(e,t){var i=[];return this.children.each(function(o){o instanceof ORYX.Core.Node&&o.isVisible&&(t&&t(o),i.push(o)),o instanceof ORYX.Core.Shape&&e&&(i=i.concat(o.getChildNodes(e,t)))}),i},getChildEdges:function(e,t){var i=[];return this.children.each(function(o){o instanceof ORYX.Core.Edge&&o.isVisible&&(t&&t(o),i.push(o)),o instanceof ORYX.Core.Shape&&e&&(i=i.concat(o.getChildEdges(e,t)))}),i},getAbstractShapesAtPosition:function(){var e,t;switch(arguments.length){case 1:e=arguments[0].x,t=arguments[0].y;break;case 2:e=arguments[0],t=arguments[1];break;default:throw"getAbstractShapesAtPosition needs 1 or 2 arguments!"}if(this.isPointIncluded(e,t)){var i=[];i.push(this);var o=this.getChildNodes(),n=this.getChildEdges();return[o,n].each(function(o){var n=new Hash;o.each(function(i){if(i.isVisible){var o=i.getAbstractShapesAtPosition(e,t);if(o.length>0){var r=$A(i.node.parentNode.childNodes),a=r.indexOf(i.node);n[a]=o}}}),n.keys().sort().each(function(e){i=i.concat(n[e])})}),i}return[]},setProperty:function(e,t,i){var o=this.properties[e];(o!==t||i===!0)&&(this.properties[e]=t,this.propertiesChanged[e]=!0,this._changed(),this._isInSetProperty||(this._isInSetProperty=!0,this._delegateEvent({type:ORYX.CONFIG.EVENT_PROPERTY_CHANGED,elements:[this],name:e,value:t,oldValue:o}),delete this._isInSetProperty))},isPropertyChanged:function(){return this.propertiesChanged.any(function(e){return e.value})},setHiddenProperty:function(e,t){if(void 0===t)return delete this.hiddenProperties[e],void 0;var i=this.hiddenProperties[e];i!==t&&(this.hiddenProperties[e]=t)},isPointIncluded:function(e,t,i){var o=i?i:this.absoluteBounds();return o.isIncluded(e,t)},serialize:function(){var e=[];return e.push({name:"type",prefix:"oryx",value:this.getStencil().id(),type:"literal"}),this.hiddenProperties.each(function(t){e.push({name:t.key.replace("oryx-",""),prefix:"oryx",value:t.value,type:"literal"})}.bind(this)),this.getStencil().properties().each(function(t){var i=t.prefix(),o=t.id();e.push({name:o,prefix:i,value:this.properties[i+"-"+o],type:"literal"})}.bind(this)),e},deserialize:function(e){e=e.sort(function(e,t){return e=Number(this.properties.keys().member(e.prefix+"-"+e.name)),t=Number(this.properties.keys().member(t.prefix+"-"+t.name)),e>t?1:t>e?-1:0}.bind(this)),e.each(function(e){var t=e.name,i=e.prefix,o=e.value;switch("Object"===Object.prototype.toString.call(o)&&(o=JSON.stringify(o)),i+"-"+t){case"raziel-parent":if(!this.parent)break;var n=this.getCanvas().getChildShapeByResourceId(o);n&&n.add(this);break;default:var r=this.getStencil().property(i+"-"+t);r&&r.isList()&&"string"==typeof o&&(!(o||"").strip()||o.startsWith("[")||o.startsWith("]")||(o='["'+o.strip()+'"]'),o=((o||"").strip()||"[]").evalJSON()),this.properties.keys().member(i+"-"+t)?this.setProperty(i+"-"+t,o):"bounds"!==t&&"parent"!==t&&"target"!==t&&"dockers"!==t&&"docker"!==t&&"outgoing"!==t&&"incoming"!==t&&this.setHiddenProperty(i+"-"+t,o)}}.bind(this))},toString:function(){return"ORYX.Core.AbstractShape "+this.id},toJSON:function(){var e={resourceId:this.resourceId,properties:jQuery.extend({},this.properties,this.hiddenProperties).inject({},function(e,t){var i=t[0],o=t[1];if(this.getStencil().property(i)&&this.getStencil().property(i).type()===ORYX.CONFIG.TYPE_COMPLEX&&"String"===Object.prototype.toString.call(o))try{o=JSON.parse(o)}catch(n){}else if(o instanceof Date&&this.getStencil().property(i))try{o=o.format(this.getStencil().property(i).dateFormat())}catch(r){}return i=i.replace(/^[\w_]+-/,""),e[i]=o,e}.bind(this)),stencil:{id:this.getStencil().idWithoutNs()},childShapes:this.getChildShapes().map(function(e){return e.toJSON()})};return this.getOutgoingShapes&&(e.outgoing=this.getOutgoingShapes().map(function(e){return{resourceId:e.resourceId}})),this.bounds&&(e.bounds={lowerRight:this.bounds.lowerRight(),upperLeft:this.bounds.upperLeft()}),this.dockers&&(e.dockers=this.dockers.map(function(e){var t=e.getDockedShape()&&e.referencePoint?e.referencePoint:e.bounds.center();return t.getDocker=function(){return e},t})),jQuery.extend(e,ORYX.Core.AbstractShape.JSONHelper),e.getShape=function(){return this}.bind(this),e}}),ORYX.Core.AbstractShape.JSONHelper={eachChild:function(e,t,i){if(this.childShapes){var o=[];this.childShapes.each(function(n){n.eachChild instanceof Function||jQuery.extend(n,ORYX.Core.AbstractShape.JSONHelper);var r=e(n,this);r&&o.push(r),t&&n.eachChild(e,t,i)}.bind(this)),i&&(this.childShapes=o)}},getShape:function(){return null},getChildShapes:function(e){var t=this.childShapes;return e&&this.eachChild(function(i){i.getChildShapes instanceof Function||jQuery.extend(i,ORYX.Core.AbstractShape.JSONHelper),t=t.concat(i.getChildShapes(e))},!0),t},serialize:function(){return JSON.stringify(this)}},!ORYX)var ORYX={};ORYX.Core||(ORYX.Core={}),ORYX.Core.Canvas=ORYX.Core.AbstractShape.extend({zoomLevel:1,construct:function(e,t,i){return arguments.callee.$.construct.apply(this,arguments),e&&e.width&&e.height?(this.facade=i,this.resourceId=e.id,this.nodes=[],this.edges=[],this.colHighlightState=0,this.colHighlightEnabled=!1,this.rootNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",e.parentNode,["svg",{id:this.id,width:e.width,height:e.height},["defs",{}]]),this.rootNode.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.rootNode.setAttribute("xmlns:svg","http://www.w3.org/2000/svg"),this._htmlContainer=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",e.parentNode,["div",{id:"oryx_canvas_htmlContainer",style:"position:absolute; top:5px"}]),this.underlayNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.rootNode,["svg",{id:"underlay-container"}]),this.columnHightlight1=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.underlayNode,["rect",{x:0,width:ORYX.CONFIG.FORM_ROW_WIDTH+35,height:"100%",style:"fill: #fff6d5",visibility:"hidden"}]),this.columnHightlight2=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.underlayNode,["rect",{x:ORYX.CONFIG.FORM_ROW_WIDTH+35,width:ORYX.CONFIG.FORM_ROW_WIDTH+25,height:"100%",style:"fill: #fff6d5",visibility:"hidden"}]),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.rootNode,["g",{},["g",{"class":"stencils"},["g",{"class":"me"}],["g",{"class":"children"}],["g",{"class":"edge"}]],["g",{"class":"svgcontainer"}]]),this.node.setAttributeNS(null,"stroke","none"),this.node.setAttributeNS(null,"font-family","Verdana, sans-serif"),this.node.setAttributeNS(null,"font-size-adjust","none"),this.node.setAttributeNS(null,"font-style","normal"),this.node.setAttributeNS(null,"font-variant","normal"),this.node.setAttributeNS(null,"font-weight","normal"),this.node.setAttributeNS(null,"line-heigth","normal"),this.node.setAttributeNS(null,"font-size",ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT),this.bounds.set(0,0,e.width,e.height),this.addEventHandlers(this.rootNode.parentNode),this.rootNode.oncontextmenu=function(){return!1},void 0):(ORYX.Log.fatal("Canvas is missing mandatory parameters options.width and options.height."),void 0)},focus:function(){try{this.focusEl||(this.focusEl=jQuery("body").append(jQuery('<a href="#" class="x-grid3-focus x-grid3-focus-canvas"/>')),this.focusEl.swallowEvent("click",!0)),this.focusEl.focus.defer(1,this.focusEl),this.focusEl.blur.defer(3,this.focusEl)}catch(e){}},setHightlightState:function(e){this.colHighlightEnabled&&this.colHighlightState!=e&&(0==e?(this.columnHightlight1.setAttribute("visibility","hidden"),this.columnHightlight2.setAttribute("visibility","hidden")):1==e?(this.columnHightlight1.setAttribute("visibility","visible"),this.columnHightlight2.setAttribute("visibility","hidden")):2==e?(this.columnHightlight1.setAttribute("visibility","hidden"),this.columnHightlight2.setAttribute("visibility","visible")):3==e&&(this.columnHightlight1.setAttribute("visibility","visible"),this.columnHightlight2.setAttribute("visibility","visible")),this.colHighlightState=e)},setHightlightStateBasedOnX:function(e){e>ORYX.CONFIG.FORM_ROW_WIDTH+30?this.setHightlightState(2):this.setHightlightState(1)},update:function(){this.nodes.each(function(e){this._traverseForUpdate(e)}.bind(this));var e=this.getStencil().layout();e&&e.each(function(e){e.shape=this,e.forceExecution=!0,e.target=this.rootNode,this._delegateEvent(e)}.bind(this)),this.nodes.invoke("_update"),this.edges.invoke("_update",!0)},_traverseForUpdate:function(e){var t=e.isChanged;return e.getChildNodes(!1,function(e){this._traverseForUpdate(e)&&(t=!0)}.bind(this)),t?(e.layout(),!0):!1},layout:function(){},getChildNodes:function(e,t){if(e||t){var i=[];return this.nodes.each(function(o){t&&t(o),i.push(o),e&&o instanceof ORYX.Core.Shape&&(i=i.concat(o.getChildNodes(e,t)))}),i}return this.nodes.clone()},add:function(e,t,i){e instanceof ORYX.Core.UIObject?this.children.member(e)?ORYX.Log.warn("add: ORYX.Core.UIObject is already a child of this object."):(e.parent&&e.parent.remove(e,!0),void 0!=t?this.children.splice(t,0,e):this.children.push(e),e.parent=this,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.addMarkers(this.rootNode.getElementsByTagNameNS(NAMESPACE_SVG,"defs")[0]),e.node=this.node.childNodes[0].childNodes[2].appendChild(e.node),this.edges.push(e)):(e.node=this.node.childNodes[0].childNodes[1].appendChild(e.node),this.nodes.push(e)):e.node=this.node.appendChild(e.node),e.bounds.registerCallback(this._changedCallback),this.eventHandlerCallback&&i!==!0&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEADDED,shape:e})):ORYX.Log.fatal("add: Parameter is not of type ORYX.Core.UIObject.")},remove:function(e,t){if(this.children.member(e)){var i=e.parent;this.children=this.children.without(e),e.parent=void 0,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.removeMarkers(),e.node=this.node.childNodes[0].childNodes[2].removeChild(e.node),this.edges=this.edges.without(e)):(e.node=this.node.childNodes[0].childNodes[1].removeChild(e.node),this.nodes=this.nodes.without(e)):e.node=this.node.removeChild(e.node),this.eventHandlerCallback&&t!==!0&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEREMOVED,shape:e,parent:i}),e.bounds.unregisterCallback(this._changedCallback)}else ORYX.Log.warn("remove: ORYX.Core.UIObject is not a child of this object.")},removeAll:function(){for(var e=this.getChildShapes(),t=0;e.length>t;t++){var i=e[t];this.remove(i)}},addShapeObjects:function(e,t){if(e){this.initializingShapes=!0;var i=function(e,i){var o=ORYX.Core.StencilSet.stencil(this.getStencil().namespace()+e.stencil.id),n="node"==o.type()?ORYX.Core.Node:ORYX.Core.Edge,r=new n({eventHandlerCallback:t},o,this.facade);return r.resourceId=e.resourceId,r.node.id="svg-"+e.resourceId,e.parent="#"+(e.parent&&e.parent.resourceId||i.resourceId),this.add(r),{json:e,object:r}}.bind(this),o=function(e){var t=[];return e.childShapes&&e.childShapes.constructor==String&&(e.childShapes=JSON.parse(e.childShapes)),e.childShapes.each(function(n){t.push(i(n,e)),t=t.concat(o(n))}),t}.bind(this),n=o({childShapes:e,resourceId:this.resourceId});return n.each(function(e){var t=[];for(field in e.json.properties)t.push({prefix:"oryx",name:field,value:e.json.properties[field]});if(e.json.outgoing&&e.json.outgoing.each(function(e){t.push({prefix:"raziel",name:"outgoing",value:"#"+e.resourceId})}),e.object instanceof ORYX.Core.Edge){var i=e.json.target||e.json.outgoing[0];i&&t.push({prefix:"raziel",name:"target",value:"#"+i.resourceId})}e.json.bounds&&t.push({prefix:"oryx",name:"bounds",value:e.json.bounds.upperLeft.x+","+e.json.bounds.upperLeft.y+","+e.json.bounds.lowerRight.x+","+e.json.bounds.lowerRight.y}),e.json.dockers&&t.push({prefix:"oryx",name:"dockers",value:e.json.dockers.inject("",function(e,t){return e+t.x+" "+t.y+" "})+" #"}),t.push({prefix:"raziel",name:"parent",value:e.json.parent}),e.__properties=t}.bind(this)),n.each(function(e){e.object instanceof ORYX.Core.Node&&e.object.deserialize(e.__properties,e.json)}),n.each(function(e){e.object instanceof ORYX.Core.Edge&&(e.object.deserialize(e.__properties,e.json),e.object._oldBounds=e.object.bounds.clone(),e.object._update())}),delete this.initializingShapes,n.pluck("object")}},updateSize:function(){var e=0,t=0,i=100;this.getChildShapes(!0,function(o){var n=o.bounds;e=Math.max(e,n.lowerRight().x+i),t=Math.max(t,n.lowerRight().y+i)}),(e>this.bounds.width()||t>this.bounds.height())&&this.setSize({width:Math.max(this.bounds.width(),e),height:Math.max(this.bounds.height(),t)})},getRootNode:function(){return this.rootNode},getUnderlayNode:function(){return this.underlayNode},getSvgContainer:function(){return this.node.childNodes[1]},getHTMLContainer:function(){return this._htmlContainer},getShapesWithSharedParent:function(e){return!e||1>e.length?[]:1==e.length?e:e.findAll(function(t){for(var i=t.parent;i;){if(e.member(i))return!1;i=i.parent}return!0})},setSize:function(e,t){e&&e.width&&e.height&&(this.rootNode.parentNode&&(this.rootNode.parentNode.style.width=e.width+"px",this.rootNode.parentNode.style.height=e.height+"px"),this.rootNode.setAttributeNS(null,"width",e.width),this.rootNode.setAttributeNS(null,"height",e.height),t||this.bounds.set({a:{x:0,y:0},b:{x:e.width/this.zoomLevel,y:e.height/this.zoomLevel}}))},getSVGRepresentation:function(e){var t=this.getRootNode().cloneNode(!0);this._removeInvisibleElements(t);var i,o,n,r;
this.getChildShapes(!0).each(function(e){var t=e.absoluteBounds(),a=t.upperLeft(),s=t.lowerRight();void 0==i?(i=a.x,o=a.y,n=s.x,r=s.y):(i=Math.min(i,a.x),o=Math.min(o,a.y),n=Math.max(n,s.x),r=Math.max(r,s.y))});var a,s,l,d,c=50;void 0==i?(a=0,s=0,l=0,d=0):(a=n,s=r,l=-i+c/2,d=-o+c/2),t.setAttributeNS(null,"width",a+c),t.setAttributeNS(null,"height",s+c),t.childNodes[1].removeAttributeNS(null,"transform");try{var p=t.childNodes[1].childNodes[1];p.parentNode.removeChild(p)}catch(u){}return e&&($A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan")).each(function(e){e.textContent=e.textContent.escapeHTML()}),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text")).each(function(e){0==e.childNodes.length&&(e.textContent=e.textContent.escapeHTML())})),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"image")).each(function(e){var t=e.getAttributeNS("http://www.w3.org/1999/xlink","href");t.match("^(http|https)://")||(t=window.location.protocol+"//"+window.location.host+t,e.setAttributeNS("http://www.w3.org/1999/xlink","href",t))}),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"a")).each(function(e){e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",(e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").escapeHTML())}),t},_removeInvisibleElements:function(e){for(var t=0;e.childNodes.length>t;){var i=e.childNodes[t];i.getAttributeNS&&"hidden"===i.getAttributeNS(null,"visibility")?e.removeChild(i):(this._removeInvisibleElements(i),t++)}},_delegateEvent:function(e){!this.eventHandlerCallback||e.target!=this.rootNode&&e.target!=this.rootNode.parentNode||this.eventHandlerCallback(e,this)},toString:function(){return"Canvas "+this.id},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments);return e.stencilset={url:this.getStencil().stencilSet().source(),namespace:this.getStencil().stencilSet().namespace()},e}});var idCounter=0,ID_PREFIX="resource";if(!ORYX)var ORYX={};if(ORYX.Editor={DOMEventListeners:new Hash,selection:[],zoomLevel:1,construct:function(e){this._eventsQueue=[],this.loadedPlugins=[],this.pluginsData=[],this.modelMetaData=e;var t=e;if(this.id=t.modelId,e.model&&(t=e.model),this.id||(this.id=t.id,this.id||(this.id=ORYX.Editor.provideId())),this.fullscreen=e.fullscreen!==!1,this._initEventListener(),ORYX.CONFIG.BACKEND_SWITCH){var i=(t.stencilset.namespace||t.stencilset.url).replace("#","%23");ORYX.Core.StencilSet.loadStencilSet(i,this.modelMetaData,this.id)}else{var i=t.stencilset.url;ORYX.Core.StencilSet.loadStencilSet(i,this.modelMetaData,this.id)}this._createCanvas(t.stencil?t.stencil.id:null,t.properties),this._generateGUI();var o=!1,n=!1,r=function(){o&&n&&this._finishedLoading()}.bind(this);window.setTimeout(function(){this.loadPlugins(),o=!0,r()}.bind(this),100),window.setTimeout(function(){this.loadSerialized(t,!0),this.getCanvas().update(),n=!0,r()}.bind(this),200)},_finishedLoading:function(){this.handleEvents({type:ORYX.CONFIG.EVENT_LOADED})},_initEventListener:function(){document.documentElement.addEventListener(ORYX.CONFIG.EVENT_KEYDOWN,this.catchKeyDownEvents.bind(this),!1),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_KEYUP,this.catchKeyUpEvents.bind(this),!1),this._keydownEnabled=!0,this._keyupEnabled=!0,this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEDOWN]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEUP]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEOVER]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEOUT]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_SELECTION_CHANGED]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEMOVE]=[]},_generateGUI:function(){ORYX.CONFIG.WINDOW_HEIGHT;var e=this.getCanvas().rootNode.parentNode;jQuery("#canvasSection").append(e),e.parentNode&&(e.parentNode.setAttributeNS(null,"align","center"),e.setAttributeNS(null,"align","left"),this.getCanvas().setSize({width:ORYX.CONFIG.CANVAS_WIDTH,height:ORYX.CONFIG.CANVAS_HEIGHT}))},getAvailablePlugins:function(){var e=ORYX.availablePlugins.clone();return e.each(function(e){e.engaged=this.loadedPlugins.find(function(e){return e.type==this.name}.bind(e))?!0:!1}.bind(this)),e},loadScript:function(e,t){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){("loaded"==i.readyState||"complete"==i.readyState)&&(i.onreadystatechange=null,t())}:i.onload=function(){t()},i.src=e,document.getElementsByTagName("head")[0].appendChild(i)},activatePluginByName:function(name,callback,loadTry){var match=this.getAvailablePlugins().find(function(e){return e.name==name});if(!match||match.engaged&&"false"!==match.engaged)callback(!1,match?"NOTFOUND":"YETACTIVATED");else{var loadedStencilSetsNamespaces=this.getStencilSets().keys(),facade=this._getPluginFacade(),newPlugin,me=this;if(ORYX.Log.debug("Initializing plugin '%0'",match.name),match.requires&&match.requires.namespaces&&!match.requires.namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0}))callback(!1,"REQUIRESTENCILSET"),ORYX.Log.info("Plugin need a stencilset which is not loaded'",match.name);else if(match.notUsesIn&&match.notUsesIn.namespaces&&match.notUsesIn.namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0}))callback(!1,"NOTUSEINSTENCILSET"),ORYX.Log.info("Plugin need a stencilset which is not loaded'",match.name);else try{var className=eval(match.name),newPlugin=new className(facade,match);newPlugin.type=match.name,newPlugin.registryChanged&&newPlugin.registryChanged(me.pluginsData),newPlugin.onSelectionChanged&&me.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,newPlugin.onSelectionChanged.bind(newPlugin)),this.loadedPlugins.push(newPlugin),this.loadedPlugins.each(function(e){e.registryChanged&&e.registryChanged(this.pluginsData)}.bind(me)),callback(!0)}catch(e){if(ORYX.Log.warn("Plugin %0 is not available",match.name),loadTry)return callback(!1,"INITFAILED"),void 0;this.loadScript("plugins/scripts/"+match.source,this.activatePluginByName.bind(this,match.name,callback,!0))}}},loadPlugins:function(){var me=this,newPlugins=[],loadedStencilSetsNamespaces=this.getStencilSets().keys(),facade=this._getPluginFacade();ORYX.MashupAPI&&ORYX.MashupAPI.loadablePlugins&&ORYX.MashupAPI.loadablePlugins instanceof Array&&(ORYX.availablePlugins=$A(ORYX.availablePlugins).findAll(function(e){return ORYX.MashupAPI.loadablePlugins.include(e.name)}),ORYX.MashupAPI.loadablePlugins.each(function(e){ORYX.availablePlugins.find(function(t){return t.name==e})||ORYX.availablePlugins.push({name:e})})),ORYX.availablePlugins.each(function(value){if(ORYX.Log.debug("Initializing plugin '%0'",value.name),value.requires&&value.requires.namespaces&&!value.requires.namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0})||value.notUsesIn&&value.notUsesIn.namespaces&&value.notUsesIn.namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0})||!value.engaged&&void 0!==value.engaged)ORYX.Log.info("Plugin need a stencilset which is not loaded'",value.name);else try{var className=eval(value.name);if(className){var plugin=new className(facade,value);plugin.type=value.name,newPlugins.push(plugin),plugin.engaged=!0}}catch(e){ORYX.Log.warn("Plugin %0 is not available %1",value.name,e)}}),newPlugins.each(function(e){e.registryChanged&&e.registryChanged(me.pluginsData),e.onSelectionChanged&&me.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,e.onSelectionChanged.bind(e))}),this.loadedPlugins=newPlugins,this.registerPluginsOnKeyEvents(),this.setSelection()},_createCanvas:function(e,t){e?-1===e.search(/^http/)&&(e=this.getStencilSets().values()[0].namespace()+e):e=this.getStencilSets().values()[0].findRootStencilName();var i=ORYX.Core.StencilSet.stencil(e);i||ORYX.Log.fatal("Initialisation failed, because the stencil with the type %0 is not part of one of the loaded stencil sets.",e);var o=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",null,["div"]);if(o.addClassName("ORYX_Editor"),this._canvas=new ORYX.Core.Canvas({width:ORYX.CONFIG.CANVAS_WIDTH,height:ORYX.CONFIG.CANVAS_HEIGHT,eventHandlerCallback:this.handleEvents.bind(this),id:this.id,parentNode:o},i,this._getPluginFacade()),t){var n=[];for(field in t)n.push({prefix:"oryx",name:field,value:t[field]});this._canvas.deserialize(n)}},_getPluginFacade:function(){return this._pluginFacade||(this._pluginFacade={activatePluginByName:this.activatePluginByName.bind(this),getAvailablePlugins:this.getAvailablePlugins.bind(this),offer:this.offer.bind(this),getStencilSets:this.getStencilSets.bind(this),getStencilSetExtensionDefinition:function(){return Object.clone(this.ss_extensions_def||{})}.bind(this),getRules:this.getRules.bind(this),loadStencilSet:this.loadStencilSet.bind(this),createShape:this.createShape.bind(this),deleteShape:this.deleteShape.bind(this),getSelection:this.getSelection.bind(this),setSelection:this.setSelection.bind(this),updateSelection:this.updateSelection.bind(this),getCanvas:this.getCanvas.bind(this),importJSON:this.importJSON.bind(this),getJSON:this.getJSON.bind(this),getSerializedJSON:this.getSerializedJSON.bind(this),executeCommands:this.executeCommands.bind(this),isExecutingCommands:this.isExecutingCommands.bind(this),registerOnEvent:this.registerOnEvent.bind(this),unregisterOnEvent:this.unregisterOnEvent.bind(this),raiseEvent:this.handleEvents.bind(this),enableEvent:this.enableEvent.bind(this),disableEvent:this.disableEvent.bind(this),eventCoordinates:this.eventCoordinates.bind(this),eventCoordinatesXY:this.eventCoordinatesXY.bind(this),getModelMetaData:this.getModelMetaData.bind(this)}),this._pluginFacade},isExecutingCommands:function(){return!!this.commandExecuting},executeCommands:function(e){if(this.commandStack||(this.commandStack=[]),this.commandStackExecuted||(this.commandStackExecuted=[]),this.commandStack=[].concat(this.commandStack).concat(e),!this.commandExecuting){for(this.commandExecuting=!0;this.commandStack.length>0;){var t=this.commandStack.shift();t.execute(),this.commandStackExecuted.push(t)}this.handleEvents({type:ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,commands:this.commandStackExecuted}),delete this.commandStack,delete this.commandStackExecuted,delete this.commandExecuting,this.updateSelection()}},getJSON:function(){delete Array.prototype.toJSON;var e=this.getCanvas().toJSON();return e.ssextensions=this.getStencilSets().values()[0].extensions().keys().findAll(function(e){return!e.endsWith("/meta#")}),e},getSerializedJSON:function(){return JSON.stringify(this.getJSON())},importJSON:function(e,t){try{e=this.renewResourceIds(e)}catch(i){throw i}if(e.stencilset.namespace&&e.stencilset.namespace!==this.getCanvas().getStencil().stencilSet().namespace())return alert(String.format(ORYX.I18N.JSONImport.wrongSS,e.stencilset.namespace,this.getCanvas().getStencil().stencilSet().namespace())),null;var o=ORYX.Core.Command.extend({construct:function(e,t,i,o){this.jsonObject=e,this.noSelection=i,this.facade=o,this.shapes,this.connections=[],this.parents=new Hash,this.selection=this.facade.getSelection(),this.loadSerialized=t},execute:function(){this.shapes?(this.shapes.each(function(e){this.parents[e.id].add(e)}.bind(this)),this.connections.each(function(e){e[0].setDockedShape(e[1]),e[0].setReferencePoint(e[2]),e[0].update()})):(this.shapes=this.loadSerialized(this.jsonObject),this.shapes.each(function(e){if(e.getDockers){var t=e.getDockers();t&&(t.length>0&&this.connections.push([t.first(),t.first().getDockedShape(),t.first().referencePoint]),t.length>1&&this.connections.push([t.last(),t.last().getDockedShape(),t.last().referencePoint]))}this.parents[e.id]=e.parent}.bind(this))),this.facade.getCanvas().update(),this.noSelection?this.facade.updateSelection():this.facade.setSelection(this.shapes),this.facade.getCanvas().updateSize()},rollback:function(){var e=this.facade.getSelection();this.shapes.each(function(t){e=e.without(t),this.facade.deleteShape(t)}.bind(this)),this.facade.getCanvas().update(),this.facade.setSelection(e)}}),n=new o(e,this.loadSerialized.bind(this),t,this._getPluginFacade());return this.executeCommands([n]),n.shapes.clone()},renewResourceIds:function(e){if("String"===Object.prototype.toString.call(e))try{var t=e;e=JSON.parse(e)}catch(i){throw new SyntaxError(i.message)}else var t=JSON.stringify(e);var o=function(e){return e?e.map(function(e){return o(e.childShapes).concat(e.resourceId)}).flatten():[]},n=o(e.childShapes);return n.each(function(e){var i=ORYX.Editor.provideId();t=t.replace(RegExp(e,"g"),i)}),JSON.parse(t)},loadSerialized:function(e,t){if(this.getCanvas(),this.loadSSExtensions(e.ssextensions),t===!0){var i=this.getExtensionForMetaData();i&&this.loadSSExtension(i)}var o=this.getCanvas().addShapeObjects(e.childShapes,this.handleEvents.bind(this));if(e.properties)for(key in e.properties){var n=e.properties[key],r=this.getCanvas().getStencil().property("oryx-"+key);"string"==typeof n||r&&r.isList()||(n=JSON.stringify(n)),this.getCanvas().setProperty("oryx-"+key,n)}return this.getCanvas().updateSize(),this.selection=[null],this.setSelection([]),o},getExtensionForMetaData:function(){if(!(this.ss_extensions_def&&this.ss_extensions_def.extensions instanceof Array))return null;var e=this.getStencilSets(),t=this.ss_extensions_def.extensions.find(function(t){return!!e[t["extends"]]&&t.namespace.endsWith("/meta#")});return t?t.namespace||null:null},loadSSExtensions:function(e){e&&e.each(function(e){this.loadSSExtension(e)}.bind(this))},loadSSExtension:function(e){if(this.ss_extensions_def){var t=this.ss_extensions_def.extensions.find(function(t){return t.namespace==e});if(!t)return;var i=this.getStencilSets()[t["extends"]];if(!i)return;(t.definition||"").startsWith("/")?i.addExtension(t.definition):i.addExtension(ORYX.CONFIG.SS_EXTENSIONS_FOLDER+t.definition),this.getRules().initializeRules(i),this._getPluginFacade().raiseEvent({type:ORYX.CONFIG.EVENT_STENCIL_SET_LOADED})}},disableEvent:function(e){if(e==ORYX.CONFIG.EVENT_KEYDOWN&&(this._keydownEnabled=!1),e==ORYX.CONFIG.EVENT_KEYUP&&(this._keyupEnabled=!1),this.DOMEventListeners.keys().member(e)){var t=this.DOMEventListeners.remove(e);this.DOMEventListeners["disable_"+e]=t}},enableEvent:function(e){if(e==ORYX.CONFIG.EVENT_KEYDOWN&&(this._keydownEnabled=!0),e==ORYX.CONFIG.EVENT_KEYUP&&(this._keyupEnabled=!0),this.DOMEventListeners.keys().member("disable_"+e)){var t=this.DOMEventListeners.remove("disable_"+e);this.DOMEventListeners[e]=t}},registerOnEvent:function(e,t){this.DOMEventListeners.keys().member(e)||(this.DOMEventListeners[e]=[]),this.DOMEventListeners[e].push(t)},unregisterOnEvent:function(e,t){this.DOMEventListeners.keys().member(e)&&(this.DOMEventListeners[e]=this.DOMEventListeners[e].without(t))},getSelection:function(){return this.selection||[]},getStencilSets:function(){return ORYX.Core.StencilSet.stencilSets(this.id)},getRules:function(){return ORYX.Core.StencilSet.rules(this.id)},loadStencilSet:function(e){try{ORYX.Core.StencilSet.loadStencilSet(e,this.modelMetaData,this.id),this.handleEvents({type:ORYX.CONFIG.EVENT_STENCIL_SET_LOADED})}catch(t){ORYX.Log.warn("Requesting stencil set file failed. ("+t+")")}},offer:function(e){this.pluginsData.member(e)||this.pluginsData.push(e)},registerPluginsOnKeyEvents:function(){this.pluginsData.each(function(e){e.keyCodes&&e.keyCodes.each(function(t){var i="key.event";i+="."+t.keyAction,t.metaKeys&&(t.metaKeys.indexOf(ORYX.CONFIG.META_KEY_META_CTRL)>-1&&(i+="."+ORYX.CONFIG.META_KEY_META_CTRL),t.metaKeys.indexOf(ORYX.CONFIG.META_KEY_ALT)>-1&&(i+="."+ORYX.CONFIG.META_KEY_ALT),t.metaKeys.indexOf(ORYX.CONFIG.META_KEY_SHIFT)>-1&&(i+="."+ORYX.CONFIG.META_KEY_SHIFT)),t.keyCode&&(i+="."+t.keyCode),ORYX.Log.debug("Register Plugin on Key Event: %0",i),e.toggle===!0&&e.buttonInstance?this.registerOnEvent(i,function(){e.buttonInstance.toggle(!e.buttonInstance.pressed),e.functionality.call(e,e.buttonInstance,e.buttonInstance.pressed)}):this.registerOnEvent(i,e.functionality)}.bind(this))}.bind(this))},isEqual:function(e,t){return e===t||e.length===t.length&&e.all(function(e){return t.include(e)})},isDirty:function(e){return e.any(function(e){return e.isPropertyChanged()})},setSelection:function(e,t,i){e||(e=[]),e instanceof Array||(e=[e]),e=e.findAll(function(e){return e&&e instanceof ORYX.Core.Shape}),e[0]instanceof ORYX.Core.Canvas&&(e=[]),(i||!this.isEqual(this.selection,e)||this.isDirty(e))&&(this.selection=e,this._subSelection=t,this.handleEvents({type:ORYX.CONFIG.EVENT_SELECTION_CHANGED,elements:e,subSelection:t,force:!!i}))},updateSelection:function(){this.setSelection(this.selection,this._subSelection,!0)},getCanvas:function(){return this._canvas},createShape:function(e){if(e&&e.serialize&&e.serialize instanceof Array){var t=e.serialize.find(function(e){return"oryx-type"==e.prefix+"-"+e.name}),i=ORYX.Core.StencilSet.stencil(t.value);if("node"==i.type())var o=new ORYX.Core.Node({eventHandlerCallback:this.handleEvents.bind(this)},i,this._getPluginFacade());else var o=new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},i,this._getPluginFacade());return this.getCanvas().add(o),o.deserialize(e.serialize),o}if(!e||!e.type||!e.namespace)throw"To create a new shape you have to give an argument with type and namespace";var o,n=this.getCanvas(),r=e.type,a=ORYX.Core.StencilSet.stencilSet(e.namespace);o="node"==a.stencil(r).type()?new ORYX.Core.Node({eventHandlerCallback:this.handleEvents.bind(this)},a.stencil(r),this._getPluginFacade()):new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},a.stencil(r),this._getPluginFacade()),e.template&&(o._jsonStencil.properties=e.template._jsonStencil.properties,o.postProcessProperties()),e.parent&&o instanceof ORYX.Core.Node?e.parent.add(o):n.add(o);var s,l=e.position?e.position:{x:100,y:200};if(e.connectingType&&e.connectedShape&&!(o instanceof ORYX.Core.Edge)){s=new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},a.stencil(e.connectingType)),s.dockers.first().setDockedShape(e.connectedShape);var d=e.connectedShape.getDefaultMagnet(),c=d?d.bounds.center():e.connectedShape.bounds.midPoint();s.dockers.first().setReferencePoint(c),s.dockers.last().setDockedShape(o),s.dockers.last().setReferencePoint(o.getDefaultMagnet().bounds.center()),n.add(s)}if(o instanceof ORYX.Core.Edge&&e.connectedShape){o.dockers.first().setDockedShape(e.connectedShape),e.connectedShape instanceof ORYX.Core.Node?(o.dockers.first().setReferencePoint(e.connectedShape.getDefaultMagnet().bounds.center()),o.dockers.last().bounds.centerMoveTo(l)):o.dockers.first().setReferencePoint(e.connectedShape.bounds.midPoint());var p=o.dockers.first(),u=o.dockers.last();if(p.getDockedShape()&&u.getDockedShape()){var m=p.getAbsoluteReferencePoint();u.getAbsoluteReferencePoint();var h=o.createDocker();h.bounds.centerMoveTo({x:m.x+(endPont.x-m.x)/2,y:m.y+(endPont.y-m.y)/2})}}else{var f=o.bounds;o instanceof ORYX.Core.Node&&1==o.dockers.length&&(f=o.dockers.first().bounds),f.centerMoveTo(l);var g=f.upperLeft();f.moveBy(-Math.min(g.x,0),-Math.min(g.y,0));var v=f.lowerRight();f.moveBy(-Math.max(v.x-n.bounds.width(),0),-Math.max(v.y-n.bounds.height(),0))}return o instanceof ORYX.Core.Edge&&o._update(!1),o instanceof ORYX.Core.Edge||e.dontUpdateSelection||this.setSelection([o]),s&&s.alignDockers,o.alignDockers&&o.alignDockers(),o},deleteShape:function(e){e&&e.parent&&(e.parent.remove(e),e.getOutgoingShapes().each(function(t){var i=t.getDockers().first();i&&i.getDockedShape()==e&&i.setDockedShape(void 0)}),e.getIncomingShapes().each(function(t){var i=t.getDockers().last();i&&i.getDockedShape()==e&&i.setDockedShape(void 0)}),e.getDockers().each(function(e){e.setDockedShape(void 0)}))},getModelMetaData:function(){return this.modelMetaData},_executeEventImmediately:function(e){this.DOMEventListeners.keys().member(e.event.type)&&this.DOMEventListeners[e.event.type].each(function(t){t(e.event,e.arg)}.bind(this))},_executeEvents:function(){for(this._queueRunning=!0;this._eventsQueue.length>0;){var e=this._eventsQueue.shift();this._executeEventImmediately(e)}this._queueRunning=!1},handleEvents:function(e,t){switch(ORYX.Log.trace("Dispatching event type %0 on %1",e.type,t),e.type){case ORYX.CONFIG.EVENT_MOUSEDOWN:this._handleMouseDown(e,t);break;case ORYX.CONFIG.EVENT_MOUSEMOVE:this._handleMouseMove(e,t);break;case ORYX.CONFIG.EVENT_MOUSEUP:this._handleMouseUp(e,t);break;case ORYX.CONFIG.EVENT_MOUSEOVER:this._handleMouseHover(e,t);break;case ORYX.CONFIG.EVENT_MOUSEOUT:this._handleMouseOut(e,t)}return e.forceExecution?this._executeEventImmediately({event:e,arg:t}):this._eventsQueue.push({event:e,arg:t}),this._queueRunning||this._executeEvents(),!1},isValidEvent:function(e){try{var t=["INPUT","TEXTAREA"].include(e.target.tagName.toUpperCase()),i=e.target.className.include("x-grid3-focus")&&!e.target.className.include("x-grid3-focus-canvas");return!t&&!i}catch(e){return!1}},catchKeyUpEvents:function(e){if(this._keyupEnabled&&(e||(e=window.event),this.isValidEvent(e))){var t=this.createKeyCombEvent(e,ORYX.CONFIG.KEY_ACTION_UP);ORYX.Log.debug("Key Event to handle: %0",t),this.handleEvents({type:t,event:e})}},catchKeyDownEvents:function(e){if(this._keydownEnabled&&(e||(e=window.event),this.isValidEvent(e))){var t=this.createKeyCombEvent(e,ORYX.CONFIG.KEY_ACTION_DOWN);ORYX.Log.debug("Key Event to handle: %0",t),this.handleEvents({type:t,event:e})}},createKeyCombEvent:function(e,t){var i=e.which||e.keyCode,o="key.event";return t&&(o+="."+t),(e.ctrlKey||e.metaKey)&&(o+="."+ORYX.CONFIG.META_KEY_META_CTRL),e.altKey&&(o+="."+ORYX.CONFIG.META_KEY_ALT),e.shiftKey&&(o+="."+ORYX.CONFIG.META_KEY_SHIFT),o+"."+i},_handleMouseDown:function(e,t){var i=this.getCanvas();i.focus();var o=e.currentTarget,n=t,r=null!==n&&void 0!==n&&n.isSelectable,a=null!==n&&void 0!==n&&n.isMovable,s=e.shiftKey||e.ctrlKey,l=0===this.selection.length,d=this.selection.member(n);if(r&&l)this.setSelection([n]),ORYX.Log.trace("Rule #1 applied for mouse down on %0",o.id);else if(!r||l||s||d)if(r&&s&&!d){var c=this.selection.clone();c.push(n),this.setSelection(c),ORYX.Log.trace("Rule #4 applied for mouse down on %0",o.id)}else if(r&&d&&s){var c=this.selection.clone();this.setSelection(c.without(n)),ORYX.Log.trace("Rule #6 applied for mouse down on %0",n.id)}else{if(!r&&!a)return this.setSelection([]),ORYX.Log.trace("Rule #2 applied for mouse down on %0",o.id),void 0;r||!a||n instanceof ORYX.Core.Controls.Docker?r&&d&&!s&&(this._subSelection=this._subSelection!=n?n:void 0,this.setSelection(this.selection,this._subSelection),ORYX.Log.trace("Rule #8 applied for mouse down on %0",o.id)):ORYX.Log.trace("Rule #7 applied for mouse down on %0",o.id)}else this.setSelection([n]),ORYX.Log.trace("Rule #3 applied for mouse down on %0",o.id)},_handleMouseMove:function(){},_handleMouseUp:function(e,t){this.getCanvas(),this.eventCoordinates(e)},_handleMouseHover:function(){},_handleMouseOut:function(){},eventCoordinates:function(e){var t=this.getCanvas(),i=t.node.ownerSVGElement.createSVGPoint();i.x=e.clientX,i.y=e.clientY;var o=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var n=navigator.userAgent;if(n.indexOf("MSIE")>=0){var r=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==r&&(o=r/100)}}1!==o&&(i.x=i.x*o,i.y=i.y*o);var a=t.node.getScreenCTM();return i.matrixTransform(a.inverse())},eventCoordinatesXY:function(e,t){var i=this.getCanvas(),o=i.node.ownerSVGElement.createSVGPoint();o.x=e,o.y=t;var n=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var r=navigator.userAgent;if(r.indexOf("MSIE")>=0){var a=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==a&&(n=a/100)}}1!==n&&(o.x=o.x*n,o.y=o.y*n);var s=i.node.getScreenCTM();return o.matrixTransform(s.inverse())}},ORYX.Editor=Clazz.extend(ORYX.Editor),ORYX.Editor.createByUrl=function(e){new Ajax.Request(e,{method:"GET",onSuccess:function(e){var t=JSON.parse(e.responseText);new ORYX.Editor(t)}.bind(this)})},ORYX.Editor.graft=function(e,t,i,o){o=o||t&&t.ownerDocument||document;var n;if(void 0===i)throw"Can't graft an undefined value";if(i.constructor==String)n=o.createTextNode(i);else for(var r=0;i.length>r;r++){if(0===r&&i[r].constructor==String){var a;if(a=i[r].match(/^([a-z][a-z0-9]*)\.([^\s\.]+)$/i)){n=o.createElementNS(e,a[1]),n.setAttributeNS(null,"class",a[2]);continue}if(a=i[r].match(/^([a-z][a-z0-9]*)$/i)){n=o.createElementNS(e,a[1]);continue}n=o.createElementNS(e,"span"),n.setAttribute(null,"class","namelessFromLOL")}if(void 0===i[r])throw"Can't graft an undefined value in a list!";if(i[r].constructor==String||i[r].constructor==Array)this.graft(e,n,i[r],o);else if(i[r].constructor==Number)this.graft(e,n,""+i[r],o);else if(i[r].constructor==Object)for(var s in i[r])n.setAttributeNS(null,s,i[r][s])}return t&&t.appendChild&&t.appendChild(n),n},ORYX.Editor.provideId=function(){for(var e=[],t="0123456789ABCDEF",i=0;36>i;i++)e[i]=Math.floor(16*Math.random());e[14]=4,e[19]=8|3&e[19];for(var i=0;36>i;i++)e[i]=t[e[i]];return e[8]=e[13]=e[18]=e[23]="-","oryx_"+e.join("")},ORYX.Editor.resizeFix=function(){ORYX.Editor._resizeFixTimeout||(ORYX.Editor._resizeFixTimeout=window.setTimeout(function(){window.resizeBy(1,1),window.resizeBy(-1,-1),ORYX.Editor._resizefixTimeout=null},100))},ORYX.Editor.Cookie={callbacks:[],onChange:function(e,t){this.callbacks.push(e),this.start(t)},start:function(e){if(!this.pe){var t=document.cookie;this.pe=new PeriodicalExecuter(function(){t!=document.cookie&&(t=document.cookie,this.callbacks.each(function(e){e(this.getParams())}.bind(this)))}.bind(this),(e||1e4)/1e3)}},stop:function(){this.pe&&(this.pe.stop(),this.pe=null)},getParams:function(){var e={},t=document.cookie;return t.split("; ").each(function(t){e[t.split("=")[0]]=t.split("=")[1]}),e},toString:function(){return document.cookie}},ORYX.Editor.SVGClassElementsAreAvailable=!0,ORYX.Editor.setMissingClasses=function(){try{}catch(e){ORYX.Editor.SVGClassElementsAreAvailable=!1,SVGSVGElement=""+document.createElementNS("http://www.w3.org/2000/svg","svg"),SVGGElement=""+document.createElementNS("http://www.w3.org/2000/svg","g"),SVGPathElement=""+document.createElementNS("http://www.w3.org/2000/svg","path"),SVGTextElement=""+document.createElementNS("http://www.w3.org/2000/svg","text"),SVGRectElement=""+document.createElementNS("http://www.w3.org/2000/svg","rect"),SVGImageElement=""+document.createElementNS("http://www.w3.org/2000/svg","image"),SVGCircleElement=""+document.createElementNS("http://www.w3.org/2000/svg","circle"),SVGEllipseElement=""+document.createElementNS("http://www.w3.org/2000/svg","ellipse"),SVGLineElement=""+document.createElementNS("http://www.w3.org/2000/svg","line"),SVGPolylineElement=""+document.createElementNS("http://www.w3.org/2000/svg","polyline"),SVGPolygonElement=""+document.createElementNS("http://www.w3.org/2000/svg","polygon")}},ORYX.Editor.checkClassType=function(e,t){return ORYX.Editor.SVGClassElementsAreAvailable?e instanceof t:e==t},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),new function(){ORYX.Core.UIEnableDrag=function(e,t,i){this.uiObj=t;var o=t.bounds.upperLeft(),n=t.node.getScreenCTM();this.faktorXY={x:n.a,y:n.d},this.scrollNode=t.node.ownerSVGElement.parentNode.parentNode,this.offSetPosition={x:Event.pointerX(e)-o.x*this.faktorXY.x,y:Event.pointerY(e)-o.y*this.faktorXY.y},this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop},this.dragCallback=ORYX.Core.UIDragCallback.bind(this),this.disableCallback=ORYX.Core.UIDisableDrag.bind(this),this.movedCallback=i?i.movedCallback:void 0,this.upCallback=i?i.upCallback:void 0,document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.disableCallback,!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.dragCallback,!1)},ORYX.Core.UIDragCallback=function(e){var t={x:Event.pointerX(e)-this.offSetPosition.x,y:Event.pointerY(e)-this.offSetPosition.y};t.x-=this.offsetScroll.x-this.scrollNode.scrollLeft,t.y-=this.offsetScroll.y-this.scrollNode.scrollTop,t.x/=this.faktorXY.x,t.y/=this.faktorXY.y,this.uiObj.bounds.moveTo(t),this.movedCallback&&this.movedCallback(e)},ORYX.Core.UIDisableDrag=function(e){document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.dragCallback,!1),document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.disableCallback,!0),this.upCallback&&this.upCallback(e),this.upCallback=void 0,this.movedCallback=void 0,Event.stop(e)},ORYX.Core.MoveDockersCommand=ORYX.Core.Command.extend({construct:function(e){this.dockers=$H(e),this.edges=$H({})},execute:function(){return this.changes?(this.executeAgain(),void 0):(this.changes=$H({}),this.dockers.values().each(function(e){var t=e.docker.parent;t&&(this.changes[t.getId()]||(this.changes[t.getId()]={edge:t,oldDockerPositions:t.dockers.map(function(e){return e.bounds.center()})}),e.docker.bounds.moveBy(e.offset),this.edges[t.getId()]=t,e.docker.update())}.bind(this)),this.edges.each(function(e){this.updateEdge(e.value),this.changes[e.value.getId()]&&(this.changes[e.value.getId()].dockerPositions=e.value.dockers.map(function(e){return e.bounds.center()}))}.bind(this)),void 0)},updateEdge:function(e){e._update(!0),[e.getOutgoingShapes(),e.getIncomingShapes()].flatten().invoke("_update",[!0])},executeAgain:function(){this.changes.values().each(function(e){this.removeAllDocker(e.edge),e.dockerPositions.each(function(t,i){if(0!=i&&i!=e.dockerPositions.length-1){var o=e.edge.createDocker(void 0,t);o.bounds.centerMoveTo(t),o.update()}}.bind(this)),this.updateEdge(e.edge)}.bind(this))},rollback:function(){this.changes.values().each(function(e){this.removeAllDocker(e.edge),e.oldDockerPositions.each(function(t,i){if(0!=i&&i!=e.oldDockerPositions.length-1){var o=e.edge.createDocker(void 0,t);o.bounds.centerMoveTo(t),o.update()}}.bind(this)),this.updateEdge(e.edge)}.bind(this))},removeAllDocker:function(e){e.dockers.slice(1,e.dockers.length-1).each(function(t){e.removeDocker(t)})}})},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Shape={construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this.facade=i,this.dockers=[],this.magnets=[],this._defaultMagnet,this.incoming=[],this.outgoing=[],this.nodes=[],this._dockerChangedCallback=this._dockerChanged.bind(this),this._labels=new Hash,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g",{id:"svg-"+this.resourceId},["g",{"class":"stencils"},["g",{"class":"me"}],["g",{"class":"children",style:"overflow:hidden"}],["g",{"class":"edge"}]],["g",{"class":"controls"},["g",{"class":"dockers"}],["g",{"class":"magnets"}]]])},update:function(){},_update:function(){},refresh:function(){arguments.callee.$.refresh.apply(this,arguments),this.node.ownerDocument&&(this.propertiesChanged.each(function(e){if(e.value)if("activiti-bpmn-disable-compensation"===e.key){var t=this.node.ownerDocument.getElementById(this.id+"compensation");t&&t.ownerSVGElement&&t.setAttributeNS(null,"display","none")}else if("activiti-bpmn-disable-multiinstance"===e.key){var i=this.node.ownerDocument.getElementById(this.id+"parallel");i&&i.setAttributeNS(null,"display","none");var o=this.node.ownerDocument.getElementById(this.id+"sequential");o&&o.setAttributeNS(null,"display","none")}else{var n=this.properties[e.key],r=this.getStencil().property(e.key);if(void 0!=r)if(this.propertiesChanged[e.key]=!1,r.type()==ORYX.CONFIG.TYPE_CHOICE){r.refToView().each(function(e){if(""!==e){var t=this._labels[this.id+e];t&&r.item(n)&&t.text(r.item(n).title())}}.bind(this));var a=new Hash;r.items().each(function(e){e.refToView().each(function(t){if(""!=t){var i=this.node.ownerDocument.getElementById(this.id+t);i&&(a[i.id]&&n!=e.value()||(i.setAttributeNS(null,"display",n==e.value()?"inherit":"none"),a[i.id]=i),ORYX.Editor.checkClassType(i,SVGImageElement)&&i.setAttributeNS("http://www.w3.org/1999/xlink","href",i.getAttributeNS("http://www.w3.org/1999/xlink","href")))}}.bind(this))}.bind(this))}else r.refToView().each(function(e){if(""!==e){var t=this.id+e;if(r.type()!==ORYX.CONFIG.TYPE_KISBPM_MULTIINSTANCE){if("cancelactivity"===r.type()){var i=this.node.ownerDocument.getElementById(this.id+"frame"),o=this.node.ownerDocument.getElementById(this.id+"frame2");
"true"===n?(i.setAttributeNS(null,"display","inherit"),o.setAttributeNS(null,"display","inherit")):(i.setAttributeNS(null,"display","none"),o.setAttributeNS(null,"display","none"))}var a=this.node.ownerDocument.getElementById(t);if(!a||!a.ownerSVGElement){if(r.type()!==ORYX.CONFIG.TYPE_URL&&r.type()!==ORYX.CONFIG.TYPE_DIAGRAM_LINK)return;var s=this.node.ownerDocument.getElementsByTagNameNS("http://www.w3.org/2000/svg","a");if(a=$A(s).find(function(e){return e.getAttributeNS(null,"id")===t}),!a)return}if(r.complexAttributeToView()){var l=this._labels[t];if(l)try{propJson=n.evalJSON();var d=propJson[r.complexAttributeToView()];l.text(d?d:n)}catch(c){l.text(n)}}else switch(r.type()){case ORYX.CONFIG.TYPE_BOOLEAN:"string"==typeof n&&(n="true"===n),a.setAttributeNS(null,"display",n!==r.inverseBoolean()?"inherit":"none");break;case ORYX.CONFIG.TYPE_COLOR:r.fill()&&("stop"===a.tagName.toLowerCase()?(n&&(r.lightness()&&1!==r.lightness()&&(n=ORYX.Utils.adjustLightness(n,r.lightness())),a.setAttributeNS(null,"stop-color",n),"radialgradient"===a.parentNode.tagName.toLowerCase()&&ORYX.Utils.adjustGradient(a.parentNode,a)),"radialgradient"===a.parentNode.tagName.toLowerCase()&&$A(a.parentNode.getElementsByTagName("stop")).each(function(e){e.setAttributeNS(null,"stop-opacity",n?e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"default-stop-opacity")||1:0)}.bind(this))):a.setAttributeNS(null,"fill",n)),r.stroke()&&a.setAttributeNS(null,"stroke",n);break;case ORYX.CONFIG.TYPE_STRING:var l=this._labels[t];l&&l.text(n);break;case ORYX.CONFIG.TYPE_EXPRESSION:var l=this._labels[t];l&&l.text(n);break;case ORYX.CONFIG.TYPE_DATASOURCE:var l=this._labels[t];l&&l.text(n);break;case ORYX.CONFIG.TYPE_INTEGER:var l=this._labels[t];l&&l.text(n);break;case ORYX.CONFIG.TYPE_FLOAT:if(r.fillOpacity()&&a.setAttributeNS(null,"fill-opacity",n),r.strokeOpacity()&&a.setAttributeNS(null,"stroke-opacity",n),!r.fillOpacity()&&!r.strokeOpacity()){var l=this._labels[t];l&&l.text(n)}break;case ORYX.CONFIG.TYPE_SUB_PROCESS_LINK:if("subprocesslink"==e){var p=a.getAttributeNodeNS("","onclick"),u=a.getAttributeNodeNS("","style");p&&(n&&n.id?(u&&(u.textContent="cursor:pointer;"),p.textContent="KISBPM.TOOLBAR.ACTIONS.navigateToProcess("+n.id+");return false;"):(u&&(u.textContent="cursor:default;"),p.textContent="return false;"))}break;case ORYX.CONFIG.TYPE_URL:}}else if("multiinstance"===e){var m=this.node.ownerDocument.getElementById(this.id+"parallel");m&&("Parallel"===n?m.setAttributeNS(null,"display","inherit"):m.setAttributeNS(null,"display","none"));var h=this.node.ownerDocument.getElementById(this.id+"sequential");h&&("Sequential"===n?h.setAttributeNS(null,"display","inherit"):h.setAttributeNS(null,"display","none"))}}}.bind(this))}}.bind(this)),this._labels.values().each(function(e){e.update()}))},layout:function(){var e=this.getStencil().layout();e&&e.each(function(e){e.shape=this,e.forceExecution=!0,this._delegateEvent(e)}.bind(this))},getLabels:function(){return this._labels.values()},getLabel:function(e){return e?(this._labels.find(function(t){return t.key.endsWith(e)})||{}).value||null:null},hideLabels:function(){this.getLabels().invoke("hide")},showLabels:function(){var e=this.getLabels();e.invoke("show"),e.each(function(e){e.update()})},setOpacity:function(e){e=Math.max(Math.min("number"==typeof e?e:1,1),0),1!==e?(e+="",this.node.setAttributeNS(null,"fill-opacity",e),this.node.setAttributeNS(null,"stroke-opacity",e)):(this.node.removeAttributeNS(null,"fill-opacity"),this.node.removeAttributeNS(null,"stroke-opacity"))},getDockers:function(){return this.dockers},getMagnets:function(){return this.magnets},getDefaultMagnet:function(){return this._defaultMagnet?this._defaultMagnet:this.magnets.length>0?this.magnets[0]:void 0},getParentShape:function(){return this.parent},getIncomingShapes:function(e){return e&&this.incoming.each(e),this.incoming},getIncomingNodes:function(e){return this.incoming.select(function(t){var i=t instanceof ORYX.Core.Node;return i&&e&&e(t),i})},getOutgoingShapes:function(e){return e&&this.outgoing.each(e),this.outgoing},getOutgoingNodes:function(e){return this.outgoing.select(function(t){var i=t instanceof ORYX.Core.Node;return i&&e&&e(t),i})},getAllDockedShapes:function(e){var t=this.incoming.concat(this.outgoing);return e&&t.each(e),t},getCanvas:function(){return this.parent instanceof ORYX.Core.Canvas?this.parent:this.parent instanceof ORYX.Core.Shape?this.parent.getCanvas():void 0},getChildNodes:function(e,t){if(e||t){var i=[];return this.nodes.each(function(o){o.isVisible&&(t&&t(o),i.push(o),e&&o instanceof ORYX.Core.Shape&&(i=i.concat(o.getChildNodes(e,t))))}),i}return this.nodes.clone()},add:function(e,t,i){if(e instanceof ORYX.Core.UIObject&&!(e instanceof ORYX.Core.Edge))if(this.children.member(e))ORYX.Log.warn("add: ORYX.Core.UIObject is already a child of this object.");else{e.parent&&e.parent.remove(e,!0),void 0!=t?this.children.splice(t,0,e):this.children.push(e),e.parent=this;var o;if(e instanceof ORYX.Core.Node)o=this.node.childNodes[0].childNodes[1],this.nodes.push(e);else if(e instanceof ORYX.Core.Controls.Control){var n=this.node.childNodes[1];e instanceof ORYX.Core.Controls.Docker?(o=n.childNodes[0],this.dockers.length>=2?this.dockers.splice(void 0!==t?Math.min(t,this.dockers.length-1):this.dockers.length-1,0,e):this.dockers.push(e)):e instanceof ORYX.Core.Controls.Magnet?(o=n.childNodes[1],this.magnets.push(e)):o=n}else o=this.node;e.node=void 0!=t&&o.childNodes.length>t?o.insertBefore(e.node,o.childNodes[t]):o.appendChild(e.node),this._changed(),this.eventHandlerCallback&&i!==!0&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEADDED,shape:e})}else ORYX.Log.warn("add: Parameter is not of type ORYX.Core.UIObject.")},remove:function(e,t){if(this.children.member(e)){var i=e.parent;this.children=this.children.without(e),e.parent=void 0,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.removeMarkers(),e.node=this.node.childNodes[0].childNodes[2].removeChild(e.node)):(e.node=this.node.childNodes[0].childNodes[1].removeChild(e.node),this.nodes=this.nodes.without(e)):e instanceof ORYX.Core.Controls.Control&&(e instanceof ORYX.Core.Controls.Docker?(e.node=this.node.childNodes[1].childNodes[0].removeChild(e.node),this.dockers=this.dockers.without(e)):e instanceof ORYX.Core.Controls.Magnet?(e.node=this.node.childNodes[1].childNodes[1].removeChild(e.node),this.magnets=this.magnets.without(e)):e.node=this.node.childNodes[1].removeChild(e.node)),this.eventHandlerCallback&&t!==!0&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEREMOVED,shape:e,parent:i}),this._changed()}else ORYX.Log.warn("remove: ORYX.Core.UIObject is not a child of this object.")},getIntersectionPoint:function(){var e,t,i,o;switch(arguments.length){case 2:e=arguments[0].x,t=arguments[0].y,i=arguments[1].x,o=arguments[1].y;break;case 4:e=arguments[0],t=arguments[1],i=arguments[2],o=arguments[3];break;default:throw"getIntersectionPoints needs two or four arguments"}var n,r,a,s,l=this.absoluteBounds();if(this.isPointIncluded(e,t,l)?(n=e,r=t):(a=e,s=t),this.isPointIncluded(i,o,l)?(n=i,r=o):(a=i,s=o),!(n&&r&&a&&s))return void 0;for(var d,c,p=0,u=0;;){var p=Math.min(n,a)+(Math.max(n,a)-Math.min(n,a))/2,u=Math.min(r,s)+(Math.max(r,s)-Math.min(r,s))/2;this.isPointIncluded(p,u,l)?(n=p,r=u):(a=p,s=u);var m=Math.sqrt(Math.pow(n-a,2)+Math.pow(r-s,2));if(d=n+(a-n)/m,c=r+(s-r)/m,!this.isPointIncluded(d,c,l))break}return{x:d,y:c}},isPointIncluded:function(){return!1},containsNode:function(e){for(var t=this.node.firstChild.firstChild;e;){if(e==t)return!0;e=e.parentNode}return!1},isPointOverOffset:function(){return this.isPointIncluded.apply(this,arguments)},_dockerChanged:function(){},createDocker:function(e,t){var i=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});return i.bounds.registerCallback(this._dockerChangedCallback),t&&i.bounds.centerMoveTo(t),this.add(i,e),i},serialize:function(){var e=arguments.callee.$.serialize.apply(this);return e.push({name:"bounds",prefix:"oryx",value:this.bounds.serializeForERDF(),type:"literal"}),this.getOutgoingShapes().each(function(t){e.push({name:"outgoing",prefix:"raziel",value:"#"+ERDF.__stripHashes(t.resourceId),type:"resource"})}.bind(this)),e.push({name:"parent",prefix:"raziel",value:"#"+ERDF.__stripHashes(this.parent.resourceId),type:"resource"}),e},deserialize:function(e,t){arguments.callee.$.deserialize.apply(this,arguments);var i=e.find(function(e){return"oryx-bounds"==e.prefix+"-"+e.name});if(i){var o=i.value.replace(/,/g," ").split(" ").without("");this instanceof ORYX.Core.Edge?(this.dockers.first().isChanged||this.dockers.first().bounds.centerMoveTo(parseFloat(o[0]),parseFloat(o[1])),this.dockers.last().isChanged||this.dockers.last().bounds.centerMoveTo(parseFloat(o[2]),parseFloat(o[3]))):this.bounds.set(parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]))}t&&t.labels instanceof Array&&t.labels.each(function(e){var t=this.getLabel(e.ref);t&&t.deserialize(e,this)}.bind(this))},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments),t=[],i=this.id;return this._labels.each(function(e){var o=e.value.serialize();o&&(o.ref=e.key.replace(i,""),t.push(o))}),t.length>0&&(e.labels=t),e},_init:function(e){this._adjustIds(e,0)},_adjustIds:function(e,t){if(e instanceof Element){var i=e.getAttributeNS(null,"id");i&&""!==i?e.setAttributeNS(null,"id",this.id+i):(e.setAttributeNS(null,"id",this.id+"_"+this.id+"_"+t),t++);var o=e.getAttributeNS(null,"fill");if(o&&o.include("url(#")&&(o=o.replace(/url\(#/g,"url(#"+this.id),e.setAttributeNS(null,"fill",o)),e.hasChildNodes())for(var n=0;e.childNodes.length>n;n++)t=this._adjustIds(e.childNodes[n],t)}return t},toString:function(){return"ORYX.Core.Shape "+this.getId()}},ORYX.Core.Shape=ORYX.Core.AbstractShape.extend(ORYX.Core.Shape),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Control=ORYX.Core.UIObject.extend({toString:function(){return"Control "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Docker=ORYX.Core.Controls.Control.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.isMovable=!0,this.bounds.set(0,0,16,16),this.referencePoint=void 0,this._dockedShapeBounds=void 0,this._dockedShape=void 0,this._oldRefPoint1=void 0,this._oldRefPoint2=void 0,this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g"]),this._dockerNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["g",{"pointer-events":"all"},["circle",{cx:"8",cy:"8",r:"8",stroke:"none",fill:"none"}],["circle",{cx:"8",cy:"8",r:"3",stroke:"black",fill:"red","stroke-width":"1"}]]),this._referencePointNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["g",{"pointer-events":"none"},["circle",{cx:this.bounds.upperLeft().x,cy:this.bounds.upperLeft().y,r:3,fill:"red","fill-opacity":.4}]]),this.hide(),this.addEventHandlers(this._dockerNode),this._updateCallback=this._changed.bind(this)},update:function(){if(this._dockedShape){if(this._dockedShapeBounds&&this._dockedShape instanceof ORYX.Core.Node){var e=this._dockedShapeBounds.width(),t=this._dockedShapeBounds.height();e||(e=1),t||(t=1);var i=this._dockedShape.bounds.width()/e,o=this._dockedShape.bounds.height()/t;(1!==i||1!==o)&&(this.referencePoint.x*=i,this.referencePoint.y*=o),this._dockedShapeBounds=this._dockedShape.bounds.clone()}var n=this.parent.dockers.indexOf(this),r=this,a=this.parent.dockers.length>1?0===n?this.parent.dockers[n+1]:this.parent.dockers[n-1]:void 0,s=r.getDockedShape()?r.getAbsoluteReferencePoint():r.bounds.center(),l=a&&a.getDockedShape()?a.getAbsoluteReferencePoint():a?a.bounds.center():void 0;if(!l){var d=this._dockedShape.absoluteCenterXY(),c=this._dockedShape.bounds.width()*this._dockedShape.bounds.height();l={x:s.x+(d.x-s.x)*-c,y:s.y+(d.y-s.y)*-c}}var p=void 0;if(p=this._dockedShape.getIntersectionPoint(s,l),p||(p=this.getAbsoluteReferencePoint()),this.parent&&this.parent.parent){var u=this.parent.parent.absoluteXY();p.x-=u.x,p.y-=u.y}this.bounds.centerMoveTo(p),this._oldRefPoint1=s,this._oldRefPoint2=l}arguments.callee.$.update.apply(this,arguments)},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft();if(this._dockerNode.setAttributeNS(null,"transform","translate("+e.x+", "+e.y+")"),e=Object.clone(this.referencePoint),e&&this._dockedShape){var t;t=this.parent instanceof ORYX.Core.Edge?this._dockedShape.absoluteXY():this._dockedShape.bounds.upperLeft(),e.x+=t.x,e.y+=t.y}else e=this.bounds.center();this._referencePointNode.setAttributeNS(null,"transform","translate("+e.x+", "+e.y+")")},setReferencePoint:function(e){this.referencePoint===e||this.referencePoint&&e&&this.referencePoint.x===e.x&&this.referencePoint.y===e.y||(this.referencePoint=e,this._changed())},getAbsoluteReferencePoint:function(){if(this.referencePoint&&this._dockedShape){var e=this._dockedShape.absoluteXY();return{x:this.referencePoint.x+e.x,y:this.referencePoint.y+e.y}}return void 0},setDockedShape:function(e){this._dockedShape&&(this._dockedShape.bounds.unregisterCallback(this._updateCallback),this===this.parent.dockers.first()?(this.parent.incoming=this.parent.incoming.without(this._dockedShape),this._dockedShape.outgoing=this._dockedShape.outgoing.without(this.parent)):this===this.parent.dockers.last()&&(this.parent.outgoing=this.parent.outgoing.without(this._dockedShape),this._dockedShape.incoming=this._dockedShape.incoming.without(this.parent))),this._dockedShape=e,this._dockedShapeBounds=void 0;var t=void 0;if(this._dockedShape){this===this.parent.dockers.first()?(this.parent.incoming.push(e),e.outgoing.push(this.parent)):this===this.parent.dockers.last()&&(this.parent.outgoing.push(e),e.incoming.push(this.parent));var i=this.bounds,o=e.absoluteXY();t={x:i.center().x-o.x,y:i.center().y-o.y},this._dockedShapeBounds=this._dockedShape.bounds.clone(),this._dockedShape.bounds.registerCallback(this._updateCallback),this.setDockerColor(ORYX.CONFIG.DOCKER_DOCKED_COLOR)}else this.setDockerColor(ORYX.CONFIG.DOCKER_UNDOCKED_COLOR);this.setReferencePoint(t),this._changed()},getDockedShape:function(){return this._dockedShape},isDocked:function(){return!!this._dockedShape},setDockerColor:function(e){this._dockerNode.lastChild.setAttributeNS(null,"fill",e)},preventHiding:function(e){this._preventHiding=Math.max(0,(this._preventHiding||0)+(e?1:-1))},hide:function(){return this._preventHiding?!1:(this.node.setAttributeNS(null,"visibility","hidden"),this._referencePointNode.setAttributeNS(null,"visibility","hidden"),this.children.each(function(e){e.hide()}),void 0)},show:function(){this.node.setAttributeNS(null,"visibility","visible"),this.getDockedShape()instanceof ORYX.Core.Edge?this._referencePointNode.setAttributeNS(null,"visibility","hidden"):this._referencePointNode.setAttributeNS(null,"visibility","visible"),this.children.each(function(e){e.show()})},toString:function(){return"Docker "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Magnet=ORYX.Core.Controls.Control.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this.bounds.set(0,0,16,16),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g",{"pointer-events":"all"},["circle",{cx:"8",cy:"8",r:"4",stroke:"none",fill:"red","fill-opacity":"0.3"}]]),this.hide()},update:function(){arguments.callee.$.update.apply(this,arguments)},_update:function(){arguments.callee.$.update.apply(this,arguments)},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft();this.node.setAttributeNS(null,"transform","translate("+e.x+", "+e.y+")")},show:function(){arguments.callee.$.show.apply(this,arguments)},toString:function(){return"Magnet "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Node={construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this.isSelectable=!0,this.isMovable=!0,this._dockerUpdated=!1,this.facade=i,this._oldBounds=new ORYX.Core.Bounds,this._svgShapes=[],this.minimumSize=void 0,this.maximumSize=void 0,this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1,this.dataId=void 0,this._init(this._stencil.view()),this.forcedHeight=-1},_update:function(){if(this.dockers.invoke("update"),this.isChanged){var e=this.bounds,t=this._oldBounds;if(this.isResized){var i=e.width()/t.width(),o=e.height()/t.height();this._svgShapes.each(function(n){n.isHorizontallyResizable&&(n.width=n.oldWidth*i),n.isVerticallyResizable&&(n.height=n.oldHeight*o);var r,a=n.anchorLeft,s=n.anchorRight;s?(r=t.width()-(n.oldX+n.oldWidth),a?n.width=e.width()-n.x-r:n.x=e.width()-(r+n.width)):a||(n.x=i*n.oldX,n.isHorizontallyResizable||(n.x=n.x+n.width*i/2-n.width/2));var l=n.anchorTop,d=n.anchorBottom;d?(r=t.height()-(n.oldY+n.oldHeight),l?n.height=e.height()-n.y-r:n._isYLocked||(n.y=e.height()-(r+n.height))):l||(n.y=o*n.oldY,n.isVerticallyResizable||(n.y=n.y+n.height*o/2-n.height/2))});var n={x:0,y:0};this.isHorizontallyResizable||e.width()===t.width()||(n.x=t.width()-e.width()),this.isVerticallyResizable||e.height()===t.height()||(n.y=t.height()-e.height()),(0!==n.x||0!==n.y)&&e.extend(n),n={x:0,y:0};var r,a;this.minimumSize&&(ORYX.Log.debug("Shape (%0)'s min size: (%1x%2)",this,this.minimumSize.width,this.minimumSize.height),r=this.minimumSize.width-e.width(),r>0&&(n.x+=r),a=this.minimumSize.height-e.height(),a>0&&(n.y+=a)),this.maximumSize&&(ORYX.Log.debug("Shape (%0)'s max size: (%1x%2)",this,this.maximumSize.width,this.maximumSize.height),r=e.width()-this.maximumSize.width,r>0&&(n.x-=r),a=e.height()-this.maximumSize.height,a>0&&(n.y-=a)),(0!==n.x||0!==n.y)&&e.extend(n);var s,l,d,c,p,u,m,i=e.width()/t.width(),o=e.height()/t.height();this.magnets.each(function(n){s=n.anchorLeft,l=n.anchorRight,d=n.anchorTop,c=n.anchorBottom,p=n.bounds.center(),u=s?p.x:l?e.width()-(t.width()-p.x):p.x*i,m=d?p.y:c?e.height()-(t.height()-p.y):p.y*o,(p.x!==u||p.y!==m)&&n.bounds.centerMoveTo(u,m)}),this.getLabels().each(function(n){n.isAnchorLeft()||(n.isAnchorRight()?n.setX(e.width()-(t.width()-n.oldX)):n.setX((n.position?n.position.x:n.x)*i)),n.isAnchorTop()||(n.isAnchorBottom()?n.setY(e.height()-(t.height()-n.oldY)):n.setY((n.position?n.position.y:n.y)*o)),n.position&&(n.isOriginAnchorLeft()||(n.isOriginAnchorRight()?n.setOriginX(e.width()-(t.width()-n.oldX)):n.setOriginX(n.x*i)),n.isOriginAnchorTop()||(n.isOriginAnchorBottom()?n.setOriginY(e.height()-(t.height()-n.oldY)):n.setOriginY(n.y*o)))});var h=this.dockers[0];h&&(h.bounds.unregisterCallback(this._dockerChangedCallback),this._dockerUpdated||(h.bounds.centerMoveTo(this.bounds.center()),this._dockerUpdated=!1),h.update(),h.bounds.registerCallback(this._dockerChangedCallback)),this.isResized=!1}this.refresh(),this.isChanged=!1,this._oldBounds=this.bounds.clone()}this.children.each(function(e){e instanceof ORYX.Core.Controls.Docker||e._update()}),this.dockers.length>0&&!this.dockers.first().getDockedShape()&&this.dockers.each(function(e){e.bounds.centerMoveTo(this.bounds.center())}.bind(this))},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft().x,t=this.bounds.upperLeft().y;this.node.firstChild.setAttributeNS(null,"transform","translate("+e+", "+t+")"),this.node.childNodes[1].childNodes[1].setAttributeNS(null,"transform","translate("+e+", "+t+")"),this._svgShapes.each(function(e){e.update()})},_dockerChanged:function(){var e=this.dockers[0];this.bounds.centerMoveTo(e.bounds.center()),this._dockerUpdated=!0},_initSVGShapes:function(e){var t=[];try{var i=new ORYX.Core.SVG.SVGShape(e);t.push(i)}catch(o){}if(e.hasChildNodes())for(var n=0;e.childNodes.length>n;n++)t=t.concat(this._initSVGShapes(e.childNodes[n]));return t},isPointIncluded:function(e,t,i){var o=i&&i instanceof ORYX.Core.Bounds?i:this.absoluteBounds();if(!o.isIncluded(e,t))return!1;var n=o.upperLeft(),r=e-n.x,a=t-n.y,s=0;do var l=this._svgShapes[s++].isPointIncluded(r,a);while(!l&&this._svgShapes.length>s);return l},isPointOverOffset:function(e,t){var i=arguments.callee.$.isPointOverOffset.apply(this,arguments);if(i){var o=this.absoluteBounds();if(o.widen(-ORYX.CONFIG.BORDER_OFFSET),!o.isIncluded(e,t))return!0}return!1},serialize:function(){var e=arguments.callee.$.serialize.apply(this);this.dockers.each(function(t){if(t.getDockedShape()){var i=t.referencePoint;i=i?i:t.bounds.center(),e.push({name:"docker",prefix:"oryx",value:$H(i).values().join(","),type:"literal"})}}.bind(this));try{var t=this.getStencil().serialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(i){}return e},deserialize:function(e){arguments.callee.$.deserialize.apply(this,arguments);try{var t=this.getStencil().deserialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(i){}var o=e.findAll(function(e){return"raziel-outgoing"==e.prefix+"-"+e.name});if(o.each(function(e){if(this.parent){var t=this.getCanvas().getChildShapeByResourceId(e.value);t&&(t instanceof ORYX.Core.Edge?(t.dockers.first().setDockedShape(this),t.dockers.first().setReferencePoint(t.dockers.first().bounds.center())):t.dockers.length>0&&t.dockers.first().setDockedShape(this))}}.bind(this)),1===this.dockers.length){var n;if(n=e.find(function(e){return"oryx-dockers"==e.prefix+"-"+e.name})){var r=n.value.replace(/,/g," ").split(" ").without("").without("#");2===r.length&&this.dockers[0].getDockedShape()?this.dockers[0].setReferencePoint({x:parseFloat(r[0]),y:parseFloat(r[1])}):this.dockers[0].bounds.centerMoveTo(parseFloat(r[0]),parseFloat(r[1]))}}},_init:function(e){arguments.callee.$._init.apply(this,arguments);var t=e.getElementsByTagName("g")[0],i=e.ownerDocument.createAttribute("id");i.nodeValue=this.id,t.setAttributeNode(i);var o=this.node.childNodes[0].childNodes[0];t=o.appendChild(t),this.addEventHandlers(t.parentNode);var n=t.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"minimumSize");if(n){n=n.replace("/,/g"," ");var r=n.split(" ");r=r.without(""),this.minimumSize=r.length>1?{width:parseFloat(r[0]),height:parseFloat(r[1])}:{width:1,height:1}}var a=t.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"maximumSize");if(a){a=a.replace("/,/g"," ");var s=a.split(" ");s=s.without(""),s.length>1&&(this.maximumSize={width:parseFloat(s[0]),height:parseFloat(s[1])})}if(this.minimumSize&&this.maximumSize&&(this.minimumSize.width>this.maximumSize.width||this.minimumSize.height>this.maximumSize.height))throw this+": Minimum Size must be greater than maxiumSize.";this._svgShapes=this._initSVGShapes(t);var l={x:void 0,y:void 0},d={x:void 0,y:void 0},c=this;this._svgShapes.each(function(e){l.x=void 0!==l.x?Math.min(l.x,e.x):e.x,l.y=void 0!==l.y?Math.min(l.y,e.y):e.y,d.x=void 0!==d.x?Math.max(d.x,e.x+e.width):e.x+e.width,d.y=void 0!==d.y?Math.max(d.y,e.y+e.height):e.y+e.height,e.isHorizontallyResizable&&(c.isHorizontallyResizable=!0,c.isResizable=!0),e.isVerticallyResizable&&(c.isVerticallyResizable=!0,c.isResizable=!0),e.anchorTop&&e.anchorBottom&&(c.isVerticallyResizable=!0,c.isResizable=!0),e.anchorLeft&&e.anchorRight&&(c.isHorizontallyResizable=!0,c.isResizable=!0)}),this._svgShapes.each(function(e){e.x-=l.x,e.y-=l.y,e.update()});var p=l.x,u=l.y;d.x-=p,d.y-=u,l.x=0,l.y=0,0===d.x&&(d.x=1),0===d.y&&(d.y=1),this._oldBounds.set(l,d),this.bounds.set(l,d);var m=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"magnets");if(m&&m.length>0){m=$A(m[0].getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"magnet"));var c=this;m.each(function(e){var t=new ORYX.Core.Controls.Magnet({eventHandlerCallback:c.eventHandlerCallback}),i=parseFloat(e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cx")),o=parseFloat(e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cy"));t.bounds.centerMoveTo({x:i-p,y:o-u});var n=e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(n){n=n.replace("/,/g"," "),n=n.split(" ").without("");for(var r=0;n.length>r;r++)switch(n[r].toLowerCase()){case"left":t.anchorLeft=!0;break;case"right":t.anchorRight=!0;break;case"top":t.anchorTop=!0;break;case"bottom":t.anchorBottom=!0}}if(c.add(t),!this._defaultMagnet){var a=e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"default");a&&"yes"===a.toLowerCase()&&(c._defaultMagnet=t)}})}else{var h=new ORYX.Core.Controls.Magnet;h.bounds.centerMoveTo(this.bounds.width()/2,this.bounds.height()/2),this.add(h)}var f=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"docker");if(f&&f.length>0){f=f[0];var g=this.createDocker(),v=parseFloat(f.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cx")),S=parseFloat(f.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cy"));g.bounds.centerMoveTo({x:v-p,y:S-u});var I=f.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(I){I=I.replace("/,/g"," "),I=I.split(" ").without("");for(var O=0;I.length>O;O++)switch(I[O].toLowerCase()){case"left":g.anchorLeft=!0;break;case"right":g.anchorRight=!0;break;case"top":g.anchorTop=!0;break;case"bottom":g.anchorBottom=!0}}}var b=t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text");$A(b).each(function(e){var t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id});t.x-=p,t.y-=u,this._labels[t.id]=t,t.registerOnChange(this.layout.bind(this)),0==this._stencil.id().indexOf(ORYX.CONFIG.FORM_ELEMENT_ID_PREFIX)&&t.registerOnChange(this.fitToLabels.bind(this))}.bind(this))},fitToLabels:function(){var e=0;this.getLabels().each(function(t){var i=t.getY()+t.getHeight();i>e&&(e=i)});var t=this.bounds,i=!1;if(this.minimumSize){var o=this.minimumSize.height;o>e&&t.height()>o&&o>this.forcedHeight?(t.set(t.upperLeft().x,t.upperLeft().y,t.lowerRight().x,t.upperLeft().y+o),i=!0):e>o&&t.height()!=e&&e>this.forcedHeight?(t.set(t.upperLeft().x,t.upperLeft().y,t.lowerRight().x,t.upperLeft().y+e),i=!0):t.height()>this.forcedHeight&&this.forcedHeight>0&&(t.set(t.upperLeft().x,t.upperLeft().y,t.lowerRight().x,t.upperLeft().y+this.forcedHeight),i=!0)}if(i&&(null!=this.facade.getCanvas()&&this.facade.getCanvas().update(),this.facade.getSelection().member(this))){var n=this.facade.getSelection();this.facade.setSelection([]),this.facade.setSelection(n)}},createDocker:function(){var e=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});return e.bounds.registerCallback(this._dockerChangedCallback),this.dockers.push(e),e.parent=this,e.bounds.registerCallback(this._changedCallback),e},toString:function(){return this._stencil.title()+" "+this.id}},ORYX.Core.Node=ORYX.Core.Shape.extend(ORYX.Core.Node),NAMESPACE_SVG="http://www.w3.org/2000/svg",NAMESPACE_ORYX="http://www.b3mn.org/oryx",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Edge={construct:function(e,t){arguments.callee.$.construct.apply(this,arguments),this.isMovable=!0,this.isSelectable=!0,this._dockerUpdated=!1,this._markers=new Hash,this._paths=[],this._interactionPaths=[],this._dockersByPath=new Hash,this._markersByPath=new Hash,this.attachedNodePositionData=new Hash;var i=this.node.childNodes[0].childNodes[0];i=ORYX.Editor.graft("http://www.w3.org/2000/svg",i,["g",{"pointer-events":"painted"}]),this.addEventHandlers(i.parentNode),this._oldBounds=this.bounds.clone(),this._init(this._stencil.view()),t instanceof Array&&this.deserialize(t)},_update:function(e){if(this._dockerUpdated||this.isChanged||e){this.dockers.invoke("update");var t=this.bounds.upperLeft(),i=this._oldBounds.upperLeft(),o=0===this._oldBounds.width()?this.bounds.width():this._oldBounds.width(),n=0===this._oldBounds.height()?this.bounds.height():this._oldBounds.height(),r=t.x-i.x,a=t.y-i.y,s=this.bounds.width()/o||1,l=this.bounds.height()/n||1;if(this.dockers.each(function(e){if(e.bounds.unregisterCallback(this._dockerChangedCallback),!this._dockerUpdated&&(e.bounds.moveBy(r,a),1!==s||1!==l)){var i=e.bounds.upperLeft().x-t.x,o=e.bounds.upperLeft().y-t.y;e.bounds.moveTo(t.x+i*s,t.y+o*l)}e.update(),e.bounds.registerCallback(this._dockerChangedCallback)}.bind(this)),this._dockerUpdated){var d=this.dockers.first().bounds.center(),c=this.dockers.first().bounds.center();this.dockers.each(function(e){var t=e.bounds.center();d.x=Math.min(d.x,t.x),d.y=Math.min(d.y,t.y),c.x=Math.max(c.x,t.x),c.y=Math.max(c.y,t.y)}.bind(this)),this.bounds.set(Object.clone(d),Object.clone(c))}t=this.bounds.upperLeft(),i=this._oldBounds.upperLeft(),s=this.bounds.width()/(o||this.bounds.width()),l=this.bounds.height()/(n||this.bounds.height()),r=t.x-i.x,a=t.y-i.y,this.getLabels().each(function(e){if(e.getReferencePoint()){var t=e.getReferencePoint(),i=t.segment.from,o=t.segment.to;if(!(i&&i.parent&&o&&o.parent))return;var n=i.bounds.center(),d=o.bounds.center();if(n.x===t.segment.fromPosition.x&&n.y===t.segment.fromPosition.y&&d.x===t.segment.toPosition.x&&d.y===t.segment.toPosition.y&&!t.dirty)return;if(this.parent.initializingShapes){var c=ORYX.Core.Math.getOrthogonalIdentityVector(n,d);c.x*=t.distance,c.y*=t.distance,c.x+=t.intersection.x,c.y+=t.intersection.y,e.setX(c.x),e.setY(c.y),t.segment.fromPosition=n,t.segment.toPosition=d}else{var p=ORYX.Core.Math.getDistanceBetweenTwoPoints(t.segment.fromPosition,t.segment.toPosition,t.intersection),u=ORYX.Core.Math.getPointBetweenTwoPoints(n,d,isNaN(p)?.5:p),c=ORYX.Core.Math.getOrthogonalIdentityVector(n,d),m=1===Math.abs(c.y),h=1===Math.abs(c.x);c.x*=t.distance,c.y*=t.distance,c.x+=u.x,c.y+=u.y;var f=m&&t.orientation&&(t.iorientation||t.orientation).endsWith("r")?-e.getWidth():0,g=h&&t.orientation&&(t.iorientation||t.orientation).startsWith("l")?-e.getHeight()+2:0;e.setX(c.x+f),e.setY(c.y+g),this.updateReferencePointOfLabel(e,u,i,o)}}else{if(e.position&&!this.parent.initializingShapes){var v=e.position.x+r*(s||1);v>this.bounds.lowerRight().x&&(v+=this.bounds.width()-this.bounds.width()/(s||1));var S=e.position.y+a*(l||1);return S>this.bounds.lowerRight().y&&(S+=this.bounds.height()-this.bounds.height()/(l||1)),e.setX(v),e.setY(S),void 0}switch(e.getEdgePosition()){case"starttop":var I=this._getAngle(this.dockers[0],this.dockers[1]),O=this.dockers.first().bounds.center();90>=I||I>270?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=O.x+e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(360-I,O)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=O.x-e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(180-I,O));break;case"startmiddle":var I=this._getAngle(this.dockers[0],this.dockers[1]),O=this.dockers.first().bounds.center();90>=I||I>270?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=O.x+2,e.y=O.y+4,e.rotate(360-I,O)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=O.x+1,e.y=O.y+4,e.rotate(180-I,O));break;case"startbottom":var I=this._getAngle(this.dockers[0],this.dockers[1]),O=this.dockers.first().bounds.center();90>=I||I>270?(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=O.x+e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(360-I,O)):(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=O.x-e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(180-I,O));break;case"midtop":var b=this.dockers.length;if(0==b%2){var I=this._getAngle(this.dockers[b/2-1],this.dockers[b/2]),E=this.dockers[b/2-1].bounds.center(),y=this.dockers[b/2].bounds.center(),O={x:(E.x+y.x)/2,y:(E.y+y.y)/2};e.horizontalAlign("center"),e.verticalAlign("bottom"),e.x=O.x,e.y=O.y-e.getOffsetTop(),90>=I||I>270?e.rotate(360-I,O):e.rotate(180-I,O)}else{var R=parseInt(b/2),I=this._getAngle(this.dockers[R],this.dockers[R+1]),O=this.dockers[R].bounds.center();90>=I||I>270?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=O.x+e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(360-I,O)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=O.x-e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(180-I,O))}break;case"midbottom":var b=this.dockers.length;if(0==b%2){var I=this._getAngle(this.dockers[b/2-1],this.dockers[b/2]),E=this.dockers[b/2-1].bounds.center(),y=this.dockers[b/2].bounds.center(),O={x:(E.x+y.x)/2,y:(E.y+y.y)/2};
e.horizontalAlign("center"),e.verticalAlign("top"),e.x=O.x,e.y=O.y+e.getOffsetTop(),90>=I||I>270?e.rotate(360-I,O):e.rotate(180-I,O)}else{var R=parseInt(b/2),I=this._getAngle(this.dockers[R],this.dockers[R+1]),O=this.dockers[R].bounds.center();90>=I||I>270?(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=O.x+e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(360-I,O)):(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=O.x-e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(180-I,O))}break;case"endtop":var T=this.dockers.length,I=this._getAngle(this.dockers[T-2],this.dockers[T-1]),O=this.dockers.last().bounds.center();90>=I||I>270?(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=O.x-e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(360-I,O)):(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=O.x+e.getOffsetTop(),e.y=O.y-e.getOffsetTop(),e.rotate(180-I,O));break;case"endbottom":var T=this.dockers.length,I=this._getAngle(this.dockers[T-2],this.dockers[T-1]),O=this.dockers.last().bounds.center();90>=I||I>270?(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=O.x-e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(360-I,O)):(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=O.x+e.getOffsetBottom(),e.y=O.y+e.getOffsetBottom(),e.rotate(180-I,O))}}}.bind(this)),this.children.each(function(e){e instanceof ORYX.Core.Node&&this.calculatePositionOfAttachedChildNode.call(this,e)}.bind(this)),this.refreshAttachedNodes(),this.refresh(),this.isChanged=!1,this._dockerUpdated=!1,this._oldBounds=this.bounds.clone()}var p=navigator.userAgent;(-1!==navigator.appVersion.indexOf("MSIE 10")||-1!==p.indexOf("Trident")&&-1!==p.indexOf("rv:11"))&&this.node.parentNode.insertBefore(this.node,this.node)},movePointToUpperLeftOfNode:function(e,t){e.x-=t.width()/2,e.y-=t.height()/2},refreshAttachedNodes:function(){this.attachedNodePositionData.values().each(function(e){var t=e.segment.docker1.bounds.center(),i=e.segment.docker2.bounds.center();this.relativizePoint(t),this.relativizePoint(i);var o={};o.x=t.x+e.relativDistanceFromDocker1*(i.x-t.x),o.y=t.y+e.relativDistanceFromDocker1*(i.y-t.y),this.movePointToUpperLeftOfNode(o,e.node.bounds),e.node.bounds.moveTo(o),e.node._update()}.bind(this))},calculatePositionOfAttachedChildNode:function(e){var t={};t.x=0,t.y=0,this.attachedNodePositionData[e.getId()]?e.isChanged&&this.findEdgeSegmentForNode(e):(this.attachedNodePositionData[e.getId()]={},this.attachedNodePositionData[e.getId()].relativDistanceFromDocker1=0,this.attachedNodePositionData[e.getId()].node=e,this.attachedNodePositionData[e.getId()].segment={},this.findEdgeSegmentForNode(e))},findEdgeSegmentForNode:function(e){var t=this.dockers.length,o=void 0;for(i=1;t>i;i++){var n=this.dockers[i-1].bounds.center(),r=this.dockers[i].bounds.center();this.relativizePoint(n),this.relativizePoint(r);var a=e.bounds.center(),s=ORYX.Core.Math.distancePointLinie(n,r,a,!0);(s||0==s)&&(!o&&0!=o||o>s)&&(o=s,this.attachedNodePositionData[e.getId()].segment.docker1=this.dockers[i-1],this.attachedNodePositionData[e.getId()].segment.docker2=this.dockers[i]),s||o||0==o||(this.attachedNodePositionData[e.getId()].relativDistanceFromDocker1=ORYX.Core.Math.getDistancePointToPoint(a,n)<ORYX.Core.Math.getDistancePointToPoint(a,r)?0:1,this.attachedNodePositionData[e.getId()].segment.docker1=this.dockers[i-1],this.attachedNodePositionData[e.getId()].segment.docker2=this.dockers[i])}(o||0==o)&&(this.attachedNodePositionData[e.getId()].relativDistanceFromDocker1=this.getLineParameterForPosition(this.attachedNodePositionData[e.getId()].segment.docker1,this.attachedNodePositionData[e.getId()].segment.docker2,e))},findSegment:function(e){var t,o=this.dockers.length,n=e instanceof ORYX.Core.UIObject?e.bounds.center():e;for(i=1;o>i;i++){var r=this.dockers[i-1].bounds.center(),a=this.dockers[i].bounds.center(),s=ORYX.Core.Math.distancePointLinie(r,a,n,!0);"number"==typeof s&&(void 0===t||t.distance>s)&&(t={distance:s,fromDocker:this.dockers[i-1],toDocker:this.dockers[i]})}return t},getLineParameterForPosition:function(e,t,i){var o=e.bounds.center(),n=t.bounds.center();this.relativizePoint(o),this.relativizePoint(n);var r=ORYX.Core.Math.getPointOfIntersectionPointLine(o,n,i.bounds.center(),!0);if(!r)return 0;var a=ORYX.Core.Math.getDistancePointToPoint(r,o)/ORYX.Core.Math.getDistancePointToPoint(o,n);return a},relativizePoint:function(e){e.x-=this.bounds.upperLeft().x,e.y-=this.bounds.upperLeft().y},optimizedUpdate:function(){var e=function(e){if(e._dockedShape&&e._dockedShapeBounds){var t={x:e._dockedShape.bounds.a.x-e._dockedShapeBounds.a.x,y:e._dockedShape.bounds.a.y-e._dockedShapeBounds.a.y};e.bounds.moveBy(t),e._dockedShapeBounds.moveBy(t)}};e(this.dockers.first()),e(this.dockers.last()),this.refresh()},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e;if(this._paths.each(function(t,i){var o=this._dockersByPath[t.id],n=void 0,r=void 0;e?r="M"+e.x+" "+e.y:(n=o[0].bounds.center(),e=n,r="M"+n.x+" "+n.y);for(var a=1;o.length>a;a++)n=o[a].bounds.center(),r=r+"L"+n.x+" "+n.y+" ",e=n;t.setAttributeNS(null,"d",r),this._interactionPaths[i].setAttributeNS(null,"d",r)}.bind(this)),this.getChildNodes().length>0){var t=this.bounds.upperLeft().x,i=this.bounds.upperLeft().y;this.node.firstChild.childNodes[1].setAttributeNS(null,"transform","translate("+t+", "+i+")")}},getIntersectionPoint:function(){var e=Math.floor(this.dockers.length/2);return ORYX.Core.Math.midPoint(this.dockers[e-1].bounds.center(),this.dockers[e].bounds.center())},isBoundsIncluded:function(e){var t=this.dockers,i=t.length;return t.any(function(o,n){if(n==i-1)return!1;var r=o.bounds.center(),a=t[n+1].bounds.center();return ORYX.Core.Math.isRectOverLine(r.x,r.y,a.x,a.y,e.a.x,e.a.y,e.b.x,e.b.y)})},isPointIncluded:function(e,t){var i=this.absoluteBounds().isIncluded(e,t,ORYX.CONFIG.OFFSET_EDGE_BOUNDS),o=void 0;if(i&&this.dockers.length>0){var n,r,a=0;do n=this.dockers[a].bounds.center(),r=this.dockers[++a].bounds.center(),o=ORYX.Core.Math.isPointInLine(e,t,n.x,n.y,r.x,r.y,ORYX.CONFIG.OFFSET_EDGE_BOUNDS);while(!o&&this.dockers.length-1>a)}return o},isPointOverOffset:function(){return!1},containsNode:function(e){return this._paths.include(e)||this._interactionPaths.include(e)?!0:!1},_getAngle:function(e,t){var i=e instanceof ORYX.Core.Controls.Docker?e.absoluteCenterXY():e,o=t instanceof ORYX.Core.Controls.Docker?t.absoluteCenterXY():t;return ORYX.Core.Math.getAngle(i,o)},alignDockers:function(){this._update(!0);var e=this.dockers.first().bounds.center(),t=this.dockers.last().bounds.center(),i=t.x-e.x,o=t.y-e.y,n=this.dockers.length-1;this.dockers.each(function(t,r){var a=r/n;t.bounds.unregisterCallback(this._dockerChangedCallback),t.bounds.moveTo(e.x+a*i,e.y+a*o),t.bounds.registerCallback(this._dockerChangedCallback)}.bind(this)),this._dockerChanged()},add:function(e){if(arguments.callee.$.add.apply(this,arguments),e instanceof ORYX.Core.Controls.Docker&&this.dockers.include(e)){var t=this._dockersByPath.values()[0];t&&t.splice(this.dockers.indexOf(e),0,e),this.handleChildShapesAfterAddDocker(e)}},handleChildShapesAfterAddDocker:function(e){if(!e instanceof ORYX.Core.Controls.Docker)return void 0;var t=this.dockers.indexOf(e);if(!(t>0&&this.dockers.length-1>t))return void 0;var i=this.dockers[t-1],o=this.dockers[t+1],n=this.getAttachedNodePositionDataForSegment(i,o),r=ORYX.Core.Math.getDistancePointToPoint(i.bounds.center(),e.bounds.center()),a=ORYX.Core.Math.getDistancePointToPoint(o.bounds.center(),e.bounds.center());if(r+a){var s=r/(r+a);n.each(function(t){if(s>t.value.relativDistanceFromDocker1)t.value.segment.docker2=e,t.value.relativDistanceFromDocker1=t.value.relativDistanceFromDocker1/s;else{t.value.segment.docker1=e;var i=1-s,o=t.value.relativDistanceFromDocker1-s;t.value.relativDistanceFromDocker1=o/i}}),this.getLabels().each(function(t){var i=t.getReferencePoint();if(i){var o=this.dockers.indexOf(e);if(o>=i.segment.fromIndex&&i.segment.toIndex>=o){var n=this.findSegment(i.intersection);n||(n.fromDocker=i.segment.fromIndex>=this.dockers.length/2?this.dockers[0]:this.dockers[this.dockers.length-2],n.toDocker=this.dockers[this.dockers.indexOf(from)+1]);var r=n.fromDocker.bounds.center(),a=n.toDocker.bounds.center(),s=ORYX.Core.Math.getPointOfIntersectionPointLine(r,a,i.intersection,!0);this.updateReferencePointOfLabel(t,s,n.fromDocker,n.toDocker,!0)}}}.bind(this)),this.refreshAttachedNodes()}},getAttachedNodePositionDataForSegment:function(e,t){if(!(e instanceof ORYX.Core.Controls.Docker&&t instanceof ORYX.Core.Controls.Docker))return[];var i=this.attachedNodePositionData.findAll(function(i){return i.value.segment.docker1===e&&i.value.segment.docker2===t});return i?i:[]},remove:function(e){arguments.callee.$.remove.apply(this,arguments),this.attachedNodePositionData[e.getId()]&&delete this.attachedNodePositionData[e.getId()],e instanceof ORYX.Core.Controls.Docker&&this.handleChildShapesAfterRemoveDocker(e)},updateReferencePointOfLabel:function(e,t,i,o,n){if(e.getReferencePoint()&&e.isVisible){var r=e.getReferencePoint();if(r.orientation&&"ce"!==r.orientation){var a=this._getAngle(i,o);r.distance>=0?0==a?(e.horizontalAlign("left"),e.verticalAlign("bottom")):a>0&&90>a?(e.horizontalAlign("right"),e.verticalAlign("bottom")):90==a?(e.horizontalAlign("right"),e.verticalAlign("top")):a>90&&180>a?(e.horizontalAlign("right"),e.verticalAlign("top")):180==a?(e.horizontalAlign("left"),e.verticalAlign("top")):a>180&&270>a?(e.horizontalAlign("left"),e.verticalAlign("top")):270==a?(e.horizontalAlign("left"),e.verticalAlign("top")):a>270&&360>=a&&(e.horizontalAlign("left"),e.verticalAlign("bottom")):0==a?(e.horizontalAlign("left"),e.verticalAlign("top")):a>0&&90>a?(e.horizontalAlign("left"),e.verticalAlign("top")):90==a?(e.horizontalAlign("left"),e.verticalAlign("top")):a>90&&180>a?(e.horizontalAlign("left"),e.verticalAlign("bottom")):180==a?(e.horizontalAlign("left"),e.verticalAlign("bottom")):a>180&&270>a?(e.horizontalAlign("right"),e.verticalAlign("bottom")):270==a?(e.horizontalAlign("right"),e.verticalAlign("top")):a>270&&360>=a&&(e.horizontalAlign("right"),e.verticalAlign("top")),r.iorientation=r.iorientation||r.orientation,r.orientation=("top"==e.verticalAlign()?"u":"l")+("left"==e.horizontalAlign()?"l":"r")}e.setReferencePoint(jQuery.extend({},{intersection:t,segment:{from:i,fromIndex:this.dockers.indexOf(i),fromPosition:i.bounds.center(),to:o,toIndex:this.dockers.indexOf(o),toPosition:o.bounds.center()},dirty:n||!1},r))}},handleChildShapesAfterRemoveDocker:function(e){e instanceof ORYX.Core.Controls.Docker&&(this.attachedNodePositionData.each(function(t){if(t.value.segment.docker1===e){var i=this.dockers.indexOf(t.value.segment.docker2);if(-1==i)return;t.value.segment.docker1=this.dockers[i-1]}else if(t.value.segment.docker2===e){var i=this.dockers.indexOf(t.value.segment.docker1);if(-1==i)return;t.value.segment.docker2=this.dockers[i+1]}}.bind(this)),this.getLabels().each(function(t){var i=t.getReferencePoint();if(i){var o=i.segment.from,n=i.segment.to;if(o===e||n===e){var r=this.findSegment(i.intersection);r?(o=o===e?this.dockers[this.dockers.indexOf(n)-1]:o,n=this.dockers[this.dockers.indexOf(o)+1]):(o=r.fromDocker,n=r.toDocker);var a=ORYX.Core.Math.getPointOfIntersectionPointLine(o.bounds.center(),n.bounds.center(),i.intersection,!0);this.updateReferencePointOfLabel(t,a,o,n,!0)}}}.bind(this)),this.refreshAttachedNodes())},addDocker:function(e,t){var i,o;return this._dockersByPath.any(function(n){return n.value.any(function(r){if(i){var a=i.bounds.center(),s=r.bounds.center(),l=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var d=navigator.userAgent;if(d.indexOf("MSIE")>=0){var c=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==c&&(l=c/100)}}if(1!==l&&(e.x=e.x/l,e.y=e.y/l),ORYX.Core.Math.isPointInLine(e.x,e.y,a.x,a.y,s.x,s.y,10)){var p=this._paths.find(function(e){return e.id===n.key});if(p){var u=p.getAttributeNS(NAMESPACE_ORYX,"allowDockers");if(u&&"no"===u.toLowerCase())return!0}var m=t?t:this.createDocker(this.dockers.indexOf(i)+1,e);return m.bounds.centerMoveTo(e),t&&this.add(m,this.dockers.indexOf(i)+1),o=m,!0}return i=r,!1}return i=r,!1}.bind(this))}.bind(this)),o},removeDocker:function(e){this.dockers.length>2&&this.dockers.first()!==e&&this._dockersByPath.any(function(t){return t.value.member(e)?e===t.value.last()?!0:(this.remove(e),this._dockersByPath[t.key]=t.value.without(e),this.isChanged=!0,this._dockerChanged(),!0):!1}.bind(this))},removeUnusedDockers:function(){var e=$H({});return this.dockers.each(function(t,i){if(0!=i&&i!=this.dockers.length-1){var o=this.dockers[i-1];-1!=e.values().indexOf(o)&&this.dockers[i-2]&&(o=this.dockers[i-2]);var n=this.dockers[i+1],r=o.getDockedShape()&&o.referencePoint?o.getAbsoluteReferencePoint():o.bounds.center(),a=n.getDockedShape()&&n.referencePoint?n.getAbsoluteReferencePoint():n.bounds.center(),s=t.bounds.center();ORYX.Core.Math.isPointInLine(s.x,s.y,r.x,r.y,a.x,a.y,1)&&(e[i]=t)}}.bind(this)),e.each(function(e){this.removeDocker(e.value)}.bind(this)),e.values().length>0&&this._update(!0),e},_init:function(e){arguments.callee.$._init.apply(this,arguments);var t,i,o,n,r=e.getElementsByTagNameNS(NAMESPACE_SVG,"defs");if(r.length>0){r=r[0];var a,s=$A(r.getElementsByTagNameNS(NAMESPACE_SVG,"marker")),l=this;s.each(function(e){try{a=new ORYX.Core.SVG.SVGMarker(e.cloneNode(!0)),l._markers[a.id]=a;var t,i=$A(a.element.getElementsByTagNameNS(NAMESPACE_SVG,"text"));i.each(function(e){t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id}),l._labels[t.id]=t})}catch(o){}})}var d=e.getElementsByTagNameNS(NAMESPACE_SVG,"g");if(0>=d.length)throw"Edge: No g element found.";var c=d[0];c.setAttributeNS(null,"id",null);var p=!0;$A(c.childNodes).each(function(e,r){if(ORYX.Editor.checkClassType(e,SVGPathElement)){e=e.cloneNode(!1);var a=this.id+"_"+r;e.setAttributeNS(null,"id",a),this._paths.push(e);var s=[],l=e.getAttributeNS(null,"marker-start");if(l&&""!==l){l=l.strip(),l=l.replace(/^url\(#/,"");var d=this.getValidMarkerId(l);e.setAttributeNS(null,"marker-start","url(#"+d+")"),s.push(this._markers[d])}if(l=e.getAttributeNS(null,"marker-mid"),l&&""!==l){l=l.strip(),l=l.replace(/^url\(#/,"");var c=this.getValidMarkerId(l);e.setAttributeNS(null,"marker-mid","url(#"+c+")"),s.push(this._markers[c])}if(l=e.getAttributeNS(null,"marker-end"),l&&""!==l){l=l.strip();var u=this.getValidMarkerId(l);e.setAttributeNS(null,"marker-end","url(#"+u+")"),s.push(this._markers[u])}this._markersByPath[a]=s;var m=new PathParser,h=new ORYX.Core.SVG.PointsPathHandler;if(m.setHandler(h),m.parsePath(e),4>h.points.length)throw"Edge: Path has to have two or more points specified.";this._dockersByPath[a]=[];for(var f=0;h.points.length>f;f+=2){var g=h.points[f],v=h.points[f+1];if(p||f>0){var S=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});S.bounds.centerMoveTo(g,v),S.bounds.registerCallback(this._dockerChangedCallback),this.add(S,this.dockers.length),t?(t=Math.min(g,t),i=Math.min(v,i)):(t=g,i=v),o?(o=Math.max(g,o),n=Math.max(v,n)):(o=g,n=v)}}p=!1}}.bind(this)),this.bounds.set(t,i,o,n);this._oldBounds=this.bounds.clone(),this._paths.reverse();var u=[];this._paths.each(function(e){u.push(this.node.childNodes[0].childNodes[0].childNodes[0].appendChild(e))}.bind(this)),this._paths=u,this._paths.each(function(e){var t=e.cloneNode(!1);t.setAttributeNS(null,"id",void 0),t.setAttributeNS(null,"stroke-width",10),t.setAttributeNS(null,"visibility","hidden"),t.setAttributeNS(null,"stroke-dasharray",null),t.setAttributeNS(null,"stroke","black"),t.setAttributeNS(null,"fill","none"),this._interactionPaths.push(this.node.childNodes[0].childNodes[0].childNodes[0].appendChild(t))}.bind(this)),this._paths.reverse(),this._interactionPaths.reverse();var m=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text");$A(m).each(function(e){var t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id});this.node.childNodes[0].childNodes[0].appendChild(t.node),this._labels[t.id]=t,t.registerOnChange(this.layout.bind(this))}.bind(this)),this.propertiesChanged.each(function(e){e.value=!0})},getValidMarkerId:function(e){if(e.indexOf('url("#')>=0){var t=e.replace(/^url\(\"#/,"").replace(/\"\)$/,"");return this.id+t}return e=e.replace(/^url\(#/,""),this.id.concat(e.replace(/\)$/,""))},addMarkers:function(e){this._markers.each(function(t){e.ownerDocument.getElementById(t.value.id)||(t.value.element=e.appendChild(t.value.element))})},removeMarkers:function(){var e=this.node.ownerSVGElement;if(e){var t=e.getElementsByTagNameNS(NAMESPACE_SVG,"defs");t.length>0&&(t=t[0],this._markers.each(function(e){var i=t.ownerDocument.getElementById(e.value.id);i&&(e.value.element=t.removeChild(e.value.element))}))}},_dockerChanged:function(){this._dockerUpdated=!0},serialize:function(){var e=arguments.callee.$.serialize.apply(this),t="";this._dockersByPath.each(function(e){e.value.each(function(e){var i=e.getDockedShape()&&e.referencePoint?e.referencePoint:e.bounds.center();t=t.concat(i.x+" "+i.y+" ")}),t+=" # "}.bind(this)),e.push({name:"dockers",prefix:"oryx",value:t,type:"literal"});var i=this.dockers.last(),o=i.getDockedShape();o&&e.push({name:"target",prefix:"raziel",value:"#"+ERDF.__stripHashes(o.resourceId),type:"resource"});try{var n=this.getStencil().serialize();n.type&&(n.shape=this,n.data=e,n.result=void 0,n.forceExecution=!0,this._delegateEvent(n),n.result&&(e=n.result))}catch(r){}return e},deserialize:function(e){try{var t=this.getStencil().deserialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(i){}var o,n=e.find(function(e){return"raziel-target"==e.prefix+"-"+e.name});n&&(o=this.getCanvas().getChildShapeByResourceId(n.value));var r=e.findAll(function(e){return"raziel-outgoing"==e.prefix+"-"+e.name});r.each(function(e){if(this.parent){var t=this.getCanvas().getChildShapeByResourceId(e.value);t&&(t==o?(this.dockers.last().setDockedShape(t),this.dockers.last().setReferencePoint({x:t.bounds.width()/2,y:t.bounds.height()/2})):t instanceof ORYX.Core.Edge&&t.dockers.first().setDockedShape(this))}}.bind(this));var a=e.find(function(e){return"oryx"===e.prefix&&"dockers"===e.name});if(a){var s=a.value.split("#").without("").without(" ");s.each(function(e,t){var i=e.replace(/,/g," ").split(" ").without("");if(0===i.length%2){var o=this._paths[t];if(o){if(0===t)for(;this._dockersByPath[o.id].length>2;)this.removeDocker(this._dockersByPath[o.id][1]);else for(;this._dockersByPath[o.id].length>1;)this.removeDocker(this._dockersByPath[o.id][0]);var n=this._dockersByPath[o.id];if(0===t){var r=parseFloat(i.shift()),a=parseFloat(i.shift());n.first().getDockedShape()?n.first().setReferencePoint({x:r,y:a}):n.first().bounds.centerMoveTo(r,a)}a=parseFloat(i.pop()),r=parseFloat(i.pop()),n.last().getDockedShape()?n.last().setReferencePoint({x:r,y:a}):n.last().bounds.centerMoveTo(r,a);for(var s=0;i.length>s;s++){r=parseFloat(i[s]),a=parseFloat(i[++s]);var l=this.createDocker();l.bounds.centerMoveTo(r,a)}}}}.bind(this))}else this.alignDockers();arguments.callee.$.deserialize.apply(this,arguments),this._changed()},toString:function(){return this.getStencil().title()+" "+this.id},getTarget:function(){return this.dockers.last()?this.dockers.last().getDockedShape():null},getSource:function(){return this.dockers.first()?this.dockers.first().getDockedShape():null},isDocked:function(){var e=!1;return this.dockers.each(function(t){if(t.isDocked())throw e=!0,$break}),e},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments);return this.getTarget()&&(e.target={resourceId:this.getTarget().resourceId}),e}},ORYX.Core.Edge=ORYX.Core.Shape.extend(ORYX.Core.Edge),!ORYX)var ORYX={};if(ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.AbstractPlugin=Clazz.extend({facade:null,construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADED,this.onLoaded.bind(this))},onLoaded:function(){},onSelectionChanged:function(){},showOverlay:function(e,t,i,o){e instanceof Array||(e=[e]),e=e.map(function(e){var t=e;return"string"==typeof e&&(t=this.facade.getCanvas().getChildShapeByResourceId(e),t=t||this.facade.getCanvas().getChildById(e,!0)),t}.bind(this)).compact(),this.overlayID||(this.overlayID=this.type+ORYX.Editor.provideId()),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_SHOW,id:this.overlayID,shapes:e,attributes:t,node:i,nodePosition:o||"NW"})},hideOverlay:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_HIDE,id:this.overlayID})},doTransform:function(e,t){if(!t||!e)return"";var i=new DOMParser,o=i.parseFromString(e,"text/xml");source=t,new Ajax.Request(source,{asynchronous:!1,method:"get",onSuccess:function(e){xsl=e.responseText}.bind(this),onFailure:function(e){ORYX.Log.error("XSL load failed"+e)}.bind(this)});var n=new XSLTProcessor,r=new DOMParser,a=r.parseFromString(xsl,"text/xml");n.importStylesheet(a);try{var s=n.transformToFragment(o,document),l=(new XMLSerializer).serializeToString(s);return l=l.startsWith("<?xml")?l:'<?xml version="1.0" encoding="UTF-8"?>'+l}catch(d){return-1}},openXMLWindow:function(e){window.open("data:application/xml,"+encodeURIComponent(e),"_blank","resizable=yes,width=600,height=600,toolbar=0,scrollbars=yes")},openDownloadWindow:function(e,t){var i=window.open("");if(null!=i){i.document.open(),i.document.write("<html><body>");var o=i.document.createElement("form");i.document.body.appendChild(o);var n=function(e,t){var i=document.createElement("input");return i.name=e,i.type="hidden",i.value=t,i};o.appendChild(n("download",t)),o.appendChild(n("file",e)),o.method="POST",i.document.write("</body></html>"),i.document.close(),o.action=ORYX.PATH+"/download",o.submit()}},getSerializedDOM:function(){var e=DataManager.serializeDOM(this.facade);return e='<?xml version="1.0" encoding="utf-8"?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:b3mn="http://b3mn.org/2007/b3mn" xmlns:ext="http://b3mn.org/2007/ext" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:atom="http://b3mn.org/2007/atom+xhtml"><head profile="http://purl.org/NET/erdf/profile"><link rel="schema.dc" href="http://purl.org/dc/elements/1.1/" /><link rel="schema.dcTerms" href="http://purl.org/dc/terms/ " /><link rel="schema.b3mn" href="http://b3mn.org" /><link rel="schema.oryx" href="http://oryx-editor.org/" /><link rel="schema.raziel" href="http://raziel.org/" /><base href="'+location.href.split("?")[0]+'" /></head><body>'+e+"</body></html>"},enableReadOnlyMode:function(){this.facade.disableEvent(ORYX.CONFIG.EVENT_MOUSEDOWN),this._stopSelectionChange=function(){this.facade.getSelection().length>0&&this.facade.setSelection([])},this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,this._stopSelectionChange.bind(this))},disableReadOnlyMode:function(){this.facade.enableEvent(ORYX.CONFIG.EVENT_MOUSEDOWN),this._stopSelectionChange&&(this.facade.unregisterOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,this._stopSelectionChange.bind(this)),this._stopSelectionChange=void 0)},getRDFFromDOM:function(){try{var e="";source=ORYX.PATH+"lib/extract-rdf.xsl",new Ajax.Request(source,{asynchronous:!1,method:"get",onSuccess:function(t){e=t.responseText}.bind(this),onFailure:function(e){ORYX.Log.error("XSL load failed"+e)}.bind(this)});var t=new DOMParser,i=t.parseFromString(this.getSerializedDOM(),"text/xml"),o=t.parseFromString(e,"text/xml"),n=new XSLTProcessor;n.importStylesheet(o);var r=n.transformToFragment(i,document),a=new XMLSerializer;return a.serializeToString(r)}catch(s){return console.log("error serializing "+s),""}},isStencilSetExtensionLoaded:function(e){return this.facade.getStencilSets().values().any(function(t){return t.extensions().keys().any(function(t){return t==e}.bind(this))}.bind(this))},doLayout:function(e){this.facade.raiseEvent?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LAYOUT,shapes:e}):this.facade.handleEvents({type:ORYX.CONFIG.EVENT_LAYOUT,shapes:e})},layoutEdges:function(e,t,i){if(this.facade.isExecutingCommands()){var o=ORYX.Core.Command.extend({construct:function(e,t,i,o){this.edges=e,this.node=t,this.plugin=o,this.offset=i;var n=t.absoluteXY();this.ulo={x:n.x-i.x,y:n.y-i.y}},execute:function(){return this.changes?(this.executeAgain(),void 0):(this.changes=[],this.edges.each(function(e){this.changes.push({edge:e,oldDockerPositions:e.dockers.map(function(e){return e.bounds.center()})})}.bind(this)),this.edges.findAll(function(e){return e.dockers.length>2}.bind(this)).each(function(e){if(e.dockers.first().getDockedShape()===this.node){var t=e.dockers[1];this.align(t.bounds,e.dockers.first())&&t.update()}else if(e.dockers.last().getDockedShape()===this.node){var i=e.dockers[e.dockers.length-2];this.align(i.bounds,e.dockers.last())&&i.update()}return e._update(!0),e.removeUnusedDockers(),this.isBendPointIncluded(e)?(this.plugin.doLayout(e),void 0):void 0}.bind(this)),this.edges.each(function(e){if(2==e.dockers.length){var t=e.dockers.first().getAbsoluteReferencePoint()||e.dockers.first().bounds.center(),i=e.dockers.last().getAbsoluteReferencePoint()||e.dockers.first().bounds.center();(2>Math.abs(-Math.abs(t.x-i.x)+Math.abs(this.offset.x))||2>Math.abs(-Math.abs(t.y-i.y)+Math.abs(this.offset.y)))&&this.plugin.doLayout(e)}}.bind(this)),this.edges.each(function(e,t){this.changes[t].dockerPositions=e.dockers.map(function(e){return e.bounds.center()})}.bind(this)),void 0)},align:function(e,t){var i=t.getAbsoluteReferencePoint()||t.bounds.center(),o=e.center().x-i.x,n=e.center().y-i.y;if(3>Math.abs(-Math.abs(o)+Math.abs(this.offset.x))&&void 0===this.offset.xs&&e.moveBy({x:-o,y:0}),3>Math.abs(-Math.abs(n)+Math.abs(this.offset.y))&&void 0===this.offset.ys&&e.moveBy({y:-n,x:0}),void 0!==this.offset.xs||void 0!==this.offset.ys){var r=t.getDockedShape().absoluteXY();o=e.center().x-(r.x+(i.x-r.x)/this.offset.xs),n=e.center().y-(r.y+(i.y-r.y)/this.offset.ys),3>Math.abs(-Math.abs(o)+Math.abs(this.offset.x))&&e.moveBy({x:-(e.center().x-i.x),y:0}),3>Math.abs(-Math.abs(n)+Math.abs(this.offset.y))&&e.moveBy({y:-(e.center().y-i.y),x:0})}},isBendPointIncluded:function(e){var t=e.dockers.first().getDockedShape(),i=e.dockers.last().getDockedShape();return t&&(t=t.absoluteBounds(),t.widen(5)),i&&(i=i.absoluteBounds(),i.widen(20)),e.dockers.any(function(o,n){var r=o.bounds.center();return 0!=n&&n!=e.dockers.length-1&&(t&&t.isIncluded(r)||i&&i.isIncluded(r))})},removeAllDocker:function(e){e.dockers.slice(1,e.dockers.length-1).each(function(t){e.removeDocker(t)})},executeAgain:function(){this.changes.each(function(e){this.removeAllDocker(e.edge),e.dockerPositions.each(function(t,i){if(0!=i&&i!=e.dockerPositions.length-1){var o=e.edge.createDocker(void 0,t);o.bounds.centerMoveTo(t),o.update()}}.bind(this)),e.edge._update(!0)}.bind(this))},rollback:function(){this.changes.each(function(e){this.removeAllDocker(e.edge),e.oldDockerPositions.each(function(t,i){if(0!=i&&i!=e.oldDockerPositions.length-1){var o=e.edge.createDocker(void 0,t);o.bounds.centerMoveTo(t),o.update()}}.bind(this)),e.edge._update(!0)}.bind(this))}});this.facade.executeCommands([new o(t,e,i,this)])}}}),!ORYX)var ORYX={};if(ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.AbstractLayouter=ORYX.Plugins.AbstractPlugin.extend({layouted:[],construct:function(){arguments.callee.$.construct.apply(this,arguments),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LAYOUT,this._initLayout.bind(this))},isIncludedInLayout:function(e){return this.layouted instanceof Array||(this.layouted=[this.layouted].compact()),0>=this.layouted.length?!0:this.layouted.any(function(t){return"string"==typeof t?e.getStencil().id().include(t):e instanceof t})},_initLayout:function(e){var t=[e.shapes].flatten().compact(),i=t.findAll(function(e){return this.isIncludedInLayout(e)}.bind(this));i.length>0&&this.layout(i)},layout:function(){throw Error("Layouter has to implement the layout function.")}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.Edit=Clazz.extend({construct:function(e){this.facade=e,this.clipboard=new ORYX.Plugins.Edit.ClipBoard,this.facade.offer({name:ORYX.I18N.Edit.cut,description:ORYX.I18N.Edit.cutDesc,icon:ORYX.PATH+"images/cut.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:88,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editCut),group:ORYX.I18N.Edit.group,index:1,minShape:1}),this.facade.offer({name:ORYX.I18N.Edit.copy,description:ORYX.I18N.Edit.copyDesc,icon:ORYX.PATH+"images/page_copy.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:67,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editCopy,[!0,!1]),group:ORYX.I18N.Edit.group,index:2,minShape:1}),this.facade.offer({name:ORYX.I18N.Edit.paste,description:ORYX.I18N.Edit.pasteDesc,icon:ORYX.PATH+"images/page_paste.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:86,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editPaste),isEnabled:this.clipboard.isOccupied.bind(this.clipboard),group:ORYX.I18N.Edit.group,index:3,minShape:0,maxShape:0}),this.facade.offer({name:ORYX.I18N.Edit.del,description:ORYX.I18N.Edit.delDesc,icon:ORYX.PATH+"images/cross.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:8,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN},{keyCode:46,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editDelete),group:ORYX.I18N.Edit.group,index:4,minShape:1})},callEdit:function(e,t){window.setTimeout(function(){e.apply(this,t instanceof Array?t:[])}.bind(this),1)},handleMouseDown:function(e){this._controlPressed&&(this._controlPressed=!1,this.editCopy(),this.editPaste(),e.forceExecution=!0,this.facade.raiseEvent(e,this.clipboard.shapesAsJson))},getAllShapesToConsider:function(e){var t=[],i=[];e.each(function(o){if(isChildShapeOfAnother=e.any(function(e){return e.hasChildShape(o)}),!isChildShapeOfAnother){if(t.push(o),o instanceof ORYX.Core.Node){var n=o.getOutgoingNodes();n=n.findAll(function(t){return!e.include(t)}),t=t.concat(n)}i=i.concat(o.getChildShapes(!0))}}.bind(this));var o=this.facade.getCanvas().getChildEdges().select(function(e){return t.include(e)?!1:0===e.getAllDockedShapes().size()?!1:e.getAllDockedShapes().all(function(e){return e instanceof ORYX.Core.Edge||i.include(e)})});return t=t.concat(o)},editCut:function(){return this.editCopy(!1,!0),this.editDelete(!0),!1},editCopy:function(e,t){var i=this.facade.getSelection();0!=i.length&&(this.clipboard.refresh(i,this.getAllShapesToConsider(i),this.facade.getCanvas().getStencil().stencilSet().namespace(),t),e&&this.facade.updateSelection())},editPaste:function(){var e={childShapes:this.clipboard.shapesAsJson,stencilset:{namespace:this.clipboard.SSnamespace}};jQuery.extend(e,ORYX.Core.AbstractShape.JSONHelper);var t=e.getChildShapes(!0).pluck("resourceId"),i={};e.eachChild(function(e){return e.outgoing=e.outgoing.select(function(e){return t.include(e.resourceId)}),e.outgoing.each(function(t){i[t.resourceId]||(i[t.resourceId]=[]),i[t.resourceId].push(e)}),e}.bind(this),!0,!0),e.eachChild(function(e){return e.target&&!t.include(e.target.resourceId)&&(e.target=void 0,e.targetRemoved=!0),e.dockers&&e.dockers.length>=1&&e.dockers[0].getDocker&&(e.dockers[0].getDocker().getDockedShape()&&!t.include(e.dockers[0].getDocker().getDockedShape().resourceId)||!e.getShape().dockers[0].getDockedShape()&&!i[e.resourceId])&&(e.sourceRemoved=!0),e}.bind(this),!0,!0),e.eachChild(function(e){return this.clipboard.useOffset&&(e.bounds={lowerRight:{x:e.bounds.lowerRight.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:e.bounds.lowerRight.y+ORYX.CONFIG.COPY_MOVE_OFFSET},upperLeft:{x:e.bounds.upperLeft.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:e.bounds.upperLeft.y+ORYX.CONFIG.COPY_MOVE_OFFSET}}),e.dockers?e.dockers=e.dockers.map(function(t,o){return(e.targetRemoved===!0&&o==e.dockers.length-1&&t.getDocker||e.sourceRemoved===!0&&0==o&&t.getDocker)&&(t=t.getDocker().bounds.center()),0==o&&t.getDocker instanceof Function&&e.sourceRemoved!==!0&&(t.getDocker().getDockedShape()||(i[e.resourceId]||[]).length>0&&(!(e.getShape()instanceof ORYX.Core.Node)||i[e.resourceId][0].getShape()instanceof ORYX.Core.Node))||o==e.dockers.length-1&&t.getDocker instanceof Function&&e.targetRemoved!==!0&&(t.getDocker().getDockedShape()||e.target)?{x:t.x,y:t.y,getDocker:t.getDocker}:this.clipboard.useOffset?{x:t.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:t.y+ORYX.CONFIG.COPY_MOVE_OFFSET,getDocker:t.getDocker}:{x:t.x,y:t.y,getDocker:t.getDocker}
}.bind(this)):e.getShape()instanceof ORYX.Core.Node&&e.dockers&&e.dockers.length>0&&(!e.dockers.first().getDocker||e.sourceRemoved===!0||!e.dockers.first().getDocker().getDockedShape()&&!i[e.resourceId])&&(e.dockers=e.dockers.map(function(t,i){return e.sourceRemoved===!0&&0==i&&t.getDocker&&(t=t.getDocker().bounds.center()),this.clipboard.useOffset?{x:t.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:t.y+ORYX.CONFIG.COPY_MOVE_OFFSET,getDocker:t.getDocker}:{x:t.x,y:t.y,getDocker:t.getDocker}}.bind(this))),e}.bind(this),!1,!0),this.clipboard.useOffset=!0,this.facade.importJSON(e)},editDelete:function(){var e=this.facade.getSelection(),t=new ORYX.Plugins.Edit.ClipBoard;t.refresh(e,this.getAllShapesToConsider(e));var i=new ORYX.Plugins.Edit.DeleteCommand(t,this.facade);this.facade.executeCommands([i])}}),ORYX.Plugins.Edit.ClipBoard=Clazz.extend({construct:function(){this.shapesAsJson=[],this.selection=[],this.SSnamespace="",this.useOffset=!0},isOccupied:function(){return this.shapesAsJson.length>0},refresh:function(e,t,i,o){this.selection=e,this.SSnamespace=i,this.outgoings={},this.parents={},this.targets={},this.useOffset=o!==!0,this.shapesAsJson=t.map(function(e){var t=e.toJSON();return t.parent={resourceId:e.getParentShape().resourceId},t.parentIndex=e.getParentShape().getChildShapes().indexOf(e),t})}}),ORYX.Plugins.Edit.DeleteCommand=ORYX.Core.Command.extend({construct:function(e,t){this.clipboard=e,this.shapesAsJson=e.shapesAsJson,this.facade=t,this.dockers=this.shapesAsJson.map(function(e){var t=e.getShape(),i=t.getIncomingShapes().map(function(e){return e.getDockers().last()}),o=t.getOutgoingShapes().map(function(e){return e.getDockers().first()}),n=t.getDockers().concat(i,o).compact().map(function(e){return{object:e,referencePoint:e.referencePoint,dockedShape:e.getDockedShape()}});return n}).flatten()},execute:function(){this.shapesAsJson.each(function(e){this.facade.deleteShape(e.getShape())}.bind(this)),this.facade.setSelection([]),this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.shapesAsJson.each(function(e){var t=e.getShape(),i=this.facade.getCanvas().getChildShapeByResourceId(e.parent.resourceId)||this.facade.getCanvas();i.add(t,t.parentIndex)}.bind(this)),this.dockers.each(function(e){e.object.setDockedShape(e.dockedShape),e.object.setReferencePoint(e.referencePoint)}.bind(this)),this.facade.setSelection(this.selectedShapes),this.facade.getCanvas().update(),this.facade.updateSelection()}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.View={facade:void 0,construct:function(e,t){this.facade=e,this.zoomLevel=1,this.maxFitToScreenLevel=1.5,this.minZoomLevel=.1,this.maxZoomLevel=2.5,this.diff=5,void 0!==t&&null!==t&&t.properties.each(function(e){e.zoomLevel&&(this.zoomLevel=Number(1)),e.maxFitToScreenLevel&&(this.maxFitToScreenLevel=Number(e.maxFitToScreenLevel)),e.minZoomLevel&&(this.minZoomLevel=Number(e.minZoomLevel)),e.maxZoomLevel&&(this.maxZoomLevel=Number(e.maxZoomLevel))}.bind(this)),this.facade.offer({name:ORYX.I18N.View.zoomIn,functionality:this.zoom.bind(this,[1+ORYX.CONFIG.ZOOM_OFFSET]),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/magnifier_zoom_in.png",description:ORYX.I18N.View.zoomInDesc,index:1,minShape:0,maxShape:0,isEnabled:function(){return this.zoomLevel<this.maxZoomLevel}.bind(this)}),this.facade.offer({name:ORYX.I18N.View.zoomOut,functionality:this.zoom.bind(this,[1-ORYX.CONFIG.ZOOM_OFFSET]),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/magnifier_zoom_out.png",description:ORYX.I18N.View.zoomOutDesc,index:2,minShape:0,maxShape:0,isEnabled:function(){return this._checkSize()}.bind(this)}),this.facade.offer({name:ORYX.I18N.View.zoomStandard,functionality:this.setAFixZoomLevel.bind(this,1),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/zoom_standard.png",cls:"icon-large",description:ORYX.I18N.View.zoomStandardDesc,index:3,minShape:0,maxShape:0,isEnabled:function(){return 1!=this.zoomLevel}.bind(this)}),this.facade.offer({name:ORYX.I18N.View.zoomFitToModel,functionality:this.zoomFitToModel.bind(this),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/image.png",description:ORYX.I18N.View.zoomFitToModelDesc,index:4,minShape:0,maxShape:0})},setAFixZoomLevel:function(e){this.zoomLevel=e,this._checkZoomLevelRange(),this.zoom(1)},zoom:function(e){this.zoomLevel*=e;var t=this.facade.getCanvas().getHTMLContainer().parentNode.parentNode,i=this.facade.getCanvas(),o=i.bounds.width()*this.zoomLevel,n=i.bounds.height()*this.zoomLevel,r=(i.node.parentNode.parentNode.parentNode.offsetHeight-n)/2;r=r>20?r-20:0,i.node.parentNode.parentNode.style.marginTop=r+"px",r+=5,i.getHTMLContainer().style.top=r+"px";var a=t.scrollTop-Math.round((i.getHTMLContainer().parentNode.getHeight()-n)/2)+this.diff,s=t.scrollLeft-Math.round((i.getHTMLContainer().parentNode.getWidth()-o)/2)+this.diff;i.setSize({width:o,height:n},!0),i.node.setAttributeNS(null,"transform","scale("+this.zoomLevel+")"),this.facade.updateSelection(),t.scrollTop=a,t.scrollLeft=s,i.zoomLevel=this.zoomLevel},zoomFitToModel:function(){var e=this.facade.getCanvas().getHTMLContainer().parentNode.parentNode,t=e.getHeight()-30,i=e.getWidth()-30,o=this.facade.getCanvas().getChildShapes();if(!o||1>o.length)return!1;var n=o[0].absoluteBounds().clone();o.each(function(e){n.include(e.absoluteBounds().clone())});var r=i/n.width(),a=t/n.height(),s=r>a?a:r;s>this.maxFitToScreenLevel&&(s=this.maxFitToScreenLevel),this.setAFixZoomLevel(s),e.scrollTop=Math.round(n.upperLeft().y*this.zoomLevel)-5,e.scrollLeft=Math.round(n.upperLeft().x*this.zoomLevel)-5},_checkSize:function(){var e=this.facade.getCanvas().getHTMLContainer().parentNode,t=Math.min(e.parentNode.getWidth()/e.getWidth(),e.parentNode.getHeight()/e.getHeight());return 1.05>t},_checkZoomLevelRange:function(){this.zoomLevel<this.minZoomLevel&&(this.zoomLevel=this.minZoomLevel),this.zoomLevel>this.maxZoomLevel&&(this.zoomLevel=this.maxZoomLevel)}},ORYX.Plugins.View=Clazz.extend(ORYX.Plugins.View),!Signavio)var Signavio={};if(Signavio.Core||(Signavio.Core={}),Signavio.Core.Version="1.0",!Signavio)var Signavio={};Signavio.Plugins||(Signavio.Plugins={}),Signavio.Plugins.Utils||(Signavio.Plugins.Utils={}),Signavio.Helper||(Signavio.Helper={}),new function(){ORYX.Editor.provideId=function(){for(var e=[],t="0123456789ABCDEF",i=0;36>i;i++)e[i]=Math.floor(16*Math.random());e[14]=4,e[19]=8|3&e[19];for(var i=0;36>i;i++)e[i]=t[e[i]];return e[8]=e[13]=e[18]=e[23]="-","sid-"+e.join("")}},ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.Loading={construct:function(e){this.facade=e,this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",this.facade.getCanvas().getHTMLContainer().parentNode,["div",{"class":"LoadingIndicator"},""]),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADING_ENABLE,this.enableLoading.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADING_DISABLE,this.disableLoading.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADING_STATUS,this.showStatus.bind(this)),this.disableLoading()},enableLoading:function(e){this.node.innerHTML=e.text?e.text+"...":ORYX.I18N.Loading.waiting,this.node.removeClassName("StatusIndicator"),this.node.addClassName("LoadingIndicator"),this.node.style.display="block";var t=this.facade.getCanvas().rootNode.parentNode.parentNode.parentNode.parentNode;this.node.style.top=t.offsetTop+"px",this.node.style.left=t.offsetLeft+"px"},disableLoading:function(){this.node.style.display="none"},showStatus:function(e){if(e.text){this.node.innerHTML=e.text,this.node.addClassName("StatusIndicator"),this.node.removeClassName("LoadingIndicator"),this.node.style.display="block";var t=this.facade.getCanvas().rootNode.parentNode.parentNode.parentNode.parentNode;this.node.style.top=t.offsetTop+"px",this.node.style.left=t.offsetLeft+"px";var i=e.timeout?e.timeout:2e3;window.setTimeout(function(){this.disableLoading()}.bind(this),i)}}},ORYX.Plugins.Loading=Clazz.extend(ORYX.Plugins.Loading),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.CanvasResize=Clazz.extend({construct:function(e){this.facade=e,new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"N",this.resize.bind(this)),new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"W",this.resize.bind(this)),new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"E",this.resize.bind(this)),new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"S",this.resize.bind(this)),window.setTimeout(function(){jQuery(window).trigger("resize")})},resize:function(e,t){resizeCanvas=function(e,t,i){var o=i.getCanvas(),n=o.bounds,r=i.getCanvas().getHTMLContainer().parentNode.parentNode;if("E"==e||"W"==e?o.setSize({width:(n.width()+t)*o.zoomLevel,height:n.height()*o.zoomLevel}):("S"==e||"N"==e)&&o.setSize({width:n.width()*o.zoomLevel,height:(n.height()+t)*o.zoomLevel}),"N"==e||"W"==e){var a="N"==e?{x:0,y:t}:{x:t,y:0};o.getChildNodes(!1,function(e){e.bounds.moveBy(a)});var s=o.getChildEdges().findAll(function(e){return e.getAllDockedShapes().length>0}),l=s.collect(function(e){return e.dockers.findAll(function(e){return!e.getDockedShape()})}).flatten();l.each(function(e){e.bounds.moveBy(a)})}else"S"==e?r.scrollTop+=t:"E"==e&&(r.scrollLeft+=t);jQuery(window).trigger("resize"),o.update(),i.updateSelection()};var i=ORYX.Core.Command.extend({construct:function(e,t,i){this.position=e,this.extentionSize=t,this.facade=i},execute:function(){resizeCanvas(this.position,this.extentionSize,this.facade)},rollback:function(){resizeCanvas(this.position,-this.extentionSize,this.facade)},update:function(){}}),o=ORYX.CONFIG.CANVAS_RESIZE_INTERVAL;t&&(o=-o);var n=new i(e,o,this.facade);this.facade.executeCommands([n])}}),ORYX.Plugins.CanvasResizeButton=Clazz.extend({construct:function(e,t,i){this.canvas=e;var o=e.getHTMLContainer().parentNode;window.myParent=o;var n=jQuery("#canvasSection")[0],r=n,a=jQuery("#canvasSection").find(".ORYX_Editor")[0],s=a.children[0],l="glyphicon glyphicon-chevron-",d="glyphicon glyphicon-chevron-";"N"==t?(l+="up",d+="down"):"S"==t?(l+="down",d+="up"):"E"==t?(l+="right",d+="left"):"W"==t&&(l+="left",d+="right");var c="canvas-shrink-"+t,p="canvas-grow-"+t,u=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",o,["div",{"class":"canvas_resize_indicator canvas_resize_indicator_grow "+t,id:c,title:ORYX.I18N.RESIZE.tipGrow+ORYX.I18N.RESIZE[t]},["i",{"class":l}]]),m=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",o,["div",{"class":"canvas_resize_indicator canvas_resize_indicator_shrink "+t,id:p,title:ORYX.I18N.RESIZE.tipGrow+ORYX.I18N.RESIZE[t]},["i",{"class":d}]]),h=60,f=function(e){var i=-1!=e.target.id.indexOf("canvas-shrink")||-1!=e.target.id.indexOf("canvas-grow")||-1!=e.target.parentNode.id.indexOf("canvas-shrink")||-1!=e.target.parentNode.id.indexOf("canvas-grow");if(i)return e.target.id==c||e.target.id==p||e.target.parentNode.id==c||e.target.parentNode.id==p?!0:!1;if(e.target!=o&&e.target!=r&&e.target!=r.firstChild&&e.target!=s&&e.target!=r)return!1;var l=void 0!==e.offsetX?e.offsetX:e.layerX,d=void 0!==e.offsetY?e.offsetY:e.layerY,u=0;if(a.clientWidth<n.clientWidth){var m=n.clientWidth-a.clientWidth;u=m/2}return d-=n.scrollTop,l-=n.scrollLeft,"N"==t?h>d:"W"==t?h+u>l:"E"==t?h+u>n.clientWidth-l:"S"==t?h>n.clientHeight-d:!1},g=function(){u.show();var i=e.bounds.width(),o=e.bounds.height();"N"==t&&o-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_HEIGHT?m.show():"E"==t&&i-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_WIDTH?m.show():"S"==t&&o-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_HEIGHT?m.show():"W"==t&&i-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_WIDTH?m.show():m.hide()}.bind(this),v=function(){u.hide(),m.hide()};o.parentNode.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,function(e){f(e)?g():v()},!1),u.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,function(){g()},!0),m.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,function(){g()},!0),o.parentNode.addEventListener(ORYX.CONFIG.EVENT_MOUSEOUT,function(){v()},!0),v(),u.addEventListener("click",function(){i(t),g()},!0),m.addEventListener("click",function(){i(t,!0),g()},!0)}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.RenameShapes=Clazz.extend({facade:void 0,construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_CANVAS_SCROLL,this.hideField.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DBLCLICK,this.actOnDBLClick.bind(this)),this.facade.offer({keyCodes:[{keyCode:113,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.renamePerF2.bind(this)}),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this.hide.bind(this),!0)},renamePerF2:function(){var e=this.facade.getSelection();this.actOnDBLClick(void 0,e.first())},actOnDBLClick:function(e,t){if(t instanceof ORYX.Core.Shape){this.destroy();var i=t.getStencil().properties().findAll(function(e){return e.refToView()&&e.refToView().length>0&&e.directlyEditable()});i=i.findAll(function(e){return!e.readonly()&&(e.type()==ORYX.CONFIG.TYPE_STRING||e.type()==ORYX.CONFIG.TYPE_EXPRESSION||e.type()==ORYX.CONFIG.TYPE_DATASOURCE)});var o=i.collect(function(e){return e.refToView()}).flatten().compact(),n=t.getLabels().findAll(function(e){return o.any(function(t){return e.id.endsWith(t)})});if(0!=n.length){var r=1>=n.length?n[0]:null;if(!r&&(r=n.find(function(t){return t.node==e.target||t.node==e.target.parentNode}),!r)){var a=this.facade.eventCoordinates(e),s=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var l=navigator.userAgent;if(l.indexOf("MSIE")>=0){var d=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==d&&(s=d/100)}}1!==s&&(a.x=a.x/s,a.y=a.y/s),a.y+=$("editor-header").clientHeight-$("canvasSection").scrollTop-5,0==KISBPM.HEADER_CONFIG.showAppTitle&&(a.y+=61),a.x-=$("canvasSection").scrollLeft;var c=this.facade.getCanvas().rootNode.lastChild.getScreenCTM();a.x*=c.a,a.y*=c.d;var p=n.collect(function(e){var t=this.getCenterPosition(e.node),i=Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2));return{diff:i,label:e}}.bind(this));p.sort(function(e,t){return e.diff>t.diff}),r=p[0].label}var u=i.find(function(e){return e.refToView().any(function(e){return r.id==t.id+e})}),m=Math.min(Math.max(100,t.bounds.width()),200),h=this.getCenterPosition(r.node,t);h.x-=m/2;var f=u.prefix()+"-"+u.id(),g=document.createElement("textarea");g.id="shapeTextInput",g.style.position="absolute",g.style.width=m+"px",g.style.left=10>h.x?10:h.x+"px",g.style.top=h.y-15+"px",g.className="x-form-textarea x-form-field x_form_text_set_absolute",g.value=t.properties[f],this.oldValueText=t.properties[f],document.getElementById("canvasSection").appendChild(g),this.shownTextField=g,this.updateValueFunction=function(e,i){var o=t,n=this.facade;if(i!=e){var r=ORYX.Core.Command.extend({construct:function(){this.el=o,this.propId=f,this.oldValue=i,this.newValue=e,this.facade=n},execute:function(){this.el.setProperty(this.propId,this.newValue),this.facade.setSelection([this.el]),this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.el.setProperty(this.propId,this.oldValue),this.facade.setSelection([this.el]),this.facade.getCanvas().update(),this.facade.updateSelection()}}),a=new r;this.facade.executeCommands([a])}}.bind(this),jQuery("#shapeTextInput").focus(),jQuery("#shapeTextInput").autogrow(),this.facade.disableEvent(ORYX.CONFIG.EVENT_KEYDOWN)}}},getCenterPosition:function(e,t){if(!e)return{x:0,y:0};for(var i=this.facade.getCanvas().node.getScreenCTM(),o=t.bounds.upperLeft(),n=!0,r=t;n;)if("BPMNDiagram"===r.getParentShape().getStencil().idWithoutNs())n=!1;else{var a=r.getParentShape().bounds.upperLeft();o.x+=a.x,o.y+=a.y,r=r.getParentShape()}var s=t.bounds.midPoint();s.x+=o.x+i.e,s.y+=o.y+i.f,s.x*=i.a,s.y*=i.d;var l=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var d=navigator.userAgent;if(d.indexOf("MSIE")>=0){var c=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==c&&(l=c/100)}}if(1===l)s.y=s.y-jQuery("#canvasSection").offset().top+5,s.x-=jQuery("#canvasSection").offset().left;else{var p=jQuery("#canvasSection").offset().left,u=jQuery("#canvasSection").scrollLeft(),m=jQuery("#canvasSection").scrollTop(),h=i.e-p*l,f=0;h>10&&(f=h/l-h),s.y=s.y-jQuery("#canvasSection").offset().top*l+5+(m*l-m),s.x=s.x-p*l+f+(u*l-u)}return s},hide:function(e){if(this.shownTextField&&(!e||e.target!==this.shownTextField)){var t=this.shownTextField.value;t!==this.oldValueText&&this.updateValueFunction(t,this.oldValueText),this.destroy()}},hideField:function(){this.shownTextField&&this.destroy()},destroy:function(){var e=jQuery("#shapeTextInput");e&&(e.remove(),delete this.shownTextField,this.facade.enableEvent(ORYX.CONFIG.EVENT_KEYDOWN))}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.ProcessLink=Clazz.extend({facade:void 0,construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_PROPERTY_CHANGED,this.propertyChanged.bind(this))},propertyChanged:function(e,t){"oryx-refuri"!==e.name||!t instanceof ORYX.Core.Node||(e.value&&e.value.length>0&&"undefined"!=e.value?this.show(t,e.value):this.hide(t))},show:function(e,t){var i=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["a",{target:"_blank"},["path",{"stroke-width":1,stroke:"#00DD00",fill:"#00AA00",d:"M3,3 l0,-2.5 l7.5,0 l0,-2.5 l7.5,4.5 l-7.5,3.5 l0,-2.5 l-8,0","line-captions":"round"}]]),i=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["a",{target:"_blank"},["path",{style:"fill:#92BFFC;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.72",d:"M0 1.44 L0 15.05 L11.91 15.05 L11.91 5.98 L7.37 1.44 L0 1.44 Z"}],["path",{style:"stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.72;fill:none;",transform:"translate(7.5, -8.5)",d:"M0 10.51 L0 15.05 L4.54 15.05"}],["path",{style:"fill:#f28226;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.72",transform:"translate(-3, -1)",d:"M0 8.81 L0 13.06 L5.95 13.06 L5.95 15.05 A50.2313 50.2313 -175.57 0 0 10.77 11.08 A49.9128 49.9128 -1.28 0 0 5.95 6.54 L5.95 8.81 L0 8.81 Z"}]]);i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_SHOW,id:"arissupport.urlref_"+e.id,shapes:[e],node:i,nodePosition:"SE"})},hide:function(e){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_HIDE,id:"arissupport.urlref_"+e.id})}}),Array.prototype.insertFrom=function(e,t){t=Math.max(0,t),e=Math.min(Math.max(0,e),this.length-1);var i=this[e],o=this.without(i),n=o.slice(0,t);return n.push(i),o.length>t&&(n=n.concat(o.slice(t))),n},ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.Arrangement=ORYX.Plugins.AbstractPlugin.extend({facade:void 0,construct:function(e){this.facade=e,this.facade.offer({name:ORYX.I18N.Arrangement.am,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_MIDDLE]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_middle.png",description:ORYX.I18N.Arrangement.amDesc,index:1,minShape:2}),this.facade.offer({name:ORYX.I18N.Arrangement.ac,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_CENTER]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_center.png",description:ORYX.I18N.Arrangement.acDesc,index:2,minShape:2}),this.facade.offer({name:ORYX.I18N.Arrangement.as,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_SIZE]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_size.png",description:ORYX.I18N.Arrangement.asDesc,index:3,minShape:2}),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_TOP,this.setZLevel.bind(this,this.setToTop)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_BACK,this.setZLevel.bind(this,this.setToBack)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_FORWARD,this.setZLevel.bind(this,this.setForward)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_BACKWARD,this.setZLevel.bind(this,this.setBackward))},onSelectionChanged:function(){var e=this.facade.getSelection();1===e.length&&e[0]instanceof ORYX.Core.Edge&&this.setToTop(e)},setZLevel:function(e,t){var i=ORYX.Core.Command.extend({construct:function(e,t,i){this.callback=e,this.elements=t,this.elAndIndex=t.map(function(e){return{el:e,previous:e.parent.children[e.parent.children.indexOf(e)-1]}}),this.facade=i},execute:function(){this.callback(this.elements),this.facade.setSelection(this.elements)},rollback:function(){for(var e=this.elAndIndex.sortBy(function(e){var t=e.el,i=$A(t.node.parentNode.childNodes);return i.indexOf(t.node)}),t=0;e.length>t;t++){var i=e[t].el,o=i.parent,n=o.children.indexOf(i),r=o.children.indexOf(e[t].previous);r=r||0,o.children=o.children.insertFrom(n,r),i.node.parentNode.insertBefore(i.node,i.node.parentNode.childNodes[r+1])}this.facade.setSelection(this.elements)}}),o=new i(e,this.facade.getSelection(),this.facade);t.excludeCommand?o.execute():this.facade.executeCommands([o])},setToTop:function(e){var t=e.sortBy(function(e){var t=$A(e.node.parentNode.childNodes);return t.indexOf(e.node)});t.each(function(e){var t=e.parent;t.children.last()!==e&&(t.children=t.children.without(e),t.children.push(e),e.node.parentNode.appendChild(e.node))})},setToBack:function(e){var t=e.sortBy(function(e){var t=$A(e.node.parentNode.childNodes);return t.indexOf(e.node)});t=t.reverse(),t.each(function(e){var t=e.parent;t.children=t.children.without(e),t.children.unshift(e),e.node.parentNode.insertBefore(e.node,e.node.parentNode.firstChild)})},setBackward:function(e){var t=e.sortBy(function(e){var t=$A(e.node.parentNode.childNodes);return t.indexOf(e.node)});t=t.reverse();var i=t.findAll(function(e){return!t.some(function(t){return t.node==e.node.previousSibling})});i.each(function(e){if(null!==e.node.previousSibling){var t=e.parent,i=t.children.indexOf(e);t.children=t.children.insertFrom(i,i-1),e.node.parentNode.insertBefore(e.node,e.node.previousSibling)}})},setForward:function(e){var t=e.sortBy(function(e){var t=$A(e.node.parentNode.childNodes);return t.indexOf(e.node)}),i=t.findAll(function(e){return!t.some(function(t){return t.node==e.node.nextSibling})});i.each(function(e){var t=e.node.nextSibling;if(null!==t){var i=e.parent.children.indexOf(e),o=e.parent;o.children=o.children.insertFrom(i,i+1),e.node.parentNode.insertBefore(t,e.node)}})},alignShapes:function(e){var t=this.facade.getSelection();if(t=this.facade.getCanvas().getShapesWithSharedParent(t),t=t.findAll(function(e){return e instanceof ORYX.Core.Node}),t=t.findAll(function(e){var i=e.getIncomingShapes();return 0==i.length||!t.include(i[0])}),!(2>t.length)){var i=t[0].absoluteBounds().clone();t.each(function(e){i.include(e.absoluteBounds().clone())});var o=0,n=0;t.each(function(e){o=Math.max(e.bounds.width(),o),n=Math.max(e.bounds.height(),n)});var r=ORYX.Core.Command.extend({construct:function(e,t,i,o,n,r){this.elements=e,this.bounds=t,this.maxHeight=i,this.maxWidth=o,this.way=n,this.facade=r.facade,this.plugin=r,this.orgPos=[]},setBounds:function(e,t){if(t||(t={width:ORYX.CONFIG.MAXIMUM_SIZE,height:ORYX.CONFIG.MAXIMUM_SIZE}),!e.bounds)throw"Bounds not definined.";var i={a:{x:e.bounds.upperLeft().x-(this.maxWidth-e.bounds.width())/2,y:e.bounds.upperLeft().y-(this.maxHeight-e.bounds.height())/2},b:{x:e.bounds.lowerRight().x+(this.maxWidth-e.bounds.width())/2,y:e.bounds.lowerRight().y+(this.maxHeight-e.bounds.height())/2}};this.maxWidth>t.width&&(i.a.x=e.bounds.upperLeft().x-(t.width-e.bounds.width())/2,i.b.x=e.bounds.lowerRight().x+(t.width-e.bounds.width())/2),this.maxHeight>t.height&&(i.a.y=e.bounds.upperLeft().y-(t.height-e.bounds.height())/2,i.b.y=e.bounds.lowerRight().y+(t.height-e.bounds.height())/2),e.bounds.set(i)},execute:function(){this.elements.each(function(e,t){this.orgPos[t]=e.bounds.upperLeft();var i,o=this.bounds.clone();if(e.parent&&!(e.parent instanceof ORYX.Core.Canvas)){var n=e.parent.absoluteBounds().upperLeft();o.moveBy(-n.x,-n.y)}switch(this.way){case ORYX.CONFIG.EDITOR_ALIGN_BOTTOM:i={x:e.bounds.upperLeft().x,y:o.b.y-e.bounds.height()};break;case ORYX.CONFIG.EDITOR_ALIGN_MIDDLE:i={x:e.bounds.upperLeft().x,y:(o.a.y+o.b.y-e.bounds.height())/2};break;case ORYX.CONFIG.EDITOR_ALIGN_TOP:i={x:e.bounds.upperLeft().x,y:o.a.y};break;case ORYX.CONFIG.EDITOR_ALIGN_LEFT:i={x:o.a.x,y:e.bounds.upperLeft().y};break;case ORYX.CONFIG.EDITOR_ALIGN_CENTER:i={x:(o.a.x+o.b.x-e.bounds.width())/2,y:e.bounds.upperLeft().y};break;case ORYX.CONFIG.EDITOR_ALIGN_RIGHT:i={x:o.b.x-e.bounds.width(),y:e.bounds.upperLeft().y};break;case ORYX.CONFIG.EDITOR_ALIGN_SIZE:e.isResizable&&(this.orgPos[t]={a:e.bounds.upperLeft(),b:e.bounds.lowerRight()},this.setBounds(e,e.maximumSize))}if(i){var r={x:e.bounds.upperLeft().x-i.x,y:e.bounds.upperLeft().y-i.y};e.bounds.moveTo(i),this.plugin.layoutEdges(e,e.getAllDockedShapes(),r)}}.bind(this))},rollback:function(){this.elements.each(function(e,t){this.way==ORYX.CONFIG.EDITOR_ALIGN_SIZE?e.isResizable&&e.bounds.set(this.orgPos[t]):e.bounds.moveTo(this.orgPos[t])}.bind(this))}}),a=new r(t,i,n,o,parseInt(e),this);this.facade.executeCommands([a])}}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.Save=Clazz.extend({facade:void 0,processURI:void 0,changeSymbol:"*",construct:function(e){this.facade=e,document.addEventListener("keydown",function(e){e.ctrlKey&&83===e.keyCode&&Event.stop(e)},!1),window.onbeforeunload=this.onUnLoad.bind(this),this.changeDifference=0,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_UNDO_EXECUTE,function(){this.changeDifference++,this.updateTitle()}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,function(){this.changeDifference++,this.updateTitle()}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SAVED,function(){this.changeDifference=0,this.updateTitle()}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_UNDO_ROLLBACK,function(){this.changeDifference--,this.updateTitle()}.bind(this)),this.hasChanges=this._hasChanges.bind(this)},updateTitle:function(){var e=window.document.title||document.getElementsByTagName("title")[0].childNodes[0].nodeValue;0===this.changeDifference&&e.startsWith(this.changeSymbol)?window.document.title=e.slice(1):0===this.changeDifference||e.startsWith(this.changeSymbol)||(window.document.title=this.changeSymbol+""+e)},_hasChanges:function(){return 0!==this.changeDifference||this.facade.getModelMetaData()["new"]&&this.facade.getCanvas().getChildShapes().size()>0},onUnLoad:function(){return this._hasChanges()?ORYX.I18N.Save.unsavedData:void 0}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.DragDropResize=ORYX.Plugins.AbstractPlugin.extend({construct:function(e){this.facade=e,this.currentShapes=[],this.toMoveShapes=[],this.distPoints=[],this.isResizing=!1,this.dragEnable=!1,this.dragIntialized=!1,this.edgesMovable=!0,this.offSetPosition={x:0,y:0},this.faktorXY={x:1,y:1},this.containmentParentNode,this.isAddingAllowed=!1,this.isAttachingAllowed=!1,this.callbackMouseMove=this.handleMouseMove.bind(this),this.callbackMouseUp=this.handleMouseUp.bind(this);var t=this.facade.getCanvas().getSvgContainer();this.selectedRect=new ORYX.Plugins.SelectedRect(t),ORYX.CONFIG.SHOW_GRIDLINE&&(this.vLine=new ORYX.Plugins.GridLine(t,ORYX.Plugins.GridLine.DIR_VERTICAL),this.hLine=new ORYX.Plugins.GridLine(t,ORYX.Plugins.GridLine.DIR_HORIZONTAL)),t=this.facade.getCanvas().getHTMLContainer(),this.scrollNode=this.facade.getCanvas().rootNode.parentNode.parentNode,this.resizerSE=new ORYX.Plugins.Resizer(t,"southeast",this.facade),this.resizerSE.registerOnResize(this.onResize.bind(this)),this.resizerSE.registerOnResizeEnd(this.onResizeEnd.bind(this)),this.resizerSE.registerOnResizeStart(this.onResizeStart.bind(this)),this.resizerNW=new ORYX.Plugins.Resizer(t,"northwest",this.facade),this.resizerNW.registerOnResize(this.onResize.bind(this)),this.resizerNW.registerOnResizeEnd(this.onResizeEnd.bind(this)),this.resizerNW.registerOnResizeStart(this.onResizeStart.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this))},handleMouseDown:function(e,t){if(this.dragBounds&&this.currentShapes.member(t)&&this.toMoveShapes.length){this.dragEnable=!0,this.dragIntialized=!0,this.edgesMovable=!0;var i=this.facade.getCanvas().node.getScreenCTM();this.faktorXY.x=i.a,this.faktorXY.y=i.d;var o=Event.pointerX(e),n=Event.pointerY(e),r=this.dragBounds.upperLeft();this.offSetPosition={x:o-r.x*this.faktorXY.x,y:n-r.y*this.faktorXY.y},this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop},document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.callbackMouseMove,!1),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.callbackMouseUp,!0)}},handleMouseUp:function(e){if(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.contain"}),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.attached"}),this.dragEnable){if(!this.dragIntialized){if(this.afterDrag(),this.isAttachingAllowed&&1==this.toMoveShapes.length&&this.toMoveShapes[0]instanceof ORYX.Core.Node&&this.toMoveShapes[0].dockers.length>0){var t=this.facade.eventCoordinates(e),i=this.toMoveShapes[0].dockers[0],o=ORYX.Core.Command.extend({construct:function(e,t,i,o){this.docker=e,this.newPosition=t,this.newDockedShape=i,this.newParent=i.parent||o.getCanvas(),this.oldPosition=e.parent.bounds.center(),this.oldDockedShape=e.getDockedShape(),this.oldParent=e.parent.parent||o.getCanvas(),this.facade=o,this.oldDockedShape&&(this.oldPosition=e.parent.absoluteBounds().center())},execute:function(){this.dock(this.newDockedShape,this.newParent,this.newPosition),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_ARRANGEMENT_TOP,excludeCommand:!0})},rollback:function(){this.dock(this.oldDockedShape,this.oldParent,this.oldPosition)},dock:function(e,t,i){t.add(this.docker.parent),this.docker.setDockedShape(void 0),this.docker.bounds.centerMoveTo(i),this.docker.setDockedShape(e),this.facade.setSelection([this.docker.parent]),this.facade.getCanvas().update(),this.facade.updateSelection()}}),n=[new o(i,t,this.containmentParentNode,this.facade)];this.facade.executeCommands(n)}else this.isAddingAllowed&&this.refreshSelectedShapes();this.facade.updateSelection(),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDROP_END})}this.vLine&&this.vLine.hide(),this.hLine&&this.hLine.hide()}this.dragEnable=!1,document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.callbackMouseUp,!0),document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.callbackMouseMove,!1)},handleMouseMove:function(e){if(this.dragEnable){this.dragIntialized&&(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDROP_START}),this.dragIntialized=!1,this.resizerSE.hide(),this.resizerNW.hide(),this._onlyEdges=this.currentShapes.all(function(e){return e instanceof ORYX.Core.Edge}),this.beforeDrag(),this._currentUnderlyingNodes=[]);var t={x:Event.pointerX(e)-this.offSetPosition.x,y:Event.pointerY(e)-this.offSetPosition.y};t.x-=this.offsetScroll.x-this.scrollNode.scrollLeft,t.y-=this.offsetScroll.y-this.scrollNode.scrollTop;var i=e.shiftKey||e.ctrlKey;ORYX.CONFIG.GRID_ENABLED&&!i?t=this.snapToGrid(t):(this.vLine&&this.vLine.hide(),this.hLine&&this.hLine.hide()),t.x/=this.faktorXY.x,t.y/=this.faktorXY.y,t.x=Math.max(0,t.x),t.y=Math.max(0,t.y);var o=this.facade.getCanvas();t.x=Math.min(o.bounds.width()-this.dragBounds.width(),t.x),t.y=Math.min(o.bounds.height()-this.dragBounds.height(),t.y),this.dragBounds.moveTo(t),this.resizeRectangle(this.dragBounds),this.isAttachingAllowed=!1;var n=this.facade.eventCoordinates(e),r=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var a=navigator.userAgent;if(a.indexOf("MSIE")>=0){var s=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==s&&(r=s/100)}}1!==r&&(n.x=n.x/r,n.y=n.y/r);var l=$A(this.facade.getCanvas().getAbstractShapesAtPosition(n)),d=1==this.toMoveShapes.length&&this.toMoveShapes[0]instanceof ORYX.Core.Node&&this.toMoveShapes[0].dockers.length>0;if(d=d&&1!=l.length,d||l.length!==this._currentUnderlyingNodes.length||!l.all(function(e,t){return this._currentUnderlyingNodes[t]===e}.bind(this))){if(this._onlyEdges)this.isAddingAllowed=!0,this.containmentParentNode=this.facade.getCanvas();
else{var c={event:e,underlyingNodes:l,checkIfAttachable:d};this.checkRules(c)}this._currentUnderlyingNodes=l.reverse(),this.isAttachingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.attached",elements:[this.containmentParentNode],style:ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE,color:ORYX.CONFIG.SELECTION_VALID_COLOR}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.attached"}),this.isAttachingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.contain"}):this.isAddingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.contain",elements:[this.containmentParentNode],color:ORYX.CONFIG.SELECTION_VALID_COLOR}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.contain",elements:[this.containmentParentNode],color:ORYX.CONFIG.SELECTION_INVALID_COLOR})}}},checkRules:function(e){var t=e.event,i=e.underlyingNodes,o=e.checkIfAttachable,n=e.noEdges;if(this.containmentParentNode=i.reverse().find(function(e){return e instanceof ORYX.Core.Canvas||(e instanceof ORYX.Core.Node||e instanceof ORYX.Core.Edge&&!n)&&!(this.currentShapes.member(e)||this.currentShapes.any(function(t){return t.children.length>0&&t.getChildNodes(!0).member(e)}))}.bind(this)),o&&(this.isAttachingAllowed=this.facade.getRules().canConnect({sourceShape:this.containmentParentNode,edgeShape:this.toMoveShapes[0],targetShape:this.toMoveShapes[0]}),this.isAttachingAllowed)){var r=this.facade.eventCoordinates(t);this.isAttachingAllowed=this.containmentParentNode.isPointOverOffset(r.x,r.y)}this.isAttachingAllowed||(this.isAddingAllowed=this.toMoveShapes.all(function(e){return e instanceof ORYX.Core.Edge||e instanceof ORYX.Core.Controls.Docker||this.containmentParentNode===e.parent?!0:this.containmentParentNode===e||this.containmentParentNode instanceof ORYX.Core.Edge&&n||!this.facade.getRules().canContain({containingShape:this.containmentParentNode,containedShape:e})?!1:!0}.bind(this))),!this.isAttachingAllowed&&!this.isAddingAllowed&&this.containmentParentNode instanceof ORYX.Core.Edge&&(e.noEdges=!0,e.underlyingNodes.reverse(),this.checkRules(e))},refreshSelectedShapes:function(){if(this.dragBounds){var e=this.dragBounds.upperLeft(),t=this.oldDragBounds.upperLeft(),i={x:e.x-t.x,y:e.y-t.y},o=[new ORYX.Core.Command.Move(this.toMoveShapes,i,this.containmentParentNode,this.currentShapes,this)];this._undockedEdgesCommand instanceof ORYX.Core.Command&&o.unshift(this._undockedEdgesCommand),this.facade.executeCommands(o),this.dragBounds&&(this.oldDragBounds=this.dragBounds.clone())}},onResize:function(e){this.dragBounds&&(this.dragBounds=e,this.isResizing=!0,this.resizeRectangle(this.dragBounds))},onResizeStart:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_RESIZE_START})},onResizeEnd:function(){if(this.currentShapes instanceof Array&&!(0>=this.currentShapes.length)&&this.isResizing){var e=ORYX.Core.Command.extend({construct:function(e,t,i){this.shape=e,this.oldBounds=e.bounds.clone(),this.newBounds=t,this.plugin=i},execute:function(){this.shape.bounds.set(this.newBounds.a,this.newBounds.b),this.update(this.getOffset(this.oldBounds,this.newBounds))},rollback:function(){this.shape.bounds.set(this.oldBounds.a,this.oldBounds.b),this.update(this.getOffset(this.newBounds,this.oldBounds))},getOffset:function(e,t){return{x:t.a.x-e.a.x,y:t.a.y-e.a.y,xs:t.width()/e.width(),ys:t.height()/e.height()}},update:function(e){this.shape.getLabels().each(function(e){e.changed()});var t=[].concat(this.shape.getIncomingShapes()).concat(this.shape.getOutgoingShapes()).findAll(function(e){return e instanceof ORYX.Core.Edge}.bind(this));this.plugin.layoutEdges(this.shape,t,e),this.plugin.facade.setSelection([this.shape]),this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection()}}),t=this.dragBounds.clone(),i=this.currentShapes[0];if(i.parent){var o=i.parent.absoluteXY();t.moveBy(-o.x,-o.y)}var n=new e(i,t,this);this.facade.executeCommands([n]),this.isResizing=!1,this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_RESIZE_END})}},beforeDrag:function(){var e=ORYX.Core.Command.extend({construct:function(e){this.dockers=e.collect(function(e){return e instanceof ORYX.Core.Controls.Docker?{docker:e,dockedShape:e.getDockedShape(),refPoint:e.referencePoint}:void 0}).compact()},execute:function(){this.dockers.each(function(e){e.docker.setDockedShape(void 0)})},rollback:function(){this.dockers.each(function(e){e.docker.setDockedShape(e.dockedShape),e.docker.setReferencePoint(e.refPoint)})}});this._undockedEdgesCommand=new e(this.toMoveShapes),this._undockedEdgesCommand.execute()},hideAllLabels:function(e){e.getLabels().each(function(e){e.hide()}),e.getAllDockedShapes().each(function(e){var t=e.getLabels();t.length>0&&t.each(function(e){e.hide()})}),e.getChildren().each(function(e){e instanceof ORYX.Core.Shape&&this.hideAllLabels(e)}.bind(this))},afterDrag:function(){},showAllLabels:function(e){for(var t=0;e.length>t;t++){var i=e[t];i.show()}for(var o=e.getAllDockedShapes(),t=0;o.length>t;t++){var n=o[t],r=n.getLabels();r.length>0&&r.each(function(e){e.show()})}for(var t=0;e.children.length>t;t++){var a=e.children[t];a instanceof ORYX.Core.Shape&&this.showAllLabels(a)}},onSelectionChanged:function(e){var t=e.elements;if(this.dragEnable=!1,this.dragIntialized=!1,this.resizerSE.hide(),this.resizerNW.hide(),t&&0!=t.length){this.currentShapes=t;var i=this.facade.getCanvas().getShapesWithSharedParent(t);this.toMoveShapes=i,this.toMoveShapes=this.toMoveShapes.findAll(function(e){return e instanceof ORYX.Core.Node&&(0===e.dockers.length||!t.member(e.dockers.first().getDockedShape()))}),t.each(function(e){if(e instanceof ORYX.Core.Edge){var i=e.getDockers(),o=t.member(i.first().getDockedShape()),n=t.member(i.last().getDockedShape());if(!o&&!n){var r=!i.first().getDockedShape()&&!i.last().getDockedShape();r&&(this.toMoveShapes=this.toMoveShapes.concat(i))}e.dockers.length>2&&o&&n&&(this.toMoveShapes=this.toMoveShapes.concat(i.findAll(function(e,t){return t>0&&i.length-1>t})))}}.bind(this));var o=void 0;if(this.toMoveShapes.each(function(e){var t=e;e instanceof ORYX.Core.Controls.Docker&&(t=e.parent),o?o.include(t.absoluteBounds()):o=t.absoluteBounds()}.bind(this)),o||t.each(function(e){o?o.include(e.absoluteBounds()):o=e.absoluteBounds()}),this.dragBounds=o,this.oldDragBounds=o.clone(),this.resizeRectangle(o),this.selectedRect.show(),1==t.length&&t[0].isResizable){var n=t[0].getStencil().fixedAspectRatio()?t[0].bounds.width()/t[0].bounds.height():void 0;this.resizerSE.setBounds(this.dragBounds,t[0].minimumSize,t[0].maximumSize,n),this.resizerSE.show(),this.resizerNW.setBounds(this.dragBounds,t[0].minimumSize,t[0].maximumSize,n),this.resizerNW.show()}else this.resizerSE.setBounds(void 0),this.resizerNW.setBounds(void 0);ORYX.CONFIG.GRID_ENABLED&&(this.distPoints=[],this.distPointTimeout&&window.clearTimeout(this.distPointTimeout),this.distPointTimeout=window.setTimeout(function(){var e=this.facade.getCanvas().getChildShapes(!0).findAll(function(e){for(var i=e.parent;i;){if(t.member(i))return!1;i=i.parent}return!0});e.each(function(e){if(!(e instanceof ORYX.Core.Edge)){var t=e.absoluteXY(),i=e.bounds.width(),o=e.bounds.height();this.distPoints.push({ul:{x:t.x,y:t.y},c:{x:t.x+i/2,y:t.y+o/2},lr:{x:t.x+i,y:t.y+o}})}}.bind(this))}.bind(this),10))}else this.selectedRect.hide(),this.currentShapes=[],this.toMoveShapes=[],this.dragBounds=void 0,this.oldDragBounds=void 0},snapToGrid:function(e){var t=this.dragBounds,i=10,o=this.vLine?this.vLine.getScale():1,n={x:e.x/o,y:e.y/o},r={x:e.x/o+t.width()/2,y:e.y/o+t.height()/2};({x:e.x/o+t.width(),y:e.y/o+t.height()});var a,s,l,d;return this.distPoints.each(function(e){var t,o,n,c;i>Math.abs(e.c.x-r.x)&&(t=e.c.x-r.x,n=e.c.x),i>Math.abs(e.c.y-r.y)&&(o=e.c.y-r.y,c=e.c.y),void 0!==t&&(a=void 0===a?t:Math.abs(t)<Math.abs(a)?t:a,a===t&&(l=n)),void 0!==o&&(s=void 0===s?o:Math.abs(o)<Math.abs(s)?o:s,s===o&&(d=c))}),void 0!==a?(n.x+=a,n.x*=o,this.vLine&&l&&this.vLine.update(l)):(n.x=e.x-e.x%(ORYX.CONFIG.GRID_DISTANCE/2),this.vLine&&this.vLine.hide()),void 0!==s?(n.y+=s,n.y*=o,this.hLine&&d&&this.hLine.update(d)):(n.y=e.y-e.y%(ORYX.CONFIG.GRID_DISTANCE/2),this.hLine&&this.hLine.hide()),n},showGridLine:function(){},resizeRectangle:function(e){this.selectedRect.resize(e)}}),ORYX.Plugins.SelectedRect=Clazz.extend({construct:function(e){this.parentId=e,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",$(e),["g"]),this.dashedArea=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["rect",{x:0,y:0,"stroke-width":1,stroke:"#777777",fill:"none","stroke-dasharray":"2,2","pointer-events":"none"}]),this.hide()},hide:function(){this.node.setAttributeNS(null,"display","none")},show:function(){this.node.setAttributeNS(null,"display","")},resize:function(e){var t=e.upperLeft(),i=ORYX.CONFIG.SELECTED_AREA_PADDING;this.dashedArea.setAttributeNS(null,"width",e.width()+2*i),this.dashedArea.setAttributeNS(null,"height",e.height()+2*i),this.node.setAttributeNS(null,"transform","translate("+(t.x-i)+", "+(t.y-i)+")")}}),ORYX.Plugins.GridLine=Clazz.extend({construct:function(e,t){ORYX.Plugins.GridLine.DIR_HORIZONTAL!==t&&ORYX.Plugins.GridLine.DIR_VERTICAL!==t&&(t=ORYX.Plugins.GridLine.DIR_HORIZONTAL),this.parent=$(e),this.direction=t,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.parent,["g"]),this.line=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["path",{"stroke-width":1,stroke:"silver",fill:"none","stroke-dasharray":"5,5","pointer-events":"none"}]),this.hide()},hide:function(){this.node.setAttributeNS(null,"display","none")},show:function(){this.node.setAttributeNS(null,"display","")},getScale:function(){try{return this.parent.parentNode.transform.baseVal.getItem(0).matrix.a}catch(e){return 1}},update:function(e){if(this.direction===ORYX.Plugins.GridLine.DIR_HORIZONTAL){var t=e instanceof Object?e.y:e,i=this.parent.parentNode.parentNode.width.baseVal.value/this.getScale();this.line.setAttributeNS(null,"d","M 0 "+t+" L "+i+" "+t)}else{var o=e instanceof Object?e.x:e,n=this.parent.parentNode.parentNode.height.baseVal.value/this.getScale();this.line.setAttributeNS(null,"d","M"+o+" 0 L "+o+" "+n)}this.show()}}),ORYX.Plugins.GridLine.DIR_HORIZONTAL="hor",ORYX.Plugins.GridLine.DIR_VERTICAL="ver",ORYX.Plugins.Resizer=Clazz.extend({construct:function(e,t,i){this.parentId=e,this.orientation=t,this.facade=i,this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",$("canvasSection"),["div",{"class":"resizer_"+this.orientation,style:"left:0px; top:0px;position:absolute;"}]),this.node.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this),!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.handleMouseUp.bind(this),!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.handleMouseMove.bind(this),!1),this.dragEnable=!1,this.offSetPosition={x:0,y:0},this.bounds=void 0,this.canvasNode=this.facade.getCanvas().node,this.minSize=void 0,this.maxSize=void 0,this.aspectRatio=void 0,this.resizeCallbacks=[],this.resizeStartCallbacks=[],this.resizeEndCallbacks=[],this.hide(),this.scrollNode=this.node.parentNode.parentNode.parentNode},handleMouseDown:function(e){this.dragEnable=!0,this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop},this.offSetPosition={x:Event.pointerX(e)-this.position.x,y:Event.pointerY(e)-this.position.y},this.resizeStartCallbacks.each(function(e){e(this.bounds)}.bind(this))},handleMouseUp:function(){this.dragEnable=!1,this.containmentParentNode=null,this.resizeEndCallbacks.each(function(e){e(this.bounds)}.bind(this))},handleMouseMove:function(e){if(this.dragEnable){this.aspectRatio=e.shiftKey||e.ctrlKey?this.bounds.width()/this.bounds.height():void 0;var t={x:Event.pointerX(e)-this.offSetPosition.x,y:Event.pointerY(e)-this.offSetPosition.y};t.x-=this.offsetScroll.x-this.scrollNode.scrollLeft,t.y-=this.offsetScroll.y-this.scrollNode.scrollTop,t.x=Math.min(t.x,this.facade.getCanvas().bounds.width()),t.y=Math.min(t.y,this.facade.getCanvas().bounds.height());var i={x:t.x-this.position.x,y:t.y-this.position.y};this.aspectRatio&&(newAspectRatio=(this.bounds.width()+i.x)/(this.bounds.height()+i.y),newAspectRatio>this.aspectRatio?i.x=this.aspectRatio*(this.bounds.height()+i.y)-this.bounds.width():this.aspectRatio>newAspectRatio&&(i.y=(this.bounds.width()+i.x)/this.aspectRatio-this.bounds.height())),"northwest"===this.orientation?(this.bounds.width()-i.x>this.maxSize.width&&(i.x=-(this.maxSize.width-this.bounds.width()),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.width()-i.x<this.minSize.width&&(i.x=-(this.minSize.width-this.bounds.width()),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.height()-i.y>this.maxSize.height&&(i.y=-(this.maxSize.height-this.bounds.height()),this.aspectRatio&&(i.x=i.y/this.aspectRatio)),this.bounds.height()-i.y<this.minSize.height&&(i.y=-(this.minSize.height-this.bounds.height()),this.aspectRatio&&(i.x=i.y/this.aspectRatio))):(this.bounds.width()+i.x>this.maxSize.width&&(i.x=this.maxSize.width-this.bounds.width(),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.width()+i.x<this.minSize.width&&(i.x=this.minSize.width-this.bounds.width(),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.height()+i.y>this.maxSize.height&&(i.y=this.maxSize.height-this.bounds.height(),this.aspectRatio&&(i.x=i.y/this.aspectRatio)),this.bounds.height()+i.y<this.minSize.height&&(i.y=this.minSize.height-this.bounds.height(),this.aspectRatio&&(i.x=i.y/this.aspectRatio))),"northwest"===this.orientation?(this.bounds.extend({x:-i.x,y:-i.y}),this.bounds.moveBy(i)):this.bounds.extend(i),this.update(),this.resizeCallbacks.each(function(e){e(this.bounds)}.bind(this)),Event.stop(e)}},registerOnResizeStart:function(e){this.resizeStartCallbacks.member(e)||this.resizeStartCallbacks.push(e)},unregisterOnResizeStart:function(e){this.resizeStartCallbacks.member(e)&&(this.resizeStartCallbacks=this.resizeStartCallbacks.without(e))},registerOnResizeEnd:function(e){this.resizeEndCallbacks.member(e)||this.resizeEndCallbacks.push(e)},unregisterOnResizeEnd:function(e){this.resizeEndCallbacks.member(e)&&(this.resizeEndCallbacks=this.resizeEndCallbacks.without(e))},registerOnResize:function(e){this.resizeCallbacks.member(e)||this.resizeCallbacks.push(e)},unregisterOnResize:function(e){this.resizeCallbacks.member(e)&&(this.resizeCallbacks=this.resizeCallbacks.without(e))},hide:function(){this.node.style.display="none"},show:function(){this.bounds&&(this.node.style.display="")},setBounds:function(e,t,i,o){this.bounds=e,t||(t={width:ORYX.CONFIG.MINIMUM_SIZE,height:ORYX.CONFIG.MINIMUM_SIZE}),i||(i={width:ORYX.CONFIG.MAXIMUM_SIZE,height:ORYX.CONFIG.MAXIMUM_SIZE}),this.minSize=t,this.maxSize=i,this.aspectRatio=o,this.update()},update:function(){if(this.bounds){var e=this.bounds.upperLeft();this.bounds.width()<this.minSize.width&&this.bounds.set(e.x,e.y,e.x+this.minSize.width,e.y+this.bounds.height()),this.bounds.height()<this.minSize.height&&this.bounds.set(e.x,e.y,e.x+this.bounds.width(),e.y+this.minSize.height),this.bounds.width()>this.maxSize.width&&this.bounds.set(e.x,e.y,e.x+this.maxSize.width,e.y+this.bounds.height()),this.bounds.height()>this.maxSize.height&&this.bounds.set(e.x,e.y,e.x+this.bounds.width(),e.y+this.maxSize.height);var t=this.canvasNode.getScreenCTM();e.x*=t.a,e.y*=t.d;var i=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var o=navigator.userAgent;if(o.indexOf("MSIE")>=0){var n=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==n&&(i=n/100)}}if(1===i)e.y=e.y-jQuery("#canvasSection").offset().top+t.f,e.x=e.x-jQuery("#canvasSection").offset().left+t.e;else{var r=jQuery("#canvasSection").offset().left,a=jQuery("#canvasSection").scrollLeft(),s=jQuery("#canvasSection").scrollTop(),l=t.e-r*i,d=0;l>10&&(d=l/i-l),e.y=e.y-jQuery("#canvasSection").offset().top*i+(s*i-s)+t.f,e.x=e.x-r*i+d+(a*i-a)+t.e}"northwest"===this.orientation?(e.x-=13,e.y-=13):(e.x+=t.a*this.bounds.width()+3,e.y+=t.d*this.bounds.height()+3),this.position=e,this.node.style.left=this.position.x+"px",this.node.style.top=this.position.y+"px"}}}),ORYX.Core.Command.Move=ORYX.Core.Command.extend({construct:function(e,t,i,o,n){this.moveShapes=e,this.selectedShapes=o,this.offset=t,this.plugin=n,this.newParents=e.collect(function(e){return i||e.parent}),this.oldParents=e.collect(function(e){return e.parent}),this.dockedNodes=e.findAll(function(e){return e instanceof ORYX.Core.Node&&1==e.dockers.length}).collect(function(e){return{docker:e.dockers[0],dockedShape:e.dockers[0].getDockedShape(),refPoint:e.dockers[0].referencePoint}})},execute:function(){this.dockAllShapes(),this.move(this.offset),this.addShapeToParent(this.newParents),this.selectCurrentShapes(),this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection()},rollback:function(){var e={x:-this.offset.x,y:-this.offset.y};this.move(e),this.addShapeToParent(this.oldParents),this.dockAllShapes(!0),this.selectCurrentShapes(),this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection()},move:function(e){for(var t=0;this.moveShapes.length>t;t++){var i=this.moveShapes[t];if(i.bounds.moveBy(e),i instanceof ORYX.Core.Node){(i.dockers||[]).each(function(t){t.bounds.moveBy(e)});var o=[].concat(i.getIncomingShapes()).concat(i.getOutgoingShapes()).findAll(function(e){return e instanceof ORYX.Core.Edge&&!this.moveShapes.any(function(t){return t==e||t instanceof ORYX.Core.Controls.Docker&&t.parent==e})}.bind(this)).findAll(function(e){return!(e.dockers.first().getDockedShape()!=i&&this.moveShapes.include(e.dockers.first().getDockedShape())||e.dockers.last().getDockedShape()!=i&&this.moveShapes.include(e.dockers.last().getDockedShape()))}.bind(this));this.plugin.layoutEdges(i,o,e);for(var n=[].concat(i.getIncomingShapes()).concat(i.getOutgoingShapes()).findAll(function(e){return e instanceof ORYX.Core.Edge&&e.dockers.first().isDocked()&&e.dockers.last().isDocked()&&!this.moveShapes.include(e)&&!this.moveShapes.any(function(t){return t==e||t instanceof ORYX.Core.Controls.Docker&&t.parent==e})}.bind(this)).findAll(function(e){return this.moveShapes.indexOf(e.dockers.first().getDockedShape())>t||this.moveShapes.indexOf(e.dockers.last().getDockedShape())>t}.bind(this)),r=0;n.length>r;r++)for(var a=1;n[r].dockers.length-1>a;a++){var s=n[r].dockers[a];s.getDockedShape()||this.moveShapes.include(s)||s.bounds.moveBy(e)}}}},dockAllShapes:function(e){for(var t=0;this.dockedNodes.length>t;t++){var i=this.dockedNodes[t].docker;i.setDockedShape(e?this.dockedNodes[t].dockedShape:void 0),i.getDockedShape()&&i.setReferencePoint(this.dockedNodes[t].refPoint)}},addShapeToParent:function(e){for(var t=0;this.moveShapes.length>t;t++){var i=this.moveShapes[t];if(i instanceof ORYX.Core.Node&&i.parent!==e[t]){var o=e[t].absoluteXY(),n=i.absoluteXY(),r=n.x-o.x,a=n.y-o.y;if(e[t].add(i),i.getOutgoingShapes(function(i){i instanceof ORYX.Core.Node&&!this.moveShapes.member(i)&&e[t].add(i)}.bind(this)),i instanceof ORYX.Core.Node&&1==i.dockers.length){var s=i.bounds;r+=s.width()/2,a+=s.height()/2,i.dockers.first().bounds.centerMoveTo(r,a)}else i.bounds.moveTo(r,a)}}},selectCurrentShapes:function(){this.plugin.facade.setSelection(this.selectedShapes)}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.DragDocker=Clazz.extend({construct:function(e){this.facade=e,this.VALIDCOLOR=ORYX.CONFIG.SELECTION_VALID_COLOR,this.INVALIDCOLOR=ORYX.CONFIG.SELECTION_INVALID_COLOR,this.shapeSelection=void 0,this.docker=void 0,this.dockerParent=void 0,this.dockerSource=void 0,this.dockerTarget=void 0,this.lastUIObj=void 0,this.isStartDocker=void 0,this.isEndDocker=void 0,this.undockTreshold=10,this.initialDockerPosition=void 0,this.outerDockerNotMoved=void 0,this.isValid=!1,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DOCKERDRAG,this.handleDockerDrag.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEOVER,this.handleMouseOver.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEOUT,this.handleMouseOut.bind(this))},handleMouseOut:function(e,t){!this.docker&&t instanceof ORYX.Core.Controls.Docker?t.hide():!this.docker&&t instanceof ORYX.Core.Edge&&t.dockers.each(function(e){e.hide()})},handleMouseOver:function(e,t){!this.docker&&t instanceof ORYX.Core.Controls.Docker?t.show():!this.docker&&t instanceof ORYX.Core.Edge&&t.dockers.each(function(e){e.show()})},handleDockerDrag:function(e,t){this.handleMouseDown(e.uiEvent,t)},handleMouseDown:function(e,t){if(t instanceof ORYX.Core.Controls.Docker&&t.isMovable){this.shapeSelection=this.facade.getSelection(),this.facade.setSelection(),this.docker=t,this.initialDockerPosition=this.docker.bounds.center(),this.outerDockerNotMoved=!1,this.dockerParent=t.parent,this._commandArg={docker:t,dockedShape:t.getDockedShape(),refPoint:t.referencePoint||t.bounds.center()},this.docker.show(),t.parent instanceof ORYX.Core.Edge&&(t.parent.dockers.first()==t||t.parent.dockers.last()==t)?t.parent.dockers.first()==t&&t.parent.dockers.last().getDockedShape()?this.dockerTarget=t.parent.dockers.last().getDockedShape():t.parent.dockers.last()==t&&t.parent.dockers.first().getDockedShape()&&(this.dockerSource=t.parent.dockers.first().getDockedShape()):(this.dockerSource=void 0,this.dockerTarget=void 0),this.isStartDocker=this.docker.parent.dockers.first()===this.docker,this.isEndDocker=this.docker.parent.dockers.last()===this.docker,this.facade.getCanvas().add(this.docker.parent),this.docker.parent.getLabels().each(function(e){e.hide()});var i=this.facade.eventCoordinates(e),o=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var n=navigator.userAgent;if(n.indexOf("MSIE")>=0){var r=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==r&&(o=r/100)}}1!==o&&(i.x=i.x/o,i.y=i.y/o),(this.isStartDocker||this.isEndDocker)&&this.docker.isDocked()?this.outerDockerNotMoved=!0:(this.docker.setDockedShape(void 0),this.docker.bounds.centerMoveTo(i),this.dockerParent._update());var a={movedCallback:this.dockerMoved.bind(this),upCallback:this.dockerMovedFinished.bind(this)};this.startEventPos=i,ORYX.Core.UIEnableDrag(e,t,a)}},dockerMoved:function(e){this.outerDockerNotMoved=!1;var t=void 0;if(this.docker.parent&&(this.isStartDocker||this.isEndDocker)){var i=this.facade.eventCoordinates(e),o=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var n=navigator.userAgent;if(n.indexOf("MSIE")>=0){var r=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==r&&(o=r/100)}}if(1!==o&&(i.x=i.x/o,i.y=i.y/o),this.docker.isDocked()){var a=ORYX.Core.Math.getDistancePointToPoint(i,this.initialDockerPosition);if(this.undockTreshold>a)return this.outerDockerNotMoved=!0,void 0;this.docker.setDockedShape(void 0),this.dockerParent._update()}var s=this.facade.getCanvas().getAbstractShapesAtPosition(i),l=s.pop();if(this.docker.parent===l&&(l=s.pop()),this.lastUIObj==l);else if(l instanceof ORYX.Core.Shape){if(this.docker.parent instanceof ORYX.Core.Edge){var d=this.getHighestParentBeforeCanvas(l);if(d instanceof ORYX.Core.Edge&&this.docker.parent===d)return this.isValid=!1,this.dockerParent._update(),void 0;this.isValid=!1;for(var c=l,p=l;!this.isValid&&c&&!(c instanceof ORYX.Core.Canvas);)l=c,this.isValid=this.facade.getRules().canConnect({sourceShape:this.dockerSource?this.dockerSource:this.isStartDocker?l:void 0,edgeShape:this.docker.parent,targetShape:this.dockerTarget?this.dockerTarget:this.isEndDocker?l:void 0}),c=c.parent;this.isValid||(l=p)}else this.isValid=this.facade.getRules().canConnect({sourceShape:l,edgeShape:this.docker.parent,targetShape:this.docker.parent});this.lastUIObj&&this.hideMagnets(this.lastUIObj),this.isValid&&this.showMagnets(l),this.showHighlight(l,this.isValid?this.VALIDCOLOR:this.INVALIDCOLOR),this.lastUIObj=l}else this.hideHighlight(),this.lastUIObj?this.hideMagnets(this.lastUIObj):null,this.lastUIObj=void 0,this.isValid=!1;this.lastUIObj&&this.isValid&&!e.shiftKey&&!e.ctrlKey&&(t=this.lastUIObj.magnets.find(function(e){return e.absoluteBounds().isIncluded(i)}),t&&this.docker.bounds.centerMoveTo(t.absoluteCenterXY()))}if(!e.shiftKey&&!e.ctrlKey&&!t){var u=ORYX.CONFIG.DOCKER_SNAP_OFFSET,m=u+1,h=u+1,f=this.docker.bounds.center();if(this.docker.parent)if(this.docker.parent.dockers.each(function(e){if(this.docker!=e){var t=e.referencePoint?e.getAbsoluteReferencePoint():e.bounds.center();m=Math.abs(m)>Math.abs(t.x-f.x)?t.x-f.x:m,h=Math.abs(h)>Math.abs(t.y-f.y)?t.y-f.y:h}}.bind(this)),u>Math.abs(m)||u>Math.abs(h))m=u>Math.abs(m)?m:0,h=u>Math.abs(h)?h:0,this.docker.bounds.centerMoveTo(f.x+m,f.y+h);else{var g=this.docker.parent.dockers[Math.max(this.docker.parent.dockers.indexOf(this.docker)-1,0)],v=this.docker.parent.dockers[Math.min(this.docker.parent.dockers.indexOf(this.docker)+1,this.docker.parent.dockers.length-1)];if(g&&v&&g!==this.docker&&v!==this.docker){var S=g.bounds.center(),I=v.bounds.center(),O=this.docker.bounds.center();if(ORYX.Core.Math.isPointInLine(O.x,O.y,S.x,S.y,I.x,I.y,10)){var b=(Number(I.y)-Number(S.y))/(Number(I.x)-Number(S.x)),E=(S.y-S.x*b-(O.y-O.x*-Math.pow(b,-1)))/(-Math.pow(b,-1)-b),y=S.y-S.x*b+b*E;if(isNaN(E)||isNaN(y))return;this.docker.bounds.centerMoveTo(E,y)}}}}this.dockerParent._update()},dockerMovedFinished:function(e){if(this.facade.setSelection(this.shapeSelection),this.hideHighlight(),this.dockerParent.getLabels().each(function(e){e.show()}),this.lastUIObj&&(this.isStartDocker||this.isEndDocker)&&(this.isValid&&(this.docker.setDockedShape(this.lastUIObj),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED,docker:this.docker,parent:this.docker.parent,target:this.lastUIObj})),this.hideMagnets(this.lastUIObj)),this.docker.hide(),this.outerDockerNotMoved){var t=this.facade.eventCoordinates(e),i=this.facade.getCanvas().getAbstractShapesAtPosition(t),o=i.findAll(function(e){return e instanceof ORYX.Core.Node});i=o.length?o:i,this.facade.setSelection(i)}else{var n=ORYX.Core.Command.extend({construct:function(e,t,i,o,n,r){this.docker=e,this.index=e.parent.dockers.indexOf(e),this.newPosition=t,this.newDockedShape=o,this.oldPosition=i,this.oldDockedShape=n,this.facade=r,this.index=e.parent.dockers.indexOf(e),this.shape=e.parent},execute:function(){this.docker.parent||(this.docker=this.shape.dockers[this.index]),this.dock(this.newDockedShape,this.newPosition),this.removedDockers=this.shape.removeUnusedDockers(),this.facade.updateSelection()},rollback:function(){this.dock(this.oldDockedShape,this.oldPosition),(this.removedDockers||$H({})).each(function(e){this.shape.add(e.value,Number(e.key)),this.shape._update(!0)}.bind(this)),this.facade.updateSelection()},dock:function(e,t){this.docker.setDockedShape(void 0),e?(this.docker.setDockedShape(e),this.docker.setReferencePoint(t)):this.docker.bounds.centerMoveTo(t),this.facade.getCanvas().update()}});if(this.docker.parent){var r=new n(this.docker,this.docker.getDockedShape()?this.docker.referencePoint:this.docker.bounds.center(),this._commandArg.refPoint,this.docker.getDockedShape(),this._commandArg.dockedShape,this.facade);this.facade.executeCommands([r])}}this.docker=void 0,this.dockerParent=void 0,this.dockerSource=void 0,this.dockerTarget=void 0,this.lastUIObj=void 0},hideHighlight:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"validDockedShape"})},showHighlight:function(e,t){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"validDockedShape",elements:[e],color:t})},showMagnets:function(e){e.magnets.each(function(e){e.show()})},hideMagnets:function(e){e.magnets.each(function(e){e.hide()})},getHighestParentBeforeCanvas:function(e){if(!(e instanceof ORYX.Core.Shape))return void 0;for(var t=e.parent;t&&!(t.parent instanceof ORYX.Core.Canvas);)t=t.parent;return t}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.AddDocker=Clazz.extend({construct:function(e){this.facade=e,this.enableAdd=!1,this.enableRemove=!1,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this))},setEnableAdd:function(e){this.enableAdd=e,this.enableAdd?jQuery("#add-bendpoint-button").addClass("pressed"):(jQuery("#add-bendpoint-button").removeClass("pressed"),jQuery("#add-bendpoint-button").blur())},setEnableRemove:function(e){this.enableRemove=e,this.enableRemove?jQuery("#remove-bendpoint-button").addClass("pressed"):(jQuery("#remove-bendpoint-button").removeClass("pressed"),jQuery("#remove-bendpoint-button").blur())},enabledAdd:function(){return this.enableAdd},enabledRemove:function(){return this.enableRemove},handleMouseDown:function(e,t){this.enabledAdd()&&t instanceof ORYX.Core.Edge?(this.newDockerCommand({edge:t,position:this.facade.eventCoordinates(e)}),this.setEnableAdd(!1)):this.enabledRemove()&&t instanceof ORYX.Core.Controls.Docker&&t.parent instanceof ORYX.Core.Edge&&(this.newDockerCommand({edge:t.parent,docker:t}),this.setEnableRemove(!1)),document.body.style.cursor="default"},newDockerCommand:function(e){if(e.edge){var t=ORYX.Core.Command.extend({construct:function(e,t,i,o,n,r){this.addEnabled=e,this.deleteEnabled=t,this.edge=i,this.docker=o,this.pos=n,this.facade=r},execute:function(){this.addEnabled?this.docker?this.edge.add(this.docker,this.index):(this.docker=this.edge.addDocker(this.pos),this.index=this.edge.dockers.indexOf(this.docker)):this.deleteEnabled&&(this.index=this.edge.dockers.indexOf(this.docker),this.pos=this.docker.bounds.center(),this.edge.removeDocker(this.docker)),this.edge.getLabels().invoke("show"),this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.addEnabled?this.docker instanceof ORYX.Core.Controls.Docker&&this.edge.removeDocker(this.docker):this.deleteEnabled&&this.edge.add(this.docker,this.index),this.edge.getLabels().invoke("show"),this.facade.getCanvas().update(),this.facade.updateSelection()}}),i=new t(this.enabledAdd(),this.enabledRemove(),e.edge,e.docker,e.position,this.facade);this.facade.executeCommands([i])}}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.SelectionFrame=Clazz.extend({construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this)),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.handleMouseUp.bind(this),!0),this.position={x:0,y:0},this.size={width:0,height:0},this.offsetPosition={x:0,y:0},this.moveCallback=void 0,this.offsetScroll={x:0,y:0},this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",$("canvasSection"),["div",{"class":"Oryx_SelectionFrame"}]),this.hide()},handleMouseDown:function(e,t){if(t instanceof ORYX.Core.Canvas){var i=t.rootNode.parentNode.parentNode,o=this.facade.getCanvas().node.getScreenCTM();this.offsetPosition={x:o.e,y:o.f},this.setPos({x:Event.pointerX(e)-jQuery("#canvasSection").offset().left,y:Event.pointerY(e)-jQuery("#canvasSection").offset().top+5}),this.resize({width:0,height:0}),this.moveCallback=this.handleMouseMove.bind(this),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.moveCallback,!1),this.offsetScroll={x:i.scrollLeft,y:i.scrollTop},this.show()}Event.stop(e)},handleMouseUp:function(){if(this.moveCallback){this.hide(),document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.moveCallback,!1),this.moveCallback=void 0;var e=this.facade.getCanvas().node.getScreenCTM(),t={x:this.size.width>0?this.position.x:this.position.x+this.size.width,y:this.size.height>0?this.position.y:this.position.y+this.size.height},i={x:t.x+Math.abs(this.size.width),y:t.y+Math.abs(this.size.height)},o=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var n=navigator.userAgent;if(n.indexOf("MSIE")>=0){var r=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==r&&(o=r/100)}}if(1===o)t.x=t.x-(e.e-jQuery("#canvasSection").offset().left),t.y=t.y-(e.f-jQuery("#canvasSection").offset().top),i.x=i.x-(e.e-jQuery("#canvasSection").offset().left),i.y=i.y-(e.f-jQuery("#canvasSection").offset().top);
else{var a=jQuery("#canvasSection").offset().left,s=jQuery("#canvasSection").scrollLeft(),l=jQuery("#canvasSection").scrollTop(),d=t.e-a*o,c=0;d>10&&(c=d/o-d),t.x=t.x-(e.e-a*o+c+(s*o-s)),t.y=t.y-(e.f-jQuery("#canvasSection").offset().top*o+(l*o-l)),i.x=i.x-(e.e-a*o+c+(s*o-s)),i.y=i.y-(e.f-jQuery("#canvasSection").offset().top*o+(l*o-l))}t.x/=e.a,t.y/=e.d,i.x/=e.a,i.y/=e.d;var p=this.facade.getCanvas().getChildShapes(!0).findAll(function(e){var o=e.absoluteBounds(),n=o.upperLeft(),r=o.lowerRight();return n.x>t.x&&n.y>t.y&&r.x<i.x&&r.y<i.y?!0:!1});this.facade.setSelection(p)}},handleMouseMove:function(e){var t={width:Event.pointerX(e)-this.position.x-jQuery("#canvasSection").offset().left,height:Event.pointerY(e)-this.position.y-jQuery("#canvasSection").offset().top+5},i=this.facade.getCanvas().rootNode.parentNode.parentNode;t.width-=this.offsetScroll.x-i.scrollLeft,t.height-=this.offsetScroll.y-i.scrollTop,this.resize(t),Event.stop(e)},hide:function(){this.node.style.display="none"},show:function(){this.node.style.display=""},setPos:function(e){this.node.style.top=e.y+"px",this.node.style.left=e.x+"px",this.position=e},resize:function(e){this.setPos(this.position),this.size=Object.clone(e),0>e.width&&(this.node.style.left=this.position.x+e.width+"px",e.width=-e.width),0>e.height&&(this.node.style.top=this.position.y+e.height+"px",e.height=-e.height),this.node.style.width=e.width+"px",this.node.style.height=e.height+"px"}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.ShapeHighlighting=Clazz.extend({construct:function(e){this.parentNode=e.getCanvas().getSvgContainer(),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.parentNode,["g"]),this.highlightNodes={},e.registerOnEvent(ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,this.setHighlight.bind(this)),e.registerOnEvent(ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,this.hideHighlight.bind(this))},setHighlight:function(e){if(e&&e.highlightId){var t=this.highlightNodes[e.highlightId];t||(t=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["path",{"stroke-width":2,fill:"none"}]),this.highlightNodes[e.highlightId]=t),e.elements&&e.elements.length>0?(this.setAttributesByStyle(t,e),this.show(t)):this.hide(t)}},hideHighlight:function(e){e&&e.highlightId&&this.highlightNodes[e.highlightId]&&this.hide(this.highlightNodes[e.highlightId])},hide:function(e){e.setAttributeNS(null,"display","none")},show:function(e){e.setAttributeNS(null,"display","")},setAttributesByStyle:function(e,t){if(t.style&&t.style==ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE){var i=t.elements[0].absoluteBounds(),o=t.strokewidth?t.strokewidth:ORYX.CONFIG.BORDER_OFFSET;e.setAttributeNS(null,"d",this.getPathRectangle(i.a,i.b,o)),e.setAttributeNS(null,"stroke",t.color?t.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),e.setAttributeNS(null,"stroke-opacity",t.opacity?t.opacity:.2),e.setAttributeNS(null,"stroke-width",o)}else if(1==t.elements.length&&t.elements[0]instanceof ORYX.Core.Edge&&"selection"!=t.highlightId){var n=this.getPathEdge(t.elements[0].dockers);n&&n.length>0&&e.setAttributeNS(null,"d",n),e.setAttributeNS(null,"stroke",t.color?t.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),e.setAttributeNS(null,"stroke-opacity",t.opacity?t.opacity:.2),e.setAttributeNS(null,"stroke-width",ORYX.CONFIG.OFFSET_EDGE_BOUNDS)}else{var n=this.getPathByElements(t.elements);n&&n.length>0&&e.setAttributeNS(null,"d",n),e.setAttributeNS(null,"stroke",t.color?t.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),e.setAttributeNS(null,"stroke-opacity",t.opacity?t.opacity:1),e.setAttributeNS(null,"stroke-width",t.strokewidth?t.strokewidth:2)}},getPathByElements:function(e){if(!e||0>=e.length)return void 0;var t=ORYX.CONFIG.SELECTED_AREA_PADDING,i="";return e.each(function(e){if(e){var o=e.absoluteBounds();o.widen(t);var n=o.upperLeft(),r=o.lowerRight();i+=this.getPath(n,r)}}.bind(this)),i},getPath:function(e,t){return this.getPathCorners(e,t)},getPathCorners:function(e,t){var i=ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE,o="";return o=o+"M"+e.x+" "+(e.y+i)+" l0 -"+i+" l"+i+" 0 ",o=o+"M"+e.x+" "+(t.y-i)+" l0 "+i+" l"+i+" 0 ",o=o+"M"+t.x+" "+(t.y-i)+" l0 "+i+" l-"+i+" 0 ",o=o+"M"+t.x+" "+(e.y+i)+" l0 -"+i+" l-"+i+" 0 "},getPathRectangle:function(e,t,i){ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE;var o="",n=i/2;return o=o+"M"+(e.x+n)+" "+e.y,o=o+" L"+(e.x+n)+" "+(t.y-n),o=o+" L"+(t.x-n)+" "+(t.y-n),o=o+" L"+(t.x-n)+" "+(e.y+n),o=o+" L"+(e.x+n)+" "+(e.y+n)},getPathEdge:function(e){var t=e.length,o="M"+e[0].bounds.center().x+" "+e[0].bounds.center().y;for(i=1;t>i;i++){var n=e[i].bounds.center();o=o+" L"+n.x+" "+n.y}return o}}),ORYX.Plugins.HighlightingSelectedShapes=Clazz.extend({construct:function(e){this.facade=e,this.opacityFull=.9,this.opacityLow=.4},onSelectionChanged:function(e){e.elements&&e.elements.length>1?(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"selection",elements:e.elements.without(e.subSelection),color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR,opacity:e.subSelection?this.opacityLow:this.opacityFull}),e.subSelection?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"subselection",elements:[e.subSelection],color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR,opacity:this.opacityFull}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"subselection"})):(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"selection"}),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"subselection"}))}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.Overlay=Clazz.extend({facade:void 0,styleNode:void 0,construct:function(e){this.facade=e,this.changes=[],this.facade.registerOnEvent(ORYX.CONFIG.EVENT_OVERLAY_SHOW,this.show.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_OVERLAY_HIDE,this.hide.bind(this)),this.styleNode=document.createElement("style"),this.styleNode.setAttributeNS(null,"type","text/css"),document.getElementsByTagName("head")[0].appendChild(this.styleNode)},show:function(e){if(!(!e||!e.shapes||!e.shapes instanceof Array||!e.id||!e.id instanceof String||0==e.id.length)){e.attributes&&e.shapes.each(function(t){!t instanceof ORYX.Core.Shape||this.setAttributes(t.node,e.attributes)}.bind(this));var t=!0;try{t=e.node&&e.node instanceof SVGElement}catch(i){}e.node&&t&&(e._temps=[],e.shapes.each(function(t){if(!(!t instanceof ORYX.Core.Shape)){var i={};if(i.svg=e.dontCloneNode?e.node:e.node.cloneNode(!0),t.node.firstChild.appendChild(i.svg),t instanceof ORYX.Core.Edge&&!e.nodePosition&&(e.nodePosition="START"),e.nodePosition){var o=t.bounds,n=e.nodePosition.toUpperCase();t instanceof ORYX.Core.Node&&"START"==n?n="NW":t instanceof ORYX.Core.Node&&"END"==n?n="SE":t instanceof ORYX.Core.Edge&&"START"==n?o=t.getDockers().first().bounds:t instanceof ORYX.Core.Edge&&"END"==n&&(o=t.getDockers().last().bounds),i.callback=function(){var e=0,r=0;if("NW"==n);else if("N"==n)e=o.width()/2;else if("NE"==n)e=o.width();else if("E"==n)e=o.width(),r=o.height()/2;else if("SE"==n)e=o.width(),r=o.height();else if("S"==n)e=o.width()/2,r=o.height();else if("SW"==n)r=o.height();else if("W"==n)r=o.height()/2;else{if("START"!=n&&"END"!=n)return;e=o.width()/2,r=o.height()/2}t instanceof ORYX.Core.Edge&&(e+=o.upperLeft().x,r+=o.upperLeft().y),i.svg.setAttributeNS(null,"transform","translate("+e+", "+r+")")}.bind(this),i.element=t,i.callback(),o.registerCallback(i.callback)}e._temps.push(i)}}.bind(this))),this.changes[e.id]||(this.changes[e.id]=[]),this.changes[e.id].push(e)}},hide:function(e){e&&e.id&&!(!e.id instanceof String)&&0!=e.id.length&&this.changes[e.id]&&(this.changes[e.id].each(function(e){e.shapes.each(function(e){!e instanceof ORYX.Core.Shape||this.deleteAttributes(e.node)}.bind(this)),e._temps&&e._temps.each(function(e){e.svg&&e.svg.parentNode&&e.svg.parentNode.removeChild(e.svg),e.callback&&e.element&&e.element.bounds.unregisterCallback(e.callback)}.bind(this))}.bind(this)),this.changes[e.id]=null)},setAttributes:function(e,t){var i=this.getAllChilds(e.firstChild.firstChild),o=[];i.each(function(e){o.push($A(e.attributes).findAll(function(e){return e.nodeValue.startsWith("url(#")}))}),o=o.flatten().compact(),o=o.collect(function(e){return e.nodeValue}).uniq(),o=o.collect(function(e){return e.slice(5,e.length-1)}),o.unshift(e.id+" .me");var n,r=$H(t),a=r.toJSON().gsub(",",";").gsub('"',""),s=t.stroke?a.slice(0,a.length-1)+"; fill:"+t.stroke+";}":a;if(t.fill){var l=Object.clone(t);l.fill="black",n=$H(l).toJSON().gsub(",",";").gsub('"',"")}csstags=o.collect(function(e,t){return"#"+e+" * "+(t?s:a)+(n?" #"+e+" text * "+n:"")});var d=csstags.join(" ")+"\n";this.styleNode.appendChild(document.createTextNode(d))},deleteAttributes:function(e){var t=$A(this.styleNode.childNodes).findAll(function(t){return t.textContent.include("#"+e.id)});t.each(function(e){e.parentNode.removeChild(e)})},getAllChilds:function(e){var t=$A(e.childNodes);return $A(e.childNodes).each(function(e){t.push(this.getAllChilds(e))}.bind(this)),t.flatten()}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.KeysMove=ORYX.Plugins.AbstractPlugin.extend({facade:void 0,construct:function(e){this.facade=e,this.copyElements=[],this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:65,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.selectAll.bind(this)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_LEFT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_LEFT,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_LEFT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_LEFT,!0)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_RIGHT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_RIGHT,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_RIGHT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_RIGHT,!0)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_UP,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_UP,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_UP,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_UP,!0)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_DOWN,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_DOWN,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_DOWN,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_DOWN,!0)})},selectAll:function(e){Event.stop(e.event),this.facade.setSelection(this.facade.getCanvas().getChildShapes(!0))},move:function(e,t,i){Event.stop(i.event);var o=t?20:5,n=this.facade.getSelection(),r=this.facade.getSelection(),a={x:0,y:0};switch(e){case ORYX.CONFIG.KEY_CODE_LEFT:a.x=-1*o;break;case ORYX.CONFIG.KEY_CODE_RIGHT:a.x=o;break;case ORYX.CONFIG.KEY_CODE_UP:a.y=-1*o;break;case ORYX.CONFIG.KEY_CODE_DOWN:a.y=o}n=n.findAll(function(e){if(e instanceof ORYX.Core.Node&&1==e.dockers.length&&n.include(e.dockers.first().getDockedShape()))return!1;var t=e.parent;do if(n.include(t))return!1;while(t=t.parent);return!0});var s=!0,l=n.all(function(e){return e instanceof ORYX.Core.Edge?(e.isDocked()&&(s=!1),!0):!1});if((!l||s)&&(n=n.map(function(e){if(e instanceof ORYX.Core.Node)return e;if(e instanceof ORYX.Core.Edge){var t=e.dockers;return n.include(e.dockers.first().getDockedShape())&&(t=t.without(e.dockers.first())),n.include(e.dockers.last().getDockedShape())&&(t=t.without(e.dockers.last())),t}return null}).flatten().compact(),n.size()>0)){var d=[this.facade.getCanvas().bounds.lowerRight().x,this.facade.getCanvas().bounds.lowerRight().y,0,0];if(n.each(function(e){d[0]=Math.min(d[0],e.bounds.upperLeft().x),d[1]=Math.min(d[1],e.bounds.upperLeft().y),d[2]=Math.max(d[2],e.bounds.lowerRight().x),d[3]=Math.max(d[3],e.bounds.lowerRight().y)}),0>d[0]+a.x&&(a.x=-d[0]),0>d[1]+a.y&&(a.y=-d[1]),d[2]+a.x>this.facade.getCanvas().bounds.lowerRight().x&&(a.x=this.facade.getCanvas().bounds.lowerRight().x-d[2]),d[3]+a.y>this.facade.getCanvas().bounds.lowerRight().y&&(a.y=this.facade.getCanvas().bounds.lowerRight().y-d[3]),0!=a.x||0!=a.y){var c=[new ORYX.Core.Command.Move(n,a,null,r,this)];this.facade.executeCommands(c)}}},getUndockedCommant:function(e){var t=ORYX.Core.Command.extend({construct:function(e){this.dockers=e.collect(function(e){return e instanceof ORYX.Core.Controls.Docker?{docker:e,dockedShape:e.getDockedShape(),refPoint:e.referencePoint}:void 0}).compact()},execute:function(){this.dockers.each(function(e){e.docker.setDockedShape(void 0)})},rollback:function(){this.dockers.each(function(e){e.docker.setDockedShape(e.dockedShape),e.docker.setReferencePoint(e.refPoint)})}});return command=new t(e),command.execute(),command}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.Layouter||(ORYX.Plugins.Layouter={}),new function(){ORYX.Plugins.Layouter.EdgeLayouter=ORYX.Plugins.AbstractLayouter.extend({layouted:["http://b3mn.org/stencilset/bpmn1.1#SequenceFlow","http://b3mn.org/stencilset/bpmn1.1#MessageFlow","http://b3mn.org/stencilset/timjpdl3#SequenceFlow","http://b3mn.org/stencilset/jbpm4#SequenceFlow","http://b3mn.org/stencilset/bpmn2.0#MessageFlow","http://b3mn.org/stencilset/bpmn2.0#SequenceFlow","http://b3mn.org/stencilset/bpmn2.0choreography#MessageFlow","http://b3mn.org/stencilset/bpmn2.0choreography#SequenceFlow","http://b3mn.org/stencilset/bpmn2.0conversation#ConversationLink","http://b3mn.org/stencilset/epc#ControlFlow","http://www.signavio.com/stencilsets/processmap#ProcessLink","http://www.signavio.com/stencilsets/organigram#connection"],layout:function(e){e.each(function(e){this.doLayout(e)}.bind(this))},doLayout:function(e){var t=e.getIncomingNodes()[0],i=e.getOutgoingNodes()[0];if(t&&i){var o=this.getPositions(t,i,e);o.length>0&&this.setDockers(e,o[0].a,o[0].b)}},getPositions:function(e,t,i){var o=e.absoluteBounds(),n=t.absoluteBounds(),r=o.center(),a=n.center(),s=o.midPoint(),l=n.midPoint(),d=Object.clone(i.dockers.first().referencePoint),c=Object.clone(i.dockers.last().referencePoint),p=i.dockers.first().getAbsoluteReferencePoint(),u=i.dockers.last().getAbsoluteReferencePoint();if(1>Math.abs(p.x-u.x)||1>Math.abs(p.y-u.y))return[];var m={};m.x=r.x<a.x?(a.x-n.width()/2-(r.x+o.width()/2))/2+(r.x+o.width()/2):(r.x-o.width()/2-(a.x+n.width()/2))/2+(a.x+n.width()/2),m.y=r.y<a.y?(a.y-n.height()/2-(r.y+o.height()/2))/2+(r.y+o.height()/2):(r.y-o.height()/2-(a.y+n.height()/2))/2+(a.y+n.height()/2),o.widen(5),n.widen(20);var h=[],f=this.getOffset.bind(this);return o.isIncluded(a.x,r.y)||n.isIncluded(a.x,r.y)||h.push({a:{x:a.x+f(c,l,"x"),y:r.y+f(d,s,"y")},z:this.getWeight(e,r.x<a.x?"r":"l",t,r.y<a.y?"t":"b",i)}),o.isIncluded(r.x,a.y)||n.isIncluded(r.x,a.y)||h.push({a:{x:r.x+f(d,s,"x"),y:a.y+f(c,l,"y")},z:this.getWeight(e,r.y<a.y?"b":"t",t,r.x<a.x?"l":"r",i)}),o.isIncluded(m.x,r.y)||n.isIncluded(m.x,a.y)||h.push({a:{x:m.x,y:r.y+f(d,s,"y")},b:{x:m.x,y:a.y+f(c,l,"y")},z:this.getWeight(e,"r",t,"l",i,r.x>a.x)}),o.isIncluded(r.x,m.y)||n.isIncluded(a.x,m.y)||h.push({a:{x:r.x+f(d,s,"x"),y:m.y},b:{x:a.x+f(c,l,"x"),y:m.y},z:this.getWeight(e,"b",t,"t",i,r.y>a.y)}),h.sort(function(e,t){return e.z<t.z?1:e.z==t.z?-1:-1})},getOffset:function(e,t,i){return e[i]-t[i]},getWeight:function(e,t,i,o,n,r){t=(t||"").toLowerCase(),o=(o||"").toLowerCase(),["t","r","b","l"].include(t)||(t="r"),["t","r","b","l"].include(o)||(t="l"),r&&(t="t"==t?"b":"r"==t?"l":"b"==t?"t":"l"==t?"r":"r",o="t"==o?"b":"r"==o?"l":"b"==o?"t":"l"==o?"r":"r");var a=this.facade.getRules().getLayoutingRules(e,n).out,s=this.facade.getRules().getLayoutingRules(i,n)["in"],l=a[t],d=s[o],c=function(e,t,i){switch(e){case"t":return 2>Math.abs(t.x-i.x)&&t.y<i.y;case"r":return t.x>i.x&&2>Math.abs(t.y-i.y);case"b":return 2>Math.abs(t.x-i.x)&&t.y>i.y;case"l":return t.x<i.x&&2>Math.abs(t.y-i.y);default:return!1}},p=e.getIncomingShapes().findAll(function(e){return e instanceof ORYX.Core.Edge}).any(function(e){return c(t,e.dockers[e.dockers.length-2].bounds.center(),e.dockers.last().bounds.center())}),u=i.getOutgoingShapes().findAll(function(e){return e instanceof ORYX.Core.Edge}).any(function(e){return c(o,e.dockers[1].bounds.center(),e.dockers.first().bounds.center())});return p||u?0:l+d},setDockers:function(e,t,i){e&&(e.dockers.each(function(t){e.removeDocker(t)}),[t,i].compact().each(function(t){var i=e.createDocker(void 0,t);i.bounds.centerMoveTo(t)}),e.dockers.each(function(e){e.update()}),e._update(!0))}})},ORYX.Plugins||(ORYX.Plugins={}),new function(){ORYX.Plugins.BPMN2_0={construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED,this.handleDockerDocked.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED,this.handlePropertyChanged.bind(this)),this.facade.registerOnEvent("layout.bpmn2_0.pool",this.handleLayoutPool.bind(this)),this.facade.registerOnEvent("layout.bpmn2_0.subprocess",this.handleSubProcess.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SHAPEREMOVED,this.handleShapeRemove.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADED,this.afterLoad.bind(this)),this.namespace=void 0},afterLoad:function(){this.facade.getCanvas().getChildNodes().each(function(e){e.getStencil().id().endsWith("Pool")&&this.handleLayoutPool({shape:e})}.bind(this))},onSelectionChanged:function(e){var t=e.elements;if(t&&1===t.length){var i=this.getNamespace(),o=t[0];if("Pool"===o.getStencil().idWithoutNs()&&0===o.getChildNodes().length){var n={type:i+"Lane",position:{x:0,y:0},namespace:o.getStencil().namespace(),parent:o};this.facade.createShape(n),this.facade.getCanvas().update(),this.facade.setSelection([o])}}if(t.any(function(e){return e instanceof ORYX.Core.Node&&e.getStencil().id().endsWith("Lane")})){var r=t.findAll(function(e){return e instanceof ORYX.Core.Node&&e.getStencil().id().endsWith("Lane")}),a=[],s=[];r.each(function(e){var t=this.getParentPool(e);t&&a.push(t)}.bind(this)),a=a.uniq().findAll(function(e){var i=this.getLanes(e,!0);return i.all(function(e){return r.include(e)})?(s=s.concat(i),!0):t.include(e)&&i.any(function(e){return r.include(e)})?(s=s.concat(i),!0):!1}.bind(this)),s.length>0&&a.length>0&&(t=t.without.apply(t,s),t=t.concat(a),this.facade.setSelection(t.uniq()))}},handleShapeRemove:function(t){var i=t.shape,o=t.parent;if(i instanceof ORYX.Core.Node&&"Lane"===i.getStencil().idWithoutNs()&&this.facade.isExecutingCommands()){var n=this.getParentPool(o);if(n&&n.parent){var r=function(e){return!e.getChildNodes().any(function(e){return"Lane"===e.getStencil().idWithoutNs()})},a=r(i),s=o.getChildNodes().any(function(e){return"Lane"===e.getStencil().idWithoutNs()});if(a&&s){var l=new e(i,o,n,this);this.facade.executeCommands([l])}else if(a||this.facade.getSelection().any(function(e){return e instanceof ORYX.Core.Node&&"Lane"===e.getStencil().idWithoutNs()&&e.isParent(i)&&r(e)}))a&&!s&&o==n&&o.add(i);else{var d=ORYX.Core.Command.extend({construct:function(e,t){this.children=e.getChildNodes(!0),this.facade=t},execute:function(){this.children.each(function(e){e.bounds.moveBy(30,0)})},rollback:function(){this.children.each(function(e){e.bounds.moveBy(-30,0)})}});this.facade.executeCommands([new d(i,this.facade)])}}}},hashedSubProcesses:{},hashChildShapes:function(e){var t=e.getChildNodes();t.each(function(e){this.hashedSubProcesses[e.id]&&(this.hashedSubProcesses[e.id]=e.absoluteXY(),this.hashedSubProcesses[e.id].width=e.bounds.width(),this.hashedSubProcesses[e.id].height=e.bounds.height(),this.hashChildShapes(e))}.bind(this))},handleSubProcess:function(e){var t=e.shape;if(!this.hashedSubProcesses[t.id])return this.hashedSubProcesses[t.id]=t.absoluteXY(),this.hashedSubProcesses[t.id].width=t.bounds.width(),this.hashedSubProcesses[t.id].height=t.bounds.height(),void 0;var i=t.absoluteXY();i.x-=this.hashedSubProcesses[t.id].x,i.y-=this.hashedSubProcesses[t.id].y;var o=this.hashedSubProcesses[t.id].width!==t.bounds.width()||this.hashedSubProcesses[t.id].height!==t.bounds.height();this.hashedSubProcesses[t.id]=t.absoluteXY(),this.hashedSubProcesses[t.id].width=t.bounds.width(),this.hashedSubProcesses[t.id].height=t.bounds.height(),this.hashChildShapes(t),this.facade.isExecutingCommands()&&!o&&this.moveChildDockers(t,i)},moveChildDockers:function(e,t){if(t.x||t.y){var i=e.getChildNodes(!0),o=i.map(function(e){return[].concat(e.getIncomingShapes()).concat(e.getOutgoingShapes())}).flatten().uniq().map(function(e){return e.dockers.length>2?e.dockers.slice(1,e.dockers.length-1):[]}).flatten(),n=e.absoluteBounds();n.moveBy(-t.x,-t.y);var r={};o.each(function(e){if(!e.isChanged){var o=Object.clone(t);if(!n.isIncluded(e.bounds.center())){var a=e.parent.dockers.indexOf(e),s=e.parent.dockers.length,l=e.parent.getSource(),d=e.parent.getTarget(),c=i.include(l)&&i.include(d);if(!c){var p=0!==a?n.isIncluded(e.parent.dockers[a-1].bounds.center()):!1,u=a!==s-1?n.isIncluded(e.parent.dockers[a+1].bounds.center()):!1;if(!p&&!u)return;var m=e.parent.dockers[p?a-1:a+1];if(2>Math.abs(-Math.abs(m.bounds.center().x-e.bounds.center().x)))o.y=0;else{if(!(2>Math.abs(-Math.abs(m.bounds.center().y-e.bounds.center().y))))return;o.x=0}}}r[e.getId()]={docker:e,offset:o}}}),this.facade.executeCommands([new ORYX.Core.MoveDockersCommand(r)])}},handleDockerDocked:function(e){var t=this.getNamespace(),i=e.parent,o=e.target;if(i.getStencil().id()===t+"SequenceFlow"){var n=o.getStencil().groups().find(function(e){return"Gateways"==e?e:void 0});n||"Expression"!=i.properties["oryx-conditiontype"]?i.setProperty("oryx-showdiamondmarker",!1):i.setProperty("oryx-showdiamondmarker",!0),this.facade.getCanvas().update()}},handlePropertyChanged:function(e){var t=this.getNamespace(),i=e.elements,o=e.key,n=e.value,r=!1;i.each(function(e){if(e.getStencil().id()===t+"SequenceFlow"&&"oryx-conditiontype"===o){if("Expression"!=n)e.setProperty("oryx-showdiamondmarker",!1);else{var i=e.getIncomingShapes();i||e.setProperty("oryx-showdiamondmarker",!0);var a=i.find(function(e){var t=e.getStencil().groups().find(function(e){return"Gateways"==e?e:void 0});return t?t:void 0});a?e.setProperty("oryx-showdiamondmarker",!1):e.setProperty("oryx-showdiamondmarker",!0)}r=!0}}.bind(this)),r&&this.facade.getCanvas().update()},hashedPoolPositions:{},hashedLaneDepth:{},hashedBounds:{},hashedPositions:{},handleLayoutPool:function(e){var t=e.shape,i=this.facade.getSelection(),o=i.include(t)?t:i.first();if(o=o||t,this.currentPool=t,(o.getStencil().id().endsWith("Pool")||o.getStencil().id().endsWith("Lane"))&&(o===t||o.isParent(t)||this.hashedBounds[t.id][o.id])){this.hashedBounds[t.id]||(this.hashedBounds[t.id]={});var n=this.getLanes(t);if(!(0>=n.length)){var r=this.getLanes(t,!0),a=r.clone(),s=$H({});if(r.each(function(e){s[e.id]=e.bounds.upperLeft()}),1===n.length&&0>=this.getLanes(n.first()).length){n.first().setProperty("oryx-showcaption",n.first().properties["oryx-name"].trim().length>0);var l=n.first().node.getElementsByTagName("rect");l[0].setAttributeNS(null,"display","none")}else r.invoke("setProperty","oryx-showcaption",!0),r.each(function(e){var t=e.node.getElementsByTagName("rect");t[0].removeAttributeNS(null,"display")});for(var d=[],c=[],p=-1;++p<r.length;)this.hashedBounds[t.id][r[p].id]||c.push(r[p]);c.length>0&&(o=c.first());for(var u=$H(this.hashedBounds[t.id]).keys(),p=-1;++p<u.length;)r.any(function(e){return e.id==u[p]})||(d.push(this.hashedBounds[t.id][u[p]]),i=i.without(function(e){return e.id==u[p]}));var m,h,f,g;if(d.length>0||c.length>0)m=1===c.length&&1===this.getLanes(c[0].parent).length?this.adjustHeight(n,c[0].parent):this.updateHeight(t),h=this.adjustWidth(n,t.bounds.width()),t.update();else if(t==o){if(1===i.length&&this.isResized(t,this.hashedPoolPositions[t.id])){var v=this.hashedPoolPositions[t.id].upperLeft(),S=t.bounds.upperLeft(),I=0;if(this.shouldScale(t)){var O=this.hashedPoolPositions[t.id];I=O.height()/t.bounds.height()}this.adjustLanes(t,r,v.x-S.x,v.y-S.y,I)}m=this.adjustHeight(n,void 0,t.bounds.height()),h=this.adjustWidth(n,t.bounds.width())}else{if(1===i.length&&this.isResized(o,this.hashedBounds[t.id][o.id])){var v=this.hashedBounds[t.id][o.id].upperLeft(),S=o.absoluteXY();f=v.x-S.x,g=v.y-S.y,(f||g)&&(a=a.without(o),this.adjustLanes(t,this.getAllExcludedLanes(t,o),f,0));var b=this.getLanes(o,!0);if(b.length>0)if(this.shouldScale(o)){var O=this.hashedBounds[t.id][o.id],I=O.height()/o.bounds.height();this.adjustLanes(t,b,f,g,I)}else this.adjustLanes(t,b,f,g,0)}var E=r.map(function(e){return{shape:e,bounds:e.bounds.clone()}});m=this.adjustHeight(n,o),this.checkForChanges(r,E),h=this.adjustWidth(n,o.bounds.width()+30*this.getDepth(o,t))}if(this.setDimensions(t,h,m,f,g),this.facade.isExecutingCommands()&&(0===d.length||0!==c.length)&&(this.updateDockers(a,t),this.hashedPositions[t.id]&&this.hashedPositions[t.id].keys().any(function(e,t){return(r[t]||{}).id!==e}))){var y=ORYX.Core.Command.extend({construct:function(e,t,i,o,n){this.originPosition=Object.clone(e),this.newPosition=Object.clone(t),this.lanes=i,this.plugin=o,this.pool=n},execute:function(){this.executed||(this.executed=!0,this.lanes.each(function(e){this.newPosition[e.id]&&e.bounds.moveTo(this.newPosition[e.id])}.bind(this)),this.plugin.hashedPositions[this.pool]=Object.clone(this.newPosition))},rollback:function(){this.lanes.each(function(e){this.originPosition[e.id]&&e.bounds.moveTo(this.originPosition[e.id])}.bind(this)),this.plugin.hashedPositions[this.pool]=Object.clone(this.originPosition)}}),R=$H({});r.each(function(e){R[e.id]=e.bounds.upperLeft()});var T=new y(s,R,r,this,t.id);this.facade.executeCommands([T])}this.hashedBounds[t.id]={},this.hashedPositions[t.id]=s;for(var p=-1;++p<r.length;)this.hashedBounds[t.id][r[p].id]=r[p].absoluteBounds(),this.hashChildShapes(r[p]),this.hashedLaneDepth[r[p].id]=this.getDepth(r[p],t),this.forceToUpdateLane(r[p]);this.hashedPoolPositions[t.id]=t.bounds.clone()}}},shouldScale:function(e){var t=e.getChildNodes().findAll(function(e){return e.getStencil().id().endsWith("Lane")});return t.length>1||t.any(function(e){return this.shouldScale(e)}.bind(this))},checkForChanges:function(e,t){if(this.facade.isExecutingCommands()&&t.any(function(e){return""+e.shape.bounds!=""+e.bounds})){var i=ORYX.Core.Command.extend({construct:function(e){this.oldState=e,this.newState=e.map(function(e){return{shape:e.shape,bounds:e.bounds.clone()}})},execute:function(){this.executed&&this.applyState(this.newState),this.executed=!0},rollback:function(){this.applyState(this.oldState)},applyState:function(e){e.each(function(e){e.shape.bounds.set(e.bounds.upperLeft(),e.bounds.lowerRight())})}});this.facade.executeCommands([new i(t)])}},isResized:function(e,t){if(!t||!e)return!1;var i=t;return 0!==Math.round(i.width()-e.bounds.width())||0!==Math.round(i.height()-e.bounds.height())},adjustLanes:function(e,t,i,o,n){n=n||0,t.each(function(t){t.getChildNodes().each(function(e){if(!e.getStencil().id().endsWith("Lane")){var t=n?e.bounds.center().y-e.bounds.center().y/n:-o;e.bounds.moveBy(i||0,-t),n&&e.getStencil().id().endsWith("Subprocess")&&this.moveChildDockers(e,{x:0,y:-t})}}.bind(this)),this.hashedBounds[e.id][t.id].moveBy(-(i||0),n?0:-o),n&&(t.isScaled=!0)}.bind(this))},getAllExcludedLanes:function(e,t){var i=[];return e.getChildNodes().each(function(e){t&&e===t||!e.getStencil().id().endsWith("Lane")||(i.push(e),i=i.concat(this.getAllExcludedLanes(e,t)))}.bind(this)),i},forceToUpdateLane:function(e){e.bounds.height()!==e._svgShapes[0].height&&(e.isChanged=!0,e.isResized=!0,e._update())},getDepth:function(e,t){for(var i=0;e&&e.parent&&e!==t;)e=e.parent,++i;return i},updateDepth:function(e,t,i){var o=30*(t-i);e.getChildNodes().each(function(e){e.bounds.moveBy(o,0),[].concat(children[j].getIncomingShapes()).concat(children[j].getOutgoingShapes())})},setDimensions:function(e,t,i,o,n){var r=e.getStencil().id().endsWith("Lane");e.bounds.set(r?30:e.bounds.a.x-(o||0),r?e.bounds.a.y:e.bounds.a.y-(n||0),t?e.bounds.a.x+t-(r?30:o||0):e.bounds.b.x,i?e.bounds.a.y+i-(r?0:n||0):e.bounds.b.y)},setLanePosition:function(e,t){e.bounds.moveTo(30,t)},adjustWidth:function(e,t){return(e||[]).each(function(e){this.setDimensions(e,t),this.adjustWidth(this.getLanes(e),t-30)}.bind(this)),t},adjustHeight:function(e,t,i){var o=0;if(!t&&i)for(var n=-1;++n<e.length;)o+=e[n].bounds.height();for(var n=-1,r=0;++n<e.length;){if(e[n]===t)this.adjustHeight(this.getLanes(e[n]),void 0,e[n].bounds.height()),e[n].bounds.set({x:30,y:r},{x:e[n].bounds.width()+30,y:e[n].bounds.height()+r});else if(!t&&i){var a=e[n].bounds.height()*i/o;this.adjustHeight(this.getLanes(e[n]),void 0,a),this.setDimensions(e[n],null,a),this.setLanePosition(e[n],r)}else{var a=this.adjustHeight(this.getLanes(e[n]),t,i);a||(a=e[n].bounds.height()),this.setDimensions(e[n],null,a),this.setLanePosition(e[n],r)}r+=e[n].bounds.height()}return r},updateHeight:function(e){var t=this.getLanes(e);if(0==t.length)return e.bounds.height();for(var i=0,o=-1;++o<t.length;)this.setLanePosition(t[o],i),i+=this.updateHeight(t[o]);return this.setDimensions(e,null,i),i},getOffset:function(e,t,i){var o={x:0,y:0},o=e.absoluteXY(),n=this.hashedBounds[i.id][e.id]||(t===!0?this.hashedPoolPositions[e.id]:void 0);return n?(o.x-=n.upperLeft().x,o.y-=n.upperLeft().y,o):{x:0,y:0}},getNextLane:function(e){for(;e&&!e.getStencil().id().endsWith("Lane");){if(e instanceof ORYX.Core.Canvas)return null;e=e.parent}return e},getParentPool:function(e){for(;e&&!e.getStencil().id().endsWith("Pool");){if(e instanceof ORYX.Core.Canvas)return null;e=e.parent}return e},updateDockers:function(e,t){for(var i,o=t.absoluteBounds(),n=[],r=(this.hashedPoolPositions[t.id]||o).clone(),a=-1,s=-1,l=-1,d=-1,c={};++a<e.length;)if(this.hashedBounds[t.id][e[a].id]){var p=e[a].isScaled;delete e[a].isScaled;var u=e[a].getChildNodes(),m=e[a].absoluteBounds(),h=this.hashedBounds[t.id][e[a].id]||m,f=this.getOffset(e[a],!0,t),g=0,v=this.getDepth(e[a],t);for(void 0!==this.hashedLaneDepth[e[a].id]&&this.hashedLaneDepth[e[a].id]!==v&&(g=30*(this.hashedLaneDepth[e[a].id]-v),f.x+=g),s=-1;++s<u.length;){g&&!u[s].getStencil().id().endsWith("Lane")&&(n.push({xOffset:g,shape:u[s]}),u[s].bounds.moveBy(g,0)),u[s].getStencil().id().endsWith("Subprocess")&&this.moveChildDockers(u[s],f);var S=[].concat(u[s].getIncomingShapes()).concat(u[s].getOutgoingShapes()).findAll(function(e){return e instanceof ORYX.Core.Edge});for(l=-1;++l<S.length;)if(S[l].getStencil().id().endsWith("MessageFlow"))this.layoutEdges(u[s],[S[l]],f);else for(d=-1;++d<S[l].dockers.length;)if(i=S[l].dockers[d],!i.getDockedShape()&&!i.isChanged){pos=i.bounds.center();var I=h.isIncluded(pos);!r.isIncluded(pos),0==d?I:h.isIncluded(S[l].dockers[d-1].bounds.center()),d==S[l].dockers.length-1?I:h.isIncluded(S[l].dockers[d+1].bounds.center());var O=Object.clone(f);if(p&&I&&this.isResized(e[a],this.hashedBounds[t.id][e[a].id])){var b=pos.y-m.upperLeft().y+O.y;O.y-=b-b*(m.height()/h.height())}I&&(c[i.id]={docker:i,offset:O})}}}var E=ORYX.Core.Command.extend({construct:function(e){this.state=e},execute:function(){this.executed&&this.state.each(function(e){e.shape.bounds.moveBy(e.xOffset,0)}),this.executed=!0},rollback:function(){this.state.each(function(e){e.shape.bounds.moveBy(-e.xOffset,0)})}});this.facade.executeCommands([new ORYX.Core.MoveDockersCommand(c),new E(n)])},moveBy:function(e,t){return e.x+=t.x,e.y+=t.y,e},getHashedBounds:function(e){return this.currentPool&&this.hashedBounds[this.currentPool.id][e.id]?this.hashedBounds[this.currentPool.id][e.id]:e.absoluteBounds()},getLanes:function(e,t){var i=this.getNamespace(),o=e.getChildNodes(t||!1).findAll(function(e){return e.getStencil().id()===i+"Lane"});return o=o.sort(function(e,t){var i=Math.round(e.bounds.upperLeft().y),o=Math.round(t.bounds.upperLeft().y),n=Math.round(e.bounds.lowerRight().y),r=Math.round(t.bounds.lowerRight().y),a=this.getHashedBounds(e),s=this.getHashedBounds(t),l=Math.round(a.upperLeft().y),d=Math.round(s.upperLeft().y),c=Math.round(a.lowerRight().y),p=Math.round(s.lowerRight().y);
if(i==o&&n==r&&(i=l,o=d,n=c,r=p),0===Math.round(e.bounds.height()-a.height())&&0===Math.round(t.bounds.height()-s.height()))return o>i?-1:i>o?1:0;var u=o>i&&r>n,m=i>o&&n>r,h=o>i&&n>=r&&p>c,f=i>=o&&r>n&&d>l,g=i>o&&r>=n&&c>p,v=o>=i&&n>r&&l>d;return u||h||f?-1:m||g||v?1:0}.bind(this))},getNamespace:function(){if(!this.namespace){var e=this.facade.getStencilSets();if(!e.keys())return void 0;this.namespace=e.keys()[0]}return this.namespace}};var e=ORYX.Core.Command.extend({construct:function(e,t,i,o){this.facade=o.facade,this.plugin=o,this.shape=e,this.changes,this.pool=i,this.parent=t,this.shapeChildren=[],this.shape.getChildShapes().each(function(e){this.shapeChildren.push({shape:e,bounds:{a:{x:e.bounds.a.x,y:e.bounds.a.y},b:{x:e.bounds.b.x,y:e.bounds.b.y}}})}.bind(this)),this.shapeUpperLeft=this.shape.bounds.upperLeft(),this.parentHeight=this.parent.bounds.height()},getLeafLanes:function(e){var t=this.plugin.getLanes(e).map(function(e){return this.getLeafLanes(e)}.bind(this)).flatten();return t.length>0?t:[e]},findNewLane:function(){this.plugin.getLanes(this.parent);var e=this.getLeafLanes(this.parent);this.lane=e.find(function(e){return e.bounds.upperLeft().y>=this.shapeUpperLeft.y}.bind(this))||e.last(),this.laneUpperLeft=this.lane.bounds.upperLeft()},execute:function(){if(this.changes)return this.executeAgain(),void 0;if(this.lane||this.findNewLane(),this.lane){var e=this.laneUpperLeft,t=this.shapeUpperLeft,i=this.plugin.getDepth(this.lane,this.parent)-1;this.changes=$H({}),e.y>=t.y?(this.lane.getChildShapes().each(function(e){this.changes[e.getId()]||(this.changes[e.getId()]=this.computeChanges(e,this.lane,this.lane,this.shape.bounds.height())),e.bounds.moveBy(0,this.shape.bounds.height())}.bind(this)),this.plugin.hashChildShapes(this.lane),this.shapeChildren.each(function(e){e.shape.bounds.set(e.bounds),e.shape.bounds.moveBy(t.x-30-30*i,0),this.changes[e.shape.getId()]||(this.changes[e.shape.getId()]=this.computeChanges(e.shape,this.shape,this.lane,0)),this.lane.add(e.shape)}.bind(this)),this.lane.bounds.moveBy(0,t.y-e.y)):t.y>e.y&&this.shapeChildren.each(function(e){e.shape.bounds.set(e.bounds),e.shape.bounds.moveBy(t.x-30-30*i,this.lane.bounds.height()),this.changes[e.shape.getId()]||(this.changes[e.shape.getId()]=this.computeChanges(e.shape,this.shape,this.lane,0)),this.lane.add(e.shape)}.bind(this))}var o=this.lane.bounds.height(),n=1===this.lane.length?this.parentHeight:this.lane.bounds.height()+this.shape.bounds.height();this.setHeight(n,o,this.parent,this.parentHeight,!0),this.plugin.getLanes(this.parent).each(function(e){this.changes[e.getId()]||e===this.lane||e===this.shape||(this.changes[e.getId()]=this.computeChanges(e,this.parent,this.parent,0))}.bind(this)),this.update()},setHeight:function(e,t,i,o,n){this.plugin.setDimensions(this.lane,this.lane.bounds.width(),e),this.plugin.hashedBounds[this.pool.id][this.lane.id]=this.lane.absoluteBounds(),this.plugin.adjustHeight(this.plugin.getLanes(i),this.lane),n===!0&&(this.changes[this.shape.getId()]=this.computeChanges(this.shape,i,i,0,t,e)),this.plugin.setDimensions(i,i.bounds.width(),o),i!==this.pool&&this.plugin.setDimensions(this.pool,this.pool.bounds.width(),this.pool.bounds.height()+(e-t))},update:function(){this.plugin.hashedBounds[this.pool.id].REMOVED=!0},rollback:function(){var e=this.laneUpperLeft,t=this.shapeUpperLeft;this.changes.each(function(i){var o=i.value.oldParent,n=i.value.shape;i.value.parentHeight;var r=i.value.oldHeight,a=i.value.newHeight;n.getStencil().id().endsWith("Lane")&&n.bounds.moveTo(i.value.oldPosition),r?(this.setHeight(r,a,o,o.bounds.height()+(r-a)),e.y>=t.y&&this.lane.bounds.moveBy(0,this.shape.bounds.height()-1)):(o.add(n),n.bounds.moveTo(i.value.oldPosition))}.bind(this))},executeAgain:function(){this.changes.each(function(e){var t=e.value.newParent,i=e.value.shape,o=e.value.newHeight,n=e.value.oldHeight;if(o){var r=this.laneUpperLeft.y,a=this.shapeUpperLeft.y;r>=a&&this.lane.bounds.moveBy(0,a-r),this.setHeight(o,n,t,t.bounds.height()+(o-n))}else t.add(i),i.bounds.moveTo(e.value.newPosition)}.bind(this)),this.update()},computeChanges:function(e,t,i,o,n,r){t=this.changes[e.getId()]?this.changes[e.getId()].oldParent:t;var a=this.changes[e.getId()]?this.changes[e.getId()].oldPosition:e.bounds.upperLeft(),s=e.bounds.upperLeft(),l={x:s.x,y:s.y+o},d={shape:e,parentHeight:t.bounds.height(),oldParent:t,oldPosition:a,oldHeight:n,newParent:i,newPosition:l,newHeight:r};return d}});ORYX.Plugins.BPMN2_0=ORYX.Plugins.AbstractPlugin.extend(ORYX.Plugins.BPMN2_0)},function(){"use strict";angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(e,t){return{loginConfirmed:function(i,o){var n=o||function(e){return e};e.$broadcast("event:auth-loginConfirmed",i),t.retryAll(n)},loginCancelled:function(i,o){t.rejectAll(o),e.$broadcast("event:auth-loginCancelled",i)}}}]).config(["$httpProvider",function(e){var t=["$rootScope","$q","httpBuffer","$translate",function(e,t,i,o){function n(e){return e}function r(n){if(401===n.status&&!n.config.ignoreAuthModule){var r=t.defer();return i.append(n.config,r),e.$broadcast("event:auth-loginRequired",n),r.promise}return n.status>=500&&599>=n.status&&n.config&&!n.config.ignoreErrors&&(n.data&&n.data.messageKey?e.addAlertPromise(o(n.data.messageKey),"error"):n.data&&n.data.message?e.addAlert(n.data.message,"error"):e.addAlertPromise(o("GENERAL.ERROR.GENERIC"),"error")),t.reject(n)}return function(e){return e.then(n,r)}}];e.interceptors.push(t)}]),angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(e){function t(t,o){function n(e){o.resolve(e)}function r(e){o.reject(e)}i=i||e.get("$http"),i(t).then(n,r)}var i,o=[];return{append:function(e,t){o.push({config:e,deferred:t})},rejectAll:function(e){if(e)for(var t=0;o.length>t;++t)o[t].deferred.reject(e);o=[]},retryAll:function(e){for(var i=0;o.length>i;++i)t(e(o[i].config),o[i].deferred);o=[]}}}])}();var activitiModeler=angular.module("activitiModeler",["http-auth-interceptor","ngCookies","ngResource","ngSanitize","ngRoute","ngDragDrop","mgcrea.ngStrap","mgcrea.ngStrap.helpers.dimensions","ui.grid","ui.grid.edit","ui.grid.selection","ui.grid.autoResize","ui.grid.moveColumns","ui.grid.cellNav","ngAnimate","pascalprecht.translate","ngFileUpload","angularSpectrumColorpicker","duScroll","dndLists","ui.ace","ui.select","activiti.common"]);angular.module("activiti.common",[]);var activitiModule=activitiModeler,activitiApp=activitiModeler;wireServices(activitiModeler),activitiModeler.config(["$provide","$routeProvider","$selectProvider","$translateProvider","licenseStatusProvider",function(e,t,i,o,n){var r="editor";e.value("appName",r);var a=ACTIVITI.CONFIG.webContextRoot+"/"+r+"/";e.value("appResourceRoot",a),angular.extend(i.defaults,{caretHtml:'&nbsp;<i class="icon icon-caret-down"></i>'});var s=["$rootScope","AuthenticationSharedService",function(e,t){return e.authenticated?(e.authenticated=!0,!0):t.authenticate()}];t.when("/login",{templateUrl:a+"views/login.html",controller:"LoginController"}).when("/processes",{templateUrl:a+"views/processes.html",controller:"ProcessesCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"processes"}).when("/processes/:modelId",{templateUrl:a+"views/process.html",controller:"ProcessCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"processes"}).when("/processes/:modelId/history/:modelHistoryId",{templateUrl:a+"views/process.html",controller:"ProcessCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"processes"}).when("/forms",{templateUrl:a+"views/forms.html",controller:"FormsCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"forms"}).when("/forms/:modelId",{templateUrl:a+"views/form.html",controller:"FormCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"forms"}).when("/forms/:modelId/history/:modelHistoryId",{templateUrl:a+"views/form.html",controller:"FormCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"forms"}).when("/apps",{templateUrl:a+"views/app-definitions.html",controller:"AppDefinitionsCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"apps"}).when("/apps/:modelId",{templateUrl:a+"views/app-definition.html",controller:"AppDefinitionCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"apps"}).when("/apps/:modelId/history/:modelHistoryId",{templateUrl:"views/app-definition.html",controller:"AppDefinitionCtrl",resolve:{verify:s},activeHeaderBar:"apps"}).when("/stencils",{templateUrl:a+"views/stencils.html",controller:"StencilsController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"stencils"}).when("/stencils/:stencilId",{templateUrl:a+"views/stencil.html",controller:"StencilDetailsCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"stencils"}).when("/stencils/:stencilId/history/:stencilHistoryId",{templateUrl:a+"views/stencil.html",controller:"StencilDetailsCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"stencils"}).when("/decision-tables",{templateUrl:a+"views/decision-tables.html",controller:"DecisionTablesController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"decision-tables"}).when("/decision-tables/:modelId",{templateUrl:a+"views/decision-table.html",controller:"DecisionTableDetailsCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"decision-tables"}).when("/decision-tables/:modelId/history/:modelHistoryId",{templateUrl:a+"views/decision-table.html",controller:"DecisionTableDetailsCtrl",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"decision-tables"}).when("/data-models",{templateUrl:a+"views/data-models.html",controller:"DataModelOverviewController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"data-models"}).when("/data-models/:modelId",{templateUrl:a+"views/data-model.html",controller:"DataModelDetailsController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"data-models"}).when("/data-models/:modelId/history/:modelHistoryId",{templateUrl:a+"views/data-model.html",controller:"DataModelDetailsController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"data-models"}).when("/editor/:modelId",{templateUrl:a+"editor-app/editor.html",controller:"EditorController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"processes"}).when("/kickstart-editor/:modelId",{templateUrl:a+"views/kickstart-model.html",controller:"KickstartModelController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"processes"}).when("/form-editor/:modelId",{templateUrl:a+"views/form-builder.html",controller:"FormBuilderController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"forms"}).when("/app-editor/:modelId",{templateUrl:a+"views/app-definition-builder.html",controller:"AppDefinitionBuilderController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"apps"}).when("/stencil-editor/:stencilId",{templateUrl:a+"views/stencil-editor.html",controller:"StencilEditorController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"stencils"}).when("/decision-table-editor/:modelId",{templateUrl:a+"views/decision-table-editor.html",controller:"DecisionTableEditorController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"decision-tables"}).when("/data-model-editor/:modelId",{templateUrl:a+"views/data-model-editor.html",controller:"DataModelEditorController",resolve:{verify:s,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"data-models"}),ACTIVITI.CONFIG.appDefaultRoute?t.when("/",{redirectTo:ACTIVITI.CONFIG.appDefaultRoute}):t.when("/",{redirectTo:"/processes",resolve:{verify:s}}),t.otherwise({templateUrl:a+"views/login.html",controller:"LoginController"}),o.useSanitizeValueStrategy("sanitizeParameters"),o.useStaticFilesLoader({prefix:a+"/i18n/",suffix:".json"}),o.preferredLanguage(window.ACTIVITI_PREFERRED_LOCALE)}]).config(["$httpProvider",function(e){function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e16]+1e16).replace(/[01]/g,t)}e.interceptors.push(function(){return{request:function(e){return document.cookie="CSRF-TOKEN="+t()+";path=/",e}}})}]).run(["$rootScope","$timeout","$modal","$translate","$location","$window","appResourceRoot",function(e,t,i,o,n,r,a){e.restRootUrl=function(){return ACTIVITI.CONFIG.contextRoot},e.$on("$routeChangeSuccess",function(t,i){i.activeHeaderBar&&e.setMainPageById(i.activeHeaderBar)}),e.appResourceRoot=a,e.window={};var s=function(){e.window.width=r.innerWidth,e.window.height=r.innerHeight};angular.element(r).bind("resize",function(){e.safeApply(s())}),e.$watch("window.forceRefresh",function(i){i&&t(function(){s(),e.window.forceRefresh=!1})}),s(),e.mainNavigation=[{id:"processes",title:"GENERAL.NAVIGATION.PROCESSES",path:"/processes",enterprise:!1},{id:"forms",title:"GENERAL.NAVIGATION.FORMS",path:"/forms",enterprise:!1},{id:"decision-tables",title:"GENERAL.NAVIGATION.DECISION-TABLES",path:"/decision-tables",enterprise:!1},{id:"apps",title:"GENERAL.NAVIGATION.APPS",path:"/apps",enterprise:!1},{id:"data-models",title:"GENERAL.NAVIGATION.DATA-MODELS",path:"/data-models",enterprise:!1},{id:"stencils",title:"GENERAL.NAVIGATION.STENCILS",path:"/stencils",enterprise:!1}],e.config=ACTIVITI.CONFIG,e.mainPage=e.mainNavigation[0],e.setMainPage=function(t){e.mainPage=t,n.url(e.mainPage.path)},e.setMainPageById=function(t){for(var i=0;e.mainNavigation.length>i;i++)if(t===e.mainNavigation[i].id){e.mainPage=e.mainNavigation[i];break}},e.safeApply=function(e){var t=this.$root.$$phase;"$apply"===t||"$digest"===t?e&&"function"==typeof e&&e():this.$apply(e)},e.alerts={queue:[]},e.showAlert=function(i){i.queue.length>0?(i.current=i.queue.shift(),i.timeout=t(function(){0===i.queue.length?(i.current=void 0,i.timeout=void 0):e.showAlert(i)},"error"===i.current.type?5e3:1e3)):e.alerts.current=void 0},e.addAlert=function(t,i){var o={message:t,type:i};e.alerts.timeout?e.alerts.queue.push(o):(e.alerts.queue.push(o),e.showAlert(e.alerts))},e.dismissAlert=function(){e.alerts.timeout?(t.cancel(e.alerts.timeout),e.alerts.timeout=void 0,e.showAlert(e.alerts)):e.alerts.current=void 0},e.addAlertPromise=function(t,i){t&&t.then(function(t){e.addAlert(t,i)})},e.editProfile=function(){_internalCreateModal({template:"views/popup/account-edit.html"},i,e)},e.changePassword=function(){_internalCreateModal({template:"views/popup/account-change-password.html"},i,e)}}]).run(["$rootScope","$location","AuthenticationSharedService","Account","$translate","$window","$modal",function(e,t,i,o,n,r,a){var s=ACTIVITI.CONFIG.locales||["en","de","es","fr","it","nl","ja","nb","ru","zh-CN","pt-BR"],l=n.proposedLanguage();-1===s.indexOf(l)?n.use("en").then(function(e){moment.lang(e)}):moment.lang(l);var d="/editor/";e.logout=function(){i.logout()},e.showAboutActiviti=function(){_internalCreateModal({template:"../views/modal/about-activiti.html?"+(new Date).getTime(),show:!0},a,e)};var c=function(e){var i,o=t.absUrl(),n=o.indexOf(d);i=null!==e&&void 0!==e&&void 0!==e.isFromLogout&&e.isFromLogout===!0?o.substring(0,n)+"/#login":o.substring(0,n)+"/#login?redirectUrl="+encodeURIComponent(r.location.pathname+r.location.hash),r.location.href===i?window.location.reload():r.location.href=i};e.$on("event:auth-loginRequired",function(){e.authenticated=!1,e.authenticationChecked=!0,c()}),e.$on("event:auth-authConfirmed",function(){e.authenticated=!0,o.get().then(function(){e.account&&e.account.type&&"enterprise"!==e.account.type&&("/stencils"===t.path()||t.path().indexOf("/stencils/")>=0)?t.path("/processes"):(""===t.path()||"#"===t.path())&&t.path("/processes")})}),e.$on("event:auth-loginConfirmed",function(){e.authenticated=!0,e.account=o.get(),t.path("/processes")}),e.$on("event:auth-loginCancelled",function(t,i){e.authenticated=!1,c(i)}),e.$on("event:auth-loginFailed",function(){e.addAlertPromise(n("LOGIN.MESSAGES.ERROR.AUTHENTICATION"),"error")}),e.backToLanding=function(){var e=t.absUrl(),i=e.indexOf(d);i>=0&&(e=e.substring(0,i),e+="/"),r.location.href=e};var p=function(t){return e.account&&e.account.capabilities?e.account.capabilities.indexOf(t)>-1:!1};e.hasAccessKickstartCapability=function(){return p("access-editor")},e.hasAccessAllModelsInTenantCapability=function(){return p("access-all-models-in-tenant")},e.hasPublishAppCapability=function(){return p("publish-app-to-dashboard")},e.hasTenantManagementCapability=function(){return i.hasTenantManagementCapability()}}]).run(["$http",function(e){e.defaults.xsrfHeaderName="X-CSRF-TOKEN",e.defaults.xsrfCookieName="CSRF-TOKEN"}]).filter("propsFilter",function(){return function(e,t){var i=[];return angular.isArray(e)?e.forEach(function(e){for(var o=!1,n=Object.keys(t),r=0;n.length>r;r++){var a=n[r],s=t[a].toLowerCase();if(-1!==(""+e[a]).toLowerCase().indexOf(s)){o=!0;break}}o&&i.push(e)}):i=e,i}}).filter("notInArray",["$filter",function(e){return function(t,i,o){return i?e("filter")(t,function(e){return-1===i.indexOf(e[o])}):void 0}}]).factory("editorCache",["$cacheFactory",function(e){return e()}]);var EDITOR_CACHE={REST_RESULT_VARIABLES_KEY:"restResponseVariables",FORM_FIELDS_KEY:"formFields",FORM_FIELDS_BY_SID_KEY:"formFieldsBySid",FORM_FIELD_VARIABLES_KEY:"formFieldVariables",FORM_FIELD_VARIABLES_BY_SID_KEY:"formFieldVariablesBySid",EXECUTION_VARIABLES_KEY:"executionVariables",FIELD_TO_VARIABLE_MAPPINGS_KEY:"fieldToVariableMappings",METADATA_VARIABLES_KEY:"metadataVariables",CUSTOM_STENCIL_VARIABLES_KEY:"customStencilVariables",ENTITY_VARIABLES_KEY:"entityVariables"};angular.module("activitiModeler").directive("loading",["$translate",function(){return{restrict:"E",template:"<div class='loading pull-right' ng-show='status.loading'><div class='l1'></div><div class='l2'></div><div class='l2'></div></div>"}}]),angular.module("activitiModeler").directive("loadingLeftPull",["$translate",function(){return{restrict:"E",template:"<div class='loading pull-left' ng-show='status.loading'><div class='l1'></div><div class='l2'></div><div class='l2'></div></div>"}}]),angular.module("activitiModeler").directive("stencilItemIcon",[function(){return{scope:{item:"=stencilItem"},restrict:"E",template:'<img class="stencil-item-list-icon" ng-if="item.customIconId != null && item.customIconId != undefined" ng-src="'+ACTIVITI.CONFIG.contextRoot+'/app/rest/image/{{item.customIconId}}" width="16px" height="16px"/>'+'<img class="stencil-item-list-icon" ng-if="(item.customIconId == null || item.customIconId == undefined) && item.icon != null && item.icon != undefined" ng-src="editor-app/stencilsets/bpmn2.0/icons/{{item.icon}}" width="16px" height="16px"/>'}}]),angular.module("activitiModeler").directive("stencilStepItemIcon",[function(){return{scope:{item:"=stencilItem"},restrict:"E",template:'<img class="stencil-item-list-icon" ng-if="item.customIconId != null && item.customIconId != undefined" ng-src="'+ACTIVITI.CONFIG.contextRoot+'/app/rest/image/{{item.customIconId}}" width="18px" height="18px"/>'+'<li ng-if="(item.customIconId == null || item.customIconId == undefined) && item.icon != null && item.icon != undefined" class="{{item.icon}}" width="18px" height="18px" />'}}]),angular.module("activitiModeler").directive("stencilFormFieldIcon",[function(){return{scope:{item:"=stencilItem"},restrict:"E",template:'<img class="stencil-item-list-icon" ng-if="item.customIconId != null && item.customIconId != undefined" ng-src="'+ACTIVITI.CONFIG.contextRoot+'/app/rest/image/{{item.customIconId}}" width="24px" height="24px"/>'+'<img class="stencil-item-list-icon" ng-if="(item.customIconId == null || item.customIconId == undefined) && item.icon != null && item.icon != undefined" ng-src="{{item.icon}}" width="24px" height="24px"/>'}}]),angular.module("activitiModeler").directive("activitiFixDropdownBug",function(){return{restrict:"AEC",link:function(e,t){t.hasClass("btn-group")||(t=t.parent()),t.on("hidden.bs.dropdown  ",function(){t.show()})}}}),angular.module("activitiModeler").directive("formBuilderElement",["$rootScope","$timeout","$modal","$http","$sce","$templateCache","$translate","RecursionHelper","FormBuilderService","FormUtilService","ContentAccountService",function(e,t,i,o,n,r,a,s,l,d,c){return{restrict:"AE",templateUrl:"views/templates/form-builder-element-template.html",transclude:!1,scope:{formElement:"=formElement",stencilSet:"=stencilSet",editState:"=editState",formMode:"=formMode",drop:"&",moved:"&"},compile:function(e){return s.compile(e,this.link)},link:function(o){function r(e,t){var i;e.forEach(function(e,o){if("container"==e.type&&e.fields){var n=!1,r=!0;for(var a in e.fields)e.fields[a]===t&&(n=!0),e.fields[a]&&e.fields[a].length>0&&(r=!1);n&&r&&(i=o)}}),i>-1&&e.splice(i,1)}for(var s,p=0;o.stencilSet.fieldTypes.length>p;p++)if(o.stencilSet.fieldTypes[p].type===o.formElement.type||"custom"===o.stencilSet.fieldTypes[p].type&&o.stencilSet.fieldTypes[p].customType===o.formElement.type){s=o.stencilSet.fieldTypes[p];break}if(o.currentStencilItem=s,o.currentStencilItem&&(o.formTabs=o.currentStencilItem.tabs),"dynamic-table"===o.formElement.type){if(o.visibleColumns||(o.visibleColumns=[]),o.formElement.columnDefinitions&&o.formElement.columnDefinitions.length>0){o.visibleColumns.length=0;for(var p=0;o.formElement.columnDefinitions.length>p;p++){var u=o.formElement.columnDefinitions[p];u.visible&&o.visibleColumns.push({field:o.formElement.columnDefinitions[p].name,displayName:o.formElement.columnDefinitions[p].name,sortable:o.formElement.columnDefinitions[p].sortable})}}o.gridOptions={columnDefs:o.visibleColumns,enableRowSelection:!1,enableRowHeaderSelection:!1,multiSelect:!1,enableHorizontalScrollbar:0,modifierKeysToMultiSelect:!1,enableColumnMenus:!1,enableSorting:!1}}if("readonly"===o.formElement.type){if(o.visibleReadOnlyColumns||(o.visibleReadOnlyColumns=[]),o.formElement.params&&o.formElement.params.field&&o.formElement.params.field.columnDefinitions&&o.formElement.params.field.columnDefinitions.length>0){o.visibleReadOnlyColumns.length=0;for(var p=0;o.formElement.params.field.columnDefinitions.length>p;p++){var u=o.formElement.params.field.columnDefinitions[p];u.visible&&(o.visibleReadOnlyColumns[p]={field:o.formElement.params.field.columnDefinitions[p].name,displayName:o.formElement.params.field.columnDefinitions[p].name,sortable:o.formElement.params.field.columnDefinitions[p].sortable})}}o.gridOptionsReadOnly={columnDefs:o.visibleReadOnlyColumns,enableRowSelection:!1,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableColumnMenus:!1,enableSorting:!1}}if(("radio-buttons"===o.formElement.type||"dropdown"===o.formElement.type)&&"rest"!==o.formElement.optionType&&o.formElement.options&&o.formElement.options.length>0)for(var m=o.formElement.options,p=0;m.length>p;p++)"dropdown"===o.formElement.type&&0==p&&(m[p].id&&void 0!==m[p].id&&""!==m[p].id||(m[p].id="empty")),m[p].id&&void 0!==m[p].id&&""!==m[p].id||("radio-buttons"===o.formElement.type?m[p].id="option_"+(p+1):"dropdown"===o.formElement.type&&(m[p].id="option_"+p));if("upload"===o.formElement.type&&(o.loadContentAccounts=function(){o.contentAccounts={loading:!0,onPrem:!1};var e=[];e.push({serviceId:"local-file",name:a.instant("FORM-BUILDER.COMPONENT.ATTACH-FILE.LOCAL-FILE")});var t=!1;c.getAccounts().then(function(i){if(i&&i.data)for(var n=0;i.data.length>n;n++)i.data[n]={serviceId:i.data[n].serviceId,name:i.data[n].name,metaDataAllowed:i.data[n].metaDataAllowed},"alfresco-"===i.data[n].serviceId.substring(0,9)?(e.push(i.data[n]),"alfresco-cloud"!=i.data[n].serviceId&&0==t?t=!0:"alfresco-cloud"===i.data[n].serviceId&&(i.data[n].name="Alfresco Cloud")):"google-"===i.data[n].serviceId.substring(0,7)?(e.push(i.data[n]),i.data[n].name="Google Drive"):(e.push(i.data[n]),i.data[n].name="Box");if(e.length>0){e.splice(0,0,{serviceId:"all-file-sources",name:a.instant("FORM-BUILDER.COMPONENT.ATTACH-FILE.ALL-FILE-SOURCES")});var r,s=!1;if(o.formElement.params){if(o.formElement.params.fileSource&&(r=o.formElement.params.fileSource),o.formElement.params.fileSource)for(var n=0;e.length>n;n++)if(o.formElement.params.fileSource&&e[n].serviceId===o.formElement.params.fileSource.serviceId){o.formElement.params.fileSource=e[n],s=!0;break}}else o.formElement.params={};s||(o.formElement.params.fileSource=e[0]),r&&(o.formElement.params.fileSource.selectedFolder=r.selectedFolder,o.formElement.params.fileSource.notAllowNavigateFolders=r.notAllowNavigateFolders)}else o.formElement.params&&(o.formElement.params={},o.formElement.params.fileSource=void 0);o.contentAccounts.onPrem=t,o.contentAccounts.rawList=e,o.contentAccounts.loading=!1})},o.loadContentAccounts()),"select-folder"===o.formElement.type&&(o.loadContentAccounts=function(){o.contentAccounts={loading:!0,onPrem:!1};var e=[],t=!1;c.getAccounts().then(function(i){if(i&&i.data)for(var n=0;i.data.length>n;n++)i.data[n]={serviceId:i.data[n].serviceId,name:i.data[n].name,metaDataAllowed:i.data[n].metaDataAllowed},"alfresco-"===i.data[n].serviceId.substring(0,9)&&(e.push(i.data[n]),"alfresco-cloud"!=i.data[n].serviceId&&0==t?t=!0:"alfresco-cloud"===i.data[n].serviceId&&(i.data[n].name="Alfresco Cloud"));if(e.length>0){var r,a=!1;if(o.formElement.params){if(o.formElement.params.folderSource&&(r=o.formElement.params.folderSource),o.formElement.params.folderSource)for(var n=0;e.length>n;n++)if(o.formElement.params.folderSource&&e[n].serviceId===o.formElement.params.folderSource.serviceId){o.formElement.params.folderSource=e[n],a=!0;break}}else o.formElement.params={};a||(o.formElement.params.folderSource=e[0]),r&&(o.formElement.params.folderSource.selectedFolder=r.selectedFolder,o.formElement.params.folderSource.notAllowNavigateFolders=r.notAllowNavigateFolders)}else o.formElement.params&&(o.formElement.params={},o.formElement.params.folderSource=void 0);o.contentAccounts.onPrem=t,o.contentAccounts.rawList=e,o.contentAccounts.loading=!1})},o.loadContentAccounts()),"container"!==o.formElement.type&&"group"!==o.formElement.type){var h=1;o.formElement.colspan&&(h=o.formElement.colspan),o.formElement.params||(o.formElement.params={}),o.formElement.params.existingColspan=h;for(var f=1,p=0;e.currentFormItems.length>p;p++){var g=e.currentFormItems[p];if(("container"===g.type||"group"===g.type)&&g.fields)for(var v in g.fields)if(g.fields[v]&&g.fields[v].indexOf(o.formElement)>=0){var S=g.numberOfColumns;f=S;for(var I in g.fields){var O=g.fields[I];if(O.indexOf(o.formElement)>=0)break;if(O)if(O.length>0){var b=O[0].colspan;b?f-=b:f--}else f--}break}}o.formElement.params.maxColspan=f}o.formTabs&&o.formTabs.length>0&&(o.activeTab=o.formTabs[0]),o.tabClicked=function(e){o.activeTab=e},o.removeFormElement=function(t){if(t.colspan&&t.colspan>1)for(var i=0;e.currentFormItems.length>i;i++){var o=e.currentFormItems[i];if(("container"===o.type||"group"===o.type)&&o.fields)for(var n in o.fields){var a=o.fields[n];if(a&&a.indexOf(t)>=0){d.removeFormElement(e.currentFormItems,t),e.currentFormItems.indexOf(t)>=0&&e.currentFormItems.splice(e.currentFormItems.indexOf(t),1),d.removeFormElement(e.formItems,t),e.formItems.indexOf(t)>=0&&e.formItems.splice(e.formItems.indexOf(t),1);var s=0;for(var l in o.fields)if(o.fields[l].length>0){var c=parseInt(o.fields[l][0].colspan);c?s+=c:s++}else s++;if(o.numberOfColumns>s)for(var p=s+1;o.numberOfColumns>=p;p++)o.fields[""+(Object.keys(o.fields).length+1)]=[];var u=o.numberOfColumns;for(var m in o.fields){var h=o.fields[m];if(h)if(h.length>0){for(var g=h[0].colspan,p=0;h.length>p;p++)h[p].params.maxColspan=f;g?u-=g:u--}else u--}break}}}else d.removeFormElement(e.currentFormItems,t),e.currentFormItems.indexOf(t)>=0&&e.currentFormItems.splice(e.currentFormItems.indexOf(t),1),d.removeFormElement(e.formItems,t),e.formItems.indexOf(t)>=0&&e.formItems.splice(e.formItems.indexOf(t),1);for(var i=0;e.currentFormItems.length>i;i++){var o=e.currentFormItems[i];if(("container"===o.type||"group"===o.type)&&o.fields)for(var n in o.fields){var a=o.fields[n];a&&a.indexOf(t)>=0&&(a.splice(a.indexOf(t),1),r(e.currentFormItems,a),r(e.formItems,a))}}e.checkGroupsInSource(e.currentFormItems),e.checkGroupsInSource(e.formItems)},o.pristine=!0,o.newOption={name:""},o.insertFormField={position:0},o.openFieldPopover=function(){var e=o.formElement.type,t=void 0;"readonly"===e&&o.formElement.params&&o.formElement.params.field&&o.formElement.params.field.type&&(t=o.formElement.params.field.type),void 0===o.formElement.id&&o.formElementNameChanged(o.formElement),o.fieldEditPopup=_internalCreateModal({template:"views/popover/formfield-edit-popover.html?version="+Date.now(),scope:o,backdrop:"static",keyboard:!1},i,o);var n=o.$on("modal.hide",function(){"readonly"===o.formElement.type&&o.formElement.params&&o.formElement.params.field&&o.formElement.params.field.type&&o.formElement.params.field.type!==e&&o.$emit("readonly-field-referenced-field-changed",{formElement:o.formElement,originalDisplayFieldType:t}),o.formElement.params?1!=o.formElement.params.multiple&&o.formElement.params.fileSource&&o.isGetMetaDataAllowed(o.formElement.params.fileSource.serviceId)||(o.formElement.metaDataColumnDefinitions=void 0):o.formElement.metaDataColumnDefinitions=void 0,n()})},o.isGetMetaDataAllowed=function(e){return e&&e.length>0&&(e.toLowerCase().startsWith("alfresco")||e.toLowerCase().startsWith("box")||e.toLowerCase().startsWith("google-drive"))&&o.formElement.params.fileSource&&o.formElement.params.fileSource.metaDataAllowed?!0:!1},o.normalizeByRegExp=function(e,t){var i="",o=0;for(o=0;e.length>o;o++)t.test(i+e[o])&&(i+=e[o]);return i},o.formElementNameChanged=function(e){if(!e.overrideId){o.identifierRegExp=/^[a-zA-Z][_a-zA-Z0-9]*$/;var t;if(e.name&&e.name.length>0){var i=o.normalizeByRegExp(e.name,o.identifierRegExp);t=i.toLowerCase()}if(!t||0==t.length){var n=1;e.layout&&(n=1+2*e.layout.row+e.layout.column),t="field"+n}e.id=t}},o.toFormFieldColumnArray=function(e){var t=[],i=[];for(I in e)e[I]&&i.push(parseInt(I));i.sort(function(e,t){return e-t});for(var o=0;i.length>o;o++)t.push(e[""+i[o]]);return t},o.changeNumberOfColumns=function(e){if(e.numberOfColumns){var t=0;for(var i in e.fields){var o=e.fields[i];if(o)if(o.length>0){var n=o[0].colspan;n?t+=n:t++}else t++}var r=parseInt(e.numberOfColumns);if(r>0&&13>r){if(t>r){for(var i in e.fields){var o=e.fields[i];if(o&&o.length>0)for(var a=0;o.length>a;a++)o[a].colspan=1}for(var s=Object.keys(e.fields).length,a=s;a>r;a--){for(var l=e.fields[""+a],d=0;l.length>d;d++){var c=l[d];e.fields["1"].push(c)}delete e.fields[""+a]}}else if(r>t)for(var a=t+1;r>=a;a++)e.fields[""+(Object.keys(e.fields).length+1)]=[];var p=r;for(var i in e.fields){var o=e.fields[i];if(o)if(o.length>0){for(var n=o[0].colspan,a=0;o.length>a;a++)o[a].params.maxColspan=p;n?p-=n:p--}else p--}}else e.numberOfColumns=t}},o.changeColspan=function(t){if(t.colspan)for(var i=0;e.currentFormItems.length>i;i++){var o=e.currentFormItems[i];if(("container"===o.type||"group"===o.type)&&o.fields){var n=2;o.numberOfColumns&&(n=o.numberOfColumns);var r,a,s,l=1;for(var d in o.fields){var c=o.fields[d];if(!r&&c&&c.indexOf(t)>=0){var p=c.indexOf(t);r=parseInt(d),c[0].params&&c[0].params.existingColspan&&(l=c[0].params.existingColspan),a=l>t.colspan||n-r+1>=t.colspan?t.colspan:n-p;for(var u=0;c.length>u;u++)c[u].params||(c[u].params={}),c[u].params.existingColspan=a,c[u].colspan=a}s=parseInt(d)}if(r&&a){var m=1,h=a-l,f={};if(0>h){for(var u=1;Object.keys(o.fields).length>=u;u++)if(f[""+m]=o.fields[""+u],m++,u==r)for(var g=1;Math.abs(h)>=g;g++)f[""+m]=[],m++}else if(h>0){for(var v=[],u=1;Object.keys(o.fields).length>=u;u++){if(f[""+m]=o.fields[""+u],v&&v.length>0){var S,I=f[""+m];if(I&&I.length>0&&(S=I[0].colspan?I[0].colspan:1),S)for(var g=0;v.length>g;g++)v[g].params||(v[g].params={}),v[g].params.existingColspan=S,v[g].colspan=S;
Array.prototype.push.apply(f[""+m],v),v=void 0}if(m++,u==r){for(var g=1;h>=g;g++){var O=o.fields[""+(u+g)];O&&Array.prototype.push.apply(v,O)}u+=h}}if(v&&v.length>0){var S;if(f["1"]&&f["1"].length>0&&(S=f["1"][0].colspan?f["1"][0].colspan:1),S)for(var g=0;v.length>g;g++)v[g].params||(v[g].params={}),v[g].params.existingColspan=S,v[g].colspan=S;Array.prototype.push.apply(f["1"],v)}var b=0;for(var d in f)if(f[d])if(f[d].length>0){var E=parseInt(f[d][0].colspan);E?b+=E:b++}else b++;if(n>b)for(var u=b+1;n>=u;u++)f[""+(Object.keys(f).length+1)]=[]}o.fields=f;var y=o.numberOfColumns;for(var d in o.fields){var R=o.fields[d];if(R)if(R.length>0){for(var E=R[0].colspan,u=0;R.length>u;u++)R[u].params.maxColspan=y;E?y-=E:y--}else y--}break}}}},o.setManualOptions=function(){o.formElement.optionType="manual"},o.setRestOptions=function(){o.formElement.optionType="rest"},o.setCustomVariableType=function(e,t){o.formElement.params.customProperties||(o.formElement.params.customProperties={}),o.formElement.params.customProperties[""+e]||(o.formElement.params.customProperties[""+e]={}),o.formElement.params.customProperties[""+e].fieldType=t},o.confirmNewOption=function(e){if(o.newOption.name){var t=o.formElement.options;"radio-buttons"===o.formElement.type?o.newOption.id="option_"+(t.length+1):"dropdown"===o.formElement.type&&(o.newOption.id="option_"+t.length),t.push(o.newOption),o.newOption={name:""},o.formElement.sizeY="radio-buttons"===o.formElement.type&&t.length>4?3:"radio-buttons"===o.formElement.type&&t.length>1?2:1,2==t.length&&(o.formElement.value=o.formElement.options[0].name),e&&$(e.target).focus()}},o.optionKeyDown=function(e){13==e.keyCode&&o.confirmNewOption(e)},o.removeOption=function(e){if(o.formElement.options.splice(e,1),1==o.formElement.options)o.formElement.value="";else{for(var t=!1,i=0;o.formElement.options.length>i;i++)o.formElement.options[i].name==o.formElement.value&&(t=!0);t||(o.formElement.value=o.formElement.options[0].name)}},o.currentStencilItem&&o.currentStencilItem.formBuilderTemplate&&o.currentStencilItem.formBuilderTemplate.length>0&&(o.formBuilderTemplateNgBindHtml=n.trustAsHtml(o.currentStencilItem.formBuilderTemplate)),o.endpointChanged=function(){o.$broadcast("endpoint-selection-changed",o.formElement.endpoint)},o.doneEditing=function(){if(o.$broadcast("done-editing-field",o.formElement),o.formElement.endpoint&&o.formElement.endpoint.requestHeaders&&0!==o.formElement.endpoint.requestHeaders.length||delete o.formElement.requestHeaders,"dynamic-table"===o.formElement.type&&o.formElement.columnDefinitions&&o.formElement.columnDefinitions.length>0){o.visibleColumns.length=0;for(var e=0;o.formElement.columnDefinitions.length>e;e++){var t=o.formElement.columnDefinitions[e];t.visible&&""!=t.name&&""!=t.id&&o.visibleColumns.push({field:o.formElement.columnDefinitions[e].name,displayName:o.formElement.columnDefinitions[e].name,sortable:o.formElement.columnDefinitions[e].sortable})}}if(o.formElement.visibilityConditions){var i=o.formElement.visibilityConditions.shift();E(i,o.formElement.visibilityConditions),o.formElement.visibilityCondition=i,delete o.formElement.visibilityConditions}o.fieldEditPopup&&o.fieldEditPopup.$scope.$hide(),o.formElement.hasValidationError&&l.validateForm()};var E=function(e,t){e&&(e.nextCondition=void 0);var i={};return t.length>0?(i=t.shift(),e.nextCondition=i,E(e.nextCondition,t),void 0):i};o.$watch("formElement.params.field",function(e,t){if(!o.pristine||void 0!==t&&t.id!=e.id)if(e&&e.name&&(o.formElement.name=e.name),e&&"dynamic-table"===e.type){if(o.formElement.sizeX=2,o.formElement.sizeY=2,o.visibleReadOnlyColumns){o.visibleReadOnlyColumns.length=0;for(var i=0;e.columnDefinitions.length>i;i++){var n=e.columnDefinitions[i];n.visible&&(o.visibleReadOnlyColumns[i]={field:e.columnDefinitions[i].name,displayName:e.columnDefinitions[i].name,sortable:e.columnDefinitions[i].sortable})}}}else o.formElement.sizeX=1,o.formElement.sizeY=1;else o.pristine=!1}),o.$watch("insertFormField.field",function(e){if(e){var i;"readonly-text"==o.formElement.type?i=o.formElement.value:"typeahead"==o.formElement.type||"radio-buttons"==o.formElement.type||"dropdown"==o.formElement.type?i=o.formElement.restUrl:"hyperlink"==o.formElement.type&&(i=o.formElement.hyperlinkUrl);var n="${"+e.id+"}";i=i?i.substring(0,o.insertFormField.position)+n+i.substring(o.insertFormField.position):n,o.insertFormField.field=void 0,t(function(){var e;"readonly-text"==o.formElement.type?e=angular.element("#readonly-text-value"):"typeahead"==o.formElement.type||"radio-buttons"==o.formElement.type||"dropdown"==o.formElement.type?e=angular.element("#rest-url-value"):"hyperlink"==o.formElement.type&&(e=angular.element("#hyperlink-url-value")),e.focus(),e.val(i),"readonly-text"==o.formElement.type?o.formElement.value=i:"typeahead"==o.formElement.type||"radio-buttons"==o.formElement.type||"dropdown"==o.formElement.type?o.formElement.restUrl=i:"hyperlink"==o.formElement.type&&(o.formElement.hyperlinkUrl=i)},200)}}),o.noOfVisibleColumns=function(e){var t=o.getVisibleColumnDefinitions(e);return t?t.length:0},o.getVisibleColumnDefinitions=function(e){var t=[];if(!e||!e.columnDefinitions||1>e.columnDefinitions.length)return t;for(var i=0;e.columnDefinitions.length>i;i++){var o=e.columnDefinitions[i];o.visible&&t.push(o)}return t},o.showValidationErrors=function(e){o.currentFormField=e,_internalCreateModal({backdrop:!0,keyboard:!0,template:"views/popup/form-builder-validation-errors.html?version="+Date.now(),scope:o},i,o)},o.endpointLabel=function(e,t,i,o,n){var r=" ("+y(t,i,o,n)+")";return r=r.toLowerCase(),e+r},o.model=o.formElement.params&&o.formElement.params.field?o.formElement.params.field.responseVariable?{urlFieldType:"restResponse"}:{urlFieldType:"formField"}:{urlFieldType:"formField"},o.setUrlFieldType=function(e){"restResponse"===e?(o.model={urlFieldType:"restResponse"},o.formElement.params&&(o.formElement.params.field={})):"formField"===e&&(o.model={urlFieldType:"formField"},o.formElement.params&&(o.formElement.params.field={}))},o.getFullEndpointURL=function(){var e="";return o.formElement.endpoint&&(e=y(o.formElement.endpoint.protocol,o.formElement.endpoint.host,o.formElement.endpoint.port,o.formElement.endpoint.path)),o.formElement.restUrl&&(e="/"===e.charAt(e.length-1)&&"/"===o.formElement.restUrl.charAt(0)?e.concat(o.formElement.restUrl.substr(1)):""!=e&&"/"!==e.charAt(e.length-1)&&"/"!==o.formElement.restUrl.charAt(0)?e.concat("/"+o.formElement.restUrl):e.concat(o.formElement.restUrl)),e};var y=function(e,t,i,o){var n=e.toLowerCase()+"://"+t;return n=i&&80!=i&&443!=i?n.concat(":"+i):n,n=o?n.concat(o):n};o.executeEndpointTest=function(e){o.selectedColumnDef=e,o.endpointTestVisible={visible:!0}};var R=function(){if(o.formElement.endpoint&&e.endpointConfigurations){for(var t=!0,i=0;e.endpointConfigurations.length>i;i++)if(o.formElement.endpoint.id===e.endpointConfigurations[i].id){t=!1,o.formElement.endpoint=angular.copy(e.endpointConfigurations[i]);break}t&&(o.formElement.endpoint=void 0)}};o.$watch("endpointConfigurations",function(e,t){void 0!==e&&e!==t&&R()},!0),o.getEndpoints=function(){return e.endpointConfigurations},R(),o.allowedTypes=["text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount"],o.model?o.model.variableType||(o.model.variableType="formField"):o.model={variableType:"formField"},o.getGlobalDateFormat=function(){return e.globalDateFormat},o.formVariables=(e.currentFormVariables||[]).map(function(e){return{id:e.name,name:e.name,type:e.type}})}}}]),angular.module("activitiModeler").directive("storeCursorPosition",["$rootScope","$timeout","$popover","$http","$templateCache",function(){return{restrict:"A",scope:{storeCursorPosition:"=storeCursorPosition"},link:function(e,t){t.on("click change keypress",function(){void 0!==e.storeCursorPosition&&(e.storeCursorPosition=t[0].selectionStart)})}}}]),angular.module("activitiModeler").directive("selectGroupPopover",["$http","$popover","$parse","GroupService",function(e,t,i,o){var n={};return n.restrict="A",n.scope={excludeGroupIds:"=excludeGroupIds",selectGroupFormFields:"=selectGroupFormFields"},n.link=function(e,n,r){var a="bottom";n.addClass("group-selection"),r.placement&&(a=r.placement),e.popover=t(n,{template:"views/popover/select-group-popover.html",placement:a});var s,l;r.onGroupSelected&&(s=i(r.onGroupSelected)),r.onCancel&&(l=i(r.onCancel));var d=e.popover.$scope;d.title=r.popoverTitle,d.popupModel={groupField:{},groupFieldFilter:["functional-group"]},e.selectGroupFormFields&&(d.popupModel.formFields=e.selectGroupFormFields),d.setSearchType=function(){d.popupModel.groupSourceType="search"},d.setFormFieldType=function(){d.popupModel.groupSourceType="field"},d.$watch("popupModel.groupField",function(){if(d.popupModel.groupField&&d.popupModel.groupField.id){if(s){var t={id:d.popupModel.groupField.id,name:d.popupModel.groupField.name,type:d.popupModel.groupField.type};s(e.$parent,{groupField:t}),d.popupModel.groupField={}}d.$hide()}}),d.$watch("popupModel.filter",function(){e.updateFilter()}),d.resetSelection=function(){d.popupModel.groupResults&&d.popupModel.groupResults.length>0?(d.popupModel.selectedGroup=d.popupModel.groupResults[0],d.popupModel.selectedIndex=0):(d.popupModel.selectedGroup=void 0,d.popupModel.selectedIndex=-1)},d.nextGroup=function(){var e=d.popupModel.groupResults;e&&e.length>0&&d.popupModel.selectedIndex<e.length-1&&(d.popupModel.selectedIndex+=1,d.popupModel.selectedGroup=e[d.popupModel.selectedIndex])},d.previousGroup=function(){var e=d.popupModel.groupResults;e&&e.length>0&&d.popupModel.selectedIndex>0&&(d.popupModel.selectedIndex-=1,d.popupModel.selectedGroup=e[d.popupModel.selectedIndex])},d.confirmGroup=function(t){if(!t){var i=d.popupModel.groupResults;d.popupModel.selectedIndex>=0&&d.popupModel.selectedIndex<i.length&&(t=i[d.popupModel.selectedIndex])}t&&(s&&s(e.$parent,{group:t}),d.$hide())},e.updateFilter=function(){o.getFilteredGroups(d.popupModel.filter).then(function(t){if(null!==e.excludeGroupIds&&void 0!==e.excludeGroupIds){d.popupModel.groupResults=[];for(var i=0;t.data.length>i;i++)t.data[i].id&&-1===e.excludeGroupIds.indexOf(t.data[i].id)&&d.popupModel.groupResults.push(t.data[i])}else d.popupModel.groupResults=t.data;d.resetSelection()})},d.$on("tooltip.show",function(){e.updateFilter()}),d.$on("tooltip.hide",function(){d.popupModel.groupResults=[],d.popupModel.filter="",d.popupModel.added?d.popupModel.added=!1:l&&l(e.$parent)})},n}]),angular.module("activitiModeler").directive("editMetadataPopover",["$rootScope","$http","$popover","$translate","$timeout","$parse",function(e,t,i,o,n,r){var a={restrict:"A",scope:{metadata:"=metadata"}};return a.link=function(e,t,a){var s="bottom-left";t.addClass("form-selection"),a.placement&&(s=a.placement),e.popover=i(t,{template:"views/popover/edit-metadata-popover.html",placement:s});var l;a.onClosed&&(l=r(a.onClosed));var d=e.popover.$scope;d.title=a.popoverTitle,d.metadata={fields:[],selectedField:null},d.gridOptions={data:[],headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,enableColumnMenus:!1,columnDefs:[{field:"key",displayName:o.instant("FORM-BUILDER.METADATA.KEY")},{field:"value",displayName:o.instant("FORM-BUILDER.METADATA.VALUE")}]},d.gridOptions.onRegisterApi=function(t){d.metadataGridApi=t,t.selection.on.rowSelectionChanged(e,function(e){d.metadata.selectedField=e.isSelected?e.entity:null})},d.addField=function(){var e={key:"",value:""};d.metadata.fields.push(e),n(function(){d.metadataGridApi.selection.toggleRowSelection(e)})},d.removeField=function(){if(d.metadata.selectedField){var e=d.metadata.fields.indexOf(d.metadata.selectedField);e>=0&&(d.metadataGridApi.selection.clearSelectedRows(),d.metadata.fields.splice(e,1),n(function(){d.metadata.fields.length>0?d.metadataGridApi.selection.toggleRowSelection(d.metadata.fields[0]):d.metadata.selectedField=null}))}},d.$on("tooltip.show",function(){d.gridOptions.data=e.metadata.fields,d.metadata.fields=e.metadata.fields}),d.$on("tooltip.hide",function(){l&&l(e.$parent)})},a}]),angular.module("activitiModeler").directive("selectFormPopover",["$rootScope","$http","$popover","ProcessBuilderService","$parse",function(e,t,i,o,n){var r={};return r.restrict="A",r.scope={},r.link=function(t,r,a){var s="bottom-left";r.addClass("form-selection"),a.placement&&(s=a.placement),t.popover=i(r,{template:"views/popover/select-form-popover.html",placement:s});var l,d,c,p;a.onFormSelected&&(l=n(a.onFormSelected)),a.onFormCreate&&(c=n(a.onFormCreate)),a.onCancel&&(d=n(a.onCancel)),a.onClear&&(p=n(a.onClear));var u=t.popover.$scope;u.title=a.popoverTitle,u.popupModel={},u.$watch("popupModel.filter",function(){e.currentKickstartModel.definition&&e.currentKickstartModel.definition.id&&o.filterKickstartForms(u.popupModel.filter).then(function(e){u.popupModel.formResults=e.data,u.resetSelection()})}),u.resetSelection=function(){u.popupModel.formResults&&u.popupModel.formResults.length>0?(u.popupModel.selectedForm=u.popupModel.formResults[0],u.popupModel.selectedIndex=0):(u.popupModel.selectedForm=void 0,u.popupModel.selectedIndex=-1)},u.nextForm=function(){var e=u.popupModel.formResults;e&&e.length>0&&u.popupModel.selectedIndex<e.length-1&&(u.popupModel.selectedIndex+=1,u.popupModel.selectedForm=e[u.popupModel.selectedIndex])},u.previousForm=function(){var e=u.popupModel.formResults;e&&e.length>0&&u.popupModel.selectedIndex>0&&(u.popupModel.selectedIndex-=1,u.popupModel.selectedForm=e[u.popupModel.selectedIndex])},u.createForm=function(){c&&c(t.$parent),u.$hide()},u.clearForm=function(){p&&p(t.$parent),u.$hide()},u.confirmForm=function(e){if(!e){var i=u.popupModel.formResults;u.popupModel.selectedIndex>=0&&u.popupModel.selectedIndex<i.length&&(e=i[u.popupModel.selectedIndex])}e&&(l&&l(t.$parent,{form:e}),u.$hide())},u.$on("tooltip.show",function(){e.currentKickstartModel.definition&&e.currentKickstartModel.definition.id&&o.filterKickstartForms(u.popupModel.filter).then(function(e){u.popupModel.formResults=e.data,u.resetSelection()})}),u.$on("tooltip.hide",function(){u.popupModel.formResults=[],u.popupModel.filter="",u.popupModel.added?u.popupModel.added=!1:d&&d(t.$parent)})},r}]),angular.module("activitiModeler").directive("selectSubprocessPopover",["$http","$popover","ProcessBuilderService","$parse",function(e,t,i,o){var n={};return n.restrict="A",n.scope={},n.link=function(e,n,r){var a="bottom-left";n.addClass("selection"),r.placement&&(a=r.placement),e.popover=t(n,{template:"views/popover/select-subprocess-popover.html",placement:a});var s,l,d,c;r.onSubprocessSelected&&(s=o(r.onSubprocessSelected)),r.onSubprocessCreate&&(d=o(r.onSubprocessCreate)),r.onCancel&&(l=o(r.onCancel)),r.onClear&&(c=o(r.onClear));var p=e.popover.$scope;p.title=r.popoverTitle,p.popupModel={},p.$watch("popupModel.filter",function(){i.filterKickstartSubProcesses(p.popupModel.filter).then(function(e){p.popupModel.subProcessResults=e.data,p.resetSelection()})}),p.resetSelection=function(){p.popupModel.subProcessResults&&p.popupModel.subProcessResults.length>0?(p.popupModel.selectedSubProcess=p.popupModel.subProcessResults[0],p.popupModel.selectedIndex=0):(p.popupModel.selectedSubProcess=void 0,p.popupModel.selectedIndex=-1)},p.nextSubProcess=function(){var e=p.popupModel.subProcessResults;e&&e.length>0&&p.popupModel.selectedIndex<e.length-1&&(p.popupModel.selectedIndex+=1,p.popupModel.selectedSubProcess=e[p.popupModel.selectedIndex])},p.previousForm=function(){var e=p.popupModel.subProcessResults;e&&e.length>0&&p.popupModel.selectedIndex>0&&(p.popupModel.selectedIndex-=1,p.popupModel.selectedSubProcess=e[p.popupModel.selectedIndex])},p.createSubProcess=function(){d&&d(e.$parent),p.$hide()},p.clearSubProcess=function(){c&&c(e.$parent),p.$hide()},p.confirmSubProcess=function(t){if(!t){var i=p.popupModel.subProcessResults;p.popupModel.selectedIndex>=0&&p.popupModel.selectedIndex<i.length&&(t=forms[p.popupModel.selectedIndex])}t&&(s&&s(e.$parent,{subProcess:t}),p.$hide())},p.$on("tooltip.show",function(){i.filterKickstartSubProcesses(p.popupModel.filter).then(function(e){p.popupModel.subProcessResults=e.data,p.resetSelection()})}),p.$on("tooltip.hide",function(){p.popupModel.subProcessResults=[],p.popupModel.filter="",p.popupModel.added?p.popupModel.added=!1:l&&l(e.$parent)})},n}]),angular.module("activitiModeler").directive("assignmentSelect",["$http","$templateCache","ProcessBuilderService","FormBuilderService","ProcessScopeService",function(e,t,i,o,n){var r={};return r.restrict="A",r.templateUrl="views/includes/select-assignment.html",r.replace=!0,r.scope={assignmentObject:"=assignmentSelect",allSteps:"=allSteps",stepId:"=stepId",title:"=title"},r.controller=["$rootScope","$scope","$translate","$element",function(e,t,i){t.assignmentOptions=[{id:"initiator",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-INITIATOR")},{id:"groupManagerForInitiator",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-GROUP-MANAGER-FOR-INITIATOR")},{id:"user",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-SINGLE-USER")},{id:"groupManager",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-GROUP-MANAGER")},{id:"users",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-CANDIDATE-USERS")},{id:"groups",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-CANDIDATE-GROUPS")}],t.assignmentOption=t.assignmentOptions[0];var o=n.getFormFieldsForStep(t.allSteps,t.stepId,["people","functional-group"]);t.assignmentFormFields=o,t.$watch("assignmentOption",function(e){e?(t.assignmentObject.type=e.id,"initiator"==e.id||"groupManagerForInitiator"==e.id?(t.assignmentObject.assignee={},t.assignmentObject.groupManager=void 0,t.assignmentObject.groupManagerField=void 0,t.assignmentObject.candidateUsers=[],t.assignmentObject.candidateUserFields=[],t.assignmentObject.candidateGroups=[],t.assignmentObject.candidateGroupFields=[]):"user"==e.id?(t.assignmentObject.groupManager=void 0,t.assignmentObject.groupManagerField=void 0,t.assignmentObject.candidateUsers=[],t.assignmentObject.candidateUserFields=[],t.assignmentObject.candidateGroups=[],t.assignmentObject.candidateGroupFields=[]):"groupManager"==e.id?(t.assignmentObject.assignee={},t.assignmentObject.candidateUsers=[],t.assignmentObject.candidateUserFields=[],t.assignmentObject.candidateGroups=[],t.assignmentObject.candidateGroupFields=[]):"users"==e.id?(t.assignmentObject.groupManager=void 0,t.assignmentObject.groupManagerField=void 0,t.assignmentObject.candidateUsers||(t.assignmentObject.candidateUsers=[]),t.assignmentObject.candidateUserFields||(t.assignmentObject.candidateUserFields=[])):"groups"==e.id&&(t.assignmentObject.groupManager=void 0,t.assignmentObject.groupManagerField=void 0,t.assignmentObject.candidateGroups||(t.assignmentObject.candidateGroups=[]),t.assignmentObject.candidateGroupFields||(t.assignmentObject.candidateGroupFields=[]))):t.assignmentObject.type=t.assignmentOptions[0].id}),t.setAssignee=function(e,i){e?(t.assignmentObject.assignee=e,t.assignmentObject.assigneeField=void 0):i&&(t.assignmentObject.assigneeField=i,t.assignmentObject.assignee=void 0)},t.setGroupManager=function(e,i){e?(t.assignmentObject.groupManager=e,t.assignmentObject.groupManagerField=void 0):i&&(t.assignmentObject.groupManagerField=i,t.assignmentObject.groupManager=void 0)},t.addCandidateUser=function(e,i){var o=!1;if(e){for(var n=0;t.assignmentObject.candidateUsers.length>n;n++)if(t.assignmentObject.candidateUsers[n].id===e.id){o=!0;break}}else if(i)for(var n=0;t.assignmentObject.candidateUserFields.length>n;n++)if(t.assignmentObject.candidateUserFields[n].id===i.id){o=!0;break}!o&&e?t.assignmentObject.candidateUsers.push(e):!o&&i&&t.assignmentObject.candidateUserFields.push(i)},t.addCandidateUserByEmail=function(e){var i=!1;if(t.assignmentObject.candidateUsers)for(var o=0;t.assignmentObject.candidateUsers.length>o;o++)if(t.assignmentObject.candidateUsers[o].email===e){i=!0;break}i||t.assignmentObject.candidateUsers.push({email:e})},t.removeCandidateUser=function(e){for(var i=t.assignmentObject.candidateUsers,o=-1,n=0;i.length>n;n++)if(e.id){if(e.id==i[n].id){o=n;break}}else if(e.email==i[n].email){o=n;break}o>=0&&i.splice(o,1)},t.removeCandidateUserField=function(e){for(var i=t.assignmentObject.candidateUserFields,o=-1,n=0;i.length>n;n++)if(e.id&&e.id==i[n].id){o=n;break}o>=0&&i.splice(o,1)},t.addCandidateGroup=function(e,i){var o=!1;if(e&&t.assignmentObject.candidateGroups)for(var n=0;t.assignmentObject.candidateGroups.length>n;n++)if(t.assignmentObject.candidateGroups[n].id===e.id){o=!0;break}if(i&&t.assignmentObject.candidateGroupFields)for(var n=0;t.assignmentObject.candidateGroupFields.length>n;n++)if(t.assignmentObject.candidateGroupFields[n].id===i.id){o=!0;break}e&&!o?t.assignmentObject.candidateGroups.push(e):i&&!o&&t.assignmentObject.candidateGroupFields.push(i)},t.removeCandidateGroup=function(e){for(var i=t.assignmentObject.candidateGroups,o=-1,n=0;i.length>n;n++)if(e.id==i[n].id){o=n;break}o>=0&&i.splice(o,1)},t.removeCandidateGroupField=function(e){for(var i=t.assignmentObject.candidateGroupFields,o=-1,n=0;i.length>n;n++)if(e.id==i[n].id){o=n;break}o>=0&&i.splice(o,1)}}],r.link=function(e){var t;if(e.assignmentObject&&e.assignmentObject.type)for(var i=0;e.assignmentOptions.length>i;i++)if(e.assignmentOptions[i].id==e.assignmentObject.type){t=e.assignmentOptions[i];break}t||(t=e.assignmentOptions[0]),e.assignmentOption=t},r}]),angular.module("activitiModeler").directive("fieldsSelect",["$http","$templateCache",function(){var e={};return e.restrict="A",e.templateUrl="views/includes/select-fields.html",e.replace=!0,e.scope={propertyObject:"=fieldsSelect",stepObject:"=fieldsSelectStep",title:"=title"},e.controller=["$rootScope","$scope","$element",function(e,t){t.stepObject[t.propertyObject.id]&&t.stepObject[t.propertyObject.id].fields||(t.stepObject[t.propertyObject.id]={fields:[]}),t.model={selectedField:void 0},t.addField=function(){if(t.model.selectedField){var e=!1;if(t.stepObject[t.propertyObject.id].fields)for(var i=0;t.stepObject[t.propertyObject.id].fields.length>i;i++)if(t.stepObject[t.propertyObject.id].fields[i].id===t.model.selectedField.id){e=!0;break}e||t.stepObject[t.propertyObject.id].fields.push(t.model.selectedField)}},t.removeField=function(e){for(var i=t.stepObject[t.propertyObject.id].fields,o=-1,n=0;i.length>n;n++)if(e.id==i[n].id){o=n;break}o>=0&&i.splice(o,1)}}],e.link=function(){},e}]),angular.module("activitiModeler").directive("recipientSelect",["$http","$translate","$templateCache","FormBuilderService","ProcessScopeService",function(e,t,i,o,n){var r={};return r.restrict="A",r.templateUrl="views/includes/select-recipient.html",r.replace=!0,r.scope={recipientObject:"=recipientSelect",allSteps:"=allSteps",stepId:"=stepId",title:"=title"},r.controller=["$rootScope","$scope","$element",function(e,i){i.recipientOptions=[{id:"initiator",title:t.instant("PROCESS-BUILDER.EMAIL-STEP.RECIPIENT.POPOVER.SELECT-INITIATOR")},{id:"user",title:t.instant("PROCESS-BUILDER.EMAIL-STEP.RECIPIENT.POPOVER.SELECT-USER")},{id:"users",title:t.instant("PROCESS-BUILDER.EMAIL-STEP.RECIPIENT.POPOVER.SELECT-USERS")}],i.recipientOption=i.recipientOptions[0];var o=n.getFormFieldsForStep(i.allSteps,i.stepId,["people"]);i.recipientFormFields=o,i.$watch("recipientOption",function(e){e?(i.recipientObject.type=e.id,"initiator"==e.id?(i.recipientObject.user=null,i.recipientObject.users=null,i.recipientObject.userFields=null):"user"==e.id?(i.recipientObject.users=null,i.recipientObject.userFields=null):"users"==e.id&&(i.recipientObject.user=null,i.recipientObject.users||(i.recipientObject.users=[]),i.recipientObject.userFields||(i.recipientObject.userFields=[]))):i.assignmentObject.type=i.assignmentOptions[0].id}),i.setRecipient=function(e,t){e?(i.recipientObject.user=e,i.recipientObject.userField=void 0,i.recipientObject.userFields=void 0):t&&(i.recipientObject.userField=t,i.recipientObject.user=void 0,i.recipientObject.userFields=void 0)},i.addRecipient=function(e,t){var o=!1;if(e){if(i.recipientObject.users)for(var n=0;i.recipientObject.users.length>n;n++)if(i.recipientObject.users[n].id===e.id){o=!0;break}}else if(t&&i.recipientObject.userFields)for(var n=0;i.recipientObject.userFields.length>n;n++)if(i.recipientObject.userFields[n].id===t.id){o=!0;break}o||(e?i.recipientObject.users.push(e):t&&i.recipientObject.userFields.push(t))},i.addUserByEmail=function(e){var t=!1;if(i.recipientObject.users)for(var o=0;i.recipientObject.users.length>o;o++)if(i.recipientObject.users[o].email===e){t=!0;break}t||i.recipientObject.users.push({email:e})},i.removeUser=function(e){for(var t=i.recipientObject.users,o=-1,n=0;t.length>n;n++)if(e.id){if(e.id==t[n].id){o=n;break}}else if(e.email==t[n].email){o=n;break}o>=0&&t.splice(o,1)},i.removeUserField=function(e){for(var t=i.recipientObject.userFields,o=-1,n=0;t.length>n;n++)if(e.id&&e.id==t[n].id){o=n;break}o>=0&&t.splice(o,1)}}],r.link=function(e){var t;if(e.recipientObject&&e.recipientObject.type)for(var i=0;e.recipientOptions.length>i;i++)if(e.recipientOptions[i].id==e.recipientObject.type){t=e.recipientOptions[i];break}t||(t=e.recipientOptions[0]),e.recipientOption=t},r}]),angular.module("activitiModeler").directive("fieldSelect",["$rootScope","$http","$templateCache","$timeout","ProcessScopeService",function(e,t,i,o,n){var r={};return r.restrict="A",r.templateUrl="views/includes/select-field.html",r.replace=!0,r.scope={selectedField:"=fieldSelect",availableFormFields:"=fields",includeType:"=includeType",expandRelative:"=expandRelative",selectTitle:"=selectTitle",filterDisplayFields:"=filterDisplayFields",fieldTypeFilter:"=fieldTypeFilter",variablesType:"@variablesType",editorType:"@editorType",stepId:"=stepId",allSteps:"=allSteps",includeCurrentStep:"=includeCurrentStep",processModelId:"=processModelId",formVariables:"=formVariables",disabled:"=ngDisabled",basicFieldInfo:"=basicFieldInfo"},r.controller=["$scope","$element",function(e){e.selectField=function(t){e.selectedField=t},e.refreshFields=function(){var t=[];if(e.variablesType&&"rest"==e.variablesType){if(e.variablesType&&"rest"===e.variablesType){var i=[],o=n.getVariablesForStep(e.allSteps,e.stepId,e.fieldTypeFilter);if(o&&o.length>0)for(var r=0;o.length>r;r++){var a={id:o[r].processVariableName,name:o[r].processVariableName};e.includeType&&(a.type=o[r].processVariableType),e.editorType&&"form"===e.editorType&&(a.responseVariable=!0),i.push(a)}if(e.formVariables&&e.formVariables.length>0)for(var r=0;e.formVariables.length>r;r++){var a={id:e.formVariables[r].name,name:e.formVariables[r].name};e.includeType&&(a.type=e.formVariables[r].type),e.editorType&&"form"===e.editorType&&(a.responseVariable=!0),i.push(a)}t=i}}else{var s=[];if(s=e.availableFormFields?e.availableFormFields:n.getFormFieldsForStep(e.allSteps,e.stepId,e.fieldTypeFilter,e.includeCurrentStep),s&&s.length>0)for(var r=0;s.length>r;r++){var l=s[r];if(l){if(e.filterDisplayFields&&"dynamic-table"===l.type)continue;var d={id:l.id,name:l.name};e.includeType&&(d.type=l.type),e.basicFieldInfo||("dynamic-table"===l.type?d.columnDefinitions=l.columnDefinitions:"amount"===l.type?(d.currency=l.currency||"$",d.enableFractions=l.enableFractions):"hyperlink"===l.type?(d.hyperlinkUrl=l.hyperlinkUrl,d.displayText=l.displayText):"date"===l.type&&(d.dateDisplayFormat=l.dateDisplayFormat)),t.push(d)}}t=t.concat(e.formVariables||[])}t.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),e.formFields=t},e.fixPosition=function(t){e.expandRelative&&o(function(){var e=angular.element(t.target);e.next().css("position","relative"),e.parent().on("hide.bs.dropdown",function(){e.next().css("position","absolute"),e.parent().off("hide.bs.dropdown")})},0)},e.refreshFields(),e.$watch("availableFormFields",function(t,i){t!==i&&e.refreshFields()},!0),e.$watch("formVariables",function(t,i){t!==i&&e.refreshFields()},!0)}],r.link=function(e,t,i){i.filterType&&(e.filterType=i.filterType,o(function(){e.refreshFields()}))},r}]),angular.module("activitiModeler").directive("variablesSelect",["$rootScope","$http","$templateCache","$timeout",function(){var e={};return e.restrict="A",e.templateUrl="views/includes/select-variables.html",e.replace=!0,e.scope={fields:"=fields",selectedField:"=selectedField",includeType:"=includeType",targetModel:"=targetModel",fieldTypeFilter:"=fieldTypeFilter",ignoreSelection:"=ignoreSelection"},e.controller=["$scope","$element",function(e){var t=[];if(e.fieldTypeFilter&&e.fieldTypeFilter.length>0){if(e.fields&&e.fields.length>0)for(var i=0;e.fields.length>i;i++)e.fieldTypeFilter.indexOf(e.fields[i].type)>=0&&t.push(e.fields[i])}else t=e.fields;e.filteredFields=t,e.selectField=function(t){void 0!==e.selectedField&&(e.selectedField=t),void 0!==e.targetModel&&(e.targetModel=t.id)}}],e}]),angular.module("activitiModeler").directive("editorInputCheck",function(){return{require:"ngModel",link:function(e,t,i,o){var n=!1,r=/[&\/\\#,+~%.'":*?<>{}()$@;]/g;if(i.editorInputCheck)try{n=i.editorInputCheck}catch(a){n=!1}"true"==n&&(r=/[&\/\\#,+~%.'":*?<>()@;]/g),o.$parsers.push(function(e){var t=e.replace(r,"");return t!=e&&(o.$setViewValue(t),o.$render()),t})}}}),angular.module("activitiModeler").directive("selectDecisionTablePopover",["$rootScope","$http","$popover","DecisionTableService","$parse",function(e,t,i,o,n){var r={};return r.restrict="A",r.scope={},r.link=function(t,r,a){var s="bottom-left";r.addClass("decision-table-selection"),a.placement&&(s=a.placement),t.popover=i(r,{template:"views/popover/select-decision-table-popover.html",placement:s});var l,d,c,p;a.onDecisionTableSelected&&(l=n(a.onDecisionTableSelected)),a.onDecisionTableCreate&&(c=n(a.onDecisionTableCreate)),a.onCancel&&(d=n(a.onCancel)),a.onClear&&(p=n(a.onClear));var u=t.popover.$scope;u.title=a.popoverTitle,u.popupModel={},u.$watch("popupModel.filter",function(){e.currentKickstartModel.definition&&e.currentKickstartModel.definition.id&&o.filterDecisionTables(u.popupModel.filter).then(function(e){u.popupModel.decisionTableResults=e.data,u.resetSelection()})}),u.resetSelection=function(){u.popupModel.decisionTableResults&&u.popupModel.decisionTableResults.length>0?(u.popupModel.selectedDecisionTable=u.popupModel.decisionTableResults[0],u.popupModel.selectedIndex=0):(u.popupModel.selectedDecisionTable=void 0,u.popupModel.selectedIndex=-1)},u.nextDecisionTable=function(){var e=u.popupModel.decisionTableResults;e&&e.length>0&&u.popupModel.selectedIndex<e.length-1&&(u.popupModel.selectedIndex+=1,u.popupModel.selectedDecisionTable=e[u.popupModel.selectedIndex])},u.previousDecisionTable=function(){var e=u.popupModel.decisionTableResults;e&&e.length>0&&u.popupModel.selectedIndex>0&&(u.popupModel.selectedIndex-=1,u.popupModel.selecteddecisionTable=e[u.popupModel.selectedIndex])},u.createDecisionTable=function(){c&&c(t.$parent),u.$hide()},u.clearDecisionTable=function(){p&&p(t.$parent),u.$hide()},u.confirmDecisionTable=function(e){if(!e){var i=u.popupModel.decisionTableResults;u.popupModel.selectedIndex>=0&&u.popupModel.selectedIndex<i.length&&(e=i[u.popupModel.selectedIndex])}e&&(l&&l(t.$parent,{decisionTable:e}),u.$hide())},u.$on("tooltip.show",function(){e.currentKickstartModel.definition&&e.currentKickstartModel.definition.id&&o.filterDecisionTables(u.popupModel.filter).then(function(e){u.popupModel.decisionTableResults=e.data,u.resetSelection()})}),u.$on("tooltip.hide",function(){u.popupModel.decisionTableResults=[],u.popupModel.filter="",u.popupModel.added?u.popupModel.added=!1:d&&d(t.$parent)})},r}]),angular.module("activitiModeler").directive("emailTemplateSource",["$http","$templateCache","ProcessBuilderService","FormBuilderService","ProcessScopeService",function(){var e={};return e.restrict="A",e.templateUrl="views/includes/select-email-template-source.html",e.replace=!0,e.scope={emailTemplateObject:"=emailTemplateSource",allSteps:"=allSteps",stepId:"=stepId",title:"=title"},e.controller=["$rootScope","$scope","$translate","$element",function(e,t,i){t.sourceOptions=[{id:"default",title:i.instant("PROCESS-BUILDER.EMAIL-TEMPLATE-SOURCE.SRC-DEFAULT")},{id:"template",title:i.instant("PROCESS-BUILDER.EMAIL-TEMPLATE-SOURCE.SRC-TEMPLATE")},{id:"custom",title:i.instant("PROCESS-BUILDER.EMAIL-TEMPLATE-SOURCE.SRC-CUSTOM")}],t.sourceOption=t.sourceOptions[0],t.$watch("sourceOption",function(e){e&&("template"==e.id?(t.emailTemplateObject.type="template",delete t.emailTemplateObject.templateText,delete t.emailTemplateObject.templateSubject):"custom"==e.id?(t.emailTemplateObject.type="custom",delete t.emailTemplateObject.template):(t.emailTemplateObject.type="default",delete t.emailTemplateObject.template,delete t.emailTemplateObject.templateText,delete t.emailTemplateObject.templateSubject))
}),t.setTemplate=function(e){t.emailTemplateObject.template={id:e.id,name:e.name}}}],e.link=function(e){var t;if(e.emailTemplateObject&&e.emailTemplateObject.type)for(var i=0;e.sourceOptions.length>i;i++)if(e.sourceOptions[i].id==e.emailTemplateObject.type){t=e.sourceOptions[i];break}t||(t=e.sourceOptions[0]),e.sourceOption=t},e}]),activitiModule.directive("selectEmailTemplatePopover",["$rootScope","$http","$popover","appResourceRoot","$q","$parse",function(e,t,i,o,n,r){function a(e){return l({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/email-templates/custom",params:{nameFilter:e.filter||"",start:e.page,size:e.pageSize,sort:"sort_by_name_asc"}})}var s={};s.restrict="A",s.scope={};var l=function(e){var i=n.defer();return t(e).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise};return s.link=function(e,t,o){function n(){l.popupModel.loading=!0,a(l.popupModel).then(function(e){l.popupModel.templateResults=e.data,l.popupModel.loading=!1,l.resetSelection(),l.popupModel.templateResults.length>0&&l.nextTemplate(),l.popupModel.moreTemplates=e.total>(l.popupModel.page+1)*l.popupModel.pageSize})}var s="bottom";t.addClass("toggle-email-template-select"),o.placement&&(s=o.placement),e.popover=i(t,{template:"views/popover/select-email-template-popover.html",placement:s});var l=e.popover.$scope;l.popupModel={loading:!1,showing:!1,pageSize:50,page:0};var d;o.onTemplateSelected&&(d=r(o.onTemplateSelected)),l.title=o.popoverTitle,l.popupModel.showing=!1,l.$watch("popupModel.filter",function(e){e?n(e):l.popupModel.showing&&n("")}),l.confirmTemplate=function(t){if(!t){var i=l.popupModel.templateResults;l.popupModel.selectedIndex>=0&&l.popupModel.selectedIndex<i.length&&(t=i[l.popupModel.selectedIndex])}t&&d&&(d(e.$parent,{template:t}),l.$hide())},l.resetSelection=function(){l.popupModel.selectedUser=void 0,l.popupModel.selectedIndex=-1},l.nextTemplate=function(){var e=l.popupModel.templateResults;e&&e.length>0&&l.popupModel.selectedIndex<e.length-1&&(l.popupModel.selectedIndex+=1,l.popupModel.selectedTemplate=e[l.popupModel.selectedIndex])},l.previousTemplate=function(){var e=l.popupModel.templateResults;e&&e.length>0&&l.popupModel.selectedIndex>0&&(l.popupModel.selectedIndex-=1,l.popupModel.selectedTemplate=e[l.popupModel.selectedIndex])},l.previousPage=function(){l.popupModel.page--,n()},l.nextPage=function(){l.popupModel.page++,n()},l.$on("tooltip.show",function(){l.popupModel.showing=!0,l.resetSelection(),l.popupModel.filter=""}),l.$on("tooltip.hide",function(){l.popupModel.showing=!1})},s}]),angular.module("activitiModeler").directive("requiredValueCheck",function(){return{require:"ngModel",link:function(e,t,i,o){o.$validators.requiredValueCheck=function(t){if(!t)return!0;var o=e.$eval(i.requiredValueCheck);return o&&""!==o?!0:!1}}}}),angular.module("activitiModeler").directive("ngBindAttrs",function(){return function(e,t,i){e.$watch(i.ngBindAttrs,function(e){angular.forEach(e,function(e,t){i.$set(t,e)})},!0)}}),angular.module("activitiModeler").controller("ProcessesCtrl",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal",function(e,t,i,o,n,r,a){t.hasAccessKickstartCapability()||t.backToLanding(),e.setMainPageById("processes"),e.formItems=void 0,t.imageVersion=Date.now(),t.model={filters:[{id:"myProcesses",labelKey:"MY-PROCESSES"},{id:"sharedWithMe",labelKey:"SHARED-WITH-ME"},{id:"sharedWithOthers",labelKey:"SHARED-WITH-OTHERS"},{id:"favorite",labelKey:"FAVORITES"}],sorts:[{id:"modifiedDesc",labelKey:"MODIFIED-DESC"},{id:"modifiedAsc",labelKey:"MODIFIED-ASC"},{id:"nameAsc",labelKey:"NAME-ASC"},{id:"nameDesc",labelKey:"NAME-DESC"}]},t.hasAccessAllModelsInTenantCapability()&&t.model.filters.push({id:"everyone",labelKey:"EVERYONE"}),e.modelFilter?(t.model.activeFilter=e.modelFilter.filter,t.model.activeSort=e.modelFilter.sort,t.model.filterText=e.modelFilter.filterText,t.model.pendingFilterText=t.model.filterText):(t.model.activeFilter=t.model.filters[0],t.model.activeSort=t.model.sorts[0],e.modelFilter={filter:t.model.activeFilter,sort:t.model.activeSort,filterText:""}),t.activateFilter=function(i){t.model.activeFilter=i,e.modelFilter.filter=i,t.loadProcesses()},t.activateSort=function(i){t.model.activeSort=i,e.modelFilter.sort=i,t.loadProcesses()},t.loadProcesses=function(){t.model.loading=!0;var e={filter:t.model.activeFilter.id,sort:t.model.activeSort.id};t.model.filterText&&""!=t.model.filterText&&(e.filterText=t.model.filterText),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",params:e}).success(function(e){t.model.processes=e,t.model.loading=!1}).error(function(e){console.log("Something went wrong: "+e),t.model.loading=!1})};var s=function(){t.model.isFilterDelayed=!0,n(function(){t.model.isFilterDelayed=!1,t.model.isFilterUpdated?(t.model.isFilterUpdated=!1,s()):(t.model.filterText=t.model.pendingFilterText,e.modelFilter.filterText=t.model.filterText,t.loadProcesses())},500)};t.filterDelayed=function(){t.model.isFilterDelayed?t.model.isFilterUpdated=!0:s()},t.createProcess=function(e){var i=_internalCreateModal({template:"views/popup/process-create.html?version="+Date.now()},a,t);"step"==e&&(i.$scope.initialModelType=1)},t.importProcess=function(){_internalCreateModal({template:"views/popup/process-import.html?version="+Date.now()},a,t)},t.showProcessDetails=function(e){e&&r.url("/processes/"+encodeURIComponent(e.id))},t.editProcessDetails=function(e){e&&(e.modelType&&1===e.modelType?r.url("/kickstart-editor/"+encodeURIComponent(e.id)):r.url("/editor/"+encodeURIComponent(e.id)))},t.loadProcesses()}]),angular.module("activitiModeler").controller("CreateNewProcessModelCrtl",["$rootScope","$scope","$modal","$http","$location","EventTrackingService",function(e,t,i,o,n,r){t.model={loading:!1,process:{name:"",description:"",modelType:0,stencilSet:0},defaultBpmnStencilSet:void 0,defaultStepStencilSet:void 0,bpmnStencilSets:[],stepStencilSets:[]},void 0!==t.initialModelType&&(t.model.process.modelType=t.initialModelType),"enterprise"===e.account.type&&(t.model.loading=!0,o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/available-stencil-sets"}).success(function(e){t.model.stencilSets=e.data;var i=[],o=[];if(t.model.stencilSets&&t.model.stencilSets.length>0)for(var n=0;t.model.stencilSets.length>n;n++)1==t.model.stencilSets[n].stencilType?(i.push(t.model.stencilSets[n]),t.model.stencilSets[n].defaultStencilSet&&(t.model.defaultBpmnStencilSet=t.model.stencilSets[n],t.model.process.stencilSet=t.model.defaultBpmnStencilSet.id)):2==t.model.stencilSets[n].stencilType&&(o.push(t.model.stencilSets[n]),t.model.stencilSets[n].defaultStencilSet&&(t.model.defaultStepStencilSet=t.model.stencilSets[n],t.model.process.stencilSet=t.model.defaultStepStencilSet.id));t.model.bpmnStencilSets=i,t.model.stepStencilSets=o,t.model.loading=!1}).error(function(){t.model.loading=!1})),t.resetSelectedStencilSet=function(){t.model.process.stencilSet=0==t.model.process.modelType?t.model.defaultBpmnStencilSet?t.defaultBpmnStencilSet.id:0:t.model.defaultStepStencilSet?t.defaultStepStencilSet.id:0},t.ok=function(){t.model.process.name&&0!=t.model.process.name.length&&(t.model.loading=!0,o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",data:t.model.process}).success(function(e){t.$hide(),0==t.model.process.modelType?void 0===t.model.process.stencilSet||null===t.model.process.stencilSet||0===t.model.process.stencilSet?r.trackEvent("editor","process-model-bpmn-created-default-stencil"):r.trackEvent("editor","process-model-bpmn-created-custom-stencil"):void 0===t.model.process.stencilSet||null===t.model.process.stencilSet||0===t.model.process.stencilSet?r.trackEvent("editor","process-model-step-created-default-stencil"):r.trackEvent("editor","process-model-step-created-custom-stencil"),t.model.loading=!1,e.modelType&&1===e.modelType?n.url("/kickstart-editor/"+encodeURIComponent(e.id)):n.url("/editor/"+encodeURIComponent(e.id))}).error(function(){t.model.loading=!1,i.$hide()}))},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("DuplicateProcessModelCrtl",["$rootScope","$scope","$modal","$http","$location","EventTrackingService",function(e,t,i,o,n,r){t.model={loading:!1,process:{name:"",description:"",modelType:0,stencilSet:0},defaultBpmnStencilSet:void 0,defaultStepStencilSet:void 0,bpmnStencilSets:[],stepStencilSets:[]},t.originalModel&&(t.model.bpmnStencilSets=t.originalModel.bpmnStencilSets,t.model.stepStencilSets=t.originalModel.stepStencilSets,t.model.defaultStepStencilSet=t.originalModel.defaultStepStencilSet,t.model.defaultBpmnStencilSet=t.originalModel.defaultBpmnStencilSet,t.model.process.name=t.originalModel.process.name,t.model.process.description=t.originalModel.process.description,t.model.process.modelType=t.originalModel.process.modelType,t.model.process.stencilSet=t.originalModel.process.stencilSet,t.model.process.id=t.originalModel.process.id),t.ok=function(){t.model.process.name&&0!=t.model.process.name.length&&(t.model.loading=!0,o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.process.id+"/clone",data:t.model.process}).success(function(e){t.$hide(),0==t.model.process.modelType?void 0===t.model.process.stencilSet||null===t.model.process.stencilSet||0===t.model.process.stencilSet?r.trackEvent("editor","process-model-bpmn-created-default-stencil"):r.trackEvent("editor","process-model-bpmn-created-custom-stencil"):void 0===t.model.process.stencilSet||null===t.model.process.stencilSet||0===t.model.process.stencilSet?r.trackEvent("editor","process-model-step-created-default-stencil"):r.trackEvent("editor","process-model-step-created-custom-stencil"),t.model.loading=!1,e.modelType&&1===e.modelType?n.url("/kickstart-editor/"+encodeURIComponent(e.id)):n.url("/editor/"+encodeURIComponent(e.id))}).error(function(){t.model.loading=!1,i.$hide()}))},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ImportProcessModelCrtl",["$rootScope","$scope","$http","Upload","$location","EventTrackingService",function(e,t,i,o,n,r){t.model={loading:!1},t.onFileSelect=function(e,i){for(var a=0;e.length>a;a++){var s,l=e[a];s=i?ACTIVITI.CONFIG.contextRoot+"/app/rest/import-process-model/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/import-process-model",o.upload({url:s,method:"POST",file:l}).progress(function(e){t.model.loading=!0,t.model.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(e){t.model.loading=!1,r.trackEvent("editor","process-model-bpmn-import"),n.path("/editor/"+e.id),t.$hide()}).error(function(e,i,o,n){e&&e.message&&(t.model.errorMessage=e.message,t.model.fileName=n.file.name),t.model.error=!0,t.model.loading=!1})}},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ProcessCtrl",["$rootScope","$scope","$translate","$http","$location","$routeParams","$modal","$popover","$timeout","appResourceRoot","ResourceService",function(e,t,i,o,n,r,a,s,l,d,c){e.setMainPageById("processes"),t.model={latestModelId:r.modelId},t.loadProcess=function(){var n;n=r.modelHistoryId?ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+r.modelId+"/history/"+r.modelHistoryId:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+r.modelId,o({method:"GET",url:n}).success(function(o){t.model.process=o,t.loadComments(),t.loadVersions(),t.loadStencilInfo(),t.model.bpmn20DownloadUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+r.modelId+(void 0==r.modelHistoryId?"":"/history/"+r.modelHistoryId)+"/bpmn20?version="+Date.now(),t.model.process.modelType&&0!=t.model.process.modelType?1==t.model.process.modelType?t.model.kickstartMode="read":(i("MODEL.MESSAGE.INVALID-TYPE",{expected:"process"}).then(function(t){e.addAlertPromise(i("MODEL.MESSAGE.ERROR",{details:t}),"error")}),t.returnToList()):(e.$on("$routeChangeStart",function(){jQuery(".qtip").qtip("destroy",!0)}),l(function(){jQuery("#bpmnModel").attr("data-model-id",r.modelId),jQuery("#bpmnModel").attr("data-model-type","design"),t.model.process.latestVersion||jQuery("#bpmnModel").attr("data-history-id",r.modelHistoryId);var e=d+"../display/displaymodel.html?version="+Date.now(),i=window.define;window.define=void 0,c.loadFromHtml(e,function(){window.define=i})}))}).error(function(){e.addAlertPromise(i("PROCESS-MODEL.MESSAGE.NOT-FOUND"),"error"),t.returnToList()})},t.useAsNewVersion=function(){_internalCreateModal({template:"views/popup/model-use-as-new-version.html",scope:t},a,t)},t.toggleFavorite=function(){t.model.favoritePending=!0;var e={favorite:!t.model.process.favorite};o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId,data:e}).success(function(){t.model.favoritePending=!1,t.model.process.favorite?t.addAlertPromise(i("PROCESS.ALERT.UN-FAVORITE-CONFIRM"),"info"):t.addAlertPromise(i("PROCESS.ALERT.FAVORITE-CONFIRM"),"info"),t.model.process.favorite=!t.model.process.favorite}).error(function(){t.model.favoritePending=!1})},t.loadVersions=function(){var e={includeLatestVersion:!t.model.process.latestVersion};o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId+"/history",params:e}).success(function(e){t.model.process.latestVersion&&(e.data||(e.data=[]),e.data.unshift(t.model.process)),t.model.versions=e})},t.showVersion=function(e){e&&(e.latestVersion?n.path("/processes/"+t.model.latestModelId):n.path("/processes/"+t.model.latestModelId+"/history/"+e.id))},t.loadStencilInfo=function(){t.model.process.stencilSet&&t.model.process.stencilSet>0&&o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+t.model.process.stencilSet+"/basic"}).success(function(e){t.model.stencil=e})},t.goToStencil=function(){t.model.stencil&&n.path("/stencils/"+t.model.stencil.id)},t.returnToList=function(){n.path("/processes/")},t.editProcess=function(){_internalCreateModal({template:"views/popup/model-edit.html",scope:t},a,t)},t.duplicateProcess=function(){var e=_internalCreateModal({template:"views/popup/process-duplicate.html?version="+Date.now()},a,t);e.$scope.originalModel=t.model},t.deleteProcess=function(){_internalCreateModal({template:"views/popup/model-delete.html",scope:t},a,t)},t.shareProcess=function(){_internalCreateModal({template:"views/popup/model-share.html",scope:t},a,t)},t.openEditor=function(){t.model.process&&(t.model.process.modelType&&1===t.model.process.modelType?n.path("/kickstart-editor/"+t.model.process.id):n.path("/editor/"+t.model.process.id))},t.loadComments=function(){var e={latestFirst:!0};o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId+"/comments",params:e}).success(function(e){t.model.comments=e})},t.toggleComments=function(e){if(!t.commentsState){var i={};t.commentsState=i,i.popover=s(angular.element(e.target),{template:"views/popover/comments.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.commentsState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.toggleHistory=function(e){if(!t.historyState){var i={};t.historyState=i,i.popover=s(angular.element(e.target),{template:"views/popover/history.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.historyState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.loadProcess()}]),angular.module("activitiModeler").controller("FormsCtrl",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal",function(e,t,i,o,n,r,a){t.hasAccessKickstartCapability()||t.backToLanding(),e.formItems=void 0,t.imageVersion=Date.now(),t.model={filters:[{id:"myReusableForms",labelKey:"MY-REUSABLE-FORMS"},{id:"sharedWithMe",labelKey:"SHARED-WITH-ME"},{id:"sharedWithOthers",labelKey:"SHARED-WITH-OTHERS"},{id:"favorite",labelKey:"FAVORITES"}],sorts:[{id:"modifiedDesc",labelKey:"MODIFIED-DESC"},{id:"modifiedAsc",labelKey:"MODIFIED-ASC"},{id:"nameAsc",labelKey:"NAME-ASC"},{id:"nameDesc",labelKey:"NAME-DESC"}]},t.hasAccessAllModelsInTenantCapability()&&t.model.filters.push({id:"everyone",labelKey:"EVERYONE"}),e.formFilter?(t.model.activeFilter=e.formFilter.filter,t.model.activeSort=e.formFilter.sort,t.model.filterText=e.formFilter.filterText,t.model.pendingFilterText=t.model.filterText):(t.model.activeFilter=t.model.filters[0],t.model.activeSort=t.model.sorts[0],e.formFilter={filter:t.model.activeFilter,sort:t.model.activeSort,filterText:""}),t.activateFilter=function(i){t.model.activeFilter=i,e.formFilter.filter=i,t.loadForms()},t.activateSort=function(i){t.model.activeSort=i,e.formFilter.sort=i,t.loadForms()},t.importForm=function(){_internalCreateModal({template:"views/popup/form-import.html?version="+Date.now()},a,t)},t.loadForms=function(){t.model.loading=!0;var e={filter:t.model.activeFilter.id,sort:t.model.activeSort.id,modelType:2};t.model.filterText&&""!=t.model.filterText&&(e.filterText=t.model.filterText),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",params:e}).success(function(e){t.model.forms=e,t.model.loading=!1}).error(function(){t.model.loading=!1})};var s=function(){t.model.isFilterDelayed=!0,n(function(){t.model.isFilterDelayed=!1,t.model.isFilterUpdated?(t.model.isFilterUpdated=!1,s()):(t.model.filterText=t.model.pendingFilterText,e.formFilter.filterText=t.model.filterText,t.loadForms())},500)};t.filterDelayed=function(){t.model.isFilterDelayed?t.model.isFilterUpdated=!0:s()},t.createForm=function(){e.currentKickstartModel=void 0,t.createFormCallback=function(e){r.url("/form-editor/"+encodeURIComponent(e.id))},_internalCreateModal({template:"views/popup/form-create.html?version="+Date.now(),scope:t},a,t)},t.showFormDetails=function(t){t&&(e.currentKickstartModel=void 0,r.url("/forms/"+encodeURIComponent(t.id)))},t.editFormDetails=function(e){e&&r.url("/form-editor/"+encodeURIComponent(e.id))},t.loadForms()}]),angular.module("activitiModeler").controller("CreateNewFormCtrl",["$rootScope","$scope","$http","EventTrackingService",function(e,t,i,o){t.model={loading:!1,form:{name:"",description:"",modelType:2,stencilSet:0},defaultStencilSet:void 0,formStencilSets:[]},"enterprise"===e.account.type&&(t.model.loading=!0,i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/available-form-stencil-sets"}).success(function(e){if(t.model.formStencilSets=e.data,t.model.stencilSets&&t.model.stencilSets.length>0)for(var i=0;t.model.stencilSets.length>i;i++)if(t.model.stencilSets[i].defaultStencilSet){t.model.defaultStencilSet=t.model.stencilSets[i],t.model.form.stencilSet=t.defaultStencilSet.id;break}t.model.loading=!1}).error(function(){t.model.loading=!1})),e.currentKickstartModel&&e.currentKickstartModel.definition&&e.currentKickstartModel.definition.id&&(t.model.form.referenceId=e.currentKickstartModel.definition.id),t.ok=function(){t.model.form.name&&0!=t.model.form.name.length&&(t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",data:t.model.form}).success(function(e){t.$hide(),t.model.loading=!1,t.model.form&&t.model.form.referenceId?o.trackEvent("editor","form-model-create-via-stepeditor"):o.trackEvent("editor","form-model-create-standalone"),t.createFormCallback&&(t.createFormCallback(e),t.createFormCallback=void 0)}).error(function(){t.model.loading=!1,t.$hide()}))},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("DuplicateFormCtrl",["$rootScope","$scope","$http","EventTrackingService",function(e,t,i,o){t.model={loading:!1,form:{id:"",name:"",description:"",modelType:2}},t.originalModel&&t.originalModel.form&&(t.model.form.name=t.originalModel.form.name,t.model.form.description=t.originalModel.form.description,t.model.form.modelType=t.originalModel.form.modelType,t.model.form.stencilSet=t.originalModel.form.stencilSet,t.model.form.id=t.originalModel.form.id),t.ok=function(){t.model.form.name&&0!=t.model.form.name.length&&(t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.form.id+"/clone",data:t.model.form}).success(function(e){t.$hide(),t.model.loading=!1,t.model.form&&t.model.form.referenceId?o.trackEvent("editor","form-model-create-via-stepeditor"):o.trackEvent("editor","form-model-create-standalone"),t.duplicateFormCallback&&(t.duplicateFormCallback(e),t.duplicateFormCallback=void 0)}).error(function(){t.model.loading=!1,t.$hide()}))},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ImportFormModelCrtl",["$rootScope","$scope","$http","Upload","$location","EventTrackingService",function(e,t,i,o,n,r){t.model={loading:!1},t.onFileSelect=function(e,i){for(var a=0;e.length>a;a++){var s,l=e[a];s=i?ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/import-form-text":ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/import-form",o.upload({url:s,method:"POST",file:l}).progress(function(e){t.model.loading=!0,t.model.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(e){t.model.loading=!1,r.trackEvent("editor","form-model-import"),n.path("/form-editor/"+e.id),t.$hide()}).error(function(e,i,o,n){e&&e.message&&(t.model.errorMessage=e.message,t.model.fileName=n.file.name),t.model.error=!0,t.model.loading=!1})}},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("FormCtrl",["$rootScope","$scope","$translate","$http","$location","$routeParams","$modal","$timeout","$popover",function(e,t,i,o,n,r,a,s,l){t.formMode="read",t.model={latestModelId:r.modelId},t.loadForm=function(){var n,a;r.modelHistoryId?(n=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+r.modelId+"/history/"+r.modelHistoryId,a=ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+r.modelId+"/history/"+r.modelHistoryId):(n=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+r.modelId,a=ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+r.modelId),o({method:"GET",url:n}).success(function(e){t.model.form=e,t.model.formDownloadUrl=a+"/export?version="+Date.now(),t.loadComments(),t.loadVersions()}).error(function(){e.addAlertPromise(i("FORM-MODEL.MESSAGE.NOT-FOUND"),"error"),t.returnToList()})},t.useAsNewVersion=function(){_internalCreateModal({template:"views/popup/model-use-as-new-version.html",scope:t},a,t)},t.toggleFavorite=function(){t.model.favoritePending=!0;var e={favorite:!t.model.form.favorite};o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId,data:e}).success(function(){t.model.favoritePending=!1,t.model.form.favorite?t.addAlertPromise(i("PROCESS.ALERT.UN-FAVORITE-CONFIRM"),"info"):t.addAlertPromise(i("PROCESS.ALERT.FAVORITE-CONFIRM"),"info"),t.model.form.favorite=!t.model.form.favorite}).error(function(){t.model.favoritePending=!1})},t.loadVersions=function(){var e={includeLatestVersion:!t.model.form.latestVersion};o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId+"/history",params:e}).success(function(e){t.model.form.latestVersion&&(e.data||(e.data=[]),e.data.unshift(t.model.form)),t.model.versions=e})},t.showVersion=function(e){e&&(e.latestVersion?n.path("/forms/"+t.model.latestModelId):n.path("/forms/"+t.model.latestModelId+"/history/"+e.id))},t.returnToList=function(){n.path("/forms/")},t.editForm=function(){_internalCreateModal({template:"views/popup/model-edit.html",scope:t},a,t)},t.duplicateForm=function(){var e=_internalCreateModal({template:"views/popup/form-duplicate.html?version="+Date.now()},a,t);e.$scope.originalModel=t.model,e.$scope.duplicateFormCallback=function(e){n.url("/form-editor/"+encodeURIComponent(e.id))}},t.deleteForm=function(){_internalCreateModal({template:"views/popup/model-delete.html",scope:t},a,t)},t.shareForm=function(){_internalCreateModal({template:"views/popup/model-share.html",scope:t},a,t)},t.openEditor=function(){t.model.form&&n.path("/form-editor/"+t.model.form.id)},t.loadComments=function(){var e={latestFirst:!0};o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId+"/comments",params:e}).success(function(e){t.model.comments=e})},t.toggleComments=function(e){if(!t.commentsState){var i={};t.commentsState=i,i.popover=l(angular.element(e.target),{template:"views/popover/comments.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.commentsState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.toggleHistory=function(e){if(!t.historyState){var i={};t.historyState=i,i.popover=l(angular.element(e.target),{template:"views/popover/history.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.historyState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.loadForm()}]),angular.module("activitiModeler").controller("AppDefinitionsCtrl",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal",function(e,t,i,o,n,r,a){t.hasAccessKickstartCapability()||t.backToLanding(),t.model={filters:[{id:"myApps",labelKey:"MY-APPS"},{id:"sharedWithMe",labelKey:"SHARED-WITH-ME"},{id:"sharedWithOthers",labelKey:"SHARED-WITH-OTHERS"},{id:"favorite",labelKey:"FAVORITES"}],sorts:[{id:"modifiedDesc",labelKey:"MODIFIED-DESC"},{id:"modifiedAsc",labelKey:"MODIFIED-ASC"},{id:"nameAsc",labelKey:"NAME-ASC"},{id:"nameDesc",labelKey:"NAME-DESC"}]},t.hasAccessAllModelsInTenantCapability()&&t.model.filters.push({id:"everyone",labelKey:"EVERYONE"}),e.appFilter?(t.model.activeFilter=e.appFilter.filter,t.model.activeSort=e.appFilter.sort,t.model.filterText=e.appFilter.filterText,t.model.pendingFilterText=t.model.filterText):(t.model.activeFilter=t.model.filters[0],t.model.activeSort=t.model.sorts[0],e.appFilter={filter:t.model.activeFilter,sort:t.model.activeSort,filterText:""}),t.activateFilter=function(i){t.model.activeFilter=i,e.appFilter.filter=i,t.loadApps()},t.activateSort=function(i){t.model.activeSort=i,e.appFilter.sort=i,t.loadApps()},t.loadApps=function(){t.model.loading=!0;var e={filter:t.model.activeFilter.id,sort:t.model.activeSort.id,modelType:3};t.model.filterText&&""!=t.model.filterText&&(e.filterText=t.model.filterText),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",params:e}).success(function(e){t.model.apps=e,t.model.loading=!1}).error(function(){t.model.loading=!1})};var s=function(){t.model.isFilterDelayed=!0,n(function(){t.model.isFilterDelayed=!1,t.model.isFilterUpdated?(t.model.isFilterUpdated=!1,s()):(t.model.filterText=t.model.pendingFilterText,e.appFilter.filterText=t.model.filterText,t.loadApps())},500)};t.filterDelayed=function(){t.model.isFilterDelayed?t.model.isFilterUpdated=!0:s()},t.createApp=function(){_internalCreateModal({template:"views/popup/app-definition-create.html?version="+Date.now(),scope:t},a,t)},t.showAppDetails=function(e){e&&r.path("/apps/"+e.id)},t.editAppDetails=function(e){e&&r.path("/app-editor/"+e.id)},t.importAppDefinition=function(){_internalCreateModal({template:"views/popup/app-definitions-import.html?version="+Date.now()},a,t)},t.loadApps()}]),angular.module("activitiModeler").controller("CreateNewAppCrtl",["$rootScope","$scope","$http","$location","EventTrackingService","$translate",function(e,t,i,o,n,r){t.model={loading:!1,app:{name:"",description:"",modelType:3}},t.ok=function(){t.model.app.name&&0!=t.model.app.name.length&&(t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",data:t.model.app}).success(function(e){t.$hide(),n.trackEvent("editor","app-model-created"),t.model.loading=!1,o.path("/app-editor/"+e.id)}).error(function(e){t.model.loading=!1,e&&e.messageKey&&r(e.messageKey,e.customData).then(function(e){t.errorMessage=e})}))},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("DuplicateAppCrtl",["$rootScope","$scope","$http","$location","EventTrackingService","$translate",function(e,t,i,o,n,r){t.model={loading:!1,app:{id:"",name:"",description:"",modelType:3}},t.originalModel&&(t.model.app.name=t.originalModel.app.name,t.model.app.description=t.originalModel.app.description,t.model.app.modelType=t.originalModel.app.modelType,t.model.app.id=t.originalModel.app.id),t.ok=function(){t.model.app.name&&0!=t.model.app.name.length&&(t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.app.id+"/clone",data:t.model.app}).success(function(e){t.$hide(),n.trackEvent("editor","app-model-created"),t.model.loading=!1,o.path("/app-editor/"+e.id)}).error(function(e){t.model.loading=!1,e&&e.messageKey&&r(e.messageKey,e.customData).then(function(e){t.errorMessage=e})}))},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ImportAppDefinitionCtrl",["$rootScope","$scope","$http","Upload","$location","EventTrackingService",function(e,t,i,o,n,r){t.model={loading:!1,renewIdmIds:!1},t.onFileSelect=function(e,i){for(var a=0;e.length>a;a++){var s,l=e[a];s=i?ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/text/import?renewIdmEntries="+t.model.renewIdmIds:ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/import?renewIdmEntries="+t.model.renewIdmIds,o.upload({url:s,method:"POST",file:l}).progress(function(e){t.model.loading=!0,t.model.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(e){t.model.loading=!1,r.trackEvent("editor","app-definition-import"),n.path("/apps/"+e.id),t.$hide()}).error(function(e,i,o,n){e&&e.message&&(t.model.errorMessage=e.message,t.model.filename=n.file.name),t.model.error=!0,t.model.loading=!1})}},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("AppDefinitionCtrl",["$rootScope","$scope","$translate","$http","$location","$routeParams","$modal","$popover","$timeout",function(e,t,i,o,n,r,a,s){t.model={latestModelId:r.modelId},t.loadApp=function(){var n,a;r.modelHistoryId?(n=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+r.modelId+"/history/"+r.modelHistoryId,a=ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/"+r.modelId+"/history/"+r.modelHistoryId):(n=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+r.modelId,a=ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/"+r.modelId,t.model.appExportUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/"+r.modelId+"/export?version="+Date.now()),o({method:"GET",url:n}).success(function(e){t.model.app=e,t.loadComments(),t.loadVersions()}).error(function(){e.addAlertPromise(i("APP-DEFINITION.MESSAGE.NOT-FOUND"),"error"),t.returnToList()}),o({method:"GET",url:a}).success(function(e){t.model.appDefinition=e})},t.validateAppDefinition=function(e){o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/"+encodeURIComponent(e)+"/validate"}).success(function(e){t.appValidationErrors=e;for(var i=!1,o=0;t.appValidationErrors.length>o;o++)if("subprocess-recursion"==t.appValidationErrors[o].problem){i=!0;break}t.appValidationRecursion=i})},t.useAsNewVersion=function(){_internalCreateModal({template:"views/popup/model-use-as-new-version.html",scope:t},a,t)},t.toggleFavorite=function(){t.model.favoritePending=!0;var e={favorite:!t.model.app.favorite};o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId,data:e}).success(function(){t.model.favoritePending=!1,t.model.app.favorite?t.addAlertPromise(i("APP.ALERT.UN-FAVORITE-CONFIRM"),"info"):t.addAlertPromise(i("APP.ALERT.FAVORITE-CONFIRM"),"info"),t.model.app.favorite=!t.model.app.favorite}).error(function(){t.model.favoritePending=!1})},t.loadVersions=function(){var e={includeLatestVersion:!t.model.app.latestVersion};o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId+"/history",params:e}).success(function(e){t.model.app.latestVersion&&(e.data||(e.data=[]),e.data.unshift(t.model.app)),t.model.versions=e})},t.showVersion=function(e){e&&(e.latestVersion?n.path("/apps/"+t.model.latestModelId):n.path("/apps/"+t.model.latestModelId+"/history/"+e.id))},t.returnToList=function(){n.path("/apps/")},t.openEditor=function(){n.path("/app-editor/"+t.model.latestModelId)
},t.editApp=function(){_internalCreateModal({template:"views/popup/model-edit.html",scope:t},a,t)},t.duplicateApp=function(){var e=_internalCreateModal({template:"views/popup/app-definition-duplicate.html?version="+Date.now()},a,t);e.$scope.originalModel=t.model},t.deleteApp=function(){o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/runtime/app-definitions/model/"+t.model.latestModelId}).success(function(e){e&&e.id?_internalCreateModal({template:"views/popup/app-definition-delete.html?version="+Date.now(),scope:t},a,t):_internalCreateModal({template:"views/popup/model-delete.html?version="+Date.now(),scope:t},a,t)})},t.publish=function(){_internalCreateModal({template:"views/popup/app-definition-publish.html?version="+Date.now(),scope:t},a,t)},t.shareApp=function(){_internalCreateModal({template:"views/popup/model-share.html?version="+Date.now(),scope:t},a,t)},t.importAppDefinition=function(){_internalCreateModal({template:"views/popup/app-definition-import.html?version="+Date.now(),scope:t},a,t)},t.loadComments=function(){var e={latestFirst:!0};o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId+"/comments",params:e}).success(function(e){t.model.comments=e})},t.toggleComments=function(e){if(!t.commentsState){var i={};t.commentsState=i,i.popover=s(angular.element(e.target),{template:"views/popover/comments.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.commentsState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.toggleHistory=function(e){if(!t.historyState){var i={};t.historyState=i,i.popover=s(angular.element(e.target),{template:"views/popover/history.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.historyState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.loadApp(),t.validateAppDefinition(r.modelId)}]),angular.module("activitiModeler").controller("PublishAppDefinitionPopupCtrl",["$rootScope","$scope","$http","$route","$translate","EventTrackingService",function(e,t,i,o,n,r){t.popup={loading:!1,comment:""},t.ok=function(e){t.popup.loading=!0;var a={comment:t.popup.comment};void 0!==e&&null!==e&&e===!0&&(a.force=!0),delete t.popup.error,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/"+t.model.app.id+"/publish",data:a}).success(function(e){if(t.$hide(),1==e.errorType){var i={modelName:e.errorDescription};t.addAlertPromise(n("APP.POPUP.HAS-CUSTOM-STENCILITEM",i),"error")}else if(2==e.errorType){var i={modelName:e.errorDescription};t.addAlertPromise(n("APP.POPUP.HAS-VALIDATIONERROR",i),"error")}else r.trackEvent("editor","app-model-publish"),t.popup.loading=!1,o.reload(),t.addAlertPromise(n("APP.ALERT.PUBLISH-CONFIRM"),"info")}).error(function(e,i){t.popup.loading=!1,409===i&&e&&"app.publish.procdef.key.conflict"===e.messageKey?t.popup.error={type:"conflictingProcDefKey",data:e.customData}:409===i&&e&&"app.publish.dectable.key.conflict"===e.messageKey?t.popup.error={type:"conflictingDecTableKey",data:e.customData}:409===i&&e&&"app.publish.procdef.duplicate.keys"===e.messageKey?t.popup.error={type:"duplicateProcDefKeys",data:e.customData}:409===i&&e&&"app.publish.dectable.duplicate.keys"===e.messageKey?t.popup.error={type:"duplicateDecTableKeys",data:e.customData}:409===i&&e&&"app.publish.process.model.already.used"===e.messageKey?t.popup.error={type:"processModelAlreadyUsed",data:e.customData}:(t.$hide(),t.addAlertPromise(n("APP.ALERT.PUBLISH-ERROR"),"error"))})},t.cancel=function(){t.popup.loading||t.$hide()}}]),angular.module("activitiModeler").controller("DeleteAppDefinitionPopupCrtl",["$rootScope","$scope","$http","$translate",function(e,t,i,o){t.popup={loading:!1,cascade:"false"},t.ok=function(){t.popup.loading=!0;var e={cascade:"true"===t.popup.cascade,deleteRuntimeApp:!0};i({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.app.id,params:e}).success(function(){t.$hide(),t.popup.loading=!1,t.addAlertPromise(o("APP.ALERT.DELETE-CONFIRM"),"info"),t.returnToList()}).error(function(){t.$hide(),t.popup.loading=!1})},t.cancel=function(){t.popup.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ImportNewVersionAppDefinitionCtrl",["$rootScope","$scope","$http","Upload","$route","EventTrackingService",function(e,t,i,o,n,r){t.popup={loading:!1,renewIdmIds:!1},t.onFileSelect=function(e,i){for(var a=0;e.length>a;a++){var s,l=e[a];s=i?ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/"+t.model.app.id+"/text/import?renewIdmEntries="+t.popup.renewIdmIds:ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/"+t.model.app.id+"/import?renewIdmEntries="+t.popup.renewIdmIds,o.upload({url:s,method:"POST",file:l}).progress(function(e){t.popup.loading=!0,t.popup.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(){t.popup.loading=!1,r.trackEvent("editor","app-definition-import"),n.reload(),t.$hide()}).error(function(e){e&&e.message&&(t.popup.errorMessage=e.message),t.popup.error=!0,t.popup.loading=!1})}},t.cancel=function(){t.popup.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ModelAddCommentPopupCrtl",["$rootScope","$scope","$http","$timeout","$translate","EventTrackingService",function(e,t,i,o,n,r){t.popup={loading:!1},t.popup.model=t.model.process?t.model.process:t.model.form?t.model.form:t.model.decisionTable?t.model.decisionTable:t.model.dataModel?t.model.dataModel:t.model.app,t.ok=function(){t.popup.loading=!0;var e={message:t.popup.message};i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.popup.model.id+"/comments",data:e}).success(function(){t.addAlertPromise(n("PROCESS.ALERT.COMMENT-ADDED-CONFIRM"),"info"),t.loadComments(),t.model.process?r.trackEvent("editor","process-model-add-comment"):t.model.form?r.trackEvent("editor","form-model-add-comment"):t.model.decisionTable?r.trackEvent("editor","decision-table-model-add-comment"):r.trackEvent("editor","app-model-add-comment"),t.popup.loading=!1,t.popup.message=void 0}).error(function(){t.popup.loading=!1})}}]),angular.module("activitiModeler").controller("EditModelPopupCrtl",["$rootScope","$scope","$http","$translate","$location",function(e,t,i,o,n){var r,a;t.model.process?(r=t.model.process,a="PROCESS"):t.model.form?(r=t.model.form,a="FORM"):t.model.decisionTable?(r=t.model.decisionTable,a="DECISION-TABLE"):t.model.dataModel?(r=t.model.dataModel,a="DATA-MODEL"):(r=t.model.app,a="APP"),t.popup={loading:!1,popupType:a,modelName:r.name,modelDescription:r.description,id:r.id},t.ok=function(){if(t.popup.modelName&&0!=t.popup.modelName.length){t.model.name=t.popup.modelName,t.model.description=t.popup.modelDescription,t.popup.loading=!0;var e={name:t.model.name,description:t.model.description};i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.popup.id,data:e}).success(function(e){t.model.process?t.model.process=e:t.model.decisionTable?t.model.decisionTable=e:t.model.form?t.model.form=e:t.model.dataModel?t.model.dataModel=e:t.model.app=e,t.addAlertPromise(o("PROCESS.ALERT.EDIT-CONFIRM"),"info"),t.$hide(),t.popup.loading=!1,"FORM"===a?n.path("/forms/"+t.popup.id):"APP"===a?n.path("/apps/"+t.popup.id):"DECISION-TABLE"===a?n.path("/decision-tables/"+t.popup.id):"DATA-MODEL"===a?n.path("/data-models/"+t.popup.id):n.path("/processes/"+t.popup.id)}).error(function(){t.$hide(),t.popup.loading=!1})}},t.cancel=function(){t.popup.loading||t.$hide()}}]),angular.module("activitiModeler").controller("DeleteModelPopupCrtl",["$rootScope","$scope","$http","$translate",function(e,t,i,o){var n,r;t.model.process?(n=t.model.process,r="PROCESS"):t.model.form?(n=t.model.form,r="FORM"):t.model.decisionTable?(n=t.model.decisionTable,r="DECISION-TABLE"):t.model.dataModel?(n=t.model.dataModel,r="DATA-MODEL"):(n=t.model.app,r="APP"),t.popup={loading:!0,loadingRelations:!0,cascade:"false",popupType:r,model:n},i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.popup.model.id+"/parent-relations"}).success(function(e){t.popup.loading=!1,t.popup.loadingRelations=!1,t.popup.relations=e}).error(function(){t.$hide(),t.popup.loading=!1}),t.ok=function(){t.popup.loading=!0;var e={cascade:"true"===t.popup.cascade};i({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.popup.model.id,params:e}).success(function(){t.$hide(),t.popup.loading=!1,t.addAlertPromise(o(r+".ALERT.DELETE-CONFIRM"),"info"),t.returnToList()}).error(function(){t.$hide(),t.popup.loading=!1})},t.cancel=function(){t.popup.loading||t.$hide()}}]),angular.module("activitiModeler").controller("UseAsNewVersionPopupCrtl",["$rootScope","$scope","$http","$translate","$location",function(e,t,i,o,n){var r,a;t.model.process?(r=t.model.process,a="PROCESS"):t.model.form?(r=t.model.form,a="FORM"):t.model.decisionTable?(r=t.model.decisionTable,a="DECISION-TABLE"):t.model.dataModel?(r=t.model.dataModel,a="DATA-MODEL"):(r=t.model.app,a="APP"),t.popup={loading:!1,model:r,popupType:a,latestModelId:t.model.latestModelId,comment:""},t.ok=function(){t.popup.loading=!0;var e={action:"useAsNewVersion",comment:t.popup.comment};i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.popup.latestModelId+"/history/"+t.popup.model.id,data:e}).success(function(e){var i=function(){"FORM"===a?n.path("/forms/"+t.popup.latestModelId):"APP"===a?n.path("/apps/"+t.popup.latestModelId):"DECISION-TABLE"===a?n.path("/decision-tables/"+t.popup.latestModelId):"DATA-MODEL"===a?n.path("/data-models/"+t.popup.latestModelId):n.path("/processes/"+t.popup.latestModelId)};e&&e.unresolvedModels&&e.unresolvedModels.length>0?(t.popup.loading=!1,t.popup.foundUnresolvedModels=!0,t.popup.unresolvedModels=e.unresolvedModels,t.close=function(){t.$hide(),i()}):(t.popup.loading=!1,t.$hide(),t.addAlertPromise(o(a+".ALERT.NEW-VERSION-CONFIRM"),"info"),i())}).error(function(){t.$hide(),t.popup.loading=!1})},t.cancel=function(){t.popup.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ShareModelPopupCrtl",["$rootScope","$scope","$http","$timeout","$translate","UserService","EventTrackingService",function(e,t,i,o,n,r,a){var s,l;t.model.process?(s=t.model.process,l="PROCESS"):t.model.form?(s=t.model.form,l="FORM"):t.model.decisionTable?(s=t.model.decisionTable,l="DECISION-TABLE"):t.model.dataModel?(s=t.model.dataModel,l="DATA-MODEL"):t.model.stencil?(s=t.model.stencil,l="STENCIL"):(s=t.model.app,l="APP"),t.popup={loading:!1,popupType:l,model:s,comment:"",updated:{},removed:{},added:{},groupsAdded:{},recentUsers:[]};var d;d="STENCIL"===l?ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+t.popup.model.id+"/share-info":ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.popup.model.id+"/share-info",i({method:"GET",url:d}).success(function(e){if(t.popup.shareInfo=e,t.currentlySharedUserIds=[],t.currentlySharedGroupIds=[],e&&e.data&&e.data.length>0)for(var i=0;e.data.length>i;i++)null!==e.data[i].person&&void 0!==e.data[i].person?t.currentlySharedUserIds.push(e.data[i].person.id):null!==e.data[i].group&&void 0!==e.data[i].group&&t.currentlySharedGroupIds.push(e.data[i].group.id)}).error(function(){t.$hide(),t.popup.loading=!1}),t.setPermission=function(e,i){if(i)e.permission=i,e.id&&(t.popup.updated[e.id]=i);else{var o=t.popup.shareInfo.data;if(e.id?(t.popup.removed[e.id]=!0,t.popup.updated[e.id]&&delete t.popup.updated[e.id]):e.person?e.person.id?delete t.popup.added[e.person.id]:e.person.email&&delete t.popup.added[e.person.email]:e.group&&e.group.id&&delete t.popup.groupsAdded[e.group.id],e.person){var n=t.currentlySharedUserIds.indexOf(e.person.id);n>=0&&t.currentlySharedUserIds.splice(n,1)}else if(e.group){var r=t.currentlySharedGroupIds.indexOf(e.group.id);r>=0&&t.currentlySharedGroupIds.splice(r,1)}for(var a=0;o.length>a;a++)if(o[a]==e){o.splice(a,1);break}}},t.addEmailUser=function(e){var i={person:{email:e},permission:"read"};if(t.popup.shareInfo.data){for(var o=0;t.popup.shareInfo.data.length>o;o++)if(t.popup.shareInfo.data[o].email==e)return;t.popup.shareInfo.data.push(i),t.popup.added[e]=i}else t.popup.shareInfo.data=[i],t.popup.added[e]=i;t.popup.newPerson=void 0},t.addRealUser=function(e){var i={person:e,permission:"read"};if(t.popup.shareInfo.data){for(var o=0;t.popup.shareInfo.data.length>o;o++)if(t.popup.shareInfo.data[o].person&&t.popup.shareInfo.data[o].person.id==e.id)return;t.popup.shareInfo.data.splice(0,0,i),t.popup.added[e.id]=i}else t.popup.shareInfo.data=[i],t.popup.added[e.id]=i;t.currentlySharedUserIds.push(e.id),t.popup.newPerson=void 0},t.addGroup=function(e){var i={group:e,permission:"read"};if(t.popup.shareInfo.data){for(var o=0;t.popup.shareInfo.data.length>o;o++)if(t.popup.shareInfo.data[o].group&&t.popup.shareInfo.data[o].group.id==e.id)return;t.popup.shareInfo.data.splice(0,0,i),t.popup.groupsAdded[e.id]=i}else t.popup.shareInfo.data=[i],t.popup.groupsAdded[e.id]=i;t.currentlySharedGroupIds.push(e.id)},t.ok=function(){t.popup.loading=!0;var e={added:[],updated:[],removed:[]};for(var o in t.popup.added)if(t.popup.added[o].person){var r=t.popup.added[o].person;e.added.push({userId:r.id,email:r.email,permission:t.popup.added[o].permission})}for(var o in t.popup.groupsAdded)if(t.popup.groupsAdded[o].group){var s=t.popup.groupsAdded[o].group;e.added.push({groupId:s.id,permission:t.popup.groupsAdded[o].permission})}for(var o in t.popup.removed)e.removed.push(o);for(var o in t.popup.updated)e.updated.push({id:o,permission:t.popup.updated[o]});delete Array.prototype.toJSON;var d;d="STENCIL"===l?ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+t.popup.model.id+"/share-info":ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.popup.model.id+"/share-info",i({method:"PUT",url:d,data:e}).success(function(){t.$hide(),t.model.process?a.trackEvent("editor","process-model-shared"):t.model.form?a.trackEvent("editor","form-model-shared"):t.model.decisionTable?a.trackEvent("editor","decision-table-model-shared"):t.model.stencil?a.trackEvent("editor","stencil-model-shared"):a.trackEvent("editor","app-model-shared"),t.popup.loading=!1,t.addAlertPromise(n(l+".ALERT.SHARE-CONFIRM"),"info")}).error(function(){t.$hide(),t.popup.loading=!1})},t.cancel=function(){t.popup.loading||t.$hide()}}]),angular.module("activitiModeler").controller("FormVariableMappingController",["$scope","$q","$translate","$timeout","ProcessScopeService","ProcessBuilderService",function(e,t,i,o,n,r){e.loadingForms=!0;var a=n.refresh();a.then(function(){e.loadingForms=!1}),e.isStartStep=function(){return e.model.processStart&&e.model.processStart.expanded},e.isStartStep()?(e.step={},e.model.hasVariableMapping=e.currentKickstartModel.definition.definition.variablesmapping&&e.currentKickstartModel.definition.definition.variablesmapping.size()>0?!0:!1,e.allSteps=void 0,e.step.variablesmapping=e.currentKickstartModel.definition.definition.variablesmapping?e.currentKickstartModel.definition.definition.variablesmapping:[],e.model.currentContextVariablesmapping=[],e.step.variablesmapping&&angular.copy(e.step.variablesmapping,e.model.currentContextVariablesmapping),e.currentFormVariables=e.startFormFields):(e.model.hasVariableMapping=e.step.variablesmapping&&e.step.variablesmapping.size()>0?!0:!1,e.allSteps=r.getAllPreviousStepsArray(e.currentKickstartModel.definition.definition.steps,e.step.id),e.step.variablesmapping=e.step.variablesmapping?e.step.variablesmapping:[],e.model.currentContextVariablesmapping=[],e.step.variablesmapping&&angular.copy(e.step.variablesmapping,e.model.currentContextVariablesmapping),e.currentFormVariables=e.model.fieldsForCurrentForm),e.model.currentContextVariablesmapping.forEach(function(e){e.inProcessVariable={id:e.inProcessVariable,name:e.inProcessVariable},e.outProcessVariable={id:e.outProcessVariable,name:e.outProcessVariable},e.mappedVariable={id:e.mappedVariable,name:e.mappedVariable}}),e.configGrid=function(){e.gridOptions={data:e.model.currentContextVariablesmapping,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"inProcessVariable",visible:!e.isStartStep(),displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.INPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnInProcessVariable(row.entity)}}</div>'},{field:"inVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.inVariableType}}</div>'},{field:"mappedVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.FORMVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnForm(row.entity)}}</div>'},{field:"outProcessVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.OUTPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnOutputProcessVariable(row.entity)}}</div>'},{field:"outVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.outVariableType}}</div>'},{field:"typeOfMapping",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.typeOfMapping}}</div>'}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.currentVariableMapping=t.isSelected?t.entity:void 0})}},e.configGrid(),e._getVariableColumnForm=function(t){return e.autoSave(),t.mappedVariable&&t.mappedVariable.hasOwnProperty("id")?t.mappedVariable.id:t.mappedVariable},e._getVariableColumnInProcessVariable=function(t){return e.autoSave(),t.inProcessVariable&&t.inProcessVariable.hasOwnProperty("id")?t.inProcessVariable.id:t.inProcessVariable},e._getVariableColumnOutputProcessVariable=function(t){return e.autoSave(),t.outProcessVariable&&t.outProcessVariable.hasOwnProperty("id")?t.outProcessVariable.id:t.outProcessVariable},e.addField=function(){var t={mappedVariable:void 0,inProcessVariable:void 0,outProcessVariable:void 0,inVariableType:"formField",outVariableType:"staticValue",typeOfMapping:e.isStartStep()?"outputMap":"inputOutputMap"};e.model.currentContextVariablesmapping.push(t),e.gridApi.selection.clearSelectedRows(),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.isDataGridEmpty=function(){return 0===e.model.currentContextVariablesmapping.length},e.removeField=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.model.currentContextVariablesmapping.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.model.currentContextVariablesmapping.splice(i,1),0===e.model.currentContextVariablesmapping.length&&(e.model.currentContextVariablesmapping.selectedField=void 0),o(function(){if(e.model.currentContextVariablesmapping.length>0){var t=i-1>=0?i-1:0;e.gridApi.selection.toggleRowSelection(e.model.currentContextVariablesmapping[t])}else e.currentVariableMapping&&(e.currentVariableMapping.mappedVariable=void 0,e.currentVariableMapping.inProcessVariable=void 0,e.currentVariableMapping.outProcessVariable=void 0)})}e.save()},e.setInputVariableType=function(t){e.currentVariableMapping.inVariableType=t,e.currentVariableMapping.inProcessVariable=void 0},e.setOutputVariableType=function(t){e.currentVariableMapping.outVariableType=t,e.currentVariableMapping.outProcessVariable=void 0},e.setTypeOfMapping=function(t){var i=e.gridApi.selection.getSelectedRows()[0];i.mappedVariable=void 0,i.inProcessVariable=void 0,i.outProcessVariable=void 0,i.inVariableType="formField",i.outVariableType="staticValue",e.currentVariableMapping.typeOfMapping=t},e.autoSave=function(){e.validInsert()&&e.save()},e.save=function(){e.step.variablesmapping=[],e.model.currentContextVariablesmapping.forEach(function(t){e.step.variablesmapping.push({mappedVariable:t.mappedVariable&&t.mappedVariable.id?t.mappedVariable.id:"",inProcessVariable:t.inProcessVariable&&t.inProcessVariable.id?t.inProcessVariable.id:"",outProcessVariable:t.outProcessVariable&&t.outProcessVariable.id?t.outProcessVariable.id:"",typeOfMapping:t.typeOfMapping,inVariableType:t.inVariableType,outVariableType:t.outVariableType})}),e.isStartStep()&&(e.currentKickstartModel.definition.definition.variablesmapping=e.step.variablesmapping)},e.showVariableMapping=function(){return e.model.currentContextVariablesmapping&&e.model.hasVariableMapping},e.toggleVariableMapping=function(){e.model.hasVariableMapping=!e.step.hasVariableMapping,e.step.hasVariableMapping?e.model.currentContextVariablesmapping=e.model.tempStoreVariablesMapping:(e.model.tempStoreVariablesMapping=e.model.currentContextVariablesmapping,e.model.currentContextVariablesmapping=[])},e.validInsert=function(){var t=!1;return e.currentVariableMapping&&e.model.currentContextVariablesmapping.length>0&&("inputOutputMap"===e.currentVariableMapping.typeOfMapping?t=e.currentVariableMapping.mappedVariable&&e.currentVariableMapping.inProcessVariable&&e.currentVariableMapping.outProcessVariable:"inputMap"===e.currentVariableMapping.typeOfMapping?t=e.currentVariableMapping.mappedVariable&&e.currentVariableMapping.inProcessVariable:"outputMap"===e.currentVariableMapping.typeOfMapping&&(t=e.currentVariableMapping.mappedVariable&&e.currentVariableMapping.outProcessVariable)),t},e.disableRemove=function(){return void 0===e.currentVariableMapping?!0:e.model.currentContextVariablesmapping&&0===e.model.currentContextVariablesmapping.length},e.$watch("step.formDefinition.id",function(t,i){t!==i&&(e.currentFormVariables=e.model.fieldsForCurrentForm,e.model.tempStoreVariablesMapping=[],e.model.currentContextVariablesmapping=[],e.allSteps=r.getAllPreviousStepsArray(e.currentKickstartModel.definition.definition.steps,e.step.id),e.configGrid())})}]),angular.module("activitiModeler").controller("DecisionTableVariableMappingController",["$scope","$q","$translate","$timeout","ProcessScopeService","ProcessBuilderService","DecisionTableService",function(e,t,i,o,n,r,a){function s(){var t=[];return void 0!==e.table.decisionTableDefinition.inputExpressions&&e.table.decisionTableDefinition.inputExpressions.forEach(function(e){var i={id:e.variableId,name:e.variableId,type:e.type};t.push(i)}),t.uniq()}function l(){var t=[];return void 0!==e.table.decisionTableDefinition.outputExpressions&&e.table.decisionTableDefinition.outputExpressions.forEach(function(e){var i={id:e.variableId,name:e.variableId,type:e.type};t.push(i)}),t.uniq()}e.loadingTable=!0,e.isStartStep=function(){return e.model.processStart&&e.model.processStart.expanded},e.isStartStep()?(e.step={},e.allSteps=void 0,e.model.currentContextVariablesMapping=[],e.currentTableVariables=e.startFormFields,e.step.variablesMapping=e.currentKickstartModel.definition.definition.variablesMapping?e.currentKickstartModel.definition.definition.variablesMapping:[]):(e.allSteps=r.getAllPreviousStepsArray(e.currentKickstartModel.definition.definition.steps,e.step.id),e.model.currentContextVariablesMapping=[],e.currentTableVariables=e.model.fieldsForCurrentForm,e.step.variablesMapping=e.step.variablesMapping?e.step.variablesMapping:[]),e.model.hasVariableMapping=e.step.variablesMapping.size()>0,angular.copy(e.step.variablesMapping,e.model.currentContextVariablesMapping),e.model.currentContextVariablesMapping.forEach(function(e){e.inProcessVariable={id:e.inProcessVariable,name:e.inProcessVariable},e.outProcessVariable={id:e.outProcessVariable,name:e.outProcessVariable},e.tableVariable={id:e.mappedVariable,name:e.mappedVariable}});var d=n.refresh();d.then(function(){e.step.decisionTableDefinition.id?a.fetchDecisionTableDetails(e.step.decisionTableDefinition.id).then(function(t){e.table=t,e.inputExpression=s(),e.outputExpression=l(),e.getPreviousAndCurrentTableFields(),e.loadingTable=!1}):e.loadingTable=!1}),e.configGrid=function(){e.gridOptions={data:e.model.currentContextVariablesMapping,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"inProcessVariable",visible:!e.isStartStep(),displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.INPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnInProcessVariable(row.entity)}}</div>'},{field:"inVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.inVariableType}}</div>'},{field:"tableVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-REUSABLE-TABLE-MESSAGE.TABLEVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnTable(row.entity)}}</div>'},{field:"outProcessVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.OUTPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnOutputProcessVariable(row.entity)}}</div>'},{field:"outVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.outVariableType}}</div>'},{field:"typeOfMapping",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.typeOfMapping}}</div>'}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.currentVariableMapping=t.isSelected?t.entity:void 0})}},e.configGrid(),e.getPreviousAndCurrentTableFields=function(){e.model.currentContextVariablesMapping.forEach(function(t){t.tableVariable=t.inProcessVariable.id?e.inputExpression.find(function(e){return e.id===t.tableVariable.id}):e.outputExpression.find(function(e){return e.id===t.tableVariable.id})})},e._getVariableColumnInProcessVariable=function(t){return e.autoSave(),t.inProcessVariable&&t.inProcessVariable.hasOwnProperty("id")?t.inProcessVariable.id:t.inProcessVariable},e._getVariableColumnOutputProcessVariable=function(t){return e.autoSave(),t.outProcessVariable&&t.outProcessVariable.hasOwnProperty("id")?t.outProcessVariable.id:t.outProcessVariable},e._getVariableColumnTable=function(e){var t;return t=e.tableVariable&&e.tableVariable.hasOwnProperty("id")?e.tableVariable.id:e.tableVariable},e.addField=function(){var t={tableVariable:void 0,inProcessVariable:void 0,outProcessVariable:void 0,inVariableType:"formField",outVariableType:"staticValue",typeOfMapping:e.isStartStep()?"outputMap":"inputOutputMap"};e.model.currentContextVariablesMapping.push(t),e.gridApi.selection.clearSelectedRows(),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.isDataGridEmpty=function(){return 0===e.model.currentContextVariablesMapping.length},e.removeField=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.model.currentContextVariablesMapping.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.model.currentContextVariablesMapping.splice(i,1),0===e.model.currentContextVariablesMapping.length&&(e.model.currentContextVariablesMapping.selectedField=void 0),o(function(){if(e.model.currentContextVariablesMapping.length>0){var t=i-1>=0?i-1:0;e.gridApi.selection.toggleRowSelection(e.model.currentContextVariablesMapping[t])}else e.currentVariableMapping.tableVariable=void 0,e.currentVariableMapping.inProcessVariable=void 0,e.currentVariableMapping.outProcessVariable=void 0})}e.save()},e.setInputVariableType=function(t){e.currentVariableMapping.inVariableType=t,e.currentVariableMapping.inProcessVariable=void 0},e.setOutputVariableType=function(t){e.currentVariableMapping.outVariableType=t,e.currentVariableMapping.outProcessVariable=void 0},e.setTypeOfMapping=function(t){var i=e.gridApi.selection.getSelectedRows()[0];i.tableVariable=void 0,i.inProcessVariable=void 0,i.outProcessVariable=void 0,i.inVariableType="formField",i.outVariableType="staticValue",e.currentVariableMapping.typeOfMapping=t},e.autoSave=function(){e.validInsert()&&e.save()},e.save=function(){e.step.variablesMapping=[],e.model.currentContextVariablesMapping.forEach(function(t){e.step.variablesMapping.push({mappedVariable:t.tableVariable&&t.tableVariable.id?t.tableVariable.id:"",inProcessVariable:t.inProcessVariable&&t.inProcessVariable.id?t.inProcessVariable.id:"",outProcessVariable:t.outProcessVariable&&t.outProcessVariable.id?t.outProcessVariable.id:"",typeOfMapping:t.typeOfMapping,inVariableType:t.inVariableType,outVariableType:t.outVariableType}),e.isStartStep()&&(e.currentKickstartModel.definition.definition.variablesMapping=e.step.variablesMapping)})},e.showVariableMapping=function(){return e.model.currentContextVariablesMapping&&e.model.hasVariableMapping},e.toggleVariableMapping=function(){e.model.hasVariableMapping=!e.step.hasVariableMapping,e.step.hasVariableMapping?e.model.currentContextVariablesMapping=e.model.tempStoreVariablesMapping:(e.model.tempStoreVariablesMapping=e.model.currentContextVariablesMapping,e.model.currentContextVariablesMapping=[])},e.validInsert=function(){var t=!1;return e.currentVariableMapping&&e.model.currentContextVariablesMapping.length>0&&("inputOutputMap"===e.currentVariableMapping.typeOfMapping?t=e.currentVariableMapping.tableVariable&&e.currentVariableMapping.inProcessVariable&&e.currentVariableMapping.outProcessVariable:"inputMap"===e.currentVariableMapping.typeOfMapping?t=e.currentVariableMapping.tableVariable&&e.currentVariableMapping.inProcessVariable:"outputMap"===e.currentVariableMapping.typeOfMapping&&(t=e.currentVariableMapping.tableVariable&&e.currentVariableMapping.outProcessVariable)),t},e.disableInsert=function(){return!e.validInsert()&&e.model.currentContextVariablesMapping.length>0},e.disableRemove=function(){return void 0===e.currentVariableMapping?!0:e.model.currentContextVariablesMapping&&0===e.model.currentContextVariablesMapping.length},e.$watch("step.decisionTableDefinition.id",function(t,i){t!==i&&(e.currentTableVariables=e.model.fieldsForCurrentDecisionTable,e.model.tempStoreVariablesMapping=[],e.model.currentContextVariablesMapping=[],e.allSteps=r.getAllPreviousStepsArray(e.currentKickstartModel.definition.definition.steps,e.step.id),e.configGrid())})}]),angular.module("activitiModeler").service("UtilityService",["$window","$document","$timeout",function(e,t,i){this.scrollToElement=function(o){i(function(){var i=angular.element(document.getElementById(o))[0];i&&i.getBoundingClientRect().top>e.innerHeight&&t.scrollToElement(i,0,1e3)})}}]),angular.module("activitiModeler").service("UserService",["$http","$q",function(e,t){var i=function(i){var o=t.defer();return e(i).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise};this.getFilteredUsers=function(e,t,o){var n={filter:e};return t&&(n.excludeTaskId=t),o&&(n.exclusdeProcessId=o),i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/workflow-users",params:n})}}]),angular.module("activitiModeler").service("GroupService",["$http","$q",function(e,t){var i=function(i){var o=t.defer();return e(i).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise};this.getFilteredGroups=function(e){var t;return e&&(t={filter:e}),i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/workflow-groups",params:t})}}]),angular.module("activitiModeler").service("StencilService",["$rootScope","$http","$q",function(e,t,i){var o=function(e){var o=i.defer();return t(e).success(function(e){o.resolve(e)}).error(function(e){console.log("Something went wrong during http call:"+e),o.reject(e)}),o.promise};this.fetchMyStencils=function(e){var t={status:2,editable:!0};return e&&(t.sort=e),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets",params:t})},this.fetchAllStencils=function(e){var t={status:1,editable:!0};return e&&(t.sort=e),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets",params:t})},this.fetchSharedStencils=function(e){var t={status:3,editable:!0};return e&&(t.sort=e),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets",params:t})},this.processStencilItemsFromServer=function(e){if(e.stencilItems&&e.stencilItems.length>0){for(var t=[],i=0;e.stencilItems.length>i;i++){var o=e.stencilItems[i];if(o.originatesFromServer=!0,o.tabs)for(var n=0;o.tabs.length>n;n++)o.tabs[n].originatesFromServer=!0;
if(void 0===o.group||null===o.group||0===o.group.length)t.push(o);else{for(var r=void 0,n=0;t.length>n;n++){var a=t[n];if("group"===a.type&&a.name===o.group){r=a;break}}r||(r={name:o.group,type:"group",items:[]},t.push(r)),r.items.push(o)}}return t}},this.fetchStencilDetails=function(e){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+e})},this.saveStencil=function(e,t){var i=function(e,t){(null===t||void 0===t)&&(t=[]);for(var o=0;e.length>o;o++){var n=e[o];if(null!==n.items&&void 0!=n.items)i(n.items,t);else if(null===n.removed||void 0===n.removed||n.removed===!1){if(delete n.isNewItem,delete n.originatesFromServer,n.tabs)for(var r=0;n.tabs.length>r;r++)delete n.tabs[r].originatesFromServer;t.push(n)}}return t};if(e.stencilItems=i(t),e.removedStencilItems)for(var n=0;e.removedStencilItems.length>n;n++)if(delete e.removedStencilItems[n].isNewItem,delete e.removedStencilItems[n].originatesFromServer,e.removedStencilItems[n].tabs)for(var r=0;e.removedStencilItems[n].tabs.length>r;r++)delete e.removedStencilItems[n].tabs[r].originatesFromServer;return delete Array.prototype.toJSON,o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+e.id+"/editor",data:e})},this.fetchStencilHistory=function(e){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+e+"/history"})},this.revertStencilToStencilHistory=function(e,t,i){var n={action:"useAsNewVersion",comment:i};return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+e+"/history/"+t,data:n})},this.fetchStencilUsageCount=function(e){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/count?stencilSetId="+e})},this.deleteStencil=function(e){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+e})},this.deleteStencilItem=function(e,t,i){e.removed=!0,t.push(e);var o,n=this.findGroupOfStencilItem(e,i);null!==n&&void 0!==n?(o=this.findItemIndexInGroup(e,n),n.items.splice(o,1)):(o=this.findIndexOfRootStencilItem(e,i),i.splice(o,1))},this.findItemIndexInGroup=function(e,t){if(t&&t.items&&t.items.length>0)for(var i=0;t.items.length>i;i++)if(t.items[i].id===e.id)return i;return void 0},this.findGroupOfStencilItem=function(e,t){if(t&&t.length>0)for(var i=0;t.length>i;i++){var o=t[i];if(o.type&&"group"===o.type)for(var n=0;o.items.length>n;n++)if(o.items[n].id===e.id)return o}return void 0},this.findIndexOfGroup=function(e,t){if(t&&t.length>0)for(var i=0;t.length>i;i++){var o=t[i];if(o.type&&"group"===o.type&&o.name===e)return i}return void 0},this.findIndexOfRootStencilItem=function(e,t){if(t&&t.length)for(var i=0;t.length>i;i++)if(t[i]===e)return i;return void 0},this.findStencilItemWithIdInCollection=function(e,t){var i=function(e){if(!e||0==e.length)return void 0;for(var o=0;e.length>o;o++){var n=e[o];if(n.type&&"group"===n.type){var r=i(n.items);if(r)return r}else if(n.id===t)return n}};return t?i(e):void 0},this.generateUniqueStencilItemId=function(e,t){var i=t.name;(null===i||void 0===i)&&(i=""),i=i.toLowerCase(),i=i.split(" ").join("_");for(var o=i,n=1;void 0!==this.findStencilItemWithIdInCollection(e,i);)i=o+n++;return i}}]),angular.module("activitiModeler").controller("StencilsController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal",function(e,t,i,o,n,r,a){t.hasAccessKickstartCapability()||t.backToLanding(),e.setMainPageById("stencils"),t.model={filters:[{id:"myStencils",labelKey:"MY-STENCILS"},{id:"sharedWithMe",labelKey:"SHARED-WITH-ME"},{id:"sharedWithOthers",labelKey:"SHARED-WITH-OTHERS"},{id:"favorite",labelKey:"FAVORITES"}],sorts:[{id:"modifiedDesc",labelKey:"MODIFIED-DESC"},{id:"modifiedAsc",labelKey:"MODIFIED-ASC"},{id:"nameAsc",labelKey:"NAME-ASC"},{id:"nameDesc",labelKey:"NAME-DESC"}]},t.hasAccessAllModelsInTenantCapability()&&t.model.filters.push({id:"everyone",labelKey:"EVERYONE"}),e.stencilFilter?(t.model.activeFilter=e.stencilFilter.filter,t.model.activeSort=e.stencilFilter.sort,t.model.filterText=e.stencilFilter.filterText,t.model.pendingFilterText=t.model.filterText):(t.model.activeFilter=t.model.filters[0],t.model.activeSort=t.model.sorts[0],e.stencilFilter={filter:t.model.activeFilter,sort:t.model.activeSort,filterText:""}),t.activateFilter=function(i){t.model.activeFilter=i,e.stencilFilter.filter=i,t.loadStencils()},t.activateSort=function(i){t.model.activeSort=i,e.stencilFilter.sort=i,t.loadStencils()},t.loadStencils=function(){t.model.loading=!0;var e={filter:t.model.activeFilter.id,sort:t.model.activeSort.id};t.model.filterText&&""!=t.model.filterText&&(e.filterText=t.model.filterText),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets",params:e}).success(function(e){t.model.stencils=e,t.model.loading=!1}).error(function(){t.model.loading=!1})};var s=function(){t.model.isFilterDelayed=!0,n(function(){t.model.isFilterDelayed=!1,t.model.isFilterUpdated?(t.model.isFilterUpdated=!1,s()):(t.model.filterText=t.model.pendingFilterText,e.stencilFilter.filterText=t.model.filterText,t.loadStencils())},500)};t.filterDelayed=function(){t.model.isFilterDelayed?t.model.isFilterUpdated=!0:s()},t.createStencil=function(){_internalCreateModal({template:"views/popup/stencil-create.html?version="+Date.now()},a,t)},t.importStencil=function(){_internalCreateModal({template:"views/popup/stencil-import.html?version="+Date.now()},a,t)},t.showStencilDetails=function(e){e&&r.path("/stencils/"+e.id)},t.editStencilDetails=function(e){e&&r.path("/stencil-editor/"+e.id)},t.loadStencils()}]),angular.module("activitiModeler").controller("ImportStencilCtrl",["$rootScope","$scope","$http","Upload","$location","EventTrackingService",function(e,t,i,o,n){t.model={loading:!1},t.onFileSelect=function(e,i){for(var r=0;e.length>r;r++){var a,s=e[r];a=i?ACTIVITI.CONFIG.contextRoot+"/app/rest/import-stencil/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/import-stencil",o.upload({url:a,method:"POST",file:s}).progress(function(e){t.model.loading=!0,t.model.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(e){t.model.loading=!1,n.path("/stencils/"+e.id),t.$hide()}).error(function(e){e&&e.message&&(t.model.errorMessage=e.message),t.model.error=!0,t.model.loading=!1})}},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("StencilDetailsCtrl",["$rootScope","$scope","$translate","$http","$location","$routeParams","$modal","$popover","$timeout","StencilService",function(e,t,i,o,n,r,a,s,l,d){e.setMainPageById("stencils"),t.model={latestStencilId:r.stencilId,expandedGroups:[],executionListeners:[],variables:[],scriptFiles:[]},t.loadStencil=function(){var n;r.stencilHistoryId?(n=ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+r.stencilId+"/history/"+r.stencilHistoryId,t.model.stencilDownloadUrl=n+"/export?version="+Date.now()):(n=ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+r.stencilId,t.model.stencilDownloadUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+r.stencilId+"/export?version="+Date.now()),o({method:"GET",url:n}).success(function(e){t.model.stencil=e,t.model.stencilItems=d.processStencilItemsFromServer(e),t.model.removedStencilItems=e.removedStencilItems,t.loadComments(),t.loadVersions()}).error(function(){e.addAlertPromise(i("STENCIL-MODEL.MESSAGE.NOT-FOUND"),"error"),t.returnToList()})},t.useAsNewVersion=function(){_internalCreateModal({template:"views/popup/stencil-use-as-new-version.html",scope:t},a,t)},t.toggleFavorite=function(){t.model.favoritePending=!0;var e={id:t.model.stencil.id,favorite:!t.model.stencil.favorite};o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+t.model.latestStencilId,data:e}).success(function(){t.model.favoritePending=!1,t.model.stencil.favorite?t.addAlertPromise(i("STENCIL.ALERT.UN-FAVORITE-CONFIRM"),"info"):t.addAlertPromise(i("STENCIL.ALERT.FAVORITE-CONFIRM"),"info"),t.model.stencil.favorite=!t.model.stencil.favorite}).error(function(){t.model.favoritePending=!1})},t.loadVersions=function(){var e={includeLatestVersion:!t.model.stencil.latestVersion};o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+t.model.latestStencilId+"/history",params:e}).success(function(e){t.model.stencil.latestVersion&&(e.data||(e.data=[]),e.data.unshift(t.model.stencil)),t.model.versions=e})},t.showVersion=function(e){e&&(e.latestVersion?n.path("/stencils/"+t.model.latestStencilId):n.path("/stencils/"+t.model.latestStencilId+"/history/"+e.id))},t.returnToList=function(){n.path("/stencils/")},t.editStencil=function(){_internalCreateModal({template:"views/popup/stencil-details-edit.html",scope:t},a,t)},t.deleteStencil=function(){_internalCreateModal({template:"views/popup/stencil-delete.html",scope:t},a,t)},t.shareStencil=function(){_internalCreateModal({template:"views/popup/model-share.html",scope:t},a,t)},t.openEditor=function(){t.model.stencil&&n.path("/stencil-editor/"+t.model.stencil.id)},t.loadComments=function(){var e={latestFirst:!0};o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+t.model.latestStencilId+"/comments",params:e}).success(function(e){t.model.comments=e})},t.toggleComments=function(e){if(!t.commentsState){var i={};t.commentsState=i,i.popover=s(angular.element(e.target),{template:"views/popover/stencil-comments.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.commentsState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.toggleHistory=function(e){if(!t.historyState){var i={};t.historyState=i,i.popover=s(angular.element(e.target),{template:"views/popover/stencil-history.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.historyState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.collapseGroup=function(e){var i=t.model.expandedGroups.indexOf(e);i>=0&&t.model.expandedGroups.splice(i,1)},t.expandGroup=function(e){var i=t.model.expandedGroups.indexOf(e);0>i&&t.model.expandedGroups.push(e)},t.isGroupExpanded=function(e){return t.model.expandedGroups.indexOf(e)>=0},t.toggleGroupCollapseState=function(e){var i=t.model.expandedGroups.indexOf(e);i>=0?t.collapseGroup(e):t.expandGroup(e)},t.clearGroupSelection=function(){if(delete t.model.activeGroup,t.model.stencilItems)for(var e=0;t.model.stencilItems.length>e;e++)t.model.stencilItems[e].selected&&(t.model.stencilItems[e].selected=!1)},t.clearItemSelection=function(){delete t.model.activeStencilItem},t.clearSelection=function(){t.clearGroupSelection(),t.clearItemSelection()},t.showGroupDetails=function(e){t.expandGroup(e),t.clearSelection(),t.model.activeGroup=e},t.showItemDetails=function(e){t.clearSelection(),t.model.activeStencilItem=e,t.$broadcast("event:selectedItemChanged"),!t.model.activeStencilItem.customStencilItem||t.model.activeStencilItem.customStencilItem.customType&&0!=t.model.activeStencilItem.customStencilItem.customType.length||(t.model.activeStencilItem.customStencilItem.customType="Service task"),t.model.executionListeners.length=0,t.model.activeStencilItem.customStencilItem&&t.model.activeStencilItem.customStencilItem.executionListeners&&t.model.activeStencilItem.customStencilItem.executionListeners.length>0&&Array.prototype.push.apply(t.model.executionListeners,t.model.activeStencilItem.customStencilItem.executionListeners),t.model.variables.length=0,t.model.activeStencilItem.customStencilItem&&t.model.activeStencilItem.customStencilItem.variables&&t.model.activeStencilItem.customStencilItem.variables.length>0&&Array.prototype.push.apply(t.model.variables,t.model.activeStencilItem.customStencilItem.variables),t.model.scriptFiles.length=0,Array.prototype.push.apply(t.model.scriptFiles,t.model.activeStencilItem.scriptFiles)},t.loadStencil()}]),angular.module("activitiModeler").controller("StencilSetAddCommentPopupCrtl",["$rootScope","$scope","$http","$timeout","$translate","EventTrackingService",function(e,t,i,o,n,r){t.popup={loading:!1},t.ok=function(){t.popup.loading=!0;var e={message:t.popup.message};i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+t.model.stencil.id+"/comments",data:e}).success(function(){t.addAlertPromise(n("STENCIL.ALERT.COMMENT-ADDED-CONFIRM"),"info"),t.loadComments(),r.trackEvent("editor","stencil-model-add-comment"),t.popup.loading=!1,t.popup.message=void 0}).error(function(){t.popup.loading=!1})}}]),angular.module("activitiModeler").controller("StencilUseAsNewVersionPopupCtrl",["$rootScope","$scope","$http","$translate","$location",function(e,t,i,o,n){t.popup={loading:!1,comment:""},t.ok=function(){t.popup.loading=!0;var e={action:"useAsNewVersion",comment:t.popup.comment};i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+t.model.stencil.stencilSetId+"/history/"+t.model.stencil.id,data:e}).success(function(){t.$hide(),t.popup.loading=!1,t.addAlertPromise(o("STENCIL.ALERT.NEW-VERSION-CONFIRM"),"info"),n.path("/stencils/"+t.model.stencil.stencilSetId)}).error(function(){t.$hide(),t.popup.loading=!1})},t.cancel=function(){t.popup.loading||t.$hide()}}]),angular.module("activitiModeler").controller("StencilItemDetailsCtrl",["$rootScope","$scope","$modal","$q","$translate","StencilService",function(e,t,i,o,n){t.getStencilGroups=function(){for(var t=[],i=0;e.currentStencilItems.length>i;i++){var o=e.currentStencilItems[i];o.type&&"group"===o.type&&t.push(o.name)}return t},t.showProperties=function(){var e;e=2===t.model.stencil.stencilType?"views/popup/stencil-step-properties-details.html":3===t.model.stencil.stencilType?"views/popup/stencil-form-properties-details.html":"views/popup/stencil-properties-details.html",_internalCreateModal({scope:t,template:e+"?version="+Date.now()},i,t)},t.showComponentController=function(){_internalCreateModal({scope:t,template:"views/popup/stencil-component-controller-details.html?version="+Date.now()},i,t)},t.translationsRetrieved=!1,t.labels={};var r=n("PROPERTY.EXECUTIONLISTENERS.EVENT"),a=n("PROPERTY.EXECUTIONLISTENERS.FIELDS.IMPLEMENTATION"),s=n("PROPERTY.EXECUTION.VARIABLES.VARIABLENAME.LABEL"),l=n("PROPERTY.EXECUTION.VARIABLES.VARIABLETYPE.LABEL"),d=n("STENCILS.ITEM.SCRIPT-FILES.NAME"),c=n("STENCILS.ITEM.SCRIPT-FILES.FILENAME"),p=n("STENCILS.ITEM.SCRIPT-FILES.CREATED-BY"),u=n("STENCILS.ITEM.SCRIPT-FILES.CREATED-AT");o.all([r,a,s,l,d,c,p,u]).then(function(e){var i=0;t.labels.executionListenerEventLabel=e[i++],t.labels.executionListenerImplementationLabel=e[i++],t.labels.variableNameLabel=e[i++],t.labels.variableTypeLabel=e[i++],t.labels.nameLabel=e[i++],t.labels.filenameLabel=e[i++],t.labels.createdByLabel=e[i++],t.labels.createdAtLabel=e[i++],t.translationsRetrieved=!0,t.executionListenerGridOptions={data:t.model.executionListeners,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"event",displayName:t.labels.executionListenerEventLabel},{field:"implementation",displayName:t.labels.executionListenerImplementationLabel}]},t.executionListenerGridOptions.onRegisterApi=function(e){t.executionListenerGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedExecutionListener=e.isSelected?e.entity:void 0})},t.variableGridOptions={data:t.model.variables,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:t.labels.variableNameLabel},{field:"type",displayName:t.labels.variableTypeLabel}]},t.importLibOptions={data:t.model.scriptFiles,headerRowHeight:28,enableRowSelection:!1,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:t.labels.nameLabel},{field:"filename",displayName:t.labels.filenameLabel},{field:"createdByFullName",displayName:t.labels.createdByLabel},{field:"created",displayName:t.labels.createdAtLabel,cellFilter:"date:'dd-MM-yyyy HH:mm'"}]}}),t.$on("event:selectedItemChanged",function(){t.selectedExecutionListener=void 0})}]),angular.module("activitiModeler").controller("StencilItemEditCtrl",["$rootScope","$scope","$modal","$http","$translate","$q","$timeout","StencilService",function(e,t,i,o,n,r,a,s){t.canMoveItem=function(i){var o=t.model.activeStencilItem;if(o){var n,r=s.findGroupOfStencilItem(o,e.currentStencilItems);return null!==r&&void 0!==r?r.items&&0!=r.items.length?(n=s.findItemIndexInGroup(o,r),"up"===i?n>0:r.items.length-1>n):!1:(n=s.findIndexOfRootStencilItem(o,e.currentStencilItems),"up"===i?n>0:e.currentStencilItems.length-1>n)}return!1},t.moveItem=function(i){var o=t.model.activeStencilItem;if(null!==o&&void 0!==o){var n=s.findGroupOfStencilItem(o,e.currentStencilItems);if(n){var r=s.findItemIndexInGroup(o,n);if(null!==r&&void 0!==r&&r>=0){var a=n.items[r];"up"===i?(n.items[r]=n.items[r-1],n.items[r-1]=a):(n.items[r]=n.items[r+1],n.items[r+1]=a)}}else{r=s.findIndexOfRootStencilItem(o,e.currentStencilItems);var a=e.currentStencilItems[r];"up"===i?(e.currentStencilItems[r]=e.currentStencilItems[r-1],e.currentStencilItems[r-1]=a):(e.currentStencilItems[r]=e.currentStencilItems[r+1],e.currentStencilItems[r+1]=a)}}},t.deleteItem=function(){s.deleteStencilItem(t.model.activeStencilItem,t.model.removedStencilItems,e.currentStencilItems),t.clearSelection()},t.itemNameChanged=function(){(t.model.activeStencilItem.originatesFromServer===!1||void 0===t.model.activeStencilItem.originatesFromServer)&&(t.model.activeStencilItem.id=s.generateUniqueStencilItemId(e.currentStencilItems,t.model.activeStencilItem))},t.changeItemIcon=function(){_internalCreateModal({template:"views/popup/stencil-item-icon-upload.html",scope:t},i,t)},t.getStencilGroups=function(){for(var t=[],i=0;e.currentStencilItems.length>i;i++){var o=e.currentStencilItems[i];o.type&&"group"===o.type&&t.push(o.name)}return t},t.stencilItemGroupChanged=function(){var i=s.findGroupOfStencilItem(t.model.activeStencilItem,e.currentStencilItems);if(null!==i&&void 0!==i){var o=s.findItemIndexInGroup(t.model.activeStencilItem,i);i.items.splice(o,1)}else e.currentStencilItems.splice(s.findIndexOfRootStencilItem(t.model.activeStencilItem,e.currentStencilItems),1);var n=e.currentStencilItems[s.findIndexOfGroup(t.model.activeStencilItem.group,e.currentStencilItems)];n.items.push(t.model.activeStencilItem),t.expandGroup(n)},t.removeFromGroup=function(){var i=s.findGroupOfStencilItem(t.model.activeStencilItem,e.currentStencilItems);if(null!==i&&void 0!==i){var o=s.findItemIndexInGroup(t.model.activeStencilItem,i);i.items.splice(o,1)}delete t.model.activeStencilItem.group,e.currentStencilItems.push(t.model.activeStencilItem)},t.addNewExecutionListener=function(){var e={event:"start",className:"",expression:"",delegateExpression:""};t.model.executionListeners.push(e),t.model.activeStencilItem.customStencilItem.executionListeners||(t.model.activeStencilItem.customStencilItem.executionListeners=[]),t.model.activeStencilItem.customStencilItem.executionListeners.push(e),t.selectedExecutionListener=e,a(function(){t.executionListenerGridApi.selection.toggleRowSelection(t.model.executionListeners[t.model.executionListeners.length-1])})},t.removeExecutionListener=function(){if(t.selectedExecutionListener){var e=t.model.activeStencilItem.customStencilItem.executionListeners.indexOf(t.selectedExecutionListener);t.model.activeStencilItem.customStencilItem.executionListeners.splice(e,1);var e=t.model.executionListeners.indexOf(t.selectedExecutionListener);t.model.executionListeners.splice(e,1),t.selectedExecutionListener=void 0,a(function(){t.model.executionListeners.length>0&&t.executionListenerGridApi.selection.toggleRowSelection(t.model.executionListeners[0])})}},t.executionListenerDetailsChanged=function(){t.selectedExecutionListener.implementation=""!==t.selectedExecutionListener.className?t.selectedExecutionListener.className:""!==t.selectedExecutionListener.expression?t.selectedExecutionListener.expression:""!==t.selectedExecutionListener.delegateExpression?t.selectedExecutionListener.delegateExpression:""},t.addNewVariable=function(){var e={name:"",type:"string"};t.model.variables.push(e),t.model.activeStencilItem.customStencilItem.variables||(t.model.activeStencilItem.customStencilItem.variables=[]),t.model.activeStencilItem.customStencilItem.variables.push(e),t.selectedVariable=e,a(function(){t.variableGridApi.selection.toggleRowSelection(t.model.variables[t.model.variables.length-1])})},t.removeVariable=function(){if(t.selectedVariable){var e=t.model.activeStencilItem.customStencilItem.variables.indexOf(t.selectedVariable);t.model.activeStencilItem.customStencilItem.variables.splice(e,1);var e=t.model.variables.indexOf(t.selectedVariable);t.model.variables.splice(e,1),t.selectedVariable=void 0,a(function(){t.model.variables.length>0&&t.variableGridApi.selection.toggleRowSelection(t.model.variables[0])})}},t.editComponentController=function(){_internalCreateModal({scope:t,template:"views/popup/stencil-component-controller.html?version="+Date.now()},i,t)},t.addNewScriptFile=function(){_internalCreateModal({scope:t,template:"views/popup/stencil-script-file-upload.html?version="+Date.now()},i,t)},t.removeScriptFile=function(){t.selectedScriptFile&&o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+e.currentStencil.id+"/script-files/"+t.selectedScriptFile.id}).success(function(){var e=t.model.activeStencilItem.scriptFiles.indexOf(t.selectedScriptFile);t.model.activeStencilItem.scriptFiles.splice(e,1);var e=t.model.scriptFiles.indexOf(t.selectedScriptFile);t.model.scriptFiles.splice(e,1),t.selectedScriptFile=void 0,a(function(){t.model.scriptFiles.length>0&&t.importLibGridApi.selection.toggleRowSelection(t.model.scriptFiles[0])})}).error(function(){})},t.canEditItemProperties=function(e,i){function o(e){var t=["human-step","email-step","choice-step","subprocess-step","rest-call-step","get-alfresco-metadata-action-step","put-alfresco-metadata-action-step","call-alfresco-action-step","alfresco-cloud-publish-step","box-cloud-publish-step","google-drive-publish-step","generate-doc-step","goto-step","end-process-step","decision-step"];if(void 0!==e&&void 0!==e.id){var i=e.id;return t.indexOf(i)>=0}return!1}return e==t.STEP_PROCESS_STENCIL&&o(i)?!1:!0},t.editProperties=function(e){var o;o=2===e?"views/popup/stencil-step-properties-edit.html":3===e?"views/popup/stencil-form-properties-edit.html":"views/popup/stencil-properties-edit.html",_internalCreateModal({scope:t,template:o+"?version="+Date.now()},i,t)},t.selectedScriptFile=void 0,t.translationsRetrieved=!1,t.labels={};var l=n("PROPERTY.EXECUTIONLISTENERS.EVENT"),d=n("PROPERTY.EXECUTIONLISTENERS.FIELDS.IMPLEMENTATION"),c=n("PROPERTY.EXECUTION.VARIABLES.VARIABLENAME.LABEL"),p=n("PROPERTY.EXECUTION.VARIABLES.VARIABLETYPE.LABEL"),u=n("STENCILS.ITEM.SCRIPT-FILES.NAME"),m=n("STENCILS.ITEM.SCRIPT-FILES.FILENAME"),h=n("STENCILS.ITEM.SCRIPT-FILES.CREATED-BY"),f=n("STENCILS.ITEM.SCRIPT-FILES.CREATED-AT");r.all([l,d,c,p,u,m,h,f]).then(function(e){var i=0;t.labels.executionListenerEventLabel=e[i++],t.labels.executionListenerImplementationLabel=e[i++],t.labels.variableNameLabel=e[i++],t.labels.variableTypeLabel=e[i++],t.labels.nameLabel=e[i++],t.labels.filenameLabel=e[i++],t.labels.createdByLabel=e[i++],t.labels.createdAtLabel=e[i++],t.translationsRetrieved=!0,t.executionListenerGridOptions={data:t.model.executionListeners,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"event",displayName:t.labels.executionListenerEventLabel},{field:"implementation",displayName:t.labels.executionListenerImplementationLabel}]},t.executionListenerGridOptions.onRegisterApi=function(e){t.executionListenerGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?(t.selectedExecutionListener=e.entity,t.selectedExecutionListener.implementation=""!==t.selectedExecutionListener.className?t.selectedExecutionListener.className:""!==t.selectedExecutionListener.expression?t.selectedExecutionListener.expression:""!==t.selectedExecutionListener.delegateExpression?t.selectedExecutionListener.delegateExpression:""):t.selectedExecutionListener=void 0})},t.variableGridOptions={data:t.model.variables,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:t.labels.variableNameLabel},{field:"type",displayName:t.labels.variableTypeLabel}]},t.variableGridOptions.onRegisterApi=function(e){t.variableGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedVariable=e.isSelected?e.entity:void 0})},t.importLibOptions={data:t.model.scriptFiles,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:t.labels.nameLabel},{field:"filename",displayName:t.labels.filenameLabel},{field:"createdByFullName",displayName:t.labels.createdByLabel},{field:"created",displayName:t.labels.createdAtLabel,cellFilter:"date:'dd-MM-yyyy HH:mm'"}]},t.importLibOptions.onRegisterApi=function(e){t.importLibGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedScriptFile=e.isSelected?e.entity:void 0})}}),t.$on("event:selectedItemChanged",function(){t.selectedExecutionListener=void 0,t.selectedVariable=void 0,t.selectedScriptFile=void 0})}]),angular.module("activitiModeler").controller("StencilComponentControllerCtrl",["$rootScope","$scope","$http",function(e,t){t.close=function(){t.$hide()}}]),angular.module("activitiModeler").controller("UploadScriptFileCtrl",["$rootScope","$scope","Upload",function(e,t,i){t.popup={scriptFile:{name:""},loading:!1},t.onFileSelect=function(o){for(var n=0;o.length>n;n++){var r=o[n],a=ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+e.currentStencil.id+"/script-files?name="+t.popup.scriptFile.name;i.upload({url:a,method:"POST",file:r}).progress(function(e){t.popup.loading=!0,t.popup.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(e){t.popup.loading=!1,t.model.activeStencilItem.scriptFiles||(t.model.activeStencilItem.scriptFiles=[]),t.model.activeStencilItem.scriptFiles.push(e),t.model.scriptFiles.push(e),t.$hide()}).error(function(e){e&&e.message&&(t.popup.errorMessage=e.message),t.popup.error=!0,t.popup.loading=!1})}},t.cancel=function(){t.popup.loading||t.$hide()}}]),angular.module("activitiModeler").controller("StencilGroupEditCtrl",["$rootScope","$scope","$modal","StencilService",function(e,t,i,o){t.canMoveGroup=function(i){if(null!==t.model.activeGroup&&void 0!==t.model.activeGroup){var n=o.findIndexOfGroup(t.model.activeGroup.name,e.currentStencilItems);return"up"===i?n>0:e.currentStencilItems.length-1>n}return!1},t.moveGroup=function(i){if(null!==t.model.activeGroup&&void 0!==t.model.activeGroup){var n=o.findIndexOfGroup(t.model.activeGroup.name,e.currentStencilItems);if(null!==n&&void 0!==n&&n>=0){var r=e.currentStencilItems[n];"up"===i?(e.currentStencilItems[n]=e.currentStencilItems[n-1],e.currentStencilItems[n-1]=r):(e.currentStencilItems[n]=e.currentStencilItems[n+1],e.currentStencilItems[n+1]=r)}}},t.groupNameChanged=function(){if(t.model.activeGroup.items&&t.model.activeGroup.items.length>0)for(var e=0;t.model.activeGroup.items.length>e;e++)t.model.activeGroup.items[e].group=t.model.activeGroup.name},t.deleteGroup=function(){if(t.model.activeGroup.items&&t.model.activeGroup.items.length>0)for(;t.model.activeGroup.items.length>0;)o.deleteStencilItem(t.model.activeGroup.items[0],t.model.removedStencilItems,e.currentStencilItems);var i=o.findIndexOfGroup(t.model.activeGroup.name,e.currentStencilItems);e.currentStencilItems.splice(i,1),t.clearSelection()}}]),angular.module("activitiModeler").controller("StencilPropertiesCtrl",["$scope",function(e){e.findRestoreProperties=function(){var t=[];if(e.model.activeStencilItem.stencilProperties)for(var i=0;e.model.activeStencilItem.stencilProperties.length>i;i++)e.model.activeStencilItem.stencilProperties[i].removed&&t.push(e.model.activeStencilItem.stencilProperties[i]);e.model.candidateRestoreProperties=t},e.showPropertyDetails=function(t){e.clearPropertyValues(),e.model.activeStencilProperty=t},e.addNewProperty=function(){e.clearPropertyValues(),e.model.newStencilProperty={name:"",description:"",type:"String",customStencilProperty:{customProperty:!0}}},e.restoreProperty=function(){e.clearPropertyValues(),e.model.restoreProperties=e.model.candidateRestoreProperties},e.saveNewProperty=function(){if(0!=e.model.newStencilProperty.name.length){if(delete e.model.propertyIdNotUniqueError,t(e.model.newStencilProperty.id))return e.model.propertyIdNotUniqueError=!0,void 0;e.model.activeStencilItem.stencilProperties.push(e.model.newStencilProperty),e.clearPropertyValues()}},e.addExistingProperty=function(){e.clearPropertyValues();var t=[];if(e.model.activeStencilItem.stencilProperties)for(var o=0;e.model.activeStencilItem.stencilProperties.length>o;o++)t.push(e.model.activeStencilItem.stencilProperties[o].id);e.model.existingProperties=i(t)},e.cancelPropertyEdit=function(){e.clearPropertyValues()},e.saveAddExistingProperty=function(){e.model.existingStencilProperty&&e.model.existingStencilProperty.id&&(e.model.activeStencilItem.stencilProperties||(e.model.activeStencilItem.stencilProperties=[]),e.model.activeStencilItem.stencilProperties.push(e.model.existingStencilProperty),e.clearPropertyValues())},e.saveRestoreProperty=function(){0!=e.model.restoreStencilProperty.name.length&&(e.model.restoreStencilProperty.removed=!1,e.findRestoreProperties(),e.clearPropertyValues())},e.selectCandidateProperty=function(t){e.model.existingStencilProperty=t},e.selectRestoreProperty=function(t){e.model.restoreStencilProperty=t},e.clearPropertyValues=function(){e.model.newStencilProperty=void 0,e.model.existingProperties=void 0,e.model.existingStencilProperty=void 0,e.model.restoreProperties=void 0,e.model.restoreStencilProperty=void 0,e.model.activeStencilProperty=void 0};var t=function(t){var i=function(e){if(!e||0==e.length)return void 0;for(var o=0;e.length>o;o++){var n=e[o];if(n.type&&"group"===n.type){var r=i(n.items);if(r)return r}else if(n.stencilProperties&&n.stencilProperties.length>0)for(var a=0;n.stencilProperties.length>a;a++)if(n.stencilProperties[a].id===t)return n.stencilProperties[a]}};return t?i(e.currentStencilItems):!0},i=function(t){var i=[],o=[],n=function(e){if(!e||0==e.length)return void 0;for(var r=0;e.length>r;r++){var a=e[r];if(a.type&&"group"===a.type){var s=n(a.items);if(s)return s}else if(a.stencilProperties&&a.stencilProperties.length>0)for(var l=0;a.stencilProperties.length>l;l++)0>o.indexOf(a.stencilProperties[l].id)&&0>t.indexOf(a.stencilProperties[l].id)&&(i.push(a.stencilProperties[l]),o.push(a.stencilProperties[l].id))}},r=function(e,t){return e.name<t.name?-1:e.name>t.name?1:0};return n(e.model.stencilItems),i.sort(r)},o=function(t){for(var i=e.model.activeStencilItem.stencilProperties,o=0;i.length>o;o++)if(i[o].id===t.id)return o;return void 0};e.canMoveProperty=function(t){var i=e.model.activeStencilProperty;if(i){var n=o(i);return"up"===t?n>0:e.model.activeStencilItem.stencilProperties.length-1>n}return!1},e.moveProperty=function(t){var i=e.model.activeStencilProperty;if(i){var n=o(i);if(null!==n&&void 0!==n&&n>=0){var r=e.model.activeStencilItem.stencilProperties;"up"===t?(r[n]=r[n-1],r[n-1]=i):(r[n]=r[n+1],r[n+1]=i),e.model.activeStencilItem.stencilProperties=r}}},e.deleteProperty=function(){e.model.activeStencilProperty.removed=!0,e.model.activeStencilProperty=void 0,e.findRestoreProperties()},e.close=function(){e.model.activeStencilProperty=void 0,e.model.newStencilProperty=void 0,e.model.existingProperties=void 0,e.$hide()
},e.findRestoreProperties()}]),angular.module("activitiModeler").controller("StencilStepPropertiesCtrl",["$scope",function(e){e.propertyTabs=e.model.activeStencilItem.tabs,e.activeTab=e.propertyTabs[0],e.tabClicked=function(t){e.activeTab=t,e.currentStencilProperties=e.activeTab.stencilProperties,e.model.activeStencilProperty=void 0},e.addNewTab=function(){var t={id:"tab",name:"Tab",stencilProperties:[]};e.propertyTabs.push(t),e.tabClicked(t)},e.tabNameChanged=function(){(void 0===e.activeTab.originatesFromServer||e.activeTab.originatesFromServer===!1)&&(e.activeTab.id=e.generateIdForTab(e.activeTab))},e.generateIdForTab=function(t){var i=t.name;(null===i||void 0===i)&&(i=""),i=i.toLowerCase(),i=i.split(" ").join("_");for(var o=i,n=1;e.hasTabWithId(i);)i=o+n++;return i},e.hasTabWithId=function(t){for(var i=0;e.propertyTabs.length>i;i++)if(t==e.propertyTabs[i].id)return!0;return!1},e.canMoveTab=function(t){if(e.activeTab){var i=e.propertyTabs.indexOf(e.activeTab);return"left"===t?i>0:e.propertyTabs.length-1>i}return!1},e.moveTab=function(t){if(e.activeTab){var i=e.propertyTabs.indexOf(e.activeTab);if(null!==i&&void 0!==i&&i>=0){var o=e.propertyTabs;"left"===t?(o[i]=o[i-1],o[i-1]=e.activeTab):(o[i]=o[i+1],o[i+1]=e.activeTab),e.propertyTabs=o}}},e.canDeleteTab=function(){return e.activeTab&&"details"!=e.activeTab.id&&"form"!=e.activeTab.id?!0:!1},e.deleteTab=function(){var t=e.propertyTabs.indexOf(e.activeTab);e.propertyTabs.splice(t,1),e.tabClicked(e.propertyTabs[0])},e.showPropertyDetails=function(t){e.clearPropertyValues(),e.model.activeStencilProperty=t},e.addNewProperty=function(){e.clearPropertyValues(),e.model.newStencilProperty={name:"",description:"",type:"text",customStencilProperty:{customProperty:!0}}},e.saveNewProperty=function(){if(0!=e.model.newStencilProperty.name.length){if(delete e.model.propertyIdNotUniqueError,t(e.model.newStencilProperty.id))return e.model.propertyIdNotUniqueError=!0,void 0;e.currentStencilProperties.push(e.model.newStencilProperty),e.clearPropertyValues()}},e.cancelPropertyEdit=function(){e.clearPropertyValues()},e.clearPropertyValues=function(){e.model.newStencilProperty=void 0,e.model.restoreProperties=void 0,e.model.restoreStencilProperty=void 0,e.model.activeStencilProperty=void 0};var t=function(t){var i=function(e){if(!e||0==e.length)return void 0;for(var i=0;e.length>i;i++){var o=e[i];if(o.tabs&&o.tabs.length>0)for(var n=0;o.tabs.length>n;n++)if(o.tabs[n].stencilProperties&&o.tabs[n].stencilProperties.length>0)for(var r=0;o.tabs[n].stencilProperties.length>r;r++)if(o.tabs[n].stencilProperties[r].id===t)return o.tabs[n].stencilProperties[r]}};return t?i(e.currentStencilItems):!0},i=function(t){for(var i=e.currentStencilProperties,o=0;i.length>o;o++)if(i[o].id===t.id)return o;return void 0};e.canMoveProperty=function(t){var o=e.model.activeStencilProperty;if(o){var n=i(o);return"up"===t?n>0:e.currentStencilProperties.length-1>n}return!1},e.moveProperty=function(t){var o=e.model.activeStencilProperty;if(o){var n=i(o);if(null!==n&&void 0!==n&&n>=0){var r=e.currentStencilProperties;"up"===t?(r[n]=r[n-1],r[n-1]=o):(r[n]=r[n+1],r[n+1]=o),e.currentStencilProperties=r}}},e.notRemovableProperties=["id","name","description"],e.canDeleteProperty=function(){return e.model.activeStencilProperty?"details"!=e.activeTab.id?!0:e.notRemovableProperties.indexOf(e.model.activeStencilProperty.id)>=0?!1:!0:!1},e.deleteProperty=function(){var t=e.currentStencilProperties.indexOf(e.model.activeStencilProperty);e.currentStencilProperties.splice(t,1),e.model.activeStencilProperty=void 0},e.close=function(){e.model.activeStencilProperty=void 0,e.model.newStencilProperty=void 0,e.$hide()},e.tabClicked(e.activeTab)}]),angular.module("activitiModeler").controller("StencilFormPropertiesCtrl",["$scope",function(e){e.propertyTabs=e.model.activeStencilItem.tabs,e.activeTab=e.propertyTabs[0],e.tabClicked=function(t){e.activeTab=t,e.currentStencilProperties=e.activeTab.stencilProperties,e.model.activeStencilProperty=void 0},e.addNewTab=function(){var t={id:"tab",name:"Tab",stencilProperties:[]};e.propertyTabs.push(t),e.tabClicked(t)},e.tabNameChanged=function(){(void 0===e.activeTab.originatesFromServer||e.activeTab.originatesFromServer===!1)&&(e.activeTab.id=e.generateIdForTab(e.activeTab))},e.generateIdForTab=function(t){var i=t.name;(null===i||void 0===i)&&(i=""),i=i.toLowerCase(),i=i.split(" ").join("_");for(var o=i,n=1;e.hasTabWithId(i);)i=o+n++;return i},e.hasTabWithId=function(t){for(var i=0;e.propertyTabs.length>i;i++)if(t==e.propertyTabs[i].id)return!0;return!1},e.canMoveTab=function(t){if(e.activeTab){var i=e.propertyTabs.indexOf(e.activeTab);return"left"===t?i>0:e.propertyTabs.length-1>i}return!1},e.moveTab=function(t){if(e.activeTab){var i=e.propertyTabs.indexOf(e.activeTab);if(null!==i&&void 0!==i&&i>=0){var o=e.propertyTabs;"left"===t?(o[i]=o[i-1],o[i-1]=e.activeTab):(o[i]=o[i+1],o[i+1]=e.activeTab),e.propertyTabs=o}}},e.canDeleteTab=function(){return e.activeTab&&"general"!=e.activeTab.id?!0:!1},e.deleteTab=function(){var t=e.propertyTabs.indexOf(e.activeTab);e.propertyTabs.splice(t,1),e.tabClicked(e.propertyTabs[0])},e.showPropertyDetails=function(t){e.clearPropertyValues(),e.model.activeStencilProperty=t},e.addNewProperty=function(){e.clearPropertyValues(),e.model.newStencilProperty={name:"",description:"",type:"text",customStencilProperty:{customProperty:!0}}},e.saveNewProperty=function(){if(0!=e.model.newStencilProperty.name.length){if(delete e.model.propertyIdNotUniqueError,t(e.model.newStencilProperty.id))return e.model.propertyIdNotUniqueError=!0,void 0;e.currentStencilProperties.push(e.model.newStencilProperty),e.clearPropertyValues()}},e.cancelPropertyEdit=function(){e.clearPropertyValues()},e.clearPropertyValues=function(){e.model.newStencilProperty=void 0,e.model.restoreProperties=void 0,e.model.restoreStencilProperty=void 0,e.model.activeStencilProperty=void 0};var t=function(t){var i=function(e){if(!e||0==e.length)return void 0;for(var i=0;e.length>i;i++){var o=e[i];if(o.tabs&&o.tabs.length>0)for(var n=0;o.tabs.length>n;n++){var r=o.tabs[n];if(r.stencilProperties&&r.stencilProperties.length>0)for(var a=0;r.stencilProperties.length>a;a++){var s=r.stencilProperties[a];if(s.id===t)return s}}}};return t?i(e.currentStencilItems):!0},i=function(t){for(var i=e.currentStencilProperties,o=0;i.length>o;o++)if(i[o].id===t.id)return o;return void 0};e.canMoveProperty=function(t){var o=e.model.activeStencilProperty;if(o){var n=i(o);return"up"===t?n>0:e.currentStencilProperties.length-1>n}return!1},e.moveProperty=function(t){var o=e.model.activeStencilProperty;if(o){var n=i(o);if(null!==n&&void 0!==n&&n>=0){var r=e.currentStencilProperties;"up"===t?(r[n]=r[n-1],r[n-1]=o):(r[n]=r[n+1],r[n+1]=o),e.currentStencilProperties=r}}},e.notRemovableProperties=["id","name","description"],e.canDeleteProperty=function(){return e.model.activeStencilProperty?"general"!=e.activeTab.id?!0:e.notRemovableProperties.indexOf(e.model.activeStencilProperty.id)>=0?!1:!0:!1},e.deleteProperty=function(){var t=e.currentStencilProperties.indexOf(e.model.activeStencilProperty);e.currentStencilProperties.splice(t,1),e.model.activeStencilProperty=void 0},e.close=function(){e.model.activeStencilProperty=void 0,e.model.newStencilProperty=void 0,e.$hide()},e.tabClicked(e.activeTab)}]),angular.module("activitiModeler").controller("CreateNewStencilCrtl",["$rootScope","$scope","$http","$location","EventTrackingService",function(e,t,i,o,n){t.status={loading:!1},t.model={stencil:{name:"",description:"",stencilType:1}},t.ok=function(){t.model.stencil.name&&0!=t.model.stencil.name.length&&(t.status.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets",data:t.model.stencil}).success(function(e){o.path("/stencils/"+e.id),1===t.model.stencil.stencilType||"1"===t.model.stencil.stencilType?n.trackEvent("editor","stencil-bpmn-created"):(2===t.model.stencil.stencilType||"2"===t.model.stencil.stencilType)&&n.trackEvent("editor","stencil-step-created"),t.$hide(),t.status.loading=!1}).error(function(){t.status.loading=!1,t.$hide()}))},t.cancel=function(){t.status.loading||t.$hide()}}]),angular.module("activitiModeler").controller("StencilDetailsEditCtrl",["$rootScope","$scope","$http","$translate",function(e,t,i,o){t.ok=function(){if(t.model.stencil.name&&0!=t.model.stencil.name.length){t.model.loading=!0;var e={name:t.model.stencil.name,description:t.model.stencil.description};i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+t.model.stencil.id,data:e}).success(function(){t.model.loading=!1,t.addAlertPromise(o("STENCIL.ALERT.UPDATE-CONFIRM"),"info"),t.$hide()}).error(function(){t.model.loading=!1,t.$hide()})}},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("StencilDeleteCtrl",["$rootScope","$scope","$location","$translate","StencilService",function(e,t,i,o,n){t.deleteModel={},n.fetchStencilUsageCount(t.model.stencil.id).then(function(e){t.deleteModel.stencilCount=e.count}),t.ok=function(){n.deleteStencil(t.model.stencil.id).then(function(){t.addAlertPromise(o("STENCIL.ALERT.DELETE-CONFIRM"),"info"),i.path("/stencils")}),t.$hide()},t.cancel=function(){t.$hide()}}]),angular.module("activitiModeler").controller("RestoreStencilItemCtrl",["$rootScope","$scope","UtilityService",function(e,t,i){t.model.stencilItemsToRestore=[],t.isSelectedStencilItem=function(e){return t.model.stencilItemsToRestore.indexOf(e)>=0},t.selectStencilItem=function(e){t.isSelectedStencilItem(e)?t.model.stencilItemsToRestore.splice(t.model.stencilItemsToRestore.indexOf(e),1):t.model.stencilItemsToRestore.push(e)},t.ok=function(){for(var o=0;t.model.stencilItemsToRestore.length>o;o++){var n=t.model.stencilItemsToRestore[o];n.removed=!1,delete n.group;var r=t.model.removedStencilItems.indexOf(n);t.model.removedStencilItems.splice(r,1),e.currentStencilItems.push(n)}t.clearSelection();var a=e.currentStencilItems[e.currentStencilItems.length-1];t.showItemDetails(a),i.scrollToElement("stencil_item_"+a.id),t.$hide()},t.cancel=function(){t.status.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ChangeStencilItemIconCtrl",["$rootScope","$scope","Upload",function(e,t,i){t.popup={loading:!1},t.onFileSelect=function(e,o){for(var n=0;e.length>n;n++){var r,a=e[n];r=o?ACTIVITI.CONFIG.contextRoot+"/app/rest/images/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/images",i.upload({url:r,method:"POST",file:a}).progress(function(e){t.popup.loading=!0,t.popup.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(e){t.popup.loading=!1,t.model.activeStencilItem.customIconId=e.id,t.$hide()}).error(function(e){e&&e.message&&(t.popup.errorMessage=e.message),t.popup.error=!0,t.popup.loading=!1})}},t.cancel=function(){t.popup.loading||t.$hide()}}]),angular.module("activitiModeler").controller("SaveStencilCtrl",["$rootScope","$scope","$route","$location","$translate","StencilService",function(e,t,i,o,n,r){t.saveAndClose=function(){t.save(!0)},t.save=function(a){t.status.loading=!0;for(var s=[],l=0;e.currentStencilItems.length>l;l++){var d=e.currentStencilItems[l];if(d.items&&d.items.length>0)for(var c=0;d.items.length>c;c++)d.items[c].isNewItem&&s.push(d.items[c]);else d.isNewItem&&s.push(d)}for(var l=0;s.length>l;l++)e.currentStencil.stencilItems.push(s[l]);r.saveStencil(e.currentStencil,e.currentStencilItems).then(function(){t.model.dirty=!1,t.status.loading=!1,e.ignoreChanges=!0,t.$hide(),t.addAlertPromise(n("STENCIL.ALERT.SAVE-CONFIRM"),"info"),a?o.path("/stencils"):i.reload()})},t.cancel=function(){t.status.loading||t.$hide()}}]),angular.module("activitiModeler").controller("StencilEditorController",["$rootScope","$scope","$q","$translate","$http","$timeout","$location","$modal","$route","$routeParams","StencilService","UtilityService",function(e,t,i,o,n,r,a,s,l,d,c,p){e.account&&e.account.type&&"enterprise"!=e.account.type&&a.url("/processes"),e.setMainPageById("stencils"),e.ignoreStencilChanges=!1,t.status={loading:!0},t.model={expandedGroups:[],scriptFiles:[],executionListeners:[],variables:[],fieldExtensions:[]},t.BPMN_PROCESS_STENCIL=1,t.STEP_PROCESS_STENCIL=2,t.FORM_STENCIL=3,t.collapseGroup=function(e){var i=t.model.expandedGroups.indexOf(e);i>=0&&t.model.expandedGroups.splice(i,1)},t.expandGroup=function(e){var i=t.model.expandedGroups.indexOf(e);0>i&&t.model.expandedGroups.push(e)},t.isGroupExpanded=function(e){return t.model.expandedGroups.indexOf(e)>=0},t.toggleGroupCollapseState=function(e){var i=t.model.expandedGroups.indexOf(e);i>=0?t.collapseGroup(e):t.expandGroup(e)},t.addNewGroup=function(){o("STENCILS.NEW-GROUP-NAME").then(function(i){for(var o=i,n=1;void 0!==c.findIndexOfGroup(o,e.currentStencilItems);)o=i+n++;var r={name:o,id:t.model.groupCounter++,type:"group",items:[]};e.currentStencilItems.push(r),t.showGroupDetails(r),p.scrollToElement("group_"+r.id)})},t.addNewItem=function(){o("STENCILS.NEW-ITEM-NAME").then(function(i){var o={isNewItem:!0,name:i,removed:!1};if(3!==e.currentStencil.stencilType&&(o.customStencilItem={backgroundColor:"#f9f9f9",className:void 0,expression:void 0,delegateExpression:void 0}),o.id=c.generateUniqueStencilItemId(e.currentStencilItems,o),1===e.currentStencil.stencilType){o.itemType="BpmnStencilItemDefinition",o.type="node";var n=["overrideid","name","documentation","asynchronousdefinition","exclusivedefinition","executionlisteners","multiinstance_type","multiinstance_cardinality","multiinstance_collection","multiinstance_variable","multiinstance_condition","isforcompensation","servicetaskresultvariable"],r=c.findStencilItemWithIdInCollection(e.currentStencilItems,"ServiceTask");if(r){o.stencilProperties=[];for(var a=0;r.stencilProperties.length>a;a++){var s=r.stencilProperties[a];n.indexOf(s.id)>0&&o.stencilProperties.push(JSON.parse(JSON.stringify(s)))}}}else if(2===e.currentStencil.stencilType){o.itemType="StepStencilItemDefinition",o.template="views/process-builder/custom-step-template.html";var l=[];o.tabs=l;var d={id:"details",name:"Details",stencilProperties:[{id:"name",name:"Name",type:"text",placeholder:"Enter a name"},{id:"description",name:"Description",type:"multiline text",placeholder:"Enter a description"}]};o.tabs.push(d)}else if(3===e.currentStencil.stencilType){o.itemType="FormStencilItemDefinition",o.template="",o.width=1,o.customFormField=!0;var l=[];o.tabs=l;var d={id:"general",name:"FORM-BUILDER.TABS.GENERAL",stencilProperties:[{id:"label",name:"FORM-BUILDER.COMPONENT.LABEL",type:"label"},{id:"id",name:"FORM-BUILDER.COMPONENT.ID",type:"id"},{id:"required",name:"FORM-BUILDER.COMPONENT.REQUIRED",type:"required"}]};o.tabs.push(d);var u={id:"visibility",name:"FORM-BUILDER.TABS.VISIBILITY",stencilProperties:[{id:"visibility",name:"FORM-BUILDER.TABS.VISIBILITY",type:"visibility",hideLabel:!0}]};o.tabs.push(u)}e.currentStencilItems.push(o),t.showItemDetails(o),p.scrollToElement("stencil_item_"+o.id)})},t.restoreItem=function(){_internalCreateModal({scope:t,template:"views/popup/stencil-item-restore.html"},s,t)},t.clearGroupSelection=function(){if(delete t.model.activeGroup,e.currentStencilItems)for(var i=0;e.currentStencilItems.length>i;i++)e.currentStencilItems[i].selected&&(e.currentStencilItems[i].selected=!1)},t.clearItemSelection=function(){delete t.model.activeStencilItem},t.clearSelection=function(){t.clearGroupSelection(),t.clearItemSelection()},t.showGroupDetails=function(e){t.expandGroup(e),t.clearSelection(),t.model.activeGroup=e},t.showItemDetails=function(e){t.clearSelection(),t.model.activeStencilItem=e,t.$broadcast("event:selectedItemChanged"),!t.model.activeStencilItem.customStencilItem||t.model.activeStencilItem.customStencilItem.customType&&0!=t.model.activeStencilItem.customStencilItem.customType.length||(t.model.activeStencilItem.customStencilItem.customType="Service task"),t.model.executionListeners.length=0,t.model.activeStencilItem.customStencilItem&&t.model.activeStencilItem.customStencilItem.executionListeners&&t.model.activeStencilItem.customStencilItem.executionListeners.length>0&&Array.prototype.push.apply(t.model.executionListeners,t.model.activeStencilItem.customStencilItem.executionListeners),t.model.variables.length=0,t.model.activeStencilItem.customStencilItem&&t.model.activeStencilItem.customStencilItem.variables&&t.model.activeStencilItem.customStencilItem.variables.length>0&&Array.prototype.push.apply(t.model.variables,t.model.activeStencilItem.customStencilItem.variables),t.model.scriptFiles.length=0,t.model.activeStencilItem.scriptFiles&&t.model.activeStencilItem.scriptFiles.length>0&&Array.prototype.push.apply(t.model.scriptFiles,t.model.activeStencilItem.scriptFiles)},t.loadStencil=function(i){var n=function(){t.status.loading=!0,t.stencilDataWatch&&t.stencilDataWatch(),t.stencilItemWatch&&t.stencilItemWatch(),c.fetchStencilDetails(i).then(function(i){e.currentStencilItems=c.processStencilItemsFromServer(i),t.model.removedStencilItems=i.removedStencilItems,e.currentStencil=i;var o=!0;t.stencilDataWatch=t.$watch("currentStencil",function(){o?r(function(){o=!1}):t.model.dirty=!0},!0);var n=!0;t.stencilItemWatch=t.$watch("currentStencilItems",function(){n?r(function(){n=!1}):t.model.dirty=!0},!0),t.status.loading=!1},function(){e.addAlertPromise(o("STENCIL-MODEL.MESSAGE.NOT-FOUND"),"error"),a.path("/stencils/")})};if(!e.ignoreStencilChanges&&e.currentStencilItems&&e.currentStencilItems.length>0&&t.model.dirty){var s=function(e){t.unsavedStencilChangesModalInstance=void 0,e&&n()};t.confirmNavigation(s)}else n()},t.$on("$locationChangeStart",function(i,o){var n=function(i){t.unsavedStencilChangesModalInstance=void 0,i?(e.ignoreStencilChanges=!0,a.url(o.substring(o.indexOf("/#")+2))):(e.ignoreStencilChanges=!1,e.setMainPageById("stencils"))};t.confirmNavigation(n,i)}),t.confirmNavigation=function(i,o){!e.ignoreStencilChanges&&e.currentStencilItems&&e.currentStencilItems.length>0&&t.model.dirty&&(o&&o.preventDefault(),e.setMainPageById("stencils"),t.handleResponseFunction=i,t.unsavedStencilChangesModalInstance=_internalCreateModal({template:"editor-app/popups/unsaved-changes.html",scope:t},s,t))},t.loadStencil(d.stencilId)}]),angular.module("activitiModeler").controller("StencilToolbarController",["$scope","$http","$modal","$q","$rootScope","$translate","$location",function(e,t,i,o,n,r,a){var s=STENCIL_TOOLBAR_CONFIG.items;e.items=[];for(var l=0;s.length>l;l++)e.items.push(s[l]);e.secondaryItems=STENCIL_TOOLBAR_CONFIG.secondaryItems;var d=function(e,t){for(var i=Array.prototype.slice.call(arguments).splice(2),o=e.split("."),n=o.pop(),r=0;o.length>r;r++)t=t[o[r]];return t[n].apply(this,i)};e.toolbarButtonClicked=function(a){var s=e.items[a],l={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r};d(s.action,window,l)},e.toolbarSecondaryButtonClicked=function(s){var l=e.secondaryItems[s],c={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,$location:a};d(l.action,window,c)}}]);var STENCIL_TOOLBAR={ACTIONS:{saveStencil:function(e){e.$translate("STENCILS.POPUP.SAVE-STENCIL-INITIAL-SAVE").then(function(t){null===e.$rootScope.currentStencil.version||void 0===e.$rootScope.currentStencil.version||1===e.$rootScope.currentStencil.version?e.$rootScope.currentStencil.comment=t:delete e.$rootScope.currentStencil.comment,_internalCreateModal({backdrop:!0,keyboard:!0,scope:e.$scope,template:"views/popup/stencil-save.html?version="+Date.now()},e.$modal,e.$scope)})},help:function(){},feedback:function(){},closeEditor:function(e){e.$location.path("/stencils")}}},STENCIL_TOOLBAR_CONFIG={items:[{type:"button",title:"STENCIL_TOOLBAR.ACTION.SAVE",cssClass:"editor-icon editor-icon-save",action:"STENCIL_TOOLBAR.ACTIONS.saveStencil",disableOnReadonly:!0}],secondaryItems:[{type:"button",title:"Close",cssClass:"glyphicon glyphicon-remove",action:"STENCIL_TOOLBAR.ACTIONS.closeEditor"}]};angular.module("activitiModeler").service("DecisionTableService",["$rootScope","$http","$q","$timeout","$translate","ProcessScopeService","ThumbnailService",function(e,t,i,o,n,r,a){function s(e){delete e.isEmbeddedTable;var t=(e.inputExpressions||[]).concat(e.outputExpressions||[]);e.rules&&e.rules.length>0&&e.rules.forEach(function(e){var i=[];t.forEach(function(e){i.push(e.id)}),i.forEach(function(t){e.hasOwnProperty(t)||(e[t]="")}),delete e.$$hashKey;for(var o in e)-1===i.indexOf(o)&&(delete e[o],delete e.validationErrorMessages)})}var l=function(e){var o=i.defer();return t(e).success(function(e){e.isEmbeddedTable=e.referenceId?!0:!1,o.resolve(e)}).error(function(e){console.log("Something went wrong during http call:"+e),o.reject(e)}),o.promise};this.filterDecisionTables=function(t){return l({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/decision-table-models",params:{filter:t,referenceId:e.currentKickstartModel.definition.id}})},this.fetchDecisionTableDetails=function(e,t){var i=ACTIVITI.CONFIG.contextRoot+"/app/rest/decision-table-models/";return i+=t?"history/"+encodeURIComponent(t):encodeURIComponent(e),l({method:"GET",url:i})},this.saveDecisionTable=function(i,o,n,r){i.decisionTableRepresentation={name:o},r&&r.length>0&&(i.decisionTableRepresentation.description=r);var l=angular.copy(e.currentDecisionTable);return i.decisionTableRepresentation.decisionTableDefinition=l,l.key=n,l.rules=e.currentDecisionTableRules,s(l),delete l.referenceId,a.generateThumbnail("decisionTableGrid").then(function(o){return i.decisionTableImageBase64=o,delete Array.prototype.toJSON,t({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/decision-table-models/"+e.currentDecisionTable.id,data:i})})},this.validateDecisionTable=function(i){var o=angular.copy(e.currentDecisionTable),a={decisionTableRepresentation:{decisionTableDefinition:o},processScopeIdentifiers:r.getIdentifiers()};delete o.referenceId,a.decisionTableRepresentation.decisionTableDefinition.rules=e.currentDecisionTableRules,s(a.decisionTableRepresentation.decisionTableDefinition),delete Array.prototype.toJSON,t({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/decision-table-models/"+e.currentDecisionTable.id+"/validate",data:a}).success(function(t){t&&t.length>0?(e.currentDecisionTableValidationErrors=t,e.addAlertPromise(n("DECISION-TABLE-EDITOR.ALERT.VALIDATION-ERROR"),"error")):(e.currentDecisionTableValidationErrors=null,e.addAlertPromise(n("DECISION-TABLE-EDITOR.ALERT.VALIDATION-OK"),"info")),i&&i(t)})},this.getDecisionTables=function(e,i){if(e.length>0){for(var o="",n=0;e.length>n;n++)o.length>0&&(o+="&"),o+="decisionTableId="+e[n];o.length>0&&(o+="&"),o+="version="+Date.now(),t({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/decision-table-models/values?"+o}).success(function(e){i&&i(e)}).error(function(e){console.log("Something went wrong when fetching decision table(s):"+JSON.stringify(e))})}else i&&i()}}]),angular.module("activitiModeler").controller("DecisionTableDetailsCtrl",["$rootScope","$scope","$translate","$http","$location","$routeParams","$modal","$timeout","$popover","DecisionTableService","uiGridConstants","ProcessScopeService",function(e,t,i,o,n,r,a,s,l,d,c){var p=200;t.decisionTableMode="read",t.model={latestModelId:r.modelId,columnDefs:[],columnVariableIdMap:{}},e.currentDecisionTableRules=[];var u=i.instant("DECISION-TABLE-EDITOR.EMPTY-MESSAGES.NO-VARIABLE-SELECTED");t.getVariableNameByColumnId=function(e){return e?t.model.columnVariableIdMap[e]?t.model.columnVariableIdMap[e]:u:void 0},t.loadDecisionTable=function(){var n,a;r.modelHistoryId?(n=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+r.modelId+"/history/"+r.modelHistoryId,a=ACTIVITI.CONFIG.contextRoot+"/app/rest/decision-table-models/history/"+r.modelHistoryId):(n=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+r.modelId,a=ACTIVITI.CONFIG.contextRoot+"/app/rest/decision-table-models/"+r.modelId),o({method:"GET",url:n}).success(function(e){t.model.decisionTable=e,t.model.decisionTableDownloadUrl=a+"/export?version="+Date.now(),t.loadComments(),t.loadVersions()}).error(function(){e.addAlertPromise(i("DECISION-TABLE-DEFINITION.MESSAGE.NOT-FOUND"),"error"),t.returnToList()})},t.useAsNewVersion=function(){_internalCreateModal({template:"views/popup/model-use-as-new-version.html",scope:t},a,t)},t.toggleFavorite=function(){t.model.favoritePending=!0;var e={favorite:!t.model.decisionTable.favorite};o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId,data:e}).success(function(){t.model.favoritePending=!1,t.model.decisionTable.favorite?t.addAlertPromise(i("DECISION-TABLE.ALERT.UN-FAVORITE-CONFIRM"),"info"):t.addAlertPromise(i("DECISION-TABLE.ALERT.FAVORITE-CONFIRM"),"info"),t.model.decisionTable.favorite=!t.model.decisionTable.favorite}).error(function(){t.model.favoritePending=!1})},t.loadVersions=function(){var e={includeLatestVersion:!t.model.decisionTable.latestVersion};o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId+"/history",params:e}).success(function(e){t.model.decisionTable.latestVersion&&(e.data||(e.data=[]),e.data.unshift(t.model.decisionTable)),t.model.versions=e})},t.showVersion=function(e){e&&(e.latestVersion?n.path("/decision-tables/"+t.model.latestModelId):n.path("/decision-tables/"+t.model.latestModelId+"/history/"+e.id))},t.returnToList=function(){n.path("/decision-tables/")},t.editDecisionTable=function(){_internalCreateModal({template:"views/popup/model-edit.html",scope:t},a,t)},t.duplicateDecisionTable=function(){var e=_internalCreateModal({template:"views/popup/decision-table-duplicate.html?version="+Date.now()},a,t);e.$scope.originalModel=t.model,e.$scope.duplicateDecisionTableCallback=function(e){n.url("/decision-table-editor/"+encodeURIComponent(e.id))}},t.deleteDecisionTable=function(){_internalCreateModal({template:"views/popup/model-delete.html",scope:t},a,t)},t.shareDecisionTable=function(){_internalCreateModal({template:"views/popup/model-share.html",scope:t},a,t)},t.openEditor=function(){t.model.decisionTable&&n.path("/decision-table-editor/"+t.model.decisionTable.id)},t.loadComments=function(){var e={latestFirst:!0};o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId+"/comments",params:e}).success(function(e){t.model.comments=e})},t.toggleComments=function(e){if(!t.commentsState){var i={};t.commentsState=i,i.popover=l(angular.element(e.target),{template:"views/popover/comments.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.commentsState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.toggleHistory=function(e){if(!t.historyState){var i={};t.historyState=i,i.popover=l(angular.element(e.target),{template:"views/popover/history.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.historyState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}};var m=function(i,o){d.fetchDecisionTableDetails(i,o).then(function(i){e.currentDecisionTable=i.decisionTableDefinition,e.currentDecisionTable.id=i.id,e.currentDecisionTable.name=i.name,e.currentDecisionTable.description=i.description,e.currentDecisionTable.inputExpressions&&e.currentDecisionTable.inputExpressions.forEach(function(e){t.model.columnVariableIdMap[e.id]=e.variableId}),e.currentDecisionTable.outputExpressions&&e.currentDecisionTable.outputExpressions.forEach(function(e){t.model.columnVariableIdMap[e.id]=e.variableId}),e.currentDecisionTable.rules&&e.currentDecisionTable.rules.length>0&&Array.prototype.push.apply(e.currentDecisionTableRules,e.currentDecisionTable.rules),t.getColumnDefinitions(e.currentDecisionTable)})},h=function(){return'<div role="columnheader" ui-grid-one-bind-aria-labelledby-grid="col.uid + \'-header-text \' + col.uid + \'-sortdir-text\'">   <div class="ui-grid-cell-contents ui-grid-header-cell-primary-focus" col-index="renderIndex" title="TOOLTIP">       <div class="text-center"><span>{{ col.displayName CUSTOM_FILTERS }}</span></div>       <div class="text-center"><span ui-grid-one-bind-id-grid="col.uid + \'-header-text\'" style="text-decoration: underline;">[ {{ grid.appScope.getVariableNameByColumnId(col.name) }} ]</span></div>   </div></div>'},f=function(){return'<div role="columnheader" ui-grid-one-bind-aria-labelledby-grid="col.uid + \'-header-text \' + col.uid + \'-sortdir-text\'">   <div class="ui-grid-cell-contents ui-grid-header-cell-primary-focus" col-index="renderIndex" title="TOOLTIP">       <div class="text-center"><span>{{ col.displayName CUSTOM_FILTERS }}</span></div>       <div class="text-center"><span ui-grid-one-bind-id-grid="col.uid + \'-header-text\'" style="text-decoration: underline;">[ {{ grid.appScope.getVariableNameByColumnId(col.name) }} ]</span></div>   </div></div>'},g=function(){return'<div class="ui-grid-disable-selection"><div class="ui-grid-cell-contents text-center customRowHeader">{{rowRenderIndex + 1}}</div></div>'},v=function(){var e='<div class="ui-grid-cell-contents" ng-class="{ \'ui-grid-cell-contents-empty\': !COL_FIELD }" title="TOOLTIP">   <span class="contents-value">{{COL_FIELD}}</span></div>';return e};t.getColumnDefinitions=function(e){if(e){var i=0,o=[];e.inputExpressions&&e.inputExpressions.length>0&&e.inputExpressions.forEach(function(e){o.push({name:e.id,displayName:e.label?e.label:"",field:e.id,type:"string",headerCellClass:"header-expression header-input-expression",headerCellTemplate:h(),cellClass:"cell-expression cell-input-expression",cellTemplate:v(),enableHiding:!1,enableCellEditOnFocus:!1,minWidth:p}),i++}),e.outputExpressions&&e.outputExpressions.length>0&&e.outputExpressions.forEach(function(e){o.push({name:e.id,displayName:e.label?e.label:"",field:e.id,type:"string",headerCellTemplate:f(),headerCellClass:"header-expression header-output-expression",cellClass:"cell-expression cell-output-expression",cellTemplate:v(),enableHiding:!1,enableCellEditOnFocus:!1,minWidth:p}),i++}),t.model.columnDefs?t.model.columnDefs.length=0:t.model.columnDefs=[],Array.prototype.push.apply(t.model.columnDefs,o),t.gridApi.core.notifyDataChange(c.dataChange.ALL)}},t.gridOptions={data:e.currentDecisionTableRules,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:2,enableColumnMenus:!1,enableSorting:!1,enableCellEditOnFocus:!1,columnDefs:t.model.columnDefs,headerTemplate:"views/templates/decision-table-header-template.html"},t.gridOptions.onRegisterApi=function(e){t.gridApi=e;var i=g();t.gridApi.core.addRowHeaderColumn({name:"rowHeaderCol",displayName:"",width:35,cellTemplate:i}),m(r.modelId,r.modelHistoryId)},t.loadDecisionTable()}]),angular.module("activitiModeler").controller("DecisionTablesController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal",function(e,t,i,o,n,r,a){t.hasAccessKickstartCapability()||t.backToLanding(),e.decisionTableItems=void 0,t.imageVersion=Date.now(),t.model={filters:[{id:"myReusableDecisionTables",labelKey:"MY-REUSABLE-DECISION-TABLES"},{id:"sharedWithMe",labelKey:"SHARED-WITH-ME"},{id:"sharedWithOthers",labelKey:"SHARED-WITH-OTHERS"},{id:"favorite",labelKey:"FAVORITES"}],sorts:[{id:"modifiedDesc",labelKey:"MODIFIED-DESC"},{id:"modifiedAsc",labelKey:"MODIFIED-ASC"},{id:"nameAsc",labelKey:"NAME-ASC"},{id:"nameDesc",labelKey:"NAME-DESC"}]},t.hasAccessAllModelsInTenantCapability()&&t.model.filters.push({id:"everyone",labelKey:"EVERYONE"}),e.decisionTableFilter?(t.model.activeFilter=e.decisionTableFilter.filter,t.model.activeSort=e.decisionTableFilter.sort,t.model.filterText=e.decisionTableFilter.filterText,t.model.pendingFilterText=t.model.filterText):(t.model.activeFilter=t.model.filters[0],t.model.activeSort=t.model.sorts[0],e.decisionTableFilter={filter:t.model.activeFilter,sort:t.model.activeSort,filterText:""}),t.activateFilter=function(i){t.model.activeFilter=i,e.decisionTableFilter.filter=i,t.loadDecisionTables()},t.activateSort=function(i){t.model.activeSort=i,e.decisionTableFilter.sort=i,t.loadDecisionTables()},t.importDecisionTable=function(){_internalCreateModal({template:"views/popup/decision-table-import.html?version="+Date.now()},a,t)
},t.loadDecisionTables=function(){t.model.loading=!0;var e={filter:t.model.activeFilter.id,sort:t.model.activeSort.id,modelType:4};t.model.filterText&&""!=t.model.filterText&&(e.filterText=t.model.filterText),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",params:e}).success(function(e){t.model.decisionTables=e,t.model.loading=!1}).error(function(){t.model.loading=!1})};var s=function(){t.model.isFilterDelayed=!0,n(function(){t.model.isFilterDelayed=!1,t.model.isFilterUpdated?(t.model.isFilterUpdated=!1,s()):(t.model.filterText=t.model.pendingFilterText,e.decisionTableFilter.filterText=t.model.filterText,t.loadDecisionTables())},500)};t.filterDelayed=function(){t.model.isFilterDelayed?t.model.isFilterUpdated=!0:s()},t.createDecisionTable=function(){e.currentKickstartModel=void 0,e.currentDecisionTableModel=void 0,t.createDecisionTableCallback=function(e){r.url("/decision-table-editor/"+encodeURIComponent(e.id))},_internalCreateModal({template:"views/popup/decision-table-create.html?version="+Date.now(),scope:t},a,t)},t.showDecisionTableDetails=function(t){t&&(e.currentKickstartModel=void 0,r.url("/decision-tables/"+encodeURIComponent(t.id)))},t.editDecisionTableDetails=function(e){e&&r.url("/decision-table-editor/"+encodeURIComponent(e.id))},t.loadDecisionTables()}]),angular.module("activitiModeler").controller("CreateNewDecisionTableCtrl",["$rootScope","$scope","$http","EventTrackingService",function(e,t,i,o){t.model={loading:!1,decisionTable:{name:"",description:"",modelType:4}},e.currentKickstartModel&&e.currentKickstartModel.definition&&e.currentKickstartModel.definition.id&&(t.model.decisionTable.referenceId=e.currentKickstartModel.definition.id),t.ok=function(){t.model.decisionTable.name&&0!=t.model.decisionTable.name.length&&(t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",data:t.model.decisionTable}).success(function(e){t.$hide(),t.model.loading=!1,o.trackEvent("editor","decision-table-model-created"),t.createDecisionTableCallback&&(t.createDecisionTableCallback(e),t.createDecisionTableCallback=void 0)}).error(function(){t.model.loading=!1,t.$hide()}))},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("DuplicateDecisionTableCtrl",["$rootScope","$scope","$http","EventTrackingService",function(e,t,i,o){t.model={loading:!1,decisionTable:{id:"",name:"",description:"",modelType:null}},t.originalModel&&(t.model.decisionTable.name=t.originalModel.decisionTable.name,t.model.decisionTable.description=t.originalModel.decisionTable.description,t.model.decisionTable.modelType=t.originalModel.decisionTable.modelType,t.model.decisionTable.id=t.originalModel.decisionTable.id),t.ok=function(){t.model.decisionTable.name&&0!=t.model.decisionTable.name.length&&(t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.decisionTable.id+"/clone",data:t.model.decisionTable}).success(function(e){t.$hide(),t.model.loading=!1,o.trackEvent("editor","decision-table-model-created"),t.duplicateDecisionTableCallback&&(t.duplicateDecisionTableCallback(e),t.duplicateDecisionTableCallback=void 0)}).error(function(){t.model.loading=!1,t.$hide()}))},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ImportDecisionTableModelCrtl",["$rootScope","$scope","$http","Upload","$location","EventTrackingService",function(e,t,i,o,n,r){t.model={loading:!1},t.onFileSelect=function(e,i){for(var a=0;e.length>a;a++){var s,l=e[a];s=i?ACTIVITI.CONFIG.contextRoot+"/app/rest/decision-table-models/import-decision-table-text":ACTIVITI.CONFIG.contextRoot+"/app/rest/decision-table-models/import-decision-table",o.upload({url:s,method:"POST",file:l}).progress(function(e){t.model.loading=!0,t.model.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(e){t.model.loading=!1,r.trackEvent("editor","decision-table-import"),n.path("/decision-table-editor/"+e.id),t.$hide()}).error(function(e,i,o,n){e&&e.message&&(t.model.errorMessage=e.message,t.model.fileName=n.file.name),t.model.error=!0,t.model.loading=!1})}},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("DecisionTableEditorController",["$rootScope","$scope","$q","$translate","$http","$timeout","$location","$modal","$route","$routeParams","DecisionTableService","UtilityService","FormBuilderService","uiGridConstants","appResourceRoot","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r,a,s,l,d,c,p,u,m,h,f,g){function v(e){var t=[];return e.forEach(function(e){var i={id:e.processVariableName,name:e.processVariableName,type:e.processVariableType};t.push(i)}),t?t:[]}var S=200;f.init(null,{success:function(){t.availableFormFieldsForStep=f.getFormFields(),t.availableVariablesForStep=f.getVariables()}}),t.appResourceRoot=h,t.errorsById=void 0,e.currentDecisionTableValidationErrors&&(e.currentDecisionTableValidationErrors=void 0),e.$watch("currentDecisionTableValidationErrors",function(e,i){if(void 0!==e||void 0!==i){var o,n=null;if(e){n={};for(var r=0;e.length>r;r++){o=e[r];var a=null!==o.id?o.id:"";n[a]||(n[a]=[]),n[a].push(o)}}t.errorsById=n}}),e.account&&e.account.type&&"enterprise"!==e.account.type&&a.path("/processes"),t.status={loading:!0},t.model={columnDefs:[],columnVariableIdMap:{}},e.decisionTableChanges=!1,e.parentReferenceId=g.getCurrentProcessModelId();var I=["FIRST","ANY"];t.hitPolicies=[],I.forEach(function(e){t.hitPolicies.push({id:e,label:"DECISION-TABLE.HIT-POLICIES."+e})}),e.currentDecisionTableRules=[],t.availableVariableTypes=["string","number","boolean","date"];var O=0;t.$on("$locationChangeStart",function(i,o){var n=function(i){t.unsavedDecisionTableChangesModalInstance=void 0,i?(e.ignoreChanges=!0,a.url(o.substring(o.indexOf("/#")+2))):(e.ignoreChanges=!1,e.setMainPageById("decision-tables"))};t.confirmNavigation(n,i)}),t.confirmNavigation=function(i,o){!e.ignoreChanges&&e.decisionTableChanges?(o&&o.preventDefault(),t.handleResponseFunction=i,t.unsavedDecisionTableChangesModalInstance=_internalCreateModal({template:"editor-app/popups/unsaved-changes.html",scope:t},s,t)):e.ignoreChanges=!1},t.editInputExpression=function(e){if(e){t.model.selectedColumn=e;var i="views/popup/decision-table-edit-input-expression.html";t.currentDecisionTable.inputExpressions.forEach(function(i){i.id===e.name&&(t.model.selectedExpression=i)}),_internalCreateModal({template:i,scope:t},s,t)}},t.editOutputExpression=function(e){if(e){t.model.selectedColumn=e;var i="views/popup/decision-table-edit-output-expression.html";t.currentDecisionTable.outputExpressions.forEach(function(i){i.id===e.name&&(t.model.selectedExpression=i)}),_internalCreateModal({template:i,scope:t},s,t)}},t.addInputExpression=function(i,o){t.currentDecisionTable.inputExpressions||(t.currentDecisionTable.inputExpressions=[]);var n;n=i?{id:A(),label:i.label,variableId:i.variableId,type:i.type,variableType:i.variableType,newVariable:i.newVariable}:{id:A()},0===e.currentDecisionTableRules.length&&t.addRule(),e.currentDecisionTableRules.forEach(function(e){e[n.id]=""}),void 0!==o&&-1!==o?t.currentDecisionTable.inputExpressions.splice(o,0,n):t.currentDecisionTable.inputExpressions.push(n),t.model.columnVariableIdMap[n.id]=n.variableId,t.getColumnDefinitions(t.currentDecisionTable),t.gridApi.core.notifyDataChange(m.dataChange.COLUMN),void 0!==t.errorsById&&c.validateDecisionTable()},t.enableRemoveInputExpression=function(){return t.currentDecisionTable&&t.currentDecisionTable.inputExpressions&&t.currentDecisionTable.inputExpressions.length>1},t.removeInputExpression=function(i,o){if(i){e.currentDecisionTableRules.forEach(function(e){e.hasOwnProperty(i.name)&&delete e[i.name]}),delete t.model.columnVariableIdMap[i.name];for(var n=-1,r=0;t.currentDecisionTable.inputExpressions.length>r;r++)if(t.currentDecisionTable.inputExpressions[r].id===i.name){for(var a=0;t.currentDecisionTable.executionVariables.length>a;a++)if(t.currentDecisionTable.executionVariables[a].processVariableName===t.currentDecisionTable.inputExpressions[r].variableId&&t.currentDecisionTable.executionVariables[a].processVariableType===t.currentDecisionTable.inputExpressions[r].type){t.currentDecisionTable.executionVariables.splice(a,1);break}t.currentDecisionTable.inputExpressions.splice(r,1),n=r;break}return t.getColumnDefinitions(t.currentDecisionTable),void 0!==t.errorsById&&c.validateDecisionTable(),o&&o.stopPropagation(),n}},t.updateInputExpression=function(e,i){var o=t.removeInputExpression(e);t.addInputExpression(i,o)},t.addOutputExpression=function(i,o){t.currentDecisionTable.outputExpressions||(t.currentDecisionTable.outputExpressions=[]);var n;n=i?{id:A(),label:i.label,variableId:i.variableId,type:i.type,variableType:i.variableType,newVariable:i.newVariable}:{id:A()},0===e.currentDecisionTableRules.length&&t.addRule(),e.currentDecisionTableRules.forEach(function(e){e[n.id]=""}),void 0!==o&&-1!==o?t.currentDecisionTable.outputExpressions.splice(o,0,n):t.currentDecisionTable.outputExpressions.push(n),t.model.columnVariableIdMap[n.id]=n.variableId,t.getColumnDefinitions(t.currentDecisionTable),t.gridApi.core.notifyDataChange(m.dataChange.COLUMN),void 0!==t.errorsById&&c.validateDecisionTable()},t.enableRemoveOutputExpression=function(){return t.currentDecisionTable&&t.currentDecisionTable.outputExpressions&&t.currentDecisionTable.outputExpressions.length>1},t.removeOutputExpression=function(i,o){if(i){e.currentDecisionTableRules.forEach(function(e){e.hasOwnProperty(i.name)&&delete e[i.name]}),delete t.model.columnVariableIdMap[i.name];for(var n=-1,r=0;t.currentDecisionTable.outputExpressions.length>r;r++)if(t.currentDecisionTable.outputExpressions[r].id===i.name){t.currentDecisionTable.outputExpressions.splice(r,1),n=r;break}return t.getColumnDefinitions(t.currentDecisionTable),void 0!==t.errorsById&&c.validateDecisionTable(),o&&o.stopPropagation(),n}},t.addRule=function(){e.currentDecisionTableRules.push({})},t.enableRemoveRule=function(){return t.model.selectedRule&&e.currentDecisionTableRules.length>1},t.removeRule=function(){if(t.model.selectedRule){var i=e.currentDecisionTableRules.indexOf(t.model.selectedRule);i>-1&&e.currentDecisionTableRules.splice(i,1),t.model.selectedRule=void 0}},t.enableMoveUpwards=function(t){return t&&0!==e.currentDecisionTableRules.indexOf(t)},t.moveRuleUpwards=function(){var i=e.currentDecisionTableRules.indexOf(t.model.selectedRule);if(i>-1){var o=e.currentDecisionTableRules[i];e.currentDecisionTableRules.splice(i,1),e.currentDecisionTableRules.splice(i-1,0,o)}},t.enableMoveDownwards=function(t){return t&&e.currentDecisionTableRules.indexOf(t)!==e.currentDecisionTableRules.length-1},t.moveRuleDownwards=function(){var i=e.currentDecisionTableRules.indexOf(t.model.selectedRule);if(i>-1){var o=e.currentDecisionTableRules[i];e.currentDecisionTableRules.splice(i,1),e.currentDecisionTableRules.splice(i+1,0,o)}},t.hasErrorMessages=function(e,t,i){if(i){var o=null!==e?e+":"+t:t,n=i[o];return n&&n.length>0}return!1},t.showErrorMessage=function(e,i,n){if(t.errorsById){for(var r=null!==e?e+":"+i:i,a=t.errorsById[r],l=0;a.length>l;l++)a[l].defaultDescription=o.instant("DECISION-TABLE.VALIDATION."+a[l].problem.toUpperCase(),{reference:a[l].problemReference?a[l].problemReference:""});t.validationErrors=a,_internalCreateModal({backdrop:!0,keyboard:!0,template:"views/popup/decision-table-validation-errors.html?version="+Date.now(),scope:t},s,t),n&&n.stopPropagation()}},t.editRuleExpression=function(e,i,o){for(var n,r,a=i.name,l=t.currentDecisionTable.inputExpressions.concat(t.currentDecisionTable.outputExpressions),d=0,c=l.length;c>d;d++)if(r=l[d],r.id===a){n=r.type;break}t.model.currentRuleExpression={inputExpression:t.currentDecisionTable.inputExpressions.length>d,row:e,columnDisplayName:i.displayName||(r?r.variableId:""),columnId:a,columnType:n};var p="views/popup/decision-table-edit-rule-expression.html";_internalCreateModal({template:p,scope:t},s,t),o.stopPropagation()},t.convertVariableType=function(e){var t="string";if(!e||""!==e)switch(e){case"integer":t="number";break;case"number":t="number";break;case"date":t="date";break;case"boolean":t="boolean"}return t},t.convertFormfieldType=function(e){var t="string";if(!e||""!==e)switch(e){case"number":t="number";break;case"integer":t="number";break;case"amount":t="number";break;case"date":t="date";break;case"boolean":t="boolean"}return t},t.getVariableNameByColumnId=function(e){return e?t.model.columnVariableIdMap[e]?t.model.columnVariableIdMap[e]:o.instant("DECISION-TABLE-EDITOR.EMPTY-MESSAGES.NO-VARIABLE-SELECTED"):void 0};var b=function(i){c.fetchDecisionTableDetails(i).then(function(i){e.currentDecisionTable=i.decisionTableDefinition,e.currentDecisionTable.id=i.id,e.currentDecisionTable.key=i.decisionTableDefinition.key,e.currentDecisionTable.name=i.name,e.currentDecisionTable.description=i.description,e.currentDecisionTable.referenceId=i.referenceId,e.currentDecisionTable.isEmbeddedTable=i.isEmbeddedTable,e.currentDecisionTableModel={id:i.id,name:i.name,key:i.decisionTableDefinition.key,description:i.description},e.currentDecisionTable.hitIndicator||(e.currentDecisionTable.hitIndicator=I[0]),E(e.currentDecisionTable),r(function(){t.status.loading=!1,e.decisionTableChanges=!1},200)},function(){e.addAlertPromise(o("DECISION-TABLE-DEFINITION.MESSAGE.NOT-FOUND"),"error"),a.path("/decision-tables/")})},E=function(i){i.rules&&i.rules.length>0&&Array.prototype.push.apply(e.currentDecisionTableRules,i.rules),i.inputExpressions&&0!==i.inputExpressions.length?i.inputExpressions.forEach(function(e){t.model.columnVariableIdMap[e.id]=e.variableId;var i=0;try{i=parseInt(e.id)}catch(o){}i>O&&(O=i)}):t.addInputExpression(),i.outputExpressions&&0!==i.outputExpressions.length?i.outputExpressions.forEach(function(e){t.model.columnVariableIdMap[e.id]=e.variableId;var i=0;try{i=parseInt(e.id)}catch(o){}i>O&&(O=i)}):t.addOutputExpression(),t.getColumnDefinitions(i)},y=function(){return'<div role="columnheader" ng-class="{ \'sortable\': sortable }" ui-grid-one-bind-aria-labelledby-grid="col.uid + \'-header-text \' + col.uid + \'-sortdir-text\'">   <div role="button" tabindex="0" class="ui-grid-cell-contents ui-grid-header-cell-primary-focus" ng-class="{ \'ui-grid-cell-contents-has-error\': grid.appScope.hasErrorMessages(null, col.field, grid.appScope.errorsById) }"col-index="renderIndex" title="TOOLTIP" ng-click="grid.appScope.editInputExpression(col)">       <span tabindex="0" class="show-error-icon"  ng-click="grid.appScope.showErrorMessage(null, col.field, $event)"><img ng-src="{{ appResourceRoot + \'editor-app/images/bpmn-error.png\' }}"/></span>       <div class="text-center"><span>{{ col.displayName CUSTOM_FILTERS }}</span></div>       <div class="text-center"><span ui-grid-one-bind-id-grid="col.uid + \'-header-text\'" style="text-decoration: underline;cursor:pointer">[ {{ grid.appScope.getVariableNameByColumnId(col.name) }} ]</span></div>       <div tabindex="0" ng-show="grid.appScope.enableRemoveInputExpression()" class="ui-grid-column-menu-button" style="margin-right: 10px" ng-click="grid.appScope.removeInputExpression(col, $event)"><i class="glyphicon glyphicon-trash" style="font-size: 12px;"></i></div>   </div></div>'},R=function(){return'<div role="columnheader" ng-class="{ \'sortable\': sortable }" ui-grid-one-bind-aria-labelledby-grid="col.uid + \'-header-text \' + col.uid + \'-sortdir-text\'">   <div role="button" tabindex="0" class="ui-grid-cell-contents ui-grid-header-cell-primary-focus" ng-class="{ \'ui-grid-cell-contents-has-error\': grid.appScope.hasErrorMessages(null, col.field, grid.appScope.errorsById) }" col-index="renderIndex" title="TOOLTIP" ng-click="grid.appScope.editOutputExpression(col)">       <span tabindex="0" class="show-error-icon"  ng-click="grid.appScope.showErrorMessage(null, col.field, $event)"><img ng-src="{{ appResourceRoot + \'editor-app/images/bpmn-error.png\' }}"/></span>       <div class="text-center"><span>{{ col.displayName CUSTOM_FILTERS }}</span></div>       <div class="text-center"><span ui-grid-one-bind-id-grid="col.uid + \'-header-text\'" style="text-decoration: underline;cursor:pointer">[ {{ grid.appScope.getVariableNameByColumnId(col.name) }} ]</span></div>       <div tabindex="0" ng-show="grid.appScope.enableRemoveOutputExpression()" class="ui-grid-column-menu-button" style="margin-right: 10px" ng-click="grid.appScope.removeOutputExpression(col, $event)"><i class="glyphicon glyphicon-trash" style="font-size: 12px;"></i></div>   </div></div>'},T=function(){return'<div class="ui-grid-disable-selection"><div class="ui-grid-cell-contents text-center customRowHeader">{{rowRenderIndex + 1}}</div></div>'},C=function(e){var t,i='<div class="ui-grid-cell-contents" ng-class="{ \'ui-grid-cell-contents-empty\': !COL_FIELD, \'ui-grid-cell-contents-has-error\': grid.appScope.hasErrorMessages(rowRenderIndex, col.field, grid.appScope.errorsById) }" title="TOOLTIP">   <span class="show-error-icon" ng-click="grid.appScope.showErrorMessage(rowRenderIndex, col.field, $event)"><img ng-src="{{ appResourceRoot + \'editor-app/images/bpmn-error.png\' }}" /></span>   <span class="contents-value">{{COL_FIELD}}</span>   <span class="edit-icon" ng-click="grid.appScope.editRuleExpression(row.entity, col, $event)"><i class="glyphicon glyphicon-edit" style="cursor:pointer;font-size: 14px;margin-right: 4px"></i></span></div>';switch(e){case"date":t=i;break;case"number":t=i;break;case"boolean":t=i;break;case"string":t=i;break;default:t='<div class="ui-grid-cell-contents" title="TOOLTIP">{{COL_FIELD}}</div>'}return t};t.getColumnDefinitions=function(e){if(e){var i=0,o=[];e.inputExpressions&&e.inputExpressions.length>0&&e.inputExpressions.forEach(function(e){o.push({name:e.id,displayName:e.label?e.label:"",field:e.id,type:"string",headerCellClass:"header-expression header-input-expression",headerCellTemplate:y(),cellClass:"cell-expression cell-input-expression",cellTemplate:C(e.type),enableHiding:!1,enableCellEditOnFocus:!1,minWidth:S,cellEditableCondition:function(t){return t.grid.appScope.model.columnVariableIdMap[e.id]?!0:!1}}),i++}),e.outputExpressions&&e.outputExpressions.length>0&&e.outputExpressions.forEach(function(e){o.push({name:e.id,displayName:e.label?e.label:"",field:e.id,type:"string",headerCellTemplate:R(),headerCellClass:"header-expression header-output-expression",cellClass:"cell-expression cell-output-expression",cellTemplate:C(e.type),enableHiding:!1,enableCellEditOnFocus:!1,minWidth:S,cellEditableCondition:function(t){return t.grid.appScope.model.columnVariableIdMap[e.id]?!0:!1}}),i++}),t.model.columnDefs.length=0,Array.prototype.push.apply(t.model.columnDefs,o),t.gridApi.core.notifyDataChange(m.dataChange.ALL)}},t.gridOptions={data:e.currentDecisionTableRules,enableRowHeaderSelection:!0,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:2,enableColumnMenus:!0,enableSorting:!1,enableCellEditOnFocus:!0,columnDefs:t.model.columnDefs,headerTemplate:"views/templates/decision-table-header-template.html"},t.gridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?t.model.selectedRule=e.entity:delete t.model.selectedRule}),e.edit.on.afterCellEdit(t,function(e,i,o,n){void 0!==t.errorsById&&o!==n&&c.validateDecisionTable()});var i=T();t.gridApi.core.addRowHeaderColumn({name:"rowHeaderCol",displayName:"",width:35,cellTemplate:i})},b(d.modelId),t.changeDetector=function(){e.decisionTableChanges=!0},e.$watch("currentDecisionTable",t.changeDetector,!0),e.$watch("currentDecisionTableRules",t.changeDetector,!0);var A=function(){return O++,""+O};t.getSelectedVariable=function(e){if(t.availableFormFieldsForStep&&t.availableFormFieldsForStep.length>0)for(var i=0;t.availableFormFieldsForStep.length>i;i++)if(e===t.availableFormFieldsForStep[i].id)return[t.availableFormFieldsForStep[i],"formfield"];if(t.availableVariablesForStep&&t.availableVariablesForStep.length>0)for(var i=0;t.availableVariablesForStep.length>i;i++)if(e===t.availableVariablesForStep[i].processVariableName)return[{id:t.availableVariablesForStep[i].processVariableName,name:t.availableVariablesForStep[i].processVariableName,type:t.availableVariablesForStep[i].processVariableType},"variable"];return[{id:e,name:null,type:null},"value"]},t.getSelectedVariableModel=function(e){var i;return t.availableFormFieldsForStep.forEach(function(t){t.id===e&&(t.variableType="formfield",i=t)}),i||t.availableVariablesForStep.forEach(function(t){t.processVariableName===e&&(i={id:t.processVariableName,name:t.processVariableName,type:t.processVariableType,variableType:"variable"})}),i||t.currentDecisionTable.executionVariables.forEach(function(t){t.processVariableName===e&&(i={id:t.processVariableName,name:t.processVariableName,type:t.processVariableType,variableType:"variable"})}),i},t.isEmbeddedTable=function(){return e.currentDecisionTable.isEmbeddedTable},t.getVariablesAndTablesVariables=function(){var e=v(t.availableVariablesForStep),i=v(t.currentDecisionTable.executionVariables);return e.concat(i).uniq()}}]),angular.module("activitiModeler").controller("DecisionTableInputConditionEditorCtlr",["$rootScope","$scope",function(e,t){function i(){var e={processVariableName:t.popup.selectedExpressionVariable.id,processVariableType:t.model.selectedExpression.type};t.currentDecisionTable.executionVariables.indexOf(e)&&t.currentDecisionTable.executionVariables.push(e)}var o=t.model.selectedExpression.variableId,n="variable";t.popup={selectedExpressionNewVariable:t.model.selectedExpression.variableId||t.isEmbeddedTable()?!1:!0,selectedExpressionVariableType:t.model.selectedExpression.variableType?t.model.selectedExpression.variableType:n,selectedExpressionLabel:t.model.selectedExpression.label?t.model.selectedExpression.label:"",selectedExpressionVariable:o?t.getSelectedVariableModel(o):void 0},t.tableVariables=t.getVariablesAndTablesVariables(),t.save=function(){if(o!==t.popup.selectedExpressionVariable.id){"formfield"===t.popup.selectedExpressionVariableType?t.model.selectedExpression.type=t.convertFormfieldType(t.popup.selectedExpressionVariable.type):"variable"===t.popup.selectedExpressionVariableType&&(t.model.selectedExpression.type=t.convertVariableType(t.popup.selectedExpressionVariable.type));var e={label:t.popup.selectedExpressionLabel,variableId:t.popup.selectedExpressionVariable.id,type:t.model.selectedExpression.type,variableType:t.popup.selectedExpressionVariableType,newVariable:t.popup.selectedExpressionNewVariable};t.updateInputExpression(t.model.selectedColumn,e),t.popup.selectedExpressionNewVariable&&i()}else t.model.selectedColumn.displayName=t.popup.selectedExpressionLabel;t.close()},t.setExpressionVariableType=function(e){t.popup.selectedExpressionVariable=null,t.popup.selectedExpressionVariableType=e},t.setNewVariable=function(e){t.popup.selectedExpressionNewVariable=e,e&&t.setExpressionVariableType("variable")},t.close=function(){t.$hide()},t.cancel=function(){t.close()}}]),angular.module("activitiModeler").controller("DecisionTableConclusionEditorCtlr",["$rootScope","$scope","$q","$translate",function(e,t){if(t.popup={selectedExpressionVariableType:t.model.selectedExpression.variableType||"",selectedExpressionLabel:t.model.selectedExpression.label||"",selectedExpressionNewVariable:t.model.selectedExpression.newVariable===!0,selectedExpressionNewVariableType:t.availableVariableTypes[0]},t.popup.selectedExpressionNewVariable)t.popup.selectedExpressionNewVariableId=t.model.selectedExpression.variableId,t.popup.selectedExpressionNewVariableType=t.model.selectedExpression.type;else{var i=t.getSelectedVariable(t.model.selectedExpression.variableId);"value"!==i[1]?(t.popup.selectedExpressionVariable=i[0],t.popup.selectedExpressionVariableType=i[1]):(t.popup.selectedExpressionVariable=null,t.popup.selectedExpressionVariableType=null)}var o=angular.copy(t.model.selectedExpression.variableId),n=angular.copy(t.model.selectedExpressionNewVariableId),r=angular.copy(t.model.selectedExpressionNewVariableType);t.cancel=function(){t.close()},t.save=function(){if(t.popup.selectedExpressionNewVariable?(t.model.selectedExpression.variableId=t.popup.selectedExpressionNewVariableId,t.model.selectedExpression.type=t.popup.selectedExpressionNewVariableType,t.model.selectedExpression.variableType="variable"):"formfield"!==t.popup.selectedExpressionVariableType&&t.popup.selectedExpressionVariableType?"variable"===t.popup.selectedExpressionVariableType&&(t.model.selectedExpression.variableId=t.popup.selectedExpressionVariable.id,t.model.selectedExpression.type=t.convertVariableType(t.popup.selectedExpressionVariable.type),t.model.selectedExpression.variableType="variable"):(t.model.selectedExpression.variableId=t.popup.selectedExpressionVariable.id,t.model.selectedExpression.type=t.convertFormfieldType(t.popup.selectedExpressionVariable.type||"formfield"),t.model.selectedExpression.variableType="formfield"),t.model.selectedExpression.newVariable=t.popup.selectedExpressionNewVariable,t.model.selectedExpression.label=t.popup.selectedExpressionLabel,o!==t.model.selectedExpression.variableId||n!==t.model.selectedExpressionNewVariableId||r!==t.model.selectedExpressionNewVariableType){var e=t.removeOutputExpression(t.model.selectedColumn);t.addOutputExpression({label:t.model.selectedExpression.label,variableId:t.model.selectedExpression.variableId,type:t.model.selectedExpression.type,variableType:t.model.selectedExpression.variableType,newVariable:t.model.selectedExpression.newVariable},e)}else t.model.selectedColumn.displayName=t.model.selectedExpression.label;t.close()},t.close=function(){t.$hide()}}]),angular.module("activitiModeler").controller("DecisionTableRuleExpressionEditorCtlr",["$rootScope","$scope","$q","$translate","$filter","DecisionTableService",function(e,t,i,o,n,r){var a=t.model.currentRuleExpression.columnType,s=t.model.currentRuleExpression.inputExpression,l="yyyy-MM-dd",d="YYYY-MM-DD";t.invalidExpressionMessage=!1;var c={date:["==","!=",">","<","<=",">=","__isEmpty__","__isNotEmpty__"],number:["==","!=",">","<","<=",">=","__isEmpty__","__isNotEmpty__"],"boolean":["==","!=","__isEmpty__","__isNotEmpty__"],string:["==","!=",".startsWith",".endsWith",".contains","__isEmpty__","__isNotEmpty__"]};t.formFieldsByType={date:["date"],number:["integer","amount"],"boolean":["boolean"],string:["text","multi-line-text","dropdown","radio-buttons","typeahead"]},t.variablesByType={date:["date"],number:["integer","number"],"boolean":["boolean"],string:["string"]},t.additionalValueTypes={date:["date_execution"],number:[],"boolean":[],string:[]},t.availableOperatorsByType={},t.tableVariables=t.getVariablesAndTablesVariables();for(var p in c){var u=c[p],m=[];u.forEach(function(e){m.push({id:e,label:"DECISION-TABLE-EDITOR.OPERATOR."+p.toUpperCase()+"."+e})}),t.availableOperatorsByType[p]=m}t.getOperators=function(e){return t.availableOperatorsByType[e]},t.availableDateCalculations=[{key:"",label:"DECISION-TABLE-EDITOR.CALCULATION.DATE.NONE"},{key:"fn_addDate",label:"DECISION-TABLE-EDITOR.CALCULATION.DATE.ADD"},{key:"fn_subtractDate",label:"DECISION-TABLE-EDITOR.CALCULATION.DATE.SUBTRACT"}],t.availableNumberCalculations=[{key:"",label:"DECISION-TABLE-EDITOR.CALCULATION.NUMBER.NONE"},{key:"+",label:"DECISION-TABLE-EDITOR.CALCULATION.NUMBER.ADD"},{key:"-",label:"DECISION-TABLE-EDITOR.CALCULATION.NUMBER.SUBTRACT"},{key:"/",label:"DECISION-TABLE-EDITOR.CALCULATION.NUMBER.DIVIDE"},{key:"*",label:"DECISION-TABLE-EDITOR.CALCULATION.NUMBER.MULTIPLY"}],t.availableBooleanValues=[{id:"true",label:"true"},{id:"false",label:"false"}];var h={__isEmpty__:"== empty",__isNotEmpty__:"!= empty"};t.popup={value:{type:"value"},variable:{reference:null},formfield:{reference:null},selectedExpressionVariableType:"value",columnType:t.model.currentRuleExpression.columnType,inputExpression:s,selectedOperator:null,date:{type:"fixed",calculation:{method:null}},number:{type:"fixed","static":null,calculation:{method:null}},"boolean":{type:"fixed","static":null},string:{type:"fixed","static":""}};var f=function(e,t){if(!e.method||!e.method.key)return t;var i=e.method.key;return i+="(",i+=t,i+=",",i+=e.years?e.years:0,i+=",",i+=e.months?e.months:0,i+=",",i+=e.days?e.days:0,i+=")"},g=function(e,t){if(!e.method||!e.method.key)return t;var i="";return i+=t,i+=" "+e.method.key+" ",i+=e.param1?e.param1:0},v={1:"years",2:"months",3:"days"},S=function(e){var i=e.match(/^([a-zA-Z0-9_]+)\((.*)\)$/);if(i&&i.length>=2){var o=i[1];if("fn_date"===o&&3===i.length&&i[2]){t.popup.value.type="value";var n=i[2].replace(/"/g,"");t.popup.date.static=moment(n,d).toDate()}else"fn_now"===o&&(t.popup.value.type="date_execution")}else{var r=t.getSelectedVariable(e);t.popup.value.type=r[1],"value"!==r[1]&&(t.popup[r[1]].reference=r[0])}},I=function(e,t){if(t)for(var i=t.split(","),o=0;i.length>o&&4>o;o++)if(0===o)S(i[o].trim());else try{e[v[o]]=parseInt(i[o].trim())}catch(n){}},O=function(e){var i="";try{i=parseFloat(e)}catch(o){}if(isNaN(i)){var n=t.getSelectedVariable(e);"value"===n[1]?(t.invalidExpressionMessage=!0,t.popup.value.type=null):(t.popup.value.type=n[1],t.popup[n[1]].reference=n[0])}else t.popup.value.type="value",t.popup.date.type="fixed",t.popup.number.static=i},b=function(e,i){var o;if(e=e.trim()){if("date"===i){var n=e.match(/^([a-zA-Z0-9_]+)\((.*)\)$/);if(n&&n.length>=2){var r=n[1];if(t.availableDateCalculations.filter(function(e){return e.key===r}).length>0)return t.popup.date.calculation={method:{key:r}},n.length>2&&I(t.popup.date.calculation,n[2]),void 0}t.popup.date.calculation.method||(t.popup.date.calculation.method={key:""}),S(e)}else if("number"===i){var n=e.match(/^([a-zA-Z0-9_]+)\s*([^a-z^A-Z^0-9^_^\s]+)\s*([0-9\.]+)$/);if(n&&4===n.length){var a=n[2];if(t.availableNumberCalculations.filter(function(e){return e.key===a}).length>0){var l="";t.popup.number.calculation={method:{key:a}};try{l=parseFloat(n[3]),t.popup.number.calculation.param1=l}catch(d){t.invalidExpressionMessage=!0}return O(n[1]),void 0}}t.popup.number.calculation.method||(t.popup.number.calculation.method={key:""}),O(e)}else if("boolean"===i)"true"===e.toLowerCase()||"false"===e.toLowerCase()?(t.popup.value.type="value",t.popup.boolean.type="fixed",t.popup.boolean.static=e):(o=t.getSelectedVariable(e),t.popup.value.type=o[1],"value"!==o[1]&&(t.popup[o[1]].reference=o[0]));else if("string"===i){var n=e.match(/^'(.*)'$/);n?e=n.length>1?n[1]:"":(n=e.match(/^"(.*)"$/),n&&(e=n.length>1?n[1]:"")),n?(t.popup.value.type="value",t.popup.string.type="fixed",t.popup.string.static=e):(o=t.getSelectedVariable(e),t.popup.value.type=o[1],"value"!==o[1]&&(t.popup[o[1]].reference=o[0]))}}else s&&t.availableOperatorsByType[i]&&t.availableOperatorsByType[i].length&&(t.selectedOperator=t.availableOperatorsByType[i][0].id)},E=function(){var e=t.model.currentRuleExpression.row[t.model.currentRuleExpression.columnId]||"";if(e=e.trim(),""!==e)if(s)if(0===e.indexOf("==")||0===e.indexOf("!=")||0===e.indexOf(">=")||0===e.indexOf("<="))t.popup.selectedOperator=e.substring(0,2),e=e.substring(2),0===t.popup.selectedOperator.indexOf("==")&&0===e.trim().indexOf("empty")?t.popup.selectedOperator="__isEmpty__":0===t.popup.selectedOperator.indexOf("!=")&&0===e.trim().indexOf("empty")?t.popup.selectedOperator="__isNotEmpty__":b(e,a);else if(0===e.indexOf("<")||0===e.indexOf(">"))t.popup.selectedOperator=e.substring(0,1),e=e.substring(1),b(e,a);else{var i=e.match(/^(\.[a-zA-Z0-9_]+)\(([^\\]*)\)$/);i&&i.length>1?(t.popup.selectedOperator=i[1],t.popup.selectedOperator&&-1===c[a].indexOf(t.popup.selectedOperator)?t.invalidExpressionMessage=!0:b(i.length>2?i[2]:"",a)):t.invalidExpressionMessage=!0}else b(e,a);else s&&t.availableOperatorsByType[a]&&t.availableOperatorsByType[a].length&&(t.popup.selectedOperator=t.availableOperatorsByType[a][0].id)};E(),t.cancel=function(){t.close()};var y=function(e,t){return t&&t.length>1&&"."===t[0]?"("+(e||"")+")":t&&t.length?" "+(e||""):e},R=function(){var e="",i=t.popup.selectedOperator;if(i&&h[i])e=h[i];
else{s&&(e+=i);var o;"value"===t.popup.value.type?o=t.popup.date.static?'fn_date("'+n("date")(t.popup.date.static,l)+'")':"":"date_execution"===t.popup.value.type?o="fn_now()":t.popup[t.popup.value.type].reference&&(o=t.popup[t.popup.value.type].reference.id+""),e+=y(f(t.popup.date.calculation,o),i)}t.model.currentRuleExpression.row[t.model.currentRuleExpression.columnId]=e},T=function(){var e="",i=t.popup.selectedOperator;if(i&&h[i])e=h[i];else{s&&(e+=i);var o;if("value"===t.popup.value.type)try{o=parseFloat(t.popup.number.static)}catch(n){}else t.popup[t.popup.value.type].reference&&(o=t.popup[t.popup.value.type].reference.id+"");e+=y(g(t.popup.number.calculation,o),i)}t.model.currentRuleExpression.row[t.model.currentRuleExpression.columnId]=e},C=function(){var e="",i=t.popup.selectedOperator;i&&h[i]?e=h[i]:(s&&(e=i),"value"===t.popup.value.type?e+=y(t.popup.boolean.static+"",i):t.popup[t.popup.value.type].reference&&(e+=y(t.popup[t.popup.value.type].reference.id+"",i))),t.model.currentRuleExpression.row[t.model.currentRuleExpression.columnId]=e},A=function(){var e="",i=t.popup.selectedOperator;i&&h[i]?e=h[i]:(s&&(e=i),"value"===t.popup.value.type?e+=y('"'+t.popup.string.static+'"',i):t.popup[t.popup.value.type].reference&&(e+=y(t.popup[t.popup.value.type].reference.id+"",i))),t.model.currentRuleExpression.row[t.model.currentRuleExpression.columnId]=e};t.save=function(){if(s&&!t.popup.selectedOperator)t.model.currentRuleExpression.row[t.model.currentRuleExpression.columnId]="";else{var e=t.model.currentRuleExpression.columnType;"date"===e?R():"number"===e?T():"boolean"===e?C():"string"===e&&A()}t.close(),void 0!==t.errorsById&&r.validateDecisionTable()},t.close=function(){t.$hide()},t.closeDatePopup=function(){jQuery("#date").blur()},t.clearDate=function(){t.popup.date.static=void 0,jQuery("#date").blur()},t.selectToday=function(e,t){var i=new Date;i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),e=i,t&&t(e),jQuery("#date").blur()}}]),angular.module("activitiModeler").controller("ValidateDecisionTableModelCtrl",["$rootScope","$scope","$translate","$timeout",function(e,t,i){t.gridOptions={data:t.validationErrors,headerRowHeight:28,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"defaultDescription",displayName:i.instant("MODEL.VALIDATION.ERRORS.DESCRIPTION")},{field:"warning",displayName:i.instant("MODEL.VALIDATION.ERRORS.WARNING"),width:100},{field:"validatorSetName",displayName:i.instant("MODEL.VALIDATION.ERRORS.SET"),width:200}]},t.ok=function(){t.$hide()},t.close=function(){t.$hide()}}]),angular.module("activitiModeler").controller("DecisionTableToolbarController",["$scope","$http","$modal","$q","$rootScope","$translate","$location","DecisionTableService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l){var d=DECISION_TABLE_TOOLBAR_CONFIG.items;e.items=[];for(var c=0;d.length>c;c++)e.items.push(d[c]);e.secondaryItems=DECISION_TABLE_TOOLBAR_CONFIG.secondaryItems;var p=function(e,t){for(var i=Array.prototype.slice.call(arguments).splice(2),o=e.split("."),n=o.pop(),r=0;o.length>r;r++)t=t[o[r]];return t[n].apply(this,i)};e.toolbarButtonClicked=function(a){var d=e.items[a],c={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,DecisionTableService:s,ProcessScopeService:l};p(d.action,window,c)},e.toolbarSecondaryButtonClicked=function(d){var c=e.secondaryItems[d],u={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,$location:a,DecisionTableService:s,ProcessScopeService:l};p(c.action,window,u)}}]);var DECISION_TABLE_TOOLBAR={ACTIONS:{saveModel:function(e){_internalCreateModal({backdrop:!0,keyboard:!0,template:"views/popup/decision-table-save-model.html?version="+Date.now(),scope:e.$scope},e.$modal,e.$scope)},validateModel:function(e){e.DecisionTableService.validateDecisionTable()},help:function(){},feedback:function(){},closeEditor:function(e){var t=function(){e.$rootScope.decisiontableChanges=!1,e.ProcessScopeService.navigateBack("/decision-tables")};if(1==e.$rootScope.decisiontableChanges){e.$scope.$emit("decisionTableChangesEvent");var i=e.$scope.$on("mustSaveEvent",function(){var i="";e.$rootScope.currentDecisionTable.description&&(i=e.$rootScope.currentDecisionTable.description);var o={newVersion:!1};r(),e.DecisionTableBuilderService.saveDecisionTable(o,e.$rootScope.currentDecisionTable.name,null,i).then(t)}),o=e.$scope.$on("discardDataEvent",function(){r(),t()}),n=e.$scope.$on("continueEditingEvent",function(){r()})}else t();var r=function(){n(),i(),o()}}}};angular.module("activitiModeler").controller("SaveDecisionTableCtrl",["$rootScope","$scope","$http","$route","$location","$translate","DecisionTableService","ProcessScopeService","ModelService",function(e,t,i,o,n,r,a,s,l){var d="";e.currentDecisionTableModel.description&&(d=e.currentDecisionTableModel.description),t.saveDialog={name:e.currentDecisionTableModel.name,key:e.currentDecisionTableModel.key,description:d,reusable:!1,newVersion:!1,comment:"",embedded:e.parentReferenceId!==void 0&&e.currentDecisionTable.referenceId?!0:!1,hasEmbedContext:e.parentReferenceId!==void 0},t.keyFieldPattern=/^[a-zA-Z_]\w*$/,t.status={loading:!1};var c=function(e){e&&e.length>0&&(t.saveDialog.validationErrors=!0)};a.validateDecisionTable(c),t.cancel=function(){t.$hide()},t.saveAndClose=function(){t.save(function(){s.navigateBack("/decision-tables")})},t.save=function(i){if(t.saveDialog.name&&0!=t.saveDialog.name.length&&t.saveDialog.key&&0!=t.saveDialog.key.length){t.status={loading:!0};var o={reusable:t.saveDialog.reusable,newVersion:t.saveDialog.newVersion,comment:t.saveDialog.comment},n=function(){return t.saveDialog.embedded},s=function(){return n()?e.parentReferenceId:null},d=function(e){return e.length},c=function(){t.$hide(),e.currentDecisionTableModel.name=t.saveDialog.name,e.currentDecisionTableModel.key=t.saveDialog.key,e.currentDecisionTableModel.description=t.saveDialog.description,e.addAlertPromise(r("DECISION-TABLE-EDITOR.ALERT.SAVE-CONFIRM",{name:t.saveDialog.name}),"info"),i&&i(),e.decisionTableChanges=!1},p=function(){t.$hide(),e.addAlertPromise(r("DECISION-TABLE-EDITOR.ALERT.SAVE-ERROR",{name:t.saveDialog.name}),"error")};l.getModelParentRelations(e.currentDecisionTable.id).then(function(i){var r=e.currentDecisionTable,u={name:t.saveDialog.name,description:t.saveDialog.description,referenceId:s(),modelType:4};n()&&d(i)>1?l.cloneModel(r,u).then(function(i){t.oldProcessId=r.id,r.id=i.id,r.referenceId=+s(),l.updateFormReferencesInProcess(e.parentReferenceId,t.oldProcessId,r.id).then(function(){a.saveDecisionTable(o,t.saveDialog.name,t.saveDialog.key,t.saveDialog.description).then(c,p)},p)},p):l.saveModel(r,u,s()).then(function(){r.referenceId=+s(),a.saveDecisionTable(o,t.saveDialog.name,t.saveDialog.key,t.saveDialog.description).then(c,p)},p)},p)}},t.isOkButtonDisabled=function(){return t.status.loading?!1:t.error&&t.error.conflictResolveAction?"saveAs"===t.error.conflictResolveAction?!t.error.saveAs||0==t.error.saveAs.length:!1:!0},t.okClicked=function(){t.error&&("discardChanges"===t.error.conflictResolveAction?(t.close(),o.reload()):"overwrite"===t.error.conflictResolveAction||"newVersion"===t.error.conflictResolveAction?t.save():"saveAs"===t.error.conflictResolveAction&&t.save(function(){e.ignoreChanges=!0,s.navigateBack("/decision-tables")}))},t.embedClicked=function(){t.saveDialog.embedded?l.getModelParentRelations(e.currentDecisionTable.id).then(function(e){t.hasOtherRelations=e.length>1},function(){e.addAlert("An error occurred while trying to find the relations")}):t.hasOtherRelations=!1}}]);var DECISION_TABLE_TOOLBAR_CONFIG={items:[{type:"button",title:"DECISION_TABLE_TOOLBAR.ACTION.SAVE",cssClass:"editor-icon editor-icon-save",action:"DECISION_TABLE_TOOLBAR.ACTIONS.saveModel",disableOnReadonly:!0},{type:"button",title:"DECISION_TABLE_TOOLBAR.ACTION.VALIDATE",cssClass:"glyphicon glyphicon-ok",action:"DECISION_TABLE_TOOLBAR.ACTIONS.validateModel"}],secondaryItems:[{type:"button",title:"DECISION_TABLE_TOOLBAR.ACTION.CLOSE",cssClass:"glyphicon glyphicon-remove",action:"DECISION_TABLE_TOOLBAR.ACTIONS.closeEditor"}]};angular.module("activitiModeler").service("DataModelService",["$rootScope","$http","$q","$timeout","$translate",function(e,t,i,o,n){var r=function(e){var o=i.defer();return t(e).success(function(e){o.resolve(e)}).error(function(e){console.log("Something went wrong during http call:"+e),o.reject(e)}),o.promise};this.fetchDataModelDetails=function(e){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/"+e})},this.getDataModels=function(e){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models?referenceId="+e})},this.getDataModelEditorValues=function(e){if(e.length>0){for(var t="",i=0;e.length>i;i++)t.length>0&&(t+="&"),t+="dataModelId="+e[i];return t.length>0&&(t+="&"),t+="version="+Date.now(),r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/editor-values?"+t})}return void 0},this.getAllDataSources=function(){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/editor/data-sources"})},this.getAllAlfrescoRepositories=function(e,t){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco",params:{tenantId:e,includeAccounts:t}})},this.saveDataModel=function(i,o,n,r,a){i.dataModelRepresentation={name:o},n&&n.length>0&&(i.dataModelRepresentation.description=n),i.dataModelRepresentation.dataModelDefinition=angular.copy(e.currentDataModel),i.dataModelRepresentation.dataModelDefinition.entities=e.currentDataModelEntities,delete i.dataModelRepresentation.dataModelDefinition.description,delete Array.prototype.toJSON,t({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/"+e.currentDataModel.id,data:i}).success(function(){r&&r()}).error(function(){a&&a()})},this.getDataSourceEntities=function(e){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/databases/"+e+"/tables"})},this.getDataSourceAttributes=function(e,t){return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/databases/"+e+"/tables/"+t+"/attributes"})},this.validateDataModel=function(i){var o={dataModelRepresentation:{dataModelDefinition:angular.copy(e.currentDataModel)}};o.dataModelRepresentation.dataModelDefinition.entities=e.currentDataModelEntities,delete o.dataModelRepresentation.dataModelDefinition.description,delete Array.prototype.toJSON,t({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/"+e.currentDataModel.id+"/validate",data:o}).success(function(t){t&&t.length>0?(e.currentDataModelValidationErrors=t,e.addAlertPromise(n("DATA-MODEL.ALERT.VALIDATION-ERROR"),"error")):(e.currentDataModelValidationErrors=[],e.addAlertPromise(n("DATA-MODEL.ALERT.VALIDATION-OK"),"info")),i&&i(t)})}}]),angular.module("activitiModeler").controller("DataModelOverviewController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal",function(e,t,i,o,n,r,a){t.hasAccessKickstartCapability()||t.backToLanding(),t.model={filters:[{id:"myDataModels",labelKey:"MY-DATA-MODELS"},{id:"sharedWithMe",labelKey:"SHARED-WITH-ME"},{id:"sharedWithOthers",labelKey:"SHARED-WITH-OTHERS"},{id:"favorite",labelKey:"FAVORITES"}],sorts:[{id:"modifiedDesc",labelKey:"MODIFIED-DESC"},{id:"modifiedAsc",labelKey:"MODIFIED-ASC"},{id:"nameAsc",labelKey:"NAME-ASC"},{id:"nameDesc",labelKey:"NAME-DESC"}]},t.hasAccessAllModelsInTenantCapability()&&t.model.filters.push({id:"everyone",labelKey:"EVERYONE"}),e.dataModelFilter?(t.model.activeFilter=e.dataModelFilter.filter,t.model.activeSort=e.dataModelFilter.sort,t.model.filterText=e.dataModelFilter.filterText):(t.model.activeFilter=t.model.filters[0],t.model.activeSort=t.model.sorts[0],e.dataModelFilter={filter:t.model.activeFilter,sort:t.model.activeSort,filterText:""}),t.activateFilter=function(i){t.model.activeFilter=i,e.dataModelFilter.filter=i,t.loadDataModels()},t.activateSort=function(i){t.model.activeSort=i,e.dataModelFilter.sort=i,t.loadDataModels()},t.loadDataModels=function(){t.model.loading=!0;var e={filter:t.model.activeFilter.id,sort:t.model.activeSort.id,modelType:5};t.model.filterText&&""!=t.model.filterText&&(e.filterText=t.model.filterText),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",params:e}).success(function(e){t.model.dataModels=e,t.model.loading=!1}).error(function(){t.model.loading=!1})};var s=function(){t.model.isFilterDelayed=!0,n(function(){t.model.isFilterDelayed=!1,t.model.isFilterUpdated?(t.model.isFilterUpdated=!1,s()):(t.model.filterText=t.model.pendingFilterText,e.dataModelFilter.filterText=t.model.filterText,t.loadDataModels())},500)};t.filterDelayed=function(){t.model.isFilterDelayed?t.model.isFilterUpdated=!0:s()},t.createDataModel=function(){t.createDataModelCallback=function(e){r.url("/data-model-editor/"+encodeURIComponent(e.id))},_internalCreateModal({template:"views/popup/data-model-create.html?version="+Date.now(),scope:t},a,t)},t.importDataModel=function(){_internalCreateModal({template:"views/popup/data-model-import.html?version="+Date.now()},a,t)},t.showDataModelDetails=function(e){e&&r.path("/data-models/"+e.id)},t.editDataModelDetails=function(e){e&&r.path("/data-model-editor/"+e.id)},t.loadDataModels()}]),angular.module("activitiModeler").controller("CreateNewDataModelCtrl",["$rootScope","$scope","$http",function(e,t,i){t.model={loading:!1,dataModel:{name:"",description:"",modelType:5}},e.currentKickstartModel&&e.currentKickstartModel.definition&&e.currentKickstartModel.definition.id&&(t.model.dataModel.referenceId=e.currentKickstartModel.definition.id),t.ok=function(){t.model.dataModel.name&&0!=t.model.dataModel.name.length&&(t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",data:t.model.dataModel}).success(function(e){t.$hide(),t.model.loading=!1,t.createDataModelCallback&&(t.createDataModelCallback(e),t.createDataModelCallback=void 0)}).error(function(){t.model.loading=!1,t.$hide()}))},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ImportDataModelCtrl",["$rootScope","$scope","$http","Upload","$location",function(e,t,i,o,n){t.model={loading:!1},t.onFileSelect=function(e,i){for(var r=0;e.length>r;r++){var a,s=e[r];a=i?ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/import-data-model/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/import-data-model",o.upload({url:a,method:"POST",file:s}).progress(function(e){t.model.loading=!0,t.model.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(e){t.model.loading=!1,n.path("/data-models/"+e.id),t.$hide()}).error(function(e,i,o,n){e&&e.message&&(t.model.errorMessage=e.message,t.model.fileName=n.file.name),t.model.error=!0,t.model.loading=!1})}},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("ConfirmImportDataModelCtrl",["$rootScope","$scope",function(e,t){t.model={},t.ok=function(){t.confirmOverwriteCallback&&(t.confirmOverwriteCallback(),t.confirmOverwriteCallback=void 0),t.$hide()},t.skip=function(){t.confirmSkipCallback&&(t.confirmSkipCallback(),t.confirmSkipCallback=void 0),t.$hide()},t.cancel=function(){t.$hide()}}]),angular.module("activitiModeler").controller("DataModelDetailsController",["$rootScope","$scope","$q","$translate","$http","$timeout","$location","$modal","$popover","$routeParams","DataModelService",function(e,t,i,o,n,r,a,s,l,d,c){e.account&&e.account.type&&"enterprise"!=e.account.type&&a.path("/processes"),t.status={loading:!0},t.model={latestModelId:d.modelId,attributes:[],dataSources:[]},t.currentDataModelEntities=[];var p=function(){t.status.loading=!0,c.getAllDataSources().then(function(e){e&&e.data&&Array.prototype.push.apply(t.model.dataSources,e.data)});var i,r;d.modelHistoryId?(i=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+d.modelId+"/history/"+d.modelHistoryId,r=ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/history/"+d.modelHistoryId,t.model.dataModelDownloadUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/"+d.modelId+"/history/"+d.modelHistoryId+"/export?version="+Date.now()):(i=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+d.modelId,r=ACTIVITI.CONFIG.contextRoot+"/app/rest/data-models/"+d.modelId,t.model.dataModelDownloadUrl=r+"/export?version="+Date.now()),n({method:"GET",url:i}).success(function(e){t.model.dataModel=e,t.loadComments(),t.loadVersions()}).error(function(){e.addAlertPromise(o("DATA-MODEL-DEFINITION.MESSAGE.NOT-FOUND"),"error"),t.returnToList()}),n({method:"GET",url:r}).success(function(e){e&&e.dataModelDefinition&&(t.model.dataModelDefinition=e.dataModelDefinition,t.model.dataModelDefinition.entities&&t.model.dataModelDefinition.entities.length>0&&Array.prototype.push.apply(t.currentDataModelEntities,t.model.dataModelDefinition.entities))}).error(function(){e.addAlertPromise(o("DATA-MODEL-DEFINITION.MESSAGE.NOT-FOUND"),"error"),t.returnToList()})};t.entityGridOptions={data:t.currentDataModelEntities,multiSelect:!1,headerRowHeight:28,enableRowSelection:!0,enableColumnMenus:!1,enableRowHeaderSelection:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,columnDefs:[{field:"name",displayName:o.instant("DATA-MODEL.TABLES.ENTITY-NAME")}]},t.entityGridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?(t.model.selectedEntity=e.entity,t.model.attributes.length=0,t.model.selectedEntity.attributes&&t.model.selectedEntity.attributes.length>0?Array.prototype.push.apply(t.model.attributes,t.model.selectedEntity.attributes):t.model.selectedEntity.attributes=[]):delete t.model.selectedEntity})},t.attributeGridOptions={data:t.model.attributes,multiSelect:!1,headerRowHeight:28,enableRowSelection:!0,enableColumnMenus:!1,enableRowHeaderSelection:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,columnDefs:[{field:"name",displayName:o.instant("DATA-MODEL.TABLES.ATTRIBUTES-NAME")},{field:"type",displayName:o.instant("DATA-MODEL.TABLES.ATTRIBUTES-TYPE")}]},t.attributeGridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?t.model.selectedAttribute=e.entity:delete t.model.selectedAttribute})},t.useAsNewVersion=function(){_internalCreateModal({template:"views/popup/model-use-as-new-version.html",scope:t},s,t)},t.toggleFavorite=function(){t.model.favoritePending=!0;var e={favorite:!t.model.dataModel.favorite};n({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId,data:e}).success(function(){t.model.favoritePending=!1,t.model.dataModel.favorite?t.addAlertPromise(o("DATA-MODEL.ALERT.UN-FAVORITE-CONFIRM"),"info"):t.addAlertPromise(o("DATA-MODEL.ALERT.FAVORITE-CONFIRM"),"info"),t.model.dataModel.favorite=!t.model.dataModel.favorite}).error(function(){t.model.favoritePending=!1})},t.loadVersions=function(){var e={includeLatestVersion:!t.model.dataModel.latestVersion};n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId+"/history",params:e}).success(function(e){t.model.dataModel.latestVersion&&(e.data||(e.data=[]),e.data.unshift(t.model.dataModel)),t.model.versions=e})},t.showVersion=function(e){e&&(e.latestVersion?a.path("/data-models/"+t.model.latestModelId):a.path("/data-models/"+t.model.latestModelId+"/history/"+e.id))},t.returnToList=function(){a.path("/data-models/")},t.editDataModel=function(){_internalCreateModal({template:"views/popup/model-edit.html",scope:t},s,t)},t.deleteDataModel=function(){_internalCreateModal({template:"views/popup/model-delete.html",scope:t},s,t)},t.shareDataModel=function(){_internalCreateModal({template:"views/popup/model-share.html",scope:t},s,t)},t.openEditor=function(){t.model.dataModel&&a.path("/data-model-editor/"+t.model.dataModel.id)},t.loadComments=function(){var e={latestFirst:!0};n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t.model.latestModelId+"/comments",params:e}).success(function(e){t.model.comments=e})},t.toggleComments=function(e){if(!t.commentsState){var i={};t.commentsState=i,i.popover=l(angular.element(e.target),{template:"views/popover/comments.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.commentsState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.toggleHistory=function(e){if(!t.historyState){var i={};t.historyState=i,i.popover=l(angular.element(e.target),{template:"views/popover/history.html",placement:"bottom-right",show:!0,scope:t,container:"body"});var o=function(){i.popover.destroy(),delete t.historyState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},p()}]),activitiApp.constant("DATA_MODEL_CUSTOM_PREFIX","F:"),activitiApp.constant("CM_PREFIX","cm:"),activitiApp.constant("CMIS_PREFIX","cmis:"),angular.module("activitiModeler").controller("DataModelEditorController",["$rootScope","$scope","$q","$translate","$http","$timeout","$location","$modal","$routeParams","DataModelService","CM_PREFIX","CMIS_PREFIX","DATA_MODEL_CUSTOM_PREFIX",function(e,t,i,o,n,r,a,s,l,d,c,p,u){function m(e){e=e||{},e.name="Folder",e.tableName="cmis:folder,P:cm:titled",e.attributes=[{id:"",name:"Id",mappedName:"sys:node-uuid",type:"string",required:!0,description:"",generatedValue:!1},{id:"",name:"Name",mappedName:"cm:name",type:"string",required:!0,description:"",generatedValue:!1},{id:"",name:"Title",mappedName:"cm:title",type:"string",description:"",generatedValue:!1},{id:"",name:"Created",mappedName:"cm:created",type:"date",description:"",generatedValue:!1},{id:"",name:"Creator",mappedName:"cm:creator",type:"string",description:"",generatedValue:!1},{id:"",name:"Modified",mappedName:"cm:modified",type:"date",description:"",generatedValue:!1},{id:"",name:"Modifier",mappedName:"cm:modifier",type:"string",description:"",generatedValue:!1},{id:"",name:"Parent",mappedName:"cm:parentId",type:"string",description:"",generatedValue:!1}]}function h(){return 0===e.currentDataModelEntities.length?!0:!1}function f(t){for(var i=!1,o=0;e.currentDataModelEntities.length>o&&!i;o++)e.currentDataModelEntities[o].name===t.name&&(i=!0);return i}function g(t){h()?e.currentDataModelEntities.push(t):f(t)?e.addAlert('The entity "'+t.name+'" is already present',"error"):e.currentDataModelEntities.push(t)}function v(e){var t=function(e,t){var i=e.getElementsByTagName(t);return i.length>0?i[0].textContent:""},i=function(e){return o(e)?u:""},o=function(e){return e.includes(c)||e.includes(p)?void 0:!0},n=function(e){var i=t(e,"type");switch(i){case"d:date":case"d:datetime":return"date";case"d:long":case"d:int":return"number";default:return"string"}},r=e.find("model > types > type");if(r.length>0)for(var a=0;r.length>a;a++){var s=r.get(a),l=s.getAttribute("name"),d=i(l),m={id:"",name:t(s,"title")||l,description:t(s,"description"),tableName:d+l,attributes:[]},h=s.getElementsByTagName("property");if(h.length>0)for(var f=0;h.length>f;f++){var v=h[f],S={id:"",name:t(v,"title")||v.getAttribute("name"),mappedName:v.getAttribute("name"),type:n(v),required:"true"===t(v,"mandatory"),description:t(v,"description"),generatedValue:!1};m.attributes.push(S)}g(m)}}e.account&&e.account.type&&"enterprise"!=e.account.type&&a.path("/processes"),e.editorHistory&&e.editorHistory.length>0&&(t.stepId=e.editorHistory[0].stepId,t.allSteps=e.editorHistory[0].allSteps),t.status={loading:!0},t.model={attributes:[],dataSources:[],alfrescoRepositories:[]},e.currentDataModelEntities=[],e.currentDataModelValidationErrors=[],t.$on("$locationChangeStart",function(i,o){var n=function(i){t.unsavedDataModelModalInstance=void 0,i?(e.ignoreDataModelChanges=!0,a.url(o.substring(o.indexOf("/#")+2))):(e.ignoreDataModelChanges=!1,e.setMainPageById("data-models"))};t.confirmNavigation(n,i)}),t.confirmNavigation=function(i,o){!e.ignoreDataModelChanges&&t.model.dirty&&(o&&o.preventDefault(),t.unsavedDataModelModalInstance||(t.handleResponseFunction=i,t.unsavedDataModelModalInstance=_internalCreateModal({template:"editor-app/popups/unsaved-changes.html",scope:t},s,t)))};var S=function(i){t.status.loading=!0,d.getAllDataSources().then(function(e){e&&e.data&&Array.prototype.push.apply(t.model.dataSources,e.data)}),d.getAllAlfrescoRepositories(void 0,!0).then(function(e){e&&e.data&&Array.prototype.push.apply(t.model.alfrescoRepositories,e.data)}),d.fetchDataModelDetails(i).then(function(i){e.currentDataModel=i.dataModelDefinition,e.currentDataModel.id=i.id,e.currentDataModel.name=i.name,e.currentDataModel.description=i.description,e.currentDataModel.entities&&e.currentDataModel.entities.length>0&&Array.prototype.push.apply(e.currentDataModelEntities,e.currentDataModel.entities),t.status.loading=!1},function(){e.addAlertPromise(o("DATA-MODEL-DEFINITION.MESSAGE.NOT-FOUND"),"error"),a.path("/data-models/")})};t.setDataSourceType=function(t){e.currentDataModel.dataSourceType=t},t.isDatabaseSource=function(){return e&&e.currentDataModel&&(!e.currentDataModel.dataSourceType||"database"===e.currentDataModel.dataSourceType)},t.hasDataSource=function(){return t.isDatabaseSource()&&e.currentDataModel.dataSourceId},t.hasDatabaseTable=function(){return t.isDatabaseSource()&&t.model.selectedEntity&&t.model.selectedEntity.tableName},t.isDataSourceType=function(t){return e&&e.currentDataModel&&e.currentDataModel.dataSourceType===t},t.isValid=function(){return!e.currentDataModelValidationErrors||0===e.currentDataModelValidationErrors.length},t.addEntity=function(){var i={id:"",name:"",description:""};"alfresco"===e.currentDataModel.dataSourceType&&m(i),e.currentDataModelEntities.push(i),r(function(){t.gridApi.selection.toggleRowSelection(i)})},t.importTables=function(){var i=e.currentDataModel.dataSourceId;i&&d.getDataSourceEntities(i).then(function(i){if(i&&i.length>0)if(e.currentDataModelEntities&&e.currentDataModelEntities.length>0){for(var o=e.currentDataModelEntities.filter(function(e){return e.name}).map(function(e){return e.name.toUpperCase()}),n=i.map(function(e){return e.name.toUpperCase()}),r=!1,a=0;n.length>a;a++)if(o.indexOf(n[a])>-1){r=!0;break}r?(t.confirmSkipCallback=function(){var n=i.filter(function(e){return 0>o.indexOf(e.name.toUpperCase())});n.length>0&&(t.model.selectedEntity=void 0,t.model.selectedAttribute=void 0,Array.prototype.push.apply(e.currentDataModelEntities,n))},t.confirmOverwriteCallback=function(){var o=e.currentDataModelEntities.filter(function(e){return 0>n.indexOf(e.name.toUpperCase())}),r=o.concat(i);r.length>0&&(t.model.selectedEntity=void 0,t.model.selectedAttribute=void 0,e.currentDataModelEntities.splice(0),Array.prototype.push.apply(e.currentDataModelEntities,r))},_internalCreateModal({template:"views/popup/data-model-import-confirm.html",scope:t},s,t)):Array.prototype.push.apply(e.currentDataModelEntities,i)}else Array.prototype.push.apply(e.currentDataModelEntities,i)})},t.importAttributes=function(){var i=e.currentDataModel.dataSourceId,o=t.model.selectedEntity.tableName;i&&o&&d.getDataSourceAttributes(i,o).then(function(e){if(e&&e.length>0)if(t.model.attributes&&t.model.attributes.length>0){for(var i=t.model.attributes.filter(function(e){return e.name}).map(function(e){return e.name.toUpperCase()}),o=e.map(function(e){return e.name.toUpperCase()}),n=!1,r=0;o.length>r;r++)if(i.indexOf(o[r])>-1){n=!0;break}n?(t.confirmSkipCallback=function(){var o=e.filter(function(e){return 0>i.indexOf(e.name.toUpperCase())});o.length>0&&(t.model.selectedAttribute=void 0,Array.prototype.push.apply(t.model.attributes,o),Array.prototype.push.apply(t.model.selectedEntity.attributes,o))},t.confirmOverwriteCallback=function(){var i=t.model.attributes.filter(function(e){return 0>o.indexOf(e.name.toUpperCase())}),n=i.concat(e);n.length>0&&(t.model.selectedAttribute=void 0,t.model.attributes.splice(0),t.model.selectedEntity.attributes.splice(0),Array.prototype.push.apply(t.model.attributes,n),Array.prototype.push.apply(t.model.selectedEntity.attributes,n))},_internalCreateModal({template:"views/popup/data-model-import-confirm.html",scope:t},s,t)):(Array.prototype.push.apply(t.model.attributes,e),Array.prototype.push.apply(t.model.selectedEntity.attributes,e))}else Array.prototype.push.apply(t.model.attributes,e),Array.prototype.push.apply(t.model.selectedEntity.attributes,e)})},t.importAlfrescoModel=function(e){if(e&&e.length>0){var t=e[0],i=new FileReader;i.readAsText(t,"UTF-8"),i.onload=function(e){r(function(){try{var t=jQuery(jQuery.parseXML(e.target.result));v(t)}catch(i){console.log(i),window.alert("Error importing model")}})}}},t.removeEntity=function(){if(t.model.selectedEntity){var i=e.currentDataModelEntities.indexOf(t.model.selectedEntity);i>-1&&e.currentDataModelEntities.splice(i,1),t.model.selectedEntity=void 0,t.model.selectedAttribute=void 0}},t.addAttribute=function(){var e={id:"",name:"",type:"string",description:"",generatedValue:!1};t.model.attributes.push(e),t.model.selectedEntity.attributes.push(e),r(function(){t.attributeGridApi.selection.toggleRowSelection(e)})},t.removeAttribute=function(){if(t.model.selectedAttribute){var e=t.model.attributes.indexOf(t.model.selectedAttribute);e>-1&&(t.model.attributes.splice(e,1),t.model.selectedEntity.attributes.splice(e,1)),t.model.selectedAttribute=void 0}},t.entityGridOptions={data:e.currentDataModelEntities,multiSelect:!1,headerRowHeight:28,enableRowSelection:!0,enableColumnMenus:!1,enableRowHeaderSelection:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,columnDefs:[{field:"name",displayName:o.instant("DATA-MODEL.TABLES.ENTITY-NAME")}]},t.entityGridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?(t.model.selectedEntity=e.entity,t.model.selectedAttribute=void 0,t.model.attributes.length=0,t.model.selectedEntity.attributes&&t.model.selectedEntity.attributes.length>0?Array.prototype.push.apply(t.model.attributes,t.model.selectedEntity.attributes):t.model.selectedEntity.attributes=[]):delete t.model.selectedEntity})},t.attributeGridOptions={data:t.model.attributes,multiSelect:!1,headerRowHeight:28,enableRowSelection:!0,enableColumnMenus:!1,enableRowHeaderSelection:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,columnDefs:[{field:"name",displayName:o.instant("DATA-MODEL.TABLES.ATTRIBUTES-NAME")},{field:"type",displayName:o.instant("DATA-MODEL.TABLES.ATTRIBUTES-TYPE")}]},t.attributeGridOptions.onRegisterApi=function(e){t.attributeGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?t.model.selectedAttribute=e.entity:delete t.model.selectedAttribute})},t.showValidationErrors=function(){t.validationErrors=e.currentDataModelValidationErrors,_internalCreateModal({backdrop:!0,keyboard:!0,template:"views/popup/data-model-validation-errors.html?version="+Date.now(),scope:t},s,t)},S(l.modelId)}]),angular.module("activitiModeler").controller("ValidateDataModelCtrl",["$rootScope","$scope","$translate","$timeout",function(e,t,i){t.gridOptions={data:t.validationErrors,headerRowHeight:28,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"defaultDescription",displayName:i.instant("MODEL.VALIDATION.ERRORS.DESCRIPTION")},{field:"warning",displayName:i.instant("MODEL.VALIDATION.ERRORS.WARNING"),width:100},{field:"validatorSetName",displayName:i.instant("MODEL.VALIDATION.ERRORS.SET"),width:200}]},t.ok=function(){t.$hide()},t.close=function(){t.$hide()}}]),angular.module("activitiModeler").controller("DataModelToolbarController",["$scope","$http","$modal","$q","$rootScope","$translate","$location","DataModelService",function(e,t,i,o,n,r,a,s){var l=DATA_MODEL_TOOLBAR_CONFIG.items;e.items=[];for(var d=0;l.length>d;d++)e.items.push(l[d]);e.secondaryItems=DATA_MODEL_TOOLBAR_CONFIG.secondaryItems;var c=function(e,t){for(var i=Array.prototype.slice.call(arguments).splice(2),o=e.split("."),n=o.pop(),r=0;o.length>r;r++)t=t[o[r]];return t[n].apply(this,i)};e.toolbarButtonClicked=function(a){var l=e.items[a],d={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,DataModelService:s};
c(l.action,window,d)},e.toolbarSecondaryButtonClicked=function(l){var d=e.secondaryItems[l],p={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,$location:a,DataModelService:s};c(d.action,window,p)}}]);var DATA_MODEL_TOOLBAR={ACTIONS:{saveModel:function(e){_internalCreateModal({backdrop:!0,keyboard:!0,template:"views/popup/data-model-save.html?version="+Date.now(),scope:e.$scope},e.$modal,e.$scope)},validateModel:function(e){e.DataModelService.validateDataModel()},closeEditor:function(e){e.$location.path("/data-models")}}};angular.module("activitiModeler").controller("SaveDataModelCtrl",["$rootScope","$scope","$http","$route","$location","$translate","DataModelService",function(e,t,i,o,n,r,a){var s="";e.currentDataModel.description&&(s=e.currentDataModel.description);var l={name:e.currentDataModel.name,description:s,reusable:!1,newVersion:!1,comment:""};t.saveDialog=l,t.status={loading:!1};var d=function(e){e&&e.length>0&&(t.saveDialog.validationErrors=!0)};t.validate=function(){t.saveDialog.name&&0!=t.saveDialog.name.length&&(t.status={loading:!0},a.validateDataModel(d))},t.cancel=function(){t.$hide()},t.saveAndClose=function(){t.save(function(){n.path("/data-models")})},t.save=function(i){if(t.saveDialog.name&&0!=t.saveDialog.name.length){t.status={loading:!0};var o={reusable:t.saveDialog.reusable,newVersion:t.saveDialog.newVersion,comment:t.saveDialog.comment},n=function(){t.$hide(),e.addAlertPromise(r("DATA-MODEL.ALERT.SAVE-CONFIRM",{name:t.saveDialog.name}),"info"),i&&i(),e.dataModelChanges=!1,e.currentDataModel.name=t.saveDialog.name,e.currentDataModel.description=t.saveDialog.description},s=function(){t.$hide(),e.addAlertPromise(r("DATA-MODEL.ALERT.SAVE-ERROR",{name:t.saveDialog.name}),"error")};a.saveDataModel(o,t.saveDialog.name,t.saveDialog.description,n,s)}},t.isOkButtonDisabled=function(){return t.status.loading?!1:t.error&&t.error.conflictResolveAction?"saveAs"===t.error.conflictResolveAction?!t.error.saveAs||0==t.error.saveAs.length:!1:!0},t.okClicked=function(){t.error&&("discardChanges"===t.error.conflictResolveAction?(t.close(),o.reload()):"overwrite"===t.error.conflictResolveAction||"newVersion"===t.error.conflictResolveAction?t.save():"saveAs"===t.error.conflictResolveAction&&t.save(function(){if(e.ignoreChanges=!0,e.editorHistory.length>0){var t=e.editorHistory.pop();n.path("/data-model/"+t.id)}else n.path("/data-models")}))},a.validateDataModel(d)}]);var DATA_MODEL_TOOLBAR_CONFIG={items:[{type:"button",title:"DATA_MODEL_TOOLBAR.ACTION.SAVE",cssClass:"editor-icon editor-icon-save",action:"DATA_MODEL_TOOLBAR.ACTIONS.saveModel",disableOnReadonly:!0},{type:"button",title:"DATA_MODEL_TOOLBAR.ACTION.VALIDATE",cssClass:"glyphicon glyphicon-ok",action:"DATA_MODEL_TOOLBAR.ACTIONS.validateModel"}],secondaryItems:[{type:"button",title:"DATA_MODEL_TOOLBAR.ACTION.CLOSE",cssClass:"glyphicon glyphicon-remove",action:"DATA_MODEL_TOOLBAR.ACTIONS.closeEditor"}]};angular.module("activitiModeler").service("ModelService",["$rootScope","$http","$q","$timeout","$translate","httpUtils",function(e,t,i,o,n,r){this.getModelParentRelations=function(e){var i=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+e+"/parent-relations";return t({method:"GET",url:i}).then(function(e){return e.data})},this._saveModel=function(e,i,o){var n,r,a,s=e.id;return o===!0?(a="POST",r=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+s+"/clone"):(a="PUT",r=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+s),n={name:i.name,description:e.description||i.description,referenceId:i.referenceId,modelType:i.modelType,stencilSet:i.stencilSet},i.description&&i.description.length>0&&(n.description=i.description),t({method:a,url:r,data:n}).then(function(e){return e.data})},this.saveModel=function(e,t){return this._saveModel(e,t,!1)},this.cloneModel=function(e,t){return this._saveModel(e,t,!0)},this.validateModelJson=function(e,i){return t({method:"POST",url:KISBPM.URL.validateModel(e.modelId),data:i,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:r.encode})},this.saveModelJson=function(e,i){return t({method:"POST",url:KISBPM.URL.putModel(e.modelId),data:i,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},ignoreErrors:!0,transformRequest:r.encode})},this.updateFormReferencesInProcess=function(e,i,o){var n=ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+e+"/formrefs"+"?oldFormId="+encodeURIComponent(i)+"&newFormId="+encodeURIComponent(o);return t({method:"POST",url:n})}}]),angular.module("activitiModeler").service("ThumbnailService",["$q",function(e){this.generateThumbnail=function(t,i){var o=e.defer(),n=300;return html2canvas(jQuery("#"+t),{onrendered:function(e){var t=e.width/n,r=document.createElement("canvas");r.setAttribute("width",n),r.setAttribute("height",e.height/t);var a=r.getContext("2d");a.drawImage(e,0,0,e.width,e.height,0,0,n,e.height/t);var s=r.toDataURL("image/png");i&&(i.modelImageBase64=s),o.resolve(s)}}),o.promise}}]),angular.module("activitiModeler").service("AlfrescoService",["ContentAccountService",function(e){this.loadAlfrescoAccounts=function(t,i,o){var n,r={loading:!0,onPrem:!1},a=[],s=!1;return e.getAccounts().then(function(l){if(l&&l.data)for(n=0;l.data.length>n;n++)"alfresco-"===l.data[n].serviceId.substring(0,9)&&(a.push(l.data[n]),"alfresco-cloud"!==l.data[n].serviceId&&s===!1?s=!0:"alfresco-cloud"===l.data[n].serviceId&&(l.data[n].name="Alfresco Cloud"));if(i||o)for(n=0;a.length>n;n++)i&&e.getAlfrescoServiceIdsMatch(a[n].serviceId,i.id)?t.selected=a[n]:o&&"alfresco-cloud"===a[n].serviceId&&(t.selected=a[n]);else t.selected=a[0];r.onPrem=s,r.rawList=a,r.loading=!1}),r}}]),angular.module("activitiModeler").service("ChoiceStepConditionService",["$translate",function(e){var t=e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.EQUALS"),i=e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.NOTEQUALS"),o=[{value:"==",description:t},{value:"!=",description:i},{value:"<",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY")},{value:"notEmpty",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY")}],n=[{value:"==",description:t},{value:"!=",description:i},{value:"empty",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY")},{value:"notEmpty",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY")}];this.conditionOperatorsByType={text:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:o},string:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:o},"multi-line-text":{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:o},date:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:o},integer:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:o},"long":{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:o},number:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:o},amount:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:o},dropdown:{index:{"==":0,"!=":1,empty:2,notEmpty:3},operators:n},typeahead:{index:{"==":0,"!=":1,empty:2,notEmpty:3},operators:n},"radio-buttons":{index:{"==":0,"!=":1,empty:2,notEmpty:3},operators:n},"boolean":{index:{"==":0,"!=":1,empty:2,notEmpty:3},operators:[{value:"==",description:t},{value:"!=",description:i}]},condition:{index:{and:0,"and-not":1,or:2,"or-not":3},operators:[{value:"and",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.AND")},{value:"and-not",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.ANDNOT")},{value:"or",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.OR")},{value:"or-not",description:e.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.ORNOT")}]}},this.detectVariableType=function(e){e&&(void 0===e.leftFieldType&&(e.leftFieldType=e.leftFormFieldId&&""!==e.leftFormFieldId?"formField":e.leftRestResponseId&&""!==e.leftRestResponseId?"restResponse":e.leftOutcomeFormId&&""!==e.leftOutcomeFormId?"outcome":"formField"),void 0===e.rightFieldType&&((e.rightValue||0===e.rightValue)&&(""+e.rightValue).length>0?e.rightFieldType="staticValue":e.rightFormFieldId&&""!==e.rightFormFieldId?e.rightFieldType="formField":e.rightRestResponseId&&""!==e.rightRestResponseId?e.rightFieldType="restResponse":e.rightOutcomeFormId&&""!==e.rightOutcomeFormId?e.rightFieldType="outcome":e.rightOutcomeName&&""!==e.rightOutcomeName&&(e.rightOutcomeFormId=e.leftOutcomeFormId,e.rightOutcomeFormName=e.leftOutcomeFormName,e.rightFieldType="outcome")))},this.convertToAdvancedEditorFormat=function(e){if(e&&void 0===e.nextConditionOperator){var t={};return e&&"variables"===e.type?"field"===e.fieldType?(t.leftFormFieldId=e.fieldId,t.operator=e.operator,t.rightValue=e.value):"outcome"===e.fieldType?(t.leftOutcomeFormId=e.outcomeFormId,t.leftOutcomeFormName=e.outcomeFormName,t.operator=e.operator,t.rightOutcomeName=e.outcomeName):"restResponseVariable"===e.fieldType?(t.leftRestResponseId=e.responseVariableName,t.operator=e.operator,t.rightValue=e.value):t="none"===e.fieldType?void 0:e:t=e,t}return e},this.getOperatorsForType=function(e){return e?this.conditionOperatorsByType[e].operators:[]},this.getOperatorDescriptionForType=function(e,t){if(e&&t){var i;return this.conditionOperatorsByType[t]&&(i=this.conditionOperatorsByType[t].index[e]),void 0!==i&&i>=0?this.conditionOperatorsByType[t].index[e].description:void 0}}}]),angular.module("activitiModeler").service("ProcessBuilderService",["$http","$q","$rootScope","$translate","$location","ProcessScopeService","ThumbnailService","httpUtils",function(e,t,i,o,n,r,a,s){var l=["email-step","alfresco-cloud-publish-step","box-cloud-publish-step","google-drive-publish-step","subprocess-step","goto-step","end-process-step","rest-call-step","generate-doc-step","decision-step","get-alfresco-metadata-action-step","put-alfresco-metadata-action-step","call-alfresco-action-step"],d=function(i){var o=t.defer();return e(i).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise};this.removeStepFromContainer=function(e,t){e=this.getStepArrayForContainer(e);var i=this.getIndexInContainer(t,e);i>=0&&e.splice(i,1)},this.addStepToContainer=function(e,t,i,n){if(e=this.getStepArrayForContainer(e),t&&e&&i>=0){var r={id:this._generateUniqueId(t),type:t.id,name:""};return"choice-step"===t.id?r.choices=[{name:o.instant("PROCESS-BUILDER.CHOICE-STEP.LABELS.FIRST-CHOICE"),condition:{},steps:[]},{name:o.instant("PROCESS-BUILDER.CHOICE-STEP.LABELS.SECOND-CHOICE"),condition:{},steps:[]}]:"human-step"===t.id?r.overdueSteps=[]:l.indexOf(t.id)>=0||(r.customStepId=t.id,r.type="custom-step"),this._initializeDefaultData(r,t),o(t.name).then(function(e){r.name=e}),e.splice(i,0,r),this._addStepMetadata(r,n),r.meta.new=!0,r}},this.insertStepInContainer=function(e,t,i){t&&e&&i>=0&&(e=this.getStepArrayForContainer(e),e.splice(i,0,t))},this.getIndexInContainer=function(e,t){if(e&&t)for(var i=0;t.length>i;i++)if(t[i].id===e.id)return i;return-1},this.updateStepSummary=function(e){if(e&&e.meta)switch(e.type){case"human-step":if(e.assignment&&"user"===e.assignment.type&&(e.assignment.assignee||e.assignment.assigneeField)){var t;if(e.assignment.assignee){var i="";e.assignment.assignee.firstName&&(i=e.assignment.assignee.firstName),i.length>0&&(i+=" "),e.assignment.assignee.lastName&&(i+=e.assignment.assignee.lastName),0===i.length&&e.assignment.assignee.email&&(i=e.assignment.assignee.email),t={name:i}}else e.assignment.assigneeField&&(t={name:e.assignment.assigneeField.name+" - "+e.assignment.assigneeField.id});"user"===e.assignment.type&&(e.meta.summary=o.instant("PROCESS-BUILDER.HUMAN-STEP.SUMMARY.ASSIGNEE",t))}else if(e.assignment&&"groupManager"===e.assignment.type){var t;e.assignment.groupManager?t={name:e.assignment.groupManager.name}:e.assignment.groupManagerField&&(t={name:e.assignment.groupManagerField.name+" - "+e.assignment.groupManagerField.id}),e.meta.summary=o.instant("PROCESS-BUILDER.HUMAN-STEP.SUMMARY.GROUP-MANAGER",t)}else if(e.assignment&&"users"===e.assignment.type&&(e.assignment.candidateUsers&&e.assignment.candidateUsers.length>0||e.assignment.candidateUserFields&&e.assignment.candidateUserFields.length>0)){var n=[];e.assignment.candidateUsers&&e.assignment.candidateUsers.length>0&&(n=n.concat(e.assignment.candidateUsers)),e.assignment.candidateUserFields&&e.assignment.candidateUserFields.length>0&&(n=n.concat(e.assignment.candidateUserFields)),e.meta.summary=o.instant("PROCESS-BUILDER.HUMAN-STEP.SUMMARY.USERS",n)}else if(e.assignment&&"groups"===e.assignment.type&&(e.assignment.candidateGroups&&e.assignment.candidateGroups.length>0||e.assignment.candidateGroupFields&&e.assignment.candidateGroupFields.length>0)){var n=[];e.assignment.candidateGroups&&e.assignment.candidateGroups.length>0&&(n=n.concat(e.assignment.candidateGroups)),e.assignment.candidateGroupFields&&e.assignment.candidateGroupFields.length>0&&(n=n.concat(e.assignment.candidateGroupFields)),e.meta.summary=o.instant("PROCESS-BUILDER.HUMAN-STEP.SUMMARY.GROUPS",n)}else e.meta.summary=e.assignment&&"groupManagerForInitiator"===e.assignment.type?o.instant("PROCESS-BUILDER.HUMAN-STEP.SUMMARY.GROUP-MANAGER-FOR-INITIATOR"):o.instant("PROCESS-BUILDER.HUMAN-STEP.SUMMARY.INITIATOR");break;case"email-step":if(e.recipient&&"user"===e.recipient.type&&e.recipient.user){var i="";e.recipient.user.firstName&&(i=e.recipient.user.firstName),i.length>0&&(i+=" "),e.recipient.user.lastName&&(i+=e.recipient.user.lastName),0===i.length&&e.recipient.user.email&&(i=e.recipient.user.email),e.meta.summary=o.instant("PROCESS-BUILDER.EMAIL-STEP.SUMMARY.TO-USER",{name:i})}else if(e.recipient&&"users"===e.recipient.type){var r=0;e.recipient.users&&e.recipient.users.length>0&&(r=e.recipient.users.length),e.recipient.userFields&&e.recipient.userFields.length>0&&(r+=e.recipient.userFields.length),e.meta.summary=o.instant("PROCESS-BUILDER.EMAIL-STEP.SUMMARY.TO-USERS",{size:r})}else e.meta.summary=o.instant("PROCESS-BUILDER.EMAIL-STEP.SUMMARY.TO-INITIATOR");break;case"choice-step":e.meta.summary=e.choices?o.instant("PROCESS-BUILDER.CHOICE-STEP.SUMMARY.WITH-CHOICES",{count:e.choices.length}):o.instant("PROCESS-BUILDER.CHOICE-STEP.SUMMARY.NO-CHOICES");break;case"subprocess-step":e.meta.summary=e.subProcessDefinition?o.instant("PROCESS-BUILDER.SUBPROCESS-STEP.SUMMARY.SUBPROCESS-SELECTED",{name:e.subProcessDefinition.name}):o.instant("PROCESS-BUILDER.SUBPROCESS-STEP.SUMMARY.NO-SUBPROCESS");break;case"goto-step":e.meta.summary=e.gotoStep&&e.gotoStep.name?o.instant("PROCESS-BUILDER.GOTO-STEP.SUMMARY.STEP-SELECTED",{name:e.gotoStep.name}):o.instant("PROCESS-BUILDER.GOTO-STEP.SUMMARY.NO-STEP");break;case"custom-step":e.meta.summary="Custom step '"+e.meta.type.name+"'";break;default:e.meta.summary=e.meta.type&&e.meta.type.name?o.instant(e.meta.type.name):""}},this.getStencilSet=function(e){var t;return t=e&&isNaN(e)===!1?ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+e+"/stepeditor?version="+Date.now():ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/0/stepeditor?version="+Date.now(),d({method:"GET",url:t})},this.filterKickstartForms=function(e){return d({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models",params:{filter:e,referenceId:i.currentKickstartModel.definition.id}})},this.filterKickstartSubProcesses=function(e){return d({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/editor/sub-processes",params:{filter:e,referenceId:i.currentKickstartModel.definition.id}})},this.validateKickstartModel=function(t,n,a){delete Array.prototype.toJSON;var l={definition:JSON.stringify(this._cloneAndfilterMeta(n)),parentProcessScopeIdentifiers:JSON.stringify(r.getParentIdentifiers())};e({method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+t+"/editor/validate",data:l,transformRequest:s.encode}).success(function(e){e&&e.length>0?i.currentKickstartValidationErrors=e:(i.currentKickstartValidationErrors=[],i.addAlertPromise(o("MODELER.ALERT.VALIDATION-OK"),"info"));for(var t=[],r=0;i.currentKickstartValidationErrors.length>r;r++)0>t.indexOf(i.currentKickstartValidationErrors[r].id)&&t.push(i.currentKickstartValidationErrors[r].id);t.length>0&&i.addAlertPromise(o("MODELER.ALERT.VALIDATION-ERROR"),"error");var s=!1;t.indexOf("process")>=0&&(s=!0),i.kickstartModelRootLevelValidationError=s;var l=!1;if(t.indexOf("start-event")>=0&&(l=!0),i.kickstartModelStartEventValidationError=l,n.steps)for(var r=0;n.steps.length>r;r++)n.steps[r].meta.hasValidationError=t.indexOf(n.steps[r].id)>=0?!0:!1,c(n.steps,t);a&&a(e)})};var c=function(e,t){if(e&&0!==e.length)for(var i=0;e.length>i;i++){var o=!1;if(t.indexOf(e[i].id)>=0&&(o=!0),e[i].meta.hasValidationError=o,e[i].choices&&e[i].choices.length>0)for(var n=0;e[i].choices.length>n;n++)c(e[i].choices[n].steps,t);else e[i].overdueSteps&&c(e[i].overdueSteps,t)}};this.processValidationSteps=function(e,t){c(e,t)},this._saveModelPromise=function(t,i){delete Array.prototype.toJSON;var o={newVersion:i.newVersion,comment:i.comment};return o.kickstartModel={name:i.name,description:i.description},o.kickstartModel.definition=this._cloneAndfilterMeta(t.definition),i.modelImageBase64&&(o.modelImageBase64=i.modelImageBase64),e({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/kickstart-models/"+t.id,data:o})},this.saveKickstartModel=function(e,t){var i=angular.bind(this,this._saveModelPromise,e,t);return a.generateThumbnail("canvasSection",t).then(i)},this.openKickstartModel=function(e){n.path("kickstart-models/"+e)},this.fetchKickstartModel=function(e,t){var i;return i=t?ACTIVITI.CONFIG.contextRoot+"/app/rest/kickstart-models/"+e+"/history/"+t:ACTIVITI.CONFIG.contextRoot+"/app/rest/kickstart-models/"+e,d({method:"GET",url:i})},this.getAllFormsInModel=function(e,t){var i=ACTIVITI.CONFIG.contextRoot+"/app/rest/kickstart-models/"+e+"/forms",o={};return t&&(o.excludeFormId=t),d({method:"GET",params:o,url:i})},this.addMetaToSteps=function(e,t){for(var i=0;e.steps.length>i;i++)this._addStepMetadata(e.steps[i],t)},this.extractStepsOfType=function(e,t){for(var i=[],o=0;e.steps.length>o;o++)this._extractStepsOfType(e.steps[o],t,i);return i},this._extractStepsOfType=function(e,t,i){if(e&&(e.type===t&&i.push(e),"choice-step"===e.type&&e.choices))for(var o=0;e.choices.length>o;o++){var n=e.choices[o].steps;if(n)for(var r=0;n.length>r;r++)this._extractStepsOfType(n[r],t,i)}},this.moveStep=function(e,t,i,o){this.removeStepFromContainer(t,e),this.insertStepInContainer(i,e,o)},this.getStepType=function(e,t){for(var i=0;t.length>i;i++)if(t[i].id===e.type||e.customStepId&&t[i].id===e.customStepId)return t[i];return void 0},this._generateUniqueId=function(e){var t=Math.floor(1e3*Math.random()+1),i=(new Date).getTime();return e.id+"-"+i+"-"+t},this._deleteAllMetaProperty=function(e){if(!(null===e||void 0===e||"string"==typeof e||e instanceof String)){e.meta&&delete e.meta,e.$$hashKey&&delete e.$$hashKey;for(var t in e)e.hasOwnProperty(t)&&this._deleteAllMetaProperty(e[t])}},this._cloneAndfilterMeta=function(e){var t=jQuery.extend(!0,{},e);return this._deleteAllMetaProperty(t),t},this._initializeDefaultData=function(e){switch(e.type){case"human-step":e.assignment={}}},this.getStepArrayForContainer=function(e){var t=e;return e&&(e.steps?t=e.steps:e.overdueSteps&&(t=e.overdueSteps)),t},this._addStepMetadata=function(e,t){if(e&&!e.meta)if(e.meta={type:this.getStepType(e,t)},this.updateStepSummary(e),"choice-step"===e.type&&e.choices)for(var i=0;e.choices.length>i;i++){var o=e.choices[i].steps;if(o)for(var n=0;o.length>n;n++)this._addStepMetadata(o[n],t)}else if("human-step"===e.type)if(e.overdueSteps)for(var n=0;e.overdueSteps.length>n;n++)this._addStepMetadata(e.overdueSteps[n],t);else e.overdueSteps=[]},this.getAllPreviousStepsArray=function(e,t){var i=e.find(function(e){return e.id===t}),o=e.indexOf(i);return e.slice(0,o)},this.getAllStepsArray=function(e){var t=[];if(e)for(var i=0;e.length>i;i++){if(t.push(e[i]),e[i].overdueSteps)for(var o=0;e[i].overdueSteps.length>o;o++)t.push(e[i].overdueSteps[o]);if(e[i].choices)for(var n=0;e[i].choices.length>n;n++){if(e[i].choices[n].steps)for(var r=0;e[i].choices[n].steps.length>r;r++)t.push(e[i].choices[n].steps[r]);t.push(e[i].choices[n])}}return t}}]),angular.module("activitiModeler").controller("KickstartModelController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","FormBuilderService","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r,a,s,l,d,c,p,u){function m(e,t,i,o){e.unsavedChangesModalInstance||(e.handleResponseFunction=function(n){e.unsavedChangesModalInstance=void 0,n===!0?i&&i():n===!1?t&&t():o&&o()},_internalCreateModal({template:"editor-app/popups/unsaved-changes.html",scope:e},a,e))}e.setMainPageById("processes"),e.kickstartModelRootLevelValidationError=!1,e.kickstartModelStartEventValidationError=!1,e.formItems=void 0,t.forms={},e.currentKickstartModel={},e.currentKickstartValidationErrors=[],t.formInfo={},t.formFields={},t.formOutcomes={},t.metadata={fields:[]},t.startFormFields=[],t.processStartTypes=[{id:"none",title:i.instant("PROCESS-BUILDER.START-STEP.START-TYPES.USER")},{id:"form",title:i.instant("PROCESS-BUILDER.START-STEP.START-TYPES.FORM")}],t.model={processStart:{expanded:!1,type:t.processStartTypes[0]}},t.processStartChanged=function(){e.currentKickstartModel&&e.currentKickstartModel.definition&&e.currentKickstartModel.definition.definition&&"none"===t.model.processStart.type.id&&(e.currentKickstartModel.definition.definition.startForm=void 0)},t.processMetadataChanged=function(){if(e.currentKickstartModel&&e.currentKickstartModel.definition&&e.currentKickstartModel.definition.definition){var i={};t.metadata.fields.filter(function(e){return e.key&&e.key.length>0&&e.key.trim().length>0}).map(function(e){i[e.key]=e.value}),e.currentKickstartModel.definition.definition.metadata=i}},e.modelChanges=!1,p.init(s.modelId,{model:function(){return e.currentKickstartModel.definition.definition},success:function(){t.$on("form-cache-changed",function(i,o){o&&o.stepId&&"__startform"===o.stepId&&(t.startFormFields.length=0,e.currentKickstartModel.definition.definition.startForm&&Array.prototype.push.apply(t.startFormFields,p.getFormFieldsForForm(e.currentKickstartModel.definition.definition.startForm.id)))}),e.parentReferenceId=u.getCurrentProcessModelId(),d.fetchKickstartModel(s.modelId,s.modelHistoryId).then(function(i){i.definition||(i.definition={steps:[]}),d.getStencilSet(i.stencilSetId).then(function(e){t.stencilSet=e,d.addMetaToSteps(i.definition,t.stencilSet.stepTypes)}),i.definition.startForm&&(t.model.processStart.type=t.processStartTypes[1]),i.definition.metadata&&(t.metadata.fields=Object.keys(i.definition.metadata).map(function(e){return{key:e,value:i.definition.metadata[e]}})),e.currentKickstartModel.definition=i,t.steps=i.definition.steps,e.currentKickstartModel.definition.definition.startForm&&Array.prototype.push.apply(t.startFormFields,p.getFormFieldsForForm(e.currentKickstartModel.definition.definition.startForm.id)),e.modelChanges=!1,n(function(){t.modelLoaded=!0},200)})}}),t.$watch("currentKickstartModel",function(){t.modelLoaded&&(e.modelChanges=!0)},!0),t.$on("$locationChangeStart",function(i,o){if(!e.ignoreChanges&&e.modelChanges){i.preventDefault();var n=function(){e.ignoreChanges=!0,r.url(o.substring(o.indexOf("/#")+2))},a=function(){e.ignoreChanges=!1,e.setMainPageById("processes")};t.yesNoCancel=!1,m(t,null,n,a)}else e.ignoreChanges=!1}),t.$on("modelChangesEvent",function(){var e=function(){t.$broadcast("discardDataEvent")},i=function(){t.$broadcast("mustSaveEvent")},o=function(){t.$broadcast("continueEditingEvent")};t.yesNoCancel=!0,m(t,i,e,o)}),t.selectStartForm=function(t){e.currentKickstartModel.definition.definition.startForm,e.currentKickstartModel.definition.definition.startForm=t,p.refresh()},t.createStartForm=function(){t.createFormCallback=function(i){var o={id:i.id,name:i.name,description:i.description};e.currentKickstartModel.definition.definition.startForm=o,t.saveModelBeforeNavigation()},_internalCreateModal({template:"views/popup/form-create.html?version="+Date.now(),scope:t},a,t)},t.showStartForm=function(){t.saveModelBeforeNavigation()},t.saveModelBeforeNavigation=function(){if(e.readOnly)p.navigateForward("form-editor/"+encodeURIComponent(e.currentKickstartModel.definition.definition.startForm.id),"__startform");else{var t=e.currentKickstartModel.definition,i=function(){e.modelChanges=!1,p.navigateForward("form-editor/"+encodeURIComponent(e.currentKickstartModel.definition.definition.startForm.id),"__startform")},o={name:t.name,description:t.description,newVersion:!1};d.saveKickstartModel(t,o).then(i)}},t.toggleProcessStartExpanded=function(){t.model.processStart.expanded=!t.model.processStart.expanded},t.isReusable=function(e){return void 0!=e&&(void 0===e.referenceId||null==e.referenceId)},t.deleteModel=function(){d.deleteKickstartModel(e.currentKickstartModel.definition.id).then(function(){p.navigateBack("kickstart-models"),e.addAlertPromise(i("KICKSTART-MODEL.ALERT.DELETED"),"info")})},t.showValidationErrors=function(e){t.currentStep=e,_internalCreateModal({backdrop:!0,keyboard:!0,template:"views/popup/kickstart-validation-errors.html?version="+Date.now(),scope:t},a,t)}}]),angular.module("activitiModeler").controller("HumanStepOverdueStepsController",["$rootScope","$scope","ProcessBuilderService",function(e,t){t.stepContainer=t.step,t.activeTab=void 0}]),angular.module("activitiModeler").controller("HumanStepController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","FormBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l,d,c,p){t.model={},t.model.fieldsForCurrentForm=[];for(var u=0;t.stencilSet.stepTypes.lenth>u;u++)if("human-step"===t.stencilSet.stepTypes[u].id){t.humanStepTabs=t.stencilSet.stepTypes[u].tabs;break}t.$on("$select.select",function(){e.safeApply(function(){})}),t.$watch("activeStep.meta.type",function(e){e&&(t.humanStepTabs=e.tabs)}),void 0==t.step.allowSendEmail&&(t.step.allowSendEmail=!0),!t.step.emailTemplateSource&&t.step.allowSendEmail&&(t.step.emailTemplateSource={type:"default"}),t.$watch("step.allowSendEmail",function(e){e===!1?delete t.step.emailTemplateSource:e!==!0||t.step.emailTemplateSource||(t.step.emailTemplateSource={type:"default"})}),t.step.assignment?0==t.step.assignment.hasOwnProperty("initiatorCanCompleteTask")&&(t.step.assignment.initiatorCanCompleteTask=!0):t.step.assignment={initiatorCanCompleteTask:!0},t.taskDueDateOptions=[{id:"none",title:i.instant("PROCESS-BUILDER.FIELD.DUEDATE.TASK-DUE-DATE-OPTIONS.NO-DUEDATE")},{id:"static",title:i.instant("PROCESS-BUILDER.FIELD.DUEDATE.TASK-DUE-DATE-OPTIONS.STATIC")},{id:"field",title:i.instant("PROCESS-BUILDER.FIELD.DUEDATE.TASK-DUE-DATE-OPTIONS.FIELD")},{id:"variable",title:i.instant("PROCESS-BUILDER.FIELD.DUEDATE.TASK-DUE-DATE-OPTIONS.VARIABLE")}],t.step.taskDueDateOption&&0!==t.step.taskDueDateOption.length||(t.step.taskDueDateOption="none"),t.setAddCalculationType=function(){t.step.taskDueDateCalculationType="add"},t.setSubtractCalculationType=function(){t.step.taskDueDateCalculationType="subtract"},t.dueDateOptions=[{id:"none",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-DATE-OPTIONS.NO-TIMER")},{id:"duration",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-DATE-OPTIONS.DURATION")},{id:"property",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-DATE-OPTIONS.FIELD")},{id:"variable",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-DATE-OPTIONS.VARIABLE")}],t.dueActionOptions=[{id:"none",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.NO-ACTION")},{id:"reassign-task",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.REASSIGN.TITLE"),description:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.REASSIGN.DESCRIPTION")},{id:"keep-task",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.KEEP.TITLE"),description:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.KEEP.DESCRIPTION"),nextSteps:!0},{id:"end-task",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.END.TITLE"),description:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.END.DESCRIPTION"),nextSteps:!0},{id:"end-process",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.END-PROCESS.TITLE"),description:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.END-PROCESS.DESCRIPTION")}];var m;m=t.step.dueVariable?t.dueDateOptions[3]:t.step.dueField?t.dueDateOptions[2]:t.step.dueDuration?t.dueDateOptions[1]:t.dueDateOptions[0],t.step.meta.dueDateOption=m.id;var h;if(t.step.dueAction)for(var u=0;t.dueActionOptions.length>u;u++)if(t.dueActionOptions[u].id==t.step.dueAction){h=t.dueActionOptions[u];break}h||(h=t.dueActionOptions[0]),t.step.meta.dueActionOption=h,t.$watch("step.meta.dueActionOption",function(e){e?("reassign-task"!==e.id||t.step.dueAssignment||(t.step.dueAssignment={}),t.step.dueAction=e.id):t.step.dueAction=t.dueActionOptions[0].id}),t.$watch("step.meta.dueDateOption",function(e){"duration"===e?(t.step.dueDuration||(t.step.dueDuration={}),t.step.dueField=void 0,t.step.dueVariable=void 0):"variable"===e?(t.step.dueDuration=void 0,t.step.dueField=void 0):"property"===e?(t.step.dueDuration=void 0,t.step.dueVariable=void 0):(t.step.dueDuration=void 0,t.step.dueField=void 0,t.step.dueVariable=void 0,t.step.meta.dueActionOption=t.dueActionOptions[0])},!0),t.$watch("step.assignment",function(e){e&&d.updateStepSummary(t.step)},!0),t.selectForm=function(e){t.step.formDefinition,t.step.formDefinition=e,p.refresh()},t.createForm=function(){t.createFormCallback=function(e){var i={id:e.id,name:e.name,description:e.description};t.step.formDefinition=i,t.saveModelBeforeNavigation()},_internalCreateModal({template:"views/popup/form-create.html?version="+Date.now(),scope:t},a,t)},t.showForm=function(){t.saveModelBeforeNavigation()},t.saveModelBeforeNavigation=function(){if(e.readOnly)p.navigateForward("form-editor/"+encodeURIComponent(t.step.formDefinition.id),t.step.id);else{var i=e.currentKickstartModel.definition,o=function(){e.modelChanges=!1,p.navigateForward("form-editor/"+encodeURIComponent(t.step.formDefinition.id),t.step.id)},n={name:i.name,description:i.description,newVersion:!1};d.saveKickstartModel(i,n).then(o)}},t.$on("form-cache-changed",function(e,i){i&&i.stepId&&i.stepId===t.step.id&&(t.model.fieldsForCurrentForm.length=0,t.step.formDefinition&&Array.prototype.push.apply(t.model.fieldsForCurrentForm,p.getFormFieldsForForm(t.step.formDefinition.id)))}),t.step.formDefinition&&Array.prototype.push.apply(t.model.fieldsForCurrentForm,p.getFormFieldsForForm(t.step.formDefinition.id)),t.allSteps=d.getAllStepsArray(t.currentKickstartModel.definition.definition.steps),t.getRestResponseVariables=function(){return p.getVariablesForStep(t.allSteps,t.step.id,["date"])},t.selectTaskDueDateResponseVariable=function(e){t.step.taskDueDateVariable=e},t.selectTimerDueDateResponseVariable=function(e){t.step.dueVariable=e}}]),angular.module("activitiModeler").controller("EmailStepController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService",function(e,t,i,o,n,r,a,s,l,d){t.emailStepTabs=t.activeStep.meta.type.tabs,t.emailValuesChanged=function(){d.updateStepSummary(t.step)},t.step.recipient||(t.step.recipient={}),t.$watch("step.recipient",function(e){e&&d.updateStepSummary(t.step)
},!0),t.editExpressionText=function(e){t.expressionText={title:e},t.expressionText.value=t.step[e]?t.step[e]:"",t.resolveExpressionText=function(i){t.step[e]=i};var i={template:"views/process-builder/expression-text-popup.html?version="+Date.now(),scope:t};_internalCreateModal(i,a,t)},t.allSteps=d.getAllStepsArray(t.currentKickstartModel.definition.definition.steps)}]),angular.module("activitiModeler").controller("ChoiceStepController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService",function(e,t,i,o,n,r,a,s,l,d){function c(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1}for(var p=0;t.stencilSet.stepTypes.length>p;p++)if("choice-step"===t.stencilSet.stepTypes[p].id){t.choiceTabs=t.stencilSet.stepTypes[p].tabs;break}t.addChoice=function(){t.step.choices||(t.step.choices=[]),t.step.choices.push({name:i.instant("PROCESS-BUILDER.CHOICE-STEP.LABELS.NEW-CHOICE"),condition:{},steps:[]}),d.updateStepSummary(t.step)},t.nextChoice=function(){t.step.choices&&t.step.meta.stepIndex<t.step.choices.length-2&&(t.step.meta.stepIndex+=1,t.updateActiveChoices())},t.previousChoice=function(){t.step.choices&&t.step.meta.stepIndex>0&&(t.step.meta.stepIndex-=1,t.updateActiveChoices())},t.editChoice=function(e){var i={template:"views/process-builder/choice-step-choice-details.html?version="+Date.now(),scope:t};t.choiceName=angular.copy(e.name),t.expression=angular.copy(e.condition),t.isDefault=e.isDefault?!0:!1,t.choice=e,_internalCreateModal(i,a,t)},t.removeChoice=function(e,o){t.handleResponseFunction=function(i){if(i&&t.step.choices.length>2&&e){var o=t.activeChoices.indexOf(e);o>=0&&(t.step.choices.splice(t.step.meta.stepIndex+o,1),t.step.meta.stepIndex=0,t.updateActiveChoices())}},t.operationAction=i.instant("COMMON.OPERATION.DELETE"),_internalCreateModal({template:"editor-app/popups/yes-no-modal.html",scope:t},a,t),c(o)},t.$watch("step.choices",function(e){e&&t.updateActiveChoices()}),t.$watch("step.choices",function(e){e&&d.updateStepSummary(t.step)},!0),t.updateActiveChoices=function(){var e=t.step.choices,i=[];e[t.step.meta.stepIndex]&&i.push(e[t.step.meta.stepIndex]),e[t.step.meta.stepIndex+1]&&i.push(e[t.step.meta.stepIndex+1]),t.activeChoices=i},t.activeTab=t.step.meta.new?t.choiceTabs[1].id:t.choiceTabs[0].id,t.step.meta.stepIndex||0===t.step.meta.stepIndex||(t.step.meta.stepIndex=0),t.$watch("activeStep",function(e){e&&e.id===t.step.id||(t.activeTab=t.choiceTabs[1].id)})}]),angular.module("activitiModeler").controller("CustomStepController",["$rootScope","$scope","ProcessBuilderService",function(e,t,i){t.customStepTabs=t.activeStep.meta.type.tabs;for(var o=0;t.customStepTabs.length>o;o++)if(t.customStepTabs[o].properties)for(var n=0;t.customStepTabs[o].properties.length>n;n++){var r=t.customStepTabs[o].properties[n];"select-fields"===r.type&&(t.step[r.id]||(t.step[r.id]={}))}e.currentReadonlyFields={fields:{}},i.getAllFormsInModel(e.currentKickstartModel.definition.id).then(function(t){if(t&&t.length>0){for(var i={},o=[],n=0;t.length>n;n++){var r=t[n];if(r.fields)for(var a=0;r.fields.length>a;a++){var s=r.fields[a];"readonly"===s.type||"readonly-text"===s.type||i[s.id]||(i[s.id]=!0,o.push(s))}}e.currentReadonlyFields.fields.data=o}else e.currentReadonlyFields.fields.data=[];e.currentReadonlyFields.fields.loading=!1})}]),angular.module("activitiModeler").controller("SubProcessStepController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l,d,c){for(var p=0;t.stencilSet.stepTypes.lenth>p;p++)if("subprocess-step"===t.stencilSet.stepTypes[p].id){t.subProcessStepTabs=t.stencilSet.stepTypes[p].tabs;break}t.$on("$select.select",function(){e.safeApply(function(){})}),t.$watch("activeStep.meta.type",function(e){e&&(t.subProcessStepTabs=e.tabs)}),t.$watch("step.subProcessDefinition",function(e){e&&d.updateStepSummary(t.step)}),t.selectSubProcess=function(e){t.step.subProcessDefinition,t.step.subProcessDefinition=e,c.refresh()},t.createSubProcess=function(){t.createSubProcessCallback=function(e){var i={id:e.id,name:e.name,description:e.description};t.step.subProcessDefinition=i,t.saveModelBeforeNavigation()},_internalCreateModal({template:"views/popup/subprocess-create.html?version="+Date.now(),scope:t},a,t)},t.showSubProcess=function(){t.saveModelBeforeNavigation()},t.saveModelBeforeNavigation=function(){if(e.readOnly)c.navigateForward("kickstart-editor/"+encodeURIComponent(t.step.subProcessDefinition.id),t.step.id);else{var i=e.currentKickstartModel.definition,o=function(){e.modelChanges=!1,c.navigateForward("kickstart-editor/"+encodeURIComponent(t.step.subProcessDefinition.id),t.step.id)},n={name:i.name,description:i.description,newVersion:!1};d.saveKickstartModel(i,n).then(o)}}}]),angular.module("activitiModeler").controller("GotoStepController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService",function(e,t,i,o,n,r,a,s,l,d){for(var c=0;t.stencilSet.stepTypes.lenth>c;c++)if("goto-step"==t.stencilSet.stepTypes[c].id){t.gotoStepTabs=t.stencilSet.stepTypes[c].tabs;break}t.$watch("activeStep.meta.type",function(e){e&&(t.gotoStepTabs=e.tabs)}),t.selectStep=function(e){e&&(t.step.gotoStep={id:e.id,name:e.name,stepType:e.type})},t.$watch("step.gotoStep",function(e){e&&d.updateStepSummary(t.step)}),t.flattenSteps=function(e,i){for(var o=0;e.length>o;o++)if(e[o].choices)for(var n=0;e[o].choices.length>n;n++)e[o].choices[n].steps&&t.flattenSteps(e[o].choices[n].steps,i);else"goto-step"!==e[o].type&&i.push(e[o])};var p=[];t.flattenSteps(t.steps,p),t.flatStepArray=p}]),angular.module("activitiModeler").controller("EndProcessStepController",["$scope",function(e){e.endProcessStepTabs=e.activeStep.meta.type.tabs}]),angular.module("activitiModeler").controller("GoogleDriveCloudPublishStepController",["$rootScope","$scope","$translate","ProcessBuilderService","ContentAccountService","FormBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a){t.googleDriveSourceOptions=[{id:"process",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.ALL")},{id:"field",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.FIELD")}],t.step.meta.destinationUseSubfolder=void 0!=t.step.createFolderField,t.$watch("activeStep.meta.type",function(e){e&&(t.stepTabs=e.tabs,o.updateStepSummary(t.step))}),t.$watch("step.meta.googleDriveSourceOption",function(e){e&&("process"===e.id?(t.step.contentContainerField=void 0,t.step.source="process"):t.step.source="field")}),t.$watch("step.meta.destinationUseSubfolder",function(e){e||(t.step.createFolderField=void 0)}),t.selectDestinationFolder=function(e){e.path&&(t.step.path=e.path,t.step.account=e.account)},t.googleDriveAccount={selected:""},t.loadGoogleDriveAccounts=function(){t.contentGoogleDriveAccounts={loading:!0};var e=[];n.getAccounts().then(function(i){if(i&&i.data)for(var o=0;i.data.length>o;o++)i.data[o].serviceId&&i.data[o].serviceId.length>=12&&"google-drive"===i.data[o].serviceId.substring(0,12)&&(i.data[o].name=i.data[o].serviceId,e.push(i.data[o]));if(t.step.account)for(var o=0;e.length>o;o++)t.step.account&&e[o].serviceId===t.step.account.id?t.googleDriveAccount.selected=e[o]:"google-drive"===e[o].serviceId&&(t.googleDriveAccount.selected=e[o]);else t.googleDriveAccount.selected=e[0];t.contentGoogleDriveAccounts.rawList=e,t.contentGoogleDriveAccounts.loading=!1})},t.resetDestination=function(){t.step.path=void 0,t.step.user=void 0,t.step.userName=void 0,t.step.userEmail=void 0,t.step.userExternalId=void 0,t.step.account=void 0},t.addPublishAs=function(e,i){e?(t.step.user=e.id,t.step.userField=null,t.step.userName=e.firstName?e.firstName+" "+e.lastName:e.lastName,t.step.userEmail=e.email,t.step.userExternalId=e.externalId):(t.step.user=null,t.step.userField=i),t.step.publishAsType="user"},t.setPublishAs=function(e){"process_initiator"===e&&(t.step.user=void 0,t.step.userName=void 0,t.step.userExternalId=void 0,t.step.userEmail=void 0),t.step.publishAsType=e},t.step.publishAsType||(t.step.publishAsType="process_initiator"),t.allSteps=o.getAllStepsArray(t.currentKickstartModel.definition.definition.steps),t.loadGoogleDriveAccounts(),t.step.source?t.step.meta.googleDriveSourceOption="field"===t.step.source?t.googleDriveSourceOptions[1]:t.googleDriveSourceOptions[0]:t.step.contentContainerField?(t.step.meta.googleDriveSourceOption=t.googleDriveSourceOptions[1],t.step.source="field"):(t.step.meta.googleDriveSourceOption=t.googleDriveSourceOptions[0],t.step.source="process"),t.model.variableType="formField";var s=a.getFormFieldsForStep(t.allSteps,t.step.id,["upload"]),l=a.getVariablesForStep(t.allSteps,t.step.id,["document"]);if(t.step.contentContainerField){if(t.step.meta.googleDriveSourceOption=t.googleDriveSourceOptions[1],s&&s.length>0)for(var d=!1,c=0;s.length>c;c++)if(s[c].id===t.step.contentContainerField.id){t.model.variableType="formField",d=!0;break}if(!d&&l&&l.length>0)for(var c=0;l.length>c;c++)if(l[c].processVariableName===t.step.contentContainerField.id){t.model.variableType="variable";break}}else t.step.meta.googleDriveSourceOption=t.googleDriveSourceOptions[0]}]),angular.module("activitiModeler").controller("BoxCloudPublishStepController",["$rootScope","$scope","$translate","ProcessBuilderService","ContentAccountService","FormBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a){t.boxSourceOptions=[{id:"process",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.ALL")},{id:"field",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.FIELD")}],t.step.meta.destinationUseSubfolder=void 0!==t.step.createFolderField,t.$watch("activeStep.meta.type",function(e){e&&(t.stepTabs=e.tabs,o.updateStepSummary(t.step))}),t.$watch("step.meta.boxSourceOption",function(e){e&&("process"==e.id?(t.step.contentContainerField=void 0,t.step.source="process"):t.step.source="field")}),t.$watch("step.meta.destinationUseSubfolder",function(e){e||(t.step.createFolderField=void 0)}),t.selectDestinationFolder=function(e){e.path&&(t.step.path=e.path,t.step.account=e.account)},t.boxAccount={selected:""},t.loadBoxAccounts=function(){t.contentBoxAccounts={loading:!0};var e=[];n.getAccounts().then(function(i){if(i&&i.data)for(var o=0;i.data.length>o;o++)"box"===i.data[o].serviceId.substring(0,3)&&(i.data[o].name=i.data[o].serviceId,e.push(i.data[o]));if(t.step.account)for(var o=0;e.length>o;o++)t.step.account&&e[o].serviceId===t.step.account.id?t.boxAccount.selected=e[o]:"box"===e[o].serviceId&&(t.boxAccount.selected=e[o]);else t.boxAccount.selected=e[0];t.contentBoxAccounts.rawList=e,t.contentBoxAccounts.loading=!1})},t.resetDestination=function(){t.step.path=void 0,t.step.user=void 0,t.step.userEmail=void 0,t.step.userExternalId=void 0,t.step.userName=void 0,t.step.account=void 0},t.addPublishAs=function(e,i){e?(t.step.user=e.id,t.step.userField=null,t.step.userName=e.firstName?e.firstName+" "+e.lastName:e.lastName,t.step.userEmail=e.email,t.step.userExternalId=e.externalId):(t.step.user=null,t.step.userEmail=null,t.step.userExternalId=null,t.step.userField=i),t.step.publishAsType="user"},t.setPublishAs=function(e){"process_initiator"===e&&(t.step.user=void 0,t.step.userName=void 0,t.step.userEmail=void 0,t.step.userExternalId=void 0),t.step.publishAsType=e},t.step.publishAsType||(t.step.publishAsType="process_initiator"),t.allSteps=o.getAllStepsArray(t.currentKickstartModel.definition.definition.steps),t.loadBoxAccounts(),t.step.source?t.step.meta.boxSourceOption="field"===t.step.source?t.boxSourceOptions[1]:t.boxSourceOptions[0]:t.step.contentContainerField?(t.step.meta.boxSourceOption=t.boxSourceOptions[1],t.step.source="field"):(t.step.meta.boxSourceOption=t.boxSourceOptions[0],t.step.source="process"),t.isMetaDataAllowed=!1,n.isBoxMetaDataAllowed().then(function(e){t.isMetaDataAllowed=e}),t.model.variableType="formField";var s=a.getFormFieldsForStep(t.allSteps,t.step.id,["upload"]),l=a.getVariablesForStep(t.allSteps,t.step.id,["document"]);if(t.step.contentContainerField){if(t.step.meta.boxSourceOption=t.boxSourceOptions[1],s&&s.length>0)for(var d=!1,c=0;s.length>c;c++)if(s[c].id===t.step.contentContainerField.id){t.model.variableType="formField",d=!0;break}if(!d&&l&&l.length>0)for(var c=0;l.length>c;c++)if(l[c].processVariableName===t.step.contentContainerField.id){t.model.variableType="variable";break}}else t.step.meta.boxSourceOption=t.boxSourceOptions[0]}]),angular.module("activitiModeler").controller("RestCallStepController",["$rootScope","$scope","$translate","$timeout","$modal","ProcessBuilderService","uiGridConstants","EndpointUtilService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l){t.restEndpointFieldTypes=["text","integer","amount","boolean","dropdown","typeahead","people","functional-group","radio-buttons","upload"],t.insertRestUrlField={position:0},t.$watch("activeStep.meta.type",function(e){e&&(t.stepTabs=e.tabs,r.updateStepSummary(t.step))}),t.$watch("insertFormField.field",function(e){if(e){var i="${"+e.id+"}";t.insertFormField.field=void 0,o(function(){t.aceEditor.insert(i)},200)}}),t.setAceEditor=function(e){t.aceEditor=e,o(function(){e.focus()})},t.endpointLabel=function(e,t,i,o,n){return s.getEndpointLabel(e,t,i,o,n)},t.loadBaseEndpoints=function(){s.getAllEndpointConfigurations().then(function(e){t.endpointConfigurations=e})},t.httpMethods=["GET","POST","PUT","DELETE"],t.step.httpMethod||(t.step.httpMethod=t.httpMethods[0]);var d="keyValue";void 0!=t.step.requestMappingJSONTemplate&&t.step.requestMappingJSONTemplate.length>0&&(d="jsonTemplate"),t.model={urlFieldType:"formField",jsonFieldType:"formField",requestMappingType:d,requestMappingValues:[]},t.setUrlFieldType=function(e){"restResponse"===e?t.model={urlFieldType:"restResponse"}:"formField"===e&&(t.model={urlFieldType:"formField"})},t.getFullEndpointURL=function(){return s.getFullEndpointURL(t.step.endpoint,t.step.restUrl)},t.executeEndpointTest=function(){_internalCreateModal({template:"views/popup/endpoint-check-test-values.html?version="+Date.now(),scope:t},n,t)},t.jsonTypes=["string","boolean","long","date"],t.step.requestMappings||(t.step.requestMappings=[]),t.step.requestMappingJSONTemplate||(t.step.requestMappingJSONTemplate=""),t.insertFormField={position:0};var c=i.instant("PROCESS-BUILDER.REST-CALL-STEP.REQUEST-MESSAGE.JSON-PROPERTY"),p=i.instant("PROCESS-BUILDER.REST-CALL-STEP.REQUEST-MESSAGE.JSON-VALUE");t.requestMessageGridOptions={data:t.step.requestMappings,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,unselect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"jsonPropertyValue",displayName:p,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnValue(row.entity)}}</div>'},{field:"jsonPropertyName",displayName:c}]},t.requestMessageGridOptions.onRegisterApi=function(e){t.requestMessageGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedRequestMapping=e.isSelected?e.entity:void 0})},t._getVariableColumnValue=function(e){var t="";return e?(e.jsonPropertyValueFormField?t=e.jsonPropertyValueFormField.name:e.jsonPropertyValueRestResponseField?t=e.jsonPropertyValueRestResponseField.name:e.jsonPropertyValue&&""!=e.jsonPropertyValue&&(t=e.jsonPropertyValue),t):t},t.addNewRequestMapping=function(){t.popup={selectedRequestMapping:{jsonPropertyType:t.jsonTypes[0]}},_internalCreateModal({template:"views/popup/map-json-request.html?version="+Date.now(),scope:t},n,t)},t.setRequestMappingType=function(e){t.model.requestMappingType=e},t.setJSONFieldType=function(e){t.model.jsonFieldType=e},t.removeRequestMapping=function(){if(t.selectedRequestMapping){var e=t.step.requestMappings.indexOf(t.selectedRequestMapping);t.requestMessageGridApi.selection.toggleRowSelection(t.selectedRequestMapping),t.step.requestMappings.splice(e,1),o(function(){t.step.requestMappings.length>0?t.requestMessageGridApi.selection.toggleRowSelection(t.step.requestMappings[0]):t.selectedRequestMapping=void 0})}},t.editRequestMapping=function(){t.popup={selectedRequestMapping:{jsonPropertyName:t.selectedRequestMapping.jsonPropertyName,jsonPropertyType:t.selectedRequestMapping.jsonPropertyType,jsonPropertyValue:t.selectedRequestMapping.jsonPropertyValue,jsonPropertyValueFormField:t.selectedRequestMapping.jsonPropertyValueFormField,jsonPropertyValueRestResponseField:t.selectedRequestMapping.jsonPropertyValueRestResponseField}},t.popup.selectedRequestMapping.jsonPropertyValueType=t.selectedRequestMapping.jsonPropertyValueFormField?"field":t.selectedRequestMapping.jsonPropertyValueRestResponseField?"restResponse":"static",t.popup.selectedRequestMapping.state="edit",_internalCreateModal({template:"views/popup/map-json-request.html?version="+Date.now(),scope:t},n,t)},t.showRequestMapping=function(){t.popup={selectedRequestMapping:t.selectedRequestMapping},t.selectedRequestMapping.jsonPropertyValueFormField?t.popup.selectedRequestMapping.jsonPropertyValueType="field":t.selectedRequestMapping.jsonPropertyValueRestResponseField&&(t.popup.selectedRequestMapping.jsonPropertyValueType="restResponse"),t.popup.selectedRequestMapping.state="view",_internalCreateModal({template:"views/popup/map-json-request.html?version="+Date.now(),scope:t},n,t)},t.setRequestMessageStaticValue=function(){t.popup.selectedRequestMapping.jsonPropertyValueType="static",t.popup.selectedRequestMapping.jsonPropertyValueRestResponseField=void 0,t.popup.selectedRequestMapping.jsonPropertyValueFormField=void 0},t.setRequestMessageFormFieldValue=function(){t.popup.selectedRequestMapping.jsonPropertyValueType="field",t.popup.selectedRequestMapping.jsonPropertyValueRestResponseField=void 0,t.popup.selectedRequestMapping.jsonPropertyValue=void 0},t.setRequestMessageRestResponseValue=function(){t.popup.selectedRequestMapping.jsonPropertyValueType="restResponse",t.popup.selectedRequestMapping.jsonPropertyValue=void 0,t.popup.selectedRequestMapping.jsonPropertyValueFormField=void 0},t.cancelRequestMapping=function(){t.popup.selectedRequestMapping=void 0,t.modal.hide()},t.okRequestMapping=function(){"edit"===t.popup.selectedRequestMapping.state&&(t.selectedRequestMapping.jsonPropertyName=t.popup.selectedRequestMapping.jsonPropertyName,t.selectedRequestMapping.jsonPropertyType=t.popup.selectedRequestMapping.jsonPropertyType,t.selectedRequestMapping.jsonPropertyValue=t.popup.selectedRequestMapping.jsonPropertyValue,t.selectedRequestMapping.jsonPropertyValueFormField=t.popup.selectedRequestMapping.jsonPropertyValueFormField,t.selectedRequestMapping.jsonPropertyValueRestResponseField=t.popup.selectedRequestMapping.jsonPropertyValueRestResponseField,t.requestMessageGridApi.core.notifyDataChange(a.dataChange.ALL),t.requestMessageGridApi.selection.toggleRowSelection(t.selectedRequestMapping)),"edit"!=t.popup.selectedRequestMapping.state&&(t.popup.selectedRequestMapping.jsonPropertyValueType=void 0,t.step.requestMappings.push(t.popup.selectedRequestMapping)),t.popup.selectedRequestMapping.jsonPropertyValueFormField&&(void 0!=t.popup.selectedRequestMapping.jsonPropertyValueFormField.currency&&delete t.popup.selectedRequestMapping.jsonPropertyValueFormField.currency,void 0!=t.popup.selectedRequestMapping.jsonPropertyValueFormField.enableFractions&&delete t.popup.selectedRequestMapping.jsonPropertyValueFormField.enableFractions),t.popup.selectedRequestMapping=void 0,t.modal.hide()},t.step.responseMappings||(t.step.responseMappings=[]);var u=i.instant("PROCESS-BUILDER.REST-CALL-STEP.RESPONSE-MESSAGE.JSON-PROPERTY"),m=i.instant("PROCESS-BUILDER.REST-CALL-STEP.RESPONSE-MESSAGE.PROCESS-VARIABLE");t.responseMessageGridOptions={data:t.step.responseMappings,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"jsonPropertyName",displayName:u},{field:"processVariableName",displayName:m}]},t.responseMessageGridOptions.onRegisterApi=function(e){t.responseMessageGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedResponseMapping=e.isSelected?e.entity:void 0})},t.addNewResponseMapping=function(){t.selectedResponseMapping={processVariableType:t.jsonTypes[0]},_internalCreateModal({template:"views/popup/map-json-response.html?version="+Date.now(),scope:t},n,t)},t.removeResponseMapping=function(){if(t.selectedResponseMapping){var e=t.step.responseMappings.indexOf(t.selectedResponseMapping);t.responseMessageGridApi.selection.toggleRowSelection(t.selectedResponseMapping),t.step.responseMappings.splice(e,1),o(function(){t.step.responseMappings.length>0?t.responseMessageGridApi.selection.toggleRowSelection(t.step.responseMappings[0]):t.selectedResponseMapping=void 0})}},t.editResponseMapping=function(){t.selectedResponseMapping.state="edit",_internalCreateModal({template:"views/popup/map-json-response.html?version="+Date.now(),scope:t},n,t)},t.showResponseMapping=function(){t.selectedResponseMapping.state="view",_internalCreateModal({template:"views/popup/map-json-response.html?version="+Date.now(),scope:t},n,t)},t.cancelResponseMapping=function(){t.selectedResponseMapping.state=void 0,t.modal.hide()},t.okResponseMapping=function(){"edit"!=t.selectedResponseMapping.state&&(t.selectedResponseMapping.state=void 0,t.step.responseMappings.push(t.selectedResponseMapping)),t.selectedResponseMapping.state=void 0,t.responseMessageGridApi.selection.toggleRowSelection(t.selectedResponseMapping),t.selectedResponseMapping=void 0,t.modal.hide()},t.$watch("step.responseMappings",function(e,i){if(i!=e&&e){for(var o=[],n=0;e.length>n;n++){var r={jsonPropertyName:e[n].jsonPropertyName,processVariableName:e[n].processVariableName,processVariableType:e[n].processVariableType};o.push(r)}l.updateResponseVariablesCache(t.step.id,o)}},!0),t.allSteps=r.getAllStepsArray(t.currentKickstartModel.definition.definition.steps),t.loadBaseEndpoints(),t.showEndpointTest=function(){return ACTIVITI.CONFIG&&ACTIVITI.CONFIG.onPremise?ACTIVITI.CONFIG.onPremise:!1}}]),angular.module("activitiModeler").controller("AlfrescoActionStepController",["$rootScope","$scope","$translate","$timeout","$modal","ProcessBuilderService","uiGridConstants","EndpointUtilService","ContentAccountService","AlfrescoOneService",function(e,t,i,o,n,r,a,s,l,d){"use strict";t.fieldTypes=["upload"],t.addPublishAs=function(e,i){e?(t.step.user=e.id,t.step.userField=null,t.step.userName=e.firstName?e.firstName+" "+e.lastName:e.lastName,t.step.userEmail=e.email,t.step.userExternalId=e.externalId):(t.step.user=null,t.step.userField=i,t.step.userEmail=null,t.step.userExternalId=null),t.step.publishAsType="user"},t.presets=[],d.getContentActionTemplates().then(function(e){t.presets=e||[]}),t.onPresetSelected=function(e,i){e.preventDefault(),t.step.actionName=i.name,c.splice(0,c.length),Array.prototype.push.apply(c,i.params),t.saveActionParams(),t.selectedActionParam=void 0,t.gridApi.selection.clearSelectedRows()},t.setPublishAs=function(e){"process_initiator"===e&&(t.step.user=void 0,t.step.userName=void 0,t.step.userEmail=void 0,t.step.userExternalId=void 0),t.step.publishAsType=e},t.step.publishAsType||(t.step.publishAsType="process_initiator"),t.setInputSourceType=function(e){t.step.inputSourceType=e,t.step.inputSourceField=null},t.$watch("activeStep.meta.type",function(e){e&&(t.stepTabs=e.tabs,r.updateStepSummary(t.step))});var c=[];if(t.step.actionParams){var p=JSON.parse(t.step.actionParams);c=Object.keys(p).map(function(e){return{name:e,value:p[e]}})}t.gridOptions={data:c,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:i.instant("PROCESS-BUILDER.UI-GRID.HEADER-COLUMN-NAME")},{field:"value",displayName:i.instant("PROCESS-BUILDER.UI-GRID.HEADER-COLUMN-VALUE")}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedActionParam=e.isSelected?e.entity:void 0,t.focusFirstField()})},t.focusFirstField=function(){o(function(){var e=document.getElementById("headerName");e&&e.focus()},100)},t.addNewActionParam=function(){var e={name:"",value:""};c.push(e),t.selectedActionParam=e,t.gridApi.core.notifyDataChange(a.dataChange.ALL),o(function(){t.gridApi.selection.toggleRowSelection(t.selectedActionParam)})},t.removeActionParam=function(){if(t.selectedActionParam){var e=c.indexOf(t.selectedActionParam);t.gridApi.selection.toggleRowSelection(t.selectedActionParam),c.splice(e,1),t.saveActionParams(),t.gridApi.core.notifyDataChange(a.dataChange.ALL),t.selectedActionParam=void 0,o(function(){c.length>0&&t.gridApi.selection.toggleRowSelection(c[0])})}},t.saveActionParams=function(){var e="";if(c.length>0){var i={};c.map(function(e){e&&e.name&&(i[e.name]=e.value)}),e=JSON.stringify(i)}t.step.actionParams=e},t.allSteps=r.getAllStepsArray(t.currentKickstartModel.definition.definition.steps),t.alfrescoAccount={selected:""},t.loadAlfrescoAccounts=function(){t.contentAlfrescoAccounts={loading:!0,onPrem:!1};var e=[],i=!1,o=!0;l.getAccounts().then(function(n){if(n&&n.data)for(var r=0;n.data.length>r;r++)o&&"alfresco-cloud"===n.data[r].serviceId||"alfresco-"===n.data[r].serviceId.substring(0,9)&&(e.push(n.data[r]),"alfresco-cloud"!==n.data[r].serviceId&&i===!1?i=!0:"alfresco-cloud"===n.data[r].serviceId&&(n.data[r].name="Alfresco Cloud"));if(t.step.account)for(var r=0;e.length>r;r++)t.step.account&&l.getAlfrescoServiceIdsMatch(e[r].serviceId,t.step.account.id)&&(t.alfrescoAccount.selected=e[r]);else t.alfrescoAccount.selected=e[0],t.onAccountChanged();t.contentAlfrescoAccounts.onPrem=i,t.contentAlfrescoAccounts.rawList=e,t.contentAlfrescoAccounts.loading=!1})},t.onAccountChanged=function(){var e=t.alfrescoAccount.selected;t.step.account=e?{id:e.serviceId,name:e.name}:null},t.loadAlfrescoAccounts()}]),angular.module("activitiModeler").controller("ValidateKickstartModelCtrl",["$rootScope","$scope","$translate","$timeout",function(e,t,i){t.shapeValidationErrors=[];var o;o="process"===t.currentStep?"process":"start-event"===t.currentStep?"start-event":t.currentStep.id;for(var n=0;e.currentKickstartValidationErrors.length>n;n++){var r=e.currentKickstartValidationErrors[n];if(r.id===o){if(r.problem){var a=r.problem.toUpperCase(),s=i.instant("ERRORS."+a);s!=="ERRORS."+a&&(r.defaultDescription=s)}t.shapeValidationErrors.push(r)}}t.gridOptions={data:t.shapeValidationErrors,headerRowHeight:28,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"defaultDescription",displayName:i.instant("MODEL.VALIDATION.ERRORS.DESCRIPTION")},{field:"warning",displayName:i.instant("MODEL.VALIDATION.ERRORS.WARNING"),width:100},{field:"validatorSetName",displayName:i.instant("MODEL.VALIDATION.ERRORS.SET"),width:200}]},t.ok=function(){t.$hide()},t.close=function(){t.$hide()}}]),angular.module("activitiModeler").controller("CreateNewSubProcessCtrl",["$rootScope","$scope","$http","EventTrackingService",function(e,t,i,o){t.model={loading:!1,subProcess:{name:"",description:"",referenceId:e.currentKickstartModel.definition.id,modelType:1}},t.ok=function(){t.model.subProcess.name&&0!=t.model.subProcess.name.length&&(t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",data:t.model.subProcess}).success(function(e){t.$hide(),o.trackEvent("editor","subprocess-created"),t.model.loading=!1,t.createSubProcessCallback&&(t.createSubProcessCallback(e),t.createSubProcessCallback=void 0)}).error(function(){t.model.loading=!1,t.$hide()}))},t.cancel=function(){t.model.loading||t.$hide()}}]),angular.module("activitiModeler").controller("StepEndpointCheckController",["$rootScope","$scope","EndpointUtilService","FormBuilderService","ProcessScopeService",function(e,t,i,o,n){var r,a,s,l,d,c=[];if(t.step)t.step.httpMethod&&""!=t.step.httpMethod&&(r=t.step.httpMethod),t.step.restUrl&&""!=t.step.restUrl&&(a=t.step.restUrl),t.step.endpoint&&(s=t.step.endpoint),t.step.requestMappings&&(d=t.step.requestMappings),t.step.requestMappingJSONTemplate&&(l=t.step.requestMappingJSONTemplate),t.step.requestHeaders&&(c=t.step.requestHeaders);else if(t.formElement)return;var p=function(){if(i.isTestDataNeeded(a,d,l,c)){var e=n.getFormFieldsForStep(t.allSteps,t.step.id),o=n.getVariablesForStep(t.allSteps,t.step.id);t.testDataFields=i.getTestDataFields(a,e,o,d,l,c)}else i.executeEndpointCheck(r,s,a,l).then(function(e){t.requestResult=e,t.formattedResult=i.getFormattedRequestResult(e)})};t.isRequestSuccessful=function(){var e=!1;return t.requestResult&&t.requestResult.statusCode&&t.requestResult.statusCode>=200&&400>t.requestResult.statusCode&&(e=!0),e},t.cancel=function(){t.$hide()},t.ok=function(){i.executeEndpointCheck(r,s,a,l,t.testDataFields).then(function(e){t.requestResult=e,t.formattedResult=i.getFormattedRequestResult(e)})},t.back=function(){delete t.requestResult},p()}]),angular.module("activitiModeler").controller("GenerateDocumentStepController",["$rootScope","$scope","$translate","ProcessBuilderService","ContentAccountService","$location","$timeout","Upload","DocumentTemplateService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l,d){t.step.outputFormat||(t.step.outputFormat="pdf"),t.$watch("activeStep.meta.type",function(e){e&&(t.stepTabs=e.tabs,o.updateStepSummary(t.step))}),t.selectTemplate=function(e){t.step.template={id:e.id,name:e.name}},t.documentTemplateModel={currentTab:"tenantTemplates",currentTemplateDownloadUrl:"",nameFilter:"",sort:"sort_by_name_asc",page:0,pageSize:20,possibleSorts:[{id:"sort_by_name_asc",title:"PROPERTY.GENERATEDOCUMENT.TEMPLATE.SORT-NAME-ASC"},{id:"sort_by_name_desc",title:"PROPERTY.GENERATEDOCUMENT.TEMPLATE.SORT-NAME-DESC"},{id:"sort_by_create_date_asc",title:"PROPERTY.GENERATEDOCUMENT.TEMPLATE.SORT-CREATED-ASC"},{id:"sort_by_create_date_desc",title:"PROPERTY.GENERATEDOCUMENT.TEMPLATE.SORT-CREATED-DESC"}]},t.onNewUploadSelected=function(i,o){for(var n=0;i.length>n;n++){var r,a=i[n],l=a.name.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"});r=o?ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/document-templates/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/document-templates",s.upload({url:r,method:"POST",params:{modelId:e.currentKickstartModel.definition.id},file:a,fileName:l}).progress(function(e){t.documentTemplateModel.loading=!0,t.documentTemplateModel.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(e){null!==e.id&&void 0!==e.id&&t.selectTemplate(e),t.documentTemplateModel.loading=!1}).error(function(e){e&&e.message&&(t.documentTemplateModel.errorMessage=e.message),t.documentTemplateModel.error=!0,t.documentTemplateModel.loading=!1})}},t.fetchDocumentTemplates=function(){t.documentTemplateModel.loadingDocumentTemplates=!0,l.findAllDocumentTemplates(t.documentTemplateModel.nameFilter,t.documentTemplateModel.sort,t.documentTemplateModel.page,t.documentTemplateModel.pageSize).then(function(e){t.documentTemplateModel.templates=e,t.documentTemplateModel.moreTemplates=e.total>(t.documentTemplateModel.page+1)*t.documentTemplateModel.pageSize;for(var i=0;t.documentTemplateModel.templates.data.length>i;i++)t.documentTemplateModel.templates.data[i].downloadUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/document-templates/"+t.documentTemplateModel.templates.data[i].id+"/file?version="+Date.now();t.documentTemplateModel.loadingDocumentTemplates=!1})},t.fetchDocumentTemplates(),t.$watch("step.variable",function(e,i){if(i!==e&&e){var o=[{processVariableName:e,processVariableType:"document"}];d.updateResponseVariablesCache(t.step.id,o)}},!0)}]),angular.module("activitiModeler").controller("DecisionStepController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l,d,c){t.model={},t.model.fieldsForCurrentDecisionTable=[];
for(var p=0;t.stencilSet.stepTypes.lenth>p;p++)if("decision-step"==t.stencilSet.stepTypes[p].id){t.humanStepTabs=t.stencilSet.stepTypes[p].tabs;break}t.$on("$select.select",function(){e.safeApply(function(){})}),t.decisionStepTabs=t.activeStep.meta.type.tabs,t.$watch("activeStep.meta.type",function(e){e&&(t.humanStepTabs=e.tabs)}),t.selectDecisionTable=function(e){t.step.decisionTableDefinition,t.step.decisionTableDefinition=e,c.refresh()},t.createDecisionTable=function(){t.createDecisionTableCallback=function(e){var i={id:e.id,name:e.name,description:e.description};t.step.decisionTableDefinition=i,t.saveModelBeforeNavigation()},_internalCreateModal({template:"views/popup/decision-table-create.html?version="+Date.now(),scope:t},a,t)},t.showDecisionTable=function(){t.saveModelBeforeNavigation()},t.saveModelBeforeNavigation=function(){if(e.readOnly)c.navigateForward("decision-table-editor/"+encodeURIComponent(t.step.decisionTableDefinition.id),t.step.id);else{var i=e.currentKickstartModel.definition,o=function(){e.modelChanges=!1,c.navigateForward("decision-table-editor/"+encodeURIComponent(t.step.decisionTableDefinition.id),t.step.id)},n={name:i.name,description:i.description,newVersion:!1};d.saveKickstartModel(i,n).then(o)}},t.allSteps=d.getAllStepsArray(t.currentKickstartModel.definition.definition.steps)}]),angular.module("activitiModeler").controller("RestCallStepHeadersController",["$rootScope","$scope","$q","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","uiGridConstants",function(e,t,i,o,n,r,a,s,l,d,c,p){t.selectedRequestHeaders=[],t.labels=[],t.step.requestHeaders&&0!==t.step.requestHeaders.length||(t.step.requestHeaders=[]),t.restHeaderConfig={position:0,field:""},t.selectedRequestHeader=void 0,t.labels.idLabel=o.instant("FORM-BUILDER.COMPONENT.REQUEST-HEADER-NAME"),t.labels.nameLabel=o.instant("FORM-BUILDER.COMPONENT.REQUEST-HEADER-VALUE"),t.gridOptions={data:t.step.requestHeaders,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:t.labels.idLabel,cellClass:function(e,t,i){return""===e.getCellValue(t,i)||0==e.getCellValue(t,i)?"dynamicTable-cellError":void 0}},{field:"value",displayName:t.labels.nameLabel,cellClass:function(e,t,i){return""===e.getCellValue(t,i)||0==e.getCellValue(t,i)?"dynamicTable-cellError":void 0}}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedRequestHeader=e.entity,t.focusFirstField()})},t.focusFirstField=function(){r(function(){var e=document.getElementById("headerName");e&&e.focus()},100)};var u=t.$watch("endpointConfigurations",function(){if(t.step.endpoint&&t.endpointConfigurations)for(var e=0;t.endpointConfigurations.length>e;e++)if(t.step.endpoint.id===t.endpointConfigurations[e].id){t.step.endpoint=t.endpointConfigurations[e];break}u()});t.$watch("step.endpoint",function(e,i){if(t.step.requestHeaders.length>0&&i&&i.requestHeaders&&i.requestHeaders.length>0){for(var o=angular.copy(t.step.requestHeaders),n={},r=0;i.requestHeaders.length>r;r++)n[i.requestHeaders[r].name]=i.requestHeaders[r].value;for(var a=[],r=0;o.length>r;r++)void 0===n[o[r].name]&&a.push(o[r]);t.step.requestHeaders=a,t.gridOptions.data=t.step.requestHeaders}if(t.step.endpoint&&t.step.endpoint.requestHeaders&&t.step.endpoint.requestHeaders.length>0){for(var s={},r=0;t.step.requestHeaders.length>r;r++)s[t.step.requestHeaders[r].name]=t.step.requestHeaders[r].value;for(var r=0;t.step.endpoint.requestHeaders.length>r;r++)if(void 0===s[t.step.endpoint.requestHeaders[r].name]){var l={name:t.step.endpoint.requestHeaders[r].name,value:t.step.endpoint.requestHeaders[r].value};t.step.requestHeaders.push(l)}}}),t.$watch("selectedRequestHeader.value",function(){t.gridApi.core.notifyDataChange(p.dataChange.ALL)},!0),t.$watch("restHeaderConfig.field",function(e){if(e){var i=t.selectedRequestHeader.value,o="${"+e.id+"}";i=i?i.substring(0,t.restHeaderConfig.position)+o+i.substring(t.restHeaderConfig.position):o,t.restHeaderConfig.field=void 0,r(function(){var e=angular.element("#rest-header-value");e.focus(),e.val(i),t.selectedRequestHeader.value=i},200)}}),t.addNewRequestHeader=function(){var e={name:"",value:""};t.step.requestHeaders.push(e),t.selectedRequestHeader=e,t.gridApi.core.notifyDataChange(p.dataChange.ALL),r(function(){t.gridApi.selection.toggleRowSelection(t.selectedRequestHeader)})},t.removeRequestHeader=function(){if(t.selectedRequestHeader){var e=t.step.requestHeaders.indexOf(t.selectedRequestHeader);t.gridApi.selection.toggleRowSelection(t.selectedRequestHeader),t.step.requestHeaders.splice(e,1),t.gridApi.core.notifyDataChange(p.dataChange.ALL),t.selectedRequestHeader=void 0,r(function(){t.step.requestHeaders.length>0&&t.gridApi.selection.toggleRowSelection(t.step.requestHeaders[0])})}},t.model={headerFieldType:"formField"},t.setUrlFieldType=function(e){"restResponse"===e?t.model={headerFieldType:"restResponse"}:"formField"===e&&(t.model={headerFieldType:"formField"})}}]),angular.module("activitiModeler").controller("AlfrescoCloudPublishStepController",["$rootScope","$scope","$translate","ProcessBuilderService","AlfrescoService","FormBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a){t.step.meta.alfrescoSourceOption=t.step.source,t.alfrescoSourceOptions=[{id:"process",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.ALL")},{id:"field",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.FIELD")}],t.allowedTypes=["upload"],t.model={currentTab:"documentDefinition"},t.step.meta.destinationUseSubfolder=void 0!==t.step.createFolderField,t.$watch("activeStep.meta.type",function(e){e&&(t.stepTabs=e.tabs,o.updateStepSummary(t.step))}),t.$watch("step.meta.alfrescoSourceOption",function(e){e&&("process"===e.id&&(t.step.contentContainerField=void 0),t.step.source=e.id)}),t.$watch("step.meta.destinationUseSubfolder",function(e){e||(t.step.createFolderField=void 0)}),t.selectDestinationFolder=function(e){e.site&&e.path&&(e.network&&(t.step.network=e.network),t.step.site=e.site,t.step.path=e.path,t.step.account=e.account)},t.alfrescoAccount={selected:""},t.resetDestination=function(){t.step.network=void 0,t.step.site=void 0,t.step.path=void 0,t.step.user=void 0,t.step.userName=void 0,t.step.userEmail=void 0,t.step.userExternalId=void 0,t.step.account=void 0},t.addPublishAs=function(e,i){e?(t.step.user=e.id,t.step.userField=null,t.step.userName=e.firstName?e.firstName+" "+e.lastName:e.lastName,t.step.userEmail=e.email,t.step.userExternalId=e.externalId):(t.step.user=null,t.step.userField=i),t.step.publishAsType="user"},t.setPublishAs=function(e){"process_initiator"===e&&(t.step.user=void 0,t.step.userName=void 0,t.step.userEmail=void 0,t.step.userExternalId=void 0),t.step.publishAsType=e},t.step.publishAsType||(t.step.publishAsType="process_initiator"),t.setActiveContentTab=function(e){t.activeContentTab=e},t.allSteps=o.getAllStepsArray(t.currentKickstartModel.definition.definition.steps),t.model.variableType="formField";var s=a.getFormFieldsForStep(t.allSteps,t.step.id,["upload"]),l=a.getVariablesForStep(t.allSteps,t.step.id,["document"]);if(t.step.contentContainerField){t.step.meta.alfrescoSourceOption=t.alfrescoSourceOptions[1];var d=!1;if(s&&s.length>0)for(var c=0;s.length>c;c++)if(s[c].id===t.step.contentContainerField.id){t.model.variableType="formField",d=!0;break}if(!d&&l&&l.length>0)for(var c=0;l.length>c;c++)if(l[c].processVariableName===t.step.contentContainerField.id){t.model.variableType="variable";break}}else t.step.meta.alfrescoSourceOption=t.alfrescoSourceOptions[0];t.contentAlfrescoAccounts=n.loadAlfrescoAccounts(t.alfrescoAccount,t.step.account,t.step.network)}]),angular.module("activitiModeler").controller("KickstartModelDesignController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l,d,c){function p(e,t){return e?d.getIndexInContainer(e,t)+1:0}function u(e){return d.getStepArrayForContainer(e?e:t.steps)}function m(e,t){return e&&t.step.id===e.id}function h(e,t){return"choice-step"===e.step.type&&t}function f(e,t){return"goto-step"===e.step.type&&!t}function g(e,t){return"human-step"===e.step.type&&t&&t.id===e.step.id}t.insertStepBelow=function(e,i,o){var n,r=u(o);if(t.moveState){if(t.isMoveDisabled(i,o))return;return n=p(i,r),t.confirmMove(r,n),void 0}if(!t.insertState){n=p(i,r);var a={};t.insertState=a;var s=[];if(o){for(var m=0;t.stencilSet.stepTypes.length>m;m++)t.stencilSet.stepTypes[m].isContainer||(t.stencilSet.stepTypes[m].hasOwnProperty("showInChoiceContainer")?t.stencilSet.stepTypes[m].showInChoiceContainer&&o&&o.steps&&o.condition?s.push(t.stencilSet.stepTypes[m]):t.stencilSet.stepTypes[m].showInTimerOverdueContainer&&o&&"human-step"===o.type&&o.meta&&o.meta.dueActionOption&&o.meta.dueActionOption.nextSteps&&s.push(t.stencilSet.stepTypes[m]):s.push(t.stencilSet.stepTypes[m]));a.types=s}else{for(var m=0;t.stencilSet.stepTypes.length>m;m++)t.stencilSet.stepTypes[m].hasOwnProperty("showInChoiceContainer")||s.push(t.stencilSet.stepTypes[m]);a.types=s}a.confirm=function(e){var i=d.addStepToContainer(r,e,n,t.stencilSet.stepTypes);if(t.toggleActiveStep(i),"custom-step"===i.type&&i.meta&&i.meta.type&&i.meta.type.custom){var o=i.meta.type.custom.variables;if(o&&o.length>0){for(var s=[],l=0;o.length>l;l++)s.push({processVariableName:o[l].name,processVariableType:o[l].type});c.updateCustomStencilVariablesCache(i.id,s)}}a.popover.hide()},a.popover=l(angular.element(e.target),{template:"views/popover/insert-step-popover.html?version="+Date.now(),placement:"bottom",show:!0,scope:t}),a.popover.$scope.$on("tooltip.hide",function(){a.popover.destroy(),delete t.insertState})}},t.confirmMove=function(e,i){t.moveState&&(d.moveStep(t.moveState.step,t.moveState.container,e,i),t.moveState.step.meta.moving=!1,delete t.moveState)},t.toggleActiveStep=function(e){t.model.processStart.expanded=!1,t.activeStep&&t.activeStep.meta.new&&(t.activeStep.meta.new=!1),t.activeStep=e?t.activeStep?t.activeStep.id===e.id?void 0:e:e:void 0},t.removeStep=function(e,i){if(e){if(i=i?i:t.steps,"custom-step"===e.type&&e.meta&&e.meta.type&&e.meta.type.custom){var o=e.meta.type.custom.variables;o&&o.length>0&&c.updateCustomStencilVariablesCache(e.id)}d.removeStepFromContainer(i,e)}},t.toggleMoveStep=function(e,i){if(e)if(t.toggleActiveStep(),e.meta.moving&&e.meta.moving===!0)e.meta.moving=!1,delete t.moveState;else{for(var o=d.getAllStepsArray(t.currentKickstartModel.definition.definition.steps),n=0;o.length>n;n++)o[n].id!==e.id&&o[n].meta&&o[n].meta.moving&&(o[n].meta.moving=!1);e.meta.moving=!0,i=i?i:t.steps,t.moveState||t.insertState||(t.moveState={}),t.moveState.step=e,t.moveState.container=i}},t.isMoveDisabled=function(e,t,i){if(i){if(m(e,i)||h(i,t)||f(i,t)||g(i,t))return!0;var o,n=u(t),r=d.getIndexInContainer(i.step,n);if(e&&(o=d.getIndexInContainer(e,n)),r>=0&&o>=0&&1===r-o)return!0;if(n&&n.length>0&&n[0].id===i.step.id){if(!e)return!0;if(e.choices&&t&&t.steps)return!0;if(t&&t.overdueSteps)return!0}if(e&&"goto-step"===i.step.type&&t&&t.steps&&t.steps[t.steps.length-1].id!==e.id)return!0;if(e&&"goto-step"===i.step.type&&t&&t.overdueSteps&&t.overdueSteps[t.overdueSteps.length-1].id!==e.id)return!0}return!1},t.getStepSummary=function(e){return d.getStepSummary(e)}}]),angular.module("activitiModeler").controller("KickstartModelSubMenuCtrl",["$scope",function(e){function t(){var t=e.insertState.types.findAll(function(e){return e.hasOwnProperty("group")}).pluck("group").uniq();return t}function i(){n.forEach(function(t){var i=e.insertState.types.filter(function(e){return e.group===t});e.insertState.types.push({groupBy:t,elements:i})})}function o(){e.insertState.types=e.insertState.types.findAll(function(e){return!e.hasOwnProperty("group")})}e.groups=[];var n=t();i(),o(),e.toggleGroup=function(t){e.shownGroup=e.isGroupShown(t)?null:t},e.isGroupShown=function(t){return e.shownGroup===t}}]),angular.module("activitiModeler").controller("MetadataStepController",["$scope","$translate","ProcessBuilderService","AlfrescoService",function(e,t,i,o){e.model={currentTab:"documentDefinition",variableType:"formField"},e.alfrescoAccount={selected:""},e.$watch("activeStep.meta.type",function(t){t&&(e.stepTabs=t.tabs,i.updateStepSummary(e.step))}),e.setInputSourceType=function(t){e.step.inputSourceType=t,e.step.inputSourceField=null},e.addPublishAs=function(t,i){t?(e.step.user=t.id,e.step.userField=null,e.step.userName=t.firstName?t.firstName+" "+t.lastName:t.lastName,e.step.userEmail=t.email,e.step.userExternalId=t.externalId):(e.step.user=null,e.step.userField=i),e.step.publishAsType="user"},e.setPublishAs=function(t){"process_initiator"===t&&(e.step.user=void 0,e.step.userName=void 0,e.step.userEmail=void 0,e.step.userExternalId=void 0),e.step.publishAsType=t},e.step.publishAsType||(e.step.publishAsType="process_initiator"),e.setActiveContentTab=function(t){e.activeContentTab=t},e.contentAlfrescoAccounts=o.loadAlfrescoAccounts(e.alfrescoAccount,e.step.account,e.step.network)}]),angular.module("activitiModeler").controller("KickstartReadOnlyModelController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","FormBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l,d,c,p){e.setMainPageById("processes"),e.kickstartModelRootLevelValidationError=!1,t.forms={},e.currentKickstartModel={},t.formFields={},t.startFormFields=[],t.processStartTypes=[{id:"none",title:i.instant("PROCESS-BUILDER.START-STEP.START-TYPES.USER")},{id:"form",title:i.instant("PROCESS-BUILDER.START-STEP.START-TYPES.FORM")}],t.model={processStart:{expanded:!1,type:t.processStartTypes[0]}},t.metadata={fields:[]},d.fetchKickstartModel(s.modelId,s.modelHistoryId).then(function(i){i.definition||(i.definition={steps:[]}),d.getStencilSet(i.stencilSetId).then(function(e){t.stencilSet=e;for(var o=0;t.stencilSet.stepTypes.length>o;o++){var n=t.stencilSet.stepTypes[o].template;if(n){var r=n.substring(0,n.length-5);t.stencilSet.stepTypes[o].templateReadOnly=r+"-readonly.html"}}d.addMetaToSteps(i.definition,t.stencilSet.stepTypes)}),i.definition.startForm&&(t.model.processStart.type=t.processStartTypes[1]),i.definition.metadata&&(t.metadata.fields=Object.keys(i.definition.metadata).map(function(e){return{key:e,value:i.definition.metadata[e]}})),e.currentKickstartModel.definition=i,t.steps=i.definition.steps,p.init(s.modelId)}),t.toggleProcessStartExpanded=function(){t.model.processStart.expanded=!t.model.processStart.expanded},t.selectConditionField=function(e,t){e.condition.fieldId=t.id},t.showStartForm=function(){e.currentKickstartModel.definition&&e.currentKickstartModel.definition.definition&&e.currentKickstartModel.definition.definition.startForm&&r.path("forms/"+e.currentKickstartModel.definition.definition.startForm.id)},t.getOperatorLabel=function(e){return"=="==e.condition.operator?i.instant("PROCESS-BUILDER.CHOICE-STEP.CONDITION.EQUALS"):"!="==e.condition.operator?i.instant("PROCESS-BUILDER.CHOICE-STEP.CONDITION.NOTEQUALS"):"<"==e.condition.operator?i.instant("PROCESS-BUILDER.CHOICE-STEP.CONDITION.LESSTHAN"):">"==e.condition.operator?i.instant("PROCESS-BUILDER.CHOICE-STEP.CONDITION.GREATERTHAN"):i.instant("PROCESS-BUILDER.CHOICE-STEP.CONDITION.SELECT-OPERATOR")},t.getFieldsForForm=function(e){return e?p.getFormFieldsForForm(e.id):void 0}}]),angular.module("activitiModeler").controller("KickstartReadOnlyModelDesignController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService",function(e,t,i,o,n,r,a,s,l,d){t.toggleActiveStep=function(e){t.activeStep&&t.activeStep.meta.new&&(t.activeStep.meta.new=!1),t.activeStep=e?t.activeStep?t.activeStep.id==e.id?void 0:e:e:void 0},t.getStepSummary=function(e){return d.getStepSummary(e)}}]),angular.module("activitiModeler").controller("HumanStepOverdueStepsReadOnlyController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover",function(e,t){t.stepContainer=t.step,t.activeTab=void 0}]),angular.module("activitiModeler").controller("HumanStepReadOnlyController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService",function(e,t,i,o,n,r){for(var a=0;t.stencilSet.stepTypes.lenth>a;a++)if("human-step"==t.stencilSet.stepTypes[a].id){t.humanStepTabs=t.stencilSet.stepTypes[a].tabs;break}t.$watch("activeStep.meta.type",function(e){e&&(t.humanStepTabs=e.tabs)}),t.step.assignment||(t.step.assignment={}),t.step.dueAssignment||(t.step.dueAssignment={}),t.taskDueDateOptions=[{id:"none",title:i.instant("PROCESS-BUILDER.FIELD.DUEDATE.TASK-DUE-DATE-OPTIONS.NO-DUEDATE")},{id:"static",title:i.instant("PROCESS-BUILDER.FIELD.DUEDATE.TASK-DUE-DATE-OPTIONS.STATIC")},{id:"field",title:i.instant("PROCESS-BUILDER.FIELD.DUEDATE.TASK-DUE-DATE-OPTIONS.FIELD")}],t.getTaskDueDateLabel=function(e){for(var o=0;t.taskDueDateOptions.length>o;o++)if(e==t.taskDueDateOptions[o].id)return t.taskDueDateOptions[o].title;return i.instant("PROCESS-BUILDER.FIELD.DUEDATE.TASK-DUE-DATE-OPTIONS.NO-DUEDATE")},t.dueDateOptions=[{id:"none",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-DATE-OPTIONS.NO-TIMER")},{id:"duration",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-DATE-OPTIONS.DURATION")},{id:"property",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-DATE-OPTIONS.FIELD")}],t.getDueDateLabel=function(e){for(var o=0;t.dueDateOptions.length>o;o++)if(e==t.dueDateOptions[o].id)return t.dueDateOptions[o].title;return i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-DATE-OPTIONS.NO-TIMER")},t.dueActionOptions=[{id:"none",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.NO-ACTION")},{id:"reassign-task",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.REASSIGN.TITLE"),description:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.REASSIGN.DESCRIPTION")},{id:"keep-task",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.KEEP.TITLE"),description:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.KEEP.DESCRIPTION"),nextSteps:!0},{id:"end-task",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.END.TITLE"),description:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.END.DESCRIPTION"),nextSteps:!0},{id:"end-process",title:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.END-PROCESS.TITLE"),description:i.instant("PROCESS-BUILDER.FIELD.TIMER.DUE-ACTION-OPTIONS.END-PROCESS.DESCRIPTION")}];var s;s=t.step.dueField?t.dueDateOptions[2]:t.step.dueDuration?t.dueDateOptions[1]:t.dueDateOptions[0],t.step.meta.dueDateOption=s.id;var l;if(t.step.dueAction)for(var a=0;t.dueActionOptions.length>a;a++)if(t.dueActionOptions[a].id==t.step.dueAction){l=t.dueActionOptions[a];break}if(l||(l=t.dueActionOptions[0]),t.step.meta.dueActionOption=l,t.assignmentOptions=[{id:"none",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-INITIATOR")},{id:"initiator",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-INITIATOR")},{id:"groupManagerForInitiator",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-GROUP-MANAGER-FOR-INITIATOR")},{id:"user",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-SINGLE-USER")},{id:"groupManager",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-GROUP-MANAGER")},{id:"users",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-CANDIDATE-USERS")},{id:"groups",title:i.instant("PROCESS-BUILDER.FIELD.ASSIGNMENT-SELECT.ASSIGNED-TO-CANDIDATE-GROUPS")}],t.step.assignment&&t.step.assignment.type)for(var a=0;t.assignmentOptions.length>a;a++)if(t.assignmentOptions[a].id==t.step.assignment.type){t.step.meta.assignmentOption=t.assignmentOptions[a];break}if(t.step.meta.assignmentOption?("users"!=t.step.meta.assignmentOption||t.step.assignment.candidateUsers&&0!=t.step.assignment.candidateUsers.length||(t.step.assignment.candidateUsers=[]),"groups"!=t.step.meta.assignmentOption||t.step.assignment.candidateGroups&&0!=t.step.assignment.candidateGroups.length||(t.step.assignment.candidateGroups=[])):t.step.meta.assignmentOption=t.assignmentOptions[0],t.step.dueAssignment&&t.step.dueAssignment.type)for(var a=0;t.assignmentOptions.length>a;a++)if(t.assignmentOptions[a].id==t.step.dueAssignment.type){t.step.meta.dueAssignmentOption=t.assignmentOptions[a];break}t.step.meta.dueAssignmentOption?("users"!=t.step.meta.dueAssignmentOption||t.step.dueAssignmentOption.candidateUsers&&0!=t.step.dueAssignmentOption.candidateUsers.length||(t.step.dueAssignmentOption.candidateUsers=[]),"groups"!=t.step.meta.dueAssignmentOption||t.step.dueAssignmentOption.candidateGroups&&0!=t.step.dueAssignmentOption.candidateGroups.length||(t.step.dueAssignmentOption.candidateGroups=[])):t.step.meta.dueAssignmentOption=t.assignmentOptions[0],t.showForm=function(){r.path("forms/"+t.step.formDefinition.id)}}]),angular.module("activitiModeler").controller("EmailStepReadOnlyController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover",function(e,t,i){if(t.emailStepTabs=t.activeStep.meta.type.tabs,t.recipientOptions=[{id:"initiator",title:i.instant("PROCESS-BUILDER.EMAIL-STEP.RECIPIENT.POPOVER.SELECT-INITIATOR")},{id:"user",title:i.instant("PROCESS-BUILDER.EMAIL-STEP.RECIPIENT.POPOVER.SELECT-USER")},{id:"users",title:i.instant("PROCESS-BUILDER.EMAIL-STEP.RECIPIENT.POPOVER.SELECT-USERS")}],t.step.recipient&&t.step.recipient.type)for(var o=0;t.recipientOptions.length>o;o++)if(t.recipientOptions[o].id==t.step.recipient.type){t.step.meta.recipientOption=t.recipientOptions[o];break}t.step.meta.recipientOption||(t.step.meta.recipientOption=t.recipientOptions[0])}]),angular.module("activitiModeler").controller("ChoiceStepReadOnlyController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService",function(e,t,i,o,n,r,a){for(var s=0;t.stencilSet.stepTypes.length>s;s++)if("choice-step"==t.stencilSet.stepTypes[s].id){t.choiceTabs=t.stencilSet.stepTypes[s].tabs;break}t.nextChoice=function(){t.step.choices&&t.step.meta.stepIndex<t.step.choices.length-2&&(t.step.meta.stepIndex+=1,t.updateActiveChoices())},t.previousChoice=function(){t.step.choices&&t.step.meta.stepIndex>0&&(t.step.meta.stepIndex-=1,t.updateActiveChoices())},t.$watch("step.choices",function(e){e&&t.updateActiveChoices()}),t.updateActiveChoices=function(){var e=t.step.choices,i=[];e[t.step.meta.stepIndex]&&i.push(e[t.step.meta.stepIndex]),e[t.step.meta.stepIndex+1]&&i.push(e[t.step.meta.stepIndex+1]),t.activeChoices=i},t.showChoiceDetails=function(e){var i={template:"views/process-builder/choice-step-choice-details-readonly.html?version="+Date.now(),scope:t};t.choiceName=angular.copy(e.name),t.expression=angular.copy(e.condition),t.isDefault=e.isDefault?!0:!1,t.choice=e,_internalCreateModal(i,a,t)},t.activeTab=t.choiceTabs[1].id,t.step.meta.stepIndex||0===t.step.meta.stepIndex||(t.step.meta.stepIndex=0)}]),angular.module("activitiModeler").controller("SubProcessStepReadOnlyController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService",function(e,t,i,o,n,r){for(var a=0;t.stencilSet.stepTypes.lenth>a;a++)if("subprocess-step"==t.stencilSet.stepTypes[a].id){t.subProcessStepTabs=t.stencilSet.stepTypes[a].tabs;break}t.$watch("activeStep.meta.type",function(e){e&&(t.subProcessStepTabs=e.tabs)}),t.showSubProcess=function(){r.path("processes/"+t.step.subProcessDefinition.id)}}]),angular.module("activitiModeler").controller("EndProcessStepReadOnlyController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover",function(e,t){t.endProcessStepTabs=t.activeStep.meta.type.tabs}]),angular.module("activitiModeler").controller("AlfrescoCloudPublishStepReadOnlyController",["$rootScope","$scope","$translate","ProcessBuilderService",function(e,t,i,o){t.alfrescoSourceOptions=[{id:"process",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.ALL")},{id:"field",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.FIELD")}],t.step.meta.alfrescoSourceOption=t.step.contentContainerField?t.alfrescoSourceOptions[1]:t.alfrescoSourceOptions[0],t.activeContentTab="documentDefinition",t.step.meta.destinationUseSubfolder=void 0!=t.step.createFolderField,t.$watch("activeStep.meta.type",function(e){e&&(t.stepTabs=e.tabs,o.updateStepSummary(t.step))}),t.setActiveContentTab=function(e){t.activeContentTab=e}}]),angular.module("activitiModeler").controller("BoxCloudPublishStepReadOnlyController",["$rootScope","$scope","$translate","ProcessBuilderService","ContentAccountService",function(e,t,i,o,n){t.boxSourceOptions=[{id:"process",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.ALL")},{id:"field",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.FIELD")}],t.step.meta.boxSourceOption=t.step.contentContainerField?t.boxSourceOptions[1]:t.boxSourceOptions[0],t.step.meta.destinationUseSubfolder=void 0!=t.step.createFolderField,t.isMetaDataAllowed=!1,n.isBoxMetaDataAllowed().then(function(e){t.isMetaDataAllowed=e}),t.$watch("activeStep.meta.type",function(e){e&&(t.stepTabs=e.tabs,o.updateStepSummary(t.step))})}]),angular.module("activitiModeler").controller("GoogleDrivePublishStepReadOnlyController",["$rootScope","$scope","$translate","ProcessBuilderService",function(e,t,i,o){t.googleDriveSourceOptions=[{id:"process",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.ALL")},{id:"field",title:i.instant("PROCESS-BUILDER.PUBLISH-STEP.SOURCE-OPTIONS.FIELD")}],t.step.meta.googleDriveSourceOption=t.step.contentContainerField?t.googleDriveSourceOptions[1]:t.googleDriveSourceOptions[0],t.step.meta.destinationUseSubfolder=void 0!=t.step.createFolderField,t.$watch("activeStep.meta.type",function(e){e&&(t.stepTabs=e.tabs,o.updateStepSummary(t.step))})}]),angular.module("activitiModeler").controller("CustomStepReadOnlyController",["$rootScope","$scope",function(e,t){t.customStepTabs=t.activeStep.meta.type.tabs}]),angular.module("activitiModeler").controller("GenerateDocumentStepReadOnlyController",["$rootScope","$scope","$translate","ProcessBuilderService",function(e,t,i,o){t.$watch("activeStep.meta.type",function(e){e&&(t.stepTabs=e.tabs,o.updateStepSummary(t.step))})}]),angular.module("activitiModeler").controller("DecisionStepReadOnlyController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService",function(e,t,i,o,n,r){for(var a=0;t.stencilSet.stepTypes.length>a;a++)if("decision-step"==t.stencilSet.stepTypes[a].id){t.decisionStepTabs=t.stencilSet.stepTypes[a].tabs;break}t.$watch("activeStep.meta.type",function(e){e&&(t.decisionStepTabs=e.tabs)}),t.showDecisionTable=function(){r.path("decision-tables/"+t.step.decisionTableDefinition.id)}}]),angular.module("activitiModeler").controller("KickstartToolbarController",["$scope","$http","$modal","$q","$rootScope","$translate","$location","ProcessBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l){var d=KICKSTART.PROCESS_TOOLBAR_CONFIG.items;e.items=[];for(var c=0;d.length>c;c++)e.items.push(d[c]);e.secondaryItems=KICKSTART.PROCESS_TOOLBAR_CONFIG.secondaryItems;var p=function(e,t){for(var i=Array.prototype.slice.call(arguments).splice(2),o=e.split("."),n=o.pop(),r=0;o.length>r;r++)t=t[o[r]];return t[n].apply(this,i)};e.toolbarButtonClicked=function(a){var d=e.items[a],c={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,ProcessBuilderService:s,ProcessScopeService:l};p(d.action,window,c)},e.toolbarSecondaryButtonClicked=function(d){var c=e.secondaryItems[d],u={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,$location:a,ProcessBuilderService:s,ProcessScopeService:l};p(c.action,window,u)}}]);var KICKSTART=KICKSTART||{};KICKSTART.PROCESS_TOOLBAR={ACTIONS:{saveModel:function(e){_internalCreateModal({backdrop:!0,keyboard:!0,template:"views/popup/kickstart-save-model.html?version="+Date.now(),scope:e.$scope},e.$modal,e.$scope)},validateModel:function(e){e.ProcessBuilderService.validateKickstartModel(e.$rootScope.currentKickstartModel.definition.id,e.$rootScope.currentKickstartModel.definition.definition)},editMetadata:function(e){_internalCreateModal({backdrop:!0,keyboard:!0,template:"views/popup/kickstart-edit-metadata.html?version="+Date.now(),scope:e.$scope},e.$modal,e.$scope)},help:function(){},feedback:function(e){var t={template:"editor-app/configuration/properties/feedback-popup.html?version="+Date.now(),scope:e.$scope};_internalCreateModal(t,e.$modal,e.$scope)},closeEditor:function(e){var t=function(){e.$rootScope.modelChanges=!1,e.ProcessScopeService.navigateBack("/processes")};if(1==e.$rootScope.modelChanges){e.$scope.$emit("modelChangesEvent");var i=e.$scope.$on("mustSaveEvent",function(){var i=e.$rootScope.currentKickstartModel.definition,o={name:i.name,description:i.description,newVersion:!1};r(),e.ProcessBuilderService.saveKickstartModel(i,o).then(t)}),o=e.$scope.$on("discardDataEvent",function(){r(),t()}),n=e.$scope.$on("continueEditingEvent",function(){r()})}else t();var r=function(){n(),i(),o()}}}},angular.module("activitiModeler").controller("SaveKickstartModelCtrl",["$rootScope","$scope","$http","$route","$location","$translate","ModelService","ProcessBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l){var d="";e.currentKickstartModel.definition.description&&(d=e.currentKickstartModel.definition.description);var c={name:e.currentKickstartModel.definition.name,description:d,newVersion:!1,comment:"",embedded:e.parentReferenceId!==void 0&&e.currentKickstartModel.definition.referenceId===+e.parentReferenceId,hasEmbedContext:e.parentReferenceId!==void 0};t.saveDialog=c,t.status={loading:!1},t.hasOtherRelations=!1,t.oldProcessId="";var p=function(e){e&&e.length>0&&(t.saveDialog.validationErrors=!0)};s.validateKickstartModel(e.currentKickstartModel.definition.id,e.currentKickstartModel.definition.definition,p),t.cancel=function(){t.$hide()},t.saveAndClose=function(){t.save(function(){l.navigateBack("/processes")})},t.save=function(i){if(t.saveDialog.name&&0!=t.saveDialog.name.length){t.status={loading:!0};var o=function(){return t.saveDialog.embedded},n=function(){return o()?e.parentReferenceId:null},l=function(e){return e.length},d=function(){i&&i(),t.$hide(),e.addAlertPromise(r("KICKSTART-MODEL.ALERT.SAVED"),"info"),e.modelChanges=!1},c=function(){t.$hide(),e.addAlertPromise(r("KICKSTART-MODEL.ALERT.ERROR-SAVE"),"error"),e.modelChanges=!1};a.getModelParentRelations(e.currentKickstartModel.definition.id).then(function(i){var r=e.currentKickstartModel.definition,p={name:t.saveDialog.name,description:t.saveDialog.description,referenceId:n(),modelType:1,stencilSet:r.stencilSetId};o()&&l(i)>1?a.cloneModel(r,p).then(function(i){t.oldProcessId=r.id,r.id=i.id,a.updateFormReferencesInProcess(e.parentReferenceId,t.oldProcessId,i.id).then(d)},c):a.saveModel(r,p).then(function(){r.referenceId=+n(),s.saveKickstartModel(r,t.saveDialog).then(d,c)},c)},c)}},t.isOkButtonDisabled=function(){return t.status.loading?!1:t.error&&t.error.conflictResolveAction?"saveAs"===t.error.conflictResolveAction?!t.error.saveAs||0==t.error.saveAs.length:!1:!0},t.okClicked=function(){t.error&&("discardChanges"===t.error.conflictResolveAction?(t.close(),o.reload()):"overwrite"===t.error.conflictResolveAction||"newVersion"===t.error.conflictResolveAction?t.save():"saveAs"===t.error.conflictResolveAction&&t.save(function(){e.ignoreChanges=!0,l.navigateBack("/processes")}))},t.embedClicked=function(){t.saveDialog.embedded?a.getModelParentRelations(e.currentKickstartModel.definition.id).then(function(e){t.hasOtherRelations=e.length>1
},function(){e.addAlert("An error occurred while trying to find the relations")}):t.hasOtherRelations=!1}}]),angular.module("activitiModeler").controller("EditKickstartMetadataCtrl",["$rootScope","$scope","$timeout","$translate",function(e,t,i,o){if(t.metadata={fields:[],selectedField:null},e.currentKickstartModel.definition.definition.metadata){var n=e.currentKickstartModel.definition.definition.metadata;t.metadata.fields=Object.keys(n).map(function(e){return{key:e,value:n[e]}})}t.gridOptions={data:t.metadata.fields,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,enableColumnMenus:!1,columnDefs:[{field:"key",displayName:o.instant("FORM-BUILDER.METADATA.KEY")},{field:"value",displayName:o.instant("FORM-BUILDER.METADATA.VALUE")}]},t.gridOptions.onRegisterApi=function(e){t.metadataGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.metadata.selectedField=e.isSelected?e.entity:null}),i(function(){t.metadata.fields.length>0&&t.metadataGridApi.selection.toggleRowSelection(t.metadata.fields[0])})},t.addNewField=function(){var e={key:"",value:""};t.metadataGridApi.selection.clearSelectedRows(),t.metadata.fields.push(e),i(function(){t.metadataGridApi.selection.toggleRowSelection(e)})},t.removeField=function(){if(t.metadata.selectedField){var e=t.metadata.fields.indexOf(t.metadata.selectedField);e>=0&&(t.metadataGridApi.selection.clearSelectedRows(),t.metadata.fields.splice(e,1),i(function(){t.metadata.fields.length>0?t.metadataGridApi.selection.toggleRowSelection(t.metadata.fields[0]):t.metadata.selectedField=null}))}},t.cancel=function(){t.$hide()},t.save=function(){var i=e.currentKickstartModel.definition.definition;if(i){var o={};t.metadata.fields.filter(function(e){return e.key&&e.key.length>0&&e.key.trim().length>0}).map(function(e){o[e.key]=e.value}),i.metadata=o}t.$hide()}}]);var KICKSTART=KICKSTART||{};KICKSTART.PROCESS_TOOLBAR_CONFIG={items:[{type:"button",title:"KICKSTART.PROCESS_TOOLBAR.ACTION.SAVE",cssClass:"editor-icon editor-icon-save",action:"KICKSTART.PROCESS_TOOLBAR.ACTIONS.saveModel",disableOnReadonly:!0},{type:"button",title:"KICKSTART.PROCESS_TOOLBAR.ACTION.VALIDATE",cssClass:"glyphicon glyphicon-ok",action:"KICKSTART.PROCESS_TOOLBAR.ACTIONS.validateModel"},{type:"separator",title:"",cssClass:"toolbar-separator"},{type:"button",title:"KICKSTART.PROCESS_TOOLBAR.ACTION.METADATA",cssClass:"glyphicon glyphicon-list",action:"KICKSTART.PROCESS_TOOLBAR.ACTIONS.editMetadata",disableOnReadonly:!0}],secondaryItems:[{type:"button",title:"Close",cssClass:"glyphicon glyphicon-remove",action:"KICKSTART.PROCESS_TOOLBAR.ACTIONS.closeEditor"}]},angular.module("activitiModeler").controller("ChoiceStepConditionEditorPopupController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","FormBuilderService","ProcessScopeService","ChoiceStepConditionService",function(e,t,i,o,n,r,a,s,l,d,c,p,u){t.model={condition:{}},t.choice.condition&&(t.model.condition=angular.copy(t.choice.condition),t.model.condition.nextCondition?t.model.condition.type="advanced":t.model.condition.type||(t.model.condition.fieldId?(t.model.condition.leftFormFieldId=t.model.condition.fieldId,t.model.condition.type="variables"):t.model.condition.responseVariableName?(t.model.condition.fieldType=void 0,t.model.condition.leftRestResponseId=t.model.condition.responseVariableName,t.model.condition.responseVariableName=void 0,t.model.condition.type="variables"):t.model.condition.outcomeFormId&&(t.model.condition.leftOutcomeFormId=t.model.condition.outcomeFormId,t.model.condition.leftOutcomeFormName=t.model.condition.outcomeFormName,t.model.condition.rightOutcomeFormId=t.model.condition.outcomeFormId,t.model.condition.rightOutcomeFormName=t.model.condition.outcomeFormName,t.model.condition.outcomeName&&(t.model.condition.rightOutcomeName=t.model.condition.outcomeName),t.model.condition.type="variables"),t.model.condition.value&&(t.model.condition.rightValue=t.model.condition.value),t.model.condition.outcomeFormId=void 0,t.model.condition.outcomeFormName=void 0,t.model.condition.fieldId=void 0,t.model.condition.fieldType=void 0,t.model.condition.fieldName=void 0,t.model.condition.outcomeName=void 0,t.model.condition.value=void 0)),t.model.condition.type||(t.model.condition.type="none"),"variables"===t.model.condition.type?t.model.condition.leftFieldType=t.model.condition.leftOutcomeFormId?"outcome":t.model.condition.leftRestResponseId?"restResponse":"formField":"static"===t.model.condition.type&&(t.model.condition.staticValue||(t.model.condition.type="none")),t.model.isDefault=t.choice.isDefault?!0:!1;var m=["text","multi-line-text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount"];t.refreshAvailableFormFields=function(){var e=d.getAllStepsArray(t.currentKickstartModel.definition.definition.steps);t.availableFormFields=p.getFormFieldsForStep(e,t.step.id,m)},t.refreshAvailableForms=function(){var e=d.getAllStepsArray(t.currentKickstartModel.definition.definition.steps);t.availableForms=p.getFormsForStep(e,t.step.id)},t.refreshAvailableOutcomes=function(e){void 0===e&&t.model.condition.rightOutcomeFormId&&(e=t.model.condition.rightOutcomeFormId),e&&(t.availableFormOutcomes=p.getFormOutcomesForForm(e))},t.refreshAvailableResponseVariables=function(){var e=d.getAllStepsArray(t.currentKickstartModel.definition.definition.steps);t.choiceResponseVariables=p.getVariablesForStep(e,t.step.id)},t.selectConditionField=function(e,i){e.leftFormFieldId=i.id,t.model.condition.operator=void 0},t.selectChoiceForm=function(e){t.model.condition.leftOutcomeFormId=e.id,t.model.condition.leftOutcomeFormName=e.name,t.model.condition.rightOutcomeName=void 0,t.model.condition.operator=void 0,t.refreshAvailableOutcomes(e.id)},t.selectConditionOutcome=function(e,t){e.rightOutcomeName=t.name,e.rightOutcomeFormId=e.leftOutcomeFormId,e.rightOutcomeFormName=e.leftOutcomeFormName,e.rightFieldType="outcome"},t.selectResponseVariable=function(e,i){e.leftRestResponseId=i.processVariableName,t.model.condition.operator=void 0},t.getOperatorLabel=function(e){return"=="===e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.EQUALS"):"!="===e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.NOTEQUALS"):"<"===e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN"):">"===e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN"):"empty"===e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY"):"notEmpty"===e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY"):">="==e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL"):"<="==e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL"):i.instant("PROCESS-BUILDER.CHOICE-STEP.CONDITION.SELECT-OPERATOR")},t.getOperatorsForSelectedFieldType=function(){return"formField"===t.model.condition.leftFieldType?u.getOperatorsForType(h(t.model.condition.leftFormFieldId)):"restResponse"===t.model.condition.leftFieldType?u.getOperatorsForType(f(t.model.condition.leftRestResponseId)):void 0};var h=function(e){var i="";if(e)for(var o=0;t.availableFormFields.length>o;o++){var n=t.availableFormFields[o];if(n.id===e){i=n.type;break}}return i},f=function(e){var i="";if(e){var o=t.choiceResponseVariables;if(o&&o.length>0)for(var n=0;o.length>n;n++){var r=o[n];if(r.processVariableName===e){i=r.processVariableType;break}}}return i.toLowerCase()};t.prepareForSave=function(){var e=function(t,i){t&&(t.nextCondition=void 0);var o={};return i.length>0?(o=i.shift(),t.nextCondition=o,e(t.nextCondition,i),void 0):o},i=function(e){if(e&&e.length>0)for(var t=0;e.length>t;t++)void 0!==e[t].leftFieldType&&("formField"===e[t].leftFieldType?(e[t].leftRestResponseId=void 0,e[t].leftOutcomeFormId=void 0,e[t].leftOutcomeFormName=void 0,"variables"===e[t].type&&(e[t].rightRestResponseId=void 0,e[t].rightOutcomeFormId=void 0,e[t].rightOutcomeName=void 0,e[t].rightFormFieldId=void 0,e[t].rightFieldType=void 0)):"restResponse"===e[t].leftFieldType?(e[t].leftFormFieldId=void 0,e[t].leftOutcomeFormId=void 0,e[t].leftOutcomeFormName=void 0,"variables"===e[t].type&&(e[t].rightRestResponseId=void 0,e[t].rightOutcomeFormId=void 0,e[t].rightOutcomeName=void 0,e[t].rightFormFieldId=void 0,e[t].rightFieldType=void 0)):"outcome"===e[t].leftFieldType&&(e[t].leftFormFieldId=void 0,e[t].leftRestResponseId=void 0,"variables"===e[t].type&&(e[t].rightRestResponseId=void 0,e[t].rightValue=void 0,e[t].rightFormFieldId=void 0)),e[t].leftFieldType=void 0),void 0!==e[t].rightFieldType&&("formField"===e[t].rightFieldType?(e[t].rightRestResponseId=void 0,e[t].rightValue=void 0,e[t].rightOutcomeFormId=void 0,e[t].rightOutcomeName=void 0):"restResponse"===e[t].rightFieldType?(e[t].rightFormFieldId=void 0,e[t].rightValue=void 0,e[t].rightOutcomeFormId=void 0,e[t].rightOutcomeName=void 0):"outcome"===e[t].rightFieldType?(e[t].rightRestResponseId=void 0,e[t].rightValue=void 0,e[t].rightFormFieldId=void 0):"staticValue"===e[t].rightFieldType&&(e[t].rightFormFieldId=void 0,e[t].rightRestResponseId=void 0,e[t].rightOutcomeFormId=void 0,e[t].rightOutcomeFormName=void 0,e[t].rightOutcomeName=void 0),e[t].rightFieldType=void 0),void 0!==e[t].$$hashKey&&(e[t].$$hashKey=void 0)};if("variables"===t.model.condition.type){t.model.condition.nextCondition=void 0,t.model.condition.nextConditionOperator=void 0;var o=[t.model.condition];o=g(o),i(o),t.flowCondition=o[0]}else if("advanced"===t.model.condition.type){t.tabFlowConditions=g(t.tabFlowConditions),i(t.tabFlowConditions);var n=t.tabFlowConditions.shift();e(n,t.tabFlowConditions),t.flowCondition=n,t.flowCondition&&(t.flowCondition.type="advanced")}else t.flowCondition=void 0};var g=function(e){return e.filter(function(e){return!!(void 0!==e.leftFormFieldId&&""!==e.leftFormFieldId||void 0!==e.leftOutcomeFormId&&""!==e.leftOutcomeFormId||void 0!==e.leftRestResponseId&&""!==e.leftRestResponseId||void 0!==e.operator&&""!==e.operator||void 0!==e.rightValue&&""!==e.rightValue||void 0!==e.rightFormFieldId&&""!==e.rightFormFieldId||void 0!==e.rightOutcomeFormId&&""!==e.rightOutcomeFormId||void 0!==e.rightRestResponseId&&""!==e.rightRestResponseId)})};t.isShowRightHandSide=function(){return null!==t.model.condition&&void 0!==t.model.condition&&"empty"!==t.model.condition.operator&&"notEmpty"!==t.model.condition.operator},t.save=function(){if(t.choice.name=t.choiceName,t.choice.isDefault=t.model.isDefault,t.choice.isDefault&&(t.choice.condition=void 0,t.step.choices.length>0)){var e=t.activeChoices.indexOf(t.choice);if(e>=0){for(var i=0;t.step.choices.length>i;i++)t.step.choices[i].isDefault=!1;t.choice.isDefault=!0}}if("none"===t.model.condition.type)t.choice.condition=void 0;else{t.prepareForSave();var o="";t.flowCondition?o={expression:t.flowCondition}:"static"===t.model.condition.type&&(o={expression:{type:"static",staticValue:t.model.condition.staticValue}});var n=function(e){return e&&"static"!==e.expression.type&&(e.expression.staticValue=void 0),e},r=n(o);t.choice.condition=r.expression}t.close()},t.close=function(){t.$hide()}}]),angular.module("activitiModeler").controller("ChoiceStepConditionBuilderReadOnlyController",["$rootScope","$scope","$q","$translate","$http","$timeout","ChoiceStepConditionService",function(e,t,i,o,n,r,a){t.model.selectedFlowConditions=[],t.model.selectedFields=[],t.model.labels=[],t.model.flowConditions=[],t.model.selectedFlowCondition=void 0,t.flowCondition=void 0,t.options={},t.model.condition&&(e.flowCondition=t.model.condition),(void 0===e.flowCondition.type||null===e.flowCondition.type)&&(e.flowCondition.type="variables");var s=function(e,t){if(t.nextCondition){var i=t.nextCondition;t.index=void 0,t.nextCondition="",e.push(t),s(e,i)}else t.index=void 0,e.push(t)},l=function(){var t=[];return t[0]=e.flowCondition,e.flowCondition.nextCondition&&s(t,e.flowCondition.nextCondition),t};e.flowCondition=a.convertToAdvancedEditorFormat(e.flowCondition),e.tabFlowConditions=e.flowCondition?l():[];var d=a.detectVariableType,c=function(){if(e.tabFlowConditions&&e.tabFlowConditions.length>0)for(var t=0;e.tabFlowConditions.length>t;t++){var i=e.tabFlowConditions[t];d(i)}};c(),t.model.conditionOperatorsByType=a.conditionOperatorsByType,t.model.rightTypes=[{value:"string",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.STRING")},{value:"number",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.NUMBER")},{value:"date",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.DATE")}],t.model.rightValueOptions={"boolean":[{value:"true",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_VALUE_OPTIONS.BOOLEAN.CHECKED")},{value:"false",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_VALUE_OPTIONS.BOOLEAN.UNCHECKED")}]},t.getNameForSelectedFormFieldId=function(e){var i="";if(e)for(var o=0;t.availableFormFields.length>o;o++){var n=t.availableFormFields[o];if(n.id===e){i=n.name;break}}return i},t._getLeftValueColumnValue=function(e){var t="";return e?("formField"===e.leftFieldType?e.leftFormFieldId&&""!==e.leftFormFieldId&&(t=e.leftFormFieldId):"outcome"===e.leftFieldType?e.leftOutcomeFormId&&""!==e.leftOutcomeFormId&&(t=e.leftOutcomeFormName||e.leftOutcomeFormId):"restResponse"===e.leftFieldType&&e.leftRestResponseId&&""!==e.leftRestResponseId&&(t=e.leftRestResponseId),t):t},t._getRightValueColumnValue=function(e){var t="";return e?("formField"===e.rightFieldType?e.rightFormFieldId&&""!==e.rightFormFieldId&&(t=e.rightFormFieldId):"outcome"===e.rightFieldType?t="outcome"===e.leftFieldType?e.rightOutcomeFormName&&""!==e.rightOutcomeFormName&&e.leftOutcomeFormName&&""!==e.leftOutcomeFormName?e.rightOutcomeFormName!==e.leftOutcomeFormName?e.rightOutcomeFormName:e.rightOutcomeName:e.rightOutcomeFormName:e.rightOutcomeFormName:"restResponse"===e.rightFieldType?e.rightRestResponseId&&""!==e.rightRestResponseId&&(t=e.rightRestResponseId):e.rightValue&&""!==e.rightValue&&(t=e.rightValue),t):t},t.getTypeForSelectedFormFieldId=function(e){return p(e)};var p=function(e){var i="";if(e)for(var o=0;t.availableFormFields.length>o;o++){var n=t.availableFormFields[o];if(n.id===e){i=n.type;break}}return i},u=function(e){var i="";if(e){var o=t.choiceResponseVariables;if(o&&o.length>0)for(var n=0;o.length>n;n++){var r=o[n];if(r.processVariableName===e){i=r.processVariableType;break}}}return i.toLowerCase()};t.getConditionsForFieldId=function(e,i){var o;return e?o=p(e):i&&(o=u(i)),o&&t.model.conditionOperatorsByType[o]?t.model.conditionOperatorsByType[o].operators:t.model.conditionOperatorsByType.string.operators},t.getDropDownOptions=function(e){return t.options&&t.options[e]?t.options[e]:(t.updateSelectOptions(t.detectFormField(e),e),t.options&&t.options[e]?t.options[e]:[])},t.detectFormField=function(e){for(var i=0;t.availableFormFields.length>i;i++){var o=t.availableFormFields[i];if(o.id===e)return o}},t.updateSelectOptions=function(e,i){e&&("dropdown"===e.type||"radio-buttons"===e.type||"typeahead"===e.type)&&(t.options[e.id]=t.getFieldOptions(e,i))},t.getFieldOptions=function(e,t){var i=[];if(e&&e.optionType&&"rest"===e.optionType)return i;if(e.options&&e.options.length>0)for(var o=0;e.options.length>o;o++){var n=e.options[o],r=t.endsWith("_LABEL")?n.name:n.id;i.push({value:r,description:r})}return i},t.getTypeForFieldOrVariable=function(e,t){var i="string";return e?i=p(e):t&&(i=u(t)),i},t._getOperatorDescriptionForFieldId=function(e){if(e&&e.operator){var i;return e.leftFormFieldId?i=p(e.leftFormFieldId):e.leftRestResponseId?i=u(e.leftRestResponseId):e.leftOutcomeFormId&&""!==e.leftOutcomeFormId&&(i="string"),i?t._getOperatorDescriptionForType(e.operator,i):void 0}},t._getOperatorDescriptionForType=function(e,i){if(e&&i){var o;if(o=t.model.conditionOperatorsByType[i]?t.model.conditionOperatorsByType[i].index[e]:t.model.conditionOperatorsByType.string.index[e],void 0!==o&&o>=0){var n=t.model.conditionOperatorsByType[i].operators[o].description;return n}return void 0}},t.fieldIsNotEmpty=function(e){return e&&null===e&&void 0===e&&""!==e?void 0:!0};var m=o.instant("FORM-BUILDER.VISIBILITY.LEFT-FORM-FIELD"),h=o.instant("FORM-BUILDER.VISIBILITY.OPERATOR"),f=o.instant("FORM-BUILDER.VISIBILITY.RIGHT-VALUE"),g=o.instant("FORM-BUILDER.VISIBILITY.NEXT-CONDITION-OPERATOR");t.flowConditionGridOptions={data:e.tabFlowConditions,headerRowHeight:28,enableRowSelection:!1,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,enableColumnMenus:!1,columnDefs:[{field:"leftFormFieldId",displayName:m,resizable:!1,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getLeftValueColumnValue(row.entity)}}</div>'},{field:"operator",displayName:h,resizable:!0,sortable:!1},{field:"rightValue",displayName:f,resizable:!1,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getRightValueColumnValue(row.entity)}}</div>'},{field:"nextConditionOperator",displayName:g,resizable:!1,sortable:!1,width:150}]},t.flowConditionGridOptions.onRegisterApi=function(e){t.flowConditionGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?(t.model.selectedFlowCondition=e.entity,t.focusFirstField(),t.model.selectedFlowCondition&&d(t.model.selectedFlowCondition)):t.model.selectedFlowCondition=void 0})},t.focusFirstField=function(){r(function(){var e=document.getElementById("leftVariableField");e&&e.focus()},100)},t.addNewCondition=function(){var i={leftFormFieldId:"",operator:"",rightFormFieldId:"",rightRestResponseId:"",rightValue:"",nextConditionOperator:""};t.flowConditionGridApi.selection.clearSelectedRows(),e.tabFlowConditions.push(i),r(function(){t.flowConditionGridApi.selection.toggleRowSelection(i)})},t.removeCondition=function(){if(t.model.selectedFlowCondition){var i=e.tabFlowConditions.indexOf(t.model.selectedFlowCondition);t.flowConditionGridApi.selection.clearSelectedRows(),e.tabFlowConditions.splice(i,1),r(function(){e.tabFlowConditions.length>0?t.flowConditionGridApi.selection.toggleRowSelection(e.tabFlowConditions[0]):t.model.selectedFlowCondition=void 0})}},t.moveConditionUp=function(){if(t.model.selectedFlowCondition){var i=e.tabFlowConditions.indexOf(t.model.selectedFlowCondition);if(0!==i){var o=e.tabFlowConditions[i];e.tabFlowConditions.splice(i,1),r(function(){e.tabFlowConditions.splice(i+-1,0,o),r(function(){t.flowConditionGridApi.selection.toggleRowSelection(e.tabFlowConditions[0])})})}}},t.moveConditionDown=function(){if(t.model.selectedFlowCondition){var i=e.tabFlowConditions.indexOf(t.model.selectedFlowCondition);if(i!==e.tabFlowConditions.length-1){var o=e.tabFlowConditions[i];e.tabFlowConditions.splice(i,1),r(function(){e.tabFlowConditions.splice(i+1,0,o),r(function(){t.flowConditionGridApi.selection.toggleRowSelection(e.tabFlowConditions[0])})})}}},t.setLeftFieldType=function(e){t.model.selectedFlowCondition.leftFieldType=e,"formField"===e?(t.model.selectedLeftVariable="",t.model.selectedFlowCondition.leftRestResponseId="",t.model.selectedFlowCondition.leftOutcomeFormId="",t.model.selectedFlowCondition.leftOutcomeFormName=""):"restResponse"===e?(t.model.selectedFlowCondition.leftFormFieldId="",t.model.selectedFlowCondition.leftOutcomeFormId="",t.model.selectedFlowCondition.leftOutcomeFormName=""):"outcome"===e&&(t.model.selectedLeftVariable="",t.model.selectedFlowCondition.leftFormFieldId="",t.model.selectedFlowCondition.leftRestResponseId="")},t.setRightFieldType=function(e){t.model.selectedFlowCondition.rightFieldType=e,"formField"===e?(t.model.selectedFlowCondition.rightValue="",t.model.selectedFlowCondition.rightRestResponseId="",t.model.selectedFlowCondition.rightOutcomeName=""):"staticValue"===e?(t.model.selectedFlowCondition.rightFormFieldId="",t.model.selectedFlowCondition.rightRestResponseId="",t.model.selectedFlowCondition.rightOutcomeName="",t.model.selectedRightVariable=""):"restResponse"===e?(t.model.selectedFlowCondition.rightValue="",t.model.selectedFlowCondition.rightFormFieldId="",t.model.selectedFlowCondition.rightOutcomeName="",t.model.selectedRightVariable=""):"outcome"===e&&(t.model.selectedFlowCondition.rightValue="",t.model.selectedFlowCondition.rightFormFieldId="",t.model.selectedFlowCondition.rightRestResponseId="",t.model.selectedRightVariable="")},t.selectLeftFormField=function(e,t){e.leftFormFieldId=t.id},t.selectRightFormField=function(e,t){e.rightFormFieldId=t.id},t.selectLeftResponseVariable=function(e,t){e.leftRestResponseId=t.processVariableName},t.selectRightResponseVariable=function(e,t){e.rightRestResponseId=t.processVariableName},t.selectLeftForm=function(e,i){e.leftOutcomeFormId=i.id,e.leftOutcomeFormName=i.name,t.selectRightForm(e,i)},t.selectRightForm=function(e,i){e.rightOutcomeFormId=i.id,e.rightOutcomeFormName=i.name,e.rightOutcomeName=void 0,t.refreshAvailableOutcomes(e.rightOutcomeFormId)},t.selectFormOutcome=function(e,t){e.rightOutcomeName=t.name},t.isShowRightHandSide=function(){return null!==t.model.selectedFlowCondition&&void 0!==t.model.selectedFlowCondition&&"empty"!==t.model.selectedFlowCondition.operator&&"notEmpty"!==t.model.selectedFlowCondition.operator},t.closeDatePopup=function(){jQuery("#rightValueField").blur()},t.clearDate=function(){t.model.selectedFlowCondition.rightValue=void 0,jQuery("#rightValueField").blur()},t.selectToday=function(e,t){var i=new Date;i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),e=i,t&&t(e),jQuery("#rightValueField").blur()}}]),angular.module("activitiModeler").controller("ChoiceStepConditionBuilderController",["$rootScope","$scope","$q","$translate","$http","$timeout","FormUtilService","FormBuilderService","$filter","ChoiceStepConditionService",function(e,t,i,o,n,r,a,s,l,d){t.model.selectedFlowConditions=[],t.model.selectedFields=[],t.model.labels=[],t.model.flowConditions=[],t.model.selectedFlowCondition=void 0,t.flowCondition=void 0,t.options={},t.model.condition&&(e.flowCondition=t.model.condition),(void 0===e.flowCondition.type||null===e.flowCondition.type)&&(e.flowCondition.type="variables");var c=function(e,t){if(t.nextCondition){var i=t.nextCondition;t.index=void 0,t.nextCondition="",e.push(t),c(e,i)}else t.index=void 0,e.push(t)},p=function(){var t=[];return t[0]=e.flowCondition,e.flowCondition.nextCondition&&c(t,e.flowCondition.nextCondition),t};e.flowCondition=d.convertToAdvancedEditorFormat(e.flowCondition),e.tabFlowConditions=e.flowCondition?p():[];var u=d.detectVariableType,m=function(){if(e.tabFlowConditions&&e.tabFlowConditions.length>0)for(var t=0;e.tabFlowConditions.length>t;t++){var i=e.tabFlowConditions[t];u(i)}};m(),t.model.conditionOperatorsByType=d.conditionOperatorsByType,t.model.rightTypes=[{value:"string",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.STRING")},{value:"number",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.NUMBER")},{value:"date",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.DATE")}],t.model.rightValueOptions={"boolean":[{value:"true",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_VALUE_OPTIONS.BOOLEAN.CHECKED")},{value:"false",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_VALUE_OPTIONS.BOOLEAN.UNCHECKED")}]},t.getNameForSelectedFormFieldId=function(e){var i="";if(e)for(var o=0;t.availableFormFields.length>o;o++){var n=t.availableFormFields[o];if(n.id===e){i=n.name;break}}return i},t._getLeftValueColumnValue=function(e){var t="";return e?("formField"===e.leftFieldType?e.leftFormFieldId&&""!==e.leftFormFieldId&&(t=e.leftFormFieldId):"outcome"===e.leftFieldType?e.leftOutcomeFormId&&""!==e.leftOutcomeFormId&&(t=e.leftOutcomeFormName||e.leftOutcomeFormId):"restResponse"===e.leftFieldType&&e.leftRestResponseId&&""!==e.leftRestResponseId&&(t=e.leftRestResponseId),t):t},t._getRightValueColumnValue=function(e){var i="";if(!e)return i;if("formField"===e.rightFieldType)e.rightFormFieldId&&""!==e.rightFormFieldId&&(i=e.rightFormFieldId);else if("outcome"===e.rightFieldType)i="outcome"===e.leftFieldType?e.rightOutcomeFormName&&""!==e.rightOutcomeFormName&&e.leftOutcomeFormName&&""!==e.leftOutcomeFormName?e.rightOutcomeFormName!==e.leftOutcomeFormName?e.rightOutcomeFormName:e.rightOutcomeName:e.rightOutcomeFormName:e.rightOutcomeFormName;else if("restResponse"===e.rightFieldType)e.rightRestResponseId&&""!==e.rightRestResponseId&&(i=e.rightRestResponseId);else if(e.rightValue&&""!==e.rightValue||0===e.rightValue)if(e.leftFormFieldId&&""!==e.leftFormFieldId){var o=t.getTypeForSelectedFormFieldId(e.leftFormFieldId);if("date"===o)i=l("date")(new Date(e.rightValue),"d-M-yyyy");else if("integer"===o||"amount"===o){var n=0;try{n=parseInt(e.rightValue)}catch(r){n=0}e.rightValue=n,i=e.rightValue}else i=e.rightValue}else i=e.rightValue;return i},t.getTypeForSelectedFormFieldId=function(e){return h(e)};var h=function(e){var i="";if(e)for(var o=0;t.availableFormFields.length>o;o++){var n=t.availableFormFields[o];if(n.id===e){i=n.type;break}}return i},f=function(e){var i="";if(e){var o=t.choiceResponseVariables;if(o&&o.length>0)for(var n=0;o.length>n;n++){var r=o[n];if(r.processVariableName===e){i=r.processVariableType;break}}}return i.toLowerCase()};t.getConditionsForFieldId=function(e,i){var o;return e?o=h(e):i&&(o=f(i)),o&&t.model.conditionOperatorsByType[o]?t.model.conditionOperatorsByType[o].operators:t.model.conditionOperatorsByType.string.operators},t.getDropDownOptions=function(e){return t.options&&t.options[e]?t.options[e]:(t.updateSelectOptions(t.detectFormField(e),e),t.options&&t.options[e]?t.options[e]:[])},t.detectFormField=function(e){for(var i=0;t.availableFormFields.length>i;i++){var o=t.availableFormFields[i];if(o.id===e)return o}},t.updateSelectOptions=function(e,i){e&&("dropdown"===e.type||"radio-buttons"===e.type||"typeahead"===e.type)&&(t.options[e.id]=t.getFieldOptions(e,i))},t.getFieldOptions=function(e,t){var i=[];if(e&&e.optionType&&"rest"===e.optionType)return i;if(e.options&&e.options.length>0)for(var o=0;e.options.length>o;o++){var n=e.options[o],r=t.endsWith("_LABEL")?n.name:n.id;i.push({value:r,description:r})}return i},t.getTypeForFieldOrVariable=function(e,t){var i="string";return e?i=h(e):t&&(i=f(t)),i},t._getOperatorDescriptionForFieldId=function(e){if(e&&e.operator){var i;return e.leftFormFieldId?i=h(e.leftFormFieldId):e.leftRestResponseId?i=f(e.leftRestResponseId):e.leftOutcomeFormId&&""!==e.leftOutcomeFormId&&(i="string"),i?t._getOperatorDescriptionForType(e.operator,i):void 0}},t._getOperatorDescriptionForType=function(e,i){if(e&&i){var o;if(o=t.model.conditionOperatorsByType[i]?t.model.conditionOperatorsByType[i].index[e]:t.model.conditionOperatorsByType.string.index[e],void 0!==o&&o>=0){var n=t.model.conditionOperatorsByType[i].operators[o].description;return n}return void 0}},t.fieldIsNotEmpty=function(e){return e&&null===e&&void 0===e&&""!==e?void 0:!0};var g=o.instant("FORM-BUILDER.VISIBILITY.LEFT-FORM-FIELD"),v=o.instant("FORM-BUILDER.VISIBILITY.OPERATOR"),S=o.instant("FORM-BUILDER.VISIBILITY.RIGHT-VALUE"),I=o.instant("FORM-BUILDER.VISIBILITY.NEXT-CONDITION-OPERATOR");t.flowConditionGridOptions={data:e.tabFlowConditions,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,enableColumnMenus:!1,columnDefs:[{field:"leftFormFieldId",displayName:g,resizable:!1,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getLeftValueColumnValue(row.entity)}}</div>'},{field:"operator",displayName:v,resizable:!0,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getOperatorDescriptionForFieldId(row.entity)}}</div>'},{field:"rightValue",displayName:S,resizable:!1,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getRightValueColumnValue(row.entity)}}</div>'},{field:"nextConditionOperator",displayName:I,resizable:!1,sortable:!1,width:150,cellTemplate:"<div class=\"ui-grid-cell-contents\">{{grid.appScope._getOperatorDescriptionForType(row.entity[col.field], 'condition')}}</div>"}]},t.flowConditionGridOptions.onRegisterApi=function(e){t.flowConditionGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?(t.model.selectedFlowCondition=e.entity,t.focusFirstField(),t.model.selectedFlowCondition&&u(t.model.selectedFlowCondition)):t.model.selectedFlowCondition=void 0})},t.focusFirstField=function(){r(function(){var e=document.getElementById("leftVariableField");e&&e.focus()},100)},t.addNewCondition=function(){var i={leftFormFieldId:"",operator:"",rightFormFieldId:"",rightRestResponseId:"",rightValue:"",nextConditionOperator:""};t.flowConditionGridApi.selection.clearSelectedRows(),e.tabFlowConditions.push(i),r(function(){t.flowConditionGridApi.selection.toggleRowSelection(i)})},t.removeCondition=function(){if(t.model.selectedFlowCondition){var i=e.tabFlowConditions.indexOf(t.model.selectedFlowCondition);t.flowConditionGridApi.selection.clearSelectedRows(),e.tabFlowConditions.splice(i,1),r(function(){e.tabFlowConditions.length>0?t.flowConditionGridApi.selection.toggleRowSelection(e.tabFlowConditions[0]):t.model.selectedFlowCondition=void 0})}},t.moveConditionUp=function(){if(t.model.selectedFlowCondition){var i=e.tabFlowConditions.indexOf(t.model.selectedFlowCondition);if(0!==i){var o=e.tabFlowConditions[i];e.tabFlowConditions.splice(i,1),r(function(){e.tabFlowConditions.splice(i+-1,0,o),r(function(){t.flowConditionGridApi.selection.toggleRowSelection(e.tabFlowConditions[0])})})}}},t.moveConditionDown=function(){if(t.model.selectedFlowCondition){var i=e.tabFlowConditions.indexOf(t.model.selectedFlowCondition);if(i!==e.tabFlowConditions.length-1){var o=e.tabFlowConditions[i];e.tabFlowConditions.splice(i,1),r(function(){e.tabFlowConditions.splice(i+1,0,o),r(function(){t.flowConditionGridApi.selection.toggleRowSelection(e.tabFlowConditions[0])})})}}},t.setLeftFieldType=function(e){t.model.selectedFlowCondition.leftFieldType=e,"formField"===e?(t.model.selectedLeftVariable="",t.model.selectedFlowCondition.leftRestResponseId="",t.model.selectedFlowCondition.leftOutcomeFormId="",t.model.selectedFlowCondition.leftOutcomeFormName=""):"restResponse"===e?(t.model.selectedFlowCondition.leftFormFieldId="",t.model.selectedFlowCondition.leftOutcomeFormId="",t.model.selectedFlowCondition.leftOutcomeFormName=""):"outcome"===e&&(t.model.selectedLeftVariable="",t.model.selectedFlowCondition.leftFormFieldId="",t.model.selectedFlowCondition.leftRestResponseId="")},t.setRightFieldType=function(e){t.model.selectedFlowCondition.rightFieldType=e,"formField"===e?(t.model.selectedFlowCondition.rightValue="",t.model.selectedFlowCondition.rightRestResponseId="",t.model.selectedFlowCondition.rightOutcomeName=""):"staticValue"===e?(t.model.selectedFlowCondition.rightFormFieldId="",t.model.selectedFlowCondition.rightRestResponseId="",t.model.selectedFlowCondition.rightOutcomeName="",t.model.selectedRightVariable=""):"restResponse"===e?(t.model.selectedFlowCondition.rightValue="",t.model.selectedFlowCondition.rightFormFieldId="",t.model.selectedFlowCondition.rightOutcomeName="",t.model.selectedRightVariable=""):"outcome"===e&&(t.model.selectedFlowCondition.rightValue="",t.model.selectedFlowCondition.rightFormFieldId="",t.model.selectedFlowCondition.rightRestResponseId="",t.model.selectedRightVariable="")},t.selectLeftFormField=function(e,t){e.leftFormFieldId=t.id},t.selectRightFormField=function(e,t){e.rightFormFieldId=t.id},t.selectLeftResponseVariable=function(e,t){e.leftRestResponseId=t.processVariableName},t.selectRightResponseVariable=function(e,t){e.rightRestResponseId=t.processVariableName},t.selectLeftForm=function(e,i){e.leftOutcomeFormId=i.id,e.leftOutcomeFormName=i.name,t.selectRightForm(e,i)},t.selectRightForm=function(e,i){e.rightOutcomeFormId=i.id,e.rightOutcomeFormName=i.name,e.rightOutcomeName=void 0,t.refreshAvailableOutcomes(e.rightOutcomeFormId)
},t.selectFormOutcome=function(e,t){e.rightOutcomeName=t.name},t.isShowRightHandSide=function(){return null!==t.model.selectedFlowCondition&&void 0!==t.model.selectedFlowCondition&&"empty"!==t.model.selectedFlowCondition.operator&&"notEmpty"!==t.model.selectedFlowCondition.operator},t.closeDatePopup=function(){jQuery("#rightValueField").blur()},t.clearDate=function(){t.model.selectedFlowCondition.rightValue=void 0,jQuery("#rightValueField").blur()},t.selectToday=function(e,t){var i=new Date;i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),e=i,t&&t(e),jQuery("#rightValueField").blur()},t.refreshAvailableResponseVariables(),t.refreshAvailableFormFields(),t.refreshAvailableForms(),t.refreshAvailableOutcomes()}]),angular.module("activitiModeler").controller("StepExpressionTextPopupController",["$rootScope","$scope","$translate","$http","$timeout",function(e,t,i,o,n){t.allowedTypes=["text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount"],t.insertFormField={position:0},t.model={urlFieldType:"formField"},t.setUrlFieldType=function(e){"restResponse"===e?t.model={urlFieldType:"restResponse"}:"formField"===e&&(t.model={urlFieldType:"formField"})},t.$watch("insertFormField.field",function(e){if(e){var i;t.expressionText.value&&(i=t.expressionText.value);var o="${"+e.id+"}";i=i?i.substring(0,t.insertFormField.position)+o+i.substring(t.insertFormField.position):o,t.insertFormField.field=void 0,n(function(){var e=angular.element("#readonly-text-value");e.focus(),e.val(i),t.expressionText.value=i},200)}}),t.save=function(){t.resolveExpressionText(t.expressionText.value),t.close()},t.close=function(){t.$hide(),t.$parent.$hide()}}]),angular.module("activitiModeler").service("FormBuilderService",["$http","$q","$rootScope","$translate","editorCache","ProcessBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a){function s(e){return e.forEach(function(e){for(var t in e)0===t.indexOf("_")&&delete e[t];if(e.fields)for(var i in e.fields)s(e.fields[i])}),e}var l=function(i){var o=t.defer();return e(i).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise};this.saveForm=function(t,o,n,r,a){function l(e){var t={};return e&&Array.isArray(e)&&e.forEach(function(e){e.key&&e.key.length>0&&e.key.trim().length>0&&(t[e.key]=e.value)}),t}var d=0;t.formRepresentation=i.currentForm,t.formRepresentation.name=o,n&&n.length>0&&(t.formRepresentation.description=n);for(var c=[],p=0;i.formItems.length>p;p++){var u=i.formItems[p];(!i.activeFormTab||!i.activeFormTab.id||u.tab&&u.tab===i.activeFormTab.id)&&c.push(u)}for(var p=0;c.length>p;p++)i.formItems.splice(i.formItems.indexOf(c[p]),1);for(var p=0;i.currentFormItems.length>p;p++)i.formItems.push(i.currentFormItems[p]);for(var p=0;i.formItems.length>p;p++){var m=i.formItems[p];if(("container"===m.type||"group"===m.type)&&m.fields)for(var h in m.fields)if(m.fields[h])for(var f=0;m.fields[h].length>f;f++)this._cleanFormField(m.fields[h][f],d++);"container"!==m.type&&this._cleanFormField(m,d++)}if(i.selectedActiveFormTab&&i.selectedActiveFormTab.id){var g=function(e,t){e&&(e.nextCondition=void 0);var i={};return t.length>0?(i=t.shift(),e.nextCondition=i,g(e.nextCondition,t),void 0):i};if(i.tabVisibilityConditions){var v=i.tabVisibilityConditions.shift();g(v,i.tabVisibilityConditions),i.selectedActiveFormTab.visibilityCondition=v}}var S=i.formBuilder.activeTab;"design"!==S&&(i.formBuilder.activeTab="design"),t.formRepresentation.formDefinition={fields:s(angular.copy(i.formItems)),tabs:i.formTabs,outcomes:i.currentOutcomes,className:i.currentFormClassName,style:i.currentFormStyle,javascriptEvents:i.formJavascriptEvents,metadata:l(i.currentMetadata),variables:i.currentFormVariables,gridsterForm:!1},html2canvas(jQuery("#canvasSection"),{onrendered:function(o){var n=o.width/300,s=document.createElement("canvas");s.setAttribute("width",300),s.setAttribute("height",o.height/n);var l=s.getContext("2d");l.drawImage(o,0,0,o.width,o.height,0,0,300,o.height/n),t.formImageBase64=s.toDataURL("image/png"),delete Array.prototype.toJSON,e({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+i.currentForm.id,data:t}).success(function(e){r&&r(e)}).error(function(){a&&a()}),"design"!==S&&(i.formBuilder.activeTab=S)}})},this.validateForm=function(t){var n={};n.formRepresentation=i.currentForm,n.processScopeIdentifiers=a.getIdentifiers();for(var r=0,l=0;i.formItems.length>l;l++){var d=i.formItems[l];if(("container"===d.type||"group"===d.type)&&d.fields)for(var c in d.fields)if(d.fields[c])for(var p=0;d.fields[c].length>p;p++)this._cleanFormField(d.fields[c][p],r++);"container"!==d.type&&this._cleanFormField(d,r++)}var u=i.formBuilder.activeTab;"design"!==u&&(i.formBuilder.activeTab="design"),n.formRepresentation.formDefinition={fields:s(angular.copy(i.formItems)),outcomes:i.currentOutcomes,variables:i.currentFormVariables},delete Array.prototype.toJSON,e({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+i.currentForm.id+"/validate",data:n}).success(function(e){e&&e.length>0?(i.currentFormValidationErrors=e,i.addAlertPromise(o("FORM-BUILDER.ALERT.VALIDATION-ERROR"),"error")):(i.currentFormValidationErrors=[],i.addAlertPromise(o("FORM-BUILDER.ALERT.VALIDATION-OK"),"info"));for(var n=[],r=0;i.currentFormValidationErrors.length>r;r++)0>n.indexOf(i.currentFormValidationErrors[r].id)&&n.push(i.currentFormValidationErrors[r].id);if(i.formItems)for(var r=0;i.formItems.length>r;r++){var a=i.formItems[r];if(("container"===a.type||"group"===a.type)&&a.fields)for(var s in a.fields)if(a.fields[s])for(var l=0;a.fields[s].length>l;l++)a.fields[s][l].hasValidationError=n.indexOf(a.fields[s][l].id)>=0;"container"!==a.type&&(a.hasValidationError=n.indexOf(a.id)>=0)}t&&t(e)})},this.getStencilSet=function(e){var t;return t=e&&isNaN(e)===!1?ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+e+"/formeditor?version="+Date.now():ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/0/formeditor?version="+Date.now(),l({method:"GET",url:t})},this.normalizeByRegExp=function(e,t){var i="",o=0;for(o=0;e.length>o;o++)t.test(i+e[o])&&(i+=e[o]);return i},this._cleanFormField=function(e,t){if(!e.overrideId){var i,o=/^[a-zA-Z][_a-zA-Z0-9]*$/;if(e.name&&e.name.length>0){var n=this.normalizeByRegExp(e.name,o);i=n.toLowerCase()}else i="field"+t;e.id=i}e.layout||(e.layout={}),e.layout.colspan=e.sizeX,e.layout.row=e.row,e.layout.column=e.col,delete e.hasValidationError};var d=function(e){if(e&&!(1>e.length)){var t=[],i=[];angular.copy(e,t);for(var o=0;t.length>o;o++){var n=t[o];if("RestFieldRepresentation"===n.fieldType){var r=angular.copy(n);r.id=n.id+"_LABEL",r.name=n.name+" - label",i.push(r),n.name=n.name+" - id"}i.push(n)}return i}};this.additionalFormFieldProcessing=function(e){return d(e)}}]),angular.module("activitiModeler").controller("FormBuilderController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","FormBuilderService","ProcessBuilderService","FormUtilService","EndpointUtilService","ProcessScopeService","SystemPropertiesService","EditorScopeService",function(e,t,i,o,n,r,a,s,l,d,c,p,u,m,h,f){function g(e){("container"===e.type||"group"===e.type)&&(e.fieldType="ContainerRepresentation",e.fields||(e.fields={1:[],2:[]}))}function v(e){if(("container"===e.type||"group"===e.type)&&e.fields){var t=!0;for(var i in e.fields){var o=e.fields[i];if(0!==o.length){t=!1;break}}t&&(e.fields=null)}}function S(e,i,o,n){var r="1";try{var a=n.currentTarget.getBoundingClientRect();r=n.pageX-a.left<a.width/2?"1":"2"}catch(s){}var l=null;if(o>0&&(l=e[o-1],"group"===l.type&&!l.fields&&"dynamic-table"===e[o].type)){var d=t.findFieldContainer(i);return x=null,t.onFieldMoved(i,d),g(l),l.fields[r].push(i),!0}return!1}function I(i,o){var n="1";try{var r=o.currentTarget.getBoundingClientRect();n=o.pageX-r.left<r.width/2?"1":"2"}catch(a){}var s;e.activeFormTab&&e.activeFormTab.id&&(s=e.activeFormTab.id);var l={id:(new Date).getTime(),type:"container",fieldType:"ContainerRepresentation",name:"Label",numberOfColumns:2,required:!1,readOnly:!1,tab:s,sizeX:2,sizeY:1,row:-1,col:-1,fields:{1:[],2:[]}};return l.fields[n].push(i),t.setFieldDragDropAttributes(l,"newField"),l}function O(){var t,i=null;return 0!==e.currentFormItems.size()&&(t=e.currentFormItems.find(function(e){return Object.keys(e.fields).forEach(function(t){!i&&e.fields[t]&&0===e.fields[t].size()&&(i=t)}),i})),t?t.fields[i]:void 0}function b(e,t){var i=-1;return e.forEach(function(e,o){t._guid===e._guid&&(i=o)}),i}function E(e,t){e.splice(t,1)}function y(e){-1!==navigator.appVersion.indexOf("MSIE 9")&&(e._guid+="_")}function R(t,i,o,n){var r;if(x=t,t&&(r=b(t,i),-1!==r&&E(t,r)),t===e.currentFormItems&&1===i._width){var a=S(e.currentFormItems,i,o,n);if(!a){var s=I(i,n);return e.formItems.push(s),s}return null}return y(i),i}function T(){var e=[];if(t.formElements.length>0){t.formElements.forEach(function(t){if("dynamic-table"===t.type||"group"===t.type)if(null!==t.name.match(/^Label\d+$/)){var i=t.name.replace("Label","");e.push(parseInt(i))}else"Label"===t.name&&e.push(0);for(var o in t.fields)t.fields[o].forEach(function(t){if(null!==t.name.match(/^Label\d+$/)){var i=t.name.replace("Label","");e.push(parseInt(i))}else"Label"===t.name&&e.push(0)})});var i=1;e=e.slice(0).sort(function(e,t){return e-t});for(var o=0;e.length>o;o++)i>=e[o]&&(i=parseInt(e[o])+1);return"Label"+i}return"Label"}function C(e){var t;return"dynamic-table"===e?t="DynamicTableRepresentation":"container"===e||"group"===e?t="ContainerRepresentation":"hyperlink"===e?t="HyperlinkRepresentation":"amount"===e?t="AmountFieldRepresentation":"upload"===e?t="AttachFileFieldRepresentation":("typeahead"===e||"radio-buttons"===e||"dropdown"===e)&&(t="RestFieldRepresentation"),t}function A(e){var t=1;return"multi-line-text"===e?t=2:"dynamic-table"===e&&(t=2),t}function N(e){var t=1;return("group"===e||"dynamic-table"===e)&&(t=2),t}function F(){var t=void 0;return e.activeFormTab&&e.activeFormTab.id&&(t=e.activeFormTab.id),t}function M(e){return e.hasOwnProperty("_guid")}function D(t,i,o,n){if(t===e.currentFormItems&&1===i._width){var r=S(e.currentFormItems,i,o,n);if(!r){var a=I(i,n);return e.formItems.push(a),a}return null}if(2===i._width)e.formItems.push(i);else if(t&&t.length>0){var s=1;t[0].colspan&&(s=t[0].colspan),i.colspan=s}else i.colspan=1;return i}function P(e){x=null;var o=e.type,n=N(o),r=A(o),a=C(o),s=F(),l=T();"custom"===o&&e.customType&&e.customType.length>0&&(o=e.customType);var d={type:o,fieldType:a,id:l.toLowerCase(),name:l,required:!1,readOnly:!1,tab:s,sizeX:n,sizeY:r,row:-1,col:-1,colspan:1};return t.setFieldDragDropAttributes(d,"newField"),"radio-buttons"===o&&(d.options=[{id:"option_1",name:i.instant("FORM-BUILDER.COMPONENT.RADIO-BUTTON-DEFAULT_1")},{id:"option_2",name:i.instant("FORM-BUILDER.COMPONENT.RADIO-BUTTON-DEFAULT_2")}]),"dropdown"===o&&(d.options=[{id:"",name:i.instant("FORM-BUILDER.COMPONENT.DROPDOWN-DEFAULT-EMPTY-SELECTION")}],d.value=d.options[0].name,d.hasEmptyValue=!0),"readonly-text"===d.type&&(d.value=i.instant("FORM-BUILDER.COMPONENT.DISPLAY-TEXT-DEFAULT")),"container"===d.type&&(d.id=(new Date).getTime(),d.numberOfColumns=2,d.fields={1:[],2:[]}),"group"===d.type&&(d.numberOfColumns=2,d.fields={1:[],2:[]}),d}function w(e,t,i,o){e.unsavedChangesModalInstance||(e.handleResponseFunction=function(n){e.unsavedChangesModalInstance=void 0,n===!0?i&&i():n===!1?t&&t():o&&o()},_internalCreateModal({template:"editor-app/popups/unsaved-changes.html",scope:e},a,e))}var x=null;m.init(),e.formBuilder={activeTab:"design"},t.model={useOutcomes:!1,formClassName:"",formStyle:"",metadata:[],isReusable:!0},e.currentReadonlyFields={fields:{}},e.formItems=void 0,e.formTabs=void 0,e.activeFormTab=void 0,e.selectedActiveFormTab=void 0,e.tabVisibilityConditions=void 0,e.currentFormItems=void 0,t.$watch("model.useOutcomes",function(t){t?e.currentOutcomes&&0!==e.currentOutcomes.length||(e.currentOutcomes=[{name:""}]):e.currentOutcomes=[]}),t.$watch("model.formClassName",function(t){e.currentFormClassName=t}),t.$watch("model.formStyle",function(t){e.currentFormStyle=t}),t.$watch("model.metadata",function(t){e.currentMetadata=t}),t.$watch("model.variables",function(t){e.currentFormVariables=t});var _=1;if(t.formTabClicked=function(t){for(var i=[],o=0;e.formItems.length>o;o++){var n=e.formItems[o];e.activeFormTab&&e.activeFormTab.id&&n.tab&&n.tab===e.activeFormTab.id&&i.push(n)}for(var o=0;i.length>o;o++)e.formItems.splice(e.formItems.indexOf(i[o]),1);for(var o=0;e.currentFormItems.length>o;o++)e.formItems.push(e.currentFormItems[o]);e.activeFormTab=t,e.currentFormItems.length=0;for(var o=0;e.formItems.length>o;o++){var n=e.formItems[o];n.tab&&n.tab===e.activeFormTab.id&&e.currentFormItems.push(n)}},t.addNewFormTab=function(){var o={id:"tab"+_++,title:i.instant("STENCILS.ACTION.ADD-TAB-VALUE")};e.formTabs.push(o),1===e.formTabs.length?e.currentFormItems.forEach(function(e){if(("container"===e.type||"group"===e.type)&&e.fields)for(var t in e.fields){var i=e.fields[t];i&&i.length>0&&i.forEach(function(e){e.tab=o.id})}e.tab=o.id}):e.currentFormItems.length=0,e.activeFormTab=o,t.formTabClicked(o)},t.canMoveTab=function(t){if(e.activeFormTab){var i=e.formTabs.indexOf(e.activeFormTab);return"left"===t?i>0:e.formTabs.length-1>i}return!1},t.moveTab=function(i){if(e.activeFormTab){var o=e.formTabs.indexOf(e.activeFormTab);if(null!==o&&void 0!==o&&o>=0){var n=t.formTabs;"left"===i?(n[o]=n[o-1],n[o-1]=e.activeFormTab):(n[o]=n[o+1],n[o+1]=e.activeFormTab),e.formTabs=n}}},t.canDeleteTab=function(){return e.activeFormTab&&"details"!==e.activeFormTab.id&&"form"!==e.activeFormTab.id?!0:!1},t.deleteTab=function(){var i=e.formTabs.indexOf(e.activeFormTab);e.formTabs.splice(i,1),e.formTabs.length>0?(e.currentFormItems.length=0,t.formTabClicked(e.formTabs[0])):e.currentFormItems&&e.currentFormItems.length>0&&(e.currentFormItems.forEach(function(e){if(("container"===e.type||"group"===e.type)&&e.fields)for(var t in e.fields){var i=e.fields[t];i&&i.length>0&&i.forEach(function(e){e.tab=void 0})}e.tab=void 0}),e.activeFormTab=void 0)},t.form={name:"",description:"",version:1},t.formElements=[],e.currentOutcomes=[],e.formJavascriptEvents=[],e.formChanges=!1,t.guidSequence=0,t.setFieldDragDropAttributes=function(e,i){if(e._guid||(e._guid=i+t.guidSequence++),!e._width){var o;o="container"===e.type||"group"===e.type?2:t.palletteElements.filter(function(t){return"custom"===t.type&&t.customType?t.customType===e.type:t.type===e.type}).map(function(e){return e.width})[0],e._width=o}if(e.fields)for(var n in e.fields)e.fields[n].forEach(function(e){t.setFieldDragDropAttributes(e,i)})},e.checkGroupsInSource=function(e){e.forEach(function(t,i){"group"===t.type&&(e.length-1>i&&"dynamic-table"===e[i+1].type?v(t):g(t))})},t.findFieldContainer=function(t){var i=null;return e.formItems.forEach(function(e){if(("container"===e.type||"group"===e.type)&&e.fields)for(var o in e.fields){var n=e.fields[o],r=-1;n&&n.length>0&&(n.forEach(function(e,i){t._guid===e._guid&&(r=i)}),r>=0&&(i=n))}}),i},t.onFieldMoved=function(t,i){if(i)if(x===i)e.checkGroupsInSource(i);else{if(i){var o=-1;if(i.forEach(function(e,i){t._guid===e._guid&&(o=i)}),-1!==o&&i.splice(o,1),0===i.length&&i!==e.currentFormItems){var n=function(e){var t,o;e.forEach(function(e,n){if("container"===e.type&&e.fields){var r=!1,a=!0;for(var s in e.fields)e.fields[s]===i&&(r=!0),e.fields[s]&&e.fields[s].length>0&&(a=!1);r&&a&&(t=n,o=e._guid)}}),t>-1&&e.splice(t,1)};n(e.currentFormItems),n(e.formItems)}}e.checkGroupsInSource(e.currentFormItems),e.checkGroupsInSource(e.formItems);for(var r,o=0;e.currentFormItems.length>o;o++){var a=e.currentFormItems[o];if(("container"===a.type||"group"===a.type)&&a.fields){for(var s in a.fields)if(a.fields[s]===i){r=a;break}if(r)break}}for(var o=0;e.currentFormItems.length>o;o++){var l=e.currentFormItems[o];if(("container"===l.type||"group"===l.type)&&l.fields){var d=2;l.numberOfColumns&&(d=l.numberOfColumns);var c,p=1,u=1,m=1,h=0;i&&i.length>0&&(h=i.length),t.colspan&&(u=t.colspan);for(var s in l.fields){var f=l.fields[s];if(f&&f.length>0)for(var g=0;f.length>g;g++)if(t._guid===f[g]._guid){if(m=f.length,c=parseInt(s),f.length>1){for(var v=0;f.length>v;v++)if(t._guid!==f[v]._guid){p=f[v].colspan;break}}else p=f[0].colspan;break}if(c)break}if(c){if(m>1&&u>1){var S=0;for(var s in l.fields)if(l.fields[s])if(l.fields[s].length>0){var I=parseInt(l.fields[s][0].colspan);I?S+=I:S++}else S++;if(l.numberOfColumns>S)for(var g=S+1;l.numberOfColumns>=g;g++)l.fields[""+(Object.keys(l.fields).length+1)]=[]}else if((h>0||r!==l)&&1===m&&u>1)if(c+u-1>Object.keys(l.fields).length)p=1,l.fields[""+(Object.keys(l.fields).length+1)]=[],delete l.fields[""+Object.keys(l.fields).length];else{for(var O=0,b=!1;!b;){if(0===Object.keys(l.fields).length)return;var E=Object.keys(l.fields).length,y=l.fields[""+E],R=1;y&&y.length>0&&y[0].colspan&&(R=y[0].colspan);var T=l.fields[""+(E-1)];if(T&&T.length>0?O+=R:O++,y&&y.length>0)if(T&&T.length>0){for(var v=0;y.length>v;v++)y[v].colspan=T[0].colspan?T[0].colspan:1;Array.prototype.push.apply(T,y)}else l.fields[""+(E-1)]=y;delete l.fields[""+E],O>=u-1&&(b=!0)}var S=0;for(var s in l.fields)if(l.fields[s])if(l.fields[s].length>0){var I=parseInt(l.fields[s][0].colspan);I?S+=I:S++}else S++;if(l.numberOfColumns>S)for(var g=S+1;l.numberOfColumns>=g;g++)l.fields[""+(Object.keys(l.fields).length+1)]=[]}var C=l.numberOfColumns;for(var s in l.fields){var A=l.fields[s];if(A)if(A.length>0){for(var u=A[0].colspan,g=0;A.length>g;g++)c===s&&(A[g].colspan=p),A[g].params.maxColspan=C;u?C-=u:C--}else C--}if(r&&r.fields&&r!==l)for(var s in r.fields)if(r.fields[s]===i){var N=0;for(var s in r.fields)if(r.fields[s])if(r.fields[s].length>0){var F=parseInt(r.fields[s][0].colspan);F?N+=F:N++}else N++;if(r.numberOfColumns>N)for(var v=N+1;r.numberOfColumns>=v;v++)r.fields[""+(Object.keys(r.fields).length+1)]=[];var M=r.numberOfColumns;for(var D in r.fields){var P=r.fields[D];if(P)if(P.length>0){for(var w=P[0].colspan,v=0;P.length>v;v++)P[v].params.maxColspan=C;w?M-=w:M--}else M--}break}break}}}}},t.afterDropField=function(t,i){e.checkGroupsInSource(i)},t.automaticAllocate=function(i){var o=P(i),n=O();if(1===o._width)if(n)n.push(o);else{var r=I(o,null);t.formElements.push(r),e.currentFormItems.push(r)}else t.formElements.push(o),e.currentFormItems.push(o)},t.onFieldDrop=function(e,t,i,o){if(M(e))return R(t,e,o,i);var n=P(e);return D(t,n,o,i)},t.javascriptEventsDisabled=!1,h.getSystemProperties().then(function(e){e.disableJavaScriptEventsInFormEditor&&(t.javascriptEventsDisabled=e.disableJavaScriptEventsInFormEditor)}),s.modelId){var L;L=s.modelHistoryId?ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+s.modelId+"/history/"+s.modelHistoryId:ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+s.modelId,o({method:"GET",url:L}).success(function(i){var o=i;t.model.isReusable=o.referenceId?!1:!0;var r=0;o.stencilSetId&&o.stencilSetId>0&&(r=o.stencilSetId),e.currentCustomFieldsValueInfo={},o.formDefinition.customFieldsValueInfo&&(e.currentCustomFieldsValueInfo=o.formDefinition.customFieldsValueInfo),d.getStencilSet(r).then(function(r){if(t.stencilSet=r,t.palletteElements=t.stencilSet&&t.stencilSet.fieldTypes?t.stencilSet.fieldTypes:[],e.formTabs=o.formDefinition.tabs,e.formTabs&&e.formTabs.length>0){e.activeFormTab=e.formTabs[0];for(var a=0;e.formTabs.length>a;a++){var s=e.formTabs[a];if(s.id&&"tab"===s.id.substring(0,3)){var l=s.id.replace("tab","");if(l&&isNaN(l)===!1){var d=parseInt(l);d>_&&(_=d)}}}_++}else e.formTabs=[];if(o.formDefinition.fields){e.checkGroupsInSource(o.formDefinition.fields);for(var a=0;o.formDefinition.fields.length>a;a++){var c=o.formDefinition.fields[a];c.params||(c.params={}),t.setFieldDragDropAttributes(c,"savedField")}t.formElements=o.formDefinition.fields}else t.formElements=[];if(o.formDefinition.outcomes?(e.currentOutcomes=o.formDefinition.outcomes,e.currentOutcomes.length>0&&(t.model.useOutcomes=!0)):e.currentOutcomes=[],o.formDefinition.className&&(e.currentFormClassName=o.formDefinition.className,t.model.formClassName=o.formDefinition.className),o.formDefinition.style&&(e.currentFormStyle=o.formDefinition.style,t.model.formStyle=o.formDefinition.style),o.formDefinition.javascriptEvents?Array.prototype.push.apply(e.formJavascriptEvents,o.formDefinition.javascriptEvents):e.formJavascriptEvents.length=0,o.formDefinition.metadata){var p=Object.keys(o.formDefinition.metadata).map(function(e){return{key:e,value:o.formDefinition.metadata[e]}});e.currentMetadata=p,t.model.metadata=p}if(o.formDefinition.variables){var u=o.formDefinition.variables||[];e.currentFormVariables=u,t.model.variables=u}if(e.currentForm=i,delete e.currentForm.formDefinition,e.formItems=t.formElements,e.formTabs.length>0){e.currentFormItems=[];for(var a=0;e.formItems.length>a;a++){var m=e.formItems[a];m.tab&&m.tab===e.activeFormTab.id&&e.currentFormItems.push(m)}}else e.currentFormItems=e.formItems.slice();e.formChanges=!1,n(function(){t.formLoaded=!0},200)})}).error(function(){t.model.loading=!1,e.addAlertPromise(i("FORM-MODEL.MESSAGE.NOT-FOUND"),"error"),r.path("/forms/")})}else t.formLoaded=!0;for(var V=1;null!=s["processModelId"+V]&&void 0!=s["processModelId"+V];)V++;V-=1,e.formReferenceId=f.getCurrentProcessModelId(),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+s.modelId}).success(function(t){e.currentFormModel=t}).error(function(){}),t.$watch("formItems",function(){t.formLoaded&&(e.formChanges=!0)},!0),t.$watch("currentOutcomes",function(){t.formLoaded&&(e.formChanges=!0)},!0),t.addOutcome=function(){e.currentOutcomes[e.currentOutcomes.length]={name:""}},t.removeOutcome=function(t){e.currentOutcomes.splice(t,1)},t.loadPreviousFormFields=function(){e.currentReadonlyFields.fields.data=m.getFormFields()},void 0===e.endpointConfigurations&&(e.endpointConfigurations=[]),u.getAllEndpointConfigurations().then(function(t){e.endpointConfigurations.length=0,Array.prototype.push.apply(e.endpointConfigurations,t)}),t.$on("$locationChangeStart",function(i,o){if(!e.ignoreChanges&&e.formChanges){i.preventDefault();var n=function(){e.ignoreChanges=!0,r.url(o.substring(o.indexOf("/#")+2))},a=function(){e.ignoreChanges=!1};t.yesNoCancel=!1,w(t,null,n,a)}else e.ignoreChanges=!1}),t.$on("formChangesEvent",function(){var e=function(){t.$broadcast("discardDataEvent")},i=function(){t.$broadcast("mustSaveEvent")},o=function(){t.$broadcast("continueEditingEvent")};t.yesNoCancel=!0,w(t,i,e,o)}),t.$on("readonly-field-referenced-field-changed",function(i,o){"dynamic-table"!==o.originalDisplayFieldType&&"dynamic-table"===o.formElement.params.field.type?n(function(){var t=p.determineContainerIndex(e.currentFormItems,o.formElement);o.formElement._width=2,p.removeFormElement(e.currentFormItems,o.formElement),p.removeFormElement(e.formItems,o.formElement),null!==t&&void 0!==t&&t>=0?t+1>=e.currentFormItems.length?e.currentFormItems.splice(t,0,o.formElement):e.currentFormItems.splice(t+1,0,o.formElement):e.currentFormItems.push(o.formElement)},0):"dynamic-table"===o.originalDisplayFieldType&&"dynamic-table"!==o.formElement.params.field.type&&n(function(){var i=p.determineContainerIndex(e.currentFormItems,o.formElement);if(p.removeFormElement(e.currentFormItems,o.formElement),p.removeFormElement(t.formItems,o.formElement),o.formElement._width=1,i>0&&"container"===e.currentFormItems[i-1].type)e.currentFormItems[i-1].fields["1"]?e.currentFormItems[i-1].fields["1"].push(o.formElement):e.currentFormItems[i-1].fields["1"]=[o.formElement];else if(i>0&&e.currentFormItems.length>i+1)e.currentFormItems[i+1].fields["1"]?e.currentFormItems[i+1].fields["1"].splice(0,0,o.formElement):e.currentFormItems[i+1].fields["1"]=[o.formElement];else{var n=I(o.formElement);e.formItems.push(n),e.currentFormItems.splice(i,0,n)}},0)}),t.getRestResponseVariables=function(){return m.getVariables()},t.$watch("formBuilder.activeTab",function(){if(e.formBuilder&&e.formBuilder.activeTab&&"tab"!==e.formBuilder.activeTab){var t=function(e,i){e&&(e.nextCondition=void 0);var o={};return i.length>0?(o=i.shift(),e.nextCondition=o,t(e.nextCondition,i),void 0):o},i=function(e,t){if(!t.nextCondition)return e.push(t),void 0;var o=t.nextCondition;t.nextCondition="",e.push(t),i(e,o)},o=function(){var t=[];return t[0]=e.activeFormTab.visibilityCondition,e.activeFormTab.visibilityCondition.nextCondition&&i(t,e.activeFormTab.visibilityCondition.nextCondition),t};if(e.tabVisibilityConditions){var n=e.tabVisibilityConditions.shift();t(n,e.tabVisibilityConditions),e.selectedActiveFormTab.visibilityCondition=n}e.activeFormTab&&e.activeFormTab.visibilityCondition?(e.tabVisibilityConditions.length=0,Array.prototype.push.apply(e.tabVisibilityConditions,o())):e.tabVisibilityConditions&&(e.tabVisibilityConditions.length=0)}}),h.getGlobalDateFormat(e.account.tenantId).then(function(t){t&&(e.globalDateFormat=t.globalDateFormat)})}]),angular.module("activitiModeler").controller("DynamicTableBuilderController",["$rootScope","$scope","$q","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","uiGridConstants",function(e,t,i,o,n,r,a,s,l,d,c,p){t.selectedColumnDefinitions=[],t.selectedFields=[],t.labels=[],t.formElement.columnDefinitions||(t.formElement.columnDefinitions=[]),t.columnTypes=["Boolean","Date","Dropdown","Number","Amount","String"],t.urlDynamicTableConfig={position:0,field:""},t.selectedColumnDefinition=void 0,t.labels.idLabel=o.instant("FORM-BUILDER.COMPONENT.HEADER-ID"),t.labels.nameLabel=o.instant("FORM-BUILDER.COMPONENT.HEADER-NAME"),t.labels.typeLabel=o.instant("FORM-BUILDER.COMPONENT.HEADER-TYPE"),t.gridOptions={data:t.formElement.columnDefinitions,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"id",displayName:t.labels.idLabel,cellClass:function(e,t,i){return""===e.getCellValue(t,i)||e.getCellValue(t,i)===!1?"dynamicTable-cellError":void 0}},{field:"name",displayName:t.labels.nameLabel,cellClass:function(e,t,i){return""===e.getCellValue(t,i)||e.getCellValue(t,i)===!1?"dynamicTable-cellError":void 0}},{field:"type",displayName:t.labels.typeLabel}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedColumnDefinition=e.entity,t.focusFirstField(),t.$broadcast("col-selection-changed",t.selectedColumnDefinition)})},t.focusFirstField=function(){r(function(){var e=document.getElementById("idField");e&&e.focus()},100)},t.columnTypeChanged=function(){t.selectedColumnDefinition&&"Dropdown"===t.selectedColumnDefinition.type&&(t.selectedColumnDefinition.optionType&&"manual"!==t.selectedColumnDefinition.optionType||t.selectedColumnDefinition.options&&0!==t.selectedColumnDefinition.options.length||(t.selectedColumnDefinition.options=[{name:"Option 1"}]))},t.setDynamicTableManualOptions=function(){t.selectedColumnDefinition.optionType="manual"},t.setDynamicTableRestOptions=function(){t.selectedColumnDefinition.optionType="rest"},t.confirmNewDynamicTableOption=function(e){if(t.newOption.name){var i=t.selectedColumnDefinition.options;i.push(t.newOption),t.newOption={name:""},2===i.length&&(t.selectedColumnDefinition.value=t.selectedColumnDefinition.options[0].name),e&&$(e.target).focus()}},t.columnDefinitionEndpointChanged=function(){t.$broadcast("col-endpoint-selection-changed",t.selectedColumnDefinition.endpoint)},t.$watch("selectedColumnDefinition.id",function(){t.gridApi.core.notifyDataChange(p.dataChange.ALL)},!0),t.$watch("selectedColumnDefinition.name",function(){t.gridApi.core.notifyDataChange(p.dataChange.ALL)},!0),t.$watch("urlDynamicTableConfig.field",function(e){if(e){var i=t.selectedColumnDefinition.restUrl,o="${"+e.id+"}";i=i?i.substring(0,t.urlDynamicTableConfig.position)+o+i.substring(t.urlDynamicTableConfig.position):o,t.urlDynamicTableConfig.field=void 0,r(function(){var e=angular.element("#rest-url-value");e.focus(),e.val(i),t.selectedColumnDefinition.restUrl=i},200)}}),t.removeDynamicTableOption=function(e){if(t.selectedColumnDefinition.options.splice(e,1),1===t.selectedColumnDefinition.options)t.selectedColumnDefinition.value="";else{for(var i=!1,o=0;t.selectedColumnDefinition.options.length>o;o++)t.selectedColumnDefinition.options[o].name===t.selectedColumnDefinition.value&&(i=!0);i||(t.selectedColumnDefinition.value=t.selectedColumnDefinition.options[0].name)}},t.addNewDefinition=function(){var e={id:"",name:"",type:"String",required:!0,editable:!0,sortable:!0,visible:!0};t.formElement.columnDefinitions.push(e),t.gridApi.selection.clearSelectedRows(),r(function(){t.gridApi.selection.toggleRowSelection(e)})},t.removeDefinition=function(){if(t.selectedColumnDefinition){var e=t.formElement.columnDefinitions.indexOf(t.selectedColumnDefinition);t.gridApi.selection.toggleRowSelection(t.selectedColumnDefinition),t.formElement.columnDefinitions.splice(e,1),r(function(){t.formElement.columnDefinitions.length>0?t.gridApi.selection.toggleRowSelection(t.formElement.columnDefinitions[0]):t.selectedColumnDefinition=void 0})}},t.moveDefinitionUp=function(){if(t.selectedColumnDefinition){var e=t.formElement.columnDefinitions.indexOf(t.selectedColumnDefinition);if(0!==e){var i=t.formElement.columnDefinitions[e];t.formElement.columnDefinitions.splice(e,1),t.gridApi.selection.clearSelectedRows(),r(function(){t.formElement.columnDefinitions.splice(e+-1,0,i),r(function(){t.gridApi.selection.toggleRowSelection(i)})})}}},t.moveDefinitionDown=function(){if(t.selectedColumnDefinition){var e=t.formElement.columnDefinitions.indexOf(t.selectedColumnDefinition);if(e!==t.formElement.columnDefinitions.length-1){var i=t.formElement.columnDefinitions[e];t.formElement.columnDefinitions.splice(e,1),t.gridApi.selection.clearSelectedRows(),r(function(){t.formElement.columnDefinitions.splice(e+1,0,i),r(function(){t.gridApi.selection.toggleRowSelection(i)})})}}},t.model={urlFieldType:"formField",requestMappingValues:[]},t.setUrlFieldType=function(e){"restResponse"===e?t.model={urlFieldType:"restResponse"}:"formField"===e&&(t.model={urlFieldType:"formField"})},t.getFullEndpointURL=function(){var e="";return t.selectedColumnDefinition.endpoint&&(e=u(t.selectedColumnDefinition.endpoint.protocol,t.selectedColumnDefinition.endpoint.host,t.selectedColumnDefinition.endpoint.port,t.selectedColumnDefinition.endpoint.path)),t.selectedColumnDefinition.restUrl&&(e="/"===e.charAt(e.length-1)&&"/"===t.selectedColumnDefinition.restUrl.charAt(0)?e.concat(t.selectedColumnDefinition.restUrl.substr(1)):""!==e&&"/"!==e.charAt(e.length-1)&&"/"!==t.selectedColumnDefinition.restUrl.charAt(0)?e.concat("/"+t.selectedColumnDefinition.restUrl):e.concat(t.selectedColumnDefinition.restUrl)),e};var u=function(e,t,i,o){var n=e.toLowerCase()+"://"+t;return n=i&&80!==i&&443!==i?n.concat(":"+i):n,n=o?n.concat(o):n}}]),angular.module("activitiModeler").controller("AttachFieldMetadataMappingBuilderController",["$rootScope","$scope","$q","$translate","$http","$timeout","$location","$modal","$routeParams","$popover",function(e,t,i,o,n,r){t.metaDataSelectedColumnDefinitions=[],t.selectedFields=[],t.labels=[],t.formElement.metaDataColumnDefinitions||(t.formElement.metaDataColumnDefinitions=[]),t.propertyTypes=["boolean","date","number","string"],t.urlDynamicTableConfig={position:0,field:""},t.metaDataSelectedColumnDefinition=void 0,t.labels.filePropertyLabel=o.instant("FORM-BUILDER.COMPONENT.ATTACH-FILE.METADATA.HEADER-FILE-PROPERTY"),t.labels.variableLabel=o.instant("FORM-BUILDER.COMPONENT.ATTACH-FILE.METADATA.HEADER-VARIABLE"),t.setValueType=function(e){t.metaDataSelectedColumnDefinition.valueType=e},t.gridOptions={data:t.formElement.metaDataColumnDefinitions,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"fileProperty",displayName:t.labels.filePropertyLabel},{field:"processVariable",displayName:t.labels.variableLabel,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getMappingColumnValue("processVariable",row.entity)}}</div>'}]},t._getMappingColumnValue=function(e,t){var i="";
return t?(t[e]&&(i=t[e].name,i||(i=t[e].id)),i):i},t.gridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.metaDataSelectedColumnDefinition=e.entity,t.focusFirstField()})},t.focusFirstField=function(){r(function(){var e=document.getElementById("filePropertyField");e&&e.focus()},100)},t.addNewDefinition=function(){var e={fileProperty:"",propertyType:"String",processVariable:{id:""}};t.formElement.metaDataColumnDefinitions.push(e),t.gridApi.selection.clearSelectedRows(),r(function(){t.gridApi.selection.toggleRowSelection(e)})},t.removeDefinition=function(){if(t.metaDataSelectedColumnDefinition){var e=t.formElement.metaDataColumnDefinitions.indexOf(t.metaDataSelectedColumnDefinition);t.gridApi.selection.toggleRowSelection(t.metaDataSelectedColumnDefinition),t.formElement.metaDataColumnDefinitions.splice(e,1),r(function(){t.formElement.metaDataColumnDefinitions.length>0?t.gridApi.selection.toggleRowSelection(t.formElement.metaDataColumnDefinitions[0]):t.metaDataSelectedColumnDefinition=void 0})}},t.moveDefinitionUp=function(){if(t.metaDataSelectedColumnDefinition){var e=t.formElement.metaDataColumnDefinitions.indexOf(t.metaDataSelectedColumnDefinition);if(0!==e){var i=t.formElement.metaDataColumnDefinitions[e];t.formElement.metaDataColumnDefinitions.splice(e,1),t.gridApi.selection.clearSelectedRows(),r(function(){t.formElement.metaDataColumnDefinitions.splice(e+-1,0,i),r(function(){t.gridApi.selection.toggleRowSelection(i)})})}}},t.moveDefinitionDown=function(){if(t.metaDataSelectedColumnDefinition){var e=t.formElement.metaDataColumnDefinitions.indexOf(t.metaDataSelectedColumnDefinition);if(e!==t.formElement.metaDataColumnDefinitions.length-1){var i=t.formElement.metaDataColumnDefinitions[e];t.formElement.metaDataColumnDefinitions.splice(e,1),t.gridApi.selection.clearSelectedRows(),r(function(){t.formElement.metaDataColumnDefinitions.splice(e+1,0,i),r(function(){t.gridApi.selection.toggleRowSelection(i)})})}}}}]),angular.module("activitiModeler").controller("AttachFieldBuilderController",["$rootScope","$scope",function(e,t){function i(e){var i=t.formElement.params.fileSource.selectedFolder;e&&(e.account&&(i.accountId=e.account.id),e.network&&(i.network=e.network),e.site&&e.path&&(i.siteId=e.site.id,i.pathId=e.path.id,i.folderTree=e.path.folderTree,i.path=e.path.title,i.site=e.site.title))}function o(e){var i=t.formElement.params.fileSource.selectedFolder;e&&(e.account&&(i.accountId=e.account.id),e.path&&(i.pathId=e.path.id,i.path=e.path.title,i.folderTree=e.path.folderTree))}function n(e){var i=t.formElement.params.fileSource.selectedFolder;e&&(e.account&&(i.accountId=e.account.id),e.path&&(i.pathId=e.path.id,i.path=e.path.title,i.folderTree=e.path.folderTree))}t.selectDestinationFolder=function(e){var r=t.formElement.params.fileSource.serviceId;t.formElement.params.fileSource.selectedFolder={},void 0!=r&&r.trim().length>9&&"alfresco-"===r.substring(0,9)?i(e):"google-drive"===r?o(e):"box"===r&&n(e)}}]),angular.module("activitiModeler").controller("AttachFolderBuilderController",["$rootScope","$scope",function(e,t){function i(e){var i=t.formElement.params.folderSource.selectedFolder;e&&(e.account&&(i.accountId=e.account.id),e.network&&(i.network=e.network),e.site&&e.path&&(i.siteId=e.site.id,i.pathId=e.path.id,i.folderTree=e.path.folderTree,i.path=e.path.title,i.site=e.site.title))}t.selectDestinationFolder=function(e){var o=t.formElement.params.folderSource.serviceId;t.formElement.params.folderSource.selectedFolder={},void 0!==o&&o.trim().length>9&&"alfresco-"===o.substring(0,9)&&i(e)}}]),angular.module("activitiModeler").controller("VisibilityConditionBuilderController",["$rootScope","$scope","$q","$translate","$http","$timeout","FormUtilService","FormBuilderService","$filter","ProcessScopeService",function(e,t,i,o,n,r,a,s,l,d){function c(t){return t&&-1===u.indexOf(t)&&e.currentCustomFieldsValueInfo&&e.currentCustomFieldsValueInfo[t]?e.currentCustomFieldsValueInfo[t].type:t}function p(t){var i=e.currentFormVariables||[],o=i.filter(function(e){return e.name===t});return o.length>0?o[0].type:null}var u=["text","multi-line-text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount"];t.model={},t.model.selectedVisibilityConditions=[],t.model.selectedFields=[],t.model.labels=[],t.model.visibilityConditions=[],t.model.selectedVisibilityCondition=void 0,t.model.leftFieldType="formField",t.model.rightFieldType="staticValue";var m=function(e,t){if(!t.nextCondition)return e.push(t),void 0;var i=t.nextCondition;t.nextCondition="",e.push(t),m(e,i)},h=function(){var e=[];return e[0]=t.formElement.visibilityCondition,t.formElement.visibilityCondition.nextCondition&&m(e,t.formElement.visibilityCondition.nextCondition),e};t.formElement.visibilityConditions||(t.formElement.visibilityConditions=[],t.formElement.visibilityCondition&&(t.formElement.visibilityConditions=h()));var f=o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.EQUALS"),g=o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.NOTEQUALS"),v=o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY"),S=o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY");t.model.conditionOperatorsByType={text:{index:{"==":0,"!=":1,empty:2,"!empty":3},operators:[{value:"==",description:f},{value:"!=",description:g},{value:"empty",description:v},{value:"!empty",description:S}]},string:{index:{"==":0,"!=":1,empty:2,"!empty":3},operators:[{value:"==",description:f},{value:"!=",description:g},{value:"empty",description:v},{value:"!empty",description:S}]},"multi-line-text":{index:{"==":0,"!=":1,empty:2,"!empty":3},operators:[{value:"==",description:f},{value:"!=",description:g},{value:"empty",description:v},{value:"!empty",description:S}]},date:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,"!empty":7},operators:[{value:"==",description:f},{value:"!=",description:g},{value:"<",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.BEFORE")},{value:">",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.AFTER")},{value:"<=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.BEFOREOREQUAL")},{value:">=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.AFTEROREQUAL")},{value:"empty",description:v},{value:"!empty",description:S}]},integer:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,"!empty":7},operators:[{value:"==",description:f},{value:"!=",description:g},{value:"<",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:v},{value:"!empty",description:S}]},number:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,"!empty":7},operators:[{value:"==",description:f},{value:"!=",description:g},{value:"<",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:v},{value:"!empty",description:S}]},amount:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,"!empty":7},operators:[{value:"==",description:f},{value:"!=",description:g},{value:"<",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:v},{value:"!empty",description:S}]},dropdown:{index:{"==":0,"!=":1},operators:[{value:"==",description:f},{value:"!=",description:g}]},typeahead:{index:{"==":0,"!=":1},operators:[{value:"==",description:f},{value:"!=",description:g}]},"radio-buttons":{index:{"==":0,"!=":1},operators:[{value:"==",description:f},{value:"!=",description:g}]},"boolean":{index:{"==":0,"!=":1},operators:[{value:"==",description:f},{value:"!=",description:g}]},condition:{index:{and:0,"and-not":1,or:2,"or-not":3},operators:[{value:"and",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.AND")},{value:"and-not",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.ANDNOT")},{value:"or",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.OR")},{value:"or-not",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.ORNOT")}]}},t.model.rightTypes=[{value:"string",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.STRING")},{value:"number",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.NUMBER")},{value:"date",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.DATE")}],t.model.rightValueOptions={"boolean":[{value:"true",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_VALUE_OPTIONS.BOOLEAN.CHECKED")},{value:"false",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_VALUE_OPTIONS.BOOLEAN.UNCHECKED")}]},t.$watch("model.selectedVisibilityCondition.operator",function(){t.model.selectedVisibilityCondition&&("empty"===t.model.selectedVisibilityCondition.operator||"!empty"===t.model.selectedVisibilityCondition.operator)&&(t.model.selectedVisibilityCondition.rightValue=void 0,t.model.selectedVisibilityCondition.rightType=void 0)}),t.$watch("model.selectedVisibilityCondition.leftFormFieldId",function(){if(t.model.selectedVisibilityCondition&&t.model.selectedLeftVariable){var e=c(t.model.selectedLeftVariable.type);if(e){var i=t.model.selectedVisibilityCondition.operator,o=t.model.conditionOperatorsByType[e].index[i];void 0===o&&(t.model.selectedVisibilityCondition.operator=void 0,t.model.selectedVisibilityCondition.rightValue=void 0,t.model.selectedVisibilityCondition.rightType=void 0)}}}),t.getNameForSelectedFormFieldId=function(e){var i="";if(e)for(var o=0;t.model.conditionFields.length>o;o++){var n=t.model.conditionFields[o];if(n.id===e){i=n.name;break}}return i},t._getLeftValueColumnValue=function(e){var t="";return e?(e.leftFormFieldId&&""!==e.leftFormFieldId?t=e.leftFormFieldId:e.leftRestResponseId&&""!==e.leftRestResponseId&&(t=e.leftRestResponseId),t):t},t._getRightValueColumnValue=function(e){var i="";return e?(e.rightFormFieldId&&""!==e.rightFormFieldId?i=e.rightFormFieldId:e.rightRestResponseId&&""!==e.rightRestResponseId?i=e.rightRestResponseId:null!==e.rightValue&&void 0!==e.rightValue&&""!==e.rightValue&&(i=e.leftFormFieldId&&""!==e.leftFormFieldId?"date"===t.getTypeForSelectedFormFieldId(e.leftFormFieldId)?l("date")(e.rightValue.split("T")[0],"d-M-yyyy"):e.rightValue:e.rightValue),i):i},t.getTypeForSelectedFormFieldId=function(e){return I(e)};var I=function(e){var i="";if(e)for(var o=0;t.model.conditionFields.length>o;o++){var n=t.model.conditionFields[o];if(n.id===e){i=c(n.type);break}}return i},O=function(e){var t="";if(e){if(t=p(e))return t.toLowerCase();var i=d.getVariables();if(i&&i.length>0)for(var o=0;i.length>o;o++){var n=i[o];if(n.processVariableName===e){t=n.processVariableType;break}}}return t.toLowerCase()};t.hasNoInputVariables=function(){return 0===t.getRestResponseVariables().length&&0===t.getFormVariables().length},t.getConditionsForFieldId=function(e,i){var o;return e?o=I(e):i&&(o=O(i)),o&&t.model.conditionOperatorsByType[o]?t.model.conditionOperatorsByType[o].operators:[]},t._getOperatorDescriptionForFieldId=function(e){if(e&&e.operator){var i;return e.leftFormFieldId?i=I(e.leftFormFieldId):e.leftRestResponseId&&(i=O(e.leftRestResponseId)),i?t._getOperatorDescriptionForType(e.operator,i):[]}},t._getOperatorDescriptionForType=function(e,i){if(e&&i){var o=t.model.conditionOperatorsByType[i].index[e];if(void 0!==o){var n=t.model.conditionOperatorsByType[i].operators[o].description;return n}}},t.fieldIsNotEmpty=function(e){return e&&null===e&&void 0===e&&""!==e?void 0:!0};var b=o.instant("FORM-BUILDER.VISIBILITY.LEFT-FORM-FIELD"),E=o.instant("FORM-BUILDER.VISIBILITY.OPERATOR"),y=o.instant("FORM-BUILDER.VISIBILITY.RIGHT-VALUE"),R=o.instant("FORM-BUILDER.VISIBILITY.NEXT-CONDITION-OPERATOR");t.visibilityGridOptions={data:t.formElement.visibilityConditions,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,enableColumnMenus:!1,columnDefs:[{field:"leftFormFieldId",displayName:b,resizable:!1,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getLeftValueColumnValue(row.entity)}}</div>'},{field:"operator",displayName:E,resizable:!0,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getOperatorDescriptionForFieldId(row.entity)}}</div>'},{field:"rightValue",displayName:y,resizable:!1,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getRightValueColumnValue(row.entity)}}</div>'},{field:"nextConditionOperator",displayName:R,resizable:!1,sortable:!1,width:150,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getOperatorDescriptionForType(row.entity[col.field], "condition")}}</div>'}]},t.visibilityGridOptions.onRegisterApi=function(e){t.visibilityGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){if(e.isSelected){if(t.model.selectedVisibilityCondition=e.entity,t.focusFirstField(),t.model.selectedVisibilityCondition){var i={},o={};if(t.model.conditionFields)for(var n=0;t.model.conditionFields.length>n;n++)t.model.selectedVisibilityCondition.leftFormFieldId&&t.model.selectedVisibilityCondition.leftFormFieldId===t.model.conditionFields[n].id&&(i=t.model.conditionFields[n]),t.model.selectedVisibilityCondition.rightFormFieldId&&t.model.selectedVisibilityCondition.rightFormFieldId===t.model.conditionFields[n].id&&(o=t.model.conditionFields[n]);t.model.selectedLeftVariable=i,t.model.selectedRightVariable=o,t.model.selectedVisibilityCondition.leftFormFieldId&&""!==t.model.selectedVisibilityCondition.leftFormFieldId?t.model.leftFieldType="formField":t.model.selectedVisibilityCondition.leftRestResponseId&&""!==t.model.selectedVisibilityCondition.leftRestResponseId&&(t.model.leftFieldType="restResponse"),t.model.selectedVisibilityCondition.rightValue&&(""+t.model.selectedVisibilityCondition.rightValue).length>0?t.model.rightFieldType="staticValue":t.model.selectedVisibilityCondition.rightFormFieldId&&""!==t.model.selectedVisibilityCondition.rightFormFieldId?t.model.rightFieldType="formField":t.model.selectedVisibilityCondition.rightRestResponseId&&""!==t.model.selectedVisibilityCondition.rightRestResponseId&&(t.model.rightFieldType="restResponse")}}else t.model.selectedVisibilityCondition=void 0})},t.focusFirstField=function(){r(function(){var e=document.getElementById("leftVariableField");e&&e.focus()},100)},t.addNewCondition=function(){var e={leftFormFieldId:"",operator:"",rightFormFieldId:"",rightRestResponseId:"",rightValue:"",nextConditionOperator:""};t.visibilityGridApi.selection.clearSelectedRows(),t.formElement.visibilityConditions.push(e),r(function(){t.visibilityGridApi.selection.toggleRowSelection(e)})},t.removeCondition=function(){if(t.model.selectedVisibilityCondition){var e=t.formElement.visibilityConditions.indexOf(t.model.selectedVisibilityCondition);t.visibilityGridApi.selection.clearSelectedRows(),t.formElement.visibilityConditions.splice(e,1),r(function(){t.formElement.visibilityConditions.length>0?t.visibilityGridApi.selection.toggleRowSelection(t.formElement.visibilityConditions[0]):t.model.selectedVisibilityCondition=void 0})}},t.moveConditionUp=function(){if(t.model.selectedVisibilityCondition){var e=t.formElement.visibilityConditions.indexOf(t.model.selectedVisibilityCondition);if(0!==e){var i=t.formElement.visibilityConditions[e];t.formElement.visibilityConditions.splice(e,1),r(function(){t.formElement.visibilityConditions.splice(e+-1,0,i),r(function(){t.visibilityGridApi.selection.toggleRowSelection(t.formElement.visibilityConditions[0])})})}}},t.moveConditionDown=function(){if(t.model.selectedVisibilityCondition){var e=t.formElement.visibilityConditions.indexOf(t.model.selectedVisibilityCondition);if(e!==t.formElement.visibilityConditions.length-1){var i=t.formElement.visibilityConditions[e];t.formElement.visibilityConditions.splice(e,1),r(function(){t.formElement.visibilityConditions.splice(e+1,0,i),r(function(){t.visibilityGridApi.selection.toggleRowSelection(t.formElement.visibilityConditions[0])})})}}},t.getPreviousAndCurrentFormFields=function(){var i={},o=[],n=["text","multi-line-text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount"];for(var r in e.currentCustomFieldsValueInfo)n.push(r);var l=d.getFormFields(n);if(l&&l.length>0)for(var c=0;l.length>c;c++)n.indexOf(l[c].type)>-1&&("readonly"===t.formElement.type||l[c].id!==t.formElement.id)&&(i[l[c].id]=!0,o.push(l[c]));var p=a.flattenFields(e.formItems);if(p&&p.length>0){p=s.additionalFormFieldProcessing(p);for(var c=0;p.length>c;c++){var u=p[c];n.indexOf(u.type)>-1&&!i[u.id]&&u.id!==t.formElement.id&&(i[u.id]=!0,o.push(u))}}o.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),t.model.conditionFields=o},t.setLeftFieldType=function(e){t.model.leftFieldType=e,"formField"===e?(t.model.selectedVisibilityCondition.leftRestResponseId="",t.model.selectedLeftVariable=""):"restResponse"===e&&(t.model.selectedVisibilityCondition.leftFormFieldId="")},t.setRightFieldType=function(e){t.model.rightFieldType=e,"formField"===e?(t.model.selectedVisibilityCondition.rightValue="",t.model.selectedVisibilityCondition.rightRestResponseId=""):"staticValue"===e?(t.model.selectedVisibilityCondition.rightFormFieldId="",t.model.selectedVisibilityCondition.rightRestResponseId="",t.model.selectedRightVariable=""):"restResponse"===e&&(t.model.selectedVisibilityCondition.rightValue="",t.model.selectedVisibilityCondition.rightFormFieldId="",t.model.selectedRightVariable="")},t.setRightType=function(e){t.model.selectedVisibilityCondition.rightType=e},t.getPreviousAndCurrentFormFields(),t.getRestResponseVariables=function(){return d.getVariables()||[]},t.selectLeftResponseVariable=function(e,t){e.leftRestResponseId=t.processVariableName},t.selectRightResponseVariable=function(e,t){e.rightRestResponseId=t.processVariableName},t.getFormVariables=function(){return e.currentFormVariables||[]},t.selectLeftFormVariable=function(e,t){e.leftRestResponseId=t.name},t.selectRightFormVariable=function(e,t){e.rightRestResponseId=t.name},t.closeDatePopup=function(){jQuery("#rightValueField").blur()},t.clearDate=function(){t.model.selectedVisibilityCondition.rightValue=void 0,jQuery("#rightValueField").blur()},t.selectToday=function(e,t){var i=new Date;i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),e=i,t&&t(e),jQuery("#rightValueField").blur()}}]),angular.module("activitiModeler").controller("TabVisibilityConditionBuilderController",["$rootScope","$scope","$q","$translate","$http","$timeout","FormUtilService","FormBuilderService","$filter","ProcessScopeService",function(e,t,i,o,n,r,a,s,l,d){function c(t){return t&&-1===p.indexOf(t)&&e.currentCustomFieldsValueInfo&&e.currentCustomFieldsValueInfo[t]?e.currentCustomFieldsValueInfo[t].type:t}var p=["text","multi-line-text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount"];t.model={},t.model.selectedVisibilityConditions=[],t.model.selectedFields=[],t.model.labels=[],t.model.visibilityConditions=[],t.model.selectedVisibilityCondition=void 0,t.model.leftFieldType="formField",t.model.rightFieldType="staticValue";var u=function(e,t){if(!t.nextCondition)return e.push(t),void 0;var i=t.nextCondition;t.nextCondition="",e.push(t),u(e,i)},m=function(){var t=[];return t[0]=e.activeFormTab.visibilityCondition,e.activeFormTab.visibilityCondition.nextCondition&&u(t,e.activeFormTab.visibilityCondition.nextCondition),t};e.tabVisibilityConditions=e.activeFormTab&&e.activeFormTab.visibilityCondition?m():[],e.selectedActiveFormTab=e.activeFormTab,t.$watch("activeFormTab",function(){if(e.selectedActiveFormTab&&e.selectedActiveFormTab.id!==e.activeFormTab.id){var i=function(e,t){e&&(e.nextCondition=void 0);var o={};return t.length>0?(o=t.shift(),e.nextCondition=o,i(e.nextCondition,t),void 0):o};if(e.tabVisibilityConditions){var o=e.tabVisibilityConditions.shift();i(o,e.tabVisibilityConditions),e.selectedActiveFormTab.visibilityCondition=o}e.activeFormTab.visibilityCondition?(e.tabVisibilityConditions.length=0,Array.prototype.push.apply(e.tabVisibilityConditions,m())):e.tabVisibilityConditions.length=0,t.model.selectedVisibilityCondition=void 0,e.selectedActiveFormTab=e.activeFormTab}});var h=o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.EQUALS"),f=o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.NOTEQUALS"),g=o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY"),v=o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY");t.model.conditionOperatorsByType={text:{index:{"==":0,"!=":1,empty:2,"!empty":3},operators:[{value:"==",description:h},{value:"!=",description:f},{value:"empty",description:g},{value:"!empty",description:v}]},string:{index:{"==":0,"!=":1,empty:2,"!empty":3},operators:[{value:"==",description:h},{value:"!=",description:f},{value:"empty",description:g},{value:"!empty",description:v}]},"multi-line-text":{index:{"==":0,"!=":1,empty:2,"!empty":3},operators:[{value:"empty",description:g},{value:"!empty",description:v},{value:"==",description:h},{value:"!=",description:f}]},date:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,"!empty":7},operators:[{value:"==",description:h},{value:"!=",description:f},{value:"<",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.BEFORE")},{value:">",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.AFTER")},{value:"<=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.BEFOREOREQUAL")},{value:">=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.AFTEROREQUAL")},{value:"empty",description:g},{value:"!empty",description:v}]},integer:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,"!empty":7},operators:[{value:"==",description:h},{value:"!=",description:f},{value:"<",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:g},{value:"!empty",description:v}]},number:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,"!empty":7},operators:[{value:"==",description:h},{value:"!=",description:f},{value:"<",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:g},{value:"!empty",description:v}]},amount:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,"!empty":7},operators:[{value:"==",description:h},{value:"!=",description:f},{value:"<",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:g},{value:"!empty",description:v}]},dropdown:{index:{"==":0,"!=":1},operators:[{value:"==",description:h},{value:"!=",description:f}]},"radio-buttons":{index:{"==":0,"!=":1},operators:[{value:"==",description:h},{value:"!=",description:f}]},"boolean":{index:{"==":0,"!=":1},operators:[{value:"==",description:h},{value:"!=",description:f}]},condition:{index:{and:0,"and-not":1,or:2,"or-not":3},operators:[{value:"and",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.AND")},{value:"and-not",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.ANDNOT")},{value:"or",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.OR")},{value:"or-not",description:o.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.ORNOT")}]}},t.model.rightTypes=[{value:"string",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.STRING")},{value:"number",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.NUMBER")},{value:"date",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.DATE")}],t.model.rightValueOptions={"boolean":[{value:"true",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_VALUE_OPTIONS.BOOLEAN.CHECKED")},{value:"false",description:o.instant("FORM-BUILDER.VISIBILITY.RIGHT_VALUE_OPTIONS.BOOLEAN.UNCHECKED")}]},t.$watch("model.selectedVisibilityCondition.operator",function(){t.model.selectedVisibilityCondition&&("empty"===t.model.selectedVisibilityCondition.operator||"!empty"===t.model.selectedVisibilityCondition.operator)&&(t.model.selectedVisibilityCondition.rightValue=void 0,t.model.selectedVisibilityCondition.rightType=void 0)}),t.$watch("model.selectedVisibilityCondition.leftFormFieldId",function(){if(t.model.selectedVisibilityCondition&&t.model.selectedLeftVariable){var e=c(t.model.selectedLeftVariable.type);if(e){var i=t.model.selectedVisibilityCondition.operator,o=t.model.conditionOperatorsByType[e].index[i];void 0===o&&(t.model.selectedVisibilityCondition.operator=void 0,t.model.selectedVisibilityCondition.rightValue=void 0,t.model.selectedVisibilityCondition.rightType=void 0)}}}),t.getNameForSelectedFormFieldId=function(e){var i="";if(e)for(var o=0;t.model.conditionFields.length>o;o++){var n=t.model.conditionFields[o];if(n.id===e){i=n.name;break}}return i},t._getLeftValueColumnValue=function(e){var t="";return e?(e.leftFormFieldId&&""!==e.leftFormFieldId?t=e.leftFormFieldId:e.leftRestResponseId&&""!==e.leftRestResponseId&&(t=e.leftRestResponseId),t):t},t._getRightValueColumnValue=function(e){var i="";return e?(e.rightFormFieldId&&""!==e.rightFormFieldId?i=e.rightFormFieldId:e.rightRestResponseId&&""!==e.rightRestResponseId?i=e.rightRestResponseId:e.rightValue&&""!==e.rightValue&&(i=e.leftFormFieldId&&""!==e.leftFormFieldId?"date"===t.getTypeForSelectedFormFieldId(e.leftFormFieldId)?l("date")(new Date(e.rightValue),"d-M-yyyy","UTC"):e.rightValue:e.rightValue),i):i},t.getTypeForSelectedFormFieldId=function(e){return S(e)};var S=function(e){var i="";if(e)for(var o=0;t.model.conditionFields.length>o;o++){var n=t.model.conditionFields[o];if(n.id===e){i=c(n.type);break}}return i},I=function(e){var t="";if(e){var i=d.getVariables();if(i&&i.length>0)for(var o=0;i.length>o;o++){var n=i[o];if(n.processVariableName===e){t=n.processVariableType;break}}}return t.toLowerCase()};t.getConditionsForFieldId=function(e,i){var o;return e?o=S(e):i&&(o=I(i)),o&&t.model.conditionOperatorsByType[o]?t.model.conditionOperatorsByType[o].operators:void 0},t._getOperatorDescriptionForFieldId=function(e){if(e&&e.operator){var i;return e.leftFormFieldId?i=S(e.leftFormFieldId):e.leftRestResponseId&&(i=I(e.leftRestResponseId)),i?t._getOperatorDescriptionForType(e.operator,i):void 0}},t._getOperatorDescriptionForType=function(e,i){if(e&&i){var o=t.model.conditionOperatorsByType[i].index[e];if(void 0!==o){var n=t.model.conditionOperatorsByType[i].operators[o].description;return n}}},t.fieldIsNotEmpty=function(e){return e&&null===e&&void 0===e&&""!==e?void 0:!0};var O=o.instant("FORM-BUILDER.VISIBILITY.LEFT-FORM-FIELD"),b=o.instant("FORM-BUILDER.VISIBILITY.OPERATOR"),E=o.instant("FORM-BUILDER.VISIBILITY.RIGHT-VALUE"),y=o.instant("FORM-BUILDER.VISIBILITY.NEXT-CONDITION-OPERATOR");t.visibilityGridOptions={data:e.tabVisibilityConditions,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,enableColumnMenus:!1,columnDefs:[{field:"leftFormFieldId",displayName:O,resizable:!1,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getLeftValueColumnValue(row.entity)}}</div>'},{field:"operator",displayName:b,resizable:!0,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getOperatorDescriptionForFieldId(row.entity)}}</div>'},{field:"rightValue",displayName:E,resizable:!1,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getRightValueColumnValue(row.entity)}}</div>'},{field:"nextConditionOperator",displayName:y,resizable:!1,sortable:!1,width:150,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getOperatorDescriptionForType(row.entity[col.field], "condition")}}</div>'}]},t.visibilityGridOptions.onRegisterApi=function(e){t.visibilityGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){if(e.isSelected){if(t.model.selectedVisibilityCondition=e.entity,t.focusFirstField(),t.model.selectedVisibilityCondition){var i={},o={};if(t.model.conditionFields)for(var n=0;t.model.conditionFields.length>n;n++)t.model.selectedVisibilityCondition.leftFormFieldId&&t.model.selectedVisibilityCondition.leftFormFieldId===t.model.conditionFields[n].id&&(i=t.model.conditionFields[n]),t.model.selectedVisibilityCondition.rightFormFieldId&&t.model.selectedVisibilityCondition.rightFormFieldId===t.model.conditionFields[n].id&&(o=t.model.conditionFields[n]);t.model.selectedLeftVariable=i,t.model.selectedRightVariable=o,t.model.selectedVisibilityCondition.leftFormFieldId&&""!==t.model.selectedVisibilityCondition.leftFormFieldId?t.model.leftFieldType="formField":t.model.selectedVisibilityCondition.leftRestResponseId&&""!==t.model.selectedVisibilityCondition.leftRestResponseId&&(t.model.leftFieldType="restResponse"),t.model.selectedVisibilityCondition.rightValue&&(""+t.model.selectedVisibilityCondition.rightValue).length>0?t.model.rightFieldType="staticValue":t.model.selectedVisibilityCondition.rightFormFieldId&&""!==t.model.selectedVisibilityCondition.rightFormFieldId?t.model.rightFieldType="formField":t.model.selectedVisibilityCondition.rightRestResponseId&&""!==t.model.selectedVisibilityCondition.rightRestResponseId&&(t.model.rightFieldType="restResponse")}}else t.model.selectedVisibilityCondition=void 0})},t.focusFirstField=function(){r(function(){var e=document.getElementById("leftVariableField");e&&e.focus()},100)},t.addNewCondition=function(){var i={leftFormFieldId:"",operator:"",rightFormFieldId:"",rightRestResponseId:"",rightValue:"",nextConditionOperator:""};t.visibilityGridApi.selection.clearSelectedRows(),e.tabVisibilityConditions.push(i),r(function(){t.visibilityGridApi.selection.toggleRowSelection(i)})},t.removeCondition=function(){if(t.model.selectedVisibilityCondition){var i=e.tabVisibilityConditions.indexOf(t.model.selectedVisibilityCondition);t.visibilityGridApi.selection.clearSelectedRows(),e.tabVisibilityConditions.splice(i,1),r(function(){e.tabVisibilityConditions.length>0?t.visibilityGridApi.selection.toggleRowSelection(e.tabVisibilityConditions[0]):t.model.selectedVisibilityCondition=void 0})}},t.moveConditionUp=function(){if(t.model.selectedVisibilityCondition){var i=e.tabVisibilityConditions.indexOf(t.model.selectedVisibilityCondition);if(0!==i){var o=e.tabVisibilityConditions[i];e.tabVisibilityConditions.splice(i,1),r(function(){e.tabVisibilityConditions.splice(i+-1,0,o),r(function(){t.visibilityGridApi.selection.toggleRowSelection(e.tabVisibilityConditions[0])})})}}},t.moveConditionDown=function(){if(t.model.selectedVisibilityCondition){var i=e.tabVisibilityConditions.indexOf(t.model.selectedVisibilityCondition);
if(i!==e.tabVisibilityConditions.length-1){var o=e.tabVisibilityConditions[i];e.tabVisibilityConditions.splice(i,1),r(function(){e.tabVisibilityConditions.splice(i+1,0,o),r(function(){t.visibilityGridApi.selection.toggleRowSelection(e.tabVisibilityConditions[0])})})}}},t.getPreviousAndCurrentFormFields=function(){var i={},o=[],n=["text","multi-line-text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount"];for(var r in e.currentCustomFieldsValueInfo)n.push(r);var l=d.getFormFields(n);if(l&&l.length>0)for(var c=0;l.length>c;c++)n.indexOf(l[c].type)>-1&&(i[l[c].id]=!0,o.push(l[c]));var p=a.flattenFields(e.formItems);if(p&&p.length>0){p=s.additionalFormFieldProcessing(p);for(var c=0;p.length>c;c++){var u=p[c];n.indexOf(u.type)>-1&&!i[u.id]&&(i[u.id]=!0,o.push(u))}}o.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),t.model.conditionFields=o},t.setLeftFieldType=function(e){t.model.leftFieldType=e,"formField"===e?(t.model.selectedVisibilityCondition.leftRestResponseId="",t.model.selectedLeftVariable=""):"restResponse"===e&&(t.model.selectedVisibilityCondition.leftFormFieldId="")},t.setRightFieldType=function(e){t.model.rightFieldType=e,"formField"===e?(t.model.selectedVisibilityCondition.rightValue="",t.model.selectedVisibilityCondition.rightRestResponseId=""):"staticValue"===e?(t.model.selectedVisibilityCondition.rightFormFieldId="",t.model.selectedVisibilityCondition.rightRestResponseId="",t.model.selectedRightVariable=""):"restResponse"===e&&(t.model.selectedVisibilityCondition.rightValue="",t.model.selectedVisibilityCondition.rightFormFieldId="",t.model.selectedRightVariable="")},t.getPreviousAndCurrentFormFields(),t.getRestResponseVariables=function(){return d.getVariables()},t.selectLeftResponseVariable=function(e,t){e.leftRestResponseId=t.processVariableName},t.selectRightResponseVariable=function(e,t){e.rightRestResponseId=t.processVariableName},t.closeDatePopup=function(){jQuery("#rightValueField").blur()},t.clearDate=function(){t.model.selectedVisibilityCondition.rightValue=void 0,jQuery("#rightValueField").blur()},t.selectToday=function(e,t){var i=new Date;i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),e=i,t&&t(e),jQuery("#rightValueField").blur()}}]),angular.module("activitiModeler").controller("TabCustomMetadataController",["$rootScope","$scope","$timeout","$translate",function(e,t,i,o){t.metadata={fields:t.model.metadata||[],selectedField:null},t.gridOptions={data:t.metadata.fields,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,enableColumnMenus:!1,columnDefs:[{field:"key",displayName:o.instant("FORM-BUILDER.METADATA.KEY")},{field:"value",displayName:o.instant("FORM-BUILDER.METADATA.VALUE")}]},t.gridOptions.onRegisterApi=function(e){t.metadataGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.metadata.selectedField=e.isSelected?e.entity:null})},t.addNewField=function(){var e={key:"",value:""};t.metadataGridApi.selection.clearSelectedRows(),t.metadata.fields.push(e),i(function(){t.metadataGridApi.selection.toggleRowSelection(e)})},t.removeField=function(){if(t.metadata.selectedField){var e=t.metadata.fields.indexOf(t.metadata.selectedField);e>=0&&(t.metadataGridApi.selection.clearSelectedRows(),t.metadata.fields.splice(e,1),i(function(){t.metadata.fields.length>0?t.metadataGridApi.selection.toggleRowSelection(t.metadata.fields[0]):t.metadata.selectedField=null}))}}}]),angular.module("activitiModeler").controller("FormFieldEditController",["$scope",function(e){e.currentDate=moment().toISOString(),e.clearDate=function(e,t){e="",t&&t(e)},e.selectToday=function(e,t){var i=new Date;i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),e=i,t&&t(e)}}]),angular.module("activitiModeler").controller("TabCustomJavascriptController",["$rootScope","$scope","$q","$translate","$http","$timeout","$filter",function(e,t,i,o,n,r){t.model={},t.model.labels=[],t.model.selectedJavascriptEvent=void 0;var a=o.instant("FORM-BUILDER.JAVASCRIPT.EVENT");t.javascriptGridOptions={data:e.formJavascriptEvents,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,enableColumnMenus:!1,columnDefs:[{field:"event",displayName:a}]},t.javascriptGridOptions.onRegisterApi=function(e){t.javascriptGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?(t.model.selectedJavascriptEvent=e.entity,t.focusFirstField()):t.model.selectedJavascriptEvent=void 0})},t.focusFirstField=function(){r(function(){var e=document.getElementById("eventField");e&&e.focus()},100)},t.addNewJavascriptEvent=function(){var i={event:"",javascriptLogic:""};t.javascriptGridApi.selection.clearSelectedRows(),e.formJavascriptEvents.push(i),r(function(){t.javascriptGridApi.selection.toggleRowSelection(i)})},t.removeJavascriptEvent=function(){if(t.model.selectedJavascriptEvent){var i=e.formJavascriptEvents.indexOf(t.model.selectedJavascriptEvent);t.javascriptGridApi.selection.clearSelectedRows(),e.formJavascriptEvents.splice(i,1),r(function(){e.formJavascriptEvents.length>0?t.javascriptGridApi.selection.toggleRowSelection(e.formJavascriptEvents[0]):t.model.selectedJavascriptEvent=void 0})}}}]),angular.module("activitiModeler").controller("GroupRestrictionBuilderController",["$rootScope","$scope","$q","$translate","$http","$timeout","GroupService",function(e,t,i,o,n,r,a){t.popup={},t.formElement.params||(t.formElement.params={}),t.$watch("popup.groupFilter",function(){t.updateGroupFilter()}),t.updateGroupFilter=function(){(void 0===t.popup.oldGroupFilter||t.popup.oldGroupFilter!==t.popup.groupFilter)&&(t.popup.oldGroupFilter=t.popup.groupFilter?t.popup.groupFilter:"",a.getFilteredGroups(t.popup.groupFilter).then(function(e){t.popup.groupResults=e.data,t.resetGroupSelection()}))},t.confirmGroup=function(e){if(!e){var i=t.popup.groupResults;t.popup.selectedGroupIndex>=0&&t.popup.selectedGroupIndex<i.length&&(e=i[t.popup.selectedGroupIndex])}e&&(t.formElement.params.restrictWithGroup=e)},t.removeGroup=function(){t.formElement.params.restrictWithGroup=void 0},t.nextGroup=function(){var e=t.popup.groupResults;e&&e.length>0&&t.popup.selectedGroupIndex<e.length-1&&(t.popup.selectedGroupIndex+=1)},t.previousGroup=function(){var e=t.popup.groupResults;e&&e.length>0&&t.popup.selectedGroupIndex>0&&(t.popup.selectedGroupIndex-=1)},t.resetGroupSelection=function(){t.popup.selectedGroupIndex=t.popup.groupResults&&t.popup.groupResults.length>0?0:-1}}]),angular.module("activitiModeler").controller("ValidateFormModelCtrl",["$rootScope","$scope","$q","$translate",function(e,t,i,o){t.formFieldValidationErrors=[];for(var n=0;e.currentFormValidationErrors.length>n;n++)e.currentFormValidationErrors[n].id===t.currentFormField.id&&t.formFieldValidationErrors.push(e.currentFormValidationErrors[n]);t.translationsRetrieved=!1,t.labels={};var r=o("FORM-BUILDER.VALIDATOR-POPUP.DESCRIPTION"),a=o("FORM-BUILDER.VALIDATOR-POPUP.WARNING"),s=o("FORM-BUILDER.VALIDATOR-POPUP.VALIDATOR-SET");i.all([r,a,s]).then(function(e){t.labels.descriptionLabel=e[0],t.labels.warningLabel=e[1],t.labels.validatorLabel=e[2],t.translationsRetrieved=!0,t.gridOptions={data:t.formFieldValidationErrors,headerRowHeight:28,enableHorizontalScrollbar:0,enableColumnMenus:!1,columnDefs:[{field:"defaultDescription",displayName:t.labels.descriptionLabel},{field:"warning",displayName:t.labels.warningLabel,width:100},{field:"validatorSetName",displayName:t.labels.validatorLabel,width:200}]}}),t.ok=function(){t.$hide()},t.close=function(){t.$hide()}}]),angular.module("activitiModeler").controller("FormEndpointCheckController",["$rootScope","$scope","EndpointUtilService","ProcessScopeService",function(e,t,i,o){var n,r,a,s="GET";t.selectedColumnDef?(n=t.selectedColumnDef.restUrl,r=t.selectedColumnDef.endpoint,a=t.selectedColumnDef.requestHeaders):(n=t.formElement.restUrl,r=t.formElement.endpoint,a=t.formElement.requestHeaders);var l=function(){if(i.isTestDataNeeded(n,null,null,a)){var e=o.getFormFields(t.allSteps,t.stepId),l=o.getVariables(t.allSteps,t.stepId);t.testDataFields=i.getTestDataFields(n,e,l,null,a)}else i.executeEndpointCheck(s,r,n).then(function(e){t.requestResult=e,t.formattedResult=i.getFormattedRequestResult(e)})};t.isRequestSuccessful=function(){var e=!1;return t.requestResult&&t.requestResult.statusCode&&t.requestResult.statusCode>=200&&400>t.requestResult.statusCode&&(e=!0),e},t.cancel=function(){t.endpointTestVisible.visible=!1},t.ok=function(){i.executeEndpointCheck(s,r,n,null,t.testDataFields).then(function(e){t.requestResult=e,t.formattedResult=i.getFormattedRequestResult(e)})},t.back=function(){delete t.requestResult,t.testDataFields||t.cancel()},l()}]),angular.module("activitiModeler").controller("RestHeadersBuilderController",["$rootScope","$scope","$q","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","uiGridConstants",function(e,t,i,o,n,r,a,s,l,d,c,p){t.selectedRequestHeaders=[],t.selectedFields=[],t.labels=[];var u=t.formElement.endpoint.requestHeaders;if(t.formElement.requestHeaders&&0!==t.formElement.requestHeaders.length){for(var m={},h=0;u.length>h;h++)m[u[h].name]=angular.copy(u[h]);for(var f=[],g={},h=0;t.formElement.requestHeaders.length>h;h++)m[t.formElement.requestHeaders[h].name]&&(f.push(t.formElement.requestHeaders[h]),g[t.formElement.requestHeaders[h].name]=t.formElement.requestHeaders[h]);for(var h=0;u.length>h;h++)g[u[h].name]||f.push(u[h]);t.formElement.requestHeaders=f}else t.formElement.requestHeaders=angular.copy(u);t.restHeaderConfig={position:0,field:""},t.selectedRequestHeader=void 0,t.labels.idLabel=o.instant("FORM-BUILDER.COMPONENT.REQUEST-HEADER-NAME"),t.labels.nameLabel=o.instant("FORM-BUILDER.COMPONENT.REQUEST-HEADER-VALUE"),t.gridOptions={data:t.formElement.requestHeaders,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:t.labels.idLabel,cellClass:function(e,t,i){return""===e.getCellValue(t,i)||e.getCellValue(t,i)===!1?"dynamicTable-cellError":void 0}},{field:"value",displayName:t.labels.nameLabel,cellClass:function(e,t,i){return""===e.getCellValue(t,i)||e.getCellValue(t,i)===!1?"dynamicTable-cellError":void 0}}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedRequestHeader=e.entity,t.focusFirstField()})},t.focusFirstField=function(){r(function(){var e=document.getElementById("headerValue");e&&e.focus()},100)};var v=t.$on("endpoint-selection-changed",function(e,i){i?(t.formElement.requestHeaders=angular.copy(i.requestHeaders),t.gridOptions.data=t.formElement.requestHeaders,t.gridApi.core.notifyDataChange(p.dataChange.ALL),t.selectedRequestHeader=void 0):t.formElement.requestHeaders=void 0}),S=t.$on("done-editing-field",function(){v(),S()});t.$on("$destroy",function(){v(),S()}),t.$watch("selectedRequestHeader.value",function(){t.gridApi.core.notifyDataChange(p.dataChange.ALL)},!0),t.$watch("restHeaderConfig.field",function(e){if(e){var i=t.selectedRequestHeader.value,o="${"+e.id+"}";i=i?i.substring(0,t.restHeaderConfig.position)+o+i.substring(t.restHeaderConfig.position):o,t.restHeaderConfig.field=void 0,r(function(){var e=angular.element("#rest-header-value");e.focus(),e.val(i),t.selectedRequestHeader.value=i},200)}}),t.model={headerFieldType:"formField"},t.setUrlFieldType=function(e){"restResponse"===e?t.model={headerFieldType:"restResponse"}:"formField"===e&&(t.model={headerFieldType:"formField"})}}]),angular.module("activitiModeler").controller("RestHeadersBuilderDynTableController",["$rootScope","$scope","$q","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","ProcessBuilderService","uiGridConstants",function(e,t,i,o,n,r,a,s,l,d,c,p){function u(){var e=t.selectedColumnDefinition.endpoint.requestHeaders;if(t.selectedColumnDefinition.requestHeaders&&0!==t.selectedColumnDefinition.requestHeaders.length){for(var i={},o=0;e.length>o;o++)i[e[o].name]=angular.copy(e[o]);for(var n=[],r={},o=0;t.selectedColumnDefinition.requestHeaders.length>o;o++)i[t.selectedColumnDefinition.requestHeaders[o].name]&&(n.push(t.selectedColumnDefinition.requestHeaders[o]),r[t.selectedColumnDefinition.requestHeaders[o].name]=t.selectedColumnDefinition.requestHeaders[o]);for(var o=0;e.length>o;o++)r[e[o].name]||n.push(e[o]);t.selectedColumnDefinition.requestHeaders=n}else t.selectedColumnDefinition.requestHeaders=angular.copy(e)}t.selectedRequestHeaders=[],t.selectedFields=[],t.labels=[],u(),t.restHeaderConfig={position:0,field:""},t.selectedRequestHeader=void 0,t.labels.idLabel=o.instant("FORM-BUILDER.COMPONENT.REQUEST-HEADER-NAME"),t.labels.nameLabel=o.instant("FORM-BUILDER.COMPONENT.REQUEST-HEADER-VALUE"),t.gridOptions={data:t.selectedColumnDefinition.requestHeaders,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:t.labels.idLabel,cellClass:function(e,t,i){return""===e.getCellValue(t,i)||e.getCellValue(t,i)===!1?"dynamicTable-cellError":void 0}},{field:"value",displayName:t.labels.nameLabel,cellClass:function(e,t,i){return""===e.getCellValue(t,i)||e.getCellValue(t,i)===!1?"dynamicTable-cellError":void 0}}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedRequestHeader=e.entity,t.focusFirstField()})},t.focusFirstField=function(){r(function(){var e=document.getElementById("headerValue");e&&e.focus()},100)},t.$on("col-selection-changed",function(){t.selectedColumnDefinition.endpoint&&t.selectedColumnDefinition.endpoint.requestHeaders&&t.selectedColumnDefinition.endpoint.requestHeaders.length>0?(u(),t.gridOptions.data=t.selectedColumnDefinition.requestHeaders,t.gridApi.core.notifyDataChange(p.dataChange.ALL),t.selectedRequestHeader=void 0):t.selectedColumnDefinition.requestHeaders=void 0}),t.$on("col-endpoint-selection-changed",function(e,i){i?(t.selectedColumnDefinition.requestHeaders=angular.copy(i.requestHeaders),t.gridOptions.data=t.selectedColumnDefinition.requestHeaders,t.gridApi.core.notifyDataChange(p.dataChange.ALL),t.selectedRequestHeader=void 0):t.selectedColumnDefinition.requestHeaders=void 0}),t.$watch("selectedRequestHeader.value",function(){t.gridApi.core.notifyDataChange(p.dataChange.ALL)},!0),t.$watch("restHeaderConfig.field",function(e){if(e){var i=t.selectedRequestHeader.value,o="${"+e.id+"}";i=i?i.substring(0,t.restHeaderConfig.position)+o+i.substring(t.restHeaderConfig.position):o,t.restHeaderConfig.field=void 0,r(function(){var e=angular.element("#rest-header-value");e.focus(),e.val(i),t.selectedRequestHeader.value=i},200)}}),t.model={headerFieldType:"formField"},t.setUrlFieldType=function(e){"restResponse"===e?t.model={headerFieldType:"restResponse"}:"formField"===e&&(t.model={headerFieldType:"formField"})}}]),angular.module("activitiModeler").controller("FormVariablesTabController",["$scope","$timeout","$translate",function(e,t,i){"use strict";e.variables=e.model.variables||[],e.selectedVariable=void 0,e.variableTypes=["string","integer","boolean","date","people","group"],e.gridOptions={data:e.variables,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:i.instant("FORM-BUILDER.FORM-VARIABLES.COLUMNS.NAME")},{field:"type",displayName:i.instant("FORM-BUILDER.FORM-VARIABLES.COLUMNS.TYPE")},{field:"value",displayName:i.instant("FORM-BUILDER.FORM-VARIABLES.COLUMNS.VALUE")}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedVariable=t.isSelected?t.entity:void 0})},e.addNewVariable=function(){var i={name:"",type:e.variableTypes[0],value:null};e.variables.push(i),t(function(){e.gridApi.selection.toggleRowSelection(i)})},e.removeVariable=function(){var i=e.gridApi.selection.getSelectedRows();if(i&&i.length>0){var o=e.variables.indexOf(i[0]);e.gridApi.selection.toggleRowSelection(i[0]),e.variables.splice(o,1),0===e.variables.length&&(e.selectedVariable=void 0),t(function(){e.variables.length>0&&e.gridApi.selection.toggleRowSelection(e.variables[0])})}}}]),angular.module("activitiModeler").controller("FlowConditionBuilderController",["$rootScope","$scope","$q","$translate","$http","$timeout","FormUtilService","FormBuilderService","$filter",function(e,t,i,o,n,r,a,s,l){function d(e){return e?t.model.conditionOperatorsByType[e].operators:[]}t.model.selectedFlowConditions=[],t.model.selectedFields=[],t.model.labels=[],t.model.flowConditions=[],t.model.selectedFlowCondition=void 0,t.flowCondition=void 0,t.options={},t.model.condition&&(e.flowCondition=t.model.condition),(void 0===e.flowCondition.type||null===e.flowCondition.type)&&(e.flowCondition.type="variables");var c=function(e,t){if(!t.nextCondition)return t.index=void 0,e.push(t),void 0;var i=t.nextCondition;t.index=void 0,t.nextCondition="",e.push(t),c(e,i)},p=function(){var t=[];return t[0]=e.flowCondition,e.flowCondition.nextCondition&&c(t,e.flowCondition.nextCondition),t},u=function(e){var t={};return e&&"variables"===e.type?"field"===e.fieldType?(t.leftFormFieldId=e.fieldId,t.operator=e.operator,t.rightValue=e.value):"outcome"===e.fieldType?(t.outcomeFormId=e.outcomeFormId,t.outcomeFormName=e.outcomeFormName,t.operator=e.operator,t.rightOutcomeName=e.outcomeName):"restResponseVariable"===e.fieldType?(t.leftRestResponseId=e.responseVariableName,t.operator=e.operator,t.rightValue=e.value):t="none"===e.fieldType?void 0:e:t=e,t};e.flowCondition=u(e.flowCondition),e.tabFlowConditions=e.flowCondition?p():[];var m=function(e){e&&(void 0===e.leftFieldType&&(e.leftFieldType=e.leftFormFieldId&&""!=e.leftFormFieldId?"formField":e.leftRestResponseId&&""!=e.leftRestResponseId?"restResponse":e.outcomeFormId&&""!=e.outcomeFormId?"outcome":"formField"),void 0===e.rightFieldType&&((e.rightValue||0===e.rightValue)&&(""+e.rightValue).length>0?e.rightFieldType="staticValue":e.rightFormFieldId&&""!=e.rightFormFieldId?e.rightFieldType="formField":e.rightRestResponseId&&""!=e.rightRestResponseId?e.rightFieldType="restResponse":e.rightOutcomeFormId&&""!=e.rightOutcomeFormId?e.rightFieldType="outcome":e.rightOutcomeName&&""!=e.rightOutcomeName?(e.rightOutcomeFormId=e.outcomeFormId,e.rightOutcomeFormName=e.outcomeFormName,e.rightFieldType="outcome"):e.rightFieldType="staticValue"))},h=function(){if(e.tabFlowConditions&&e.tabFlowConditions.length>0)for(var t=0;e.tabFlowConditions.length>t;t++){var i=e.tabFlowConditions[t];m(i)}};h(),t.getNameForSelectedFormFieldId=function(e){var i="";if(e)for(var o=0;t.model.conditionFields.length>o;o++){var n=t.model.conditionFields[o];if(n.id===e){i=n.name;break}}return i},t._getLeftValueColumnValue=function(e){var t="";return e?("formField"===e.leftFieldType?e.leftFormFieldId&&""!=e.leftFormFieldId&&(t=e.leftFormFieldId):"outcome"===e.leftFieldType?e.outcomeFormId&&""!=e.outcomeFormId&&(t=e.outcomeFormName||e.outcomeFormId):"restResponse"===e.leftFieldType&&e.leftRestResponseId&&""!=e.leftRestResponseId&&(t=e.leftRestResponseId),t):t},t._getRightValueColumnValue=function(e){var i="";if(!e)return i;if("formField"===e.rightFieldType)e.rightFormFieldId&&""!=e.rightFormFieldId&&(i=e.rightFormFieldId);else if("outcome"===e.rightFieldType)i="outcome"===e.leftFieldType?e.rightOutcomeFormName&&""!=e.rightOutcomeFormName&&e.outcomeFormName&&""!=e.outcomeFormName?e.rightOutcomeFormName!=e.outcomeFormName?e.rightOutcomeFormName:e.rightOutcomeName:e.rightOutcomeFormName:e.rightOutcomeFormName;else if("restResponse"===e.rightFieldType)e.rightRestResponseId&&""!=e.rightRestResponseId&&(i=e.rightRestResponseId);else if(e.rightValue&&""!==e.rightValue||0===e.rightValue)if(e.leftFormFieldId&&""!=e.leftFormFieldId){var o=t.getTypeForSelectedFormFieldId(e.leftFormFieldId);if("date"===o)i=l("date")(new Date(e.rightValue),"d-M-yyyy");else if("integer"===o||"amount"===o){var n=0;try{n=parseInt(e.rightValue)}catch(r){n=0}e.rightValue=n,i=e.rightValue}else i=e.rightValue}else i=e.rightValue;return i},t.getTypeForFieldOrVariable=function(e,t){var i="string";return e?i=f(e):t&&(i=g(t)),i},t.getTypeForSelectedFormFieldId=function(e){return f(e)};var f=function(e){var i="";if(e)for(var o=0;t.availableFormFields.length>o;o++){var n=t.availableFormFields[o];if(n.id===e){i=n.type;break}}return i},g=function(e){var i="";if(e){var o=t.availableRestResponseVariables;if(o&&o.length>0)for(var n=0;o.length>n;n++){var r=o[n];if(r.processVariableName===e){i=r.processVariableType;break}}}return i.toLowerCase()};t.getConditionsForFieldId=function(e,i){var o;return e?o=f(e):i&&(o=g(i)),o&&t.model.conditionOperatorsByType[o]?t.model.conditionOperatorsByType[o].operators:t.model.conditionOperatorsByType.string.operators},t.getDropDownOptions=function(e){return t.options&&t.options[e]?t.options[e]:(t.updateSelectOptions(t.detectFormField(e),e),t.options&&t.options[e]?t.options[e]:[])},t.detectFormField=function(e){for(var i=0;t.model.conditionFields.length>i;i++){var o=t.model.conditionFields[i];if(o.id===e)return o}},t.updateSelectOptions=function(e,i){e&&("dropdown"===e.type||"radio-buttons"===e.type||"typeahead"===e.type)&&(t.options[e.id]=t.getFieldOptions(e,i))},t.getFieldOptions=function(e,t){var i=[];if(e&&e.optionType&&"rest"===e.optionType)return i;if(e.options&&e.options.length>0)for(var o=0;e.options.length>o;o++){var n=e.options[o],r=t.endsWith("_LABEL")?n.name:n.id;i.push({value:r,description:r})}return i},t._getOperatorDescriptionForFieldId=function(e){if(e&&e.operator){var i;return e.leftFormFieldId?i=f(e.leftFormFieldId):e.leftRestResponseId?i=g(e.leftRestResponseId):e.outcomeFormId&&""!=e.outcomeFormId&&(i="string"),i?t._getOperatorDescriptionForType(e.operator,i):void 0}},t._getOperatorDescriptionForType=function(e,i){if(e&&i){var o=t.model.conditionOperatorsByType[i].index[e],n=t.model.conditionOperatorsByType[i].operators[o].description;return n}},t.getOperatorDescriptionForSelectedField=function(e){return t._getOperatorDescriptionForType(e,f(t.model.selectedFlowCondition.leftFormFieldId))},t.fieldIsNotEmpty=function(e){return e&&null===e&&void 0===e&&""!==e?void 0:!0};var v=o.instant("FORM-BUILDER.VISIBILITY.LEFT-FORM-FIELD"),S=o.instant("FORM-BUILDER.VISIBILITY.OPERATOR"),I=o.instant("FORM-BUILDER.VISIBILITY.RIGHT-VALUE"),O=o.instant("FORM-BUILDER.VISIBILITY.NEXT-CONDITION-OPERATOR");t.flowConditionGridOptions={data:e.tabFlowConditions,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableSorting:!1,enableColumnMenus:!1,columnDefs:[{field:"leftFormFieldId",displayName:v,resizable:!1,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getLeftValueColumnValue(row.entity)}}</div>'},{field:"operator",displayName:S,resizable:!0,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getOperatorDescriptionForFieldId(row.entity)}}</div>'},{field:"rightValue",displayName:I,resizable:!1,sortable:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getRightValueColumnValue(row.entity)}}</div>'},{field:"nextConditionOperator",displayName:O,resizable:!1,sortable:!1,width:150,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getOperatorDescriptionForType(row.entity[col.field], "condition")}}</div>'}]},t.flowConditionGridOptions.onRegisterApi=function(e){t.flowConditionGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?(t.model.selectedFlowCondition=e.entity,t.focusFirstField(),t.model.selectedFlowCondition&&m(t.model.selectedFlowCondition)):t.model.selectedFlowCondition=void 0})},t.focusFirstField=function(){r(function(){var e=document.getElementById("leftVariableField");e&&e.focus()},100)},t.addNewCondition=function(){var i={leftFormFieldId:"",operator:"",rightFormFieldId:"",rightRestResponseId:"",rightValue:"",nextConditionOperator:""};t.flowConditionGridApi.selection.clearSelectedRows(),e.tabFlowConditions.push(i),r(function(){t.flowConditionGridApi.selection.toggleRowSelection(i)})},t.removeCondition=function(){if(t.model.selectedFlowCondition){var i=e.tabFlowConditions.indexOf(t.model.selectedFlowCondition);t.flowConditionGridApi.selection.clearSelectedRows(),e.tabFlowConditions.splice(i,1),r(function(){e.tabFlowConditions.length>0?t.flowConditionGridApi.selection.toggleRowSelection(e.tabFlowConditions[0]):t.model.selectedFlowCondition=void 0})}},t.moveConditionUp=function(){if(t.model.selectedFlowCondition){var i=e.tabFlowConditions.indexOf(t.model.selectedFlowCondition);if(0!=i){var o=e.tabFlowConditions[i];e.tabFlowConditions.splice(i,1),r(function(){e.tabFlowConditions.splice(i+-1,0,o),r(function(){t.flowConditionGridApi.selection.toggleRowSelection(e.tabFlowConditions[0])})})}}},t.moveConditionDown=function(){if(t.model.selectedFlowCondition){var i=e.tabFlowConditions.indexOf(t.model.selectedFlowCondition);if(i!=e.tabFlowConditions.length-1){var o=e.tabFlowConditions[i];e.tabFlowConditions.splice(i,1),r(function(){e.tabFlowConditions.splice(i+1,0,o),r(function(){t.flowConditionGridApi.selection.toggleRowSelection(e.tabFlowConditions[0])})})}}},t.setLeftFieldType=function(e){t.model.selectedFlowCondition.leftFieldType=e,"formField"===e?(t.model.selectedLeftVariable="",t.model.selectedFlowCondition.leftRestResponseId="",t.model.selectedFlowCondition.outcomeFormId="",t.model.selectedFlowCondition.outcomeFormName=""):"restResponse"===e?(t.model.selectedFlowCondition.leftFormFieldId="",t.model.selectedFlowCondition.outcomeFormId="",t.model.selectedFlowCondition.outcomeFormName=""):"outcome"===e&&(t.model.selectedLeftVariable="",t.model.selectedFlowCondition.leftFormFieldId="",t.model.selectedFlowCondition.leftRestResponseId="")},t.setRightFieldType=function(e){t.model.selectedFlowCondition.rightFieldType=e,"formField"===e?(t.model.selectedFlowCondition.rightValue="",t.model.selectedFlowCondition.rightRestResponseId="",t.model.selectedFlowCondition.rightOutcomeName=""):"staticValue"===e?(t.model.selectedFlowCondition.rightFormFieldId="",t.model.selectedFlowCondition.rightRestResponseId="",t.model.selectedFlowCondition.rightOutcomeName="",t.model.selectedRightVariable=""):"restResponse"===e?(t.model.selectedFlowCondition.rightValue="",t.model.selectedFlowCondition.rightFormFieldId="",t.model.selectedFlowCondition.rightOutcomeName="",t.model.selectedRightVariable=""):"outcome"===e&&(t.model.selectedFlowCondition.rightValue="",t.model.selectedFlowCondition.rightFormFieldId="",t.model.selectedFlowCondition.rightRestResponseId="",t.model.selectedRightVariable="")},t.selectLeftFormField=function(e,t){e.leftFormFieldId=t.id,e.operator=void 0},t.selectRightFormField=function(e,t){e.rightFormFieldId=t.id},t.selectLeftResponseVariable=function(e,t){e.leftRestResponseId=t.processVariableName,e.operator=void 0},t.selectRightResponseVariable=function(e,t){e.rightRestResponseId=t.processVariableName},t.selectLeftForm=function(e,i){e.outcomeFormId=i.id,e.outcomeFormName=i.name,e.operator=void 0,t.selectRightForm(e,i)},t.selectRightForm=function(e,i){e.rightOutcomeFormId!==i.id&&(e.rightOutcomeFormId=i.id,e.rightOutcomeFormName=i.name,e.rightOutcomeName=void 0,t.refreshAvailableOutcomes(e.rightOutcomeFormId))},t.selectFormOutcome=function(e,t){e.rightOutcomeName=t.name},t.isShowRightHandSide=function(){return null!==t.model.selectedFlowCondition&&void 0!==t.model.selectedFlowCondition&&"empty"!==t.model.selectedFlowCondition.operator&&"notEmpty"!==t.model.selectedFlowCondition.operator},t.closeDatePopup=function(){jQuery("#rightValueField").blur()},t.clearDate=function(){t.model.selectedFlowCondition.rightValue=void 0,jQuery("#rightValueField").blur()},t.selectToday=function(e,t){var i=new Date;i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),e=i,t&&t(e),jQuery("#rightValueField").blur()},t.getOperatorsForSelectedFieldType=function(){return"formField"===t.model.condition.leftFieldType?d(f(t.model.condition.leftFormFieldId)):"restResponse"===t.model.condition.leftFieldType?d(g(t.model.condition.leftRestResponseId)):void 0},t.refreshAvailableResponseVariables(),t.refreshAvailableFormFields(),t.refreshAvailableForms(),t.model.conditionFields=t.availableFormFields}]);var FORM_TOOLBAR={ACTIONS:{saveModel:function(e){_internalCreateModal({backdrop:!0,keyboard:!0,template:"views/popup/form-save-model.html?version="+Date.now(),scope:e.$scope},e.$modal,e.$scope)},validateModel:function(e){e.FormBuilderService.validateForm()},help:function(){},feedback:function(){},closeEditor:function(e){var t=function(){e.$rootScope.formChanges=!1,e.ProcessScopeService.navigateBack("/forms")};if(1==e.$rootScope.formChanges){e.$scope.$emit("formChangesEvent");var i=e.$scope.$on("mustSaveEvent",function(){var i="";e.$rootScope.currentForm.description&&(i=e.$rootScope.currentForm.description);var o={newVersion:!1};r(),e.FormBuilderService.saveForm(o,e.$rootScope.currentForm.name,i,t)}),o=e.$scope.$on("discardDataEvent",function(){r(),t()}),n=e.$scope.$on("continueEditingEvent",function(){r()})}else t();var r=function(){n(),i(),o()}}}};angular.module("activitiModeler").controller("SaveFormCtrl",["$rootScope","$scope","$http","$route","$location","$translate","FormBuilderService","ModelService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l){var d="";e.currentForm.description&&(d=e.currentForm.description);var c={name:e.currentForm.name,description:d,reusable:!1,newVersion:!1,embedded:e.formReferenceId!==void 0&&e.currentFormModel.referenceId?!0:!1,hasEmbedContext:e.formReferenceId!==void 0};t.saveDialog=c,t.status={loading:!1},t.hasOtherRelations=!1,t.oldFormId="";var p=function(e){e&&e.length>0&&(t.saveDialog.validationErrors=!0)};a.validateForm(p),t.cancel=function(){t.$hide()},t.saveAndClose=function(){t.save(function(){l.navigateBack("/forms")})},t.saveCopyAndClose=function(){t.save(function(i){s.updateFormReferencesInProcess(e.formReferenceId,t.oldFormId,i.id).then(function(){l.navigateBack("/forms")})})},t.save=function(i){if(t.saveDialog.name&&0!=t.saveDialog.name.length){t.status={loading:!0};var o={reusable:t.saveDialog.reusable,newVersion:t.saveDialog.newVersion,comment:t.saveDialog.comment},n=function(){return t.saveDialog.embedded},l=function(){return n()?e.formReferenceId:null},d=function(e){return e.length},c=function(){a.saveForm(o,t.saveDialog.name,t.saveDialog.description,u,p)},p=function(){t.$hide(),e.addAlertPromise(r("FORM.ALERT.SAVE-ERROR",{name:t.saveDialog.name}),"error")},u=function(o){t.$hide(),e.currentFormModel.referenceId=n()===!1?null:e.formReferenceId,e.addAlertPromise(r("FORM.ALERT.SAVE-CONFIRM",{name:t.saveDialog.name}),"info"),i&&i(o),e.formChanges=!1},m=function(i){t.oldFormId=e.currentForm.id,e.currentForm.id=i.id,c(i)};s.getModelParentRelations(e.currentForm.id).then(function(i){var o={id:e.currentForm.id,name:t.saveDialog.name,description:t.saveDialog.description,referenceId:l(),modelType:2,stencilSet:e.currentForm.stencilSetId};n()&&d(i)>1?s.cloneModel(e.currentFormModel,o).then(m,p):s.saveModel(e.currentFormModel,o).then(c,p)},p)}},t.validate=function(){t.saveDialog.name&&0!=t.saveDialog.name.length&&(t.status={loading:!0},a.validateForm())},t.isOkButtonDisabled=function(){return t.status.loading?!1:t.error&&t.error.conflictResolveAction?"saveAs"===t.error.conflictResolveAction?!t.error.saveAs||0==t.error.saveAs.length:!1:!0},t.okClicked=function(){t.error&&("discardChanges"===t.error.conflictResolveAction?(t.close(),o.reload()):"overwrite"===t.error.conflictResolveAction||"newVersion"===t.error.conflictResolveAction?t.save():"saveAs"===t.error.conflictResolveAction&&t.save(function(){e.ignoreChanges=!0,l.navigateBack("/forms")
}))},t.embedClicked=function(){t.saveDialog.embedded?s.getModelParentRelations(e.currentForm.id).then(function(e){t.hasOtherRelations=e.length>1},function(){e.addAlert("An error occurred while trying to find the relations")}):t.hasOtherRelations=!1}}]);var FORM_TOOLBAR_CONFIG={items:[{type:"button",title:"FORM_TOOLBAR.ACTION.SAVE",cssClass:"editor-icon editor-icon-save",action:"FORM_TOOLBAR.ACTIONS.saveModel",disableOnReadonly:!0},{type:"button",title:"FORM_TOOLBAR.ACTION.VALIDATE",cssClass:"glyphicon glyphicon-ok",action:"FORM_TOOLBAR.ACTIONS.validateModel"}],secondaryItems:[{type:"button",title:"Close",cssClass:"glyphicon glyphicon-remove",action:"FORM_TOOLBAR.ACTIONS.closeEditor"}]};angular.module("activitiModeler").controller("FormToolbarController",["$scope","$http","$modal","$q","$rootScope","$translate","$location","FormBuilderService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l){var d=FORM_TOOLBAR_CONFIG.items;e.items=[];for(var c=0;d.length>c;c++)e.items.push(d[c]);e.secondaryItems=FORM_TOOLBAR_CONFIG.secondaryItems;var p=function(e,t){for(var i=Array.prototype.slice.call(arguments).splice(2),o=e.split("."),n=o.pop(),r=0;o.length>r;r++)t=t[o[r]];return t[n].apply(this,i)};e.toolbarButtonClicked=function(a){var d=e.items[a],c={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,FormBuilderService:s,ProcessScopeService:l};p(d.action,window,c)},e.toolbarSecondaryButtonClicked=function(d){var c=e.secondaryItems[d],u={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,$location:a,FormBuilderService:s,ProcessScopeService:l};p(c.action,window,u)}}]),angular.module("activitiModeler").controller("FormReadonlyViewController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","FormBuilderService","ProcessBuilderService",function(e,t,i,o,n,r,a,s,l,d){function c(e,t){if(e._guid||(e._guid=t+p++),!e._width){var i;i="container"===e.type||"dynamic-table"===e.type||"group"===e.type?2:1,e._width=i}if(e.fields)for(var o in e.fields)e.fields[o].forEach(function(e){c(e,t)})}e.currentFormItems=void 0,t.formLoaded=!1,t.formTabClicked=function(i){t.activeFormTab=i,e.currentFormItems.length=0;for(var o=0;t.formItems.length>o;o++){var n=t.formItems[o];n.tab&&n.tab===t.activeFormTab.id&&e.currentFormItems.push(n)}};var p=0;if(s.modelId){var u;u=s.modelHistoryId?ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+s.modelId+"/history/"+s.modelHistoryId:ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+s.modelId,o({method:"GET",url:u}).success(function(i){var o=0;i.stencilSetId&&i.stencilSetId>0&&(o=i.stencilSetId),d.getStencilSet(o).then(function(o){if(t.stencilSet=o,t.palletteElements=t.stencilSet&&t.stencilSet.fieldTypes?t.stencilSet.fieldTypes:[],i.formDefinition.fields){for(var r=0;i.formDefinition.fields.length>r;r++){var a=i.formDefinition.fields[r];a.params||(a.params={}),c(a,"savedField")}t.formElements=i.formDefinition.fields}else t.formElements=[];if(t.formTabs=i.formDefinition.tabs,t.formTabs&&t.formTabs.length>0?t.activeFormTab=t.formTabs[0]:t.formTabs=[],t.formItems=t.formElements,t.formTabs.length>0){e.currentFormItems=[];for(var r=0;t.formItems.length>r;r++){var s=t.formItems[r];s.tab&&s.tab===t.activeFormTab.id&&e.currentFormItems.push(s)}}else e.currentFormItems=t.formItems.slice();n(function(){t.formLoaded=!0},200)})}).error(function(){t.model.loading=!1})}else t.formLoaded=!0}]),angular.module("activitiModeler").service("EndpointUtilService",["$q","$http",function(e,t){var i=function(i){var o=e.defer();return t(i).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise};this.isTestDataNeeded=function(e,t,i,o){var n=!1;return e&&e.length>0&&e.indexOf("${")>-1&&e.indexOf("}")>-1&&(n=!0),!n&&(t&&t.length>0||o&&o.length>0)&&(n=!0),!n&&i&&i.length>0&&i.indexOf("${")>-1&&i.indexOf("}")>-1&&(n=!0),n},this.executeEndpointCheck=function(e,t,i,o,a){var s=[],l=[],d=[];return a&&a.urlVariableValues&&(l=n(a.urlVariableValues)),a&&a.requestVariableValues&&(s=n(a.requestVariableValues)),a&&a.requestHeaderVariableValues&&(d=n(a.requestHeaderVariableValues)),r(e,t,i,l,s,o,d)},this.getFormattedRequestResult=function(e){var t="";return e&&e.statusCode&&(t=t.concat("Request URL: "+e.endpointUrl+"\n")),e&&e.statusCode&&(t=t.concat("Response code: "+e.statusCode+"\n")),e&&e.responseMessage&&(t=t.concat("Response message: "+e.responseMessage+"\n")),e&&e.responseEntity&&(t=t.concat("Response entity: "+JSON.stringify(e.responseEntity,null,4)+"\n")),t},this.getTestDataFields=function(e,t,i,o,n,r){var l={},d=[],c=[],p=[];if(e&&""!=e){var u=a(e);if(u)for(var m=0;u.length>m;m++){var h=void 0,f=u[m].paramValue;if(0==f.indexOf("$")){if(f=f.replace(/[{}]/g,""),f=f.substring(1),t&&t.length>0)e:for(var g=0;t.length>g;g++)if(f===t[g].id){h={id:t[g].id,name:u[m].paramName,type:t[g].type};break e}if(!h&&i&&i.length>0)e:for(var g=0;i.length>g;g++)if(f===i[g].processVariableName){h={id:i[g].processVariableName,name:u[m].paramName,type:i[g].processVariableType};break e}h||(h={id:f,name:u[m].paramName,type:"string"})}h||(h={id:u[m].paramName,name:u[m].paramName,type:"string",value:u[m].paramValue}),d.push(h)}var v=s(e);if(v)for(var m=0;v.length>m;m++){var S=void 0,I=v[m];if(t&&t.length>0)e:for(var g=0;t.length>g;g++)if(I===t[g].id){S={id:t[g].id,name:"path variable "+(m+1),type:t[g].type};break e}if(!S&&i&&i.length>0)for(var g=0;i.length>g;g++)if(I===i[g].processVariableName){S={id:i[g].processVariableName,name:"path variable "+(m+1),type:i[g].processVariableType};break}S||(S={id:I,name:"path variable "+(m+1),type:"string"}),d.push(S)}l.urlVariableValues=d}if(o&&o.length>0){for(var m=0;o.length>m;m++)o[m].jsonPropertyValue&&o[m].jsonPropertyValue.length>0?c.push({id:o[m].jsonPropertyName,name:o[m].jsonPropertyName,type:o[m].jsonPropertyType,value:o[m].jsonPropertyValue}):o[m].jsonPropertyValueFormField?c.push({id:o[m].jsonPropertyValueFormField.id,name:o[m].jsonPropertyName,type:o[m].jsonPropertyType}):o[m].jsonPropertyValueRestResponseField&&c.push({id:o[m].jsonPropertyValueRestResponseField.id,name:o[m].jsonPropertyName,type:o[m].jsonPropertyType});l.requestVariableValues=c}if(n&&n.length>0){c=[];for(var O,b=/\${\w+}/g;null!==(O=b.exec(n));){for(var E=O[0].substring(2,O[0].length-1),y=!1,R=0;c.length>R;R++)if(E===c[R].id){y=!0;break}if(0==y){var T="string";if(t&&t.length>0)for(var C=0;t.length>C;C++)if(E===t[C].id){T=t[C].type;break}if(!E&&i&&i.length>0)for(var A=0;i.length>A;A++)if(E===i[A].processVariableName){T=i[A].processVariableType;break}"text"===T&&(T="string"),c.push({id:E,name:E,type:T})}}l.requestVariableValues=c}if(r&&r.length>0){for(var m=0;r.length>m;m++){var N=void 0,F=r[m].value;if(0==F.indexOf("$")){if(F=F.replace(/[{}]/g,""),F=F.substring(1),t&&t.length>0)e:for(var g=0;t.length>g;g++)if(F===t[g].id){N={id:t[g].id,name:r[m].name,type:t[g].type};break e}if(!N&&i&&i.length>0)e:for(var g=0;i.length>g;g++)if(F===i[g].processVariableName){N={id:i[g].processVariableName,name:r[m].name,type:i[g].processVariableType};break e}N||(N={id:F,name:r[m].name,type:"string"})}N||(N={id:r[m].name,name:r[m].name,type:"string",value:r[m].value}),p.push(N)}l.requestHeaderVariableValues=p}return l},this.getFullEndpointURL=function(e,t){var i="";return e&&(i=o(e.protocol,e.host,e.port,e.path)),t&&(i="?"!=t.charAt(0)&&"&"!=t.charAt(0)?"/"===i.charAt(i.length-1)&&"/"===t.charAt(0)?i.concat(t.substr(1)):""!=i&&"/"!==i.charAt(i.length-1)&&"/"!==t.charAt(0)?i.concat("/"+t):i.concat(t):i.concat(t)),i},this.getAllEndpointConfigurations=function(){return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/editor/endpoints"})},this.getEndpointLabel=function(e,t,i,n,r){var a=" ("+o(t,i,n,r)+")";return a=a.toLowerCase(),e+a},this.getVisibleTestDataFields=function(e){var t,i={urlVariableValues:[],requestVariableValues:[]};return e&&e.urlVariableValues&&(i.urlVariableValues=e.urlVariableValues,t={},i.urlVariableValues.forEach(function(e){t[e.id]=e})),e&&e.requestVariableValues&&e.requestVariableValues.length>0&&e.requestVariableValues.forEach(function(e){t&&void 0!==t[e.id]||i.requestVariableValues.push(e)}),i};var o=function(e,t,i,o){if(!e)return"";var n=e.toLowerCase()+"://"+t;return n=i&&80!=i&&443!=i?n.concat(":"+i):n,o&&(n="/"===o.charAt(0)?n.concat(o):n.concat("/"+o)),n},n=function(e){if(e&&e.length>0)for(var t=0;e.length>t;t++)e[t].$$hashKey&&delete e[t].$$hashKey;return e},r=function(e,t,o,n,r,a,s){if(e&&(t||""!==o)){delete Array.prototype.toJSON;var l={httpMethod:e,restUrl:o,urlValues:n,requestValues:r,requestHeaderValues:s,jsonTemplate:a};return t&&(l.endpointConfigurationId=t.id),i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/editor/endpoint-check",data:l})}},a=function(e){for(var t,i=/[?&]([^=#]+)=([^&#]*)/g,o=e,n=[];t=i.exec(o);)n.push({paramName:t[1],paramValue:t[2]});return n},s=function(e){for(var t,i=/\/\${(.*?)}/g,o=e,n=[];t=i.exec(o);)n.push(t[1]);return n}}]),angular.module("activitiModeler").service("ProcessScopeService",["$rootScope","$http","$location","$q","$translate","editorCache",function(e,t,i,o,n,r){function a(){et=[],tt=null,it=null}function s(){ot=null,nt=null,rt={responseVariables:[],executionVariables:[],fieldMappingVariables:[],metadataVariables:[],customStencilVariables:[],forms:[],formFields:[],formFieldVariables:[],entityVariables:[]},r.remove(EDITOR_CACHE.REST_RESULT_VARIABLES_KEY),r.remove(EDITOR_CACHE.EXECUTION_VARIABLES_KEY),r.remove(EDITOR_CACHE.FIELD_TO_VARIABLE_MAPPINGS_KEY),r.remove(EDITOR_CACHE.METADATA_VARIABLES_KEY),r.remove(EDITOR_CACHE.CUSTOM_STENCIL_VARIABLES_KEY),r.remove(EDITOR_CACHE.FORM_FIELDS_KEY),r.remove(EDITOR_CACHE.FORM_FIELD_VARIABLES_KEY),r.remove(EDITOR_CACHE.ENTITY_VARIABLES_KEY)}function l(e){for(var t in e.responseVariables)Array.prototype.push.apply(rt.responseVariables,e.responseVariables[t]);for(var t in e.executionVariables)Array.prototype.push.apply(rt.executionVariables,e.executionVariables[t]);for(var t in e.fieldToVariableMappings)Array.prototype.push.apply(rt.fieldMappingVariables,e.fieldToVariableMappings[t]);for(var t in e.metadataVariables)Array.prototype.push.apply(rt.metadataVariables,e.metadataVariables[t]);for(var t in e.customStencilVariables)Array.prototype.push.apply(rt.customStencilVariables,e.customStencilVariables[t]);for(var t in e.entityVariables)Array.prototype.push.apply(rt.entityVariables,e.entityVariables[t]);if(e.forms){Array.prototype.push.apply(rt.forms,e.forms);for(var i in e.forms)e.forms.hasOwnProperty(i)&&e.forms[i].forEach(function(e){Array.prototype.push.apply(rt.formFields,e.fields),Array.prototype.push.apply(rt.formFieldVariables,e.fieldVariables)})}}function d(e){ot=e.activityIds.map(function(e){return{id:e,resourceId:e}});for(var t in e.responseVariables)h(t,e.responseVariables[t]);for(var t in e.executionVariables)f(t,e.executionVariables[t]);for(var t in e.fieldToVariableMappings)g(t,e.fieldToVariableMappings[t]);for(var t in e.metadataVariables)v(t,e.metadataVariables[t]);for(var t in e.customStencilVariables)S(t,e.customStencilVariables[t]);for(var t in e.entityVariables)I(t,e.entityVariables[t]);for(t in e.forms){var i=e.forms[t];i.forEach(function(i){var o={id:i.id,name:i.name,description:i.description,outcomes:i.outcomes,fields:i.fields||[]},n={id:i.id,name:i.name,description:i.description,outcomes:i.outcomes,fields:i.fieldVariables||[]};H(t,o,e.activitySidsByActivityIdMap),z(t,n,e.activitySidsByActivityIdMap)})}}function c(e,i,o){var n={},r=[].concat(et?et:[]);return null!==tt&&(r=r.concat({processModelId:tt,processActivityId:null}),e&&(n.overriddenModel=JSON.stringify(e))),n.identifiers=o||r,delete Array.prototype.toJSON,t({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-scopes",data:n}).success(function(e,t,o,n){i&&i.success&&i.success(e,t,o,n)}).error(function(e,t,o,n){i&&i.failure&&i.failure(e,t,o,n)})}function p(e,t,i){return c(e,{success:function(e){nt=e,nt.length>0&&d(nt[nt.length-1]);for(var i=0;nt.length-1>i;i++)tt!==nt[i].modelId&&l(nt[i]);t&&t.success&&t.success(nt,!0)},error:function(e,i){t&&t.failure&&t.failure(e,!1,i)}},i)}function u(e,t,i,o){for(var n=e,r=0;t.length>r;r++){if(n+=0===r&&-1===e.indexOf("?")?"?":"&",!t[r].hasOwnProperty("processModelId")||!t[r].hasOwnProperty("processActivityId"))throw Error("Invalid process identifiers present in the ProcessScopeService");n+=i+(r+1)+"="+encodeURIComponent(t[r].processModelId),n+="&",n+=o+(r+1)+"="+encodeURIComponent(t[r].processActivityId)}return n}function m(){return[].concat(et?et:[])}function h(e,t){e&&t?R(e,t):e&&!t&&M(e)}function f(e,t){e&&t?T(e,t):e&&!t&&D(e)}function g(e,t){e&&t?C(e,t):e&&!t&&P(e)}function v(e,t){e&&t?A(e,t):e&&!t&&w(e)}function S(e,t){e&&t?N(e,t):e&&!t&&x(e)}function I(e,t){e&&t?F(e,t):e&&!t&&_(e)}function O(e,t){if(e){for(var i=0;e.length>i;i++)if(nt&&-1!==nt[nt.length-1].activityIdsWithExcludedSubProcess.indexOf(e[i].resourceId||e[i].id)){e=ot,t=null;break}}else e=ot;return{steps:e,stepId:t}}function b(e,t,i){var o=O(e,t);e=o.steps,t=o.stepId;var n=[];if(Array.prototype.push.apply(n,Y("__startform")),Array.prototype.push.apply(n,V("__root__process__")),e&&e.length>0)for(var r=0;e.length>r;r++){var a;if(a=e[r].resourceId?e[r].resourceId:e[r].id,a===t)break;Array.prototype.push.apply(n,L(a)),Array.prototype.push.apply(n,V(a)),Array.prototype.push.apply(n,k(a)),Array.prototype.push.apply(n,Y(a)),Array.prototype.push.apply(n,$(a))}if(i&&i.length>0){for(var s=[],r=0;n.length>r;r++)i.indexOf(n[r].processVariableType)>-1&&s.push(n[r]);n=s}Array.prototype.push.apply(n,rt.responseVariables),Array.prototype.push.apply(n,rt.executionVariables),Array.prototype.push.apply(n,rt.fieldMappingVariables),Array.prototype.push.apply(n,rt.metadataVariables),Array.prototype.push.apply(n,rt.customStencilVariables);var l=[],d=[];return n.forEach(function(e){void 0!==e.processVariableName&&null!==e.processVariableName&&0>l.indexOf(e.processVariableName)&&(l.push(e.processVariableName),d.push(e))}),d.sort(function(e,t){return void 0!==e.processVariableName&&null!==e.processVariableName?e.processVariableName.toLowerCase()>t.processVariableName.toLowerCase()?1:-1:void 0}),d}function E(e,t){var i=O(e,t);e=i.steps,t=i.stepId;var o=[];if(Array.prototype.push.apply(o,G("__startform")),Array.prototype.push.apply(o,G("__root__process__")),e&&e.length>0)for(var n=0;e.length>n;n++){var r;if(r=e[n].resourceId?e[n].resourceId:e[n].id,r===t)break;Array.prototype.push.apply(o,G(r))}Array.prototype.push.apply(o,rt.entityVariables);var a=[],s=[];return o.forEach(function(e){void 0!==e.mappedVariableName&&null!==e.mappedVariableName&&0>a.indexOf(e.mappedVariableName)&&(a.push(e.mappedVariableName),s.push(e))}),s.sort(function(e,t){return void 0!==e.mappedVariableName&&null!==e.mappedVariableName?e.mappedVariableName.toLowerCase()>t.mappedVariableName.toLowerCase()?1:-1:void 0}),s}function y(e,t){var i=O(e,t);e=i.steps,t=i.stepId;var o=[];if(Array.prototype.push.apply(o,L("__startform")),e&&e.length>0)for(var n=0;e.length>n;n++){var r;if(r=e[n].resourceId?e[n].resourceId:e[n].id,r===t)break;Array.prototype.push.apply(o,L(r))}Array.prototype.push.apply(o,rt.responseVariables);var a=[],s=[];return o.forEach(function(e){0>a.indexOf(e.processVariableName)&&(a.push(e.processVariableName),s.push(e))}),s.sort(function(e,t){return e.processVariableName.toLowerCase()>t.processVariableName.toLowerCase()?1:-1}),s}function R(e,t){if(e&&t){var i=r.get(EDITOR_CACHE.REST_RESULT_VARIABLES_KEY);i?i[e]=t:(i={},i[e]=t),r.put(EDITOR_CACHE.REST_RESULT_VARIABLES_KEY,i)}}function T(e,t){if(e&&t){var i=r.get(EDITOR_CACHE.EXECUTION_VARIABLES_KEY);i?i[e]=t:(i={},i[e]=t),r.put(EDITOR_CACHE.EXECUTION_VARIABLES_KEY,i)}}function C(e,t){if(e&&t){var i=r.get(EDITOR_CACHE.FIELD_TO_VARIABLE_MAPPINGS_KEY);i?i[e]=t:(i={},i[e]=t),r.put(EDITOR_CACHE.FIELD_TO_VARIABLE_MAPPINGS_KEY,i)}}function A(e,t){if(e&&t){var i=r.get(EDITOR_CACHE.METADATA_VARIABLES_KEY);i?i[e]=t:(i={},i[e]=t),r.put(EDITOR_CACHE.METADATA_VARIABLES_KEY,i)}}function N(e,t){if(e&&t){var i=r.get(EDITOR_CACHE.CUSTOM_STENCIL_VARIABLES_KEY);i||(i={}),i[e]=t,r.put(EDITOR_CACHE.CUSTOM_STENCIL_VARIABLES_KEY,i)}}function F(e,t){if(e&&t){var i=r.get(EDITOR_CACHE.ENTITY_VARIABLES_KEY);i||(i={}),i[e]=t,r.put(EDITOR_CACHE.ENTITY_VARIABLES_KEY,i)}}function M(e){if(e){var t=r.get(EDITOR_CACHE.REST_RESULT_VARIABLES_KEY);t[e]=void 0}}function D(e){if(e){var t=r.get(EDITOR_CACHE.EXECUTION_VARIABLES_KEY);t[e]=void 0}}function P(e){if(e){var t=r.get(EDITOR_CACHE.FIELD_TO_VARIABLE_MAPPINGS_KEY);t[e]=void 0}}function w(e){if(e){var t=r.get(EDITOR_CACHE.METADATA_VARIABLES_KEY);t[e]=void 0}}function x(e){if(e){var t=r.get(EDITOR_CACHE.CUSTOM_STENCIL_VARIABLES_KEY);t[e]=void 0}}function _(e){if(e){var t=r.get(EDITOR_CACHE.ENTITY_VARIABLES_KEY);t[e]=void 0}}function L(e){var t=[];if(e){var i=r.get(EDITOR_CACHE.REST_RESULT_VARIABLES_KEY);i&&i[e]&&(t=i[e])}return t}function V(e){var t=[];if(e){var i=r.get(EDITOR_CACHE.EXECUTION_VARIABLES_KEY);i&&i[e]&&(t=i[e])}return t}function k(e){var t=[];if(e){var i=r.get(EDITOR_CACHE.FIELD_TO_VARIABLE_MAPPINGS_KEY);i&&i[e]&&(t=i[e])}return t}function Y(e){var t=[];if(e){var i=r.get(EDITOR_CACHE.METADATA_VARIABLES_KEY);i&&i[e]&&(t=i[e])}return t}function $(e){var t=[];if(e){var i=r.get(EDITOR_CACHE.CUSTOM_STENCIL_VARIABLES_KEY);i&&i[e]&&(t=i[e])}return t}function G(e){var t=[];if(e){var i=r.get(EDITOR_CACHE.ENTITY_VARIABLES_KEY);i&&i[e]&&(t=i[e])}return t}function X(e,t,i,o){var n=O(e,t);e=n.steps,t=n.stepId;var r=[];if("__startform"!==t&&(Array.prototype.push.apply(r,K("__startform")),e&&e.length>0))for(var a=0;e.length>a;a++){var s,l=e[a];if(l.resourceId?(s=l.resourceId,l.properties&&l.properties["oryx-overrideid"]&&(s=l.properties["oryx-overrideid"])):s=e[a].id,!o&&s===t)break;Array.prototype.push.apply(r,K(s))}if(i&&i.length>0){for(var d=[],a=0;r.length>a;a++)r[a]&&i.indexOf(r[a].type)>-1&&d.push(r[a]);r=d}Array.prototype.push.apply(r,rt.formFieldVariables);var c=[],p=[];return r.forEach(function(e){e&&e.id&&0>c.indexOf(e.id)&&(c.push(e.id),p.push(e))}),p.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),p}function B(e,t){var i=O(e,t);e=i.steps,t=i.stepId;var o=[];if("__startform"!==t&&(o=J("__startform"),e&&e.length>0))for(var n=0;e.length>n;n++){var r;if(r=e[n].resourceId?e[n].resourceId:e[n].id,r===t)break;Array.prototype.push.apply(o,J(r))}Array.prototype.push.apply(o,rt.forms);var a=[],s=[];return o.forEach(function(e){e&&e.id&&0>a.indexOf(e.id)&&(a.push(e.id),s.push(e))}),s.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),s}function U(e){var t=[];return e&&(t=Z(e)),t.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),t}function H(t,i,o){t&&i&&(j(r,t,i,EDITOR_CACHE.FORM_FIELDS_KEY),o[t]&&j(r,o[t],i,EDITOR_CACHE.FORM_FIELDS_BY_SID_KEY),e.$broadcast("form-cache-changed",{stepId:t}))}function j(e,t,i,o){var n=e.get(o);if(n){var r=n[t];r?r.push(i):n[t]=[i]}else n={},n[t]=[i];e.put(o,n)}function z(t,i,o){t&&i&&(j(r,t,i,EDITOR_CACHE.FORM_FIELD_VARIABLES_KEY),o[t]&&j(r,o[t],i,EDITOR_CACHE.FORM_FIELD_VARIABLES_BY_SID_KEY),e.$broadcast("form-cache-changed",{stepId:t}))}function K(e){var t=[];if(e){var i=r.get(EDITOR_CACHE.FORM_FIELD_VARIABLES_KEY);q(i,e,t);var o=r.get(EDITOR_CACHE.FORM_FIELD_VARIABLES_BY_SID_KEY);q(o,e,t)}return t}function q(e,t,i){if(e){var o=e[t];if(o)for(var n=0;o.length>n;n++)Array.prototype.push.apply(i,o[n].fields||[])}}function W(e){var t=[];if(e){var i=r.get(EDITOR_CACHE.FORM_FIELDS_KEY),o=Q(i,e);if(o)return o;if(o=Q(r.get(EDITOR_CACHE.FORM_FIELDS_BY_SID_KEY)))return o;if(rt.forms)for(var n=0;rt.forms.length>n;n++)if(rt.forms[n].id==e)return rt.forms[n].fields}return t}function Q(e,t){if(e)for(var i in e){var o=e[i];if(o)for(var n=0;o.length>n;n++)if(o[n]&&o[n].id==t)return o[n].fields||[]}}function J(e){var t;if(e){var i=r.get(EDITOR_CACHE.FORM_FIELDS_KEY);i&&i[e]&&(t=i[e]),!t&&r.get(EDITOR_CACHE.FORM_FIELDS_BY_SID_KEY)&&(t=r.get(EDITOR_CACHE.FORM_FIELDS_BY_SID_KEY)[e])}return t||[]}function Z(e){if(e){var t=r.get(EDITOR_CACHE.FORM_FIELDS_KEY);if(t)for(var i in t){var o=t[i];if(o)for(var n=0;o.length>n;n++)if(o[n]&&o[n].id==e)return o[n].outcomes||[]}for(var n=0;rt.forms.length>n;n++)if(rt.forms[n].id==e)return rt.forms[n].outcomes}return[]}var et,tt,it,ot,nt,rt={},at="processModelId",st="processActivityId";this.getSopreVariables=function(e,t){var i=[{processModelId:e,processActivityId:null}];return c(null,t,i)},this.init=function(t,o,r,l){s(),a(),it=o||{},r=r||at,l=l||st,et=[];for(var d,c,u=i.search(),m=1;!0&&(d=r+m,c=l+m,u.hasOwnProperty(d)&&u.hasOwnProperty(c));m++)try{var h=parseInt(u[d]);et.push({processModelId:h,processActivityId:u[c]}),h!=u[d]&&e.addAlertPromise(n("GENERAL.ERROR.INVALID-URL-MODEL-ID",{param:d}),"error")}catch(f){e.addAlertPromise(n("GENERAL.ERROR.INVALID-URL-MODEL-ID",{param:d}),"error")}void 0!==t&&null!==t&&(tt=parseInt(t)),p(null,it)},this.getParentIdentifiers=m,this.getIdentifiers=function(){var e=m();return null!==tt&&(e=e.concat({processModelId:tt,processActivityId:null})),e},this.refresh=function(){var e=null;return it.model&&(e=it.model()),s(),p(e,null)},this.navigateBack=function(e,t,o){var n=e;if(et&&et.length>0&&nt){var r=nt[et.length-1];if(!r)throw Error("Correct usage for ProcessScopeService is to first init service and then navigate back. The current state suggests that didn't happen.");t=t||at,o=o||st;var a;0===r.processModelType?a="/editor/"+encodeURIComponent(r.modelId):1===r.processModelType&&(a="/kickstart-editor/"+encodeURIComponent(r.modelId)),n=u(a,et.slice(0,et.length-1),t,o)}i.url(n)},this.navigateForward=function(e,t,o,n){if(null===tt)throw Error("Correct usage for ProcessScopeService includes already having setting the current process model (when setting the identifiers) before navigating forward.");if(!t)throw Error("Correct usage for ProcessScopeService includes supplying the current activity id when navigating forward, otherwise the scope would be lost.");o=o||at,n=n||st;var r=u(e,et.concat([{processModelId:tt,processActivityId:t}]),o,n);i.url(r)},this.updateResponseVariablesCache=h,this.updateExecutionVariablesCache=function(e,t){if(t){t.constructor===String&&(t=JSON.parse(t));for(var i=[],o=0;t.length>o;o++){var n=t[o];Array.prototype.push.apply(i,[{processVariableName:n.variableName,processVariableType:n.variableType}])}f(e,i)}else f(e,t)},this.updateFieldMappingVariablesCache=function(e,t){if(t){t.constructor===String&&(t=JSON.parse(t));for(var i=[],o=0;t.length>o;o++){var n=t[o];Array.prototype.push.apply(i,[{processVariableName:n.variableName,processVariableType:n.variableType}])}g(e,i)}else g(e,t)},this.updateMetadataVariablesCache=v,this.updateCustomStencilVariablesCache=S,this.updateEntityVariablesCache=I,this.getVariablesForStep=b,this.getVariables=function(e){return b(null,null,e)},this.getEntityVariablesForStep=E,this.getEntityVariables=function(e){return E(null,null,e)},this.getResponseVariablesForStep=y,this.getFormFieldsForStep=X,this.getFormFields=function(e){return X(null,null,e)},this.getFormsForStep=B,this.getFormModel=function(e){var i=o.defer();return t.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+e).success(function(e){e.isEmbeddedForm=e.referenceId?!0:!1,i.resolve(e)}).error(function(){console.log("Referenced form loading error"),i.resolve({})}),i.promise},this.getFormFieldsForFormFromServer=function(e){var i=o.defer();return t.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/"+e).success(function(e){e.isEmbeddedForm=e.referenceId?!0:!1;var t=[],o=e.formDefinition.fields;for(var n in o)if("function"!=typeof o[n]&&n&&o[n]&&o[n].fields)for(var r in o[n].fields)for(var a in o[n].fields[r])"function"!=typeof o[n].fields[r][a]&&t.push(o[n].fields[r][a]);i.resolve(t)}).error(function(){console.log("Referenced form loading error"),i.resolve({})}),i.promise},this.getFormOutcomesForForm=U,this.getFormFieldsForForm=function(e){var t=[];return e&&(t=W(e)),t}}]),angular.module("activitiModeler").controller("AppDefinitionBuilderController",["$rootScope","$scope","$translate","$http","$location","$routeParams","$modal","$popover","$timeout",function(e,t,i,o,n,r,a,s){t.model={latestModelId:r.modelId,currentlySharedUserIds:[],currentlySharedGroupIds:[]},t.loadApp=function(){o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/"+r.modelId}).success(function(i){if(e.currentAppDefinition=i,e.currentAppDefinition.definition.theme||(e.currentAppDefinition.definition.theme="theme-1"),e.currentAppDefinition.definition.icon||(e.currentAppDefinition.definition.icon="glyphicon-asterisk"),e.currentAppDefinition.definition.publishIdentityInfo&&e.currentAppDefinition.definition.publishIdentityInfo.length>0)for(var o=0;e.currentAppDefinition.definition.publishIdentityInfo.length>o;o++){var n=e.currentAppDefinition.definition.publishIdentityInfo[o];null!==n.person&&void 0!==n.person?t.model.currentlySharedUserIds.push(n.person.id):null!==n.group&&void 0!==n.group&&t.model.currentlySharedGroupIds.push(n.group.id)}}).error(function(){e.addAlertPromise(i("APP-DEFINITION.MESSAGE.NOT-FOUND"),"error"),n.path("/apps/")})},t.$on("$destroy",function(){e.currentAppDefinition=void 0}),t.editIncludedModels=function(){_internalCreateModal({template:"views/popup/app-definition-models-included.html?version="+Date.now(),scope:t},a,t)},t.availableIcons=["glyphicon-asterisk","glyphicon-plus","glyphicon-euro","glyphicon-cloud","glyphicon-envelope","glyphicon-pencil","glyphicon-glass","glyphicon-music","glyphicon-search","glyphicon-heart","glyphicon-star","glyphicon-star-empty","glyphicon-user","glyphicon-film","glyphicon-th-large","glyphicon-th","glyphicon-th-list","glyphicon-ok","glyphicon-remove","glyphicon-zoom-in","glyphicon-zoom-out","glyphicon-off","glyphicon-signal","glyphicon-cog","glyphicon-trash","glyphicon-home","glyphicon-file","glyphicon-time","glyphicon-road","glyphicon-download-alt","glyphicon-download","glyphicon-upload","glyphicon-inbox","glyphicon-play-circle","glyphicon-repeat","glyphicon-refresh","glyphicon-list-alt","glyphicon-lock","glyphicon-flag","glyphicon-headphones","glyphicon-volume-up","glyphicon-tag","glyphicon-tags","glyphicon-book","glyphicon-bookmark","glyphicon-print","glyphicon-camera","glyphicon-list","glyphicon-facetime-video","glyphicon-picture","glyphicon-map-marker","glyphicon-adjust","glyphicon-tint","glyphicon-edit","glyphicon-share","glyphicon-check","glyphicon-move","glyphicon-play","glyphicon-eject","glyphicon-plus-sign","glyphicon-minus-sign","glyphicon-remove-sign","glyphicon-ok-sign","glyphicon-question-sign","glyphicon-info-sign","glyphicon-screenshot","glyphicon-remove-circle","glyphicon-ok-circle","glyphicon-ban-circle","glyphicon-share-alt","glyphicon-exclamation-sign","glyphicon-gift","glyphicon-leaf","glyphicon-fire","glyphicon-eye-open","glyphicon-eye-close","glyphicon-warning-sign","glyphicon-plane","glyphicon-calendar","glyphicon-random","glyphicon-comment","glyphicon-magnet","glyphicon-retweet","glyphicon-shopping-cart","glyphicon-folder-close","glyphicon-folder-open","glyphicon-hdd","glyphicon-bullhorn","glyphicon-bell","glyphicon-certificate","glyphicon-thumbs-up","glyphicon-thumbs-down","glyphicon-hand-left","glyphicon-globe","glyphicon-wrench","glyphicon-tasks","glyphicon-filter","glyphicon-briefcase","glyphicon-dashboard","glyphicon-paperclip","glyphicon-heart-empty","glyphicon-link","glyphicon-phone","glyphicon-pushpin","glyphicon-usd","glyphicon-gbp","glyphicon-sort","glyphicon-flash","glyphicon-record","glyphicon-save","glyphicon-open","glyphicon-saved","glyphicon-send","glyphicon-floppy-disk","glyphicon-credit-card","glyphicon-cutlery","glyphicon-earphone","glyphicon-phone-alt","glyphicon-tower","glyphicon-stats","glyphicon-cloud-download","glyphicon-cloud-upload","glyphicon-tree-conifer","glyphicon-tree-deciduous"],t.availableThemes=["theme-1","theme-2","theme-3","theme-4","theme-5","theme-6","theme-7","theme-8","theme-9","theme-10"],t.changeIcon=function(e){if(!t.changeIconState){var i={};t.changeIconState=i,i.popover=s(angular.element(e.currentTarget),{template:"views/popover/select-app-icon.html",placement:"bottom-left",show:!0,scope:t});var o=function(){i.popover.destroy(),delete t.changeIconState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.selectIcon=function(t){e.currentAppDefinition.definition.icon=t},t.changeTheme=function(e){if(!t.changeThemeState){var i={};t.changeThemeState=i,i.popover=s(angular.element(e.currentTarget),{template:"views/popover/select-app-theme.html",placement:"bottom-left",show:!0,scope:t});var o=function(){i.popover.destroy(),delete t.changeThemeState};i.popover.$scope.$on("tooltip.hide",o),t.$on("$destroy",o)}},t.selectTheme=function(t){e.currentAppDefinition.definition.theme=t},t.addPublishUser=function(i){var o={person:i,type:"user"};if(e.currentAppDefinition.definition.publishIdentityInfo){for(var n=0;e.currentAppDefinition.definition.publishIdentityInfo.length>n;n++){var r=e.currentAppDefinition.definition.publishIdentityInfo[n];if("user"===r.type&&r.person&&r.person.id==i.id)return}e.currentAppDefinition.definition.publishIdentityInfo.splice(0,0,o)}else e.currentAppDefinition.definition.publishIdentityInfo=[o];t.model.currentlySharedUserIds.push(i.id)},t.addPublishGroup=function(i){var o={group:i,type:"group"};if(e.currentAppDefinition.definition.publishIdentityInfo){for(var n=0;e.currentAppDefinition.definition.publishIdentityInfo.length>n;n++){var r=e.currentAppDefinition.definition.publishIdentityInfo[n];if("group"===r.type&&r.group&&r.group.id==i.id)return}e.currentAppDefinition.definition.publishIdentityInfo.splice(0,0,o)}else e.currentAppDefinition.definition.publishIdentityInfo=[o];t.model.currentlySharedGroupIds.push(i.id)},t.removePublishIdentity=function(i){var o=e.currentAppDefinition.definition.publishIdentityInfo;if(i.person){var n=t.model.currentlySharedUserIds.indexOf(i.person.id);n>=0&&t.model.currentlySharedUserIds.splice(n,1)}else if(i.group){var r=t.model.currentlySharedGroupIds.indexOf(i.group.id);r>=0&&t.model.currentlySharedGroupIds.splice(r,1)}for(var a=0;o.length>a;a++)if(o[a]==i){o.splice(a,1);break}},t.loadApp()}]),angular.module("activitiModeler").controller("ModelsIncludedPopupCtrl",["$rootScope","$scope","$translate","$http","$timeout","$location",function(e,t,i,o){if(t.popup={loading:!1,selectedModels:[]},e.currentAppDefinition.definition.models)for(var n=0;e.currentAppDefinition.definition.models.length>n;n++)t.popup.selectedModels.push(e.currentAppDefinition.definition.models[n].id);t.loadModels=function(){t.popup.loading=!0,o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models-for-app-definition"}).success(function(e){t.popup.models=e,t.popup.loading=!1}).error(function(){t.popup.loading=!1})},t.selectModel=function(i){var o=t.popup.selectedModels.indexOf(i.id);o>=0?t.popup.selectedModels.splice(o,1):t.popup.selectedModels.push(i.id);for(var n=[],r=0;t.popup.models.data.length>r;r++)if(t.popup.selectedModels.indexOf(t.popup.models.data[r].id)>=0){var a=t.popup.models.data[r],s={id:a.id,name:a.name,version:a.version,modelType:a.modelType,description:a.description,stencilSetId:a.stencilSet,createdByFullName:a.createdByFullName,createdBy:a.createdBy,lastUpdatedByFullName:a.lastUpdatedByFullName,lastUpdatedBy:a.lastUpdatedBy,lastUpdated:a.lastUpdated};n.push(s)}e.currentAppDefinition.definition.models=n},t.isModelSelected=function(e){return t.popup.selectedModels.indexOf(e.id)>=0?!0:!1},t.close=function(){t.$hide()},t.loadModels()}]);var APP_DEFINITION_TOOLBAR={ACTIONS:{saveModel:function(e){_internalCreateModal({backdrop:!0,keyboard:!0,template:"views/popup/app-definition-save-model.html?version="+Date.now(),scope:e.$scope},e.$modal,e.$scope)},help:function(){},feedback:function(){},closeEditor:function(e){e.$location.path("/apps")}}};angular.module("activitiModeler").controller("SaveAppDefinitionCtrl",["$rootScope","$scope","$http","$route","$location","$translate",function(e,t,i,o,n,r){var a="";e.currentAppDefinition.description&&(a=e.currentAppDefinition.description);var s={name:e.currentAppDefinition.name,description:a,publish:!1};
t.saveDialog=s,t.status={loading:!1},t.cancel=function(){t.$hide()},t.saveAndClose=function(e){t.save(function(){n.path("/apps")},e)},t.saveAndContinue=function(e){t.save(void 0,e)},t.save=function(o,n){if(t.saveDialog.name&&0!=t.saveDialog.name.length){t.status.loading=!0;var a={appDefinition:e.currentAppDefinition,publish:t.saveDialog.publish};a.appDefinition.name=t.saveDialog.name,t.saveDialog.description&&t.saveDialog.description.length>0&&(a.appDefinition.description=t.saveDialog.description),void 0!==n&&null!==n&&n===!0&&(a.force=!0),delete Array.prototype.toJSON,delete t.conflict,i({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/app-definitions/"+e.currentAppDefinition.id,data:a}).success(function(i){i.error?(t.status.loading=!1,1==i.errorType?t.error={hasCustomStencilItem:!0,modelName:i.errorDescription}:2==i.errorType&&(t.error={hasValidationErrors:!0,modelName:i.errorDescription})):(t.$hide(),e.addAlert(r.instant("APP.POPUP.SAVE-APP-SAVE-SUCCESS","info")),o&&o())}).error(function(i,o){409===o&&i&&"app.publish.procdef.key.conflict"===i.messageKey?t.conflict={type:"conflictingProcDefKey",data:i.customData}:409===o&&i&&"app.publish.dectable.key.conflict"===i.messageKey?t.conflict={type:"conflictingDecTableKey",data:i.customData}:409===o&&i&&"app.publish.procdef.duplicate.keys"===i.messageKey?t.conflict={type:"duplicateProcDefKeys",data:i.customData}:409===o&&i&&"app.publish.dectable.duplicate.keys"===i.messageKey?t.conflict={type:"duplicateDecTableKeys",data:i.customData}:409===o&&i&&"app.publish.process.model.already.used"===i.messageKey?t.conflict={type:"processModelAlreadyUsed",data:i.customData}:(t.$hide(),e.addAlertPromise(r("APP.POPUP.SAVE-APP-SAVE-FAIL"),"error"))})}},t.isOkButtonDisabled=function(){return t.status.loading?!1:t.error&&t.error.hasCustomStencilItem?!1:!0},t.okClicked=function(){t.error&&("discardChanges"===t.error.conflictResolveAction?(t.close(),o.reload()):"overwrite"===t.error.conflictResolveAction||"newVersion"===t.error.conflictResolveAction?t.save():"saveAs"===t.error.conflictResolveAction&&t.save(function(){e.ignoreChanges=!0,n.path("/apps")}))}}]);var APP_DEFINITION_TOOLBAR_CONFIG={items:[{type:"button",title:"APP_DEFINITION_TOOLBAR.ACTION.SAVE",cssClass:"editor-icon editor-icon-save",action:"APP_DEFINITION_TOOLBAR.ACTIONS.saveModel",disableOnReadonly:!0}],secondaryItems:[{type:"button",title:"Close",cssClass:"glyphicon glyphicon-remove",action:"APP_DEFINITION_TOOLBAR.ACTIONS.closeEditor"}]};angular.module("activitiModeler").controller("AppDefinitionToolbarController",["$scope","$http","$modal","$q","$rootScope","$translate","$location",function(e,t,i,o,n,r,a){var s=APP_DEFINITION_TOOLBAR_CONFIG.items;e.items=[];for(var l=0;s.length>l;l++)e.items.push(s[l]);e.secondaryItems=APP_DEFINITION_TOOLBAR_CONFIG.secondaryItems;var d=function(e,t){for(var i=Array.prototype.slice.call(arguments).splice(2),o=e.split("."),n=o.pop(),r=0;o.length>r;r++)t=t[o[r]];return t[n].apply(this,i)};e.toolbarButtonClicked=function(a){var s=e.items[a],l={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r};d(s.action,window,l)},e.toolbarSecondaryButtonClicked=function(s){var l=e.secondaryItems[s],c={$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,$location:a};d(l.action,window,c)}}]);var KISBPM=KISBPM||{};KISBPM.eventBus={EVENT_TYPE_EDITOR_READY:"event-type-editor-ready",EVENT_TYPE_SELECTION_CHANGE:"event-type-selection-change",EVENT_TYPE_TOOLBAR_BUTTON_CLICKED:"event-type-toolbar-button-clicked",EVENT_TYPE_ITEM_DROPPED:"event-type-item-dropped",EVENT_TYPE_PROPERTY_VALUE_CHANGED:"event-type-property-value-changed",EVENT_TYPE_DOUBLE_CLICK:"event-type-double-click",EVENT_TYPE_MOUSE_OUT:"event-type-mouse-out",EVENT_TYPE_MOUSE_OVER:"event-type-mouse-over",EVENT_TYPE_MODEL_SAVED:"event-type-model-saved",EVENT_TYPE_HIDE_SHAPE_BUTTONS:"event-type-hide-shape-buttons",EVENT_TYPE_SHOW_VALIDATION_POPUP:"event-type-show-validation-popup",EVENT_TYPE_NAVIGATE_TO_PROCESS:"event-type-navigate-to-process",listeners:{},editor:null,addListener:function(e,t,i){return this.listeners[e]!==void 0?this.listeners[e].push({scope:i,callback:t}):this.listeners[e]=[{scope:i,callback:t}],t},removeListener:function(e,t,i){if(this.listeners[e]!==void 0){for(var o=this.listeners[e].length,n=[],r=0;o>r;r++){var a=this.listeners[e][r];a.scope===i&&a.callback===t||n.push(a)}this.listeners[e]=n}},hasListener:function(e,t,i){if(this.listeners[e]!==void 0){var o=this.listeners[e].length;if(void 0===t&&void 0===i)return o>0;for(var n=0;o>n;n++){var r=this.listeners[e][n];if(r.scope==i&&r.callback==t)return!0}}return!1},dispatch:function(e,t){if(this.listeners[e]!==void 0)for(var i=this.listeners[e].length,o=0;i>o;o++){var n=this.listeners[e][o];n&&n.callback&&n.callback.apply(n.scope,[t])}},dispatchOryxEvent:function(e,t){KISBPM.eventBus.editor.handleEvents(e,t)}},angular.module("activitiModeler").controller("EditorController",["$rootScope","$scope","$http","$q","$routeParams","$timeout","$location","$translate","$modal","FormBuilderService","ProcessScopeService","EditorScopeService","$sanitize",function(e,t,i,o,n,r,a,s,l,d,c,p,u){function m(){var t;t=n.modelId?KISBPM.URL.getModel(n.modelId):KISBPM.URL.newModelInfo(),e.parentReferenceId=p.getCurrentProcessModelId(),i({method:"GET",url:t}).success(function(t){try{e.editor=new ORYX.Editor(t),e.modelData=angular.fromJson(t),e.editorFactory.resolve(),c.init(n.modelId,{model:function(){return e.editor.getJSON()}})}catch(i){console.log("Exception: "+i),e.addAlertPromise(s("MODEL.MESSAGE.ERROR",{details:i.message}),"error"),a.url("/processes/")}}).error(function(){e.addAlertPromise(s("PROCESS-MODEL.MESSAGE.NOT-FOUND"),"error"),a.url("/processes/")}),n.modelId&&i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+n.modelId}).success(function(t){e.currentProcessModel=t}).error(function(){console.error("Could not load process model info")})}function h(e){try{return u(e)}catch(t){return}}function f(){var i=jQuery("#canvasSection");i.scroll(function(){var i=e.editor.selection,o=e.editor._subSelection;t.selectedElements=i,t.subSelectionElements=o,i&&i.length>0&&(e.selectedElementBeforeScrolling=i[0]),jQuery(".Oryx_button").each(function(e,i){t.orginalOryxButtonStyle=i.style.display,i.style.display="none"}),e.hideValidationIcons(!1),jQuery(".resizer_southeast").each(function(e,i){t.orginalResizerSEStyle=i.style.display,i.style.display="none"}),jQuery(".resizer_northwest").each(function(e,i){t.orginalResizerNWStyle=i.style.display,i.style.display="none"}),e.editor.handleEvents({type:ORYX.CONFIG.EVENT_CANVAS_SCROLL})}),i.scrollStopped(function(){function i(e){e.style.display=jQuery(e).position().top>0?"block":"none"}e.editor.setSelection([]),e.editor.setSelection(t.selectedElements,t.subSelectionElements),t.selectedElements=void 0,t.subSelectionElements=void 0,jQuery(".Oryx_button").each(function(e,t){i(t)}),e.showValidationIcons(),jQuery(".resizer_southeast").each(function(e,t){i(t)}),jQuery(".resizer_northwest").each(function(e,t){i(t)})})}function g(){e.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)},e.editorFactory.promise.then(function(){e.formItems=void 0,KISBPM.eventBus.editor=e.editor;var i=[{oryxType:ORYX.CONFIG.EVENT_SELECTION_CHANGED,kisBpmType:KISBPM.eventBus.EVENT_TYPE_SELECTION_CHANGE},{oryxType:ORYX.CONFIG.EVENT_DBLCLICK,kisBpmType:KISBPM.eventBus.EVENT_TYPE_DOUBLE_CLICK},{oryxType:ORYX.CONFIG.EVENT_MOUSEOUT,kisBpmType:KISBPM.eventBus.EVENT_TYPE_MOUSE_OUT},{oryxType:ORYX.CONFIG.EVENT_MOUSEOVER,kisBpmType:KISBPM.eventBus.EVENT_TYPE_MOUSE_OVER}];i.forEach(function(t){e.editor.registerOnEvent(t.oryxType,function(e){KISBPM.eventBus.dispatch(t.kisBpmType,e)})}),e.editor.registerOnEvent(ORYX.CONFIG.EVENT_SHAPEREMOVED,function(e){var t=document.getElementById(e.shape.resourceId+"-validate-button");t&&(t.style.display="none")}),KISBPM.eventBus.dispatch(KISBPM.eventBus.EVENT_TYPE_EDITOR_READY,{type:KISBPM.eventBus.EVENT_TYPE_EDITOR_READY}),ACTIVITI_EDITOR_TOUR.gettingStarted(t,s,o,!0)}),e.showValidationIcons=function(){if(e.validationErrors&&e.validationErrors.length>0){for(var t={},i={},o=e.editor.getCanvas().getChildShapes(!0),n=0;o.length>n;n++)t[o[n].resourceId]=o[n],o[n].properties["oryx-overrideid"]&&o[n].properties["oryx-overrideid"].length>0&&(i[o[n].properties["oryx-overrideid"]]=o[n]);for(var r=e.editor.getCanvas().getSvgContainer(),a={},n=0;e.validationErrors.length>n;n++){var s=e.validationErrors[n],l=null;if(l=t[s.id]?t[s.id]:i[s.id],s.id){if(!l)continue;s.warning?a[l.getId()]||(a[l.getId()]=!1):a[l.getId()]=!0}else s.warning?a.ROOTSCOPE||(a.ROOTSCOPE=!1):a.ROOTSCOPE=!0}for(var d=[],n=0;e.validationErrors.length>n;n++){var s=e.validationErrors[n],l=null;l=t[s.id]?t[s.id]:i[s.id];var c,p,u,m=!1;if(s.id){if(!l)continue;if(d.indexOf(l.getId())>=0)continue;d.push(l.getId());var f="#FB9908";if(u="editor-app/images/bpmn-warning.png",a[l.getId()]&&(f="#FF0000",u="editor-app/images/bpmn-error.png"),"SequenceFlow"==l.getStencil().idWithoutNs()){var g=r.ownerDocument.getElementById(l.getId()+"arrowhead");if(!g)continue;g.setAttributeNS(null,"stroke",f),g.setAttributeNS(null,"fill",f);var v=r.ownerDocument.getElementById(l.getId()+"_1");if(!v)continue;v.setAttributeNS(null,"stroke",f)}else{var S=r.ownerDocument.getElementById(l.getId()+"bg_frame");if(!S)continue;S.setAttributeNS(null,"stroke",f),S.setAttributeNS(null,"style","stroke-width:2")}c=l.resourceId+"-validate-button",p=s.id,e.mappedObjects[p]=l}else{if(d.indexOf("ROOTSCOPE")>=0)continue;d.push("ROOTSCOPE"),u="editor-app/images/bpmn-warning.png",a.ROOTSCOPE&&(u="editor-app/images/bpmn-error.png"),c="ROOT-process-definition-validate-button",p="ROOT-process-definition",m=!0}var I=document.getElementById(c);if(I)I.style.display="block",I.getElementsByTagName("img")[0].src=u;else{var O=h(p);jQuery("#canvasSection").append('<div class="ValidateButton" id="'+c+'" onclick="KISBPM.TOOLBAR.ACTIONS.showValidation(\''+O+"',"+m+')"><img src="'+u+'"/></div>'),I=document.getElementById(c)}if(s.id){var b=l.node.getScreenCTM(),E=l.absoluteXY();b.e=b.a*E.x;var y=0,R=jQuery("#canvasSection");if(R&&R[0])for(var T=R[0].children,C=0;T.length>C;C++)if(R[0].children[C].className&&"ORYX_Editor"===R[0].children[C].className){y=R[0].children[C].offsetLeft;break}var A=jQuery("#canvasSection").scrollLeft();b.e=b.e+y-A,b.f=b.d*E.y,b.f=b.f-jQuery("#canvasSection").scrollTop();var N=new ORYX.Core.Bounds(b.e,b.f,b.e+b.a*l.bounds.width(),b.f+b.d*l.bounds.height());b=N.upperLeft(),I.style.left=b.x+"px",I.style.top=b.y-25+"px",-5>b.y-25&&(I.style.display="none")}else I.style.left="5px",I.style.top="5px"}}},e.getCurrentId=function(t){var i=e.mappedObjects[t];if(i){var o=i.properties["oryx-overrideid"];o||(o=i.getId())}else o=t;return o},e.hideValidationIcons=function(i){if(e.validationErrors&&e.validationErrors.length>0){for(var o={},n={},r=t.editor.getCanvas().getChildShapes(!0),a=0;r.length>a;a++)o[r[a].resourceId]=r[a],r[a].properties["oryx-overrideid"]&&r[a].properties["oryx-overrideid"].length>0&&(n[r[a].properties["oryx-overrideid"]]=r[a]);for(var s=e.editor.getCanvas().getSvgContainer(),a=0;e.validationErrors.length>a;a++){var l=e.validationErrors[a],d=null;d=o[l.id]?o[l.id]:n[l.id],d||e.mappedObjects[l.id]&&(d=e.mappedObjects[l.id]);var c;if(l.id){if(!d)continue;if(i)if("SequenceFlow"==d.getStencil().idWithoutNs()){var p=s.ownerDocument.getElementById(d.getId()+"arrowhead");if(!p)continue;p.setAttributeNS(null,"stroke","#585858"),p.setAttributeNS(null,"fill","#585858");var u=s.ownerDocument.getElementById(d.getId()+"_1");if(!u)continue;u.setAttributeNS(null,"stroke","#585858")}else{var m=s.ownerDocument.getElementById(d.getId()+"bg_frame");if(!m)continue;m.setAttributeNS(null,"stroke","#bbbbbb"),m.setAttributeNS(null,"style","stroke-width:1")}c=d.resourceId+"-validate-button"}else c="ROOT-process-definition-validate-button";var h=document.getElementById(c);h&&(h.style.display="none")}}},jQuery(window).resize(function(){var i=jQuery("#editor-header").offset(),o=jQuery("#propertySection").height(),n=jQuery("#canvasSection"),r=jQuery("#main-header");if(void 0!=i&&null!==i&&void 0!==o&&null!==o&&void 0!==n&&null!==n&&null!==r){if(e.editor){var a=e.editor.selection,s=e.editor._subSelection;t.selectedElements=a,t.subSelectionElements=s,a&&a.length>0&&(e.selectedElementBeforeScrolling=a[0],e.editor.setSelection([]),e.editor.setSelection(t.selectedElements,t.subSelectionElements),t.selectedElements=void 0,t.subSelectionElements=void 0),e.showValidationIcons()}var l=jQuery(window).height()-i.top-r.height()-21;n.height(l-o),jQuery("#paletteSection").height(l);var d=null;n&&n[0].children[1]&&(d=n[0].children[1]);var c=n.position().top,p=n.position().left,u=n[0].clientHeight,m=n[0].clientWidth,h=8,f=0,g=0;d&&(g=d.clientWidth||d.parentNode.clientWidth),n[0].clientWidth>g&&(f=g-n[0].clientWidth,p-=f/2,m+=f);var v=17,S=20,I=jQuery("#canvas-grow-N");I.css("top",c+S+"px"),I.css("left",p-10+(m-v)/2+"px");var O=jQuery("#canvas-grow-S");O.css("top",c+u-S-h+"px"),O.css("left",p-10+(m-v)/2+"px");var b=jQuery("#canvas-grow-E");b.css("top",c-10+(u-v)/2+"px"),b.css("left",p+m-S-h+"px");var E=jQuery("#canvas-grow-W");E.css("top",c-10+(u-v)/2+"px"),E.css("left",p+S+"px"),I=jQuery("#canvas-shrink-N"),I.css("top",c+S+"px"),I.css("left",p+10+(m-v)/2+"px"),O=jQuery("#canvas-shrink-S"),O.css("top",c+u-S-h+"px"),O.css("left",p+10+(m-v)/2+"px"),b=jQuery("#canvas-shrink-E"),b.css("top",c+10+(u-v)/2+"px"),b.css("left",p+m-S-h+"px"),E=jQuery("#canvas-shrink-W"),E.css("top",c+10+(u-v)/2+"px"),E.css("left",p+S+"px")}}),jQuery(window).trigger("resize"),jQuery.fn.scrollStopped=function(e){jQuery(this).scroll(function(){var t=this,i=jQuery(t);i.data("scrollTimeout")&&clearTimeout(i.data("scrollTimeout")),i.data("scrollTimeout",setTimeout(e,50,t))})},e.editorInitialized=!0}e.editorFactory=o.defer(),e.forceSelectionRefresh=!1,e.ignoreChanges=!1,e.validationErrors=[],e.mappedObjects={},e.staticIncludeVersion=Date.now(),e.editorInitialized?m():(ORYX._loadPlugins(),m(),g()),t.$on("$locationChangeStart",function(i,o){if(e.editor&&!e.ignoreChanges){for(var n,r=e.editor.loadedPlugins,s=0;r.length>s;s++)if("ORYX.Plugins.Save"==r[s].type){n=r[s];break}if(n&&n.hasChanges()&&(i.preventDefault(),!t.unsavedChangesModalInstance)){var d=function(i){t.unsavedChangesModalInstance=void 0,i?(e.ignoreChanges=!0,a.url(o.substring(o.indexOf("/#")+2))):(e.ignoreChanges=!1,e.setMainPageById("processes"))};t.handleResponseFunction=d,_internalCreateModal({template:"editor-app/popups/unsaved-changes.html",scope:t},l,t)}}}),f()}]),angular.module("activitiModeler").controller("EditorUnsavedChangesPopupCrtl",["$rootScope","$scope","$http","$location","$window",function(e,t,i,o,n){t.discard=function(){t.handleResponseFunction&&(t.handleResponseFunction(!0),n.onbeforeunload=void 0),t.$hide()},t.save=function(){t.handleResponseFunction&&t.handleResponseFunction(!1),t.$hide()},t.cancel=function(){t.handleResponseFunction&&t.handleResponseFunction(null),t.$hide()}}]),angular.module("activitiModeler").controller("EditorYesNoCancelPopupCrtl",["$rootScope","$scope","$http","$location","$window",function(e,t){t.yes=function(){t.handleResponseFunction&&t.handleResponseFunction(!0),t.$hide()},t.no=function(){t.handleResponseFunction&&t.handleResponseFunction(!1),t.$hide()},t.cancel=function(){t.handleResponseFunction&&t.handleResponseFunction(null),t.$hide()}}]),angular.module("activitiModeler").controller("StencilController",["$rootScope","$scope","$http","$modal","$timeout","ProcessScopeService","editorCache",function(e,t,i,o,n,r,a){t.propertyWindowState={collapsed:!1},t.headerConfig=KISBPM.HEADER_CONFIG,t.propertyWindowState.toggle=function(){t.propertyWindowState.collapsed=!t.propertyWindowState.collapsed,n(function(){jQuery(window).trigger("resize")},100)},t.editorFactory.promise.then(function(){var s=[],l=function(e,t){for(var i=0;t.length>i;i++)if(t[i].name===e)return t[i];return null},d=function(e,t){var i={name:e,items:[],paletteItems:[],groups:[],visible:!0};return t.push(i),i};i({method:"GET",url:KISBPM.URL.getStencilSet(t.modelData.stencilSetId)}).success(function(e){for(var i=["UserTask","EndNoneEvent","ExclusiveGateway","CatchTimerEvent","ThrowNoneEvent","TextAnnotation","SequenceFlow","Association"],o=["SequenceFlow","MessageFlow","Association","DataAssociation","DataStore","SendTask"],n=[],r=[],a=0;e.rules.morphingRules.length>a;a++){var c=e.rules.morphingRules[a].role,p={role:c,morphOptions:[]};r.push(p)}for(var u=0;e.stencils.length>u;u++){var m=e.stencils[u].groups[0];if("Diagram"!==m&&"Form"!==m){var h=!1;e.stencils[u].removed&&(h=!0);var f=void 0;if(!h&&null!==m&&void 0!==m&&m.length>0){f=l(m,s),null===f&&(f=d(m,s));for(var g=1;e.stencils[u].groups.length>g;g++){var v=e.stencils[u].groups[g],S=l(v,f.groups);null===S&&(S=d(v,f.groups)),f=S}}var I={id:e.stencils[u].id,name:e.stencils[u].title,description:e.stencils[u].description,icon:e.stencils[u].icon,type:e.stencils[u].type,roles:e.stencils[u].roles,removed:h,customIcon:!1,canConnect:!1,canConnectTo:!1,canConnectAssociation:!1};if(e.stencils[u].custom&&e.stencils[u].custom.variables){for(var O=[],b=e.stencils[u].custom.variables,a=0;b.length>a;a++)O.push({processVariableName:b[a].name,processVariableType:b[a].type});I.customVariables=O}e.stencils[u].customIconId&&e.stencils[u].customIconId>0&&(I.customIcon=!0,I.icon=e.stencils[u].customIconId),h||i.indexOf(I.id)>=0&&(n[i.indexOf(I.id)]=I),("TextAnnotation"===I.id||"BoundaryCompensationEvent"===I.id)&&(I.canConnectAssociation=!0);for(var a=0;e.stencils[u].roles.length>a;a++){var E=e.stencils[u].roles[a];"sequence_start"===E?I.canConnect=!0:"sequence_end"===E&&(I.canConnectTo=!0);for(var y=0;r.length>y;y++)if(E===r[y].role){h||r[y].morphOptions.push(I),I.morphRole=r[y].role;break}}f?(f.items.push(I),0>o.indexOf(I.id)&&f.paletteItems.push(I)):h||s.push(I)}}for(var a=0;s.length>a;a++)s[a].paletteItems&&0==s[a].paletteItems.length&&(s[a].visible=!1);t.stencilItemGroups=s;for(var R=[],a=0;e.rules.containmentRules.length>a;a++){var T=e.rules.containmentRules[a];R.push(T)}t.containmentRules=R;for(var C=[],a=0;n.length>a;a++)n[a]&&(C[C.length]=n[a]);t.quickMenuItems=C,t.morphRoles=r}).error(function(e){console.log("Something went wrong when fetching stencil items:"+JSON.stringify(e))}),t.editor.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,function(i){var o=i.elements,n=!1;if(o&&0==o.length&&(o=[t.editor.getCanvas()],n=!0),o&&o.length>0){var a=o.first(),s=a.getStencil();if(e.selectedElementBeforeScrolling&&-1!==s.id().indexOf("BPMNDiagram"))return;if(e.selectedElementBeforeScrolling&&e.selectedElementBeforeScrolling.getId()===a.getId())return e.selectedElementBeforeScrolling=null,void 0;if(t.previousSelectedShape=t.selectedShape,void 0!==t.selectedShape&&t.selectedShape.getId()===a.getId()){if(!e.forceSelectionRefresh)return;e.forceSelectionRefresh=!1}var l=t.getStencilItemById(a.getStencil().idWithoutNs());l&&l.customVariables&&l.customVariables.length>0&&r.updateCustomStencilVariablesCache(a.resourceId,l.customVariables);var d="";l&&(d=l.name);var c={title:"",properties:[],stencilType:d};n&&(c.auditData={author:t.modelData.createdByUser,createDate:t.modelData.createDate});for(var p=s.properties(),u=0;p.length>u;u++){var m=p[u];if(0!=m.popular()){var h=m.prefix()+"-"+m.id();"oryx-name"===h&&(c.title=a.properties[h]);var f=KISBPM.PROPERTY_CONFIG[h+"-"+m.type()];if((void 0===f||null===f)&&(f=KISBPM.PROPERTY_CONFIG[m.type()]),void 0===f||null===f)console.log("WARNING: no property configuration defined for "+h+" of type "+m.type());else{if("true"===a.properties[h]&&(a.properties[h]=!0),0==KISBPM.CONFIG.showRemovedProperties&&m.isHidden())continue;var g={key:h,title:m.title(),description:m.description(),type:m.type(),mode:"read",hidden:m.isHidden(),value:a.properties[h]};if(("complex"===g.type||"multiplecomplex"===g.type)&&g.value&&g.value.length>0)try{g.value=JSON.parse(g.value)}catch(v){}void 0!==f.readModeTemplateUrl&&null!==f.readModeTemplateUrl&&(g.readModeTemplateUrl=f.readModeTemplateUrl+"?version="+e.staticIncludeVersion),null!==f.writeModeTemplateUrl&&null!==f.writeModeTemplateUrl&&(g.writeModeTemplateUrl=f.writeModeTemplateUrl+"?version="+e.staticIncludeVersion),void 0!==f.templateUrl&&null!==f.templateUrl?(g.templateUrl=f.templateUrl+"?version="+e.staticIncludeVersion,g.hasReadWriteMode=!1):g.hasReadWriteMode=!0,(void 0===g.value||null===g.value||0==g.value.length)&&(g.noValue=!0),c.properties.push(g)}}}t.safeApply(function(){t.selectedItem=c,t.selectedShape=a})}else t.safeApply(function(){t.selectedItem={},t.selectedShape=null})}),t.editor.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,function(e){KISBPM.eventBus.dispatch(KISBPM.eventBus.EVENT_TYPE_HIDE_SHAPE_BUTTONS);var i=e.elements;if(i&&1==i.length){var o=i.first(),n=t.editor.getCanvas().node.getScreenCTM(),r=o.absoluteXY();r.x*=n.a,r.y*=n.d;var a=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var s=navigator.userAgent;if(s.indexOf("MSIE")>=0){var l=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==l&&(a=l/100)}}if(1===a)r.y=r.y-jQuery("#canvasSection").offset().top+5,r.x=r.x-jQuery("#canvasSection").offset().left;else{var d=jQuery("#canvasSection").offset().left,c=jQuery("#canvasSection").scrollLeft(),p=jQuery("#canvasSection").scrollTop(),u=n.e-d*a,m=0;u>10&&(m=u/a-u),r.y=r.y-jQuery("#canvasSection").offset().top*a+5+(p*a-p),r.x=r.x-d*a+m+(c*a-c)}var h=new ORYX.Core.Bounds(n.e+r.x,n.f+r.y,n.e+r.x+n.a*o.bounds.width(),n.f+r.y+n.d*o.bounds.height()),f=h.upperLeft(),g=t.getStencilItemById(o.getStencil().idWithoutNs()),v=[];if(g&&g.morphRole)for(var S=0;t.morphRoles.length>S;S++)t.morphRoles[S].role===g.morphRole&&(v=t.morphRoles[S].morphOptions);var I=f.x;if(48>h.width()&&(I-=24),v&&v.length>0){var O=document.getElementById("morph-button");O.style.display="block",O.style.left=I+24+"px",O.style.top=f.y+h.height()+2+"px"}var b=document.getElementById("delete-button");if(b.style.display="block",b.style.left=I+"px",b.style.top=f.y+h.height()+2+"px",g&&(g.canConnect||g.canConnectAssociation)){var E=0,y=f.x+h.width()+5,R=f.y;jQuery(".Oryx_button").each(function(e,t){"morph-button"!==t.id&&"delete-button"!=t.id&&(E++,E>3?(y=f.x+h.width()+5,R+=24,E=1):E>1&&(y+=24),t.style.display="block",t.style.left=y+"px",t.style.top=R+"px")})}}}),t.editor.registerOnEvent(ORYX.CONFIG.EVENT_DRAGDROP_END,function(){var t=e.editor.getSelection();t&&t.length>0&&e.showValidationIcons()}),t.editor.registerOnEvent(ORYX.CONFIG.EVENT_RESIZE_END,function(){var t=e.editor.getSelection();t&&t.length>0&&e.showValidationIcons()}),t.kisbpmListeners=[],t.addScopedKISBPMListener=function(e,i,o){KISBPM.eventBus.addListener(e,i,o),t.kisbpmListeners.push([e,i,o])},t.removeScopedKISBPMListeners=function(){for(var e,i=0;t.kisbpmListeners.length>i;i++)e=t.kisbpmListeners[i],KISBPM.eventBus.removeListener(e[0],e[1],e[2])},t.$on("$destroy",function(){t.removeScopedKISBPMListeners()}),t.addScopedKISBPMListener(KISBPM.eventBus.EVENT_TYPE_HIDE_SHAPE_BUTTONS,function(){jQuery(".Oryx_button").each(function(e,t){t.style.display="none"})}),t.addScopedKISBPMListener(KISBPM.eventBus.EVENT_TYPE_PROPERTY_VALUE_CHANGED,function(i){if(i.property&&i.property.key){if("oryx-name"===i.property.key&&void 0!==t.selectedItem&&null!==t.selectedItem&&(t.selectedItem.title=i.newValue),"oryx-overrideid"===i.property.key){var o=a.get(EDITOR_CACHE.FORM_FIELD_VARIABLES_KEY);if(o){var n=i.oldValue,r=i.newValue||i.element.resourceId;if(r){var s=o[n];s||(n=i.element.resourceId,s=o[i.element.resourceId]),s&&(o[r]=s,delete o[n],a.put(EDITOR_CACHE.FORM_FIELD_VARIABLES_KEY,o),e.$broadcast("form-cache-changed",{stepId:r}))}}}i.property.noValue=void 0===i.property.value||null===i.property.value||0==i.property.value.length}}),t.addScopedKISBPMListener(KISBPM.eventBus.EVENT_TYPE_SHOW_VALIDATION_POPUP,function(t){var i=e.getCurrentId(t.validationId),n=function(){e.originalValidationId=t.validationId,e.currentValidationId=i,e.isOnProcessLevel=t.onProcessLevel,_internalCreateModal({template:"editor-app/popups/validation-errors.html?version="+Date.now()},o,e)};n()}),t.addScopedKISBPMListener(KISBPM.eventBus.EVENT_TYPE_NAVIGATE_TO_PROCESS,function(e){n(function(){r.navigateForward("editor/"+encodeURIComponent(e.processId),t.selectedShape.resourceId)})}),t.morphShape=function(){t.safeApply(function(){var i=e.editor.getSelection();if(i&&1==i.length){e.currentSelectedShape=i.first();for(var n=t.getStencilItemById(e.currentSelectedShape.getStencil().idWithoutNs()),r=[],a=0;t.morphRoles.length>a;a++)t.morphRoles[a].role===n.morphRole&&(r=t.morphRoles[a].morphOptions.slice());var s=function(){e.morphShapes=r,_internalCreateModal({backdrop:!1,keyboard:!0,template:"editor-app/popups/select-shape.html?version="+Date.now()},o,e)};s()}})},t.deleteShape=function(){KISBPM.TOOLBAR.ACTIONS.deleteItem({$scope:t})},t.quickAddItem=function(i){t.safeApply(function(){var o=e.editor.getSelection();if(o&&1==o.length){e.currentSelectedShape=o.first();for(var n=void 0,r=t.editor.getStencilSets().values(),a=0;r.length>a;a++)for(var s=r[a],l=s.nodes(),d=0;l.length>d;d++)if(l[d].idWithoutNs()===i){n=l[d];break}if(!n)return;var c={type:t.currentSelectedShape.getStencil().namespace()+i,namespace:t.currentSelectedShape.getStencil().namespace()};c.connectedShape=e.currentSelectedShape,c.parent=e.currentSelectedShape.parent,c.containedStencil=n;var p={sourceShape:e.currentSelectedShape,targetStencil:n},u=t.editor.getRules().connectMorph(p);if(!u)return;c.connectingType=u.id();var m=new KISBPM.CreateCommand(c,void 0,void 0,t.editor);t.editor.executeCommands([m])}})}}),t.propertyClicked=function(e){t.selectedItem.properties[e].hidden||(t.selectedItem.properties[e].mode="write")},t.getPropertyTemplateUrl=function(e){return t.selectedItem.properties[e].templateUrl},t.getPropertyReadModeTemplateUrl=function(e){return t.selectedItem.properties[e].readModeTemplateUrl},t.getPropertyWriteModeTemplateUrl=function(e){return t.selectedItem.properties[e].writeModeTemplateUrl},t.addPropertyToSelectedShape=function(e,i){var o=t.selectedShape;o.setProperty("oryx-"+e,i)},t.updatePropertyInModel=function(e,i){var o=t.selectedShape;if(i&&(o=o.id!=i&&t.previousSelectedShape&&t.previousSelectedShape.id==i?t.previousSelectedShape:null),o){var n=e.key,r=e.value,a=o.properties[n];if(r!=a){var s=ORYX.Core.Command.extend({construct:function(){this.key=n,this.oldValue=a,this.newValue=r,this.shape=o,this.facade=t.editor},execute:function(){this.shape.setProperty(this.key,this.newValue),this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.shape.setProperty(this.key,this.oldValue),this.facade.getCanvas().update(),this.facade.updateSelection()}}),l=new s;t.editor.executeCommands([l]),t.editor.handleEvents({type:ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED,elements:[o],key:n}),e.mode="read";var d={type:KISBPM.eventBus.EVENT_TYPE_PROPERTY_VALUE_CHANGED,property:e,oldValue:a,newValue:r,element:o};KISBPM.eventBus.dispatch(d.type,d)}else e.mode="read"}},t.findStencilItemInGroup=function(e,i){for(var o,n=0;i.items.length>n;n++)if(o=i.items[n],o.id===e)return o;if(i.groups&&i.groups.length>0)for(var r=0;i.groups.length>r;r++)if(o=t.findStencilItemInGroup(e,i.groups[r]))return o;return void 0},t.getStencilItemById=function(e){if(!t.stencilItemGroups)return void 0;for(var i=0;t.stencilItemGroups.length>i;i++){var o=t.stencilItemGroups[i];if(null!==o.items&&void 0!==o.items){var n=t.findStencilItemInGroup(e,o);if(n)return n}else if(o.id===e)return o}return void 0},t.dropCallback=function(e,i){if(t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeRepo.attached"}),t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeRepo.added"}),t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeMenu"}),KISBPM.eventBus.dispatch(KISBPM.eventBus.EVENT_TYPE_HIDE_SHAPE_BUTTONS),t.dragCanContain){var o=t.getStencilItemById(i.draggable[0].id),n={x:e.pageX,y:e.pageY},r=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var a=navigator.userAgent;if(a.indexOf("MSIE")>=0){var s=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==s&&(r=s/100)}}var l=t.editor.getCanvas().node.getScreenCTM();n.x-=l.e/r,n.y-=l.f/r,n.x/=l.a,n.y/=l.d,n.x-=document.documentElement.scrollLeft,n.y-=document.documentElement.scrollTop;var d=t.dragCurrentParent.absoluteXY();n.x-=d.x,n.y-=d.y;for(var c=void 0,p=t.editor.getStencilSets().values(),u=0;p.length>u;u++){for(var m=p[u],h=m.nodes(),f=0;h.length>f;f++)if(h[f].idWithoutNs()===i.draggable[0].id){c=h[f];break}if(!c)for(var g=m.edges(),f=0;g.length>f;f++)if(g[f].idWithoutNs()===i.draggable[0].id){c=g[f];break}}if(!c)return;if(t.quickMenu){var v=t.editor.getSelection();if(v&&1==v.length){var S=v.first(),I={};if(I.type=S.getStencil().namespace()+i.draggable[0].id,I.namespace=S.getStencil().namespace(),I.connectedShape=S,I.parent=t.dragCurrentParent,I.containedStencil=c,!e.ctrlKey){var O=S.bounds.center();20>Math.abs(O.x-n.x)&&(n.x=O.x),20>Math.abs(O.y-n.y)&&(n.y=O.y)}if(I.position=n,"SequenceFlow"!==c.idWithoutNs()&&"Association"!==c.idWithoutNs()&&"MessageFlow"!==c.idWithoutNs()&&"DataAssociation"!==c.idWithoutNs()){var b={sourceShape:S,targetStencil:c},E=t.editor.getRules().connectMorph(b);if(!E)return;I.connectingType=E.id()}var y=new KISBPM.CreateCommand(I,t.dropTargetElement,n,t.editor);t.editor.executeCommands([y])}}else{var R=!1;("BoundaryErrorEvent"===c.idWithoutNs()||"BoundaryTimerEvent"===c.idWithoutNs()||"BoundarySignalEvent"===c.idWithoutNs()||"BoundaryMessageEvent"===c.idWithoutNs()||"BoundaryCancelEvent"===c.idWithoutNs()||"BoundaryCompensationEvent"===c.idWithoutNs())&&(n=t.editor.eventCoordinates(e),R=!0);var I={};I.type=t.modelData.model.stencilset.namespace+o.id,I.namespace=t.modelData.model.stencilset.namespace,I.position=n,I.parent=t.dragCurrentParent;var T=ORYX.Core.Command.extend({construct:function(e,t,i,o,n){this.option=e,this.docker=null,this.dockedShape=t,this.dockedShapeParent=t.parent||n.getCanvas(),this.position=o,this.facade=n,this.selection=this.facade.getSelection(),this.shape=null,this.parent=null,this.canAttach=i},execute:function(){this.shape?this.parent&&this.parent.add(this.shape):(this.shape=this.facade.createShape(I),this.parent=this.shape.parent),this.canAttach&&this.shape.dockers&&this.shape.dockers.length&&(this.docker=this.shape.dockers[0],this.dockedShapeParent.add(this.docker.parent),this.docker.setDockedShape(void 0),this.docker.bounds.centerMoveTo(this.position),this.dockedShape!==this.facade.getCanvas()&&this.docker.setDockedShape(this.dockedShape),this.facade.setSelection([this.docker.parent])),this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.shape&&(this.facade.setSelection(this.selection.without(this.shape)),this.facade.deleteShape(this.shape)),this.canAttach&&this.docker&&this.docker.setDockedShape(void 0),this.facade.getCanvas().update(),this.facade.updateSelection()}}),y=new T(I,t.dragCurrentParent,R,n,t.editor);t.editor.executeCommands([y]);var C={type:KISBPM.eventBus.EVENT_TYPE_ITEM_DROPPED,droppedItem:o,position:n};KISBPM.eventBus.dispatch(C.type,C)}}t.dragCurrentParent=void 0,t.dragCurrentParentId=void 0,t.dragCurrentParentStencil=void 0,t.dragCanContain=void 0,t.quickMenu=void 0,t.dropTargetElement=void 0},t.overCallback=function(){t.dragModeOver=!0},t.outCallback=function(){t.dragModeOver=!1},t.startDragCallback=function(e,i){t.dragModeOver=!1,t.quickMenu=!1,i.helper.hasClass("stencil-item-dragged")||i.helper.addClass("stencil-item-dragged")},t.startDragCallbackQuickMenu=function(){t.dragModeOver=!1,t.quickMenu=!0},t.dragCallback=function(e){if(0!=t.dragModeOver){var i=t.editor.eventCoordinatesXY(e.pageX,e.pageY),o=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var n=navigator.userAgent;if(n.indexOf("MSIE")>=0){var r=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==r&&(o=r/100)}}1!==o&&(i.x=i.x/o,i.y=i.y/o);var a=t.editor.getCanvas().getAbstractShapesAtPosition(i);
if(0>=a.length&&e.helper)return t.dragCanContain=!1,!1;if(a[0]instanceof ORYX.Core.Canvas&&t.editor.getCanvas().setHightlightStateBasedOnX(i.x),1==a.length&&a[0]instanceof ORYX.Core.Canvas){var s=t.getStencilItemById(e.target.id),l=a[0];return"Lane"===s.id||"BoundaryErrorEvent"===s.id||"BoundaryMessageEvent"===s.id||"BoundarySignalEvent"===s.id||"BoundaryTimerEvent"===s.id||"BoundaryCancelEvent"===s.id||"BoundaryCompensationEvent"===s.id?(t.dragCanContain=!1,t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"shapeRepo.added",elements:[l],style:ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE,color:ORYX.CONFIG.SELECTION_INVALID_COLOR})):(t.dragCanContain=!0,t.dragCurrentParent=l,t.dragCurrentParentId=l.id,t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeRepo.added"})),t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeRepo.attached"}),!1}var s=t.getStencilItemById(e.target.id),l=a.reverse().find(function(e){return e instanceof ORYX.Core.Canvas||e instanceof ORYX.Core.Node||e instanceof ORYX.Core.Edge});if(!l)return t.dragCanContain=!1,!1;if("node"===s.type){var d=!1,c=l.getStencil().id();if(t.dragCurrentParentId&&t.dragCurrentParentId===l.id)return!1;var p=t.getStencilItemById(l.getStencil().idWithoutNs());if(p.roles.indexOf("Activity")>-1?s.roles.indexOf("IntermediateEventOnActivityBoundary")>-1&&(d=!0):"Pool"===l.getStencil().idWithoutNs()&&"Lane"===s.id&&(d=!0),d)t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"shapeRepo.attached",elements:[l],style:ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE,color:ORYX.CONFIG.SELECTION_VALID_COLOR}),t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeRepo.added"});else{for(var u=0;t.containmentRules.length>u;u++){var m=t.containmentRules[u];if(m.role===p.id){for(var h=0;m.contains.length>h;h++)if(s.roles.indexOf(m.contains[h])>-1){d=!0;break}if(d)break}}t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"shapeRepo.added",elements:[l],color:d?ORYX.CONFIG.SELECTION_VALID_COLOR:ORYX.CONFIG.SELECTION_INVALID_COLOR}),t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeRepo.attached"})}t.dragCurrentParent=l,t.dragCurrentParentId=l.id,t.dragCurrentParentStencil=c,t.dragCanContain=d}else{var f=t.editor.getCanvas(),g=!1,v=t.getStencilItemById(l.getStencil().idWithoutNs());if(v){var S=!1;"Association"!==stencil.idWithoutNs()||"TextAnnotation"!==curCan.getStencil().idWithoutNs()&&"BoundaryCompensationEvent"!==curCan.getStencil().idWithoutNs()?"DataAssociation"===stencil.idWithoutNs()&&"DataStore"===curCan.getStencil().idWithoutNs()&&(S=!0):S=!0,(v.canConnectTo||S)&&(g=!0)}t.dragCurrentParent=f,t.dragCurrentParentId=f.id,t.dragCurrentParentStencil=f.getStencil().id(),t.dragCanContain=g,t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"shapeRepo.added",elements:[f],color:ORYX.CONFIG.SELECTION_VALID_COLOR}),t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeRepo.attached"})}}},t.dragCallbackQuickMenu=function(e){if(0!=t.dragModeOver){var i=t.editor.eventCoordinatesXY(e.pageX,e.pageY),o=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var n=navigator.userAgent;if(n.indexOf("MSIE")>=0){var r=Math.round(100*(screen.deviceXDPI/screen.logicalXDPI));100!==r&&(o=r/100)}}1!==o&&(i.x=i.x/o,i.y=i.y/o);var a=t.editor.getCanvas().getAbstractShapesAtPosition(i);if(0>=a.length&&e.helper)return t.dragCanContain=!1,!1;a[0]instanceof ORYX.Core.Canvas&&t.editor.getCanvas().setHightlightStateBasedOnX(i.x);for(var s=void 0,l=t.editor.getStencilSets().values(),d=0;l.length>d;d++){for(var c=l[d],p=c.nodes(),u=0;p.length>u;u++)if(p[u].idWithoutNs()===e.target.id){s=p[u];break}if(!s)for(var m=c.edges(),u=0;m.length>u;u++)if(m[u].idWithoutNs()===e.target.id){s=m[u];break}}var h=a.last(),f=!1;if("node"===s.type()){var g=t.editor.getRules().canContain({containingShape:h,containedStencil:s}),v=a.reverse().find(function(e){return e instanceof ORYX.Core.Canvas||e instanceof ORYX.Core.Node||e instanceof ORYX.Core.Edge});if(!v)return t.dragCanContain=!1,!1;t.dragCurrentParent=v,t.dragCurrentParentId=v.id,t.dragCurrentParentStencil=v.getStencil().id(),t.dragCanContain=g,t.dropTargetElement=v,f=g}else{var S=t.editor.getSelection();if(S&&1==S.length){var I=S.first(),O=h,b=!1,E=t.getStencilItemById(O.getStencil().idWithoutNs());if(E){var y=!1;if("Association"!==s.idWithoutNs()||"TextAnnotation"!==O.getStencil().idWithoutNs()&&"BoundaryCompensationEvent"!==O.getStencil().idWithoutNs()?"DataAssociation"===s.idWithoutNs()&&"DataStore"===O.getStencil().idWithoutNs()&&(y=!0):y=!0,E.canConnectTo||y)for(;!b&&O&&!(O instanceof ORYX.Core.Canvas);)h=O,b=t.editor.getRules().canConnect({sourceShape:I,edgeStencil:s,targetShape:O}),O=O.parent}var v=t.editor.getCanvas();f=b,t.dragCurrentParent=v,t.dragCurrentParentId=v.id,t.dragCurrentParentStencil=v.getStencil().id(),t.dragCanContain=b,t.dropTargetElement=h}}t.editor.handleEvents({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"shapeMenu",elements:[h],color:f?ORYX.CONFIG.SELECTION_VALID_COLOR:ORYX.CONFIG.SELECTION_INVALID_COLOR})}}}]);var KISBPM=KISBPM||{};KISBPM.CreateCommand=ORYX.Core.Command.extend({construct:function(e,t,i,o){this.option=e,this.currentReference=t,this.position=i,this.facade=o,this.shape,this.edge,this.targetRefPos,this.sourceRefPos,this.connectedShape=e.connectedShape,this.connectingType=e.connectingType,this.namespace=e.namespace,this.type=e.type,this.containedStencil=e.containedStencil,this.parent=e.parent,this.currentReference=t,this.shapeOptions=e.shapeOptions},execute:function(){if(this.shape?this.shape instanceof ORYX.Core.Node?(this.parent.add(this.shape),this.edge&&(this.facade.getCanvas().add(this.edge),this.edge.dockers.first().setDockedShape(this.connectedShape),this.edge.dockers.first().setReferencePoint(this.sourceRefPos),this.edge.dockers.last().setDockedShape(this.shape),this.edge.dockers.last().setReferencePoint(this.targetRefPos)),this.facade.setSelection([this.shape])):this.shape instanceof ORYX.Core.Edge&&(this.facade.getCanvas().add(this.shape),this.shape.dockers.first().setDockedShape(this.connectedShape),this.shape.dockers.first().setReferencePoint(this.sourceRefPos)):(this.shape=this.facade.createShape(this.option),this.edge=this.shape instanceof ORYX.Core.Edge?void 0:this.shape.getIncomingShapes().first()),this.currentReference&&this.position)if(this.shape instanceof ORYX.Core.Edge){if(this.currentReference instanceof ORYX.Core.Canvas)this.shape.dockers.last().bounds.centerMoveTo(this.position);else if(this.shape.dockers.last().setDockedShape(this.currentReference),"TextAnnotation"===this.currentReference.getStencil().idWithoutNs()){var e={};e.x=0,e.y=this.currentReference.bounds.height()/2,this.shape.dockers.last().setReferencePoint(e)}else this.shape.dockers.last().setReferencePoint(this.currentReference.bounds.midPoint());this.sourceRefPos=this.shape.dockers.first().referencePoint,this.targetRefPos=this.shape.dockers.last().referencePoint}else this.edge&&(this.sourceRefPos=this.edge.dockers.first().referencePoint,this.targetRefPos=this.edge.dockers.last().referencePoint);else{var t=this.containedStencil,i=this.connectedShape,o=i.bounds,n=this.shape.bounds,r=o.center();"north"===t.defaultAlign()?r.y-=o.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET+n.height()/2:"northeast"===t.defaultAlign()?(r.x+=o.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+n.width()/2,r.y-=o.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+n.height()/2):"southeast"===t.defaultAlign()?(r.x+=o.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+n.width()/2,r.y+=o.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+n.height()/2):"south"===t.defaultAlign()?r.y+=o.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET+n.height()/2:"southwest"===t.defaultAlign()?(r.x-=o.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+n.width()/2,r.y+=o.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+n.height()/2):"west"===t.defaultAlign()?r.x-=o.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET+n.width()/2:"northwest"===t.defaultAlign()?(r.x-=o.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+n.width()/2,r.y-=o.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+n.height()/2):r.x+=o.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET+n.width()/2,this.shape.bounds.centerMoveTo(r),this.shape instanceof ORYX.Core.Node&&(this.shape.dockers||[]).each(function(e){e.bounds.centerMoveTo(r)}),this.position=r,this.edge&&(this.sourceRefPos=this.edge.dockers.first().referencePoint,this.targetRefPos=this.edge.dockers.last().referencePoint)}this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.facade.deleteShape(this.shape),this.edge&&this.facade.deleteShape(this.edge),this.facade.setSelection(this.facade.getSelection().without(this.shape,this.edge))}}),angular.module("activitiModeler").controller("ToolbarController",["$scope","$http","$modal","$q","$rootScope","$translate","$location","ModelService","ProcessScopeService",function(e,t,i,o,n,r,a,s,l){function d(){return{$scope:e,$rootScope:n,$http:t,$modal:i,$q:o,$translate:r,$location:a,ProcessScopeService:l,ModelService:s}}e.editorFactory.promise.then(function(){var t=KISBPM.TOOLBAR_CONFIG.items;e.items=[];for(var i=0;t.length>i;i++)"form"===n.modelData.model.modelType?t[i].disableInForm||e.items.push(t[i]):e.items.push(t[i])}),e.secondaryItems=KISBPM.TOOLBAR_CONFIG.secondaryItems;var c=function(e,t){for(var i=Array.prototype.slice.call(arguments).splice(2),o=e.split("."),n=o.pop(),r=0;o.length>r;r++)t=t[o[r]];return t[n].apply(this,i)};e.toolbarButtonClicked=function(t){var i=e.items[t],o=d();c(i.action,window,o);var n={type:KISBPM.eventBus.EVENT_TYPE_TOOLBAR_BUTTON_CLICKED,toolbarItem:i};KISBPM.eventBus.dispatch(n.type,n)},e.toolbarSecondaryButtonClicked=function(t){var i=e.secondaryItems[t],o=d();c(i.action,window,o)},Mousetrap.bind(["command+z","ctrl+z"],function(){var e=d();return KISBPM.TOOLBAR.ACTIONS.undo(e),!1}),Mousetrap.bind(["command+y","ctrl+y"],function(){var e=d();return KISBPM.TOOLBAR.ACTIONS.redo(e),!1}),Mousetrap.bind(["command+c","ctrl+c"],function(){var e=d();return KISBPM.TOOLBAR.ACTIONS.copy(e),!1}),Mousetrap.bind(["command+v","ctrl+v"],function(){var e=d();return KISBPM.TOOLBAR.ACTIONS.paste(e),!1}),Mousetrap.bind(["del"],function(){var e=d();return KISBPM.TOOLBAR.ACTIONS.deleteItem(e),!1}),e.undoStack=[],e.redoStack=[],e.editorFactory.promise.then(function(){e.editor.registerOnEvent(ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,function(t){if(t.commands){e.undoStack.push(t.commands),e.redoStack=[];for(var i=0;e.items.length>i;i++){var o=e.items[i];"KISBPM.TOOLBAR.ACTIONS.undo"===o.action?o.enabled=!0:"KISBPM.TOOLBAR.ACTIONS.redo"===o.action&&(o.enabled=!1)}e.editor.getCanvas().update(),e.editor.updateSelection()}})}),e.editorFactory.promise.then(function(){e.editor.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,function(t){for(var i=t.elements,o=0;e.items.length>o;o++){var n=e.items[o];if(n.enabledAction&&"element"===n.enabledAction){var r=1;n.minSelectionCount&&(r=n.minSelectionCount),i.length>=r&&!n.enabled?e.safeApply(function(){n.enabled=!0}):0==i.length&&n.enabled&&e.safeApply(function(){n.enabled=!1})}}})})}]),angular.module("activitiModeler").controller("HeaderController",["$rootScope","$scope","$http","$timeout",function(e,t){t.headerConfig=KISBPM.HEADER_CONFIG}]),angular.module("activitiModeler").controller("KisBpmShapeSelectionCtrl",["$rootScope","$scope","ProcessScopeService",function(e,t,i){t.currentSelectedMorph=void 0,t.availableMorphShapes=[];for(var o=0;t.morphShapes.length>o;o++)t.morphShapes[o].id!=t.currentSelectedShape.getStencil().idWithoutNs()&&t.availableMorphShapes.push(t.morphShapes[o]);t.gridOptions={data:t.availableMorphShapes,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"objectId",displayName:"Icon",width:50,cellTemplate:"editor-app/popups/icon-template.html?version="+Date.now()},{field:"name",displayName:"Name",cellTemplate:'<div class="ui-grid-cell-contents">{{"" + row.entity[col.field] | translate}}</div>'}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.currentSelectedMorph=e.isSelected?e.entity:void 0})},t.select=function(){if(t.currentSelectedMorph){var e=ORYX.Core.Command.extend({construct:function(e,t,i){this.shape=e,this.stencil=t,this.facade=i},execute:function(){var e=this.shape,t=this.stencil,o=e.resourceId,n=e.serialize();t.properties().each(function(e){e.readonly()&&(n=n.reject(function(t){return t.name==e.id()}))}.bind(this)),this.newShape?(newShape=this.newShape,this.facade.getCanvas().add(newShape)):newShape=this.facade.createShape({type:t.id(),namespace:t.namespace(),resourceId:o});var r=n.find(function(e){return"oryx"===e.prefix&&"bounds"===e.name}),a=null;if(this.facade.getRules().preserveBounds(e.getStencil())){var s=e.bounds.height(),l=e.bounds.width();newShape.minimumSize&&(e.bounds.height()<newShape.minimumSize.height&&(s=newShape.minimumSize.height),e.bounds.width()<newShape.minimumSize.width&&(l=newShape.minimumSize.width)),newShape.maximumSize&&(e.bounds.height()>newShape.maximumSize.height&&(s=newShape.maximumSize.height),e.bounds.width()>newShape.maximumSize.width&&(l=newShape.maximumSize.width)),a={a:{x:e.bounds.a.x,y:e.bounds.a.y},b:{x:e.bounds.a.x+l,y:e.bounds.a.y+s}}}else{var d=r.value.split(",");if(parseInt(d[0],10)>parseInt(d[2],10)){var c=d[0];d[0]=d[2],d[2]=c,c=d[1],d[1]=d[3],d[3]=c}d[2]=parseInt(d[0],10)+newShape.bounds.width(),d[3]=parseInt(d[1],10)+newShape.bounds.height(),r.value=d.join(",")}var p=e.bounds.center();null!==a&&newShape.bounds.set(a),this.setRelatedDockers(e,newShape);var u=e.node.parentNode,m=e.node.nextSibling;this.facade.deleteShape(e),newShape.deserialize(n),e.getStencil().property("oryx-bgcolor")&&e.properties["oryx-bgcolor"]&&e.getStencil().property("oryx-bgcolor").value().toUpperCase()==e.properties["oryx-bgcolor"].toUpperCase()&&newShape.getStencil().property("oryx-bgcolor")&&newShape.setProperty("oryx-bgcolor",newShape.getStencil().property("oryx-bgcolor").value()),null!==a&&newShape.bounds.set(a),"edge"!==newShape.getStencil().type()&&0!=newShape.dockers.length&&newShape.dockers[0].getDockedShape()||newShape.bounds.centerMoveTo(p),"node"!==newShape.getStencil().type()||0!=newShape.dockers.length&&newShape.dockers[0].getDockedShape()||this.setRelatedDockers(newShape,newShape),m?u.insertBefore(newShape.node,m):u.appendChild(newShape.node),this.facade.setSelection([newShape]),this.facade.getCanvas().update(),this.facade.updateSelection(),this.newShape=newShape,i.refresh()},rollback:function(){this.shape&&this.newShape&&this.newShape.parent&&(this.newShape.parent.add(this.shape),this.setRelatedDockers(this.newShape,this.shape),this.facade.deleteShape(this.newShape),this.facade.setSelection([this.shape]),this.facade.getCanvas().update(),this.facade.updateSelection(),i.refresh())},setRelatedDockers:function(e,t){"node"===e.getStencil().type()?((e.incoming||[]).concat(e.outgoing||[]).each(function(i){i.dockers.each(function(o){if(o.getDockedShape()==e){var n=Object.clone(o.referencePoint),r={x:n.x*t.bounds.width()/e.bounds.width(),y:n.y*t.bounds.height()/e.bounds.height()};if(o.setDockedShape(t),o.setReferencePoint(r),i instanceof ORYX.Core.Edge)o.bounds.centerMoveTo(r);else{var a=e.absoluteXY();o.bounds.centerMoveTo({x:r.x+a.x,y:r.y+a.y})}}})}),e.dockers.length>0&&e.dockers.first().getDockedShape()&&(t.dockers.first().setDockedShape(e.dockers.first().getDockedShape()),t.dockers.first().setReferencePoint(Object.clone(e.dockers.first().referencePoint)))):(t.dockers.first().setDockedShape(e.dockers.first().getDockedShape()),t.dockers.first().setReferencePoint(e.dockers.first().referencePoint),t.dockers.last().setDockedShape(e.dockers.last().getDockedShape()),t.dockers.last().setReferencePoint(e.dockers.last().referencePoint))}}),o=void 0,n=t.editor.getStencilSets().values(),r=t.currentSelectedMorph.id;t.currentSelectedMorph.genericTaskId&&(r=t.currentSelectedMorph.genericTaskId);for(var a=0;n.length>a;a++)for(var s=n[a],l=s.nodes(),d=0;l.length>d;d++)if(l[d].idWithoutNs()===r){o=l[d];break}if(!o)return;var c=new e(t.currentSelectedShape,o,t.editor);t.editor.executeCommands([c])}t.close()},t.cancel=function(){t.$hide()},t.close=function(){t.$hide()}}]);var KisBpmDefineDataCtrl=["$rootScope","$scope","dialog","$timeout","$translate",function(e,t,i,o){t.definedDataItems=[],t.selectedDataItems=[],t.gridOptions={data:"definedDataItems",enableRowSelection:!0,headerRowHeight:28,multiSelect:!1,keepLastSelected:!1,selectedItems:t.selectedDataItems,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:"Name"},{field:"value",displayName:"Value"}]},t.addNewDataItem=function(){t.definedDataItems.push({name:"",value:""})},t.removeDataItem=function(){if(t.selectedDataItems.length>0){var e=t.definedDataItems.indexOf(t.selectedDataItems[0]);t.gridOptions.selectItem(e,!1),t.definedDataItems.splice(e,1),t.selectedDataItems.length=0,t.definedDataItems.length>e?t.gridOptions.selectItem(e+1,!0):t.definedDataItems.length>0&&t.gridOptions.selectItem(e-1,!0)}},t.moveDataItemUp=function(){if(t.selectedParameters.length>0){var e=t.definedDataItems.indexOf(t.selectedDataItems[0]);if(0!=e){var i=t.definedDataItems[e];t.definedDataItems.splice(e,1),o(function(){t.definedDataItems.splice(e+-1,0,i)},100)}}},t.moveDataItemDown=function(){if(t.selectedParameters.length>0){var e=t.definedDataItems.indexOf(t.selectedDataItems[0]);if(e!=t.definedDataItems.length-1){var i=t.definedDataItems[e];t.definedDataItems.splice(e,1),o(function(){t.definedDataItems.splice(e+1,0,i)},100)}}},t.save=function(){i.close()},t.cancel=function(){i.close()},t.close=function(){i.close()}}];angular.module("activitiModeler").controller("KisBpmValidationPopupCtrl",["$rootScope","$scope","$timeout","$translate",function(e,t,i,o){"use strict";t.shapeValidationErrors=[];for(var n=0;e.validationErrors.length>n;n++)if(e.isOnProcessLevel&&!e.validationErrors[n].id||e.isOnProcessLevel===!1&&(e.validationErrors[n].id===t.currentValidationId||e.validationErrors[n].id===t.originalValidationId)){var r=e.validationErrors[n];if(r.problem){var a=r.problem.toUpperCase(),s=o.instant("ERRORS."+a);s!=="ERRORS."+a&&(r.defaultDescription=s)}t.shapeValidationErrors.push(r)}t.gridOptions={data:t.shapeValidationErrors,headerRowHeight:28,enableRowSelection:!1,enableCellSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"defaultDescription",displayName:o.instant("MODEL.VALIDATION.ERRORS.DESCRIPTION"),cellTemplate:'<div class="ui-grid-cell-contents" style="white-space: nowrap; text-overflow: ellipsis; overflow: hidden;" title="{{row.entity[col.field]}}">{{row.entity[col.field]}}</div>'},{field:"warning",displayName:o.instant("MODEL.VALIDATION.ERRORS.WARNING"),width:100},{field:"validatorSetName",displayName:o.instant("MODEL.VALIDATION.ERRORS.SET"),width:200}]},t.ok=function(){t.$hide()},t.close=function(){t.$hide()}}]);var ACTIVITI_EDITOR_TOUR={gettingStarted:function(e,t,i,o){var n;n=e.account.firstName?e.account.firstName:e.account.fullname,i.all([t("TOUR.WELCOME-TITLE",{userName:n}),t("TOUR.WELCOME-CONTENT"),t("TOUR.PALETTE-TITLE"),t("TOUR.PALETTE-CONTENT"),t("TOUR.CANVAS-TITLE"),t("TOUR.CANVAS-CONTENT"),t("TOUR.DRAGDROP-TITLE"),t("TOUR.DRAGDROP-CONTENT"),t("TOUR.PROPERTIES-TITLE"),t("TOUR.PROPERTIES-CONTENT"),t("TOUR.TOOLBAR-TITLE"),t("TOUR.TOOLBAR-CONTENT"),t("TOUR.END-TITLE"),t("TOUR.END-CONTENT")]).then(function(e){var i=["body","#paletteHelpWrapper","#canvasHelpWrapper","#propertiesHelpWrapper","#editor-header"],n=new Tour({name:"activitiEditorTour",storage:o?window.localStorage:!1,container:"body",backdrop:!0,keyboard:!0,steps:[{orphan:!0,title:e[0],content:e[1],template:ACTIVITI_EDITOR_TOUR._buildStepTemplate(t,!1,!0,!1,300),onNext:ACTIVITI_EDITOR_TOUR._buildOnNextFunction(i[0])},{element:i[1],title:e[2],content:e[3],template:ACTIVITI_EDITOR_TOUR._buildStepTemplate(t,!1,!0,!1,400,"images/tour/open-group.gif"),onNext:ACTIVITI_EDITOR_TOUR._buildOnNextFunction(i[1])},{element:i[2],title:e[4],content:e[5],placement:"left",template:ACTIVITI_EDITOR_TOUR._buildStepTemplate(t,!1,!0,!1),onNext:ACTIVITI_EDITOR_TOUR._buildOnNextFunction(i[2])},{orphan:!0,title:e[6],content:e[7],template:ACTIVITI_EDITOR_TOUR._buildStepTemplate(t,!1,!0,!1,720,"images/tour/tour-dnd.gif"),onNext:ACTIVITI_EDITOR_TOUR._buildOnNextFunction(i[0])},{element:i[3],title:e[8],content:e[9],placement:"top",template:ACTIVITI_EDITOR_TOUR._buildStepTemplate(t,!1,!0,!1,400),onNext:ACTIVITI_EDITOR_TOUR._buildOnNextFunction(i[3])},{element:i[4],title:e[10],content:e[11],placement:"bottom",template:ACTIVITI_EDITOR_TOUR._buildStepTemplate(t,!1,!0,!1,400),onNext:ACTIVITI_EDITOR_TOUR._buildOnNextFunction(i[4])},{orphan:!0,title:e[12],content:e[13],template:ACTIVITI_EDITOR_TOUR._buildStepTemplate(t,!1,!1,!0,400),onNext:ACTIVITI_EDITOR_TOUR._buildOnNextFunction(i[0])}],onEnd:ACTIVITI_EDITOR_TOUR._buildOnEndFunction(i)});n.init(),n.start()})},sequenceFlowBendpoint:function(e,t,i,o){i.all([t("FEATURE-TOUR.BENDPOINT.TITLE"),t("FEATURE-TOUR.BENDPOINT.DESCRIPTION")]).then(function(e){var i=["body"],n=new Tour({name:"bendpointTour",storage:o?window.localStorage:!1,container:"body",backdrop:!0,keyboard:!0,steps:[{orphan:!0,title:e[0],content:e[1],template:ACTIVITI_EDITOR_TOUR._buildStepTemplate(t,!1,!1,!0,500,"images/tour/sequenceflow-bendpoint.gif"),onNext:ACTIVITI_EDITOR_TOUR._buildOnNextFunction(i[0])}],onEnd:ACTIVITI_EDITOR_TOUR._buildOnEndFunction(i)});n.init(),n.start()})},_buildStepTemplate:function(e,t,i,o,n,r){var a=200;n&&(a=n);var s="<div class='popover tour' style='max-width:"+a+"px'>"+"<div class='arrow'></div>"+"<h3 class='popover-title'></h3>"+"<div class='popover-content'></div>"+"<div class='popover-navigation'>";return r&&(s=s+"<div><img src='"+r+"' style='border 1px solid black;margin:5px 0 5px 0;'></img></div>"),t&&(s=s+"<button class='btn btn-sm btn-default ' data-role='prev'>"+e.instant("TOUR.PREVIOUS-BUTTON")+"</button>"),i&&(s=s+"<button class='btn btn-sm btn-default' data-role='next' style='float:right'\">"+e.instant("TOUR.NEXT-BUTTON")+"</button>"),o&&(s=s+"<button class='btn btn-warning btn-sm' data-role='end' style='float:right'\">"+e.instant("TOUR.END-TOUR-BUTTON")+"</button>"),s=s+"</div>"+"</nav>"+"</div>"},_buildOnNextFunction:function(e){return function(){jQuery(e).each(function(e,t){t.style.display="block"})}},_buildOnEndFunction:function(e){return function(){for(var t=0;e.length>t;t++)jQuery(e[t]).each(function(e,t){t.style.display="block"})}}};angular.module("activitiModeler").service("EditorScopeService",["$routeParams",function(e){this.collectShapes=function(e,t){var i=[];if(e&&e.length>0)for(var o=0;e.length>o;o++)this._visitShapeAndCollectShape(e[o],t,i);return i},this.collectSortedElementsFromPrecedingElements=function(e){var t=[],i=[];t.push(e.id);var o=e.getStencil().id();o&&i.push(e);var n=e.getIncomingShapes();if(n)for(var r=0;n.length>r;r++){var a=n[r];0>t.indexOf(a.id)&&this._visitElementAndCollectAllElement(a,t,i)}return i.reverse()},this._visitShapeAndCollectShape=function(e,t,i){if(e.childShapes&&e.childShapes.length>0)for(var o=0;e.childShapes.length>o;o++)this._visitShapeAndCollectShape(e.childShapes[o],t,i);e.stencil&&e.stencil.id===t&&i.push(e)},this._visitElementAndCollectProperty=function(e,t,i,o){i.push(e.id);var n=e.properties[t];n&&o.push(n);var r=e.getIncomingShapes();if(r)for(var a=0;r.length>a;a++){var s=r[a];0>i.indexOf(s.id)&&this._visitElementAndCollectProperty(s,t,i,o)}var l=e.getChildShapes();if(l)for(var a=0;l.length>a;a++){var d=l[a];0>i.indexOf(d.id)&&this._visitElementAndCollectProperty(d,t,i,o)}},this._visitElementAndCollectElement=function(e,t,i,o){i.push(e.id);var n=e.getStencil().id();n&&n.indexOf(t)>=0&&o.push(e);var r=e.getIncomingShapes();if(r)for(var a=0;r.length>a;a++){var s=r[a];0>i.indexOf(s.id)&&this._visitElementAndCollectElement(s,t,i,o)}var l=e.getChildShapes();if(l)for(var a=0;l.length>a;a++){var d=l[a];0>i.indexOf(d.id)&&this._visitElementAndCollectElement(d,t,i,o)}},this._visitElementAndCollectAllElement=function(e,t,i){t.push(e.id);var o=e.getStencil().id();o&&i.push(e);var n=e.getIncomingShapes();if(n)for(var r=0;n.length>r;r++){var a=n[r];0>t.indexOf(a.id)&&this._visitElementAndCollectAllElement(a,t,i)}var s=e.getChildShapes();if(s)for(var r=0;s.length>r;r++){var l=s[r];0>t.indexOf(l.id)&&this._visitElementAndCollectAllElement(l,t,i)}var d=e.getParentShape();if(d)try{var c=d.getIncomingShapes();if(c)for(var r=0;c.length>r;r++){var p=c[r];0>t.indexOf(p.id)&&this._visitElementAndCollectAllElement(p,t,i)}}catch(u){}},this._getPropertyFromParent=function(e,t){var i=e.properties[t];return i?i:e.parent?this._getPropertyFromParent(e.parent,t):void 0},this.getOutgoingElements=function(e,t,i,o){if(e&&t)if(e.outgoing&&e.outgoing.length>0)for(var n=0;e.outgoing.length>n;n++)o&&this._elementIsStep(e)?(e.id=e.resourceId,i.push(e)):o||(e.id=e.resourceId,i.push(e)),this.getOutgoingElements(t[e.outgoing[n].resourceId],t,i);else o&&this._elementIsStep(e)?(e.id=e.resourceId,i.push(e)):o||(e.id=e.resourceId,i.push(e))},this._elementIsStep=function(e){var t=!1;return e&&e.stencil&&"SequenceFlow"!==e.stencil.id&&(t=!0),t},this.getCurrentProcessModelId=function(){for(var t=1;null!=e["processModelId"+t]&&void 0!=e["processModelId"+t];)t++;return t-=1,e["processModelId"+t]}}]);var KISBPM=KISBPM||{};KISBPM.TOOLBAR={ACTIONS:{showValidation:function(e,t){var i={type:KISBPM.eventBus.EVENT_TYPE_SHOW_VALIDATION_POPUP,validationId:e,onProcessLevel:t};KISBPM.eventBus.dispatch(KISBPM.eventBus.EVENT_TYPE_SHOW_VALIDATION_POPUP,i)},saveModel:function(e){_internalCreateModal({backdrop:!0,keyboard:!0,template:"editor-app/popups/save-model.html?version="+Date.now(),scope:e.$scope},e.$modal,e.$scope)},validateModel:function(e){var t=e.$scope,i=t.editor.getModelMetaData(),o=t.editor.getJSON();o=JSON.stringify(o);var n={modeltype:i.model.modelType,json_xml:o,name:"model",parentProcessScopeIdentifiers:JSON.stringify(e.ProcessScopeService.getParentIdentifiers())};e.ModelService.validateModelJson(i,n).success(function(t){return e.$rootScope.hideValidationIcons(!0),0==t.length?(e.$rootScope.validationErrors=[],e.$rootScope.addAlertPromise(e.$translate("MODELER.ALERT.VALIDATION-OK"),"info"),void 0):(e.$rootScope.validationErrors=t,e.$rootScope.addAlertPromise(e.$translate("MODELER.ALERT.VALIDATION-ERROR"),"error"),e.$rootScope.showValidationIcons(),void 0)}).error(function(e){console.log("Error while validating model:"+JSON.stringify(e))})},undo:function(e){var t=e.$scope.undoStack.pop();if(t){e.$scope.redoStack.push(t),e.$rootScope&&e.$rootScope.forceSelectionRefresh&&(e.$rootScope.forceSelectionRefresh=!0);for(var i=t.length-1;i>=0;--i)t[i].rollback();e.$scope.editor.handleEvents({type:ORYX.CONFIG.EVENT_UNDO_ROLLBACK,commands:t}),e.$scope.editor.getCanvas().update(),e.$scope.editor.updateSelection(),e.$rootScope.showValidationIcons()}var o=!1;0==e.$scope.undoStack.length&&(o=!0);var n=!1;if(e.$scope.redoStack.length>0&&(n=!0),o||n)for(var i=0;e.$scope.items.length>i;i++){var r=e.$scope.items[i];o&&"KISBPM.TOOLBAR.ACTIONS.undo"===r.action?e.$scope.safeApply(function(){r.enabled=!1}):n&&"KISBPM.TOOLBAR.ACTIONS.redo"===r.action&&e.$scope.safeApply(function(){r.enabled=!0})}},redo:function(e){var t=e.$scope.redoStack.pop();t&&(e.$scope.undoStack.push(t),e.$rootScope&&e.$rootScope.forceSelectionRefresh&&(e.$rootScope.forceSelectionRefresh=!0),t.each(function(e){e.execute()}),e.$scope.editor.handleEvents({type:ORYX.CONFIG.EVENT_UNDO_EXECUTE,commands:t}),e.$scope.editor.getCanvas().update(),e.$scope.editor.updateSelection(),e.$rootScope.showValidationIcons());var i=!1;e.$scope.undoStack.length>0&&(i=!0);var o=!1;if(0==e.$scope.redoStack.length&&(o=!0),i||o)for(var n=0;e.$scope.items.length>n;n++){var r=e.$scope.items[n];i&&"KISBPM.TOOLBAR.ACTIONS.undo"===r.action?e.$scope.safeApply(function(){r.enabled=!0}):o&&"KISBPM.TOOLBAR.ACTIONS.redo"===r.action&&e.$scope.safeApply(function(){r.enabled=!1})}},cut:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxEditPlugin(e.$scope).editCut();for(var t=0;e.$scope.items.length>t;t++){var i=e.$scope.items[t];"KISBPM.TOOLBAR.ACTIONS.paste"===i.action&&e.$scope.safeApply(function(){i.enabled=!0})}},copy:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxEditPlugin(e.$scope).editCopy();for(var t=0;e.$scope.items.length>t;t++){var i=e.$scope.items[t];"KISBPM.TOOLBAR.ACTIONS.paste"===i.action&&e.$scope.safeApply(function(){i.enabled=!0})}},paste:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxEditPlugin(e.$scope).editPaste()},deleteItem:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxEditPlugin(e.$scope).editDelete()},addBendPoint:function(e){ACTIVITI_EDITOR_TOUR.sequenceFlowBendpoint(e.$scope,e.$translate,e.$q,!0);var t=KISBPM.TOOLBAR.ACTIONS._getOryxDockerPlugin(e.$scope),i=!t.enabledAdd();t.setEnableAdd(i),i?(t.setEnableRemove(!1),document.body.style.cursor="pointer"):document.body.style.cursor="default"},removeBendPoint:function(e){ACTIVITI_EDITOR_TOUR.sequenceFlowBendpoint(e.$scope,e.$translate,e.$q,!0);var t=KISBPM.TOOLBAR.ACTIONS._getOryxDockerPlugin(e.$scope),i=!t.enabledRemove();t.setEnableRemove(i),i?(t.setEnableAdd(!1),document.body.style.cursor="pointer"):document.body.style.cursor="default"},_getOryxEditPlugin:function(e){return(void 0===e.oryxEditPlugin||null===e.oryxEditPlugin)&&(e.oryxEditPlugin=new ORYX.Plugins.Edit(e.editor)),e.oryxEditPlugin},zoomIn:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxViewPlugin(e.$scope).zoom([1+ORYX.CONFIG.ZOOM_OFFSET])},zoomOut:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxViewPlugin(e.$scope).zoom([1-ORYX.CONFIG.ZOOM_OFFSET])},zoomActual:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxViewPlugin(e.$scope).setAFixZoomLevel(1)},zoomFit:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxViewPlugin(e.$scope).zoomFitToModel()},alignVertical:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxArrangmentPlugin(e.$scope).alignShapes([ORYX.CONFIG.EDITOR_ALIGN_MIDDLE])},alignHorizontal:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxArrangmentPlugin(e.$scope).alignShapes([ORYX.CONFIG.EDITOR_ALIGN_CENTER])},sameSize:function(e){KISBPM.TOOLBAR.ACTIONS._getOryxArrangmentPlugin(e.$scope).alignShapes([ORYX.CONFIG.EDITOR_ALIGN_SIZE])},help:function(e){ACTIVITI_EDITOR_TOUR.gettingStarted(e.$scope,e.$translate,e.$q)},feedback:function(e){var t={template:"editor-app/configuration/properties/feedback-popup.html?version="+Date.now(),scope:e.$scope};_internalCreateModal(t,e.$modal,e.scope)},_getOryxViewPlugin:function(e){return(void 0===e.oryxViewPlugin||null===e.oryxViewPlugin)&&(e.oryxViewPlugin=new ORYX.Plugins.View(e.editor)),e.oryxViewPlugin},_getOryxArrangmentPlugin:function(e){return(void 0===e.oryxArrangmentPlugin||null===e.oryxArrangmentPlugin)&&(e.oryxArrangmentPlugin=new ORYX.Plugins.Arrangement(e.editor)),e.oryxArrangmentPlugin},_getOryxDockerPlugin:function(e){return(void 0===e.oryxDockerPlugin||null===e.oryxDockerPlugin)&&(e.oryxDockerPlugin=new ORYX.Plugins.AddDocker(e.editor)),e.oryxDockerPlugin}}},angular.module("activitiModeler").controller("SaveModelCtrl",["$rootScope","$scope","$http","$route","ModelService","ProcessScopeService",function(e,t,i,o,n,r){var a=t.editor.getModelMetaData(),s="";a.description&&(s=a.description),t.saveDialog={name:a.name,description:s,newVersion:!1,comment:"",validationErrors:!1,embedded:e.parentReferenceId!==void 0&&e.currentProcessModel.referenceId?!0:!1,hasEmbedContext:e.parentReferenceId!==void 0},t.oldParentId=0;var l=t.editor.getJSON();l=JSON.stringify(l);var d={modeltype:a.model.modelType,json_xml:l,name:"model",parentProcessScopeIdentifiers:JSON.stringify(r.getParentIdentifiers())};n.validateModelJson(a,d).success(function(i){return e.hideValidationIcons(!0),0==i.length?(e.validationErrors=[],void 0):(e.validationErrors=i,t.saveDialog.validationErrors=!0,e.showValidationIcons(),void 0)
}).error(function(e){console.log("Error while validating model:"+JSON.stringify(e))}),t.status={loading:!1},t.close=function(){t.$hide()},t.saveAndClose=function(){t.save(function(){r.navigateBack("/processes")})},t.save=function(i){if(t.saveDialog.name&&0!=t.saveDialog.name.length){t.status={loading:!0},e.hideValidationIcons(!0),a.name=t.saveDialog.name,a.description=t.saveDialog.description;var o=t.editor.getJSON();o=JSON.stringify(o);var r={modeltype:a.model.modelType,json_xml:o,name:t.saveDialog.name,description:t.saveDialog.description,newversion:t.saveDialog.newVersion,comment:t.saveDialog.comment,lastUpdated:a.lastUpdated};t.error&&t.error.isConflict&&(r.conflictResolveAction=t.error.conflictResolveAction,"saveAs"===t.error.conflictResolveAction&&(r.saveAs=t.error.saveAs));var s=function(){return t.saveDialog.embedded},l=function(){return s()?e.parentReferenceId:null},d=function(e){return e.length},c=function(o){t.editor.handleEvents({type:ORYX.CONFIG.EVENT_SAVED}),t.modelData.name=t.saveDialog.name,t.modelData.lastUpdated=o.lastUpdated,e.showValidationIcons(),t.status.loading=!1,t.$hide();var n={type:KISBPM.eventBus.EVENT_TYPE_MODEL_SAVED,model:r,modelId:a.modelId,eventType:"update-model"};KISBPM.eventBus.dispatch(KISBPM.eventBus.EVENT_TYPE_MODEL_SAVED,n),t.error=void 0,t.status.loading=!1,i&&i()},p=function(e,i){t.error={},409==i?(t.error.isConflict=!0,t.error.userFullName=e.customData.userFullName,t.error.isNewVersionAllowed=e.customData.newVersionAllowed,t.error.saveAs=a.name+"_2",t.error.conflictResolveAction="overwrite"):console.log("Something went wrong when updating the process model:"+JSON.stringify(e)),t.status.loading=!1};n.getModelParentRelations(a.modelId).then(function(i){var o={id:a.modelId,name:a.name,description:a.description},u={name:t.saveDialog.name,description:t.saveDialog.description,referenceId:l(),modelType:0,stencilSet:a.stencilSetId};s()&&d(i)>1?n.cloneModel(o,u).then(function(i){t.oldParentId=a.modelId,a.modelId=i.id;var o=t.editor.getJSON();o.resourceId=i.id,r.json_xml=JSON.stringify(o),r.lastUpdated=i.lastUpdated,n.updateFormReferencesInProcess(e.parentReferenceId,t.oldParentId,i.id).then(function(){n.saveModelJson(a,r).success(c).error(p)})},p):n.saveModel(o,u).then(function(){e.currentProcessModel.referenceId=+l(),n.saveModelJson(a,r).success(c).error(p)},p)},p)}},t.isOkButtonDisabled=function(){return t.status.loading?!1:t.error&&t.error.conflictResolveAction?"saveAs"===t.error.conflictResolveAction?!t.error.saveAs||0==t.error.saveAs.length:!1:!0},t.okClicked=function(){t.error&&("discardChanges"===t.error.conflictResolveAction?(t.close(),o.reload()):"overwrite"===t.error.conflictResolveAction||"newVersion"===t.error.conflictResolveAction?t.save():"saveAs"===t.error.conflictResolveAction&&t.save(function(){e.ignoreChanges=!0,r.navigateBack("/processes")}))},t.embedClicked=function(){t.saveDialog.embedded?n.getModelParentRelations(a.modelId).then(function(e){t.hasOtherRelations=e.length>1},function(){e.addAlert("An error occurred while trying to find the relations")}):t.hasOtherRelations=!1}}]),angular.module("activitiModeler").controller("BpmnFeedbackPopupCtrl",["$scope","$http",function(e,t){e.model={feedback:""},e.send=function(){var i=e.editor.getModelMetaData(),o={modelId:i.modelId,feedback:e.model.feedback};t({method:"POST",data:o,headers:{Accept:"application/json"},url:KISBPM.URL.postFeedback()}),e.$hide()},e.cancel=function(){e.$hide()}}]),angular.module("activitiModeler").controller("KisBpmStringPropertyCtrl",["$scope",function(e){e.shapeId=e.selectedShape.id,e.valueFlushed=!1,e.inputBlurred=function(){e.valueFlushed=!0,e.property.value&&(e.property.value=e.property.value.replace(/(<([^>]+)>)/gi,"")),e.updatePropertyInModel(e.property)},e.enterPressed=function(t){t&&13===t.which&&(t.preventDefault(),e.inputBlurred())},e.$on("$destroy",function(){e.valueFlushed||(e.property.value&&(e.property.value=e.property.value.replace(/(<([^>]+)>)/gi,"")),e.updatePropertyInModel(e.property,e.shapeId))})}]),angular.module("activitiModeler").controller("KisBpmBooleanPropertyCtrl",["$scope",function(e){e.changeValue=function(){if("oryx-defaultflow"===e.property.key&&e.property.value){var t=e.selectedShape;if(t){var i=t.getIncomingShapes();if(i&&i.length>0){var o=i[0],n=o.getOutgoingShapes();if(n&&n.length>1)for(var r=0;n.length>r;r++)if(n[r].resourceId!=t.resourceId){var a=n[r].properties["oryx-defaultflow"];a&&n[r].setProperty("oryx-defaultflow",!1,!0)}}}}e.updatePropertyInModel(e.property)}}]),angular.module("activitiModeler").controller("KisBpmTextPropertyPopupCtrl",["$scope",function(e){e.propertyValue=angular.copy(e.property.value),e.save=function(){e.property.value=e.propertyValue,e.updatePropertyInModel(e.property),e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("BpmnScriptTextPropertyPopupCtrl",["$scope","$timeout","EditorScopeService",function(e,t){e.propertyValue=angular.copy(e.property.value),e.save=function(){e.property.value=e.propertyValue,e.updatePropertyInModel(e.property),e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()},e.aceLoaded=function(e){t(function(){e.focus()})}}]),angular.module("activitiModeler").controller("BpmnCustomVariablePropertyPopupCtrl",["$scope","$timeout","FormBuilderService","VariableUtilService",function(e){e.popup={valueType:"static"},void 0!=e.property.value&&null!=e.property.value&&(e.property.value.valueType&&e.property.value.valueType.length>0&&(e.popup.valueType=e.property.value.valueType),e.property.value.staticValue&&e.property.value.staticValue.length>0?e.popup.staticValue=e.property.value.staticValue:e.property.value.formField&&e.property.value.formField.id?e.popup.formField=e.property.value.formField:e.property.value.variableField&&e.property.value.variableField.id&&(e.popup.variableField=e.property.value.variableField)),e.allSteps=EditorScopeService.collectSortedElementsFromPrecedingElements(e.selectedShape),e.setStaticValue=function(){e.popup.valueType="static",e.popup.formField=void 0,e.popup.variableField=void 0},e.setFormFieldValue=function(){e.popup.valueType="field",e.popup.staticValue=void 0,e.popup.variableField=void 0},e.setVariableValue=function(){e.popup.valueType="variable",e.popup.staticValue=void 0,e.popup.formField=void 0},e.save=function(){var t={valueType:e.popup.valueType,staticValue:e.popup.staticValue,formField:e.popup.formField,variableField:e.popup.variableField};e.property.value=t,e.updatePropertyInModel(e.property),e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("KisBpmExecutionListenersPopupCtrl",["$scope","$q","$translate","$timeout",function(e,t,i,o){if(void 0!==e.property.value&&null!==e.property.value&&void 0!==e.property.value.executionListeners&&null!==e.property.value.executionListeners){e.executionListeners=e.property.value.executionListeners.constructor==String?JSON.parse(e.property.value.executionListeners):angular.copy(e.property.value.executionListeners);for(var n=0;e.executionListeners.length>n;n++){var r=e.executionListeners[n];void 0!==r.className&&""!==r.className?r.implementation=r.className:void 0!==r.expression&&""!==r.expression?r.implementation=r.expression:void 0!==r.delegateExpression&&""!==r.delegateExpression&&(r.implementation=r.delegateExpression)}}else e.executionListeners=[];e.selectedListener=void 0,e.selectedField=void 0,e.fields=[],e.translationsRetrieved=!1,e.labels={},t.all([i("PROPERTY.EXECUTIONLISTENERS.EVENT"),i("PROPERTY.EXECUTIONLISTENERS.FIELDS.IMPLEMENTATION"),i("PROPERTY.EXECUTIONLISTENERS.FIELDS.NAME")]).then(function(t){e.labels.eventLabel=t[0],e.labels.implementationLabel=t[1],e.labels.nameLabel=t[2],e.translationsRetrieved=!0,e.gridOptions={data:e.executionListeners,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"event",displayName:e.labels.eventLabel,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getExecutionListenerEventsTranslated(row.entity)}}</div>'},{field:"implementation",displayName:e.labels.implementationLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){if(e.selectedListener=t.entity,e.selectedField=void 0,e.selectedListener){var i=e.selectedListener.fields;if(void 0!==i&&null!==i)for(var o=0;i.length>o;o++){var n=i[o];void 0!==n.stringValue&&""!==n.stringValue?n.implementation=n.stringValue:void 0!==n.expression&&""!==n.expression?n.implementation=n.expression:void 0!==n.string&&""!==n.string&&(n.implementation=n.string)}else e.selectedListener.fields=[];e.fields.length=0;for(var o=0;e.selectedListener.fields.length>o;o++)e.fields.push(e.selectedListener.fields[o])}})},e.gridFieldOptions={data:e.fields,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:e.labels.nameLabel},{field:"implementation",displayName:e.labels.implementationLabel}]},e.gridFieldOptions.onRegisterApi=function(t){e.fieldGridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedField=t.entity})}}),e.listenerDetailsChanged=function(){e.selectedListener.implementation=""!==e.selectedListener.className?e.selectedListener.className:""!==e.selectedListener.expression?e.selectedListener.expression:""!==e.selectedListener.delegateExpression?e.selectedListener.delegateExpression:""},e.addNewListener=function(){var t={event:"start",implementation:"",className:"",expression:"",delegateExpression:""};e.executionListeners.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeListener=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.executionListeners.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.executionListeners.splice(i,1),0==e.executionListeners.length&&(e.selectedListener=void 0),o(function(){e.executionListeners.length>0&&e.gridApi.selection.toggleRowSelection(e.executionListeners[0])})}},e.moveListenerUp=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.executionListeners.indexOf(t[0]);if(0!=i){var n=e.executionListeners[i];e.executionListeners.splice(i,1),o(function(){e.executionListeners.splice(i+-1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.moveListenerDown=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.executionListeners.indexOf(t[0]);if(i!=e.executionListeners.length-1){var n=e.executionListeners[i];e.executionListeners.splice(i,1),o(function(){e.executionListeners.splice(i+1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.fieldDetailsChanged=function(){e.selectedField.implementation=""!=e.selectedField.stringValue?e.selectedField.stringValue:""!=e.selectedField.expression?e.selectedField.expression:""!=e.selectedField.string?e.selectedField.string:""},e.addNewField=function(){if(e.selectedListener){void 0==e.selectedListener.fields&&(e.selectedListener.fields=[]);var t={name:"",implementation:"",stringValue:"",expression:"",string:""};e.fields.push(t),e.selectedListener.fields.push(t),o(function(){e.fieldGridApi.selection.toggleRowSelection(t)})}},e.removeField=function(){var t=e.fieldGridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.fields.indexOf(t[0]);e.fieldGridApi.selection.toggleRowSelection(t[0]),e.fields.splice(i,1),e.selectedListener.fields.splice(i,1),0==e.fields.length&&(e.selectedField=void 0),o(function(){e.fields.length>0&&e.fieldGridApi.selection.toggleRowSelection(e.fields[0])})}},e.moveFieldUp=function(){var t=e.fieldGridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.fields.indexOf(t[0]);if(0!=i){var n=e.fields[i];e.fields.splice(i,1),e.selectedListener.fields.splice(i,1),o(function(){e.fields.splice(i+-1,0,n),e.selectedListener.fields.splice(i+-1,0,n),o(function(){e.fieldGridApi.selection.toggleRowSelection(n)})})}}},e.moveFieldDown=function(){var t=e.fieldGridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.fields.indexOf(t[0]);if(i!=e.fields.length-1){var n=e.fields[i];e.fields.splice(i,1),e.selectedListener.fields.splice(i,1),o(function(){e.fields.splice(i+1,0,n),e.selectedListener.fields.splice(i+1,0,n),o(function(){e.fieldGridApi.selection.toggleRowSelection(n)})})}}},e.save=function(){e.executionListeners.length>0?(e.property.value={},e.property.value.executionListeners=e.executionListeners):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.$hide(),e.property.mode="read"},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.$hide(),e.property.mode="read"},e._getExecutionListenerEventsTranslated=function(e){switch(e.event){case"start":return i.instant("PROPERTY.EXECUTIONLISTENERS.EVENT.START");case"end":return i.instant("PROPERTY.EXECUTIONLISTENERS.EVENT.END");case"take":return i.instant("PROPERTY.EXECUTIONLISTENERS.EVENT.TAKE");default:return""}}}]),angular.module("activitiModeler").controller("KisBpmEventListenersPopupCtrl",["$scope","$q","$translate","$timeout",function(e,t,i,o){e.eventListeners=void 0!==e.property.value&&null!==e.property.value&&void 0!==e.property.value.eventListeners&&null!==e.property.value.eventListeners?e.property.value.eventListeners.constructor==String?JSON.parse(e.property.value.eventListeners):angular.copy(e.property.value.eventListeners):[],e.translationsRetrieved=!1,e.labels={};var n=i("PROPERTY.EXECUTIONLISTENERS.EVENT"),r=i("PROPERTY.EXECUTIONLISTENERS.FIELDS.IMPLEMENTATION"),a=i("PROPERTY.EXECUTIONLISTENERS.FIELDS.NAME");t.all([n,r,a]).then(function(t){e.labels.eventLabel=t[0],e.labels.implementationLabel=t[1],e.labels.nameLabel=t[2],e.translationsRetrieved=!0,e.gridOptions={data:e.eventListeners,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"event",displayName:e.labels.eventLabel},{field:"implementation",displayName:e.labels.implementationLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){if(e.selectedListener=t.entity,e.selectedListener){var i=e.selectedListener.fields;if(void 0!==i&&null!==i)for(var o=0;i.length>o;o++){var n=i[o];void 0!==n.stringValue&&""!==n.stringValue?n.implementation=n.stringValue:void 0!==n.expression&&""!==n.expression?n.implementation=n.expression:void 0!==n.string&&""!==n.string&&(n.implementation=n.string)}else e.selectedListener.fields=[];e.selectedListener.events||(e.selectedListener.events=[{event:""}])}})}}),e.addEventValue=function(t){e.selectedListener.events.splice(t+1,0,{event:""})},e.removeEventValue=function(t){e.selectedListener.events.splice(t,1),e.listenerDetailsChanged()},e.listenerDetailsChanged=function(){var t=e.selectedListener;if(t.events){for(var i="",o=0;t.events.length>o;o++)o>0&&(i+=", "),i+=t.events[o].event;e.selectedListener.event=i}if(t.rethrowEvent){var n="";t.rethrowType&&t.rethrowType.length>0&&("error"===t.rethrowType&&""!==t.errorcode?n="Rethrow as error "+t.errorcode:"message"===t.rethrowType&&""!==t.messagename?n="Rethrow as message "+t.messagename:"signal"!==t.rethrowType&&"globalSignal"!==t.rethrowType||""===t.signalname||(n="Rethrow as signal "+t.signalname)),e.selectedListener.implementation=n}else e.selectedListener.implementation=""!==e.selectedListener.className?e.selectedListener.className:""!==e.selectedListener.delegateExpression?e.selectedListener.delegateExpression:""},e.addNewListener=function(){var t={event:"",implementation:"",className:"",delegateExpression:"",retrowEvent:!1};e.eventListeners.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeListener=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.eventListeners.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.eventListeners.splice(i,1),0==e.eventListeners.length&&(e.selectedListener=void 0),o(function(){e.eventListeners.length>0&&e.gridApi.selection.toggleRowSelection(e.eventListeners[0])})}},e.moveListenerUp=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.eventListeners.indexOf(t[0]);if(0!=i){var n=e.eventListeners[i];e.eventListeners.splice(i,1),o(function(){e.eventListeners.splice(i+-1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.moveListenerDown=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.eventListeners.indexOf(t[0]);if(i!=e.eventListeners.length-1){var n=e.eventListeners[i];e.eventListeners.splice(i,1),o(function(){e.eventListeners.splice(i+1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.save=function(){e.eventListeners.length>0?(e.property.value={},e.property.value.eventListeners=e.eventListeners):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.property.mode="read",e.$hide()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("KisBpmAssignmentPopupCtrl",["$rootScope","$scope","$translate","$http","UserService","GroupService","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r,a,s){function l(e){e.popup.assignmentObject.static.candidateUsers&&0!=e.popup.assignmentObject.static.candidateUsers.length||(e.popup.assignmentObject.static.candidateUsers=[{value:""}]),e.popup.assignmentObject.static.candidateGroups&&0!=e.popup.assignmentObject.static.candidateGroups.length||(e.popup.assignmentObject.static.candidateGroups=[{value:""}])}if(t.assignment=void 0!==t.property.value&&null!==t.property.value&&void 0!==t.property.value.assignment&&null!==t.property.value.assignment?t.property.value.assignment:{type:"idm",idm:"initiator"},t.popup={userField:{},groupField:{},userFieldFilter:["people"],groupFieldFilter:["functional-group"],assignmentObject:{type:t.assignment.type,idm:{type:void 0,assignee:void 0,candidateUsers:[],candidateUserFields:[],candidateGroups:[],candidateGroupFields:[]},"static":{assignee:void 0,candidateUsers:[],candidateGroups:[]}}},t.assignmentOptions=[{id:"initiator",title:i.instant("PROPERTY.ASSIGNMENT.IDM.DROPDOWN.INITIATOR")},{id:"primaryGroupManagerForInitiator",title:i.instant("PROPERTY.ASSIGNMENT.IDM.DROPDOWN.PRIMARY-GROUP-MANAGER-FOR-INITIATOR")},{id:"user",title:i.instant("PROPERTY.ASSIGNMENT.IDM.DROPDOWN.USER")},{id:"groupManager",title:i.instant("PROPERTY.ASSIGNMENT.IDM.DROPDOWN.GROUP-MANAGER")},{id:"users",title:i.instant("PROPERTY.ASSIGNMENT.IDM.DROPDOWN.USERS")}],null!==t.account.tenantId&&void 0!==t.account.tenantId&&t.assignmentOptions.push({id:"groups",title:i.instant("PROPERTY.ASSIGNMENT.IDM.DROPDOWN.GROUPS")}),t.assignment.idm&&t.assignment.idm.type)for(var d=0;t.assignmentOptions.length>d;d++)if(t.assignmentOptions[d].id==t.assignment.idm.type){t.assignmentOption=t.assignmentOptions[d];break}if(t.assignmentOption){if(t.assignment.idm){if(t.assignment.idm.assignee?t.popup.assignmentObject.idm.assignee=t.assignment.idm.assignee.id?t.assignment.idm.assignee:{email:t.assignment.idm.assignee.email}:t.assignment.idm.assigneeField&&(t.popup.assignmentObject.idm.assigneeField=t.assignment.idm.assigneeField),t.assignment.idm.candidateUsers&&t.assignment.idm.candidateUsers.length>0)for(var d=0;t.assignment.idm.candidateUsers.length>d;d++)t.popup.assignmentObject.idm.candidateUsers.push(t.assignment.idm.candidateUsers[d]);if(t.assignment.idm.candidateUserFields&&t.assignment.idm.candidateUserFields.length>0)for(var d=0;t.assignment.idm.candidateUserFields.length>d;d++)t.popup.assignmentObject.idm.candidateUserFields.push(t.assignment.idm.candidateUserFields[d]);if(t.assignment.idm.candidateGroups&&t.assignment.idm.candidateGroups.length>0)for(var d=0;t.assignment.idm.candidateGroups.length>d;d++)t.popup.assignmentObject.idm.candidateGroups.push(t.assignment.idm.candidateGroups[d]);if(t.assignment.idm.candidateGroupFields&&t.assignment.idm.candidateGroupFields.length>0)for(var d=0;t.assignment.idm.candidateGroupFields.length>d;d++)t.popup.assignmentObject.idm.candidateGroupFields.push(t.assignment.idm.candidateGroupFields[d]);t.assignment.idm.groupManager?t.popup.groupManager=t.assignment.idm.groupManager:t.assignment.idm.groupManagerField&&(t.popup.groupManagerField=t.assignment.idm.groupManagerField)}}else t.assignmentOption=t.assignmentOptions[0];if(t.assignment.assignee&&(t.popup.assignmentObject.static.assignee=t.assignment.assignee),t.assignment.candidateUsers&&t.assignment.candidateUsers.length>0)for(var d=0;t.assignment.candidateUsers.length>d;d++)t.popup.assignmentObject.static.candidateUsers.push(t.assignment.candidateUsers[d]);if(t.assignment.candidateGroups&&t.assignment.candidateGroups.length>0)for(var d=0;t.assignment.candidateGroups.length>d;d++)t.popup.assignmentObject.static.candidateGroups.push(t.assignment.candidateGroups[d]);l(t),t.$watch("popup.groupFilter",function(){t.updateGroupFilter()}),t.$watch("popup.filter",function(){t.updateFilter()}),t.updateFilter=function(){(void 0==t.popup.oldFilter||t.popup.oldFilter!=t.popup.filter)&&(t.popup.oldFilter=t.popup.filter?t.popup.filter:"",null!==t.popup.filter&&void 0!==t.popup.filter&&n.getFilteredUsers(t.popup.filter).then(function(e){for(var i=[],o=0;e.data.length>o;o++){var n=e.data[o],r=!1;if(null!==t.popup.assignmentObject.idm.candidateUsers&&void 0!==t.popup.assignmentObject.idm.candidateUsers)for(var a=0;t.popup.assignmentObject.idm.candidateUsers.length>a;a++){var s=t.popup.assignmentObject.idm.candidateUsers[a];if(s.id===n.id){r=!0;break}}r||i.push(n)}t.popup.userResults=i,t.resetSelection()}))},t.updateGroupFilter=function(){(void 0==t.popup.oldGroupFilter||t.popup.oldGroupFilter!=t.popup.groupFilter)&&(t.popup.oldGroupFilter=t.popup.groupFilter?t.popup.groupFilter:"",r.getFilteredGroups(t.popup.groupFilter).then(function(e){t.popup.groupResults=e.data,t.resetGroupSelection()}))},t.confirmUser=function(e){if(!e){var i=t.popup.userResults;t.popup.selectedIndex>=0&&t.popup.selectedIndex<i.length&&(e=i[t.popup.selectedIndex])}if(e)if("user"==t.assignmentOption.id)t.popup.assignmentObject.idm.assignee=e,t.popup.assignmentObject.idm.assigneeField=void 0;else if("users"==t.assignmentOption.id){var o=!1;if(t.popup.assignmentObject.idm.candidateUsers)for(var n=0;t.popup.assignmentObject.idm.candidateUsers.length>n;n++)if(t.popup.assignmentObject.idm.candidateUsers[n].id===e.id){o=!0;break}o||t.addCandidateUser(e)}},t.confirmEmail=function(){if("user"==t.assignmentOption.id)t.popup.assignmentObject.idm.assignee={email:t.popup.email},t.popup.assignmentObject.idm.assigneeField=void 0;else if("users"==t.assignmentOption.id){var e=!1;if(t.popup.assignmentObject.idm.candidateUsers)for(var i=0;t.popup.assignmentObject.idm.candidateUsers.length>i;i++)if(t.popup.assignmentObject.idm.candidateUsers[i].id){if(t.popup.assignmentObject.idm.candidateUsers[i].id===user.id){e=!0;break}}else if(t.popup.assignmentObject.idm.candidateUsers[i].email&&t.popup.assignmentObject.idm.candidateUsers[i].email===t.popup.email){e=!0;break}e||t.addCandidateUser({email:t.popup.email})}},t.confirmGroup=function(e){if(!e){var i=t.popup.groupResults;t.popup.selectedGroupIndex>=0&&t.popup.selectedGroupIndex<i.length&&(e=i[t.popup.selectedGroupIndex])}if(e)if("groupManager"==t.assignmentOption.id)t.popup.groupManager={id:e.id,name:e.name,externalId:e.externalId},t.popup.groupManagerField=void 0;else{var o=!1;if(t.popup.assignmentObject.idm.candidateGroups)for(var n=0;t.popup.assignmentObject.idm.candidateGroups.length>n;n++)if(t.popup.assignmentObject.idm.candidateGroups[n].id===e.id){o=!0;break}o||t.addCandidateGroup(e)}},t.addCandidateUser=function(e){t.popup.assignmentObject.idm.candidateUsers.push(e)},t.addCandidateUserField=function(e){t.popup.assignmentObject.idm.candidateUserFields.push(e)},t.removeCandidateUser=function(e){for(var i=t.popup.assignmentObject.idm.candidateUsers,o=-1,n=0;i.length>n;n++)if(e.id){if(e.id===i[n].id){o=n;break}}else if(e.email===i[n].email){o=n;break}o>=0&&i.splice(o,1)},t.removeCandidateUserField=function(e){for(var i=t.popup.assignmentObject.idm.candidateUserFields,o=-1,n=0;i.length>n;n++)if(e.id===i[n].id){o=n;break}o>=0&&i.splice(o,1)},t.addCandidateGroup=function(e){t.popup.assignmentObject.idm.candidateGroups.push(e)},t.addCandidateGroupField=function(e){t.popup.assignmentObject.idm.candidateGroupFields.push(e)},t.removeCandidateGroup=function(e){for(var i=t.popup.assignmentObject.idm.candidateGroups,o=-1,n=0;i.length>n;n++)if(e.id==i[n].id){o=n;break}o>=0&&i.splice(o,1)},t.removeCandidateGroupField=function(e){for(var i=t.popup.assignmentObject.idm.candidateGroupFields,o=-1,n=0;i.length>n;n++)if(e.id==i[n].id){o=n;break}o>=0&&i.splice(o,1)},t.resetSelection=function(){t.popup.selectedIndex=t.popup.userResults&&t.popup.userResults.length>0?0:-1},t.nextUser=function(){var e=t.popup.userResults;e&&e.length>0&&t.popup.selectedIndex<e.length-1&&(t.popup.selectedIndex+=1)},t.previousUser=function(){var e=t.popup.userResults;e&&e.length>0&&t.popup.selectedIndex>0&&(t.popup.selectedIndex-=1)},t.resetGroupSelection=function(){t.popup.selectedGroupIndex=t.popup.groupResults&&t.popup.groupResults.length>0?0:-1},t.nextGroup=function(){var e=t.popup.groupResults;e&&e.length>0&&t.popup.selectedGroupIndex<e.length-1&&(t.popup.selectedGroupIndex+=1)},t.previousGroup=function(){var e=t.popup.groupResults;e&&e.length>0&&t.popup.selectedGroupIndex>0&&(t.popup.selectedGroupIndex-=1)},t.removeAssignee=function(){t.popup.assignmentObject.idm.assignee=void 0,t.popup.assignmentObject.idm.assigneeField=void 0},t.addCandidateUserValue=function(e){t.popup.assignmentObject.static.candidateUsers.splice(e+1,0,{value:""})},t.removeCandidateUserValue=function(e){t.popup.assignmentObject.static.candidateUsers.splice(e,1)},t.addCandidateGroupValue=function(e){t.popup.assignmentObject.static.candidateGroups.splice(e+1,0,{value:""})},t.removeCandidateGroupValue=function(e){t.popup.assignmentObject.static.candidateGroups.splice(e,1)},t.setSearchType=function(){t.popup.assignmentObject.assignmentSourceType="search"},t.setFormFieldType=function(){t.popup.assignmentObject.assignmentSourceType="field"},t.$watch("popup.userField",function(){if(t.popup.userField&&t.popup.userField.id){var e={id:t.popup.userField.id,name:t.popup.userField.name,type:t.popup.userField.type};if("user"==t.assignmentOption.id)t.popup.assignmentObject.idm.assigneeField=e,t.popup.assignmentObject.idm.assignee=void 0;else if("users"==t.assignmentOption.id){var i=!1;if(t.popup.assignmentObject.idm.candidateUserFields)for(var o=0;t.popup.assignmentObject.idm.candidateUserFields.length>o;o++)if(t.popup.assignmentObject.idm.candidateUserFields[o].id===e.id){i=!0;break}i||t.addCandidateUserField(e)}t.popup.userField={}}}),t.$watch("popup.groupField",function(){if(t.popup.groupField&&t.popup.groupField.id){var e={id:t.popup.groupField.id,name:t.popup.groupField.name,type:t.popup.groupField.type};if("groupManager"==t.assignmentOption.id)t.popup.groupManagerField=e,t.popup.groupManager=void 0;else{var i=!1;if(t.popup.assignmentObject.idm.candidateGroupFields)for(var o=0;t.popup.assignmentObject.idm.candidateGroupFields.length>o;o++)if(t.popup.assignmentObject.idm.candidateGroupFields[o].id===e.id){i=!0;break}i||t.addCandidateGroupField(e)}t.popup.groupField={}}});var c=s.collectSortedElementsFromPrecedingElements(t.selectedShape);t.popup.fields=a.getFormFieldsForStep(c,t.selectedShape.resourceId,["people","functional-group"]),t.save=function(){if(p(t.popup.assignmentObject.static),t.assignment.type=t.popup.assignmentObject.type,"idm"===t.popup.assignmentObject.type){t.popup.assignmentObject.static=void 0;var e={type:t.assignmentOption.id};"user"==e.type?t.popup.assignmentObject.idm.assignee?e.assignee=t.popup.assignmentObject.idm.assignee:t.popup.assignmentObject.idm.assigneeField&&(e.assigneeField=t.popup.assignmentObject.idm.assigneeField):"users"==e.type?(t.popup.assignmentObject.idm.candidateUsers&&t.popup.assignmentObject.idm.candidateUsers.length>0&&(e.candidateUsers=t.popup.assignmentObject.idm.candidateUsers),t.popup.assignmentObject.idm.candidateUserFields&&t.popup.assignmentObject.idm.candidateUserFields.length>0&&(e.candidateUserFields=t.popup.assignmentObject.idm.candidateUserFields)):"groups"==e.type?(t.popup.assignmentObject.idm.candidateGroups&&t.popup.assignmentObject.idm.candidateGroups.length>0&&(e.candidateGroups=t.popup.assignmentObject.idm.candidateGroups),t.popup.assignmentObject.idm.candidateGroupFields&&t.popup.assignmentObject.idm.candidateGroupFields.length>0&&(e.candidateGroupFields=t.popup.assignmentObject.idm.candidateGroupFields)):"groupManager"==e.type&&(t.popup.groupManager?e.groupManager=t.popup.groupManager:t.popup.groupManagerField&&(e.groupManagerField=t.popup.groupManagerField)),t.assignment.idm=e,t.assignment.assignee=void 0,t.assignment.candidateUsers=void 0,t.assignment.candidateGroups=void 0}"static"===t.popup.assignmentObject.type&&(t.popup.assignmentObject.idm=void 0,t.assignment.idm=void 0,t.assignment.assignee=t.popup.assignmentObject.static.assignee,t.assignment.candidateUsers=t.popup.assignmentObject.static.candidateUsers,t.assignment.candidateGroups=t.popup.assignmentObject.static.candidateGroups),t.property.value={},t.property.value.assignment=t.assignment,t.updatePropertyInModel(t.property),t.close()},t.$parent.$on("modal.hide.before",function(){t.close(),t.$parent.$apply()}),t.close=function(){t.property.mode="read",t.$hide()};var p=function(e){function t(e){return void 0===e||null===e||0===e.trim().length}t(e.assignee)&&(e.assignee=void 0);var i,o=0,n=0;if(e.candidateUsers){for(i=[],n=0;e.candidateUsers.length>n;n++)t(e.candidateUsers[n].value)&&(i[i.length]=n);if(i.length==e.candidateUsers.length)e.candidateUsers=void 0;else for(o=0,n=0;i.length>n;n++)e.candidateUsers.splice(i[n]-o,1),o++}if(e.candidateGroups){for(i=[],n=0;e.candidateGroups.length>n;n++)t(e.candidateGroups[n].value)&&(i[i.length]=n);if(i.length==e.candidateGroups.length)e.candidateGroups=void 0;else for(o=0,n=0;i.length>n;n++)e.candidateGroups.splice(i[n]-o,1),o++}}}]),angular.module("activitiModeler").controller("KisBpmMailToPopupCtrl",["$rootScope","$scope","$translate","$http","UserService","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r,a){if(void 0!==t.property.value&&null!==t.property.value&&void 0!==t.property.value.mailTo&&null!==t.property.value.mailTo?t.mailTo=t.property.value.mailTo:(t.mailTo={},t.mailToExpression=t.property.value),t.popup={userField:{},userFieldFilter:["people"],mailToObject:{type:void 0,recipient:void 0,candidateUsers:[],candidateUserFields:[],candidateUserEmails:[]},expression:""},t.mailToOptions=[{id:"initiator",title:i.instant("PROPERTY.MAIL_TO.IDM.DROPDOWN.INITIATOR")},{id:"user",title:i.instant("PROPERTY.MAIL_TO.IDM.DROPDOWN.USER")},{id:"users",title:i.instant("PROPERTY.MAIL_TO.IDM.DROPDOWN.USERS")}],t.mailTo&&t.mailTo.type)for(var s=0;t.mailToOptions.length>s;s++)if(t.mailToOptions[s].id==t.mailTo.type){t.mailToOption=t.mailToOptions[s];break}if(t.mailToOption){if(t.mailTo.recipient?t.popup.mailToObject.recipient=t.mailTo.recipient.id?t.mailTo.recipient:{email:t.mailTo.recipient.email}:t.mailTo.recipientField&&(t.popup.mailToObject.recipientField=t.mailTo.recipientField),t.mailTo.candidateUsers&&t.mailTo.candidateUsers.length>0)for(var s=0;t.mailTo.candidateUsers.length>s;s++)t.popup.mailToObject.candidateUsers.push(t.mailTo.candidateUsers[s]);if(t.mailTo.candidateUserFields&&t.mailTo.candidateUserFields.length>0)for(var s=0;t.mailTo.candidateUserFields.length>s;s++)t.popup.mailToObject.candidateUserFields.push(t.mailTo.candidateUserFields[s]);
if(t.mailTo.candidateUserEmails&&t.mailTo.candidateUserEmails.length>0)for(var s=0;t.mailTo.candidateUserEmails.length>s;s++)t.popup.mailToObject.candidateUserEmails.push(t.mailTo.candidateUserEmails[s]);t.popup.mailToObject.type="idm"}else t.mailToOption=t.mailToOptions[0],t.popup.expression=t.mailToExpression;t.$watch("popup.filter",function(){t.updateFilter()}),t.updateFilter=function(){(void 0==t.popup.oldFilter||t.popup.oldFilter!=t.popup.filter)&&(t.popup.oldFilter=t.popup.filter?t.popup.filter:"",null!==t.popup.filter&&void 0!==t.popup.filter&&n.getFilteredUsers(t.popup.filter).then(function(e){for(var i=[],o=0;e.data.length>o;o++){var n=e.data[o],r=!1;if(null!==t.popup.mailToObject.candidateUsers&&void 0!==t.popup.mailToObject.candidateUsers)for(var a=0;t.popup.mailToObject.candidateUsers.length>a;a++){var s=t.popup.mailToObject.candidateUsers[a];if(s.id===n.id){r=!0;break}}r||i.push(n)}t.popup.userResults=i,t.resetSelection()}))},t.confirmUser=function(e){if(!e){var i=t.popup.userResults;t.popup.selectedIndex>=0&&t.popup.selectedIndex<i.length&&(e=i[t.popup.selectedIndex])}if(e)if("user"==t.mailToOption.id)t.popup.mailToObject.recipient=e,t.popup.mailToObject.recipientField=void 0;else if("users"==t.mailToOption.id){var o=!1;if(t.popup.mailToObject.candidateUsers)for(var n=0;t.popup.mailToObject.candidateUsers.length>n;n++)if(t.popup.mailToObject.candidateUsers[n].id===e.id){o=!0;break}o||t.addCandidateUser(e)}},t.confirmEmail=function(){if("user"==t.mailToOption.id)t.popup.mailToObject.recipient={email:t.popup.email},t.popup.mailToObject.recipientField=void 0;else if("users"==t.mailToOption.id){var e=!1;if(t.popup.mailToObject.candidateUsers)for(var i=0;t.popup.mailToObject.candidateUsers.length>i;i++)if(t.popup.mailToObject.candidateUsers[i].id){if(t.popup.mailToObject.candidateUsers[i].id===user.id){e=!0;break}}else if(t.popup.mailToObject.candidateUsers[i].email&&t.popup.mailToObject.candidateUsers[i].email===t.popup.email){e=!0;break}e||t.addCandidateUser({email:t.popup.email})}},t.addCandidateUser=function(e){t.popup.mailToObject.candidateUsers.push(e)},t.addCandidateUserField=function(e){t.popup.mailToObject.candidateUserFields.push(e)},t.removeCandidateUser=function(e){for(var i=t.popup.mailToObject.candidateUsers,o=-1,n=0;i.length>n;n++)if(e.id){if(e.id===i[n].id){o=n;break}}else if(e.email===i[n].email){o=n;break}o>=0&&i.splice(o,1)},t.removeCandidateUserField=function(e){for(var i=t.popup.mailToObject.candidateUserFields,o=-1,n=0;i.length>n;n++)if(e.id===i[n].id){o=n;break}o>=0&&i.splice(o,1)},t.removeCandidateUserEmail=function(e){for(var i=t.popup.mailToObject.candidateUserEmails,o=-1,n=0;i.length>n;n++)if(e.email===i[n].email){o=n;break}o>=0&&i.splice(o,1)},t.resetSelection=function(){t.popup.selectedIndex=t.popup.userResults&&t.popup.userResults.length>0?0:-1},t.nextUser=function(){var e=t.popup.userResults;e&&e.length>0&&t.popup.selectedIndex<e.length-1&&(t.popup.selectedIndex+=1)},t.previousUser=function(){var e=t.popup.userResults;e&&e.length>0&&t.popup.selectedIndex>0&&(t.popup.selectedIndex-=1)},t.removeAssignee=function(){t.popup.mailToObject.recipient=void 0,t.popup.mailToObject.recipientField=void 0},t.setSearchType=function(){t.popup.mailToObject.mailToSourceType="search"},t.setFormFieldType=function(){t.popup.mailToObject.mailToSourceType="field"},t.$watch("popup.userField",function(){if(t.popup.userField&&t.popup.userField.id){var e={id:t.popup.userField.id,name:t.popup.userField.name,type:t.popup.userField.type};if("user"==t.mailToOption.id)t.popup.mailToObject.recipientField=e,t.popup.mailToObject.recipient=void 0;else if("users"==t.mailToOption.id){var i=!1;if(t.popup.mailToObject.candidateUserFields)for(var o=0;t.popup.mailToObject.candidateUserFields.length>o;o++)if(t.popup.mailToObject.candidateUserFields[o].id===e.id){i=!0;break}i||t.addCandidateUserField(e)}t.popup.userField={}}});var l=a.collectSortedElementsFromPrecedingElements(t.selectedShape);t.popup.fields=r.getFormFieldsForStep(l,t.selectedShape.resourceId,["people"]),t.save=function(){if("idm"==t.popup.mailToObject.type){t.mailTo.type=t.popup.mailToObject.type;var e={type:t.mailToOption.id};"user"==e.type?t.popup.mailToObject.recipient?e.recipient=t.popup.mailToObject.recipient:t.popup.mailToObject.recipientField&&(e.recipientField=t.popup.mailToObject.recipientField):"users"==e.type&&(t.popup.mailToObject.candidateUsers&&t.popup.mailToObject.candidateUsers.length>0&&(e.candidateUsers=t.popup.mailToObject.candidateUsers),t.popup.mailToObject.candidateUserFields&&t.popup.mailToObject.candidateUserFields.length>0&&(e.candidateUserFields=t.popup.mailToObject.candidateUserFields),t.popup.mailToObject.candidateUserEmails&&t.popup.mailToObject.candidateUserEmails.length>0&&(e.candidateUserEmails=t.popup.mailToObject.candidateUserEmails)),t.mailTo=e,t.property.value={},t.property.value.mailTo=t.mailTo}else t.property.value=t.popup.expression;t.updatePropertyInModel(t.property),t.close()},t.$parent.$on("modal.hide.before",function(){t.close(),t.$parent.$apply()}),t.close=function(){t.property.mode="read",t.$hide()}}]),angular.module("activitiModeler").controller("ActivitiExpressionTextCtrl",["$scope","$modal",function(e,t){e.resolveModal=function(t){e.property.value=t,e.updatePropertyInModel(e.property)};var i={template:"editor-app/configuration/properties/expression-text-popup.html?version="+Date.now(),scope:e,backdrop:"static"};_internalCreateModal(i,t,e)}]),angular.module("activitiModeler").controller("ActivitiExpressionTextPopupCtrl",["$rootScope","$scope","$translate","$timeout",function(e,t,i,o){t.popup={},t.allowedTypes=["text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount"],t.insertFormField={position:0},t.model={urlFieldType:"formField",requestMappingValues:[]},t.displayText=void 0!==t.property.value&&null!==t.property.value?t.property.value:"",t.setUrlFieldType=function(e){"restResponse"===e?t.model={urlFieldType:"restResponse"}:"formField"===e&&(t.model={urlFieldType:"formField"})},t.$watch("insertFormField.field",function(e){if(e){var i;t.displayText&&(i=t.displayText);var n="${"+e.id+"}";i=i?i.substring(0,t.insertFormField.position)+n+i.substring(t.insertFormField.position):n,t.insertFormField.field=void 0,o(function(){var e=angular.element("#readonly-text-value");e.focus(),e.val(i),t.displayText=i},200)}}),t.save=function(){"function"==typeof t.resolveModal&&t.resolveModal(t.displayText),t.close()},t.close=function(){t.property.mode="read",t.$hide(),t.$parent.$hide()}}]),angular.module("activitiModeler").controller("KisBpmFieldsPopupCtrl",["$scope","$q","$translate","$timeout",function(e,t,i,o){if(void 0!==e.property.value&&null!==e.property.value&&void 0!==e.property.value.fields&&null!==e.property.value.fields){e.fields=angular.copy(e.property.value.fields);for(var n=0;e.fields.length>n;n++){var r=e.fields[n];void 0!==r.stringValue&&""!==r.stringValue?r.implementation=r.stringValue:void 0!==r.expression&&""!==r.expression?r.implementation=r.expression:void 0!==r.string&&""!==r.string&&(r.implementation=r.string)}}else e.fields=[];e.translationsRetrieved=!1,e.labels={};var a=i("PROPERTY.FIELDS.NAME"),s=i("PROPERTY.FIELDS.IMPLEMENTATION");t.all([a,s]).then(function(t){e.labels.nameLabel=t[0],e.labels.implementationLabel=t[1],e.translationsRetrieved=!0,e.gridOptions={data:e.fields,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:e.labels.nameLabel},{field:"implementation",displayName:e.labels.implementationLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedField=t.entity})}}),e.fieldDetailsChanged=function(){e.selectedField.implementation=""!=e.selectedField.stringValue?e.selectedField.stringValue:""!=e.selectedField.expression?e.selectedField.expression:""!=e.selectedField.string?e.selectedField.string:""},e.addNewField=function(){var t={name:"fieldName",implementation:"",stringValue:"",expression:"",string:""};e.fields.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeField=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.fields.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.fields.splice(i,1),0==e.fields.length&&(e.selectedField=void 0),o(function(){e.fields.length>0&&e.gridApi.selection.toggleRowSelection(e.fields[0])})}},e.moveFieldUp=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.fields.indexOf(t[0]);if(0!=i){var n=e.fields[i];e.fields.splice(i,1),o(function(){e.fields.splice(i+-1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.moveFieldDown=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.fields.indexOf(t[0]);if(i!=e.fields.length-1){var n=e.fields[i];e.fields.splice(i,1),o(function(){e.fields.splice(i+1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.save=function(){e.fields.length>0?(e.property.value={},e.property.value.fields=e.fields):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.$hide()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("KisBpmFormPropertiesPopupCtrl",["$scope","$q","$translate","$timeout",function(e,t,i,o){e.formProperties=e.property.value&&e.property.value.formProperties?angular.copy(e.property.value.formProperties):[],e.translationsRetrieved=!1,e.labels={};var n=i("PROPERTY.FORMPROPERTIES.ID"),r=i("PROPERTY.FORMPROPERTIES.NAME"),a=i("PROPERTY.FORMPROPERTIES.TYPE");t.all([n,r,a]).then(function(t){e.labels.idLabel=t[0],e.labels.nameLabel=t[1],e.labels.typeLabel=t[2],e.translationsRetrieved=!0,e.gridOptions={data:e.formProperties,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"id",displayName:e.labels.idLabel},{field:"name",displayName:e.labels.nameLabel},{field:"type",displayName:e.labels.typeLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedProperty=t.entity})}}),e.propertyTypeChanged=function(){"date"===e.selectedProperty.type?e.selectedProperty.datePattern="MM-dd-yyyy hh:mm":delete e.selectedProperty.datePattern,"enum"===e.selectedProperty.type?e.selectedProperty.enumValues=[{value:"value 1"},{value:"value 2"}]:delete e.selectedProperty.enumValues};var s=3;e.addEnumValue=function(t){e.selectedProperty.enumValues.splice(t+1,0,{value:"value "+s++})},e.removeEnumValue=function(t){e.selectedProperty.enumValues.splice(t,1)};var l=1;e.addNewProperty=function(){var t={id:"new_property_"+l++,name:"",type:"string",readable:!0,writable:!0};e.formProperties.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeProperty=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.formProperties.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.formProperties.splice(i,1),0===e.formProperties.length&&(e.selectedProperty=void 0),o(function(){e.formProperties.length>0&&e.gridApi.selection.toggleRowSelection(e.formProperties[0])})}},e.movePropertyUp=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.formProperties.indexOf(t[0]);if(0!==i){var n=e.formProperties[i];e.formProperties.splice(i,1),o(function(){e.formProperties.splice(i+-1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.movePropertyDown=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.formProperties.indexOf(t[0]);if(i!==e.formProperties.length-1){var n=e.formProperties[i];e.formProperties.splice(i,1),o(function(){e.formProperties.splice(i+1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.save=function(){e.formProperties.length>0?(e.property.value={},e.property.value.formProperties=e.formProperties):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.$hide(),e.property.mode="read"},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.$hide(),e.property.mode="read"}}]),angular.module("activitiModeler").controller("KisBpmInParametersPopupCtrl",["$scope","$q","$translate","$timeout",function(e,t,i,o){e.parameters=void 0!==e.property.value&&null!==e.property.value&&void 0!==e.property.value.inParameters&&null!==e.property.value.inParameters?angular.copy(e.property.value.inParameters):[],e.translationsRetrieved=!1,e.labels={};var n=i("PROPERTY.PARAMETER.SOURCE"),r=i("PROPERTY.PARAMETER.SOURCEEXPRESSION"),a=i("PROPERTY.PARAMETER.TARGET");t.all([n,r,a]).then(function(t){e.labels.sourceLabel=t[0],e.labels.sourceExpressionLabel=t[1],e.labels.targetLabel=t[2],e.translationsRetrieved=!0,e.gridOptions={data:e.parameters,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"source",displayName:e.labels.sourceLabel},{field:"sourceExpression",displayName:e.labels.sourceExpressionLabel},{field:"target",displayName:e.labels.targetLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedParameter=t.entity})}}),e.addNewParameter=function(){var t={source:"",sourceExpression:"",target:""};e.parameters.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeParameter=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.parameters.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.parameters.splice(i,1),0==e.parameters.length&&(e.selectedParameter=void 0),o(function(){e.parameters.length>0&&e.gridApi.selection.toggleRowSelection(e.parameters[0])})}},e.moveParameterUp=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.parameters.indexOf(t[0]);if(0!=i){var n=e.parameters[i];e.parameters.splice(i,1),o(function(){e.parameters.splice(i+-1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.moveParameterDown=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.parameters.indexOf(t[0]);if(i!=e.parameters.length-1){var n=e.parameters[i];e.parameters.splice(i,1),o(function(){e.parameters.splice(i+1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.save=function(){e.parameters.length>0?(e.property.value={},e.property.value.inParameters=e.parameters):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("KisBpmMultiInstanceCtrl",["$scope",function(e){void 0==e.property.value&&null==e.property.value&&(e.property.value="None"),e.multiInstanceChanged=function(){e.updatePropertyInModel(e.property)}}]),angular.module("activitiModeler").controller("KisBpmOutParametersPopupCtrl",["$scope","$q","$translate","$timeout",function(e,t,i,o){e.parameters=void 0!==e.property.value&&null!==e.property.value&&void 0!==e.property.value.outParameters&&null!==e.property.value.outParameters?angular.copy(e.property.value.outParameters):[],e.translationsRetrieved=!1,e.labels={};var n=i("PROPERTY.PARAMETER.SOURCE"),r=i("PROPERTY.PARAMETER.SOURCEEXPRESSION"),a=i("PROPERTY.PARAMETER.TARGET");t.all([n,r,a]).then(function(t){e.labels.sourceLabel=t[0],e.labels.sourceExpressionLabel=t[1],e.labels.targetLabel=t[2],e.translationsRetrieved=!0,e.gridOptions={data:e.parameters,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"source",displayName:e.labels.sourceLabel},{field:"sourceExpression",displayName:e.labels.sourceExpressionLabel},{field:"target",displayName:e.labels.targetLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedParameter=t.entity})}}),e.addNewParameter=function(){var t={source:"",sourceExpression:"",target:""};e.parameters.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeParameter=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.parameters.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.parameters.splice(i,1),0==e.parameters.length&&(e.selectedParameter=void 0),o(function(){e.parameters.length>0&&e.gridApi.selection.toggleRowSelection(e.parameters[0])})}},e.moveParameterUp=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.parameters.indexOf(t[0]);if(0!=i){var n=e.parameters[i];e.parameters.splice(i,1),o(function(){e.parameters.splice(i+-1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.moveParameterDown=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.parameters.indexOf(t[0]);if(i!=e.parameters.length-1){var n=e.parameters[i];e.parameters.splice(i,1),o(function(){e.parameters.splice(i+1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.save=function(){e.parameters.length>0?(e.property.value={},e.property.value.outParameters=e.parameters):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("KisBpmTaskListenersPopupCtrl",["$scope","$q","$translate","$timeout",function(e,t,i,o){if(void 0!==e.property.value&&null!==e.property.value&&void 0!==e.property.value.taskListeners&&null!==e.property.value.taskListeners){e.taskListeners=e.property.value.taskListeners.constructor==String?JSON.parse(e.property.value.taskListeners):angular.copy(e.property.value.taskListeners);for(var n=0;e.taskListeners.length>n;n++){var r=e.taskListeners[n];void 0!==r.className&&""!==r.className?r.implementation=r.className:void 0!==r.expression&&""!==r.expression?r.implementation=r.expression:void 0!==r.delegateExpression&&""!==r.delegateExpression&&(r.implementation=r.delegateExpression)}}else e.taskListeners=[];e.selectedListener=void 0,e.selectedField=void 0,e.fields=[],e.translationsRetrieved=!1,e.labels={};var a=i("PROPERTY.TASKLISTENERS.EVENT"),s=i("PROPERTY.TASKLISTENERS.FIELDS.IMPLEMENTATION"),l=i("PROPERTY.TASKLISTENERS.FIELDS.NAME");t.all([a,s,l]).then(function(t){e.labels.eventLabel=t[0],e.labels.implementationLabel=t[1],e.labels.nameLabel=t[2],e.translationsRetrieved=!0,e.gridOptions={data:e.taskListeners,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"event",displayName:e.labels.eventLabel},{field:"implementation",displayName:e.labels.implementationLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){if(e.selectedListener=t.entity,e.selectedField=void 0,e.selectedListener){var i=e.selectedListener.fields;if(void 0!==i&&null!==i)for(var o=0;i.length>o;o++){var n=i[o];void 0!==n.stringValue&&""!==n.stringValue?n.implementation=n.stringValue:void 0!==n.expression&&""!==n.expression?n.implementation=n.expression:void 0!==n.string&&""!==n.string&&(n.implementation=n.string)}else e.selectedListener.fields=[];e.fields.length=0;for(var o=0;e.selectedListener.fields.length>o;o++)e.fields.push(e.selectedListener.fields[o])}})},e.gridFieldOptions={data:e.fields,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,columnDefs:[{field:"name",displayName:e.labels.name},{field:"implementation",displayName:e.labels.implementationLabel}]},e.gridFieldOptions.onRegisterApi=function(t){e.fieldGridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedField=t.entity})}}),e.listenerDetailsChanged=function(){e.selectedListener.implementation=""!==e.selectedListener.className?e.selectedListener.className:""!==e.selectedListener.expression?e.selectedListener.expression:""!==e.selectedListener.delegateExpression?e.selectedListener.delegateExpression:""},e.addNewListener=function(){var t={event:"create",implementation:"",className:"",expression:"",delegateExpression:""};e.taskListeners.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeListener=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.taskListeners.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.taskListeners.splice(i,1),0==e.taskListeners.length&&(e.selectedListener=void 0),o(function(){e.taskListeners.length>0&&e.gridApi.selection.toggleRowSelection(e.taskListeners[0])})}},e.moveListenerUp=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.taskListeners.indexOf(t[0]);if(0!=i){var n=e.taskListeners[i];e.taskListeners.splice(i,1),o(function(){e.taskListeners.splice(i+-1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.moveListenerDown=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.taskListeners.indexOf(t[0]);if(i!=e.taskListeners.length-1){var n=e.taskListeners[i];e.taskListeners.splice(i,1),o(function(){e.taskListeners.splice(i+1,0,n),o(function(){e.gridApi.selection.toggleRowSelection(n)})})}}},e.fieldDetailsChanged=function(){e.selectedField.implementation=""!=e.selectedField.stringValue?e.selectedField.stringValue:""!=e.selectedField.expression?e.selectedField.expression:""!=e.selectedField.string?e.selectedField.string:""},e.addNewField=function(){if(e.selectedListener){void 0==e.selectedListener.fields&&(e.selectedListener.fields=[]);var t={name:"fieldName",implementation:"",stringValue:"",expression:"",string:""};e.fields.push(t),e.selectedListener.fields.push(t),o(function(){e.fieldGridApi.selection.toggleRowSelection(t)})}},e.removeField=function(){var t=e.fieldGridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.fields.indexOf(t[0]);e.fieldGridApi.selection.toggleRowSelection(t[0]),e.fields.splice(i,1),e.selectedListener.fields.splice(i,1),0==e.fields.length&&(e.selectedField=void 0),o(function(){e.fields.length>0&&e.fieldGridApi.selection.toggleRowSelection(e.fields[0])})}},e.moveFieldUp=function(){var t=e.fieldGridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.fields.indexOf(t[0]);if(0!=i){var n=e.fields[i];e.fields.splice(i,1),e.selectedListener.fields.splice(i,1),o(function(){e.fields.splice(i+-1,0,n),e.selectedListener.fields.splice(i+-1,0,n),o(function(){e.fieldGridApi.selection.toggleRowSelection(n)})})}}},e.moveFieldDown=function(){var t=e.fieldGridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.fields.indexOf(t[0]);if(i!=e.fields.length-1){var n=e.fields[i];e.fields.splice(i,1),e.selectedListeners.fields.splice(i,1),o(function(){e.fields.splice(i+1,0,n),e.selectedListener.fields.splice(i+1,0,n),o(function(){e.fieldGridApi.selection.toggleRowSelection(n)})})}}},e.save=function(){e.taskListeners.length>0?(e.property.value={},e.property.value.taskListeners=e.taskListeners):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("KisBpmCollapsedSubprocessReferencePopupCrtl",["$rootScope","$scope","$http","ProcessScopeService","httpUtils",function(e,t,i,o,n){t.state={loadingSubprocesses:!0,error:!1},t.popup={state:"subProcessReference"},t.$parent.$on("modal.hide.before",function(){t.close(),t.$parent.$apply()}),t.close=function(){t.property.newVariablesMapping=void 0,t.property.mode="read",t.$hide()},t.selectSubProcess=function(e,i){i.stopPropagation(),t.selectedSubProcess&&t.selectedSubProcess.id&&e.id==t.selectedSubProcess.id?t.selectedSubProcess=null:(t.selectedSubProcess=e,t.selectedSubProcess&&(t.selectedSubProcess.variablesmapping=[],t.property.newVariablesMapping=void 0))},t.isReusableSelected=function(){return t.isSelected()&&t.isGlobal()},t.isSelected=function(){return t.selectedSubProcess&&t.selectedSubProcess.id?!0:!1},t.isGlobal=function(){return void 0===t.selectedSubProcess.referenceId||null===t.selectedSubProcess.referenceId?!0:!1},t.save=function(){t.property.newVariablesMapping&&(t.selectedSubProcess.variablesmapping=t.property.newVariablesMapping),t.property.value=t.selectedSubProcess?{id:t.selectedSubProcess.id,name:t.selectedSubProcess.name,referenceId:t.selectedSubProcess.referenceId,variablesmapping:t.selectedSubProcess.variablesmapping}:null,t.updatePropertyInModel(t.property),o.refresh(),t.close()},t.open=function(){if(t.selectedSubProcess){t.property.value={id:t.selectedSubProcess.id,name:t.selectedSubProcess.name,referenceId:t.selectedSubProcess.referenceId,variablesmapping:t.selectedSubProcess.variablesmapping},t.updatePropertyInModel(t.property);var r=t.editor.getModelMetaData(),a=t.editor.getJSON();a=JSON.stringify(a);var s={modeltype:r.model.modelType,json_xml:a,name:r.name,description:r.description,newversion:!1,lastUpdated:r.lastUpdated};e.readOnly?o.navigateForward("editor/"+encodeURIComponent(t.selectedSubProcess.id),t.selectedShape.resourceId):i({method:"POST",data:s,ignoreErrors:!0,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:n.encode,url:KISBPM.URL.putModel(r.modelId)}).success(function(){t.editor.handleEvents({type:ORYX.CONFIG.EVENT_SAVED}),o.navigateForward("editor/"+encodeURIComponent(t.selectedSubProcess.id),t.selectedShape.resourceId)}).error(function(){}),t.close()}},t.mapVariables=function(){t.popup.state="mapping";var e=t.editor.getModelMetaData();t.model={loading:!1,subProcess:{name:"",description:"",modelType:0,referenceId:e.modelId,stencilSet:0},defaultStencilSet:void 0},t.storedId=t.selectedSubProcess.id},t.newSubProcess=function(){t.property.value.variablesmapping=[],t.popup.state="newSubProcess";var e=t.editor.getModelMetaData();t.model={loading:!1,subProcess:{name:"",description:"",modelType:0,referenceId:e.modelId,stencilSet:0},defaultStencilSet:void 0}},t.createSubProcess=function(){if(t.model.subProcess.name&&0!=t.model.subProcess.name.length){var e=t.model.subProcess.stencilSet;t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",data:t.model.subProcess}).success(function(r){var a=r.id;t.property.value={id:a,name:r.name,referenceId:r.referenceId,variablesmapping:r.variablesmapping},t.updatePropertyInModel(t.property);var s=t.editor.getModelMetaData(),l=t.editor.getJSON();l=JSON.stringify(l);var d={modeltype:s.model.modelType,json_xml:l,name:s.name,description:s.description,newversion:!1,lastUpdated:s.lastUpdated,stencilSet:e};i({method:"POST",data:d,ignoreErrors:!0,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:n.encode,url:KISBPM.URL.putModel(s.modelId)}).success(function(){t.editor.handleEvents({type:ORYX.CONFIG.EVENT_SAVED}),t.model.loading=!1,t.$hide(),o.navigateForward("editor/"+encodeURIComponent(a),t.selectedShape.resourceId)}).error(function(){t.model.loading=!1,t.$hide()})}).error(function(){t.model.loading=!1,t.$hide()})}},t.cancel=function(){t.close()},t.resetCurrent=function(){for(var e=0,i=!1;t.subProcesses.length>e&&i===!1;e++){var o=t.subProcesses[e];if(o.id==t.property.value.id){var n=t.selectedSubProcess.variablesmapping;t.selectedSubProcess=o,t.selectedSubProcess.variablesmapping=n,i=!0}}},t.loadProcesses=function(){var e=t.editor.getModelMetaData();i.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/models?filter=myBpmnProcessReferences&referenceId="+e.modelId).success(function(e){t.state.loadingSubprocesses=!1,t.state.subprocessError=!1,t.subProcesses=e.data,t.resetCurrent()}).error(function(){t.state.loadingSubprocesses=!1,t.state.subprocessError=!0})},t.property&&t.property.value&&t.property.value.id&&(t.selectedSubProcess=t.property.value),t.loadProcesses()}]),angular.module("activitiModeler").controller("KisBpmFormReferencePopupCrtl",["$rootScope","$scope","$http","$location","EventTrackingService","ProcessScopeService","httpUtils",function(e,t,i,o,n,r,a){t.state={loadingForms:!0,formError:!1},t.popup={state:"formReference"},t.foldersBreadCrumbs=[],t.$parent.$on("modal.hide.before",function(){t.close(),t.$parent.$apply()}),t.close=function(){t.property.newVariablesMapping=void 0,t.property.mode="read",t.$hide()},t.selectForm=function(e,i){i.stopPropagation(),t.selectedForm&&t.selectedForm.id&&e.id==t.selectedForm.id?t.selectedForm=null:(t.selectedForm=e,t.selectedForm&&(t.selectedForm.variablesmapping=[],t.property.newVariablesMapping=void 0))},t.isReusableSelected=function(){return t.isSelected()&&t.isGlobal()&&!t.state.formError},t.isSelected=function(){return t.selectedForm&&t.selectedForm.id?!0:!1},t.isGlobal=function(){return null===t.selectedForm.referenceId?!0:!1},t.save=function(){t.property.newVariablesMapping&&(t.selectedForm.variablesmapping=t.property.newVariablesMapping),t.property.value=t.selectedForm?{id:t.selectedForm.id,name:t.selectedForm.name,referenceId:t.selectedForm.referenceId,variablesmapping:t.selectedForm.variablesmapping}:null,t.updatePropertyInModel(t.property),r.refresh(),t.close()},t.open=function(){if(t.selectedForm){t.property.value={id:t.selectedForm.id,name:t.selectedForm.name,referenceId:t.selectedForm.referenceId,variablesmapping:t.selectedForm.variablesmapping},t.updatePropertyInModel(t.property);var o=t.editor.getModelMetaData(),n=t.editor.getJSON();n=JSON.stringify(n);var s={modeltype:o.model.modelType,json_xml:n,name:o.name,description:o.description,newversion:!1,lastUpdated:o.lastUpdated};e.readOnly?r.navigateForward("form-editor/"+encodeURIComponent(t.selectedForm.id),t.selectedShape.resourceId):i({method:"POST",data:s,ignoreErrors:!0,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:a.encode,url:KISBPM.URL.putModel(o.modelId)}).success(function(){t.editor.handleEvents({type:ORYX.CONFIG.EVENT_SAVED}),r.navigateForward("form-editor/"+encodeURIComponent(t.selectedForm.id),t.selectedShape.resourceId)}).error(function(){}),t.close()}},t.mapVariables=function(){t.popup.state="mapping";var e=t.editor.getModelMetaData();t.model={loading:!1,form:{name:"",description:"",modelType:2,referenceId:e.modelId,stencilSet:0},defaultStencilSet:void 0,formStencilSets:[]},t.storedId=t.selectedForm.id},t.newForm=function(){t.property.value.variablesmapping=[],t.popup.state="newForm";var o=t.editor.getModelMetaData();t.model={loading:!1,form:{name:"",description:"",modelType:2,referenceId:o.modelId,stencilSet:0},defaultStencilSet:void 0,formStencilSets:[]},"enterprise"===e.account.type&&(t.model.loading=!0,i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/available-form-stencil-sets"}).success(function(e){if(t.model.formStencilSets=e.data,t.model.stencilSets&&t.model.stencilSets.length>0)for(var i=0;t.model.stencilSets.length>i;i++)if(t.model.stencilSets[i].defaultStencilSet){t.model.defaultStencilSet=t.model.stencilSets[i],t.model.form.stencilSet=t.defaultStencilSet.id;break}t.model.loading=!1}).error(function(){t.model.loading=!1}))},t.createForm=function(){if(t.model.form.name&&0!=t.model.form.name.length){var e=t.model.form.stencilSet;t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",data:t.model.form}).success(function(o){n.trackEvent("editor","form-model-create-via-bpmneditor");
var s=o.id;t.property.value={id:s,name:o.name,referenceId:o.referenceId,variablesmapping:o.variablesmapping},t.updatePropertyInModel(t.property);var l=t.editor.getModelMetaData(),d=t.editor.getJSON();d=JSON.stringify(d);var c={modeltype:l.model.modelType,json_xml:d,name:l.name,description:l.description||"",newversion:!1,lastUpdated:l.lastUpdated,stencilSet:e};i({method:"POST",data:c,ignoreErrors:!0,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:a.encode,url:KISBPM.URL.putModel(l.modelId)}).success(function(){t.editor.handleEvents({type:ORYX.CONFIG.EVENT_SAVED}),t.model.loading=!1,t.$hide(),r.navigateForward("form-editor/"+encodeURIComponent(s),t.selectedShape.resourceId)}).error(function(){t.model.loading=!1,t.$hide()})}).error(function(){t.model.loading=!1,t.$hide()})}},t.cancel=function(){t.close()},t.resetCurrent=function(){for(var e=0,i=!1;t.forms.length>e&&i===!1;e++){var o=t.forms[e];if(o.id===t.property.value.id){var n=t.selectedForm.variablesmapping;t.selectedForm=o,t.selectedForm.variablesmapping=n,i=!0}}},t.loadForms=function(){var e=t.editor.getModelMetaData();i.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models?referenceId="+e.modelId).success(function(e){t.state.loadingForms=!1,t.state.formError=!1,t.forms=e.data,t.resetCurrent()}).error(function(){t.state.loadingForms=!1,t.state.formError=!0})},t.property&&t.property.value&&t.property.value.id&&(t.selectedForm=t.property.value),t.loadForms()}]),angular.module("activitiModeler").controller("ActivitiDecisionTableReferencePopupCtrl",["$rootScope","$scope","$http","$location","EventTrackingService","ProcessScopeService","httpUtils",function(e,t,i,o,n,r,a){t.state={loadingDecisionTables:!0,decisionTableError:!1},t.popup={state:"decisionTableReference"},t.foldersBreadCrumbs=[],t.$parent.$on("modal.hide.before",function(){t.close(),t.$parent.$apply()}),t.close=function(){t.property.newVariablesMapping=void 0,t.property.mode="read",t.$hide()},t.selectDecisionTable=function(e,i){i.stopPropagation(),t.selectedDecisionTable&&t.selectedDecisionTable.id&&e.id==t.selectedDecisionTable.id?t.selectedDecisionTable=null:(t.selectedDecisionTable=e,t.selectedDecisionTable&&(t.selectedDecisionTable.variablesmapping=[],t.property.newVariablesMapping=void 0))},t.isReusableSelected=function(){return t.isSelected()&&t.isGlobal()&&!t.state.decisionTableError},t.isSelected=function(){return t.selectedDecisionTable&&t.selectedDecisionTable.id?!0:!1},t.isGlobal=function(){return null===t.selectedDecisionTable.referenceId?!0:!1},t.save=function(){t.property.newVariablesMapping&&(t.selectedDecisionTable.variablesmapping=t.property.newVariablesMapping),t.property.value=t.selectedDecisionTable?{id:t.selectedDecisionTable.id,name:t.selectedDecisionTable.name,referenceId:t.selectedDecisionTable.referenceId,variablesmapping:t.selectedDecisionTable.variablesmapping}:null,t.updatePropertyInModel(t.property),r.refresh(),t.close()},t.open=function(){if(t.selectedDecisionTable){t.property.value={id:t.selectedDecisionTable.id,name:t.selectedDecisionTable.name,referenceId:t.selectedDecisionTable.referenceId,variablesmapping:t.selectedDecisionTable.variablesmapping},t.updatePropertyInModel(t.property);var o=t.editor.getModelMetaData(),n=t.editor.getJSON();n=JSON.stringify(n);var s={modeltype:o.model.modelType,json_xml:n,name:o.name,description:o.description,newversion:!1,lastUpdated:o.lastUpdated};e.readOnly?r.navigateForward("decision-table-editor/"+encodeURIComponent(t.selectedDecisionTable.id),t.selectedShape.resourceId):i({method:"POST",data:s,ignoreErrors:!0,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:a.encode,url:KISBPM.URL.putModel(o.modelId)}).success(function(){t.editor.handleEvents({type:ORYX.CONFIG.EVENT_SAVED}),r.navigateForward("decision-table-editor/"+encodeURIComponent(t.selectedDecisionTable.id),t.selectedShape.resourceId)}).error(function(){}),t.close()}},t.mapVariables=function(){t.popup.state="mapping";var e=t.editor.getModelMetaData();t.model={loading:!1,decisionTable:{name:"",description:"",modelType:4,referenceId:e.modelId,stencilSet:0},defaultStencilSet:void 0,decisionTableStencilSets:[]},t.storedId=t.selectedDecisionTable.id},t.newDecisionTable=function(){t.property&&t.property.value&&(t.property.value.variablesmapping=[]),t.popup.state="newDecisionTable";var e=t.editor.getModelMetaData();t.model={loading:!1,decisionTable:{name:"",description:"",modelType:4,referenceId:e.modelId,stencilSet:0},defaultStencilSet:void 0,decisionTableStencilSets:[]}},t.createDecisionTable=function(){if(t.model.decisionTable.name&&0!=t.model.decisionTable.name.length){var e=t.model.decisionTable.stencilSet;t.model.loading=!0,i({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/models",data:t.model.decisionTable}).success(function(o){n.trackEvent("editor","decision-table-model-create-via-bpmneditor");var s=o.id;t.property.value={id:s,name:o.name,referenceId:o.referenceId,variablesmapping:o.variablesmapping},t.updatePropertyInModel(t.property);var l=t.editor.getModelMetaData(),d=t.editor.getJSON();d=JSON.stringify(d);var c={modeltype:l.model.modelType,json_xml:d,name:l.name,description:l.description,newversion:!1,lastUpdated:l.lastUpdated,stencilSet:e};i({method:"POST",data:c,ignoreErrors:!0,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:a.encode,url:KISBPM.URL.putModel(l.modelId)}).success(function(){t.editor.handleEvents({type:ORYX.CONFIG.EVENT_SAVED}),t.model.loading=!1,t.$hide(),r.navigateForward("decision-table-editor/"+encodeURIComponent(s),t.selectedShape.resourceId)}).error(function(){t.model.loading=!1,t.$hide()})}).error(function(){t.model.loading=!1,t.$hide()})}},t.cancel=function(){t.close()},t.resetCurrent=function(){for(var e=0,i=!1;t.decisionTables.length>e&&i===!1;e++){var o=t.decisionTables[e];if(t.property&&t.property.value&&t.property.value.id===o.id){var n=t.selectedDecisionTable.variablesmapping;t.selectedDecisionTable=o,t.selectedDecisionTable.variablesmapping=n,i=!0}}},t.loadDecisionTables=function(){var e=t.editor.getModelMetaData();i.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/decision-table-models?referenceId="+e.modelId).success(function(e){t.state.loadingDecisionTables=!1,t.state.decisionTableError=!1,t.decisionTables=e.data,t.resetCurrent()}).error(function(){t.state.loadingDecisionTables=!1,t.state.decisionTableError=!0})},t.property&&t.property.value&&t.property.value.id&&(t.selectedDecisionTable=t.property.value,t.storedId=t.property.value.id),t.loadDecisionTables()}]),angular.module("activitiModeler").controller("KisBpmSequenceFlowOrderPopupCtrl",["$scope","$translate",function(e,t){var i=[],o=e.selectedShape;if(o){for(var n=o.getOutgoingShapes(),r=0;n.length>r;r++)if("BPMN-EDITOR.ITEM.SEQUENCE-FLOW.TITLE"===n[r].getStencil().title()){var a=n[r].getTarget();i.push({id:n[r].resourceId,targetTitle:a.properties["oryx-name"],targetType:t.instant(a.getStencil().title())})}}else console.log("Programmatic error: no selected shape found");var s=[];if(e.property.value&&e.property.value.sequenceFlowOrder){for(var l=e.property.value.sequenceFlowOrder,d=0;l.length>d;d++)for(var c=0;i.length>c;c++)if(i[c].id===l[d]){s.push(i[c]),i.splice(c,1);break}s=s.concat(i)}else s=i;e.outgoingSequenceFlow=s,e.moveUp=function(t){var i=e.outgoingSequenceFlow[t];e.outgoingSequenceFlow[t]=e.outgoingSequenceFlow[t-1],e.outgoingSequenceFlow[t-1]=i},e.moveDown=function(t){var i=e.outgoingSequenceFlow[t];e.outgoingSequenceFlow[t]=e.outgoingSequenceFlow[t+1],e.outgoingSequenceFlow[t+1]=i},e.save=function(){if(e.outgoingSequenceFlow.length>0){e.property.value={},e.property.value.sequenceFlowOrder=[];for(var t=0;e.outgoingSequenceFlow.length>t;t++)e.property.value.sequenceFlowOrder.push(e.outgoingSequenceFlow[t].id)}else e.property.value=null;e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("KisBpmConditionExpressionPopupCtrl",["$rootScope","$scope","$translate","FormBuilderService","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r){function a(e){return e?t.model.conditionOperatorsByType[e].operators:[]}t.model={condition:{}};var s=i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.EQUALS"),l=i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.NOTEQUALS"),d=[{value:"==",description:s},{value:"!=",description:l},{value:"<",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY")},{value:"notEmpty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY")}],c=[{value:"==",description:s},{value:"!=",description:l},{value:"empty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY")},{value:"notEmpty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY")}];t.model.conditionOperatorsByType={text:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:d},string:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:d},"multi-line-text":{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:d},date:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:[{value:"==",description:s},{value:"!=",description:l},{value:"<",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.BEFORE")},{value:">",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.AFTER")},{value:"<=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.BEFOREOREQUAL")},{value:">=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.DATE.AFTEROREQUAL")},{value:"empty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY")},{value:"notEmpty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY")}]},integer:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:[{value:"==",description:s},{value:"!=",description:l},{value:"<",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY")},{value:"notEmpty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY")}]},"long":{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:[{value:"==",description:s},{value:"!=",description:l},{value:"<",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY")},{value:"notEmpty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY")}]},number:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:[{value:"==",description:s},{value:"!=",description:l},{value:"<",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY")},{value:"notEmpty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY")}]},amount:{index:{"==":0,"!=":1,"<":2,">":3,"<=":4,">=":5,empty:6,notEmpty:7},operators:[{value:"==",description:s},{value:"!=",description:l},{value:"<",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN")},{value:">",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN")},{value:"<=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL")},{value:">=",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL")},{value:"empty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY")},{value:"notEmpty",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY")}]},dropdown:{index:{"==":0,"!=":1,empty:2,notEmpty:3},operators:c},typeahead:{index:{"==":0,"!=":1,empty:2,notEmpty:3},operators:c},"radio-buttons":{index:{"==":0,"!=":1,empty:2,notEmpty:3},operators:c},"boolean":{index:{"==":0,"!=":1,empty:2,notEmpty:3},operators:[{value:"==",description:s},{value:"!=",description:l}]},condition:{index:{and:0,"and-not":1,or:2,"or-not":3},operators:[{value:"and",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.AND")},{value:"and-not",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.ANDNOT")},{value:"or",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.OR")},{value:"or-not",description:i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.CONDITION.ORNOT")}]}},t.model.rightTypes=[{value:"string",description:i.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.STRING")},{value:"number",description:i.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.NUMBER")},{value:"date",description:i.instant("FORM-BUILDER.VISIBILITY.RIGHT_TYPES.CONDITION.DATE")}],t.model.rightValueOptions={"boolean":[{value:"true",description:i.instant("FORM-BUILDER.VISIBILITY.RIGHT_VALUE_OPTIONS.BOOLEAN.CHECKED")},{value:"false",description:i.instant("FORM-BUILDER.VISIBILITY.RIGHT_VALUE_OPTIONS.BOOLEAN.UNCHECKED")}]},void 0!==t.property.value&&null!==t.property.value&&void 0!==t.property.value.expression&&null!==t.property.value.expression&&(t.model.condition=angular.copy(t.property.value.expression),t.model.condition.nextCondition?t.model.condition.type="advanced":t.model.condition.type||(t.model.condition.fieldId?(t.model.condition.leftFormFieldId=t.model.condition.fieldId,t.model.condition.type="variables"):t.model.condition.responseVariableName?(t.model.condition.leftRestResponseId=t.model.condition.responseVariableName,t.model.condition.type="variables"):t.model.condition.outcomeFormId&&(t.model.condition.rightOutcomeFormId=t.model.condition.outcomeFormId,t.model.condition.rightOutcomeFormName=t.model.condition.outcomeFormName,t.model.condition.outcomeName&&(t.model.condition.rightOutcomeName=t.model.condition.outcomeName),t.model.condition.type="variables"),t.model.condition.value&&(t.model.condition.rightValue=t.model.condition.value,t.model.condition.value=void 0),t.model.condition.fieldId=void 0,t.model.condition.fieldType=void 0,t.model.condition.fieldName=void 0,t.model.condition.outcomeName=void 0,t.model.condition.value=void 0)),t.model.condition.type||(t.model.condition.type="none"),"variables"===t.model.condition.type?t.model.condition.leftFieldType=t.model.condition.outcomeFormId?"outcome":t.model.condition.leftRestResponseId?"restResponse":"formField":"static"===t.model.condition.type&&(t.model.condition.staticValue||(t.model.condition.type="none")),t.getOperatorLabel=function(e){return"=="==e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.EQUALS"):"!="==e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.NOTEQUALS"):"<"==e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHAN"):">"==e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHAN"):"empty"==e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISEMPTY"):"notEmpty"==e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.ISNOTEMPTY"):">="==e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.GREATERTHANOREQUAL"):"<="==e.condition.operator?i.instant("FORM-BUILDER.VISIBILITY.OPERATORS.INTEGER.LESSTHANOREQUAL"):i.instant("PROCESS-BUILDER.CHOICE-STEP.CONDITION.SELECT-OPERATOR")},t.detectDefaultRightFieldType=function(e){if(null!==e&&void 0!==e&&void 0!==e.leftFieldType){if("formField"===e.leftFieldType)return"staticValue";if("outcome"===e.leftFieldType)return"outcome";if("restResponse"===e.leftFieldType)return"staticValue"}return void 0},t.changeLeftOperandType=function(e){if(t.hasCondition()){var i=t.model.condition;i.leftFieldType=e,i.leftRestResponseId=void 0,i.leftFormFieldId=void 0,i.outcomeFormId=void 0,i.outcomeFormName=void 0,i.operator=void 0,i.rightFormFieldId=void 0,i.rightRestResponseId=void 0,i.rightValue=void 0,i.rightOutcomeFormId=void 0,i.rightOutcomeFormName=void 0,i.rightOutcomeName=void 0,i.rightFieldType=t.detectDefaultRightFieldType(i)}},t.isSimpleCondition=function(){return t.hasCondition()&&"variables"===t.model.condition.type},t.isOperatorSelected=function(){return t.hasCondition()&&void 0!==t.model.condition.operator},t.isLeftSideSelected=function(){return t.hasCondition()&&t.model.condition.outcomeFormId||t.model.condition.leftFormFieldId||t.model.condition.leftRestResponseId},t.hasCondition=function(){return null!==t.model.condition&&void 0!==t.model.condition},t.allowRightHandSide=function(){return t.hasCondition()&&"empty"!==t.model.condition.operator&&"notEmpty"!==t.model.condition.operator},t.isFormFieldCondition=function(){return t.hasCondition()&&("formField"===t.model.condition.leftFieldType||!t.model.condition.leftFieldType)},t.isFormOutcomeCondition=function(){return t.hasCondition()&&"outcome"===t.model.condition.leftFieldType},t.isRestResponseCondition=function(){return t.hasCondition()&&"restResponse"===t.model.condition.leftFieldType},t.prepareForSave=function(){var e=function(t,i){t&&(t.nextCondition=void 0);var o={};return i.length>0?(o=i.shift(),t.nextCondition=o,e(t.nextCondition,i),void 0):o},i=function(e){if(e&&e.length>0){var t=0;for(t=0;e.length>t;t++)e[t]&&(void 0!=e[t].leftFieldType&&("formField"===e[t].leftFieldType?(e[t].leftRestResponseId=void 0,e[t].outcomeFormId=void 0,e[t].outcomeFormName=void 0,"variables"===e[t].type&&(e[t].rightRestResponseId=void 0,e[t].rightOutcomeFormId=void 0,e[t].rightOutcomeName=void 0,e[t].rightFormFieldId=void 0,e[t].rightFieldType=void 0)):"restResponse"===e[t].leftFieldType?(e[t].leftFormFieldId=void 0,e[t].outcomeFormId=void 0,e[t].outcomeFormName=void 0,"variables"===e[t].type&&(e[t].rightRestResponseId=void 0,e[t].rightOutcomeFormId=void 0,e[t].rightOutcomeName=void 0,e[t].rightFormFieldId=void 0,e[t].rightFieldType=void 0)):"outcome"===e[t].leftFieldType&&(e[t].leftFormFieldId=void 0,e[t].leftRestResponseId=void 0,"variables"===e[t].type&&(e[t].rightRestResponseId=void 0,e[t].rightValue=void 0,e[t].rightFormFieldId=void 0)),e[t].leftFieldType=void 0),void 0!=e[t].rightFieldType&&("formField"===e[t].rightFieldType?(e[t].rightRestResponseId=void 0,e[t].rightValue=void 0,e[t].rightOutcomeFormId=void 0,e[t].rightOutcomeName=void 0):"restResponse"===e[t].rightFieldType?(e[t].rightFormFieldId=void 0,e[t].rightValue=void 0,e[t].rightOutcomeFormId=void 0,e[t].rightOutcomeName=void 0):"outcome"===e[t].rightFieldType?(e[t].rightRestResponseId=void 0,e[t].rightValue=void 0,e[t].rightFormFieldId=void 0):"staticValue"===e[t].rightFieldType&&(e[t].rightFormFieldId=void 0,e[t].rightRestResponseId=void 0,e[t].rightOutcomeFormId=void 0,e[t].rightOutcomeFormName=void 0,e[t].rightOutcomeName=void 0),e[t].rightFieldType=void 0),void 0!=e[t].$$hashKey&&(e[t].$$hashKey=void 0))}};if("variables"===t.model.condition.type){t.model.condition.nextCondition=void 0,t.model.condition.nextConditionOperator=void 0;var o=[t.model.condition];o=p(o),i(o),t.flowCondition=o[0]}else if("advanced"===t.model.condition.type){t.tabFlowConditions=p(t.tabFlowConditions),i(t.tabFlowConditions);var n=t.tabFlowConditions.shift();e(n,t.tabFlowConditions),t.flowCondition=n,t.flowCondition&&(t.flowCondition.type="advanced")}else t.flowCondition=void 0};var p=function(e){return e.filter(function(e){return!!(void 0!=e.leftFormFieldId&&""!=e.leftFormFieldId||void 0!=e.leftOutcomeFormId&&""!=e.leftOutcomeFormId||void 0!=e.leftRestResponseId&&""!=e.leftRestResponseId||void 0!=e.operator&&""!=e.operator||void 0!=e.rightValue&&""!=e.rightValue||void 0!=e.rightFormFieldId&&""!=e.rightFormFieldId||void 0!=e.rightOutcomeFormId&&""!=e.rightOutcomeFormId||void 0!=e.rightRestResponseId&&""!=e.rightRestResponseId)})};t.save=function(){function e(e){return e&&"static"!=e.expression.type&&(e.expression.staticValue=void 0,void 0==e.expression.leftFormFieldId&&void 0==e.expression.leftRestResponseId&&void 0==e.expression.outcomeFormId&&void 0==e.expression.rightFormFieldId&&void 0==e.expression.rightRestResponseId&&void 0==e.expression.rightOutcomeFormId&&void 0==e.expression.rightValue&&(e="")),e}var i="";"none"===t.model.condition.type?t.property.value=void 0:(t.prepareForSave(),t.flowCondition?i={expression:t.flowCondition}:"static"===t.model.condition.type&&(i={expression:{type:"static",staticValue:t.model.condition.staticValue}}),t.property.value=e(i)),t.updatePropertyInModel(t.property),t.close()},t.$parent.$on("modal.hide.before",function(){t.close(),t.$parent.$apply()}),t.close=function(){t.property.mode="read",t.$hide()},t.allSteps=r.collectSortedElementsFromPrecedingElements(t.selectedShape);var u=["text","multi-line-text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount"];t.refreshAvailableFormFields=function(){var e=r.collectSortedElementsFromPrecedingElements(t.selectedShape);t.availableFormFields=n.getFormFieldsForStep(e,t.selectedShape.resourceId,u)},t.refreshAvailableForms=function(){var e=r.collectSortedElementsFromPrecedingElements(t.selectedShape);t.availableForms=n.getFormsForStep(e,t.selectedShape.resourceId)},t.refreshAvailableOutcomes=function(e){e&&(t.availableFormOutcomes=n.getFormOutcomesForForm(e))},t.refreshAvailableResponseVariables=function(){var e=r.collectSortedElementsFromPrecedingElements(t.selectedShape),i=n.getVariablesForStep(e,t.selectedShape.resourceId);t.availableRestResponseVariables=i},t.selectConditionField=function(e,i){e.leftFormFieldId!==i.id&&(e.leftFormFieldId=i.id,t.model.condition.operator=void 0,t.model.condition.rightValue=void 0)},t.selectChoiceForm=function(e){var i=t.model.condition;i.outcomeFormId!==e.id&&(i.outcomeFormId=e.id,i.outcomeFormName=e.name,i.rightOutcomeName=void 0,i.operator=void 0,t.refreshAvailableOutcomes(e.id))},t.selectConditionOutcome=function(e,t){e.rightOutcomeName=t.name,e.rightOutcomeFormId=e.outcomeFormId,e.rightOutcomeFormName=e.outcomeFormName},t.selectResponseVariable=function(e,i){e.leftRestResponseId!==i.processVariableName&&(e.leftRestResponseId=i.processVariableName,t.model.condition.operator=void 0,t.model.condition.rightValue=void 0)},t.getOperatorsForSelectedFieldType=function(){return"formField"===t.model.condition.leftFieldType?a(m(t.model.condition.leftFormFieldId)):"restResponse"===t.model.condition.leftFieldType?a(h(t.model.condition.leftRestResponseId)):void 0};var m=function(e){var i="";if(e)for(var o=0;t.availableFormFields.length>o;o++){var n=t.availableFormFields[o];if(n.id===e){i=n.type;break}}return i},h=function(e){var i="";if(e){var o=t.availableRestResponseVariables;if(o&&o.length>0)for(var n=0;o.length>n;n++){var r=o[n];if(r.processVariableName===e){i=r.processVariableType;break}}}return i.toLowerCase()}}]),angular.module("activitiModeler").controller("ActivitiSignalDefinitionsPopupCtrl",["$scope","$q","$translate","$timeout",function(e,t,i,o){e.signalDefinitions=void 0!==e.property.value&&null!==e.property.value&&e.property.value.length>0?e.property.value.constructor==String?JSON.parse(e.property.value):angular.copy(e.property.value):[],e.selectedSignalDefinition=void 0,e.translationsRetrieved=!1,e.labels={};var n=i("PROPERTY.SIGNALDEFINITIONS.ID"),r=i("PROPERTY.SIGNALDEFINITIONS.NAME"),a=i("PROPERTY.SIGNALDEFINITIONS.SCOPE");t.all([n,r,a]).then(function(t){e.labels.idLabel=t[0],e.labels.nameLabel=t[1],e.labels.scopeLabel=t[2],e.translationsRetrieved=!0,e.gridOptions={data:e.signalDefinitions,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"id",displayName:e.labels.idLabel},{field:"name",displayName:e.labels.nameLabel},{field:"scope",displayName:e.labels.scopeLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedSignalDefinition=t.entity})}}),e.addNewSignalDefinition=function(){var t={id:"",name:"",scope:"global"};e.signalDefinitions.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeSignalDefinition=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.signalDefinitions.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.signalDefinitions.splice(i,1),0==e.signalDefinitions.length&&(e.selectedSignalDefinition=void 0),o(function(){e.signalDefinitions.length>0&&e.gridApi.selection.toggleRowSelection(e.signalDefinitions[0])})}},e.scopeOptions=[{value:"global",translationId:"PROPERTY.SIGNALDEFINITIONS.SCOPE-GLOBAL"},{value:"processInstance",translationId:"PROPERTY.SIGNALDEFINITIONS.SCOPE-PROCESSINSTANCE"}],e.save=function(){e.property.value=e.signalDefinitions.length>0?e.signalDefinitions:null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.property.mode="read",e.$hide()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("ActivitiSignalRefCtrl",["$scope",function(e){for(var t=void 0,i=e.selectedShape;null!==i&&void 0!==i&&void 0===t;)i.properties&&i.properties["oryx-signaldefinitions"]?t=i.properties["oryx-signaldefinitions"]:i=i.parent;try{t=JSON.parse(t),"string"==typeof t&&(t=JSON.parse(t))}catch(o){}e.signalDefinitions=t,e.signalChanged=function(){e.updatePropertyInModel(e.property)}}]),angular.module("activitiModeler").controller("ActivitiMessageDefinitionsPopupCtrl",["$scope","$q","$translate","$timeout",function(e,t,i,o){e.messageDefinitions=void 0!==e.property.value&&null!==e.property.value&&e.property.value.length>0?e.property.value.constructor==String?JSON.parse(e.property.value):angular.copy(e.property.value):[],e.selectedMessageDefinition=void 0,e.translationsRetrieved=!1,e.labels={};var n=i("PROPERTY.MESSAGEDEFINITIONS.ID"),r=i("PROPERTY.MESSAGEDEFINITIONS.NAME");t.all([n,r]).then(function(t){e.labels.idLabel=t[0],e.labels.nameLabel=t[1],e.translationsRetrieved=!0,e.gridOptions={data:e.messageDefinitions,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"id",displayName:e.labels.idLabel},{field:"name",displayName:e.labels.nameLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedMessageDefinition=t.entity})}}),e.addNewMessageDefinition=function(){var t={id:"",name:""};e.messageDefinitions.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeMessageDefinition=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.messageDefinitions.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.messageDefinitions.splice(i,1),0==e.messageDefinitions.length&&(e.selectedMesageDefinition=void 0),o(function(){e.messageDefinitions.length>0&&e.gridApi.selection.toggleRowSelection(e.messageDefinitions[0])})}},e.save=function(){e.property.value=e.messageDefinitions.length>0?e.messageDefinitions:null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.property.mode="read",e.$hide()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("ActivitiMessageRefCtrl",["$scope",function(e){for(var t=void 0,i=e.selectedShape;null!==i&&void 0!==i&&void 0===t;)i.properties&&i.properties["oryx-messagedefinitions"]?t=i.properties["oryx-messagedefinitions"]:i=i.parent;try{t=JSON.parse(t),"string"==typeof t&&(t=JSON.parse(t))}catch(o){}e.messageDefinitions=t,e.messageChanged=function(){e.updatePropertyInModel(e.property)}}]),angular.module("activitiModeler").controller("AlfrescoContentPopupCtrl",["$scope","ProcessScopeService","EditorScopeService",function(e,t,i){e.alfrescoSourceOptions=[{id:"process",title:"Publish all content uploaded in process"},{id:"field",title:"Publish content uploaded in field"}],e.model={currentTab:"documentDefinition"},e.allSteps=i.collectSortedElementsFromPrecedingElements(e.selectedShape);var o=t.getFormFieldsForStep(e.allSteps,e.selectedShape.resourceId),n=t.getVariablesForStep(e.allSteps,e.selectedShape.resourceId);if(void 0!==e.property.value&&null!==e.property.value){for(var r=0;e.alfrescoSourceOptions.length>r;r++)if(e.alfrescoSourceOptions[r].id===e.property.value.source){e.alfrescoSourceOption=e.alfrescoSourceOptions[r];break}if(e.property.value.field){if(o&&o.length>0)for(var a=!1,r=0;o.length>r;r++)if(o[r].id===e.property.value.field){e.selectedFormField={field:o[r]},e.variableType="formField",a=!0;break}if(!a&&n&&n.length>0)for(var r=0;n.length>r;r++)if(n[r].processVariableName===e.property.value.field){e.selectedFormField={field:{id:n[r].processVariableName,name:n[r].processVariableName}},e.variableType="variable";break}e.alfrescoSourceOption=e.alfrescoSourceOptions[1]}}else e.alfrescoSourceOption={};e.selectedFormField&&void 0!==e.selectedFormField||(e.selectedFormField={}),e.variableType&&void 0!==e.variableType||(e.variableType="formField"),e.isValidForm=function(){return e.isAlfrescoSourceOptionSelected()?e.isValidAlfrescoSourceOption():!0},e.isValidAlfrescoSourceOption=function(){return e.isAlfrescoSourceOptionField()?e.isValidFormContentField():e.isAlfrescoSourceOptionProcess()?!0:void 0},e.isValidFormContentField=function(){return e.selectedFormField.field?!0:void 0},e.isAlfrescoSourceOptionSelected=function(){return e.alfrescoSourceOption},e.isAlfrescoSourceOptionField=function(){return"field"===e.alfrescoSourceOption.id},e.isAlfrescoSourceOptionProcess=function(){return"process"===e.alfrescoSourceOption.id},e.save=function(){e.alfrescoSourceOption?(e.property.value={},"process"===e.alfrescoSourceOption.id?e.property.value={source:"process"}:"field"===e.alfrescoSourceOption.id&&(e.property.value={source:"field",field:e.selectedFormField.field.id}),e.property.value.metaDataColumnDefinitions=angular.copy(e.model.metaDataColumnDefinitions),e.property.value.documentAspects=angular.copy(e.model.documentAspects),e.property.value.documentType=e.model.documentType):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()},e.setActiveTab=function(t){e.activeTab=t},e.activeTab="documentDefinition"}]),angular.module("activitiModeler").controller("KisBpmAlfrescoContentPopupDocumentDefinitionController",["$rootScope","$scope","$q","$translate","$http","$timeout","$modal",function(e,t,i,o,n,r){t.stepId=t.selectedShape.resourceId,t.labels=[],void 0!==t.property.value&&null!==t.property.value&&(t.model.documentAspects=t.model.documentAspects||angular.copy(t.property.value.documentAspects),t.model.documentType=t.model.documentType||t.property.value.documentType),t.model.documentAspects||(t.model.documentAspects=[{aspectName:"cm:titled"}]),t.model.documentType||(t.model.documentType="cmis:document",t.property.value.documentType=t.model.documentType),t.urlDynamicTableConfig={position:0,field:""};
var a=t.model.documentAspects;t.selectedDocumentAspect=void 0,t.labels.aspectName=o.instant("PROCESS-BUILDER.PUBLISH-STEP.DOCUMENT-DEFINITION.POPUP.DOCUMENT-ASPECTS-TABLE-ASPECT-NAME-HEADER"),t.documentAspectsGrid={data:a,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"aspectName",displayName:t.labels.aspectName}]},t.documentAspectsGrid.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedDocumentAspect=e.entity,t.focusFirstField()})},t.focusFirstField=function(){r(function(){var e=document.getElementById("aspectName");e&&e.focus()},100)},t.addNewDocumentAspect=function(){var e={aspectName:""};t.model.documentAspects.push(e),t.gridApi.selection.clearSelectedRows(),r(function(){t.gridApi.selection.toggleRowSelection(e)})},t.removeDocumentAspect=function(){if(t.selectedDocumentAspect){var e=t.model.documentAspects.indexOf(t.selectedDocumentAspect);t.gridApi.selection.toggleRowSelection(t.selectedDocumentAspect),t.selectedDocumentAspect=void 0,t.model.documentAspects.splice(e,1),r(function(){t.model.documentAspects.length>0&&t.gridApi.selection.toggleRowSelection(t.model.documentAspects[0])})}}}]),angular.module("activitiModeler").controller("AlfrescoMetadataPopupCtrl",["$scope","ProcessScopeService","AlfrescoService","EditorScopeService",function(e,t,i,o){e.alfrescoSourceOption={},e.model={},e.selectedFormField={},e.publishInfo={},e.alfrescoAccount={selected:""},e.allSteps=o.collectSortedElementsFromPrecedingElements(e.selectedShape),e.contentAlfrescoAccounts=i.loadAlfrescoAccounts(e.alfrescoAccount,e.accountId,e.network),e.property.value.publishInfo&&e.property.value.publishInfo.publishAsType?e.publishInfo=e.property.value.publishInfo:e.publishInfo.publishAsType="process_initiator",e.property.value.inputSourceField&&(e.selectedFormField.inputSourceField={id:e.property.value.inputSourceField,name:e.property.value.inputSourceField}),e.save=function(){e.alfrescoSourceOption?(e.property.value={},e.property.value={source:"field",inputSourceField:e.selectedFormField.inputSourceField.id,publishInfo:e.publishInfo},e.property.value.metaDataColumnDefinitions=e.model.metaDataColumnDefinitions,e.property.value.documentAspects=e.model.documentAspects,e.property.value.documentType=e.model.documentType):e.property.value=null,e.updatePropertyInModel(e.property),t.refresh(),e.close()},e.cancel=function(){e.close()},e.close=function(){e.property.mode="read",e.$hide()},e.setVariableType=function(t){e.variableType=t},e.addPublishAs=function(t,i){t?(e.publishInfo.user=t.id,e.publishInfo.userField=null,e.publishInfo.userName=t.firstName?t.firstName+" "+t.lastName:t.lastName,e.publishInfo.email=t.email,e.publishInfo.externalId=t.externalId):(e.publishInfo.user=null,e.publishInfo.email=null,e.publishInfo.externalId=null,e.publishInfo.userField=i),e.property.value.publishAsType="user"},e.setPublishAs=function(t){"process_initiator"===t&&(e.publishInfo.user=void 0,e.publishInfo.userName=void 0,e.publishInfo.email=void 0,e.publishInfo.externalId=void 0),e.publishInfo.publishAsType=t}}]),angular.module("activitiModeler").directive("metadataGrid",[function(){return{restrict:"E",templateUrl:"views/process-builder/publish-step-metadata-mapping-directive-template.html",link:function(e,t,i){e.readonly=e.$eval(i.ngReadonly),e.newvariableallowed=e.$eval(i.newVariableAllowed)}}}]),angular.module("activitiModeler").controller("PublishStepMetadataMappingController",["$rootScope","$scope","$q","$translate","$http","$timeout","$modal","uiGridConstants",function(e,t,i,o,n,r,a,s){t.labels=[];var l=[];t.step&&(void 0!==t.property.value&&null!==t.property.value&&(t.step.metaDataColumnDefinitions=t.property.value.metaDataColumnDefinitions),t.step.metaDataColumnDefinitions||(t.step.metaDataColumnDefinitions=[]),l=t.step.metaDataColumnDefinitions),t.propertyTypes=["boolean","date","number","string"],t.urlDynamicTableConfig={position:0,field:""},t.metaDataSelectedColumnDefinition=void 0,t.labels.filePropertyLabel=o.instant("FORM-BUILDER.COMPONENT.ATTACH-FILE.METADATA.HEADER-FILE-PROPERTY"),t.labels.variableLabel=o.instant("FORM-BUILDER.COMPONENT.ATTACH-FILE.METADATA.HEADER-VARIABLE"),t.labels.formFieldLabel=o.instant("FORM-BUILDER.COMPONENT.ATTACH-FILE.METADATA.HEADER-FORM-FIELD"),t.setValueType=function(e){t.metaDataSelectedColumnDefinition.valueType=e},t.metaDataGridOptions={data:l,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"fileProperty",displayName:t.labels.filePropertyLabel},{field:"formField",displayName:t.labels.formFieldLabel,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getMappingColumnValue("formField",row.entity)}}</div>'},{field:"processVariable",displayName:t.labels.variableLabel,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getMappingColumnValue("processVariable",row.entity)}}</div>'}]},t._getMappingColumnValue=function(e,t){var i="";return t?(t[e]&&(i=t[e].name),i):i},t.metaDataGridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.metaDataSelectedColumnDefinition=e.entity})},t.addNewPropertyMapping=function(){t.popup={selectedPropertyMapping:{propertyType:"String",propertyValueType:"field"}},_internalCreateModal({template:"views/popup/map-metadata-property.html?version="+Date.now(),scope:t},a,t)},t.removePropertyMapping=function(){if(t.metaDataSelectedColumnDefinition){var e=t.step.metaDataColumnDefinitions.indexOf(t.metaDataSelectedColumnDefinition);t.gridApi.selection.toggleRowSelection(t.metaDataSelectedColumnDefinition),t.step.metaDataColumnDefinitions.splice(e,1),r(function(){t.step.metaDataColumnDefinitions.length>0?t.gridApi.selection.toggleRowSelection(t.step.metaDataColumnDefinitions[0]):t.metaDataSelectedColumnDefinition=void 0})}};var d=function(e){t.popup={selectedPropertyMapping:{propertyName:t.metaDataSelectedColumnDefinition.fileProperty,propertyValueFormField:t.metaDataSelectedColumnDefinition.formField,propertyValueVariable:t.metaDataSelectedColumnDefinition.processVariable,propertyType:t.metaDataSelectedColumnDefinition.propertyType}},t.popup.selectedPropertyMapping.propertyValueFormField?t.popup.selectedPropertyMapping.propertyValueType="field":t.popup.selectedPropertyMapping.propertyValueVariable&&(t.popup.selectedPropertyMapping.propertyValueType="variable"),t.popup.selectedPropertyMapping.state=e,_internalCreateModal({template:"views/popup/map-metadata-property.html?version="+Date.now(),scope:t},a,t)};t.editPropertyMapping=function(){d("edit")},t.showPropertyMapping=function(){d("view")},t.setPropertyMappingFormFieldValue=function(){t.popup.selectedPropertyMapping.propertyValueType="field"},t.setPropertyMappingVariableValue=function(){t.popup.selectedPropertyMapping.propertyValueType="variable"},t.setPropertyMappingStaticValue=function(){t.popup.selectedPropertyMapping.propertyValueType="static"},t.cancelPropertyMapping=function(){t.popup.selectedPropertyMapping=void 0,t.modal.hide()},t.savePropertyMapping=function(){"field"===t.popup.selectedPropertyMapping.propertyValueType?t.popup.selectedPropertyMapping.propertyValueVariable=void 0:"variable"===t.popup.selectedPropertyMapping.propertyValueType&&(t.popup.selectedPropertyMapping.propertyValueFormField=void 0),"edit"===t.popup.selectedPropertyMapping.state&&(t.metaDataSelectedColumnDefinition.fileProperty=t.popup.selectedPropertyMapping.propertyName,t.metaDataSelectedColumnDefinition.formField=t.popup.selectedPropertyMapping.propertyValueFormField,t.metaDataSelectedColumnDefinition.processVariable=t.popup.selectedPropertyMapping.propertyValueVariable,t.metaDataSelectedColumnDefinition.propertyType=t.popup.selectedPropertyMapping.propertyType,t.gridApi.core.notifyDataChange(s.dataChange.ALL),t.gridApi.selection.toggleRowSelection(t.metaDataSelectedColumnDefinition)),"edit"!==t.popup.selectedPropertyMapping.state&&(t.metaDataSelectedColumnDefinition={fileProperty:t.popup.selectedPropertyMapping.propertyName,formField:t.popup.selectedPropertyMapping.propertyValueFormField,processVariable:t.popup.selectedPropertyMapping.propertyValueVariable,propertyValueType:t.popup.selectedPropertyMapping.propertyValueType,propertyType:t.popup.selectedPropertyMapping.propertyType},t.step.metaDataColumnDefinitions.push(t.metaDataSelectedColumnDefinition)),t.metaDataSelectedColumnDefinition.processVariable&&(t.metaDataSelectedColumnDefinition.processVariable.type=void 0,t.metaDataSelectedColumnDefinition.processVariable.$$hashKey=void 0),t.popup.selectedPropertyMapping=void 0,t.modal.hide()}}]),angular.module("activitiModeler").controller("PublishStepDocumentDefinitionController",["$rootScope","$scope","$q","$translate","$http","$timeout","$modal","uiGridConstants",function(e,t,i,o,n,r){t.labels=[];var a=[];t.step&&(void 0!==t.property.value&&null!==t.property.value&&(t.step.documentAspects=t.property.value.documentAspects,t.step.documentType=t.property.value.documentType),t.step.documentAspects||(t.step.documentAspects=[{aspectName:"cm:titled"}]),t.step.documentType||(t.step.documentType="cmis:document"),a=t.step.documentAspects),t.selectedDocumentAspect=void 0,t.labels.aspectName=o.instant("PROCESS-BUILDER.PUBLISH-STEP.DOCUMENT-DEFINITION.POPUP.DOCUMENT-ASPECTS-TABLE-ASPECT-NAME-HEADER"),t.documentAspectsGrid={data:a,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"aspectName",displayName:t.labels.aspectName}]},t.documentAspectsGrid.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedDocumentAspect=e.entity,t.focusFirstField()})},t.focusFirstField=function(){r(function(){var e=document.getElementById("aspectName");e&&e.focus()},100)},t.addNewDocumentAspect=function(){var e={aspectName:""};a.push(e),t.gridApi.selection.clearSelectedRows(),r(function(){t.gridApi.selection.toggleRowSelection(e)})},t.removeDocumentAspect=function(){if(t.selectedDocumentAspect){var e=a.indexOf(t.selectedDocumentAspect);t.gridApi.selection.toggleRowSelection(t.selectedDocumentAspect),t.selectedDocumentAspect=void 0,a.splice(e,1),r(function(){a.length>0&&t.gridApi.selection.toggleRowSelection(a[0])})}}}]),angular.module("activitiModeler").controller("KisBpmAlfrescoDestinationPopupCtrl",["$rootScope","$scope","$http","AlfrescoService","UserService","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r,a){var s;if(t.allowedTypes=["upload"],void 0!==t.property.value&&null!==t.property.value&&(t.accountId=t.property.value.account,t.network=t.property.value.network,t.siteId=t.property.value.site,t.pathId=t.property.value.path,t.userId=t.property.value.user,t.userName=t.property.value.username,t.userEmail=t.property.value.email,t.externalUserId=t.property.value.externalId,t.publishAsType=t.property.value.publish_as_type,t.site=t.property.value.site_title,t.path=t.property.value.path_title,s=t.property.value.folder),t.popup={assignmentObject:{candidateUsers:[],candidateGroups:[]}},t.createOrUpdateProcessVariableIfExist=function(e,t,i){var o=[{processVariableName:t,processVariableType:i}];r.updateResponseVariablesCache(e,o)},t.selectDestinationFolder=function(e){e.account&&(t.accountId=e.account.id),e.network&&(t.network=e.network),e.site&&e.path&&(t.siteId=e.site.id,t.pathId=e.path.id,t.path=e.path.title,t.site=e.site.title)},t.setPublishAs=function(e){"process_initiator"===e&&(t.userId=void 0,t.userName=void 0,t.userEmail=void 0,t.externalUserId=void 0),t.publishAsType=e},t.publishAsType||(t.publishAsType="process_initiator"),t.alfrescoAccount={selected:""},t.resetDestination=function(){t.network=void 0,t.site=void 0,t.path=void 0,t.userId=void 0,t.userEmail=void 0,t.externalUserId=void 0,t.userName=void 0,t.accountId=void 0,t.selectedFolder=void 0},t.contentAlfrescoAccounts=t.accountId?o.loadAlfrescoAccounts(t.alfrescoAccount,{id:t.accountId},t.network):t.network?o.loadAlfrescoAccounts(t.alfrescoAccount,t.accountId,{id:t.network}):o.loadAlfrescoAccounts(t.alfrescoAccount,t.accountId,t.network),t.$watch("popup.filter",function(){t.updateFilter()}),t.updateFilter=function(){(void 0==t.popup.oldFilter||t.popup.oldFilter!=t.popup.filter)&&(t.popup.oldFilter=t.popup.filter?t.popup.filter:"",null!==t.popup.filter&&void 0!==t.popup.filter&&n.getFilteredUsers(t.popup.filter).then(function(e){for(var i=[],o=0;e.data.length>o;o++){var n=e.data[o],r=!1;if(null!==t.popup.assignmentObject.candidateUsers&&void 0!==t.popup.assignmentObject.candidateUsers)for(var a=0;t.popup.assignmentObject.candidateUsers.length>a;a++){var s=t.popup.assignmentObject.candidateUsers[a];if(s.id===n.id){r=!0;break}}r||i.push(n)}t.popup.userResults=i,t.resetSelection()}))},t.confirmUser=function(e){if(!e){var i=t.popup.userResults;t.popup.selectedIndex>=0&&t.popup.selectedIndex<i.length&&(e=i[t.popup.selectedIndex])}e&&(t.popup.assignmentObject.assignee=e,t.userId=e.id,t.userEmail=e.email,t.externalUserId=e.externalId,t.userName=e.firstName?e.firstName+" "+e.lastName:e.lastName,t.publishAsType="user")},t.resetSelection=function(){t.popup.selectedIndex=t.popup.userResults&&t.popup.userResults.length>0?0:-1},t.nextUser=function(){var e=t.popup.userResults;e&&e.length>0&&t.popup.selectedIndex<e.length-1&&(t.popup.selectedIndex+=1)},t.previousUser=function(){var e=t.popup.userResults;e&&e.length>0&&t.popup.selectedIndex>0&&(t.popup.selectedIndex-=1)},t.allSteps=a.collectSortedElementsFromPrecedingElements(t.selectedShape),t.createFolderField={},s){t.popup.useSubFolder=!0;var l=r.getFormFieldsForStep(t.allSteps,t.selectedShape.resourceId,["text"]);if(l&&l.length>0)for(var d=0;l.length>d;d++)if(l[d].id===s){t.createFolderField={field:l[d]};break}}else t.popup.useSubFolder=!1,t.createFolderField.field={};t.save=function(){if((t.network||t.accountId)&&t.site&&t.path){t.property.value={};var e={};t.network?e={network:t.network,site:t.siteId,path:t.pathId,user:t.userId,email:t.userEmail,externalId:t.externalUserId,path_title:t.path,site_title:t.site,username:t.userName,publish_as_type:t.publishAsType}:t.accountId&&(e={account:t.accountId,site:t.siteId,path:t.pathId,user:t.userId,email:t.userEmail,externalId:t.externalUserId,path_title:t.path,site_title:t.site,username:t.userName,publish_as_type:t.publishAsType}),t.popup.useSubFolder&&(e.folder=t.createFolderField.field.id),t.property.value=e}else t.property.value=null;t.updatePropertyInModel(t.property),t.close()},t.cancel=function(){t.close()},t.close=function(){t.property.mode="read",t.$hide()}}]),angular.module("activitiModeler").controller("KisBpmBoxContentPopupCtrl",["$scope","FormBuilderService","ContentAccountService","ProcessScopeService","EditorScopeService",function(e,t,i,o,n){e.model={},e.boxSourceOptions=[{id:"process",title:"Publish all content uploaded in process"},{id:"field",title:"Publish content uploaded in field"}],e.allSteps=n.collectSortedElementsFromPrecedingElements(e.selectedShape);var r=o.getFormFieldsForStep(e.allSteps,e.selectedShape.resourceId),a=o.getVariablesForStep(e.allSteps,e.selectedShape.resourceId);if(void 0!==e.property.value&&null!==e.property.value){for(var s=0;e.boxSourceOptions.length>s;s++)if(e.boxSourceOptions[s].id===e.property.value.source){e.boxSourceOption=e.boxSourceOptions[s];break}if(e.property.value.field){if(r&&r.length>0)for(var l=!1,s=0;r.length>s;s++)if(r[s].id===e.property.value.field){e.selectedFormField={field:r[s]},e.variableType="formField",l=!0;break}if(!l&&a&&a.length>0)for(var s=0;a.length>s;s++)if(a[s].processVariableName===e.property.value.field){e.selectedFormField={field:{id:a[s].processVariableName,name:a[s].processVariableName}},e.variableType="variable";break}e.boxSourceOption=e.boxSourceOptions[1]}}else e.boxSourceOption={};e.selectedFormField&&void 0!==e.selectedFormField||(e.selectedFormField={}),e.variableType&&void 0!==e.variableType||(e.variableType="formField"),e.isMetaDataAllowed=!1,i.isBoxMetaDataAllowed().then(function(t){e.isMetaDataAllowed=t}),e.isValidForm=function(){return e.isBoxSourceOptionSelected()?e.isValidBoxSourceOption():!0},e.isValidBoxSourceOption=function(){return e.isBoxSourceOptionField()?e.isValidFormContentField():e.isBoxSourceOptionProcess()?!0:void 0},e.isValidFormContentField=function(){return e.selectedFormField.field?!0:void 0},e.isBoxSourceOptionSelected=function(){return e.boxSourceOption},e.isBoxSourceOptionField=function(){return"field"===e.boxSourceOption.id},e.isBoxSourceOptionProcess=function(){return"process"===e.boxSourceOption.id},e.save=function(){e.boxSourceOption?(e.property.value={},"process"===e.boxSourceOption.id?e.property.value={source:"process"}:"field"===e.boxSourceOption.id&&(e.property.value={source:"field",field:e.selectedFormField.field.id}),e.property.value.metaDataColumnDefinitions=e.model.metaDataColumnDefinitions):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.close()},e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("KisBpmBoxDestinationPopupCtrl",["$rootScope","$scope","$http","ContentAccountService","UserService","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r,a){var s;if(void 0!==t.property.value&&null!==t.property.value&&(t.accountId=t.property.value.account,t.pathId=t.property.value.path,t.userId=t.property.value.user,t.userName=t.property.value.username,t.email=t.property.value.email,t.externalId=t.property.value.externalId,t.path=t.property.value.path_title,t.publishAsType=t.property.value.publish_as_type,s=t.property.value.folder,s&&s.id&&(s=s.id)),t.popup={assignmentObject:{candidateUsers:[],candidateGroups:[]}},t.selectDestinationFolder=function(e){e.account&&(t.accountId=e.account.id),e.path&&(t.pathId=e.path.id,t.path=e.path.title)},t.setPublishAs=function(e){"process_initiator"===e&&(t.user=void 0,t.userName=void 0),t.publishAsType=e},t.publishAsType||(t.publishAsType="process_initiator"),t.boxAccount={selected:""},t.loadBoxAccounts=function(){t.contentBoxAccounts={loading:!0};var e=[];o.getAccounts().then(function(i){if(i&&i.data)for(var o=0;i.data.length>o;o++)"box"===i.data[o].serviceId.substring(0,3)&&(e.push(i.data[o]),"box"===i.data[o].serviceId&&(i.data[o].name="Box"));if(t.accountId)for(var o=0;e.length>o;o++){if(t.account&&e[o].serviceId===t.accountId){t.boxAccount.selected=e[o];break}if("box"===e[o].serviceId){t.boxAccount.selected=e[o];break}}else t.boxAccount.selected=e[0];t.contentBoxAccounts.rawList=e,t.contentBoxAccounts.loading=!1})},t.resetDestination=function(){t.path=void 0,t.userId=void 0,t.userName=void 0,t.email=void 0,t.externalId=void 0,t.account=void 0,t.publishAsType=void 0},t.loadBoxAccounts(),t.$watch("popup.filter",function(){t.updateFilter()}),t.updateFilter=function(){(void 0==t.popup.oldFilter||t.popup.oldFilter!=t.popup.filter)&&(t.popup.oldFilter=t.popup.filter?t.popup.filter:"",null!==t.popup.filter&&void 0!==t.popup.filter&&n.getFilteredUsers(t.popup.filter).then(function(e){for(var i=[],o=0;e.data.length>o;o++){var n=e.data[o],r=!1;if(null!==t.popup.assignmentObject.candidateUsers&&void 0!==t.popup.assignmentObject.candidateUsers)for(var a=0;t.popup.assignmentObject.candidateUsers.length>a;a++){var s=t.popup.assignmentObject.candidateUsers[a];if(s.id===n.id){r=!0;break}}r||i.push(n)}t.popup.userResults=i,t.resetSelection()}))},t.confirmUser=function(e){if(!e){var i=t.popup.userResults;t.popup.selectedIndex>=0&&t.popup.selectedIndex<i.length&&(e=i[t.popup.selectedIndex])}e&&(t.popup.assignmentObject.assignee=e,t.userId=e.id,t.userName=e.firstName?e.firstName+" "+e.lastName:e.lastName,t.email=e.email,t.externalId=e.externalId,t.publishAsType="user")},t.resetSelection=function(){t.popup.selectedIndex=t.popup.userResults&&t.popup.userResults.length>0?0:-1},t.nextUser=function(){var e=t.popup.userResults;e&&e.length>0&&t.popup.selectedIndex<e.length-1&&(t.popup.selectedIndex+=1)},t.previousUser=function(){var e=t.popup.userResults;e&&e.length>0&&t.popup.selectedIndex>0&&(t.popup.selectedIndex-=1)},t.allSteps=a.collectSortedElementsFromPrecedingElements(t.selectedShape),t.createFolderField={},s){t.popup.useSubFolder=!0;var l=r.getFormFieldsForStep(t.allSteps,t.selectedShape.resourceId,["text"]);if(l&&l.length>0)for(var d=0;l.length>d;d++)if(l[d].id===s){t.createFolderField={field:l[d]};break}}else t.popup.useSubFolder=!1,t.createFolderField.field={};t.save=function(){if(t.accountId&&t.path){t.property.value={};var e={};t.accountId&&(e={account:t.accountId,path:t.pathId,user:t.userId,email:t.email,externalId:t.externalId,path_title:t.path,username:t.userName,publish_as_type:t.publishAsType}),t.popup.useSubFolder&&(e.folder=t.createFolderField.field.id),t.property.value=e}else t.property.value=null;t.updatePropertyInModel(t.property),t.close()},t.cancel=function(){t.close()},t.close=function(){t.property.mode="read",t.$hide()},t.allSteps=a.collectSortedElementsFromPrecedingElements(t.selectedShape)}]),angular.module("activitiModeler").controller("KisBpmGoogleDriveContentPopupCtrl",["$scope","FormBuilderService","ProcessScopeService","EditorScopeService",function(e,t,i,o){e.model={},e.googleDriveSourceOptions=[{id:"process",title:"Publish all content uploaded in process"},{id:"field",title:"Publish content uploaded in field"}],e.allSteps=o.collectSortedElementsFromPrecedingElements(e.selectedShape);var n=i.getFormFieldsForStep(e.allSteps,e.selectedShape.resourceId),r=i.getVariablesForStep(e.allSteps,e.selectedShape.resourceId);if(void 0!==e.property.value&&null!==e.property.value){for(var a=0;e.googleDriveSourceOptions.length>a;a++)if(e.googleDriveSourceOptions[a].id===e.property.value.source){e.googleDriveSourceOption=e.googleDriveSourceOptions[a];break}if(e.property.value.field){if(n&&n.length>0)for(var s=!1,a=0;n.length>a;a++)if(n[a].id===e.property.value.field){e.selectedFormField={field:n[a]},e.variableType="formField",s=!0;break}if(!s&&r&&r.length>0)for(var a=0;r.length>a;a++)if(r[a].processVariableName===e.property.value.field){e.selectedFormField={field:{id:r[a].processVariableName,name:r[a].processVariableName}},e.variableType="variable";break}e.googleDriveSourceOption=e.googleDriveSourceOptions[1]}}else e.googleDriveSourceOption={};e.selectedFormField&&void 0!==e.selectedFormField||(e.selectedFormField={}),e.variableType&&void 0!==e.variableType||(e.variableType="formField"),e.isValidForm=function(){return e.isGoogleDriveSourceOptionSelected()?e.isValidGoogleDriveSourceOption():!0},e.isValidGoogleDriveSourceOption=function(){return e.isGoogleDriveSourceOptionField()?e.isValidFormContentField():e.isGoogleDriveSourceOptionProcess()?!0:void 0},e.isValidFormContentField=function(){return e.selectedFormField.field?!0:void 0},e.isGoogleDriveSourceOptionSelected=function(){return e.googleDriveSourceOption},e.isGoogleDriveSourceOptionField=function(){return"field"===e.googleDriveSourceOption.id},e.isGoogleDriveSourceOptionProcess=function(){return"process"===e.googleDriveSourceOption.id},e.save=function(){e.googleDriveSourceOption?(e.property.value={},"process"===e.googleDriveSourceOption.id?e.property.value={source:"process"}:"field"===e.googleDriveSourceOption.id&&(e.property.value={source:"field",field:e.selectedFormField.field.id}),e.property.value.metaDataColumnDefinitions=e.model.metaDataColumnDefinitions):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.close()},e.close=function(){e.property.mode="read",e.$hide()}}]),angular.module("activitiModeler").controller("KisBpmGoogleDriveDestinationPopupCtrl",["$rootScope","$scope","$http","ContentAccountService","UserService","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r,a){var s;if(void 0!==t.property.value&&null!==t.property.value&&(t.accountId=t.property.value.account,t.pathId=t.property.value.path,t.userId=t.property.value.user,t.userName=t.property.value.username,t.email=t.property.value.email,t.externalId=t.property.value.externalId,t.path=t.property.value.path_title,t.publishAsType=t.property.value.publish_as_type,s=t.property.value.folder,s&&s.id&&(s=s.id)),t.popup={assignmentObject:{candidateUsers:[],candidateGroups:[]}},t.selectDestinationFolder=function(e){e.account&&(t.accountId=e.account.id),e.path&&(t.pathId=e.path.id,t.path=e.path.title)},t.setPublishAs=function(e){"process_initiator"===e&&(t.user=void 0,t.userName=void 0),t.publishAsType=e},t.publishAsType||(t.publishAsType="process_initiator"),t.googleDriveAccount={selected:""},t.loadGoogleDriveAccounts=function(){t.contentGoogleDriveAccounts={loading:!0};var e=[];o.getAccounts().then(function(i){if(i&&i.data)for(var o=0;i.data.length>o;o++)i.data[o].serviceId&&i.data[o].serviceId.length>=12&&"google-drive"===i.data[o].serviceId.substring(0,12)&&(e.push(i.data[o]),"google-drive"===i.data[o].serviceId&&(i.data[o].name="Google Drive"));if(t.accountId)for(var o=0;e.length>o;o++){if(t.account&&e[o].serviceId===t.accountId){t.googleDriveAccount.selected=e[o];break}if("google-drive"===e[o].serviceId){t.googleDriveAccount.selected=e[o];break}}else t.googleDriveAccount.selected=e[0];t.contentGoogleDriveAccounts.rawList=e,t.contentGoogleDriveAccounts.loading=!1})},t.resetDestination=function(){t.path=void 0,t.userId=void 0,t.email=void 0,t.externalId=void 0,t.userName=void 0,t.account=void 0,t.publishAsType=void 0},t.loadGoogleDriveAccounts(),t.$watch("popup.filter",function(){t.updateFilter()}),t.updateFilter=function(){(void 0==t.popup.oldFilter||t.popup.oldFilter!=t.popup.filter)&&(t.popup.oldFilter=t.popup.filter?t.popup.filter:"",null!==t.popup.filter&&void 0!==t.popup.filter&&n.getFilteredUsers(t.popup.filter).then(function(e){for(var i=[],o=0;e.data.length>o;o++){var n=e.data[o],r=!1;if(null!==t.popup.assignmentObject.candidateUsers&&void 0!==t.popup.assignmentObject.candidateUsers)for(var a=0;t.popup.assignmentObject.candidateUsers.length>a;a++){var s=t.popup.assignmentObject.candidateUsers[a];if(s.id===n.id){r=!0;break}}r||i.push(n)}t.popup.userResults=i,t.resetSelection()}))},t.confirmUser=function(e){if(!e){var i=t.popup.userResults;t.popup.selectedIndex>=0&&t.popup.selectedIndex<i.length&&(e=i[t.popup.selectedIndex])}e&&(t.popup.assignmentObject.assignee=e,t.userId=e.id,t.email=e.email,t.externalId=e.externalId,t.userName=e.firstName?e.firstName+" "+e.lastName:e.lastName,t.publishAsType="user")},t.resetSelection=function(){t.popup.selectedIndex=t.popup.userResults&&t.popup.userResults.length>0?0:-1},t.nextUser=function(){var e=t.popup.userResults;e&&e.length>0&&t.popup.selectedIndex<e.length-1&&(t.popup.selectedIndex+=1)},t.previousUser=function(){var e=t.popup.userResults;e&&e.length>0&&t.popup.selectedIndex>0&&(t.popup.selectedIndex-=1)},t.allSteps=a.collectSortedElementsFromPrecedingElements(t.selectedShape),t.createFolderField={},s){t.popup.useSubFolder=!0;var l=r.getFormFieldsForStep(t.allSteps,t.selectedShape.resourceId,["text"]);if(l&&l.length>0)for(var d=0;l.length>d;d++)if(l[d].id===s){t.createFolderField={field:l[d]};break}}else t.popup.useSubFolder=!1,t.createFolderField.field={};t.save=function(){if(t.accountId&&t.path){t.property.value={};var e={};t.accountId&&(e={account:t.accountId,path:t.pathId,user:t.userId,path_title:t.path,username:t.userName,email:t.email,externalId:t.externalId,publish_as_type:t.publishAsType}),t.popup.useSubFolder&&(e.folder=t.createFolderField.field.id),t.property.value=e}else t.property.value=null;t.updatePropertyInModel(t.property),t.close()},t.cancel=function(){t.close()},t.close=function(){t.property.mode="read",t.$hide()},t.allSteps=a.collectSortedElementsFromPrecedingElements(t.selectedShape)}]),angular.module("activitiModeler").controller("KisBpmContentPopupMetadataMappingController",["$rootScope","$scope","$q","$translate","$http","$timeout",function(e,t,i,o,n,r){t.stepId=t.selectedShape.resourceId,t.labels=[],t.model=t.model||{},void 0!==t.property.value&&null!==t.property.value&&t.property.value.metaDataColumnDefinitions&&(t.model.metaDataColumnDefinitions=t.model.metaDataColumnDefinitions||angular.copy(t.property.value.metaDataColumnDefinitions)),t.model.metaDataColumnDefinitions||(t.model.metaDataColumnDefinitions=[]),t.propertyTypes=["boolean","date","number","string"],t.urlDynamicTableConfig={position:0,field:""};var a=t.model.metaDataColumnDefinitions;t.metaDataSelectedColumnDefinition=void 0,t.labels.filePropertyLabel=o.instant("FORM-BUILDER.COMPONENT.ATTACH-FILE.METADATA.HEADER-FILE-PROPERTY"),t.labels.variableLabel=o.instant("FORM-BUILDER.COMPONENT.ATTACH-FILE.METADATA.HEADER-VARIABLE"),t.setValueType=function(e){t.metaDataSelectedColumnDefinition.valueType=e},t.metaDataGridOptions={data:a,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"fileProperty",displayName:t.labels.filePropertyLabel},{field:"formField",displayName:t.labels.formFieldLabel,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getMappingColumnValue("formField",row.entity)}}</div>'},{field:"processVariable",displayName:t.labels.variableLabel,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getMappingColumnValue("processVariable",row.entity)}}</div>'}]},t._getMappingColumnValue=function(e,t){var i="";return t?(t[e]&&(i=t[e].name),i):i},t.metaDataGridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.metaDataSelectedColumnDefinition=e.entity,t.focusFirstField()})},t.focusFirstField=function(){r(function(){var e=document.getElementById("filePropertyField");e&&e.focus()},100)},t.addNewPropertyMapping=function(){var e={fileProperty:"",propertyType:"string",propertyValueType:"field",processVariable:void 0,formField:void 0};t.model.metaDataColumnDefinitions.push(e),t.gridApi.selection.clearSelectedRows(),r(function(){t.gridApi.selection.toggleRowSelection(e)})},t.removePropertyMapping=function(){if(t.metaDataSelectedColumnDefinition){var e=t.model.metaDataColumnDefinitions.indexOf(t.metaDataSelectedColumnDefinition);t.gridApi.selection.toggleRowSelection(t.metaDataSelectedColumnDefinition),t.model.metaDataColumnDefinitions.splice(e,1),r(function(){t.model.metaDataColumnDefinitions.length>0?t.gridApi.selection.toggleRowSelection(t.model.metaDataColumnDefinitions[0]):t.metaDataSelectedColumnDefinition=void 0})}},t.setPropertyMappingFormFieldValue=function(){t.metaDataSelectedColumnDefinition.propertyValueType="field",t.metaDataSelectedColumnDefinition.processVariable=void 0},t.setPropertyMappingVariableValue=function(){t.metaDataSelectedColumnDefinition.propertyValueType="variable",t.metaDataSelectedColumnDefinition.formField=void 0},t.setPropertyMappingStaticValue=function(){t.metaDataSelectedColumnDefinition.propertyValueType="static",t.metaDataSelectedColumnDefinition.staticVariable=void 0},t.$watch("metaDataSelectedColumnDefinition.staticVariable",function(){t.metaDataSelectedColumnDefinition&&(t.metaDataSelectedColumnDefinition.processVariable={},t.metaDataSelectedColumnDefinition.processVariable.id=t.metaDataSelectedColumnDefinition.staticVariable,t.metaDataSelectedColumnDefinition.processVariable.name=t.metaDataSelectedColumnDefinition.staticVariable,t.metaDataSelectedColumnDefinition.processVariable.type=t.metaDataSelectedColumnDefinition.propertyType)})}]),angular.module("activitiModeler").controller("BpmnEditorDueDatePopupCtrl",["$rootScope","$scope","$translate","ProcessScopeService","EditorScopeService",function(e,t,i,o,n){t.popup=void 0!==t.property.value&&null!==t.property.value?void 0!==t.property.value.duedate&&null!==t.property.value.duedate?{duedate:t.property.value.duedate}:void 0!==t.property.value.duedateExpression&&null!==t.property.value.duedateExpression?{duedateExpression:t.property.value.duedateExpression}:{duedateExpression:t.property.value}:{},t.taskDueDateOptions=[{id:"none",title:i.instant("PROPERTY.DUEDATE.TASK-DUE-DATE-OPTIONS.NO-DUEDATE")},{id:"expression",title:i.instant("PROPERTY.DUEDATE.TASK-DUE-DATE-OPTIONS.EXPRESSION")},{id:"static",title:i.instant("PROPERTY.DUEDATE.TASK-DUE-DATE-OPTIONS.STATIC")},{id:"field",title:i.instant("PROPERTY.DUEDATE.TASK-DUE-DATE-OPTIONS.FIELD")},{id:"variable",title:i.instant("PROPERTY.DUEDATE.TASK-DUE-DATE-OPTIONS.VARIABLE")}],t.popup.selectedDueDateOption=t.popup.duedate||t.popup.duedateExpression?t.popup.duedate?t.popup.duedate.fixed?t.taskDueDateOptions[2].id:t.popup.duedate.field?t.taskDueDateOptions[3].id:t.popup.duedate.variable?t.taskDueDateOptions[4].id:t.taskDueDateOptions[0].id:t.taskDueDateOptions[1].id:t.taskDueDateOptions[0].id,t.dueDateOptionChanged=function(){"expression"===t.popup.selectedDueDateOption?t.popup.duedate=void 0:"none"===t.popup.selectedDueDateOption?(t.popup.duedate=void 0,t.popup.duedateExpression=void 0):"static"===t.popup.selectedDueDateOption?(t.popup.duedate={fixed:{}},t.popup.duedateExpression=void 0):"field"===t.popup.selectedDueDateOption?(t.popup.duedate={field:{}},t.popup.duedateExpression=void 0):"variable"===t.popup.selectedDueDateOption&&(t.popup.duedate={variable:{}},t.popup.duedateExpression=void 0)
},t.setAddCalculationType=function(e){e&&(e.taskDueDateCalculationType="add")},t.setSubtractCalculationType=function(e){e&&(e.taskDueDateCalculationType="subtract")},t.allSteps=n.collectSortedElementsFromPrecedingElements(t.selectedShape),t.getRestResponseVariables=function(){return o.getVariablesForStep(t.allSteps,t.selectedShape.resourceId)},t.selectResponseVariable=function(e){t.popup.duedate.variable.taskDueDateVariable=e},t.save=function(){t.property.value={},t.popup.duedate?t.property.value.duedate=t.popup.duedate:t.popup.duedateExpression?t.property.value.duedateExpression=t.popup.duedateExpression:t.property.value="",t.updatePropertyInModel(t.property),t.close()},t.close=function(){t.property.mode="read",t.$hide()}}]),angular.module("activitiModeler").controller("ActivitiRestCallEndpointPopupCtrl",["$rootScope","$scope","$translate","$timeout","$http","ProcessBuilderService","EndpointUtilService","EditorScopeService",function(e,t,i,o,n,r,a,s){function l(){var e=t.selectedShape.properties["oryx-restcalltask_request_headers"],i=t.popup.endpoint,o=void 0;if(t.property.value&&(o=t.property.value.endpoint_config),e&&e.length>0&&o&&o.requestHeaders&&o.requestHeaders.length>0){for(var n=angular.copy(e),r={},a=0;o.requestHeaders.length>a;a++)r[o.requestHeaders[a].name]=o.requestHeaders[a].value;for(var s=[],a=0;n.length>a;a++)void 0===r[n[a].name]&&s.push(n[a]);e.length=0,angular.copy(s,e)}if(e&&i&&i.requestHeaders&&i.requestHeaders.length>0){for(var l={},a=0;e.length>a;a++)l[e[a].name]=e[a].value;for(var a=0;i.requestHeaders.length>a;a++)if(void 0===l[i.requestHeaders[a].name]){var d={name:i.requestHeaders[a].name,value:i.requestHeaders[a].value};e.push(d)}}}t.popup={},void 0!=t.property.value&&null!=t.property.value&&(void 0!=t.property.value.endpoint_config&&null!=t.property.value.endpoint_config&&(t.popup.endpoint=t.property.value.endpoint_config),void 0!=t.property.value.http_method&&null!=t.property.value.http_method&&(t.popup.httpMethod=t.property.value.http_method),void 0!=t.property.value.rest_url&&null!=t.property.value.rest_url&&(t.popup.restUrl=t.property.value.rest_url)),t.popup.restEndpointFieldTypes=["text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount","multi-line-text"],t.popup.insertRestUrlField={position:0},t.model={urlFieldType:"formField",requestMappingValues:[]},t.setUrlFieldType=function(e){"restResponse"===e?t.model={urlFieldType:"restResponse"}:"formField"===e&&(t.model={urlFieldType:"formField"})},t.$watch("popup.insertRestUrlField.field",function(e){if(e){var i=t.popup.restUrl,n="${"+e.id+"}";i=i?i.substring(0,t.popup.insertRestUrlField.position)+n+i.substring(t.popup.insertRestUrlField.position):n,t.popup.insertRestUrlField.field=void 0,o(function(){var e=angular.element("#rest-url-value");e.focus(),e.val(i),t.popup.restUrl=i},200)}}),t.endpointLabel=function(e,t,i,o,n){return a.getEndpointLabel(e,t,i,o,n)},t.loadBaseEndpoints=function(){a.getAllEndpointConfigurations().then(function(e){if(t.popup.endpointConfigurations=e,t.popup.endpoint)for(var i=0;t.popup.endpointConfigurations.length>i;i++)t.popup.endpointConfigurations[i].id==t.popup.endpoint.id&&(t.popup.endpoint=t.popup.endpointConfigurations[i])})},t.getFullEndpointURL=function(){return a.getFullEndpointURL(t.popup.endpoint,t.popup.restUrl)},t.executeEndpointTest=function(){t.endpointTestVisible={visible:!0}},t.popup.httpMethods=["GET","POST","PUT","DELETE"],t.popup.httpMethod||(t.popup.httpMethod=t.popup.httpMethods[0]),t.cancel=function(){t.close()},t.$parent.$on("modal.hide.before",function(){t.close(),t.$parent.$apply()}),t.close=function(){t.property.mode="read",t.$hide()},t.save=function(){if(l(),t.popup.httpMethod&&(t.popup.endpoint||t.popup.restUrl)){t.property.value={};var e={};e.http_method=t.popup.httpMethod,t.popup.endpoint&&(e.endpoint_config=t.popup.endpoint),t.popup.restUrl&&(e.rest_url=t.popup.restUrl),t.property.value=e}else t.property.value=null;t.updatePropertyInModel(t.property),t.close()},t.showEndpointTest=function(){return ACTIVITI.CONFIG&&ACTIVITI.CONFIG.onPremise?ACTIVITI.CONFIG.onPremise:!1},t.allSteps=s.collectSortedElementsFromPrecedingElements(t.selectedShape),t.loadBaseEndpoints()}]),angular.module("activitiModeler").controller("EditorEndpointCheckController",["$rootScope","$scope","EndpointUtilService","FormBuilderService","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r){var a,s,l,d;if(t.popup){t.popup.httpMethod&&""!=t.popup.httpMethod&&(a=t.popup.httpMethod),t.popup.restUrl&&""!=t.popup.restUrl&&(s=t.popup.restUrl),t.popup.endpoint&&(l=t.popup.endpoint);var c=function(){var e=t.selectedShape.properties["oryx-restcalltask_request_mapping"],o=t.selectedShape.properties["oryx-restcalltask_request_headers"];if(e&&e.isJSONTemplate===!0&&(d=e.jsonTemplate,e=[]),o&&l&&l.requestHeaders&&l.requestHeaders.length>0){for(var c={},p=0;o.length>p;p++)c[o[p].name]=o[p].value;for(var p=0;l.requestHeaders.length>p;p++)if(void 0===c[l.requestHeaders[p].name]){var u={name:l.requestHeaders[p].name,value:l.requestHeaders[p].value};o.push(u)}}if(i.isTestDataNeeded(s,e,d,o)){var m=r.collectSortedElementsFromPrecedingElements(t.selectedShape),h=n.getFormFieldsForStep(m,t.selectedShape.id),f=n.getVariablesForStep(m,t.selectedShape.id);t.testDataFields=i.getTestDataFields(s,h,f,e,d,o)}else i.executeEndpointCheck(a,l,s,d).then(function(e){t.requestResult=e,t.formattedResult=i.getFormattedRequestResult(e)})};t.isRequestSuccessful=function(){var e=!1;return t.requestResult&&t.requestResult.statusCode&&t.requestResult.statusCode>=200&&400>t.requestResult.statusCode&&(e=!0),e},t.cancel=function(){t.endpointTestVisible.visible=!1},t.ok=function(){i.executeEndpointCheck(a,l,s,d,t.testDataFields).then(function(e){t.requestResult=e,t.formattedResult=i.getFormattedRequestResult(e)})},t.back=function(){delete t.requestResult,t.testDataFields||t.cancel()},c()}}]),angular.module("activitiModeler").controller("ActivitiRestCallRequestMappingPopupCtrl",["$rootScope","$scope","$translate","$timeout","FormBuilderService","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r,a){t.allSteps=a.collectSortedElementsFromPrecedingElements(t.selectedShape);var s=r.getFormFieldsForStep(t.allSteps,t.selectedShape.resourceId),l=r.getVariablesForStep(t.allSteps,t.selectedShape.resourceId);if(t.insertFormField={position:0},t.popup={requestMappings:[],requestMappingType:"keyValue",jsonFieldType:"formField"},void 0!==t.property.value&&null!==t.property.value){var d=[],c="";if(angular.isArray(t.property.value)===!0){for(var p=0,u=0;t.property.value.length>u;u++){var m={};if(void 0!==t.property.value[u].jsonPropertyName&&null!==t.property.value[u].jsonPropertyName&&(m.jsonPropertyName=t.property.value[u].jsonPropertyName),void 0!==t.property.value[u].jsonPropertyType&&null!==t.property.value[u].jsonPropertyType&&(m.jsonPropertyType=t.property.value[u].jsonPropertyType),void 0!==t.property.value[u].jsonPropertyValue&&null!==t.property.value[u].jsonPropertyValue)m.jsonPropertyValue=t.property.value[u].jsonPropertyValue,m.jsonPropertyValueType="static";else if(void 0!==t.property.value[u].jsonPropertyValueFormField&&null!==t.property.value[u].jsonPropertyValueFormField.id){if(s&&s.length>0)for(p=0;s.length>p;p++)if(s[p].id===t.property.value[u].jsonPropertyValueFormField.id){m.jsonPropertyValueFormField=s[p];break}m.jsonPropertyValueType="field"}else if(void 0!==t.property.value[u].jsonPropertyValueRestResponseField&&null!==t.property.value[u].jsonPropertyValueRestResponseField.id){if(l&&l.length>0)for(p=0;l.length>p;p++)if(l[p].processVariableName===t.property.value[u].jsonPropertyValueRestResponseField.id){m.jsonPropertyValueRestResponseField={id:l[p].processVariableName,name:l[p].processVariableName,type:l[p].processVariableType};break}m.jsonPropertyValueType="restResponse"}d.push(m)}t.popup.requestMappingType="keyValue"}else void 0!==t.property.value.isJSONTemplate&&t.property.value.isJSONTemplate===!0&&(c=t.property.value.jsonTemplate,t.popup.requestMappingType="jsonTemplate");t.popup.requestMappings=d,t.popup.requestMappingJSONTemplate=c}t.popup.restRequestMappingFieldTypes=["text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount","multi-line-text"],t.popup.jsonTypes=["string","boolean","long","date"];var h=i.instant("PROCESS-BUILDER.REST-CALL-STEP.REQUEST-MESSAGE.JSON-PROPERTY"),f=i.instant("PROCESS-BUILDER.REST-CALL-STEP.REQUEST-MESSAGE.JSON-VALUE");t.requestMessageGridOptions={data:t.popup.requestMappings,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,unselect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"jsonPropertyValue",displayName:f,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnValue(row.entity)}}</div>'},{field:"jsonPropertyName",displayName:h}]},t.requestMessageGridOptions.onRegisterApi=function(e){t.requestMessageGridApi=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?(t.popup.selectedRequestMapping=e.entity,t.popup.selectedRequestMapping.jsonPropertyValueFormField?(t.popup.selectedRequestMapping.jsonPropertyValueType="field",t.jsonPropertyValueFormField={field:t.popup.selectedRequestMapping.jsonPropertyValueFormField}):t.jsonPropertyValueFormField={}):t.popup.selectedRequestMapping=void 0})},t.setRequestMappingType=function(e){t.popup.requestMappingType=e},t.setJSONFieldType=function(e){t.popup.jsonFieldType=e},t.$watch("insertFormField.field",function(e){if(e){var i="${"+e.id+"}";t.insertFormField.field=void 0,o(function(){t.aceEditor.insert(i)},200)}}),t.setAceEditor=function(e){t.aceEditor=e,o(function(){e.focus()})},t._getVariableColumnValue=function(e){var t="";return e?(e.jsonPropertyValueFormField?t=e.jsonPropertyValueFormField.name:e.jsonPropertyValueRestResponseField?t=e.jsonPropertyValueRestResponseField.name:e.jsonPropertyValue&&""!==e.jsonPropertyValue&&(t=e.jsonPropertyValue),t):t},t.addNewRequestMapping=function(){var e={jsonPropertyType:t.popup.jsonTypes[0]};t.jsonPropertyValueFormField={},t.popup.requestMappings.push(e),o(function(){t.requestMessageGridApi.selection.toggleRowSelection(e)})},t.removeRequestMapping=function(){if(t.popup.selectedRequestMapping){var e=t.popup.requestMappings.indexOf(t.popup.selectedRequestMapping);t.requestMessageGridApi.selection.toggleRowSelection(t.popup.selectedRequestMapping),t.popup.requestMappings.splice(e,1),o(function(){t.popup.requestMappings.length>0?t.requestMessageGridApi.selection.toggleRowSelection(t.popup.requestMappings[0]):t.popup.selectedRequestMapping=void 0})}},t.setRequestMessageStaticValue=function(){t.popup.selectedRequestMapping.jsonPropertyValueType="static",t.popup.selectedRequestMapping.jsonPropertyValueFormField=void 0,t.popup.selectedRequestMapping.jsonPropertyValueRestResponseField=void 0},t.setRequestMessageFormFieldValue=function(){t.popup.selectedRequestMapping.jsonPropertyValueType="field",t.popup.selectedRequestMapping.jsonPropertyValue=void 0,t.popup.selectedRequestMapping.jsonPropertyValueRestResponseField=void 0},t.setRequestMessageRestResponseValue=function(){t.popup.selectedRequestMapping.jsonPropertyValueType="restResponse",t.popup.selectedRequestMapping.jsonPropertyValue=void 0,t.popup.selectedRequestMapping.jsonPropertyValueFormField=void 0},t.cancel=function(){t.close()},t.$parent.$on("modal.hide.before",function(){t.close(),t.$parent.$apply()}),t.close=function(){t.property.mode="read",t.$hide()},t.save=function(){void 0===t.popup.requestMappingType||"keyValue"===t.popup.requestMappingType?t.popup.requestMappings.length>0&&(t.property.value=[],t.property.value=t.popup.requestMappings):t.property.value={isJSONTemplate:!0,jsonTemplate:t.popup.requestMappingJSONTemplate},t.updatePropertyInModel(t.property),t.close()},t.processModelId=t.modelData.modelId}]),angular.module("activitiModeler").controller("ActivitiRestCallResponseMappingPopupCtrl",["$scope","$translate","$timeout","ProcessScopeService",function(e,t,i,o){if(e.popup={responseMappings:[]},void 0!=e.property.value&&null!=e.property.value){for(var n=[],r=0;e.property.value.length>r;r++){var a={};void 0!=e.property.value[r].jsonPropertyName&&null!=e.property.value[r].jsonPropertyName&&(a.jsonPropertyName=e.property.value[r].jsonPropertyName),void 0!=e.property.value[r].processVariableName&&null!=e.property.value[r].processVariableName&&(a.processVariableName=e.property.value[r].processVariableName),void 0!=e.property.value[r].processVariableType&&null!=e.property.value[r].processVariableType&&(a.processVariableType=e.property.value[r].processVariableType),n.push(a)}e.popup.responseMappings=n}e.popup.jsonTypes=["string","boolean","long","date"];var s=t.instant("PROCESS-BUILDER.REST-CALL-STEP.RESPONSE-MESSAGE.JSON-PROPERTY"),l=t.instant("PROCESS-BUILDER.REST-CALL-STEP.RESPONSE-MESSAGE.PROCESS-VARIABLE");e.responseMessageGridOptions={data:e.popup.responseMappings,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"jsonPropertyName",displayName:s},{field:"processVariableName",displayName:l}]},e.responseMessageGridOptions.onRegisterApi=function(t){e.responseMessageGridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.popup.selectedResponseMapping=t.isSelected?t.entity:void 0})},e.addNewResponseMapping=function(){var t={processVariableType:e.popup.jsonTypes[0]};e.popup.responseMappings.push(t),i(function(){e.responseMessageGridApi.selection.toggleRowSelection(t)})},e.removeResponseMapping=function(){if(e.popup.selectedResponseMapping){var t=e.popup.responseMappings.indexOf(e.popup.selectedResponseMapping);e.responseMessageGridApi.selection.toggleRowSelection(e.popup.selectedResponseMapping),e.popup.responseMappings.splice(t,1),i(function(){e.popup.responseMappings.length>0?e.responseMessageGridApi.selection.toggleRowSelection(e.popup.responseMappings[0]):e.popup.selectedResponseMapping=void 0})}},e.cancel=function(){e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()},e.save=function(){e.popup.responseMappings.length>0?(e.property.value=[],e.property.value=e.popup.responseMappings):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.$watch("popup.responseMappings",function(t,i){if(i!==t)if(t){for(var n=[],r=0;t.length>r;r++){var a={jsonPropertyName:t[r].jsonPropertyName,processVariableName:t[r].processVariableName,processVariableType:t[r].processVariableType};n.push(a)}o.updateResponseVariablesCache(e.selectedShape.resourceId,n)}else o.updateResponseVariablesCache(e.selectedShape.resourceId)},!0)}]),angular.module("activitiModeler").controller("ActivitiRestCallRequestHeadersPopupCtrl",["$rootScope","$scope","$translate","$timeout","EndpointUtilService","ProcessScopeService","uiGridConstants",function(e,t,i,o,n,r,a){t.selectedRequestHeaders=[],t.labels=[],t.updateRequestHeadersFromEndpoint=function(){var e=t.selectedShape.properties["oryx-restcalltask_endpoint"],i=void 0;e&&e.endpoint_config&&n.getAllEndpointConfigurations().then(function(o){t.popup.endpointConfigurations=o;for(var n=0;o.length>n;n++)if(e.endpoint_config.id==o[n].id){i=o[n];break}if(i&&i.requestHeaders&&i.requestHeaders.length>0){for(var r={},n=0;t.property.value.length>n;n++)r[t.property.value[n].name]=t.property.value[n].value;for(var n=0;i.requestHeaders.length>n;n++)if(void 0===r[i.requestHeaders[n].name]){var a={name:i.requestHeaders[n].name,value:i.requestHeaders[n].value};t.property.value.push(a)}}t.requestHeadersGridOptions.data=t.property.value})},t.property.value&&0!==t.property.value.length||(t.property.value=[]),t.updateRequestHeadersFromEndpoint(),t.restHeaderConfig={position:0,field:""},t.selectedRequestHeader=void 0,t.labels.idLabel=i.instant("PROCESS-BUILDER.REST-CALL-STEP.REQUEST-HEADERS.HEADER-NAME"),t.labels.nameLabel=i.instant("PROCESS-BUILDER.REST-CALL-STEP.REQUEST-HEADERS.HEADER-VALUE"),t.requestHeadersGridOptions={data:t.property.value,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:t.labels.idLabel,cellClass:function(e,t,i){return""===e.getCellValue(t,i)||0==e.getCellValue(t,i)?"dynamicTable-cellError":void 0}},{field:"value",displayName:t.labels.nameLabel,cellClass:function(e,t,i){return""===e.getCellValue(t,i)||0==e.getCellValue(t,i)?"dynamicTable-cellError":void 0}}]},t.requestHeadersGridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedRequestHeader=e.entity,t.focusFirstField()})},t.focusFirstField=function(){o(function(){var e=document.getElementById("headerName");e&&e.focus()},100)},t.$on("endpoint-selection-changed",function(e,i){i&&(t.property.value=angular.copy(i.requestHeaders),t.requestHeadersGridOptions.data=t.property.value,t.gridApi.core.notifyDataChange(a.dataChange.ALL),t.selectedRequestHeader=void 0)}),t.$watch("restHeaderConfig.field",function(e){if(e){var i=t.selectedRequestHeader.value,n="${"+e.id+"}";i=i?i.substring(0,t.restHeaderConfig.position)+n+i.substring(t.restHeaderConfig.position):n,t.restHeaderConfig.field=void 0,o(function(){var e=angular.element("#rest-header-value");e.focus(),e.val(i),t.selectedRequestHeader.value=i},200)}}),t.addNewRequestHeader=function(){var e={name:"",value:""};t.property.value.push(e),t.selectedRequestHeader=e,t.gridApi.core.notifyDataChange(a.dataChange.ALL),o(function(){t.gridApi.selection.toggleRowSelection(t.selectedRequestHeader)})},t.removeRequestHeader=function(){if(t.selectedRequestHeader){var e=t.property.value.indexOf(t.selectedRequestHeader);t.gridApi.selection.toggleRowSelection(t.selectedRequestHeader),t.property.value.splice(e,1),t.gridApi.core.notifyDataChange(a.dataChange.ALL),t.selectedRequestHeader=void 0,o(function(){t.property.value.length>0&&t.gridApi.selection.toggleRowSelection(t.property.value[0])})}},t.popup={headerFieldType:"formField"},t.setUrlFieldType=function(e){"restResponse"===e?t.popup={headerFieldType:"restResponse"}:"formField"===e&&(t.popup={headerFieldType:"formField"})},t.close=function(){t.property.mode="read",t.$hide()},t.save=function(){t.requestHeadersGridOptions.data.length>0?(t.property.value=[],t.property.value=angular.copy(t.requestHeadersGridOptions.data)):t.property.value=null,t.updatePropertyInModel(t.property),t.close()}}]),angular.module("activitiModeler").controller("ActivitiExecutionVariablesPopupCtrl",["$scope","$q","$translate","$timeout","ProcessScopeService","DataModelService",function(e,t,i,o,n,r){e.variables=void 0!==e.property.value&&null!==e.property.value&&e.property.value.length>0?e.property.value.constructor==String?JSON.parse(e.property.value):angular.copy(e.property.value):[],e.selectedVariable=void 0,e.labels={},e.loadDataModels=function(){var t=e.editor.getModelMetaData();r.getDataModels(t.modelId).then(function(t){e.dataModels=t.data})},e.selectDataModel=function(){for(var t,i=0;e.dataModels.length>i;i++)e.dataModels[i].id===e.selectedVariable.mappedDataModel&&(t=e.dataModels[i]);t&&t.dataModelDefinition.entities?(e.dataModelEntities=t.dataModelDefinition.entities,e.selectedVariable.mappedEntity&&e.selectEntity()):e.dataModelEntities=[]},e.selectEntity=function(){for(var t,i=0;e.dataModelEntities.length>i;i++)e.dataModelEntities[i].name===e.selectedVariable.mappedEntity&&(t=e.dataModelEntities[i]);e.dataModelAttributes=t&&t.attributes?t.attributes:[]},e.loadDataModels(),e.variableTypes=["string","integer","boolean","people","group","date"];var a=i("PROPERTY.EXECUTION.VARIABLES.VARIABLENAME.LABEL"),s=i("PROPERTY.EXECUTION.VARIABLES.VARIABLETYPE.LABEL");t.all([a,s]).then(function(t){e.labels.variableNameLabel=t[0],e.labels.variableTypeLabel=t[1],e.translationsRetrieved=!0,e.gridOptions={data:e.variables,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"variableName",displayName:e.labels.variableNameLabel},{field:"variableType",displayName:e.labels.variableTypeLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){t.isSelected?(e.selectedVariable=t.entity,e.selectedVariable.mappedDataModel&&e.selectDataModel()):e.selectedVariable=void 0})}}),e.addNewVariable=function(){var t={variableName:"",variableType:e.variableTypes[0]};e.variables.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeVariable=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.variables.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.variables.splice(i,1),0==e.variables.length&&(e.selectedVariable=void 0),o(function(){e.variables.length>0&&e.gridApi.selection.toggleRowSelection(e.variables[0])})}},e.save=function(){var t=e.selectedShape.resourceId;if(e.selectedShape&&-1!==e.selectedShape.getStencil().id().indexOf("BPMNDiagram")&&(t="__root__process__"),e.variables.length>0){for(var i=[],o=0;e.variables.length>o;o++){var r={variableType:e.variables[o].variableType,variableName:e.variables[o].variableName};i.push(r)}n.updateExecutionVariablesCache(t,i),e.property.value=[],Array.prototype.push.apply(e.property.value,e.variables)}else e.property.value=null,n.updateExecutionVariablesCache(t);e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.$hide(),e.property.mode="read"},e.close=function(){e.$hide(),e.property.mode="read"}}]),angular.module("activitiModeler").controller("ActivitiExecutionSingleVariableCtrl",["$scope","ProcessScopeService",function(e,t){e.shapeId=e.selectedShape.id,e.resourceId=e.selectedShape.resourceId,e.valueFlushed=!1,e.inputBlurred=function(){e.valueFlushed=!0,e.property.value&&(e.property.value=i(e.resourceId,e.property.key,e.property.value)),e.updatePropertyInModel(e.property)},e.enterPressed=function(t){t&&13===t.which&&(t.preventDefault(),e.inputBlurred())},e.$on("$destroy",function(){e.valueFlushed||(e.property.value&&(e.property.value=i(e.resourceId,e.property.key,e.property.value)),e.updatePropertyInModel(e.property,e.shapeId))});var i=function(e,i,o){if(e&&void 0!==e&&i&&void 0!==i&&o&&void 0!==o)if(o.variableName&&""!==o.variableName&&(o.variableName=o.variableName.replace(/(<([^>]+)>)/gi,"")),o.variableName&&""!==o.variableName){var n;"oryx-executionvariable_string"===i?n="string":"oryx-executionvariable_document"===i&&(n="document"),o.variableType=n;var r=[o];t.updateExecutionVariablesCache(e,r)}else o=null,t.updateExecutionVariablesCache(e);return o}}]),angular.module("activitiModeler").controller("ActivitiFieldsToVariablesPopupCtrl",["$scope","$q","$translate","$timeout","ProcessScopeService","DataModelService","EditorScopeService",function(e,t,i,o,n,r,a){"use strict";function s(){e.selectedMapping&&(e.selectedMapping.formField=null,e.selectedMapping.mappedColumn=null,e.selectedMapping.mappedEntity=null)}e.mappings=void 0!==e.property.value&&null!==e.property.value&&e.property.value.length>0?e.property.value.constructor===String?JSON.parse(e.property.value):angular.copy(e.property.value):[],e.elementMappings=[],e.selectedMapping=void 0,e.selectedDataModel=void 0,e.selectedEntity=void 0,e.labels={},e.loadDataModels=function(){var t=e.editor.getModelMetaData();r.getDataModels(t.modelId).then(function(t){e.dataModels=t.data})},e.selectDataModel=function(t){t&&s();for(var i=0;e.dataModels.length>i;i++)if(e.dataModels[i].id===e.selectedMapping.mappedDataModel){e.selectedDataModel=e.dataModels[i];break}e.selectedDataModel&&e.selectedDataModel.dataModelDefinition.entities?(e.dataModelEntities=e.selectedDataModel.dataModelDefinition.entities,e.selectedMapping.mappedEntity&&e.selectEntity(),e.selectedMapping.mappedEndpoint&&e.selectEndpoint()):e.dataModelEntities=[]},e.selectEntity=function(){for(var t=0;e.dataModelEntities.length>t;t++)if(e.dataModelEntities[t].name===e.selectedMapping.mappedEntity){e.selectedEntity=e.dataModelEntities[t];break}e.selectedDataModel.dataModelDefinition.dataSourceType,e.dataModelAttributes=e.selectedEntity&&e.selectedEntity.attributes?e.selectedEntity.attributes:[]},e.setElementTypeStaticValue=function(){e.selectedElementMapping.valueType="static"},e.setElementTypeFormFieldValue=function(){e.selectedElementMapping.valueType="field"},e.setElementTypeVariable=function(){e.selectedElementMapping.valueType="variable"},e._getElementVariableColumnValue=function(e){var t="";return e?(e.formField?t=e.formField.name:e.variable?t=e.variable.name:e.staticValue&&(t=e.staticValue),t):t},e.loadDataModels(),e.variableTypes=["string","integer","boolean","people","group"];var l=i("PROPERTY.FIELDS.TO.VARIABLES.FORMFIELD.LABEL"),d=i("PROPERTY.FIELDS.TO.VARIABLES.MAPPEDENTITY.LABEL"),c=i("PROPERTY.FIELDS.TO.VARIABLES.MAPPEDVARIABLENAME.LABEL");t.all([l,d,c]).then(function(t){e.labels.formFieldLabel=t[0],e.labels.mappedEntityLabel=t[1],e.labels.mappedVariableNameLabel=t[2],e.translationsRetrieved=!0,e.gridOptions={data:e.mappings,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"formField.name",displayName:e.labels.formFieldLabel},{field:"mappedEntity",displayName:e.labels.mappedEntityLabel},{field:"mappedVariableName",displayName:e.labels.mappedVariableNameLabel}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){t.isSelected?(e.selectedMapping=t.entity,e.selectedMapping.mappedDataModel&&e.selectDataModel()):e.selectedMapping=void 0})}}),e.selectFormField=function(t){e.selectedMapping.formField=t},e.addNewMapping=function(){var t={};e.mappings.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeMapping=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.mappings.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.mappings.splice(i,1),0===e.mappings.length&&(e.selectedMapping=void 0),o(function(){e.mappings.length>0&&e.gridApi.selection.toggleRowSelection(e.mappings[0])})}},e.save=function(){var t=e.selectedShape.resourceId;if(e.selectedShape&&-1!==e.selectedShape.getStencil().id().indexOf("BPMNDiagram")&&(t="__root__process__"),n.updateFieldMappingVariablesCache(t),e.mappings.length>0){for(var i=[],o=0;e.mappings.length>o;o++){for(var r,a=0;e.dataModels.length>a;a++)if(e.dataModels[a].id===e.mappings[o].mappedDataModel){r=e.dataModels[a];break}if(r&&e.mappings[o].mappedEntity){var s;r.dataModelDefinition.entities;for(var a=0;e.dataModelEntities.length>a;a++)if(e.dataModelEntities[a].name===e.mappings[o].mappedEntity){s=e.dataModelEntities[a];break}if(s&&s.attributes)for(var a=0;s.attributes.length>a;a++){var l={variableName:e.mappings[o].mappedVariableName+"."+s.attributes[a].name,variableType:s.attributes[a].type};i.push(l)}}}n.updateFieldMappingVariablesCache(t,i),e.property.value=[],Array.prototype.push.apply(e.property.value,e.mappings)}else e.property.value=null;e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.$hide(),e.property.mode="read"},e.close=function(){e.$hide(),e.property.mode="read"};var p=e.selectedItem.properties.find(function(e){return"oryx-formreference"===e.key}).value;if(p&&p.id){var u=n.getFormFieldsForForm(p.id);if(u){for(var m=["text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount","multi-line-text"],h=[],f=0;u.length>f;f++)m.indexOf(u[f].type)>=0&&h.push(u[f]);e.availableFormFields=h}}e.allSteps=a.collectSortedElementsFromPrecedingElements(e.selectedShape)}]),angular.module("activitiModeler").controller("ActivitiGenerateDocumentOutputFormatController",["$scope",function(e){void 0==e.property.value&&null==e.property.value&&(e.property.value="None"),e.outputFormatChanged=function(){e.updatePropertyInModel(e.property)}}]),angular.module("activitiModeler").controller("ActivitiGenerateDocumentTemplateCtrl",["$scope","$modal","$timeout","Upload","DocumentTemplateService",function(e,t,i,o,n){e.documentTemplate=e.property.value&&void 0!==e.property.value?angular.copy(e.property.value):{};var r=_internalCreateModal({template:"editor-app/configuration/properties/generatedocument-template-popup.html?version="+Date.now(),scope:e},t,e);e.save=function(){e.property.value=e.documentTemplate&&void 0!==e.documentTemplate?e.documentTemplate:null,e.updatePropertyInModel(e.property),r.$scope.$hide()},e.cancel=function(){r.$scope.$hide(),e.property.mode="read"},e.close=function(){e.cancel()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.documentTemplateModel={currentTab:"tenantTemplates",currentTemplateDownloadUrl:"",nameFilter:"",sort:"sort_by_name_asc",page:0,pageSize:20,possibleSorts:[{id:"sort_by_name_asc",title:"PROPERTY.GENERATEDOCUMENT.TEMPLATE.SORT-NAME-ASC"},{id:"sort_by_name_desc",title:"PROPERTY.GENERATEDOCUMENT.TEMPLATE.SORT-NAME-DESC"},{id:"sort_by_create_date_asc",title:"PROPERTY.GENERATEDOCUMENT.TEMPLATE.SORT-CREATED-ASC"},{id:"sort_by_create_date_desc",title:"PROPERTY.GENERATEDOCUMENT.TEMPLATE.SORT-CREATED-DESC"}]},e.onNewUploadSelected=function(t,i){e.documentTemplateModel.loading=!0;for(var n=0;t.length>n;n++){var r,a=t[n],s=a.name.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"});r=i?ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/document-templates/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/document-templates",o.upload({url:r,method:"POST",params:{modelId:e.editor.getModelMetaData().modelId},file:a,fileName:s}).progress(function(t){e.documentTemplateModel.uploadProgress=parseInt(100*t.loaded/t.total)}).success(function(t){null!==t.id&&void 0!==t.id&&(e.selectTemplate(t),e.save()),e.documentTemplateModel.loading=!1}).error(function(t){t&&t.message&&(e.documentTemplateModel.errorMessage=t.message),e.documentTemplateModel.error=!0,e.documentTemplateModel.loading=!1})}};var a=function(){e.documentTemplateModel.loadingDocumentTemplates=!0,n.findAllDocumentTemplates(e.documentTemplateModel.nameFilter,e.documentTemplateModel.sort,e.documentTemplateModel.page,e.documentTemplateModel.pageSize).then(function(t){e.documentTemplateModel.templates=t,e.documentTemplateModel.moreTemplates=t.total>(e.documentTemplateModel.page+1)*e.documentTemplateModel.pageSize;for(var i=0;e.documentTemplateModel.templates.data.length>i;i++)e.documentTemplateModel.templates.data[i].downloadUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/document-templates/"+e.documentTemplateModel.templates.data[i].id+"/file?version="+Date.now();e.documentTemplateModel.loadingDocumentTemplates=!1}),e.documentTemplate&&e.documentTemplate.id&&n.getDocumentTemplate(e.documentTemplate.id).then(function(t){e.documentTemplate={id:t.id,name:t.name}},function(){e.documentTemplate={}})};e.cancelUploadNew=function(){e.uploadNewPopup.$scope.$hide()},e.sortChanged=function(){e.documentTemplateModel.page=0,a()},e.refreshDelayed=function(){e.documentTemplateModel.waiting?e.documentTemplateModel.delayed=!0:e.scheduleDelayedRefresh()},e.scheduleDelayedRefresh=function(){e.documentTemplateModel.waiting=!0,i(function(){e.documentTemplateModel.waiting=!1,e.documentTemplateModel.delayed?(e.documentTemplateModel.delayed=!1,e.scheduleDelayedRefresh()):(e.documentTemplateModel.page=0,a())},100)},e.showPreviousTemplates=function(){e.documentTemplateModel.page--,a()},e.showNextTemplates=function(){e.documentTemplateModel.page++,a()},e.selectTemplate=function(t){e.documentTemplate={id:t.id,name:t.name},e.property.noValue=!1,e.buildDownloadUrl()},e.buildDownloadUrl=function(){e.documentTemplate&&e.documentTemplate.id&&(e.documentTemplateModel.currentTemplateDownloadUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/document-templates/"+e.documentTemplate.id+"/file?version="+Date.now())
},a(),e.buildDownloadUrl()}]),angular.module("activitiModeler").service("DocumentTemplateService",["$http","$q","$rootScope","$translate",function(e,t){var i=function(i){var o=t.defer();return e(i).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise};this.findAllDocumentTemplates=function(e,t,o,n){var r={nameFilter:e,start:o,size:n,sort:t};return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/document-templates",params:r})},this.getDocumentTemplate=function(e){return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/document-templates/"+e})}}]),angular.module("activitiModeler").controller("ActivitiProcessvariableMappingsSubProcessCtrl",["$scope","$modal",function(e,t){var i={template:"editor-app/configuration/properties/variablesmappingsubprocess-edit.html?version="+Date.now(),scope:e};_internalCreateModal(i,t,e)}]),angular.module("activitiModeler").controller("ActivitiProcessVariableMappingsSubProcessPopupCtrl",["$scope","$q","$translate","$timeout","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r){function a(){return e.property.newVariablesMapping?e.selectedSubProcess.constructor===String?JSON.parse(e.property.newVariablesMapping):angular.copy(e.property.newVariablesMapping):e.selectedSubProcess.variablesmapping===String?JSON.parse(e.selectedSubProcess.variablesmapping):angular.copy(e.selectedSubProcess.variablesmapping)}function s(){return e.selectedSubProcess&&e.selectedSubProcess.id!==e.storedId}function l(){return e.selectedSubProcess&&e.selectedSubProcess.variablesmapping}function d(t){var i=[],o=[],n=[],r=t[0].forms;for(var a in r){var s=r[a][0].fields;for(var l in s){var d=s[l];d&&d.id&&-1===n.indexOf(d.name)&&(n.push(d.name),i.push({id:d.id,name:d.name,type:d.type}))}}n=[];var c=t[0].executionVariables;for(var p in c){var u=c[p];for(var m in u){var h=u[m];h&&h.processVariableName&&-1===n.indexOf(h.processVariableName)&&o.push({id:h.processVariableName,name:h.processVariableName,type:h.processVariableType})}}e.formVariablesArray=i.uniq(),e.executionVariablesArray=o.uniq()}e.variablesMapping=[],e.allSteps=r.collectSortedElementsFromPrecedingElements(e.selectedShape),n.getSopreVariables(e.selectedSubProcess.id,{success:function(e){d(e)}}),s()?e.variablesMapping=[]:l()&&(e.variablesMapping=a()),e.disableRemove=function(){return void 0===e.currentVariableMapping?!0:e.model.variablesMapping&&0===e.model.variablesMapping.length},e.configGrid=function(){e.gridOptions={data:e.variablesMapping,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"inProcessVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.INPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnInProcessVariable(row.entity)}}</div>'},{field:"inVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.inVariableType}}</div>'},{field:"mappedVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.mappedVariableType}}</div>'},{field:"mappedVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.SUBPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getmappedVariable(row.entity)}}</div>'},{field:"outProcessVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.OUTPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnOutputProcessVariable(row.entity)}}</div>'},{field:"outVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.outVariableType}}</div>'},{field:"typeOfMapping",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.typeOfMapping}}</div>'}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.currentVariableMapping=t.isSelected?t.entity:void 0})}},e.configGrid(),e.variablesMapping.forEach(function(e){e.inProcessVariable={id:e.inProcessVariable,name:e.inProcessVariable},e.outProcessVariable={id:e.outProcessVariable,name:e.outProcessVariable},e.mappedVariable={id:e.mappedVariable,name:e.mappedVariable}}),e._getmappedVariable=function(e){var t;return t=e.mappedVariable&&e.mappedVariable.hasOwnProperty("id")?e.mappedVariable.id:e.mappedVariable},e._getVariableColumnInProcessVariable=function(e){var t;return t=e.inProcessVariable&&e.inProcessVariable.hasOwnProperty("id")?e.inProcessVariable.id:e.inProcessVariable},e._getVariableColumnOutputProcessVariable=function(e){var t;return t=e.outProcessVariable&&e.outProcessVariable.hasOwnProperty("id")?e.outProcessVariable.id:e.outProcessVariable},e.addField=function(){var t={mappedVariable:"",inProcessVariable:"",outProcessVariable:"",inVariableType:"formField",outVariableType:"staticValue",typeOfMapping:"inputMap",mappedVariableType:"formField"};e.variablesMapping.push(t),e.gridApi.selection.clearSelectedRows(),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeField=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.variablesMapping.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.variablesMapping.splice(i,1),0===e.variablesMapping.length&&(e.variablesMapping.selectedField=void 0),o(function(){if(e.variablesMapping.length>0){var t=i-1>=0?i-1:0;e.gridApi.selection.toggleRowSelection(e.variablesMapping[t])}})}},e.save=function(){e.selectedSubProcess&&(e.property.value={id:e.selectedSubProcess.id,name:e.selectedSubProcess.name,referenceId:e.selectedSubProcess.referenceId,variablesmapping:e.selectedSubProcess.variablesmapping});var t=[];e.variablesMapping.length>0&&e.variablesMapping.forEach(function(e){t.push({mappedVariable:e.mappedVariable?e.mappedVariable.id:"",inProcessVariable:e.inProcessVariable?e.inProcessVariable.id:"",outProcessVariable:e.outProcessVariable?e.outProcessVariable.id:"",typeOfMapping:e.typeOfMapping,inVariableType:e.inVariableType,outVariableType:e.outVariableType,mappedVariableType:e.mappedVariableType})}),e.property.value.variablesmapping=t,e.updatePropertyInModel(e.property),n.refresh(),e.close()},e.setInputVariableType=function(t){e.currentVariableMapping.inVariableType=t,e.currentVariableMapping.inProcessVariable=void 0},e.setOutputVariableType=function(t){e.currentVariableMapping.outVariableType=t,e.currentVariableMapping.outProcessVariable=void 0},e.setMappedVariableType=function(t){e.currentVariableMapping.mappedVariableType=t,e.currentVariableMapping.mappedVariable=void 0},e.setTypeOfMapping=function(t){var i=e.gridApi.selection.getSelectedRows()[0];i.mappedVariable="",i.inProcessVariable="",i.outProcessVariable="",i.inVariableType="formField",i.outVariableType="staticValue",i.mappedVariableType="formField",e.currentVariableMapping.typeOfMapping=t},e.cancel=function(){e.$hide(),e.property.mode="read",e.popup={state:"subProcessReference"}},e.backToReferenceSelector=function(){var t=[];e.variablesMapping.length>0&&e.variablesMapping.forEach(function(e){t.push({mappedVariable:e.mappedVariable?e.mappedVariable.id:"",inProcessVariable:e.inProcessVariable?e.inProcessVariable.id:"",outProcessVariable:e.outProcessVariable?e.outProcessVariable.id:"",typeOfMapping:e.typeOfMapping,inVariableType:e.inVariableType,outVariableType:e.outVariableType,mappedVariableType:e.mappedVariableType})}),e.property.newVariablesMapping=t,e.popup.state="subProcessReference";var i=e.editor.getModelMetaData();e.model={loading:!1,subProcess:{name:"",description:"",modelType:0,referenceId:i.modelId,stencilSet:0},defaultStencilSet:void 0},e.storedId=e.selectedSubProcess.id},e.close=function(){e.$hide(),e.property.mode="read"}}]),angular.module("activitiModeler").controller("ActivitiProcessMetadataPopupCtrl",["$scope","$q","$translate","$timeout",function(e,t,i,o){e.metadata={fields:[],selectedField:null},e.metadata.fields=void 0!==e.property.value&&null!==e.property.value&&e.property.value.length>0?e.property.value.constructor==String?JSON.parse(e.property.value):angular.copy(e.property.value):[],e.gridOptions={data:e.metadata.fields,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"key",displayName:i.instant("PROPERTY.METADATA.KEY")},{field:"value",displayName:i.instant("PROPERTY.METADATA.VALUE")}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.metadata.selectedField=t.isSelected?t.entity:void 0})},e.addField=function(){var t={key:"",value:""};e.metadata.fields.push(t),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeField=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.metadata.fields.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.metadata.fields.splice(i,1),0==e.metadata.fields.length&&(e.metadata.selectedField=void 0),o(function(){e.metadata.fields.length>0&&e.gridApi.selection.toggleRowSelection(e.metadata.fields[0])})}},e.save=function(){e.property.value=e.metadata.fields.length>0?e.metadata.fields.filter(function(e){return e.key&&e.key.length>0&&e.key.trim().length>0}):null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.$hide(),e.property.mode="read"},e.close=function(){e.$hide(),e.property.mode="read"}}]),angular.module("activitiModeler").controller("ActivitiProcessVariableMappingsPopupCtrl",["$scope","$q","$translate","$timeout","ProcessScopeService","EditorScopeService",function(e,t,i,o,n,r){function a(){return e.property.newVariablesMapping?e.selectedForm.constructor===String?JSON.parse(e.property.newVariablesMapping):angular.copy(e.property.newVariablesMapping):e.selectedForm.constructor===String?JSON.parse(e.selectedForm.variablesmapping):angular.copy(e.selectedForm.variablesmapping)}function s(){return e.selectedForm&&e.selectedForm.id!==e.storedId}function l(){return e.selectedForm&&e.selectedForm.variablesmapping}e.variablesMapping=[],e.allSteps=r.collectSortedElementsFromPrecedingElements(e.selectedShape),e.getFormAttached=function(){var t=e.selectedItem.properties.find(function(e){return"oryx-formreference"===e.key}).value;return t},e.isStartEvent=function(){return"StartNoneEvent"===e.selectedShape.getStencil().idWithoutNs()},e.disableRemove=function(){return void 0===e.currentVariableMapping?!0:e.model.variablesMapping&&0===e.model.variablesMapping.length},e.configGrid=function(){e.gridOptions={data:e.variablesMapping,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"inProcessVariable",visible:!e.isStartEvent(),displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.INPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnInProcessVariable(row.entity)}}</div>'},{field:"inVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.inVariableType}}</div>'},{field:"formVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.FORMVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnForm(row.entity)}}</div>'},{field:"outProcessVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-MESSAGE.OUTPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnOutputProcessVariable(row.entity)}}</div>'},{field:"outVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.outVariableType}}</div>'},{field:"typeOfMapping",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.typeOfMapping}}</div>'}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.currentVariableMapping=t.isSelected?t.entity:void 0})}},e.configGrid(),e._getVariableColumnForm=function(e){return e.formVariable&&e.formVariable.hasOwnProperty("id")?e.formVariable.id:e.formVariable},e._getVariableColumnInProcessVariable=function(e){return e.inProcessVariable&&e.inProcessVariable.hasOwnProperty("id")?e.inProcessVariable.id:e.inProcessVariable},e._getVariableColumnOutputProcessVariable=function(e){return e.outProcessVariable&&e.outProcessVariable.hasOwnProperty("id")?e.outProcessVariable.id:e.outProcessVariable},e.addField=function(){var t={formVariable:"",inProcessVariable:"",outProcessVariable:"",inVariableType:"formField",outVariableType:"staticValue",typeOfMapping:"inputOutputMap"};e.variablesMapping.push(t),e.gridApi.selection.clearSelectedRows(),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeField=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.variablesMapping.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.variablesMapping.splice(i,1),0===e.variablesMapping.length&&(e.variablesMapping.selectedField=void 0),o(function(){if(e.variablesMapping.length>0){var t=i-1>=0?i-1:0;e.gridApi.selection.toggleRowSelection(e.variablesMapping[t])}})}},e.save=function(){e.selectedForm&&(e.property.value={id:e.selectedForm.id,name:e.selectedForm.name,referenceId:e.selectedForm.referenceId,variablesmapping:e.selectedForm.variablesmapping});var t=[];e.variablesMapping.length>0&&e.variablesMapping.forEach(function(e){t.push({mappedVariable:e.formVariable?e.formVariable.id:"",inProcessVariable:e.inProcessVariable?e.inProcessVariable.id:"",outProcessVariable:e.outProcessVariable?e.outProcessVariable.id:"",typeOfMapping:e.typeOfMapping,inVariableType:e.inVariableType,outVariableType:e.outVariableType})}),e.property.value.variablesmapping=t,e.updatePropertyInModel(e.property),n.refresh(),e.close()},e.setInputVariableType=function(t){e.currentVariableMapping.inVariableType=t,e.currentVariableMapping.inProcessVariable=void 0},e.setOutputVariableType=function(t){e.currentVariableMapping.outVariableType=t,e.currentVariableMapping.outProcessVariable=void 0},e.setTypeOfMapping=function(t){var i=e.gridApi.selection.getSelectedRows()[0];i||(i={}),i.formVariable="",i.inProcessVariable="",i.outProcessVariable="",i.inVariableType="formField",i.outVariableType="staticValue",e.currentVariableMapping.typeOfMapping=t},e.cancel=function(){e.$hide(),e.property.mode="read"},e.close=function(){e.$hide(),e.property.mode="read"},e.backToReferenceSelector=function(){var t=[];e.variablesMapping.length>0&&e.variablesMapping.forEach(function(e){t.push({mappedVariable:e.formVariable?e.formVariable.id:"",inProcessVariable:e.inProcessVariable?e.inProcessVariable.id:"",outProcessVariable:e.outProcessVariable?e.outProcessVariable.id:"",typeOfMapping:e.typeOfMapping,inVariableType:e.inVariableType,outVariableType:e.outVariableType})}),e.property.newVariablesMapping=t,e.popup.state="formReference";var i=e.editor.getModelMetaData();e.model={loading:!1,form:{name:"",description:"",modelType:2,referenceId:i.modelId,stencilSet:0},defaultStencilSet:void 0,formStencilSets:[]},e.storedId=e.selectedForm.id},s()?e.variablesMapping.length=0:l()&&(Array.prototype.push.apply(e.variablesMapping,a()),n.getFormFieldsForFormFromServer(e.selectedForm.id).then(function(t){e.currentFormVariables=t,e.variablesMapping.forEach(function(t){t.inProcessVariable={id:t.inProcessVariable,name:t.inProcessVariable},t.outProcessVariable={id:t.outProcessVariable,name:t.outProcessVariable},t.formVariable=e.currentFormVariables.find(function(e){return e.id===t.mappedVariable})}),n.getFormModel(e.selectedForm.id).then(function(t){e.formVariables=(t.formDefinition.variables||[]).map(function(e){return{id:e.name,name:e.name,type:e.type}}),e.formVariables.forEach(function(t){var i=e.variablesMapping.find(function(e){return e.mappedVariable===t.id});i&&(i.formVariable=t)})})}))}]),angular.module("activitiModeler").controller("ActivitiProcessvariableMappingsReusableTablePopupCtrl",["$scope","$q","$translate","$timeout","ProcessScopeService","DecisionTableService","EditorScopeService",function(e,t,i,o,n,r,a){function s(){var t=[];return e.table.decisionTableDefinition.inputExpressions.forEach(function(e){var i={id:e.variableId,name:e.variableId,type:e.type};t.push(i)}),t.uniq()}function l(){var t=[];return e.table.decisionTableDefinition.outputExpressions.forEach(function(e){var i={id:e.variableId,name:e.variableId,type:e.type};t.push(i)}),t.uniq()}function d(){return e.property.newVariablesMapping?e.selectedDecisionTable.constructor===String?JSON.parse(e.property.newVariablesMapping):angular.copy(e.property.newVariablesMapping):e.selectedDecisionTable.constructor===String?JSON.parse(e.selectedDecisionTable.variablesmapping):angular.copy(e.selectedDecisionTable.variablesmapping)}function c(){return e.selectedDecisionTable&&e.selectedDecisionTable.id!==e.storedId}function p(){return e.selectedDecisionTable&&e.selectedDecisionTable.variablesmapping}e.loadingTable=!0,e.variablesMapping=[],e.allSteps=a.collectSortedElementsFromPrecedingElements(e.selectedShape),e.selectedDecisionTable.id?r.fetchDecisionTableDetails(e.selectedDecisionTable.id).then(function(t){e.table=t,e.inputExpression=s(),e.outputExpression=l(),e.getPreviousAndCurrentTableFields(),e.loadingTable=!1}):e.loadingTable=!1,c()?e.variablesMapping=[]:p()&&(e.variablesMapping=d()),e.disableRemove=function(){return void 0===e.currentVariableMapping?!0:e.model.variablesMapping&&0===e.model.variablesMapping.length},e.configGrid=function(){e.gridOptions={data:e.variablesMapping,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"inProcessVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-REUSABLE-TABLE-MESSAGE.INPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnInProcessVariable(row.entity)}}</div>'},{field:"inVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.inVariableType}}</div>'},{field:"tableVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-REUSABLE-TABLE-MESSAGE.TABLEVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnTable(row.entity)}}</div>'},{field:"outProcessVariable",displayName:i.instant("PROCESS-BUILDER.VARIABLE-MAPPING-REUSABLE-TABLE-MESSAGE.OUTPROCESSVARIABLE"),cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getVariableColumnOutputProcessVariable(row.entity)}}</div>'},{field:"outVariableType",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.outVariableType}}</div>'}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.currentVariableMapping=t.isSelected?t.entity:void 0})}},e.configGrid(),e.getPreviousAndCurrentTableFields=function(){e.variablesMapping.forEach(function(t){t.inProcessVariable={id:t.inProcessVariable,name:t.inProcessVariable},t.outProcessVariable={id:t.outProcessVariable,name:t.outProcessVariable},t.tableVariable=t.inProcessVariable.id?e.inputExpression.find(function(e){return e.id===t.mappedVariable}):e.outputExpression.find(function(e){return e.id===t.mappedVariable})})},e._getVariableColumnTable=function(e){var t;return t=e.tableVariable&&e.tableVariable.hasOwnProperty("id")?e.tableVariable.id:e.tableVariable},e._getVariableColumnInProcessVariable=function(e){var t;return t=e.inProcessVariable&&e.inProcessVariable.hasOwnProperty("id")?e.inProcessVariable.id:e.inProcessVariable},e._getVariableColumnOutputProcessVariable=function(e){var t;return t=e.outProcessVariable&&e.outProcessVariable.hasOwnProperty("id")?e.outProcessVariable.id:e.outProcessVariable},e.addField=function(){var t={tableVariable:"",inProcessVariable:"",outProcessVariable:"",inVariableType:"formField",outVariableType:"staticValue",typeOfMapping:"inputMap"};e.variablesMapping.push(t),e.gridApi.selection.clearSelectedRows(),o(function(){e.gridApi.selection.toggleRowSelection(t)})},e.removeField=function(){var t=e.gridApi.selection.getSelectedRows();if(t&&t.length>0){var i=e.variablesMapping.indexOf(t[0]);e.gridApi.selection.toggleRowSelection(t[0]),e.variablesMapping.splice(i,1),0===e.variablesMapping.length&&(e.variablesMapping.selectedField=void 0),o(function(){if(e.variablesMapping.length>0){var t=i-1>=0?i-1:0;e.gridApi.selection.toggleRowSelection(e.variablesMapping[t])}})}},e.save=function(){e.selectedDecisionTable&&(e.property.value={id:e.selectedDecisionTable.id,name:e.selectedDecisionTable.name,referenceId:e.selectedDecisionTable.referenceId,variablesmapping:e.selectedDecisionTable.variablesmapping});var t=[];e.variablesMapping.length>0&&e.variablesMapping.forEach(function(e){t.push({mappedVariable:e.tableVariable?e.tableVariable.id:"",inProcessVariable:e.inProcessVariable?e.inProcessVariable.id:"",outProcessVariable:e.outProcessVariable?e.outProcessVariable.id:"",typeOfMapping:e.typeOfMapping,inVariableType:e.inVariableType,outVariableType:e.outVariableType})}),e.property.value.variablesmapping=t,e.updatePropertyInModel(e.property),n.refresh(),e.close()},e.setInputVariableType=function(t){e.currentVariableMapping.inVariableType=t,e.currentVariableMapping.inProcessVariable=void 0},e.setOutputVariableType=function(t){e.currentVariableMapping.outVariableType=t,e.currentVariableMapping.outProcessVariable=void 0},e.setTypeOfMapping=function(t){var i=e.gridApi.selection.getSelectedRows()[0];i.tableVariable="",i.inProcessVariable="",i.outProcessVariable="",i.inVariableType="formField",i.outVariableType="staticValue",e.currentVariableMapping.typeOfMapping=t},e.isEmbeddedTable=function(){return e.table&&e.table.isEmbeddedTable},e.cancel=function(){e.$hide(),e.property.mode="read"},e.close=function(){e.$hide(),e.property.mode="read"},e.backToReferenceSelector=function(){var t=[];e.variablesMapping.length>0&&e.variablesMapping.forEach(function(e){t.push({mappedVariable:e.tableVariable?e.tableVariable.id:"",inProcessVariable:e.inProcessVariable?e.inProcessVariable.id:"",outProcessVariable:e.outProcessVariable?e.outProcessVariable.id:"",typeOfMapping:e.typeOfMapping,inVariableType:e.inVariableType,outVariableType:e.outVariableType})}),e.property.newVariablesMapping=t,e.popup.state="decisionTableReference";var i=e.editor.getModelMetaData();e.model={loading:!1,decisionTable:{name:"",description:"",modelType:4,referenceId:i.modelId,stencilSet:0},defaultStencilSet:void 0,decisionTableStencilSets:[]},e.storedId=e.selectedDecisionTable.id}}]),angular.module("activitiModeler").controller("ActivitiEntityAttributeMappingPopupCtrl",["$scope","$q","$translate","$timeout","ProcessScopeService","DataModelService","EditorScopeService",function(e,t,i,o,n,r,a){"use strict";function s(){e.selectedAttributeMapping.variable=null,e.selectedAttributeMapping.formField=null,e.selectedAttributeMapping.staticValue=null}e.entityObject=e.property.value?e.property.value.constructor==String?e.property.value.length>0?JSON.parse(e.property.value):{}:angular.copy(e.property.value):{},e.attributeMappings=[],e.selectedAttributeMapping=void 0,e.selectedDataModel=void 0,e.selectedEntity=void 0,e.labels={},e.loadDataModels=function(){var t=e.editor.getModelMetaData();r.getDataModels(t.modelId).then(function(t){e.dataModels=t.data,e.entityObject.mappedDataModel&&e.selectDataModel()})},e.selectDataModel=function(){for(var t=0;e.dataModels.length>t;t++)if(e.dataModels[t].id===e.entityObject.mappedDataModel){e.selectedDataModel=e.dataModels[t];break}e.selectedDataModel&&e.selectedDataModel.dataModelDefinition.entities?(e.dataModelEntities=e.selectedDataModel.dataModelDefinition.entities,e.entityObject.mappedEntity&&e.selectEntity()):e.dataModelEntities=[]},e.selectEntity=function(){for(var t=0;e.dataModelEntities.length>t;t++)if(e.dataModelEntities[t].name===e.entityObject.mappedEntity){e.selectedEntity=e.dataModelEntities[t];break}e.selectedDataModel.dataModelDefinition.dataSourceType,e.attributeMappings.length=0,e.dataModelAttributes=e.selectedEntity&&e.selectedEntity.attributes?e.selectedEntity.attributes:[];for(var t=0;e.dataModelAttributes.length>t;t++){var i={attributeName:e.dataModelAttributes[t].name,attributeType:e.dataModelAttributes[t].type,attributePrimaryKey:e.dataModelAttributes[t].primaryKey,attributeIdentity:e.dataModelAttributes[t].identity,attributeRequired:e.dataModelAttributes[t].required};if(e.entityObject.attributeMappings)for(var o=0;e.entityObject.attributeMappings.length>o;o++){var n=e.entityObject.attributeMappings[o];if(n.attributeName===i.attributeName){i.valueType=n.valueType,"field"===i.valueType?i.formField=n.formField:"variable"===i.valueType?i.variable=n.variable:i.staticValue=n.staticValue;break}}e.attributeMappings.push(i)}if(e.entityObject.attributeMappings=e.attributeMappings,e.entityObject.existingVariable&&e.entityObject.existingVariable.mappedVariableName&&e.entityVariables)for(var t=0;e.entityVariables.length>t;t++)if(e.entityVariables[t].mappedVariableName===e.entityObject.existingVariable.mappedVariableName){e.entityObject.existingVariable=e.entityVariables[t];break}},e.setVariableTypeNewVariable=function(){e.entityObject.variableType="new"},e.setVariableTypeExistingVariable=function(){e.entityObject.variableType="existing"},e.setMappedValueType=function(t){s(),e.selectedAttributeMapping.valueType=t},e._getElementVariableColumnValue=function(e){var t="";return e?(e.formField?t=e.formField.name:e.variable?t=e.variable.name:e.staticValue&&(t=e.staticValue),t):t},e.entityVariables=n.getEntityVariables(),e.loadDataModels(),e.variableTypes=["string","integer","boolean","people","group"];var l=i("PROPERTY.ENTITY-ATTRIBUTE-MAPPING.ATTRIBUTE-NAME.LABEL"),d=i("PROPERTY.ENTITY-ATTRIBUTE-MAPPING.MAPPING-VALUE.LABEL");t.all([l,d]).then(function(t){e.labels.attributeNameLabel=t[0],e.labels.mappedValueLabel=t[1],e.translationsRetrieved=!0,e.gridOptions={data:e.attributeMappings,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"attributeName",displayName:e.labels.attributeNameLabel},{field:"value",displayName:e.labels.mappedValueLabel,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope._getElementVariableColumnValue(row.entity)}}</div>'}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){t.isSelected?(e.selectedAttributeMapping=t.entity,e.selectedAttributeMapping.mappedDataModel&&e.selectDataModel()):e.selectedAttributeMapping=void 0})}}),e.selectFormField=function(t){e.selectedAttributeMapping.formField=t},e.save=function(){e.property.value=e.entityObject?e.entityObject:null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.$hide(),e.property.mode="read"},e.close=function(){e.$hide(),e.property.mode="read"},e.endpointElementFieldTypes=["text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount","select-folder","multi-line-text"],e.allSteps=a.collectSortedElementsFromPrecedingElements(e.selectedShape);var c=["text","integer","date","boolean","dropdown","radio-buttons","typeahead","amount","select-folder","multi-line-text"];e.availableFormFields=n.getFormFieldsForStep(e.allSteps,e.selectedShape.resourceId,c)}]),angular.module("activitiModeler").controller("KisBpmEmailTemplatePopupCtrl",["$rootScope","$scope","$translate","$http","UserService","GroupService","ProcessScopeService",function(e,t,i){if(t.sourceOptions=[{id:"default",title:i.instant("PROCESS-BUILDER.EMAIL-TEMPLATE-SOURCE.SRC-DEFAULT")},{id:"template",title:i.instant("PROCESS-BUILDER.EMAIL-TEMPLATE-SOURCE.SRC-TEMPLATE")},{id:"custom",title:i.instant("PROCESS-BUILDER.EMAIL-TEMPLATE-SOURCE.SRC-CUSTOM")}],t.sourceOption=t.sourceOptions[0],void 0!==t.property.value&&null!==t.property.value&&void 0!==t.property.value.emailTemplate&&null!==t.property.value.emailTemplate){t.emailTemplateObject=t.property.value.emailTemplate;var o;if(t.emailTemplateObject&&t.emailTemplateObject.type)for(var n=0;t.sourceOptions.length>n;n++)if(t.sourceOptions[n].id==t.emailTemplateObject.type){o=t.sourceOptions[n];break}o||(o=t.sourceOptions[0]),t.sourceOption=o}else t.emailTemplateObject={};t.$watch("sourceOption",function(e){e&&("template"==e.id?(t.emailTemplateObject.type="template",delete t.emailTemplateObject.templateText,delete t.emailTemplateObject.templateSubject):"custom"==e.id?(t.emailTemplateObject.type="custom",delete t.emailTemplateObject.template):(t.emailTemplateObject.type="default",delete t.emailTemplateObject.template,delete t.emailTemplateObject.templateText,delete t.emailTemplateObject.templateSubject))}),t.setTemplate=function(e){t.emailTemplateObject.template={id:e.id,name:e.name}},t.save=function(){t.property.value={},t.property.value.emailTemplate=t.emailTemplateObject,t.updatePropertyInModel(t.property),t.close()},t.close=function(){t.property.mode="read",t.$hide()}}]),angular.module("activitiModeler").controller("AlfrescoActionAccessorPopupCtrl",["$scope",function(e){"use strict";e.model={publishAsType:"process_initiator"},void 0!==e.property.value&&null!==e.property.value&&(e.model={userField:e.property.value.userField,user:e.property.value.user,email:e.property.value.email,externalId:e.property.value.externalId,userName:e.property.value.userName,publishAsType:e.property.value.publishAsType||"process_initiator"}),e.addPublishAs=function(t,i){t?(e.model.user=t.id,e.model.userField=null,e.model.userName=t.firstName?t.firstName+" "+t.lastName:t.lastName,e.model.email=t.email,e.model.externalId=t.externalId):(e.model.user=null,e.model.email=null,e.model.externalId=null,e.model.userField=i),e.model.publishAsType="user"},e.setPublishAs=function(t){"process_initiator"===t&&(e.model.user=void 0,e.model.userName=void 0,e.model.email=void 0,e.model.externalId=void 0),e.model.publishAsType=t},e.cancel=function(){e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()},e.save=function(){e.property.value={userField:e.model.userField,user:e.model.user,userName:e.model.userName,email:e.model.email,externalId:e.model.externalId,publishAsType:e.model.publishAsType},e.updatePropertyInModel(e.property),e.close()}}]),angular.module("activitiModeler").controller("AlfrescoActionInputSourcePopupCtrl",["$rootScope","$scope","EditorScopeService",function(e,t,i){"use strict";t.model={inputSourceType:"formField",inputSourceField:t.property.value,restEndpointFieldTypes:["upload"],allSteps:i.collectSortedElementsFromPrecedingElements(t.selectedShape)},t.setInputSourceType=function(e){t.model.inputSourceType=e,t.model.inputSourceField=null},t.cancel=function(){t.close()},t.$parent.$on("modal.hide.before",function(){t.close(),t.$parent.$apply()}),t.close=function(){t.property.mode="read",t.$hide()},t.save=function(){t.property.value=t.model.inputSourceField,t.updatePropertyInModel(t.property),t.close()}}]),angular.module("activitiModeler").controller("AlfrescoActionActionPopupCtrl",["$scope","$timeout","uiGridConstants","AlfrescoOneService",function(e,t,i,o){"use strict";e.model={actionName:null};var n=[];if(e.property.value&&(e.model.actionName=e.property.value.actionName,e.property.value.actionParams)){var r=JSON.parse(e.property.value.actionParams);n=Object.keys(r).map(function(e){return{name:e,value:r[e]}})}e.presets=[],o.getContentActionTemplates().then(function(t){e.presets=t||[]}),e.onPresetSelected=function(t,i){t.preventDefault(),e.model.actionName=i.name,n.splice(0,n.length),Array.prototype.push.apply(n,i.params),e.selectedActionParam=void 0,e.gridApi.selection.clearSelectedRows()},e.gridOptions={data:n,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:"Name"},{field:"value",displayName:"Value"}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedActionParam=t.isSelected?t.entity:void 0,e.focusFirstField()
})},e.focusFirstField=function(){t(function(){var e=document.getElementById("headerName");e&&e.focus()},100)},e.addNewActionParam=function(){var o={name:"",value:""};n.push(o),e.selectedActionParam=o,e.gridApi.core.notifyDataChange(i.dataChange.ALL),t(function(){e.gridApi.selection.toggleRowSelection(e.selectedActionParam)})},e.removeActionParam=function(){if(e.selectedActionParam){var o=n.indexOf(e.selectedActionParam);e.gridApi.selection.toggleRowSelection(e.selectedActionParam),n.splice(o,1),e.gridApi.core.notifyDataChange(i.dataChange.ALL),e.selectedActionParam=void 0,t(function(){n.length>0&&e.gridApi.selection.toggleRowSelection(n[0])})}},e.cancel=function(){e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()},e.save=function(){var t="";if(n.length>0){var i={};n.map(function(e){e&&e.name&&(i[e.name]=e.value)}),t=JSON.stringify(i)}e.property.value={actionName:e.model.actionName,actionParams:t},e.updatePropertyInModel(e.property),e.close()}}]),angular.module("activitiModeler").controller("AlfrescoActionRepositoryPopupCtrl",["$scope","ContentAccountService",function(e,t){"use strict";e.model={account:e.property.value},e.alfrescoAccount={selected:""},e.loadAlfrescoAccounts=function(){e.contentAlfrescoAccounts={loading:!0,onPrem:!1};var i=[],o=!1,n=!0;t.getAccounts().then(function(r){if(r&&r.data)for(var a=0;r.data.length>a;a++)n&&"alfresco-cloud"===r.data[a].serviceId||"alfresco-"===r.data[a].serviceId.substring(0,9)&&(i.push(r.data[a]),"alfresco-cloud"!==r.data[a].serviceId&&o===!1?o=!0:"alfresco-cloud"===r.data[a].serviceId&&(r.data[a].name="Alfresco Cloud"));if(e.model.account)for(var a=0;i.length>a;a++)e.model.account&&t.getAlfrescoServiceIdsMatch(i[a].serviceId,e.model.account.id)&&(e.alfrescoAccount.selected=i[a]);else e.alfrescoAccount.selected=i[0],e.onAccountChanged();e.contentAlfrescoAccounts.onPrem=o,e.contentAlfrescoAccounts.rawList=i,e.contentAlfrescoAccounts.loading=!1})},e.onAccountChanged=function(){var t=e.alfrescoAccount.selected;e.model.account=t?{id:t.serviceId,name:t.name}:null},e.loadAlfrescoAccounts(),e.cancel=function(){e.close()},e.$parent.$on("modal.hide.before",function(){e.close(),e.$parent.$apply()}),e.close=function(){e.property.mode="read",e.$hide()},e.save=function(){e.property.value=e.model.account,e.updatePropertyInModel(e.property),e.close()}}]);var KISBPM=KISBPM||{};KISBPM.CONFIG={showRemovedProperties:!1},KISBPM.HEADER_CONFIG={showAppTitle:!0,showHeaderMenu:!0,showMainNavigation:!0,showPageHeader:!0};var KISBPM=KISBPM||{};KISBPM.URL={getModel:function(e){return ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+e+"/editor/json?version="+Date.now()},getStencilSet:function(e){return ACTIVITI.CONFIG.contextRoot+"/app/rest/stencil-sets/"+e+"/editor?version="+Date.now()},putModel:function(e){return ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+e+"/editor/json"},validateModel:function(e){return ACTIVITI.CONFIG.contextRoot+"/app/rest/models/"+e+"/editor/validate"},postFeedback:function(){return ACTIVITI.CONFIG.contextRoot+"/app/rest/feedback"},getEditorValues:function(e){for(var t="",i=0;e.length>i;i++)t.length>0&&(t+="&"),t+="formId="+e[i];return t.length>0&&(t+="&"),t+="version="+Date.now(),ACTIVITI.CONFIG.contextRoot+"/app/rest/form-models/editor-values?"+t}};var KISBPM=KISBPM||{};KISBPM.TOOLBAR_CONFIG={items:[{type:"button",title:"TOOLBAR.ACTION.SAVE",cssClass:"editor-icon editor-icon-save",action:"KISBPM.TOOLBAR.ACTIONS.saveModel",disableOnReadonly:!0},{type:"button",title:"TOOLBAR.ACTION.VALIDATE",cssClass:"glyphicon glyphicon-ok",action:"KISBPM.TOOLBAR.ACTIONS.validateModel"},{type:"separator",title:"",cssClass:"toolbar-separator"},{type:"button",title:"TOOLBAR.ACTION.CUT",cssClass:"editor-icon editor-icon-cut",action:"KISBPM.TOOLBAR.ACTIONS.cut",enabled:!1,enabledAction:"element"},{type:"button",title:"TOOLBAR.ACTION.COPY",cssClass:"editor-icon editor-icon-copy",action:"KISBPM.TOOLBAR.ACTIONS.copy",enabled:!1,enabledAction:"element"},{type:"button",title:"TOOLBAR.ACTION.PASTE",cssClass:"editor-icon editor-icon-paste",action:"KISBPM.TOOLBAR.ACTIONS.paste",enabled:!1},{type:"button",title:"TOOLBAR.ACTION.DELETE",cssClass:"editor-icon editor-icon-delete",action:"KISBPM.TOOLBAR.ACTIONS.deleteItem",enabled:!1,enabledAction:"element"},{type:"separator",title:"TOOLBAR.ACTION.SAVE",cssClass:"toolbar-separator"},{type:"button",title:"TOOLBAR.ACTION.REDO",cssClass:"editor-icon editor-icon-redo",action:"KISBPM.TOOLBAR.ACTIONS.redo",enabled:!1},{type:"button",title:"TOOLBAR.ACTION.UNDO",cssClass:"editor-icon editor-icon-undo",action:"KISBPM.TOOLBAR.ACTIONS.undo",enabled:!1},{type:"separator",title:"TOOLBAR.ACTION.SAVE",cssClass:"toolbar-separator"},{type:"button",title:"TOOLBAR.ACTION.ALIGNVERTICAL",cssClass:"editor-icon editor-icon-align-vertical",action:"KISBPM.TOOLBAR.ACTIONS.alignVertical",enabled:!1,enabledAction:"element",disableInForm:!0,minSelectionCount:2},{type:"button",title:"TOOLBAR.ACTION.ALIGNHORIZONTAL",cssClass:"editor-icon editor-icon-align-horizontal",action:"KISBPM.TOOLBAR.ACTIONS.alignHorizontal",enabledAction:"element",enabled:!1,disableInForm:!0,minSelectionCount:2},{type:"button",title:"TOOLBAR.ACTION.SAMESIZE",cssClass:"editor-icon editor-icon-same-size",action:"KISBPM.TOOLBAR.ACTIONS.sameSize",enabledAction:"element",enabled:!1,disableInForm:!0,minSelectionCount:2},{type:"separator",title:"TOOLBAR.ACTION.SAVE",cssClass:"toolbar-separator",disableInForm:!0},{type:"button",title:"TOOLBAR.ACTION.ZOOMIN",cssClass:"editor-icon editor-icon-zoom-in",action:"KISBPM.TOOLBAR.ACTIONS.zoomIn"},{type:"button",title:"TOOLBAR.ACTION.ZOOMOUT",cssClass:"editor-icon editor-icon-zoom-out",action:"KISBPM.TOOLBAR.ACTIONS.zoomOut"},{type:"button",title:"TOOLBAR.ACTION.ZOOMACTUAL",cssClass:"editor-icon editor-icon-zoom-actual",action:"KISBPM.TOOLBAR.ACTIONS.zoomActual"},{type:"button",title:"TOOLBAR.ACTION.ZOOMFIT",cssClass:"editor-icon editor-icon-zoom-fit",action:"KISBPM.TOOLBAR.ACTIONS.zoomFit"},{type:"separator",title:"TOOLBAR.ACTION.SAVE",cssClass:"toolbar-separator",disableInForm:!0},{type:"button",title:"TOOLBAR.ACTION.BENDPOINT.ADD",cssClass:"editor-icon editor-icon-bendpoint-add",action:"KISBPM.TOOLBAR.ACTIONS.addBendPoint",id:"add-bendpoint-button",disableInForm:!0},{type:"button",title:"TOOLBAR.ACTION.BENDPOINT.REMOVE",cssClass:"editor-icon editor-icon-bendpoint-remove",action:"KISBPM.TOOLBAR.ACTIONS.removeBendPoint",id:"remove-bendpoint-button",disableInForm:!0},{type:"separator",title:"",cssClass:"toolbar-separator",disableInForm:!0},{type:"button",title:"TOOLBAR.ACTION.HELP",cssClass:"glyphicon glyphicon-question-sign",action:"KISBPM.TOOLBAR.ACTIONS.help"},{type:"button",title:"TOOLBAR.ACTION.FEEDBACK",cssClass:"glyphicon glyphicon-envelope",action:"KISBPM.TOOLBAR.ACTIONS.feedback"}],secondaryItems:[]};var KISBPM=KISBPM||{};KISBPM.PROPERTY_CONFIG={string:{readModeTemplateUrl:"editor-app/configuration/properties/default-value-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/string-property-write-mode-template.html"},"boolean":{templateUrl:"editor-app/configuration/properties/boolean-property-template.html"},text:{readModeTemplateUrl:"editor-app/configuration/properties/default-value-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/text-property-write-template.html"},scripttext:{readModeTemplateUrl:"editor-app/configuration/properties/default-value-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/script-text-property-write-template.html"},variable:{readModeTemplateUrl:"editor-app/configuration/properties/variable-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/variable-property-write-template.html"},"expression-field":{readModeTemplateUrl:"editor-app/configuration/properties/expression-text-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/expression-text-write-template.html"},"oryx-metadata-complex":{readModeTemplateUrl:"editor-app/configuration/properties/metadata-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/metadata-property-write-template.html"},"kisbpm-multiinstance":{readModeTemplateUrl:"editor-app/configuration/properties/default-value-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/multiinstance-property-write-template.html"},"oryx-formproperties-complex":{readModeTemplateUrl:"editor-app/configuration/properties/form-properties-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/form-properties-write-template.html"},"oryx-executionlisteners-multiplecomplex":{readModeTemplateUrl:"editor-app/configuration/properties/execution-listeners-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/execution-listeners-write-template.html"},"oryx-tasklisteners-multiplecomplex":{readModeTemplateUrl:"editor-app/configuration/properties/task-listeners-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/task-listeners-write-template.html"},"oryx-eventlisteners-multiplecomplex":{readModeTemplateUrl:"editor-app/configuration/properties/event-listeners-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/event-listeners-write-template.html"},"oryx-usertaskassignment-complex":{readModeTemplateUrl:"editor-app/configuration/properties/assignment-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/assignment-write-template.html"},"oryx-servicetaskfields-complex":{readModeTemplateUrl:"editor-app/configuration/properties/fields-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/fields-write-template.html"},"oryx-callactivityinparameters-complex":{readModeTemplateUrl:"editor-app/configuration/properties/in-parameters-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/in-parameters-write-template.html"},"oryx-callactivityoutparameters-complex":{readModeTemplateUrl:"editor-app/configuration/properties/out-parameters-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/out-parameters-write-template.html"},"oryx-subprocessreference-subprocess-link":{readModeTemplateUrl:"editor-app/configuration/properties/subprocess-reference-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/subprocess-reference-write-template.html"},"oryx-formreference-complex":{readModeTemplateUrl:"editor-app/configuration/properties/form-reference-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/form-reference-write-template.html"},"oryx-sequencefloworder-complex":{readModeTemplateUrl:"editor-app/configuration/properties/sequenceflow-order-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/sequenceflow-order-write-template.html"},"oryx-conditionsequenceflow-complex":{readModeTemplateUrl:"editor-app/configuration/properties/condition-expression-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/condition-expression-write-template.html"},"oryx-signaldefinitions-multiplecomplex":{readModeTemplateUrl:"editor-app/configuration/properties/signal-definitions-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/signal-definitions-write-template.html"},"oryx-signalref-string":{readModeTemplateUrl:"editor-app/configuration/properties/default-value-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/signal-property-write-template.html"},"oryx-messagedefinitions-multiplecomplex":{readModeTemplateUrl:"editor-app/configuration/properties/message-definitions-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/message-definitions-write-template.html"},"oryx-messageref-string":{readModeTemplateUrl:"editor-app/configuration/properties/default-value-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/message-property-write-template.html"},"oryx-alfresco_cloud_content-complex":{readModeTemplateUrl:"editor-app/configuration/properties/publish-alfresco-content-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/publish-alfresco-content-write-template.html"},"oryx-alfresco_cloud_destination-complex":{readModeTemplateUrl:"editor-app/configuration/properties/publish-alfresco-destination-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/publish-alfresco-destination-write-template.html"},"oryx-alfresco_get_metadata-complex":{readModeTemplateUrl:"editor-app/configuration/properties/metadata-alfresco-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/metadata-retrieve-alfresco-template.html"},"oryx-alfresco_put_metadata-complex":{readModeTemplateUrl:"editor-app/configuration/properties/metadata-alfresco-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/metadata-update-alfresco-template.html"},"oryx-box_cloud_content-complex":{readModeTemplateUrl:"editor-app/configuration/properties/publish-box-content-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/publish-box-content-write-template.html"},"oryx-box_cloud_destination-complex":{readModeTemplateUrl:"editor-app/configuration/properties/publish-box-destination-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/publish-box-destination-write-template.html"},"oryx-google_drive_content-complex":{readModeTemplateUrl:"editor-app/configuration/properties/publish-google-drive-content-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/publish-google-drive-content-write-template.html"},"oryx-google_drive_destination-complex":{readModeTemplateUrl:"editor-app/configuration/properties/publish-google-drive-destination-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/publish-google-drive-destination-write-template.html"},"oryx-duedatedefinition-complex":{readModeTemplateUrl:"editor-app/configuration/properties/duedate-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/duedate-write-template.html"},"oryx-restcalltask_endpoint-complex":{readModeTemplateUrl:"editor-app/configuration/properties/restcall-endpoint-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/restcall-endpoint-write-template.html"},"oryx-restcalltask_request_mapping-complex":{readModeTemplateUrl:"editor-app/configuration/properties/restcall-request-mapping-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/restcall-request-mapping-write-template.html"},"oryx-restcalltask_response_mapping-complex":{readModeTemplateUrl:"editor-app/configuration/properties/restcall-response-mapping-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/restcall-response-mapping-write-template.html"},"oryx-restcalltask_request_headers-complex":{readModeTemplateUrl:"editor-app/configuration/properties/restcall-request-headers-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/restcall-request-headers-write-template.html"},"oryx-executionvariables-complex":{readModeTemplateUrl:"editor-app/configuration/properties/execution-variables-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/execution-variables-write-template.html"},"oryx-fieldstovariables-complex":{readModeTemplateUrl:"editor-app/configuration/properties/fields-to-variables-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/fields-to-variables-write-template.html"},"oryx-executionvariable_string-string":{readModeTemplateUrl:"editor-app/configuration/properties/execution-single-variable-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/execution-single-variable-write-template.html"},"oryx-executionvariable_document-string":{readModeTemplateUrl:"editor-app/configuration/properties/execution-single-variable-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/execution-single-variable-write-template.html"},"oryx-generatedocumenttemplate-complex":{readModeTemplateUrl:"editor-app/configuration/properties/generatedocument-template-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/generatedocument-template-write-template.html"},"oryx-generatedocumenttaskoutputformat-complex":{readModeTemplateUrl:"editor-app/configuration/properties/generatedocument-outputformat-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/generatedocument-outputformat-write-template.html"},"oryx-decisiontaskdecisiontablereference-complex":{readModeTemplateUrl:"editor-app/configuration/properties/decisiontable-reference-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/decisiontable-reference-write-template.html"},"oryx-mailtaskto-complex":{readModeTemplateUrl:"editor-app/configuration/properties/mail-to-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/mail-to-write-template.html"},"oryx-entityattributemapping-complex":{readModeTemplateUrl:"editor-app/configuration/properties/entity-attribute-mapping-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/entity-attribute-mapping-write-template.html"},"oryx-emailtemplate-complex":{readModeTemplateUrl:"editor-app/configuration/properties/email-template-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/email-template-write-template.html"},"oryx-alfrescoactiontask_input_source-complex":{readModeTemplateUrl:"editor-app/configuration/properties/alfresco-action-input-source-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/alfresco-action-input-source-write-template.html"},"oryx-alfrescoactiontask_publish_as_type-complex":{readModeTemplateUrl:"editor-app/configuration/properties/alfresco-action-accessor-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/alfresco-action-accessor-write-template.html"},"oryx-alfrescoactiontask_repository-complex":{readModeTemplateUrl:"editor-app/configuration/properties/alfresco-action-repository-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/alfresco-action-repository-write-template.html"},"oryx-alfrescoactiontask_action-complex":{readModeTemplateUrl:"editor-app/configuration/properties/alfresco-action-action-display-template.html",writeModeTemplateUrl:"editor-app/configuration/properties/alfresco-action-action-write-template.html"}},KISBPM.HEADER_CONFIG.showAppTitle=!1,KISBPM.HEADER_CONFIG.showHeaderMenu=!1,KISBPM.HEADER_CONFIG.showMainNavigation=!1,KISBPM.HEADER_CONFIG.showPageHeader=!1,KISBPM.TOOLBAR.ACTIONS.closeEditor=function(e){e.ProcessScopeService.navigateBack("/processes")},KISBPM.TOOLBAR.ACTIONS.navigateToProcess=function(e){var t={type:KISBPM.eventBus.EVENT_TYPE_NAVIGATE_TO_PROCESS,processId:e};KISBPM.eventBus.dispatch(KISBPM.eventBus.EVENT_TYPE_NAVIGATE_TO_PROCESS,t)},KISBPM.TOOLBAR_CONFIG.secondaryItems.push({type:"button",title:"Close",cssClass:"glyphicon glyphicon-remove",action:"KISBPM.TOOLBAR.ACTIONS.closeEditor"}),activitiModule.service("RelatedContentService",["$http","$q","$rootScope","$translate","$location","Upload","EventTrackingService","$timeout",function(e,t,i,o,n,r,a,s){var l=function(i){var o=t.defer();return e(i).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise};this.deleteContent=function(e,t){var i=l({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/content/"+e});return i.then(function(){t?a.trackEvent("workflow","task-remove-related-content"):a.trackEvent("workflow","remove-related-content")}),i},this.addRelatedContent=function(e,i,o,n,s){var l,d,c=o.name.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"}),p=t.defer();if(e){var u="";s&&(u+="?isRelatedContent=true"),d=n?ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/raw-content/text"+u:ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+e+"/raw-content"+u,l=r.upload({url:d,method:"POST",file:o,fileName:c})}else i?(d=n?ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+i+"/raw-content/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+i+"/raw-content",l=r.upload({url:d,method:"POST",file:o,fileName:c})):(d=n?ACTIVITI.CONFIG.contextRoot+"/app/rest/content/raw/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/content/raw",l=r.upload({url:d,method:"POST",file:o,fileName:c}));var m=this;l.success(function(e){e&&e.id&&m.addUrlToContent(e),p.resolve(e)}).error(function(e){p.reject(e)});var h=p.promise;return h.progress=function(e){return l.progress(e),h},h.then(function(){e?a.trackEvent("workflow","task-add-related-content"):i?a.trackEvent("workflow","processinstance-add-related-content"):a.trackEvent("workflow","add-related-content")}),h},this.addRelatedContentFromSource=function(i,o,n,r,s,l,d,c,p){var u,m="";p&&(m+="?isRelatedContent=true"),u=i?ACTIVITI.CONFIG.contextRoot+"/app/rest/tasks/"+i+"/content"+m:o?ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+o+"/content":ACTIVITI.CONFIG.contextRoot+"/app/rest/content",c=1==c;var h={source:n,sourceId:r,name:s,link:c,mimeType:l,simpleType:d},f=this,g=t.defer();e({method:"POST",url:u,data:h}).success(function(e){e&&e.id&&f.addUrlToContent(e),g.resolve(e)}).error(function(e){g.reject(e)});var v=g.promise;return v.then(function(){i?a.trackEvent("workflow","task-add-related-content"):o?a.trackEvent("workflow","processinstance-add-related-content"):a.trackEvent("workflow","add-related-content")}),v},this.getRelatedContent=function(i){var o=ACTIVITI.CONFIG.contextRoot+"/app/rest/content/"+i,n=t.defer();e({method:"GET",url:o}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)});var r=n.promise;return r},this.checkRenditions=function(e,t){void 0==t?t=10:0==t&&(e.previewStatus="unsupported",e.thumbnailStatus="unsupported"),"processing"==e.previewStatus||"queued"==e.previewStatus||"processing"==e.thumbnailStatus||"queued"==e.thumbnailStatus?this.scheduleRefresh(e,t):this.addUrlToContent(e)},this.scheduleRefresh=function(e,t){var i=this;e&&t>0&&s(function(){i.getRelatedContent(e.id).then(function(o){angular.extend(e,o),i.checkRenditions(e,t-1)})},2e3)},this.getProcessContent=function(i){var o=this,n=t.defer();return e({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-instances/"+i+"/field-content"}).success(function(e){if(e.data&&e.data.length>0)for(var t=0;e.data.length>t;t++){var i=e.data[t];if(i.content&&i.content.length>0)for(var r=0;i.content.length>r;r++)o.addUrlToContent(i.content[r])}n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.addUrlToContent=function(e){if(e&&e.id){e.rawUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/content/"+e.id+"/raw";var t=e.name.split(".").pop();e.link||"word"!=e.simpleType&&"excel"!=e.simpleType&&"powerpoint"!=e.simpleType||(e.officeUrl=ACTIVITI.CONFIG.contextRoot+"/aos/"+e.id+"/"+e.name),"created"==e.thumbnailStatus&&(e.thumbnailUrl||(e.thumbnailUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/content/"+e.id+"/rendition/thumbnail?noCache="+(new Date).getTime())),"created"==e.previewStatus?e.pdfUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/content/"+e.id+"/rendition/preview?noCache="+(new Date).getTime():"image"===e.simpleType||"jpg"===t||"jpeg"===t||"png"===t?(e.imageUrl=e.rawUrl,!e.thumbnailUrl&&e.contentAvailable&&(e.thumbnailUrl=e.rawUrl)):"pdf"==e.simpleType&&(e.pdfUrl=e.rawUrl)}}}]),activitiModule.service("ContentAccountService",["$http","$q","$rootScope","$translate","$location",function(e,t,i,o){var n=function(o,n){var r=t.defer();return e(o).success(function(e){r.resolve(e)}).error(function(e,t){409==t?i.$broadcast("integration.account.autherror",n):i.$broadcast("integration.account.error",n),r.reject(e)}),r.promise};this.getAccounts=function(){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration",transformResponse:function(e){return angular.isString(e)&&(e=JSON.parse(e)),angular.isArray(e.data)&&e.data.forEach(function(e){var t="COMMON.ACCOUNTS."+e.serviceId;e.serviceName=o.instant(t,e),e.serviceName==t&&(e.serviceName=o.instant(t.replace(/[0-9]+/g,"*"),e))}),e}})},this.getNetworks=function(){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco-cloud/networks"},"alfresco-cloud")},this.getCloudSites=function(e){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco-cloud/networks/"+e+"/sites"},"alfresco-cloud")},this.getAlfrescoServiceIdsMatch=function(e,t){return e===t||this.getRepoIdFromAlfrescoServiceId(e)===this.getRepoIdFromAlfrescoServiceId(t)||this.getRepoNameFromAlfrescoServiceId(e)&&this.getRepoNameFromAlfrescoServiceId(e)===this.getRepoNameFromAlfrescoServiceId(t)},this.getRepoIdFromAlfrescoServiceId=function(e){if(a(e))return e;var t=r(e),i=t.indexOf("-");return-1===i?t:t.substring(0,i)},this.getRepoNameFromAlfrescoServiceId=function(e){if(a(e))return e;var t=r(e),i=t.indexOf("-");return-1===i?null:t.substring(i+1)};var r=function(e){return e.replace("alfresco-","")},a=function(e){return!e.startsWith("alfresco")||e.startsWith("alfresco-cloud")};this.getSites=function(e){var t=this.getRepoIdFromAlfrescoServiceId(e);return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+t+"/sites"},e)},this.getCloudContentInSite=function(e,t){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco-cloud/networks/"+e+"/sites/"+t+"/content"},"alfresco-cloud")},this.getContentInSite=function(e,t){var i=this.getRepoIdFromAlfrescoServiceId(e);return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+i+"/sites/"+t+"/content"},e)},this.getCloudContentInFolder=function(e,t){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco-cloud/networks/"+e+"/folders/"+t+"/content"},"alfresco-cloud")},this.getContentInFolder=function(e,t){var i=this.getRepoIdFromAlfrescoServiceId(e);return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+i+"/folders/"+t+"/content"},e)},this.getCloudContentInFolderByPath=function(e,t,i){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco-cloud/networks/"+e+"/sites/"+t+"/folderpath/"+i+"/content"},"alfresco-cloud")},this.getContentInFolderByPath=function(e,t,i){var o=this.getRepoIdFromAlfrescoServiceId(e);return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+o+"/sites/"+t+"/folderpath/"+i+"/content"},e)},this.getGoogleDriveFiles=function(e,t,i){var o={filter:e,parent:t,currentFolderOnly:i};return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/google-drive/files",params:o},"google-drive")},this.getBoxFiles=function(e,t){var i={filter:e,parent:t};return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/box/files",params:i},"box")},this.isBoxMetaDataAllowed=function(){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/box/metadata-status"})}}]),angular.module("activiti.common").directive("datepickerTimezone",["$filter",function(e){"use strict";return{restrict:"A",priority:1,require:"ngModel",link:function(t,i,o,n){n.$formatters.push(function(e){if(null!==e&&void 0!==e){var t=e.split("T")[0],i=t.split("-"),o=new Date;return o.setDate(parseInt(i[2])),o.setMonth(parseInt(i[1])-1),o.setFullYear(parseInt(i[0])),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0),o}}),n.$parsers.push(function(t){if(t&&t.constructor===Date){var i=e("date")(t,"yyyy-MM-dd");return o.excludeTime&&"true"===o.excludeTime?i:i+"T00:00:00.000Z"}})}}}]),activitiModule.directive("appLinks",["$popover","$timeout","appResourceRoot",function(e){return{restrict:"E",templateUrl:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/app-links-button.html",replace:!0,link:function(){},scope:{},controller:["$scope","$element","RuntimeAppDefinitionService","$translate",function(t,i,o,n){var r;t.goToLink=function(e){t.onDestroyPopover(),window.location.href=e},t.onDestroyPopover=function(){r&&(r.$scope.$destroy(),r.destroy(),r=void 0)},t.showAppLinks=function(){t.apps=[],o.getApplications().then(function(e){for(var i=e.defaultApps.concat(e.customApps),o=0;i.length>o;o++){var r=i[o];if(null!==r.pages&&void 0!==r.pages&&r.pages.length>0){for(var a=0,s=0;r.pages.length>s;s++){var l={};l.name=r.pages[s],l.theme=r.theme,l.icon=r.icon,null!==r.defaultAppId&&void 0!==r.defaultAppId?(l.titleKey=r.titleKey+"-"+l.name.toUpperCase(),l.fixedUrl=r.fixedUrl+"#/"+r.pages[s]):(l.titleKey=n.instant("APP.CUSTOM-APP.TITLE-"+l.name.toUpperCase(),r),l.fixedUrl=r.fixedBaseUrl+r.pages[s]),i.splice(o+s+1,0,l),a++}i.splice(o,1),o=o+a-1}}t.apps=i}),r=e(i,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/app-links-popover.html",placement:"bottom-right",show:!0,scope:t,autoClose:!0}),r.$scope.$on("tooltip.hide",function(){t.onDestroyPopover()})}}]}}]),activitiModule.directive("variableIdentifier",["$rootScope","$timeout",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,o){function n(e,t){var i="",o=0;for(o=0;e.length>o;o++)t.test(i+e[o])&&(i+=e[o]);return i}e.identifierRegExp=/^[a-zA-Z][_a-zA-Z0-9]*$/,e.forbidenNames=["abstract","continue","for","new","switch","assert","default","if","package","synchronized","boolean","do","goto","private","this","break","double","implements","protected","throw","byte","else","import","public","throws","case","enum","instanceof","return","transient","catch","extends","int","short","try","char","final","interface","static","void","class","finally","long","strictfp","volatile","const","float","native","super","while","null"],e.$watch(i.ngModel,function(t){var r=!0;if(t&&t.length>0){var a=n(t,e.identifierRegExp);a!=t?(o.$setViewValue(a),o.$render()):r=e.identifierRegExp.test(a)?-1==e.forbidenNames.indexOf(a):!1}o.$setValidity(i.ngModel,r)})}}}]),activitiModule.directive("ngTrim",function(){return{require:"ngModel",priority:300,link:function(e,t,i,o){"false"===i.ngTrim&&o.$parsers.unshift(function(){return t.val()})}}}),activitiModule.directive("spacelessValue",["$rootScope","$timeout",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,o){function n(e,t){var i="",o=0;for(o=0;e.length>o;o++)t.test(i+e[o])&&(i+=e[o]);return i}e.identifierRegExp=/^\S*$/,e.$watch(i.ngModel,function(t){var r=!0;if(t&&t.length>0){var a=n(t,e.identifierRegExp);a!=t?(o.$setViewValue(a),o.$render()):e.identifierRegExp.test(a)||(r=!1)}o.$setValidity(i.ngModel,r)})}}}]),activitiModule.directive("restrictInput",["$parse",function(){return{restrict:"A",require:"ngModel",priority:1002,link:function(e,t,i,o){function n(e){var t=e.toUpperCase(),i=t.replace(/-D-/,"-DD-").replace(/^D-/,"DD-").replace(/-D$/,"-DD"),o=t.replace(/-M-/,"-MM-").replace(/^M-/,"MM-").replace(/-M$/,"-MM"),n=i.replace(/-M-/,"-MM-").replace(/^M-/,"MM-").replace(/-M$/,"-MM");return[t,i,o,n]}function r(e,t){if(void 0===e||null==e||""===e)return!0;if(e.length>t.length)return!1;for(var i=0;Math.min(t.length,e.length)>i;i++){var o=t[i];if(o.toUpperCase().match(/D|M|Y/)){if(null==e[i].match(/\d/))return!1}else if(e[i]!=o)return!1}return!0}var a=i.restrictInput;(void 0==a||null==a||""==a)&&(a=i.dateFormat),e.field&&(e.field.acceptedFormat=a);var s=n(a),l=!1;(void 0==a||null==a||""==a)&&(l=!0);var d=o.$render;o.$render=function(){t.val(o.$viewValue),o.$dateValue&&!isNaN(o.$dateValue.getTime())&&d&&d()},o.$parsers.unshift(function(e){if(l)return e;for(var t=!1,i=0;s.length>i&&!t;i++)t|=r(e,s[i]);return t?(o.$lastValidText=e,(void 0===e||null==e||""===e)&&(o.$dateValue=null),e):(o.$dateValue=null,o.$setViewValue(o.$lastValidText),o.$render(),o.$lastValidText)})}}}]),activitiModule.directive("autoHeight",["$rootScope","$timeout",function(e,t){return{restrict:"AC",scope:{toWatch:"=autoHeight"},compile:function(){return function(i,o,n){var r=0;
n.offset&&(r=parseInt(n.offset),(0/0==r||void 0==r)&&(r=0));var a=function(e){t(function(){var t=e.parent().outerHeight()-r,i=!1;e.parent().children().filter(":visible").each(function(){i||(e[0]==this?i=!0:t-=angular.element(this).outerHeight())}),i&&e.height(t)},0)};i.$watch("toWatch",function(){a(o)}),i.unregisterWatcher&&i.unregisterWatcher(),i.unregisterWatcher=e.$watch("window.height",function(){a(o)}),i.unregisterForceWatcher&&i.unregisterForceWatcher(),i.unregisterForceWatcher=e.$watch("window.forceRefresh",function(){a(o)}),i.$on("$destroy",function(){i.unregisterWatcher&&i.unregisterWatcher(),i.unregisterForceWatcher&&i.unregisterForceWatcher()})}}}}]),activitiModule.directive("scrollToActive",["$timeout",function(e){return{restrict:"AC",scope:{toWatch:"=scrollToActiveModel"},compile:function(){return function(t,i,o){t.$watch("toWatch",function(){e(function(){var e=o.useParent,t=o.offsetTop;t&&(t=parseInt(t),0/0==t&&(t=0)),t||(t=0);var n=i.children(".active");if(n&&n.length>0){var r=angular.element(n[0]);e&&(i=angular.element(i.parent()));var a=r.position().top-i.position().top+i.scrollTop(),s=a+r.outerHeight(),l=i.scrollTop()+i.innerHeight(),d=l-i.innerHeight();d>=a?i.scrollTop(a-r.outerHeight()-t):s>l&&i.scrollTop(d+r.outerHeight()-t)}},0)})}}}}]),activitiModule.directive("autoScroll",["$timeout",function(e){return{restrict:"AC",compile:function(){return function(t,i){t.$on("tooltip.show",function(){e(function(){for(var e=i[0];e&&!(e.className&&e.className.indexOf("scroll-container")>=0);)e=e.parentNode;if(e){e=angular.element(e);var t=i.offset().top-e.offset().top+i.scrollTop(),o=t+i.outerHeight();o+30>=e.outerHeight()&&e.scrollTop(t)}},50)})}}}}]),activitiModule.directive("userName",function(){var e={};return e.template='{{user.firstName && user.firstName || ""}} {{user.lastName && user.lastName || ""}} {{ (user.email && !user.firstName && !user.lastName) && user.email || ""}}',e.scope={user:"=userName"},e}),activitiModule.directive("clickAnywhere",["$document","$parse",function(e,t){var i=function(i,o,n){var r=n.clickAnywhere,a=t(r),s=n.ignore,l=n.ignoreClass,d="true"==n.ignorePopupEvents,c=function(e){for(var t=e.target;t;){if(t==o[0]||s&&t.id==s||l&&t.className&&t.className.indexOf(l)>=0)return e.stopPropagation(),e.preventDefault(),void 0;t=t.parentNode}i.$apply(function(){a(i,{$event:e})})};e.on("click",c),i.$on("$destroy",function(){e.off("click",c)});var p=i.$on("tooltip.hide",function(){d||(e.off("click",c),p())})};return i}]),activitiModule.directive("autoFocus",["$timeout","$parse",function(e,t){return{restrict:"AC",compile:function(i,o){var n;return o.selectText&&(n=t(o.selectText)),function(t,i,o){var r=void 0!==o.focusFirstChild;e(function(){if(r){var e=i.find("input");e&&e.length>0&&(e[0].focus(),n&&n(t.$parent)&&input[0].setSelectionRange(0,input[0].value.length))}else i[0].focus(),n&&n(t.$parent)&&i[0].setSelectionRange(0,i[0].value.length)},100)}}}}]),activitiModule.directive("focusWhen",["$timeout",function(e){return{link:function(t,i,o){t.$watch(o.ngFocus,function(t){angular.isDefined(t)&&t&&e(function(){i[0].focus()})},!0),i.bind("blur",function(){angular.isDefined(o.ngFocusLost)&&t.safeApply(o.ngFocusLost)})}}}]),activitiModule.directive("loading",[function(){var e={};return e.restrict="A",e.template='<div class="loading" ng-show="loading"><div class="l1"></div><div class="l2"></div><div class="l3"></div></div>',e.scope={loading:"=loading",loadingText:"=loadingText"},e}]),activitiModule.directive("activitiFixDropdownBug",function(){return{restrict:"AEC",link:function(e,t){t.on("hidden.bs.dropdown	",function(){t.show()})}}}),activitiModule.directive("userLink",function(){var e={};return e.template='{{user.firstName && user.firstName || ""}} {{user.lastName && user.lastName || ""}} {{ (user.email && !user.firstName && !user.lastName) && user.email || ""}}',e.scope={user:"=userLink"},e.compile=function(e){e.addClass("people-link")},e}),activitiModule.directive("formField",function(){var e={};return e.template=' {{field.name || ""}} - {{field.id}}',e.scope={field:"=formField"},e.compile=function(e){e.addClass("form-field")},e}),activitiModule.directive("customKeys",["$parse",function(e){var t={};return t.compile=function(t,i){var o,n,r,a;return i.upPressed&&(o=e(i.upPressed)),i.downPressed&&(n=e(i.downPressed)),i.enterPressed&&(r=e(i.enterPressed)),i.escapePressed&&(a=e(i.escapePressed)),function(e,t){t.on("keyup",function(t){38===t.keyCode?e.$apply(function(){o&&o(e,{$event:t})}):40===t.keyCode?e.$apply(function(){n&&n(e,{$event:t})}):13===t.keyCode?e.$apply(function(){r&&r(e,{$event:t})}):27===t.keyCode&&e.$apply(function(){a&&a(e,{$event:t})})}),t.on("keydown",t,function(e){(38===e.keyCode||40===e.keyCode||13===e.keyCode||27===e.keyCode)&&e.preventDefault()})}},t}]),activitiModule.directive("delayedModel",["$timeout",function(e){return{scope:{targetModel:"=delayedModel"},link:function(t,i,o){i.val(t.targetModel),t.$watch("targetModel",function(o,r){n&&e.cancel(n),o!==r&&i.val(t.targetModel)});var n;i.on("keyup paste search",function(){i.val()!==t.targetModel&&(n&&e.cancel(n),n=e(function(){t.targetModel=i[0].value,i.val(t.targetModel),t.$apply()},o.delay||200))})}}}]),activitiModule.directive("ngDebounce",["$timeout",function(e){return{restrict:"A",require:"ngModel",priority:99,link:function(t,i,o,n){if("radio"!==o.type&&"checkbox"!==o.type){i.unbind("input");var r;i.bind("input",function(){e.cancel(r),r=e(function(){t.$apply(function(){n.$setViewValue(i.val())})},o.ngDebounce||1e3)}),i.bind("blur",function(){t.$apply(function(){n.$setViewValue(i.val())})})}}}}]),activitiModule.directive("externalContentAuthenticator",["$parse","$timeout",function(){var e={};return e.restrict="A",e.templateUrl=ACTIVITI.CONFIG.webContextRoot+"/views/common/templates/external-content-authenticator-template.html",e.scope={taskId:"=taskId",accountType:"@accountType"},e.controller=["$scope","$element","ContentAccountService","$modal","$window","$translate","$rootScope",function(e,t,i,o,n,r,a){e.$on("integration.account.error",function(t,i){e.currentAccount&&i==e.currentAccount.serviceId&&e.contentBrowseModal&&("alfresco-cloud"===i?r("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"google-drive"===i?r("INTEGRATION.ALERT.GOOGLE-DRIVE-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"box"===i&&r("INTEGRATION.ALERT.BOX-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}))}),e.openAuthenticationPopup=function(t,i){e.openContentAccountAuth(t,i)},e.clearPopupError=function(){e.contentBrowseModal&&(e.contentBrowseModal.$scope.errorMessage=void 0)},e.$on("integration.account.autherror",function(t,i){i&&(e.contentAccounts[i].authorized=!1,"alfresco-cloud"===i?r("INTEGRATION.ALERT.ALFRESCO-CLOUD-NOT-AUTHORIZED").then(function(t){a.addAlert(t,"error"),e.errorMessage=t}):"google-drive"===i?r("INTEGRATION.ALERT.GOOGLE-DRIVE-NOT-AUTHORIZED").then(function(t){a.addAlert(t,"error"),e.errorMessage=t}):"box"===i&&r("INTEGRATION.ALERT.BOX-NOT-AUTHORIZED").then(function(t){a.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide())}),e.openContentAccountAuth=function(t,i){var o=angular.element(n),r=(o.width()-500)/2,a=(o.height()-400)/2,s=n.open(e.contentAccounts[i].authorizationUrl,i,"width= 500, height=400, toolbar=no, status=no, titlebar=no, location=no, menubar=no, top="+a+", left="+r);n.contentAccountAuthConfirmed=function(){e.$apply(function(){e.contentAccounts[i].authorizationUrl=void 0,e.contentAccounts[i].authorized=!0,e.currentAccount=e.contentAccounts[i],s.close(),e.$emit("task-completed",{taskId:e.taskId})})},n.contentAccountAuthFailed=function(t,i){e.$apply(function(){s.close(),e.showErrorModal(t,i)})}},e.showErrorModal=function(t,i){e.errorModel={error:t,details:i},_internalCreateModal({scope:e,template:"views/popup/error-popup.html",show:!0},o,e)},e.loadAccounts=function(){e.contentAccounts={loading:!0},i.getAccounts().then(function(t){if(t&&t.data)for(var i=0;t.data.length>i;i++){var o=t.data[i];e.contentAccounts[o.serviceId]=o}e.contentAccounts.rawList=t.data,e.contentAccounts.loading=!1})},e.loadAccounts()}],e}]),activitiModule.directive("externalContent",["$rootScope","$parse","$timeout",function(e,t,i){var o={};return o.restrict="A",o.templateUrl=ACTIVITI.CONFIG.webContextRoot+"/views/common/templates/external-content-template.html",o.scope={taskId:"=taskId",processInstanceId:"=formDefinition",folderSelect:"=folderSelect",linkOnly:"=linkOnly",preSelectedAccount:"=account",uploadInProgress:"=uploadInProgress",isRelatedContent:"=isRelatedContent",contentSource:"=?contentSource",allowMultiple:"=allowMultiple"},o.link=function(o,n,r){o.readOnly=e.readOnly,r.onContentUpload&&(o.uploadedCallback=t(r.onContentUpload)),r.onFolderSelect&&(o.folderSelectCallback=t(r.onFolderSelect)),r.onUploadInProgress&&(o.uploadInProgressCallback=t(r.onUploadInProgress)),i(function(){n.find("div.select-file").click(function(){n.find('input[type="file"]').click()})},200)},o.controller=["$scope","$element","RelatedContentService","ContentAccountService","$modal","$window","$translate","$rootScope",function(e,t,i,o,n,r,a,s){e.uploadModel={uploading:!1},e.BOX_DRIVE_ACCOUNT_ID="box",e.GOOGLE_DRIVE_ACCOUNT_ID="google-drive",e.ALFRESCO_ACCOUNT_ID_PREFIX="alfresco-",e.ALFRESCO_CLOUD_ACCOUNT_ID="alfresco-cloud",e.ALL_SOURCES_ACCOUNT_ID="all-file-sources",e.LOCAL_FILE_ACCOUNT_ID="local-file",e.filterNavigableContent=function(t){return!t.folder||(!e.contentSource||e.contentSource&&!e.contentSource.notAllowNavigateFolders)&&t.folder},e.browseButtonIsVisible=function(){return!e.linkOnly&&(e.contentSource&&(e.contentSource.serviceId===e.ALL_SOURCES_ACCOUNT_ID||e.contentSource.serviceId===e.LOCAL_FILE_ACCOUNT_ID)||!e.contentSource)},e.contentAccountsByServiceId=function(t){return!e.contentSource||e.contentSource.serviceId===e.ALL_SOURCES_ACCOUNT_ID||e.contentSource.serviceId===t.serviceId||e.contentSource.serviceId.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX&&t.name&&e.contentSource.name===t.name},e.selectFolder=function(t){if(e.preSelectedAccount||e.folderSelect){var i=e.folderSelect;if(i.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX){if(e.preSelectedAccount.name){var o=!1;for(var n in e.contentAccounts){var r=e.contentAccounts[n];r.serviceId&&e.preSelectedAccount.serviceId===r.serviceId&&(o=!0)}if(!o)for(var n in e.contentAccounts){var r=e.contentAccounts[n];r.serviceId&&r.name&&e.preSelectedAccount.name===r.name&&(e.preSelectedAccount=r)}}i=e.ALFRESCO_CLOUD_ACCOUNT_ID}(i===e.ALFRESCO_CLOUD_ACCOUNT_ID||i===e.GOOGLE_DRIVE_ACCOUNT_ID||i===e.BOX_DRIVE_ACCOUNT_ID)&&e.browseRepositoryContent(t,i,e.preSelectedAccount)}},e.$on("integration.account.error",function(t,i){e.currentAccount&&i==e.currentAccount.serviceId&&e.contentBrowseModal&&("alfresco-cloud"===i?a("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"google-drive"===i?a("INTEGRATION.ALERT.GOOGLE-DRIVE-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"box"===i?a("INTEGRATION.ALERT.BOX-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):a("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}))}),e.clearPopupError=function(){e.contentBrowseModal&&(e.contentBrowseModal.$scope.errorMessage=void 0)},e.$on("integration.account.autherror",function(t,i){i&&(e.contentAccounts[i].authorized=!1,i===e.ALFRESCO_CLOUD_ACCOUNT_ID?(a("INTEGRATION.ALERT.ALFRESCO-CLOUD-NOT-AUTHORIZED").then(function(t){s.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()):i==e.GOOGLE_DRIVE_ACCOUNT_ID?(a("INTEGRATION.ALERT.GOOGLE-DRIVE-NOT-AUTHORIZED").then(function(t){s.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()):"box"==i&&(a("INTEGRATION.ALERT.BOX-NOT-AUTHORIZED").then(function(t){s.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()))}),e.openFileSelect=function(t){e.errorMessage=void 0;var i=angular.element(t).parent();i.children("input").click()},e.confirmFolderSelection=function(){if(e.currentFolderTree&&e.folderSelectCallback){var t=e.createContentBrowserPayload(e.currentAccount);e.folderSelectCallback(e.$parent,{folder:t}),e.contentBrowseModal.$scope.$hide()}},e.confirmBoxFolderSelection=function(){var t=0;if(e.folderSelectCallback){var i="";e.currentFolderTree&&e.currentFolderTree.length>0?(i=e.pathFromFolderTree(e.currentFolderTree),t=e.currentFolderTree[e.currentFolderTree.length-1].id):(i+="/",t=0);var o={account:{id:e.currentAccount.serviceId,name:e.currentAccount.name},path:{id:t,title:i}};e.folderSelectCallback(e.$parent,{folder:o}),e.contentBrowseModal.$scope.$hide()}},e.onFileSelect=function(t,o){if(e.errorMessage=void 0,!e.linkOnly&&(e.errorMessage=void 0,!e.folderSelect&&!e.uploadModel.uploading&&t.length>0))for(var n=0;t.length>n;n++){e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!0}),e.uploadModel.uploading=!0;var r=t[n];e.clearPopupError(),i.addRelatedContent(e.taskId,e.processInstanceId,r,o,e.isRelatedContent).progress(function(t){e.uploadModel.uploadProgress=parseInt(100*t.loaded/t.total)}).then(function(t){e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!1}),e.uploadModel.uploading=!1,e.uploadedCallback&&e.uploadedCallback(e.$parent,{content:t})},function(t){if(e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!1}),t&&t.messageKey){var i={};t.customData&&(i.quota=e.formatFileSize(t.customData.quota)),a(t.messageKey,i).then(function(t){e.errorMessage=t})}e.uploadModel.uploading=!1})}},e.selectAccountContent=function(t,i){e.currentAccount=i,i.serviceId===e.GOOGLE_DRIVE_ACCOUNT_ID?e.selectGoogleDriveContent(t):i.serviceId==e.BOX_DRIVE_ACCOUNT_ID?e.selectBoxContent(t):e.browseRepositoryContent(t,e.ALFRESCO_CLOUD_ACCOUNT_ID,i)},e.selectGoogleDriveContent=function(t){e.errorMessage=void 0,e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].authorized?e.openGoogleDriveBrowser(t):e.openContentAccountAuth(t,e.GOOGLE_DRIVE_ACCOUNT_ID))},e.selectBoxContent=function(t){e.errorMessage=void 0,e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].authorized?e.openBoxBrowser(t):e.openContentAccountAuth(t,e.BOX_DRIVE_ACCOUNT_ID))},e.browseRepositoryContent=function(t,i,o){o&&o.serviceId!==e.BOX_DRIVE_ACCOUNT_ID&&o.serviceId!==e.ALFRESCO_CLOUD_ACCOUNT_ID&&o.serviceId!==e.GOOGLE_DRIVE_ACCOUNT_ID?(e.currentAccount=o,e.openContentAccountBrowser(t,i)):(e.errorMessage=void 0,e.account&&e.account.authorized?(e.currentAccount=o,e.openContentAccountBrowser(t,i)):e.contentAccounts[i]&&e.contentAccounts[i].authorized?(e.currentAccount=e.contentAccounts[i],e.openContentAccountBrowser(t,i)):e.openContentAccountAuth(t,i))},e.openContentAccountAuth=function(t,i){var o=angular.element(r),n=(o.width()-500)/2,a=(o.height()-400)/2,s=r.open(e.contentAccounts[i].authorizationUrl,i,"width= 500, height=400, toolbar=no, status=no, titlebar=no, location=no, menubar=no, top="+a+", left="+n);r.contentAccountAuthConfirmed=function(){e.$apply(function(){e.contentAccounts[i].authorizationUrl=void 0,e.contentAccounts[i].authorized=!0,e.currentAccount=e.contentAccounts[i],s.close(),e.openContentAccountBrowser(t,i)})},r.contentAccountAuthFailed=function(t,i){e.$apply(function(){s.close(),e.showErrorModal(t,i)})}},e.showErrorModal=function(t,i){e.errorModel={error:t,details:i},_internalCreateModal({scope:e,template:"views/popup/error-popup.html",show:!0},n,e)},e.openContentAccountBrowser=function(t,i){i===e.GOOGLE_DRIVE_ACCOUNT_ID?e.openGoogleDriveBrowser(t):i===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.openAlfrescoBrowser(t):i===e.BOX_DRIVE_ACCOUNT_ID&&e.openBoxBrowser(t)},e.loadLastPath=function(t){e.currentFolderTree=angular.copy(e.currentAccount.lastPath.currentFolderTree),e.selectedNetwork=angular.copy(e.currentAccount.lastPath.selectedNetwork),e.selectedSite=angular.copy(e.currentAccount.lastPath.selectedSite),e.alfrescoSites=angular.copy(e.currentAccount.lastPath.alfrescoSites),t===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.loadLastPathAlfrescoCloud():t===e.BOX_DRIVE_ACCOUNT_ID?e.loadLastPathBox():t===e.GOOGLE_DRIVE_ACCOUNT_ID&&e.loadLastPathGoogleDrive()},e.loadLastPathAlfrescoCloud=function(){e.currentContent.data=[angular.copy(e.currentAccount.lastPath.currentContent)]},e.loadLastPathGoogleDrive=function(){e.googleDriveFiles.data=[angular.copy(e.currentAccount.lastPath.googleDriveFiles)]},e.loadLastPathBox=function(){e.boxFiles.data=[angular.copy(e.currentAccount.lastPath.boxFiles)]},e.saveLastPath=function(t,i){e.currentAccount.lastPath={},e.currentAccount.rememberPath=!0,e.currentAccount.lastPath.currentFolderTree=angular.copy(e.currentFolderTree),e.currentAccount.lastPath.selectedNetwork=angular.copy(e.selectedNetwork),e.currentAccount.lastPath.selectedSite=angular.copy(e.selectedSite),e.currentAccount.lastPath.alfrescoSites=angular.copy(e.alfrescoSites),t===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.saveLastPathAlfrescoCloud(i):t===e.BOX_DRIVE_ACCOUNT_ID?e.saveLastPathBox(i):t===e.GOOGLE_DRIVE_ACCOUNT_ID&&e.saveLastPathGoogleDrive(i)},e.saveLastPathAlfrescoCloud=function(t){e.currentAccount.lastPath.currentContent=angular.copy(t)},e.saveLastPathGoogleDrive=function(t){e.currentAccount.lastPath.googleDriveFiles=angular.copy(t)},e.saveLastPathBox=function(t){e.currentAccount.lastPath.boxFiles=angular.copy(t)},e.openAlfrescoBrowser=function(){if(e.currentAccount.rememberPath?e.loadLastPath(e.ALFRESCO_CLOUD_ACCOUNT_ID):(e.currentFolderTree=[],e.selectedNetwork=void 0,e.selectedSite=void 0,e.selectedFolder=void 0,e.alfrescoSites=void 0),e.contentSource&&e.contentSource.serviceId.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX){var t=e.contentSource.selectedFolder;t&&(e.selectedNetwork={id:t.network},e.selectedSite={id:t.siteId,title:t.site},e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.currentAccount.rememberPath?e.loadFolderContent():e.contentSource&&e.contentSource.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.loadAlfrescoNetworks(function(){e.loadAlfrescoSites(e.loadFolderContent)}):e.currentAccount&&e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?(e.uploadModel.noNetwork=!1,e.loadAlfrescoNetworks()):(e.uploadModel.noNetwork=!0,e.loadAlfrescoSites(e.loadFolderContent)),e.createContentBrowserPayload=function(t){var i=e.pathFromFolderTree(e.currentFolderTree),o=null;e.currentFolderTree.length>0&&(o=e.currentFolderTree[e.currentFolderTree.length-1].id);var n={path:{id:o,title:i,folderTree:e.currentFolderTree}};return e.uploadModel.noNetwork?n.account={id:t.serviceId,name:t.name}:n.network=e.selectedNetwork.id,n.site={id:e.selectedSite.id,title:e.selectedSite.title},n},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-alfresco-cloud.html",show:!0,scope:e},n,e)},e.selectNetwork=function(t){e.currentAccount.loading||e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID&&(e.selectedNetwork=t,e.selectedSite=void 0,e.alfrescoSites=void 0,t&&e.loadAlfrescoSites())},e.selectSite=function(t){e.currentAccount.loading||(e.selectedSite=t,e.alfrescoFolders=void 0,t?e.loadSiteContent():e.currentFolderTree=[])},e.loadAlfrescoNetworks=function(t){e.currentAccount.loading||(e.currentAccount.loading=!0,e.clearPopupError(),o.getNetworks().then(function(i){e.alfrescoNetworks=i,e.currentAccount.loading=!1,t&&t()}))},e.loadAlfrescoSites=function(t){e.currentAccount.loading||(e.currentAccount.loading=!0,e.clearPopupError(),e.currentAccount&&e.currentAccount.serviceId!==e.ALFRESCO_CLOUD_ACCOUNT_ID?o.getSites(e.currentAccount.serviceId).then(function(i){e.alfrescoSites=i,e.currentAccount.loading=!1,t&&t()}):e.selectedNetwork?o.getCloudSites(e.selectedNetwork.id).then(function(i){e.alfrescoSites=i,e.currentAccount.loading=!1,t&&t()}):(e.currentAccount.loading=!1,t&&t()))},e.loadSiteContent=function(){e.currentAccount.loading||(e.currentAccount.loading=!0,e.currentFolderTree=[],e.currentContent=void 0,e.clearPopupError(),e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?o.getCloudContentInSite(e.selectedNetwork.id,e.selectedSite.id).then(function(t){e.currentContent=t,e.currentAccount.loading=!1}):o.getContentInSite(e.currentAccount.serviceId,e.selectedSite.id).then(function(t){e.currentContent=t,e.currentAccount.loading=!1}))},e.navigateToFolder=function(t){var i=e.currentFolderTree[t];i&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),e.selectedFolder=i,e.loadFolderContent())},e.pathFromFolderTree=function(e){for(var t="",i=0;e.length>i;i++)i>0&&(t+=" > "),t+=e[i].title;return t},e.loadFolderContent=function(t){if(e.selectedFolder&&!e.currentAccount.loading){e.currentContent=void 0,e.currentAccount.loading=!0,e.clearPopupError();var i=e.pathFromFolderTree(e.currentFolderTree);e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?o.getCloudContentInFolderByPath(e.selectedNetwork.id,e.selectedSite.id,i).then(function(i){e.currentContent=i,e.currentAccount.loading=!1,t&&t()}).catch(function(){o.getCloudContentInFolder(e.selectedNetwork.id,e.selectedFolder.id).then(function(i){e.currentContent=i,e.currentAccount.loading=!1,t&&t()})}):o.getContentInFolderByPath(e.currentAccount.serviceId,e.selectedSite.id,i).then(function(i){e.currentContent=i,e.currentAccount.loading=!1,t&&t()}).catch(function(){o.getContentInFolder(e.currentAccount.serviceId,e.selectedFolder.id).then(function(i){e.currentContent=i,e.currentAccount.loading=!1,t&&t()})})}},e.openBoxBrowser=function(){if(e.currentAccount.rememberPath?e.loadLastPath(e.BOX_DRIVE_ACCOUNT_ID):e.currentFolderTree=[],e.contentSource&&e.contentSource.serviceId===e.BOX_DRIVE_ACCOUNT_ID){var t=e.contentSource.selectedFolder;t&&(e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.createContentBrowserPayload=function(t){var i=e.pathFromFolderTree(e.currentFolderTree),o=null;return e.currentFolderTree.length>0&&(o=e.currentFolderTree[e.currentFolderTree.length-1].id),{path:{id:o,title:i,folderTree:e.currentFolderTree},account:{id:t.serviceId,name:t.name}}},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-box.html",show:!0,scope:e},n,e),e.contentBrowseModal.$scope.$watch("filter",function(t){e.loadBoxFiles(t)})},e.navigateToBoxFolder=function(t){var i=e.currentFolderTree[t];i&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles(""))},e.navigateToBoxRoot=function(){e.currentFolderTree=[],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles("")},e.loadBoxFiles=function(t){e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].loading=!0),t||(e.boxFiles=void 0);var i;e.currentFolderTree&&e.currentFolderTree.length>0&&(i=e.currentFolderTree[e.currentFolderTree.length-1].id),o.getBoxFiles(t,i).then(function(t){e.boxFiles=t,e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].loading=!1})},e.openGoogleDriveBrowser=function(){if(e.currentAccount.rememberPath?e.loadLastPath(e.GOOGLE_DRIVE_ACCOUNT_ID):e.currentFolderTree=[],e.contentSource&&e.contentSource.serviceId===e.GOOGLE_DRIVE_ACCOUNT_ID){var t=e.contentSource.selectedFolder;t&&(e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.createContentBrowserPayload=function(t){var i=e.pathFromFolderTree(e.currentFolderTree),o=null;return e.currentFolderTree.length>0&&(o=e.currentFolderTree[e.currentFolderTree.length-1].id),{path:{id:o,title:i,folderTree:e.currentFolderTree},account:{id:t.serviceId,name:t.name}}},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-google-drive.html",show:!0,scope:e},n,e),e.contentBrowseModal.$scope.$watch("filter",function(t){e.loadGoogleDriveFiles(t)})},e.navigateToGoogleDriveFolder=function(t){var i=e.currentFolderTree[t];i&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles(""))},e.navigateToGoogleDriveRoot=function(){e.currentFolderTree=[],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles("")},e.loadGoogleDriveFiles=function(t){e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!0),t||(e.googleDriveFiles=void 0);var i;e.currentFolderTree&&e.currentFolderTree.length>0&&(i=e.currentFolderTree[e.currentFolderTree.length-1].id);var n=!1;e.contentSource&&e.contentSource.notAllowNavigateFolders&&1==e.contentSource.notAllowNavigateFolders&&(n=!0),o.getGoogleDriveFiles(t,i,n).then(function(t){e.googleDriveFiles=t,e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!1})},e.addContentFromSource=function(t,o,n,r,a,s,l){i.addRelatedContentFromSource(e.taskId,e.processInstanceId,t,o,n,r,a,e.linkOnly,e.isRelatedContent).then(function(t){e.uploadedCallback&&e.uploadedCallback(e.$parent,{content:t}),s&&s(t)},function(e){l&&l(e)})},e.boxContentSelected=function(t){t.folder?(e.currentFolderTree&&0!=e.currentFolderTree.length?e.currentFolderTree.push(t):e.currentFolderTree=[t],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles("")):(e.contentAccounts.box.loading=!0,e.saveLastPath(e.BOX_DRIVE_ACCOUNT_ID,t),e.addContentFromSource("box",t.id,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide()},function(){e.contentBrowseModal.$scope.$hide()}),t.title="Uploading: "+t.title,e.boxFiles.data=[t])},e.googleDriveContentSelected=function(t){t.folder?(e.currentFolderTree&&0!=e.currentFolderTree.length?e.currentFolderTree.push(t):e.currentFolderTree=[t],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles("")):(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!0,e.saveLastPath(e.GOOGLE_DRIVE_ACCOUNT_ID,t),e.addContentFromSource(e.GOOGLE_DRIVE_ACCOUNT_ID,t.id,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide()},function(){e.contentBrowseModal.$scope.$hide()}),t.title="Uploading: "+t.title,e.googleDriveFiles.data=[t])},e.selectAlfrescoContent=function(t){if(!e.currentAccount.loading)if(e.clearPopupError(),t.folder)e.currentFolderTree.push(t),e.selectedFolder=t,e.loadFolderContent();else if(!e.folderSelect){e.currentAccount.loading=!0,e.saveLastPath(e.ALFRESCO_CLOUD_ACCOUNT_ID,t);var i;i=e.currentAccount&&e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?t.id+"@"+e.selectedSite.id+"@"+e.selectedNetwork.id:t.id+"@"+e.selectedSite.id,e.addContentFromSource(e.currentAccount.serviceId,i,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide(),e.currentAccount.loading=!1},function(){e.contentBrowseModal.$scope.$hide(),e.currentAccount.loading=!1}),t.title="Uploading: "+t.title,e.currentContent.data=[t]}},e.formatFileSize=function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]},e.loadAccounts=function(){e.contentAccounts={loading:!0},o.getAccounts().then(function(t){if(t&&t.data)for(var i=0;t.data.length>i;i++){var o=t.data[i];e.contentAccounts[o.serviceId]=o}e.contentAccounts.rawList=t.data,e.contentAccounts.loading=!1})},e.loadAccounts()}],o}]),activitiModule.directive("selectPeoplePopover",["$rootScope","$http","$popover","appResourceRoot","UserService","SystemPropertiesService","$parse",function(e,t,i,o,n,r,a){var s={};return s.restrict="A",s.scope={excludeTaskId:"=excludeTaskId",excludeProcessId:"=excludeProcessId",excludeUserId:"=excludeUserId",excludeUserIds:"=excludeUserIds",tenantId:"=tenantId",type:"=type",restrictWithGroup:"=restrictWithGroup",selectPeopleFormFields:"=selectPeopleFormFields",ignoreContainer:"=ignoreContainer",emailModeDisabled:"=emailModeDisabled"},s.link=function(t,o,s){function l(e){g.popupModel.emailDisabled="true"===e||e===!0?!0:"false"===e||e===!1?!1:t.$eval(e)}var d="bottom";o.addClass("toggle-people-select"),s.placement&&(d=s.placement);var c=s.selectYourselfMode,p=!0;void 0!==s.closeOnSelect&&(p=s.closeOnSelect),t.popover=i(o,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/select-people-popover.html?"+Date.now(),placement:d});var u,m,h;s.onPeopleSelected&&(u=a(s.onPeopleSelected)),s.onCancel&&(m=a(s.onCancel)),s.onEmailSelected&&(h=a(s.onEmailSelected));var f="workflow";null!==t.type&&void 0!==t.type&&(f=t.type);var g=t.popover.$scope;g.title=s.popoverTitle,g.popupModel={emailMode:!1,showRecentResults:!1,userResults:[],userField:{},userFieldFilter:["people"],loading:!1},t.selectPeopleFormFields&&(g.popupModel.formFields=t.selectPeopleFormFields),(s.emailModeDisabled||t.emailModeDisabled)&&(l(t.emailModeDisabled||s.emailModeDisabled),s.hasOwnProperty("emailModeDisabled")&&t.$watch(s.emailModeDisabled,l),t.hasOwnProperty("emailModeDisabled")&&t.$watch("emailModeDisabled",l)),(void 0==g.popupModel.emailDisabled||0==g.popupModel.emailDisabled)&&r.getSystemProperties().then(function(e){g.popupModel.emailDisabled=!e.allowInvolveByEmail});var v=function(){if(g.popupModel.emailMode=!1,e.account&&e.account.capabilities){var t=e.account.capabilities.indexOf("tenant-mgmt")>-1||e.account.capabilities.indexOf("tenant-admin")>-1;t===!1&&(null===g.account.tenantId||void 0===g.account.tenantId)&&(g.popupModel.emailMode=!0)}};v(),g.setSearchType=function(){g.popupModel.userSourceType="search"},g.setFormFieldType=function(){g.popupModel.userSourceType="field"},g.$watch("popupModel.userField",function(){if(g.popupModel.userField&&g.popupModel.userField.id){if(u){var e={id:g.popupModel.userField.id,name:g.popupModel.userField.name,email:g.popupModel.userField.email,type:g.popupModel.userField.type};u(t.$parent,{userField:e}),g.popupModel.userField={}}(p||"true"===p)&&g.$hide()}}),g.$watch("popupModel.filter",function(){if(g.popupModel.filter&&g.popupModel.filter.length>0){g.popupModel.loading=!0;var e;e="idm"===f?n.getFilteredUsersStrict(g.popupModel.filter,t.tenantId,t.restrictWithGroup):n.getFilteredUsers(g.popupModel.filter,t.excludeTaskId,t.excludeProcessId,t.tenantId,t.restrictWithGroup),e.then(function(e){g.popupModel.showRecentResults=!1,g.popupModel.loading=!1;var i=[],o=null!==t.excludeUserId&&void 0!==t.excludeUserId,n=null!==t.excludeUserIds&&void 0!==t.excludeUserIds;if(o===!0||n===!0)for(var r=0;e.data.length>r;r++){var a=!1;o===!0&&e.data[r].id===t.excludeUserId&&(a=!0),n===!0&&t.excludeUserIds.indexOf(e.data[r].id)>=0&&(a=!0),a||i.push(e.data[r])}else i=e.data;g.popupModel.userResults=i,g.resetSelection()})}else g.resetSelection(),g.popupModel.userResults=[]}),g.resetSelection=function(){g.popupModel.selectedUser=void 0,g.popupModel.selectedIndex=-1},g.nextUser=function(){var e=g.popupModel.userResults;e&&e.length>0&&g.popupModel.selectedIndex<e.length-1&&(g.popupModel.selectedIndex+=1,g.popupModel.selectedUser=e[g.popupModel.selectedIndex])},g.previousUser=function(){var e=g.popupModel.userResults;e&&e.length>0&&g.popupModel.selectedIndex>0&&(g.popupModel.selectedIndex-=1,g.popupModel.selectedUser=e[g.popupModel.selectedIndex])},g.confirmUser=function(e){if(!e){var i=g.popupModel.userResults;g.popupModel.selectedIndex>=0&&g.popupModel.selectedIndex<i.length&&(e=i[g.popupModel.selectedIndex])}if(e)if(u&&u(t.$parent,{user:e}),"true"===p)g.$hide();else{var i=g.popupModel.userResults;i.splice(jQuery.inArray(e,i),1),g.popupModel.selectedIndex=0,g.popupModel.selectedUser=i[g.popupModel.selectedIndex]}},g.selectPersonByEmail=function(e){e&&h&&(h(t.$parent,{email:g.popupModel.email}),g.$hide())},g.getSelectYourselfLabelKey=function(){return"INVOLVE-PEOPLE."+c.toUpperCase()+"-YOURSELF"
},g.isCurrentUserSelectable=function(){return c&&!(t.excludeUserId&&t.excludeUserId==e.account.id||t.excludeUserIds&&-1!=t.excludeUserIds.indexOf(e.account.id))},g.selectYourself=function(){u&&(u(t.$parent,{user:e.account}),g.$hide())},g.$on("tooltip.hide",function(){g.popupModel.showRecentResults&&g.popupModel.added&&(g.popupModel.recentUsers=[]),g.popupModel.userResults=[],g.popupModel.filter="",g.popupModel.emailMode=!1,v(),g.popupModel.added?g.popupModel.added=!1:m&&m(t.$parent)})},s}]),activitiModule.directive("selectFunctionalGroupPopover",["$rootScope","$http","$popover","FunctionalGroupService","$parse",function(e,t,i,o,n){var r={};return r.restrict="A",r.scope={type:"=type",restrictWithGroup:"=restrictWithGroup",excludeGroupIds:"=excludeGroupIds"},r.link=function(t,r,a){var s="bottom";r.addClass("toggle-functional-group-select"),a.placement&&(s=a.placement);var l=!0;void 0!==a.closeOnSelect&&(l=a.closeOnSelect),t.popover=i(r,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/select-functional-group-popover.html?"+Date.now(),placement:s});var d,c;a.onGroupSelected&&(d=n(a.onGroupSelected)),a.onCancel&&(c=n(a.onCancel));var p=t.popover.$scope;p.title=a.popoverTitle,p.popupModel={groupResults:[]},p.$watch("popupModel.filter",function(){if(p.popupModel.filter&&p.popupModel.filter.length>0){var i;null!==e.common&&void 0!==e.common&&null!==e.common.selectedTenantId&&void 0!==e.common.selectedTenantId&&(i=e.common.selectedTenantId>0?e.common.selectedTenantId:void 0),o.getFilteredGroups(p.popupModel.filter,t.restrictWithGroup,i).then(function(e){var i=[];if(null!=t.excludeGroupId&&t.excludeGroupId)for(var o=0;e.data.length>o;o++)e.data[o].id!==t.excludeGroupId&&i.push(e.data[o]);else if(null!=t.excludeGroupIds&&void 0!==t.excludeGroupIds)for(var o=0;e.data.length>o;o++)0>t.excludeGroupIds.indexOf(e.data[o].id)&&i.push(e.data[o]);else i=e.data;p.popupModel.groupResults=i,p.resetSelection()})}else p.resetSelection(),p.popupModel.groupResults=[]}),p.resetSelection=function(){p.popupModel.selectedGroup=void 0,p.popupModel.selectedIndex=-1},p.nextGroup=function(){var e=p.popupModel.groupResults;e&&e.length>0&&p.popupModel.selectedIndex<e.length-1&&(p.popupModel.selectedIndex+=1,p.popupModel.groupUser=e[p.popupModel.selectedIndex])},p.previousGroup=function(){var e=p.popupModel.groupResults;e&&e.length>0&&p.popupModel.selectedIndex>0&&(p.popupModel.selectedIndex-=1,p.popupModel.selectedGroup=e[p.popupModel.selectedIndex])},p.confirmGroup=function(e){if(!e){var i=p.popupModel.groupResults;p.popupModel.selectedIndex>=0&&p.popupModel.selectedIndex<i.length&&(e=i[p.popupModel.selectedIndex])}if(e)if(d&&d(t.$parent,{group:e}),"true"===l)p.$hide();else{var i=p.popupModel.groupResults;i.splice(jQuery.inArray(e,i),1),p.popupModel.selectedIndex=0,p.popupModel.selectedGroup=i[p.popupModel.selectedIndex]}},p.$on("tooltip.hide",function(){p.popupModel.groupResults=[],p.popupModel.filter="",p.popupModel.added?p.popupModel.added=!1:c&&c(t.$parent)})},r}]),activitiModule.directive("tabControl",["$compile","$http","$templateCache",function(e,t,i){var o=function(o,n){if(!o.activeTemplate||o.activeTemplate!=o.activeTab.id){var r=$(n.children()[1]),a=angular.element(n.children()[1]).scope();if(o.activeTemplate&&a!=o&&a.$destroy(),o.activeTab&&o.activeTab.templateUrl){var s=t.get(o.activeTab.templateUrl,{cache:i});s.success(function(e){r.html(e)}).then(function(){o.activeTemplate=o.activeTab.id,r.replaceWith(e(r.html())(o))})}else r.empty()}},n={};return n.restrict="A",n.replace=!0,n.transclude=!0,n.template='<div><div class="clearfix"><ul class="tabs clearfix"><li ng-repeat="tab in tabs" ng-class="{\'active\': tab.id == activeTab.id}"><a ng-click="tabClicked(tab)">{{tab.title && (tab.title | translate) || (tab.name | translate)}}</a></li></ul></div><div></div></div>',n.scope={possibleTabs:"=tabControl",model:"=model",activeTabReference:"=activeTab"},n.controller=["$scope","$element",function(e,t){e.refreshTabs=function(){for(var t=[],i=0;e.possibleTabs.length>i;i++){var o=e.possibleTabs[i];o.hide||t.push(o)}e.tabs=t},e.$watch("possibleTabs",function(){e.refreshTabs()},!0),e.$watch("activeTabReference",function(t){if(!e.activeTab||e.activeTab.id!=t){var i=e.findTab(t);i&&e.tabClicked(i)}}),e.findTab=function(t){if(e.possibleTabs)for(var i=0;e.possibleTabs.length>i;i++)if(e.possibleTabs[i].id==t)return e.possibleTabs[i];return void 0},e.tabClicked=function(i){i.hide&&(i.hide=!1,e.refreshTabs()),e.activeTab=i,e.activeTabReference=i?i.id:void 0,o(e,t)},e.refreshTabs(),e.tabs&&e.tabs.length>0&&(e.activeTabReference&&(e.activeTab=e.findTab(e.activeTabReference)),e.activeTab||(e.activeTab=e.tabs[0]),e.tabClicked(e.activeTab))}],n.link=o,n}]),activitiModule.directive("toggleDragover",["$document","$parse",function(e,t){var i=function(e,i,o){var n=o.toggleDragover,r=t(n),a=i[0];a.addEventListener("dragenter",function(){return e.$apply(function(){r(e,{over:!0})}),!1},!1),a.addEventListener("dragleave",function(){return e.$apply(function(){r(e,{over:!1})}),!1},!1)};return i}]),activitiModule.directive("editInPlace",function(){return{restrict:"E",scope:{value:"="},template:'<span ng-click="edit()" ng-bind="value"></span><span class="glyphicon glyphicon-pencil edit-in-place-icon"></span><input ng-model="value" class="inline-edit-value form-control" ng-blur="stopEdit()" custom-keys enter-pressed="stopEdit()">',link:function(e,t){angular.element(t.children()[1]);var i=angular.element(t.children()[2]);t.addClass("edit-in-place"),e.editing=!1,e.edit=function(){e.editing=!0,t.addClass("active"),i[0].focus()},e.stopEdit=function(){e.editing=!1,t.removeClass("active")}}}});var _internalCreateModal=function(e,t,i){return null!==i&&void 0!==i?(i.modal=t(e),i.$on("$routeChangeStart",function(){i.modal&&i.modal.hide()}),i.modal):t(e)};activitiModule.directive("modalPropertyEditor",["$modal",function(e){return{restrict:"E",scope:!1,link:function(t,i,o){var n={template:o.template?o.template+"?version="+Date.now():null,scope:t};o.backdrop&&(n.backdrop=o.backdrop),o.keyboard&&(n.keyboard="true"===o.keyboard),_internalCreateModal(n,e,t)}}}]),activitiModule.directive("numberInputCheck",function(){return{require:"ngModel",link:function(e,t,i,o){var n={positiveOnly:i.numberPositiveOnly?!0:!1,moneyFraction:i.numberMoneyFraction?!0:!1};o.$parsers.push(function(e){var t;e&&0===e.indexOf("-")&&!n.positiveOnly?(t=e.substr(1).replace(/([^0-9])/g,""),t="-"+t):t=e.replace(/([^0-9])/g,"");var i=parseInt(t);return isNaN(i)||n.moneyFraction||(t=""+i),t!=e&&(o.$setViewValue(t),o.$render()),t})}}}),activitiModule.directive("numberMinValue",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,o){var n=function(e){var t=!0;if(i.numberMinValue)if(e){var n=parseFloat(i.numberMinValue),r=parseFloat(e);n>r&&(t=!1)}else t=!0;return o.$setValidity("numberMinValue",t),e};o.$parsers.push(n),i.$observe("numberMinValue",function(){return n(o.$viewValue)})}}}),activitiModule.directive("numberMaxValue",function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,o){var n=function(e){var t=!0;if(i.numberMaxValue&&e){var n=parseFloat(i.numberMaxValue),r=parseFloat(e);r>n&&(t=!1)}return o.$setValidity("numberMaxValue",t),e};o.$parsers.push(n),i.$observe("numberMaxValue",function(){return n(o.$viewValue)})}}}),activitiModule.directive("maskedInput",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,i,o){e(function(){var e=o.maskedInput;e&&i.mask(e,{placeholder:o.maskedInputPlaceholder,reverse:"true"===o.maskedInputReversed})})}}}]),activitiModule.directive("columnListScroll",["$rootScope","$timeout","$interval",function(e,t,i){return{restrict:"A",scope:{},link:function(e,o,n){o.addClass("column-container-scroll"),e.columnHeaderClass=n.columnListScroll||"column-header",e.updateHeight=function(){var t;e.header?t=e.header.outerHeight():o.parent().children("."+e.columnHeaderClass).each(function(){if(e.header=angular.element(this),e.header.addClass("column-header-fixed"),e.resizeSensor=new ResizeSensor(this,e.updateHeight),e.header.hasClass("ng-hide"))var o=i(function(){e.header.hasClass("ng-hide")||(i.cancel(o),e.updateHeight())},20,400,!1);else t=e.header.outerHeight()}),t&&(e.emptyChild||(e.emptyChild=o.children(".column-list-scroll-push")),e.emptyChild&&e.emptyChild.height(t))},t(e.updateHeight,1),e.$on("$destroy",function(){e.header&&e.resizeSensor.detach(e.header[0])})}}}]),activitiModule.directive("externalTarget",function(){return{restrict:"A",scope:{href:"@"},link:function(e,t,i){var o=t[0];e.$watch("href",function(){(o.protocol!=location.protocol||o.host!=location.host)&&(o.target=i.externalTarget)})}}}),activitiModule.config(["$httpProvider","$translateProvider",function(e){e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.get["Cache-Control"]="no-cache, no-store, must-revalidate",e.defaults.headers.get.Pragma="no-cache",e.defaults.headers.get.Expires="0"}]),activitiModule.service("ResourceService",["$http","$q","appResourceRoot",function(e,t,i){function o(e,t){var o=i+e;if(!t||!s[o])if(t&&(s[o]=!0),document.createStyleSheet)try{document.createStyleSheet(e)}catch(n){}else{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.media="all",r.href=o,document.getElementsByTagName("head")[0].appendChild(r)}}function n(e,t,o){var n=i+e;if(o&&s[n]&&t)t();else{o&&(s[n]=!0);var r=document.createElement("script");if(r.type="text/javascript",r.src=n,t){var a=!1;r.onload=r.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,t())}}var l=document.getElementsByTagName("head")[0];l.appendChild(r)}}function r(e,t,i){function o(){var r=e.shift();r?n.call(this,r,o.bind(this),i):t&&t()}o.call(this)}function a(t,i,n){e.get(t).success(function(e){var t;if(window.DOMParser){var a=new DOMParser;t=a.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e);for(var s,l=t.getElementsByTagName("link"),d=[],c=0,p=l.length;p>c;c++)s=l[c].getAttribute("href"),s&&o(s,n);for(l=t.getElementsByTagName("script"),c=0,p=l.length;p>c;c++)s=l[c].getAttribute("src"),s&&d.push(s);r(d,i,n)})}var s={};this.loadFromHtml=a,this.loadScript=n,this.loadStylesheet=o}]),function(){if(null!==ACTIVITI.CONFIG.isEventTrackingEnabled&&void 0!==ACTIVITI.CONFIG.isEventTrackingEnabled&&ACTIVITI.CONFIG.isEventTrackingEnabled===!0)if(null!==ACTIVITI.CONFIG.trackingCode&&void 0!==ACTIVITI.CONFIG.trackingCode){(function(e,t,i,o,n,r,a){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=1*new Date,r=t.createElement(i),a=t.getElementsByTagName(i)[0],r.async=1,r.src=o,a.parentNode.insertBefore(r,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");var e;e=null!==ACTIVITI.CONFIG.isDevMode&&void 0!==ACTIVITI.CONFIG.isDevMode&&ACTIVITI.CONFIG.isDevMode===!0?{cookieDomain:"none"}:"auto",ga("create",ACTIVITI.CONFIG.trackingCode,e),ga("require","displayfeatures"),ga("send","pageview")}else console.log("Could not initialise event tracking: no tracking code found (set property in ACTIVITI.CONFIG.trackingCode)")}(),activitiModule.run(["$rootScope","$location","EventTrackingService",function(e,t,i){e.$on("$locationChangeSuccess",function(){var e=t.url();null!==e&&void 0!==e&&e.length>0&&i.trackPageView(t.url())})}]),activitiModule.config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate","EventTrackingService",function(e,t){return function(i,o){if(e(i,o),i){var n;i&&i.stack&&(n=angular.toJson(i.stack)),n&&t.trackException(n,!1)}}}])}]),activitiModule.service("EventTrackingService",[function(){var e=function(){return null!==ACTIVITI.CONFIG.isEventTrackingEnabled&&void 0!==ACTIVITI.CONFIG.isEventTrackingEnabled&&ACTIVITI.CONFIG.isEventTrackingEnabled===!0},t=function(e){null!==ACTIVITI.CONFIG.isDevMode&&void 0!==ACTIVITI.CONFIG.isDevMode&&ACTIVITI.CONFIG.isDevMode===!0&&console.log("[Event Tracker] "+e)};this.trackPageView=function(i){e()&&(t("pageview : "+i),ga("set","page",i),ga("send","pageview"))},this.trackEvent=function(i,o,n,r){e()&&(t("custom event : "+i+" - "+o),ga("send","event",i,o,n,r))},this.trackException=function(i,o){e()&&(t("exception : "+i+", is fatal: "+o),ga("send","event","exception","webapp",i.substring(0,400)))}}]),activitiModule.filter("trackEvent",["EventTrackingService",function(e){return function(t,i,o,n,r){return e.trackEvent(i,o,n,r),t}}]),activitiModule.factory("RecursionHelper",["$compile",function(e){return{compile:function(t,i){angular.isFunction(i)&&(i={post:i});var o,n=t.contents().remove();return{pre:i&&i.pre?i.pre:null,post:function(t,r){o||(o=e(n)),o(t,function(e){r.append(e)}),i&&i.post&&i.post.apply(null,arguments)}}}}}]),activitiApp.service("FormUtilService",[function(){var e=function(t,i){var i=i||[];return t&&t.forEach(function(t){if(i.push(t),("container"===t.type||"group"===t.type)&&t.fields)for(var o in t.fields)e(t.fields[o],i)}),i};this.flattenFields=e;var t=function(e,t){var i=e.indexOf(t);if(i>=0)return i;for(var o=0;e.length>o;o++)if("container"===e[o].type)for(var n in e[o].fields)if(e[o].fields[n].indexOf(t)>=0)return o};this.determineContainerIndex=t;var i=function(e,t){var i=e.indexOf(t);i>=0&&e.splice(i,1);for(var o=function(t){var i;e.forEach(function(e,o){if("container"===e.type&&e.fields){var n=!1,r=!0;for(var a in e.fields)e.fields[a]===t&&(n=!0),e.fields[a]&&e.fields[a].length>0&&(r=!1);n&&r&&(i=o)}}),void 0!==i&&i>-1&&e.splice(i,1)},n=0;e.length>n;n++)if("container"===e[n].type)for(var r in e[n].fields)if(e[n].fields[r].indexOf(t)>=0){e[n].fields[r].splice(e[n].fields[r].indexOf(t),1),o(e[n].fields[r]);break}};this.removeFormElement=i}]),function(){angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(e,t){return{loginConfirmed:function(i,o){var n=o||function(e){return e};e.$broadcast("event:auth-loginConfirmed",i),t.retryAll(n)},loginCancelled:function(i,o){t.rejectAll(o),e.$broadcast("event:auth-loginCancelled",i)}}}]).config(["$httpProvider",function(e){var t=["$rootScope","$q","httpBuffer","$translate",function(e,t,i,o){return{responseError:function(n){if(401===n.status&&!n.config.ignoreAuthModule){var r=t.defer();return i.append(n.config,r),e.$broadcast("event:auth-loginRequired",n),r.promise}return 401===n.status&&(e.invalidCredentials=!0),n.status>=500&&599>=n.status&&n.config&&!n.config.ignoreErrors&&(n.data&&n.data.messageKey?e.addAlertPromise(o(n.data.messageKey),"error"):n.data&&n.data.message?e.addAlert(n.data.message,"error"):e.addAlertPromise(o("GENERAL.ERROR.GENERIC"),"error")),t.reject(n)}}}];e.interceptors.push(t)}]),angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(e){function t(t,o){function n(e){o.resolve(e)}function r(e){o.reject(e)}i=i||e.get("$http"),i(t).then(n,r)}var i,o=[];return{append:function(e,t){o.push({config:e,deferred:t})},rejectAll:function(e){if(e)for(var t=0;o.length>t;++t)o[t].deferred.reject(e);o=[]},retryAll:function(e){for(var i=0;o.length>i;++i)t(e(o[i].config),o[i].deferred);o=[]}}}])}(),activitiApp.factory("AuthenticationSharedService",["$rootScope","$http","authService","$q","$location","$window",function(e,t,i,o){return{authenticate:function(){var i=o.defer();return t.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/authenticate",{ignoreErrors:!0,ignoreAuthModule:"ignoreAuthModule"}).success(function(){var o=ACTIVITI.CONFIG.contextRoot+"/app/rest/account";ACTIVITI.CONFIG.integrationProfile&&(o+="?includeApps=true"),t.get(o).success(function(t){e.account=t,e.invalidCredentials=!1,e.$broadcast("event:auth-authConfirmed"),i.resolve()}).error(function(t){i.reject(t),e.$broadcast("event:auth-loginRequired")})}).error(function(t){i.reject(t),e.$broadcast("event:auth-loginRequired")}),i.promise},login:function(o){var n="j_username="+encodeURIComponent(o.username)+"&j_password="+encodeURIComponent(o.password)+"&_spring_security_remember_me=true&submit=Login";t.post(ACTIVITI.CONFIG.contextRoot+"/app/authentication",n,{headers:{"Content-Type":"application/x-www-form-urlencoded"},ignoreAuthModule:"ignoreAuthModule"}).success(function(t,n,r,a){e.authenticationError=!1,o.success&&o.success(t,n,r,a),i.loginConfirmed()}).error(function(t,i,n,r){e.$broadcast("event:auth-loginFailed"),o.error&&o.error(t,i,n,r)})},logout:function(){e.authenticated=!1,e.authenticationError=!1,t.get(ACTIVITI.CONFIG.contextRoot+"/app/logout").success(function(){e.login=null,e.authenticated=!1,i.loginCancelled({isFromLogout:!0})})},hasCapability:function(t){return e.account&&e.account.capabilities?e.account.capabilities.indexOf(t)>-1:!1},hasTenantManagementCapability:function(){return this.hasCapability("tenant-mgmt")},hasTenantAdminCapability:function(){return this.hasCapability("tenant-admin")},hasAccessReportsCapability:function(){return this.hasCapability("access-reports")}}}]),activitiApp.service("RuntimeAppDefinitionService",["$http","$q","$location","EventTrackingService","AuthenticationSharedService","appName",function(e,t,i,o,n,r){var a=function(i){var o=t.defer();return e(i).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise};this.getApplications=function(){var e=n.hasTenantManagementCapability()||n.hasTenantAdminCapability(),t=[],o=i.absUrl(),s=o.indexOf("/#");s>=0&&(o=o.substring(0,s)),s=o.indexOf("?"),s>=0&&(o=o.substring(0,s)),"/"==o[o.length-1]&&(o=o.substring(0,o.length-1)),r.length>0&&o.substring(o.length-r.length)==r&&(o=o.substring(0,o.length-r.length-1));var l={editor:o+"/editor/",identity:o+"/idm/",workflow:o+"/workflow/",admin:"http://localhost:8080/activiti-admin",analytics:o+"/analytics/"},d=function(i){for(var n=JSON.parse(i),r=[],a=0;n.data.length>a;a++){var s=n.data[a];if(void 0!==s.defaultAppId&&null!==s.defaultAppId)if("kickstart"===s.defaultAppId)t.push({id:"kickstart",titleKey:"APP.KICKSTART.TITLE",descriptionKey:"APP.KICKSTART.DESCRIPTION",defaultAppId:s.defaultAppId,theme:"theme-1",icon:"icon icon-choice",fixedBaseUrl:l.editor+"/#/",fixedUrl:l.editor,pages:["processes","forms","apps","stencils","decision-tables","data-models"]});else if("tasks"===s.defaultAppId)t.push({id:"tasks",titleKey:"APP.TASKS.TITLE",descriptionKey:"APP.TASKS.DESCRIPTION",defaultAppId:s.defaultAppId,theme:"theme-2",icon:"icon icon-clock",fixedBaseUrl:l.workflow+"/#/",fixedUrl:l.workflow,pages:["tasks","processes","processes?mode=start"]});else if("identity"===s.defaultAppId){var d={id:"identity",titleKey:e?"APP.IDENTITY-MANAGEMENT.TITLE-TENANT-ADMIN":"APP.IDENTITY-MANAGEMENT.TITLE",descriptionKey:e?"APP.IDENTITY-MANAGEMENT.DESCRIPTION-TENANT-ADMIN":"APP.IDENTITY-MANAGEMENT.DESCRIPTION",defaultAppId:s.defaultAppId,theme:"theme-3",icon:"icon icon-user",fixedBaseUrl:l.identity+"/#/",fixedUrl:l.identity};e&&(d.pages=["tenant-mgmt","user-mgmt","system-group-mgmt","functional-group-mgmt","profile"]),t.push(d)}else"analytics"===s.defaultAppId&&t.push({id:"analytics",titleKey:"APP.ANALYTICS.TITLE",descriptionKey:"APP.ANALYTICS.DESCRIPTION",defaultAppId:s.defaultAppId,theme:"theme-6",icon:"glyphicon glyphicon-stats",fixedBaseUrl:l.analytics+"/#/",fixedUrl:l.analytics});else s.icon="glyphicon "+s.icon,s.fixedBaseUrl=o+"/workflow/#/apps/"+s.id+"/",s.fixedUrl=s.fixedBaseUrl+"tasks",s.pages=["tasks","processes","processes?mode=start"],s.deletable=!0,r.push(s)}return{defaultApps:t,customApps:r}};return a({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/runtime/app-definitions",transformResponse:d})},this.deleteAppDefinition=function(e){var t=a({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/runtime/app-definitions/"+e});return t.then(function(){o.trackEvent("landing","runtime-app-delete")}),t}}]),activitiApp.service("SystemPropertiesService",["$http","$q",function(e,t){var i=function(i){var o=t.defer();return e(i).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise};this.getSystemProperties=function(){return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties"})},this.getPasswordValidationConstraints=function(e){return(void 0===e||null===e)&&(e="-1"),i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties/password-validation-constraints/"+e})},this.canInvolvedUsersEditForms=function(e){return(void 0===e||null===e)&&(e="-1"),i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties/involved-users-can-edit-forms/"+e})},this.getGlobalDateFormat=function(e){return(void 0===e||null===e)&&(e="-1"),i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties/global-date-format/"+e})}}]),activitiApp.provider("licenseStatus",function licenseStatusProvider(){var e=null;this.licenseStatusResolver=["$q","$rootScope","$http","$translate",function(t,i,o,n){if(i.licenseStatus)return e;var r=function(r){var a=t.defer();return o(r).success(function(t){i.readOnly="valid"!==t.status,i.multiTenantMode=t.multiTenant,i.allowLicenseUpload=t.allowUpload,t.warning?(i.licenseWarning=t.warning,i.addAlert(n.instant("COMMON.WARNING.APP-LICENSE-WARNING-"+t.warning.toUpperCase()),"error")):null==e&&i.readOnly&&(i.licenseStatus=t.status,i.addAlert(n.instant("COMMON.WARNING.APP-LICENSE-ISSUE-"+t.status.toUpperCase()),"error")),e=t.status,a.resolve(e)}).error(function(){i.authenticated&&i.addAlert(n.instant("COMMON.WARNING.APP-LICENSE-ISSUE-NOT-FOUND"),"error"),a.resolve("not-found")}),a.promise};return r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/license"})}],this.$get=[function(){}]}),angular.module("activiti.common").service("AlfrescoOneService",["$q","$translate",function(e,t){"use strict";var i={};return i.getContentActionTemplates=function(){var i=e.defer(),o=[{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.EXTRACT-METADATA"),name:"extract-metadata",params:[]},{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.MOVE"),name:"move",params:[{name:"destination-folder",value:"workspace://SpacesStore/<ID>"}]},{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.ADD-FEATURES"),name:"add-features",params:[{name:"aspect-name",value:""}]},{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.SPECIALISE-TYPE"),name:"specialise-type",params:[{name:"type-name",value:""}]},{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.SCRIPT"),name:"script",params:[{name:"script-ref",value:""}]},{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.CHECK-IN"),name:"check-in",params:[{name:"description",value:""},{name:"minorChange",value:"true"}]},{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.TRANSFORM"),name:"transform",params:[{name:"mime-type",value:"application/pdf"},{name:"destination-folder",value:""}]},{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.REMOVE-FEATURES"),name:"remove-features",params:[{name:"aspect-name",value:""}]},{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.CHECK-OUT"),name:"check-out",params:[{name:"destination-folder",value:"workspace://SpacesStore/<ID>"},{name:"assoc-type",value:""},{name:"assoc-name",value:""}]},{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.COPY"),name:"copy",params:[{name:"destination-folder",value:"workspace://SpacesStore/<ID>"},{name:"deep-copy",value:"false"},{name:"overwrite-copy",value:"false"}]},{title:t.instant("PROCESS-BUILDER.CALL-ALFRESCO-ACTION-STEP.TAB.ACTION.TYPES.TRANSFORM-IMAGE"),name:"transform-image",params:[{name:"mime-type",value:"image/jpeg"},{name:"destination-folder",value:"workspace://SpacesStore/<ID>"},{name:"assoc-type",value:""},{name:"assoc-name",value:""},{name:"overwrite-copy",value:"false"},{name:"convert-command",value:""}]}];return i.resolve(o),i.promise},i}]),activitiApp.controller("AboutActivitiPopupCrtl",["$rootScope","$scope","$http","$translate","$interval","$dateFormatter",function(e,t,i,o,n,r){t.popup={loading:!0,activitiVersion:{},licenseHolder:""},i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/about-info"}).success(function(e){t.popup.licenseHolder=e.holder,t.popup.activitiVersion=e.versionInfo.edition+" v"+e.versionInfo.majorVersion+"."+e.versionInfo.minorVersion+"."+e.versionInfo.revisionVersion,t.popup.activitiVersionType=e.versionInfo.type,e.goodBeforeDate&&(t.popup.goodBeforeDate=r.formatDate(new Date(e.goodBeforeDate))),t.popup.loading=!1}).error(function(){t.popup.loading=!1}),t.cancel=function(){t.close()},t.close=function(){t.$hide()}}]),activitiApp.factory("httpUtils",[function(){"use strict";var e={};return e.encode=function(e){var t=[];if(e)for(var i in e){var o=e[i];void 0!==o&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(o))}return t.join("&")},e}]),angular.module("activiti.common").filter("dateformat",function(){"use strict";return function(e,t){return e?"fromNow"===t?moment(e).fromNow():"fromNowFull"===t?moment(e).fromNow()+" ("+moment(e).format("MMMM Do YYYY")+")":t?moment(e).format(t):moment(e).calendar():""}}).filter("dateonlyformat",function(){"use strict";return function(e,t){return e?(e=e.split("T")[0],"fromNow"===t?moment(e).fromNow():"fromNowFull"===t?moment(e).fromNow()+" ("+moment(e).format("MMMM Do YYYY")+")":t?moment(e).format(t):moment(e).calendar()):""}}).filter("validdateformat",function(){"use strict";return function(e,t){var i;return e&&(i="fromNow"===t?moment(e).fromNow():"fromNowFull"===t?moment(e).fromNow()+" ("+moment(e).format("MMMM Do YYYY")+")":t?moment(e).format(t):moment(e).calendar(),0==moment(i).isValid()&&(i="")),i}}).filter("momentToAngularFormat",function(){"use strict";return function(e){return e?(e=e.replace(/D/g,"d"),e=e.replace(/Y/g,"y")):void 0}});
