"use strict";var activitiApp=angular.module("activitiApp",["http-auth-interceptor","ngCookies","ngResource","ngSanitize","ngRoute","mgcrea.ngStrap","ngAnimate","ngFileUpload","pascalprecht.translate","ui.grid","ui.grid.edit","ui.grid.selection","ui.grid.autoResize","ui.grid.cellNav","activiti.common"]);angular.module("activiti.common",[]);var activitiModule=activitiApp;activitiApp.config(["$provide","$routeProvider","$translateProvider","licenseStatusProvider",function(e,t,o,n){var r="idm";e.value("appName",r);var a=ACTIVITI.CONFIG.webContextRoot+"/"+r+"/";e.value("appResourceRoot",a);var i=["$rootScope","AuthenticationSharedService",function(e,t){return e.authenticated?(e.authenticated=!0,!0):t.authenticate()}];t.when("/tenant-mgmt",{controller:"IdmTenantMgmtController",templateUrl:a+"views/idm-tenant-mgmt.html",resolve:{verify:i,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"tenantMgmt"}).when("/user-mgmt",{controller:"IdmUserMgmtController",templateUrl:a+"views/idm-user-mgmt.html",resolve:{verify:i,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"userMgmt"}).when("/system-group-mgmt",{controller:"IdmSystemGroupMgmtController",templateUrl:a+"views/idm-system-group-mgmt.html",resolve:{verify:i,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"systemGroupMgmt"}).when("/functional-group-mgmt",{controller:"IdmFunctionalGroupMgmtController",templateUrl:a+"views/idm-functional-group-mgmt.html",resolve:{verify:i,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"functionalGroupMgmt"}).when("/profile",{controller:"IdmProfileMgmtController",templateUrl:a+"views/idm-profile-mgmt.html",resolve:{verify:i,licenseStatus:n.licenseStatusResolver},activeHeaderBar:"profile"}).when("/logout",{templateUrl:a+"views/empty.html",controller:"LogoutController"}).otherwise({redirectTo:ACTIVITI.CONFIG.appDefaultRoute||"/profile"}),o.useSanitizeValueStrategy("sanitizeParameters"),o.useStaticFilesLoader({prefix:a+"/i18n/",suffix:".json"}),o.preferredLanguage(window.ACTIVITI_PREFERRED_LOCALE)}]).config(["$httpProvider",function(e){function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e16]+1e16).replace(/[01]/g,t)}e.interceptors.push(function(){return{request:function(e){return document.cookie="CSRF-TOKEN="+t()+";path=/",e}}})}]).run(["$rootScope","$location","$window","AuthenticationSharedService","$translate","appResourceRoot","$modal",function(e,t,o,n,r,a,i){e.appResourceRoot=a;var l="/idm/";e.logout=function(){n.logout()},e.showAboutActiviti=function(){_internalCreateModal({template:"../views/modal/about-activiti.html?"+(new Date).getTime(),show:!0},i,e)};var d=function(e){var n,r=t.absUrl(),a=r.indexOf(l);n=null!==e&&void 0!==e&&void 0!==e.isFromLogout&&e.isFromLogout===!0?r.substring(0,a)+"/#login":r.substring(0,a)+"/#login?redirectUrl="+encodeURIComponent(o.location.pathname+o.location.hash),o.location.href==n?window.location.reload():o.location.href=n};e.$on("event:auth-loginRequired",function(){e.authenticated=!1,e.authenticationChecked=!0,d()}),e.$on("event:auth-authConfirmed",function(){e.authenticated=!0,e.authenticationChecked=!0,(""==t.path()||"#"==t.path()||"/login"==t.path())&&t.path("/");var o=t.url();(o&&("/user-mgmt"===o||"/system-group-mgmt"===o)||"functional-group-mgmt"===o||"/tenant-mgmt"===o)&&(e.hasTenantManagementCapability()||e.hasTenantAdminCapability()||t.path("/profile"))}),e.$on("event:auth-loginConfirmed",function(){n.authenticate(),e.common={}}),e.$on("event:auth-loginCancelled",function(t,o){e.authenticated=!1,d(o)}),e.$on("event:auth-loginFailed",function(){e.addAlertPromise(r("LOGIN.MESSAGES.ERROR.AUTHENTICATION"),"error")}),e.backToLanding=function(){var e=t.absUrl(),n=e.indexOf(l);n>=0&&(e=e.substring(0,n),e+="/"),o.location.href=e}}]).run(["$rootScope","$timeout","$translate","$location","$window","AuthenticationSharedService",function(e,t,o,n,r,a){var i=ACTIVITI.CONFIG.locales||["en","de","es","fr","it","nl","ja","nb","ru","zh-CN","pt-BR"],l=o.proposedLanguage();-1===i.indexOf(l)?o.use("en").then(function(e){moment.lang(e)}):moment.lang(l),e.$on("$routeChangeSuccess",function(t,o){o.activeHeaderBar&&e.setMainPageById(o.activeHeaderBar)}),e.common={},e.webRootUrl=function(){return ACTIVITI.CONFIG.webContextRoot},e.restRootUrl=function(){return ACTIVITI.CONFIG.contextRoot},e.window={};var d=function(){e.window.width=r.innerWidth,e.window.height=r.innerHeight};angular.element(r).bind("resize",function(){e.$apply(d())}),e.$watch("window.forceRefresh",function(o){o&&t(function(){d(),e.window.forceRefresh=!1})}),d(),e.hasTenantManagementCapability=function(){return a.hasTenantManagementCapability()},e.hasTenantAdminCapability=function(){return a.hasTenantAdminCapability()},e.$watch("account",function(){e.mainNavigation=[{id:"tenantMgmt",title:"IDM.GENERAL.NAVIGATION.TENANT-MGMT",path:"/tenant-mgmt",isVisible:function(){return a.hasTenantManagementCapability()||a.hasTenantAdminCapability()}},{id:"userMgmt",title:"IDM.GENERAL.NAVIGATION.USER-MGMT",path:"/user-mgmt",isVisible:function(){return a.hasTenantManagementCapability()||a.hasTenantAdminCapability()}},{id:"systemGroupMgmt",title:"IDM.GENERAL.NAVIGATION.SYSTEM-GROUP-MGMT",path:"/system-group-mgmt",isVisible:function(){return a.hasTenantManagementCapability()||a.hasTenantAdminCapability()}},{id:"functionalGroupMgmt",title:"IDM.GENERAL.NAVIGATION.FUNCTIONAL-GROUP-MGMT",path:"/functional-group-mgmt",isVisible:function(){return a.hasTenantManagementCapability()||a.hasTenantAdminCapability()}},{id:"profile",title:"IDM.GENERAL.NAVIGATION.PROFILE",path:"/profile",isVisible:function(){return!0}}],e.setMainPage=function(t){e.mainPage=t,n.path(e.mainPage.path)},e.setMainPageById=function(t){for(var o=0;e.mainNavigation.length>o;o++)if(t==e.mainNavigation[o].id){e.mainPage=e.mainNavigation[o];break}}})}]).run(["$http",function(e){e.defaults.xsrfHeaderName="X-CSRF-TOKEN",e.defaults.xsrfCookieName="CSRF-TOKEN"}]).run(["$rootScope","$timeout","$translate","$location","$http","$window",function(e,t){e.alerts={queue:[]},e.showAlert=function(o){o.queue.length>0?(o.current=o.queue.shift(),o.timeout=t(function(){0==o.queue.length?(o.current=void 0,o.timeout=void 0):e.showAlert(o)},"error"==o.current.type?5e3:1e3)):e.alerts.current=void 0},e.addAlert=function(t,o){var n={message:t,type:o};e.alerts.timeout?e.alerts.queue.push(n):(e.alerts.queue.push(n),e.showAlert(e.alerts))},e.dismissAlert=function(){e.alerts.timeout?(t.cancel(e.alerts.timeout),e.alerts.timeout=void 0,e.showAlert(e.alerts)):e.alerts.current=void 0},e.addAlertPromise=function(t,o){t&&t.then(function(t){e.addAlert(t,o)})}}]),angular.module("activitiApp").service("IdmService",["$http","$q","$rootScope",function(e,t){var o=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getIdmInfo=function(){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/idm-info"})},this.getProfile=function(){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/profile"})},this.updateProfileDetails=function(o,n,r){var a=t.defer();e({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/profile",data:o}).success(function(e){n&&n(e),a.resolve(e)}).error(function(e,t){r&&r(e,t),a.reject(e)});var i=a.promise;return i},this.changePassword=function(e,t){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/profile-password",data:{oldPassword:e,newPassword:t}})},this.getTenants=function(){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tenants"})},this.getTenant=function(e){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tenants/"+e})},this.createTenant=function(e){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tenants",data:e})},this.updateTenant=function(e,t){return o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tenants/"+e,data:{name:t.name,domain:t.domain,maxUsers:t.maxUsers,active:t.active}})},this.deleteTenant=function(e){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tenants/"+e})},this.getTenantEvents=function(e){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/tenants/"+e+"/events"})},this.getTenantUsers=function(e,t){var n={};return n.status="active",null!==e&&void 0!==e&&(n.filter=e),null!==t&&void 0!==t&&t>-1&&(n.tenantId=t),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/users",params:n})},this.getGroups=function(e){var t={};return null!==e&&void 0!==e&&e>-1&&(t.tenantId=e),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups",params:t})},this.getFunctionalGroups=function(e){var t={};return null!==e&&void 0!==e&&e>-1&&(t.tenantId=e),t.functional="true",o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups",params:t})},this.getGroup=function(e,t,n){var r={};return null!==t&&void 0!==t&&(r.includeAllUsers=t),null!==n&&void 0!==n&&(r.includeManager=n),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e,params:r})},this.getUsersForGroup=function(e,t,n,r){var a={};return null!==t&&void 0!==t&&(a.filter=t),null!==n&&void 0!==n&&(a.page=n),null!==r&&void 0!==r&&(a.pageSize=r),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/users",params:a})},this.getGroupsForSystemGroup=function(e){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/related-groups"})},this.addGroupToSystemGroup=function(e,t){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/related-groups/"+t,params:{type:"system-to-functional"}})},this.deleteGroupFromSystemGroup=function(e,t){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/related-groups/"+t})},this.createGroup=function(e,t,n,r){return null!==t&&void 0!==t&&-1!==t&&(e.tenantId=t),n&&n>=0&&(e.type=n),null!==r&&void 0!==r&&(e.parentGroupId=r),o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups",data:e})},this.updateGroup=function(e,t,n){var r={name:n.name};return null!==t&&void 0!==t&&-1!==t&&(r.tenantId=t),o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e,data:r})},this.deleteGroup=function(e){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e})},this.activateGroup=function(e){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/action/activate"})},this.deleteGroupMember=function(e,t){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/members/"+t})},this.addAllUsers=function(e){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/add-all-users"})},this.addGroupMember=function(e,t){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/members/"+t})},this.addGroupManager=function(e,t){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/manager/"+t})},this.removeGroupManager=function(e,t){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/manager/"+t})},this.getPotentialCapabilities=function(e){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/potential-capabilities"})},this.deleteGroupCapability=function(e,t){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/capabilities/"+t})},this.addGroupCapabilities=function(e,t){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/groups/"+e+"/capabilities",data:{capabilities:t}})},this.getAllTenantConfigs=function(e){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/tenant-config",params:{tenantId:e}})},this.getTenantConfigProperty=function(e,t){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/tenant-config",params:{tenantId:e,propertyKey:t}})},this.createTenantConfig=function(e){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/tenant-config",data:e})},this.updateTenantConfig=function(e){return o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/tenant-config/"+e.id,data:e})},this.deleteTenantConfig=function(e){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/tenant-config/"+e.id})},this.getAllAlfrescoRepositories=function(e,t){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco",params:{tenantId:e,includeAccounts:t}})},this.createAlfrescoRepository=function(e){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco",data:e})},this.updateAlfrescoRepository=function(e){return o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+e.id,data:e})},this.deleteAlfrescoRepository=function(e){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+e.id})},this.createAlfrescoRepositoryAccount=function(e,t,n){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+e+"/account",data:{username:t,password:n}})},this.updateAlfrescoRepositoryAccount=function(e,t,n){return o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+e+"/account",data:{username:t,password:n}})},this.deleteAlfrescoRepositoryAccount=function(e){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/alfresco/"+e+"/account"})},this.createBoxRepositoryAccount=function(e,t,n){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/box/"+e+"/account",data:{username:t,password:n}})},this.updateBoxRepositoryAccount=function(e,t,n){return o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/box/"+e+"/account",data:{username:t,password:n}})},this.deleteBoxRepositoryAccount=function(e){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/box/"+e+"/account"})},this.loadBoxRepositoryAccount=function(e){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/box/"+e+"/account"})},this.checkBoxRepositoryIsEnabled=function(){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/integration/box/status"})},this.getAllBasicAuthentications=function(e){var t={};return null!==e&&void 0!==e&&e>-1&&(t.tenantId=e),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/basic-auths",params:t})},this.createBasicAuthentication=function(e,t){return e.tenantId=t,o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/basic-auths",data:e})},this.updateBasicAuthentication=function(e,t){var n={tenantId:t,name:e.name,username:e.username,password:e.password};return o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin//basic-auths/"+e.id,data:n})},this.removeBasicAuthConfiguration=function(e,t){var n={};return null!==t&&void 0!==t&&t>-1&&(n.tenantId=t),o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/basic-auths/"+e,params:n})},this.getAllEndpointConfigurations=function(e){var t={};return null!==e&&void 0!==e&&e>-1&&(t.tenantId=e),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/endpoints",params:t})},this.removeEndpointConfiguration=function(e,t){var n={};return null!==t&&void 0!==t&&t>-1&&(n.tenantId=t),o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/endpoints/"+e,params:n})},this.createEndpointConfiguration=function(e,t){return e.tenantId=t,o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/endpoints",data:e})},this.updateEndpointConfiguration=function(e,t){return e.tenantId=t,o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/endpoints/"+e.id,data:e})},this.getAllDataSources=function(e){var t={};return null!==e&&void 0!==e&&e>-1&&(t.tenantId=e),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/data-sources",params:t})},this.removeDataSource=function(e,t){var n={};return null!==t&&void 0!==t&&t>-1&&(n.tenantId=t),o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/data-sources/"+e,params:n})},this.createDataSource=function(e,t){return e.tenantId=t,o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/data-sources",data:e})},this.updateDataSource=function(e,t){return e.tenantId=t,o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/data-sources/"+e.id,data:e})},this.checkDataSource=function(e){return o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/data-sources/test-data-source",data:e})}}]),activitiApp.controller("IdmTenantMgmtController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","IdmService",function(e,t,o,n,r,a,i,l){var d=!0,s=!1;e.hasTenantManagementCapability()||(e.hasTenantAdminCapability()?s=!0:(d=!1,a.path("/profile"))),t.alfrescoRepositories={data:[]},t.versions=[{id:null,label:""},{id:"4.0",label:"4.0"},{id:"4.1",label:"4.1"},{id:"4.2",label:"4.2 (or higher)"}],t.model={loading:!0,lockTenant:s,currentTab:"logo"},t.showCreateTenantPopup=function(){t.model.editedTenant={active:!0,maxUsers:10},_internalCreateModal({scope:t,template:"views/popup/idm-tenant-create.html",show:!0},i,t)},t.loadAlfrescoRepositories=function(){var e=t.model.selectedTenant.id;t.alfrescoRepositories.data.length=0,l.getAllAlfrescoRepositories(e).then(function(e){for(var o=0;e.data.length>o;o++)t.alfrescoRepositories.data.push(e.data[o])})},t.isSaveTenantButtonEnabled=function(){return null!==t.model.editedTenant.name&&void 0!==t.model.editedTenant.name&&t.model.editedTenant.name.length>0&&null!==t.model.editedTenant.maxUsers&&t.model.editedTenant.maxUsers},t.saveTenant=function(){t.model.editedTenant.id?(t.model.loadingTenant=!0,l.updateTenant(t.model.editedTenant.id,t.model.editedTenant).then(function(e){t.selectTenant(e.id);for(var o=0;t.model.tenants.length>o;o++)t.model.tenants[o].id===e.id&&(t.model.tenants[o].name=e.name);t.model.loadingTenant=!1})):(t.model.loading=!0,l.createTenant(t.model.editedTenant).then(function(e){u(e.id),t.model.loading=!1}))},t.selectTenant=function(e){t.selectedAlfrescoRepository=void 0,t.selectedAlfrescoRepositoryClone=void 0,t.selectedBasicAuthConfiguration=void 0,t.selectedBasicAuthConfigurationClone=void 0,t.selectedEndpointConfiguration=void 0,t.selectedEndpointConfigurationClone=void 0,t.model.currentTab="logo",t.model.loadingTenant=!0,t.model.selectedTenant=void 0,t.model.tenantEvents=[],l.getTenant(e).then(function(e){t.model.selectedTenant=e,t.model.loadingTenant=!1,t.model.selectedTenantId=e.id,t.loadAlfrescoRepositories()})},t.showDeleteTenantModal=function(){_internalCreateModal({scope:t,template:"views/popup/idm-delete-tenant.html",show:!0},i,t)},t.showEditTenantModal=function(){t.model.editedTenant=t.model.selectedTenant,_internalCreateModal({scope:t,template:"views/popup/idm-tenant-create.html",show:!0},i,t)},t.showUploadTenantLogoModal=function(){_internalCreateModal({scope:t,template:"views/popup/idm-tenant-logo-upload.html",show:!0},i,t)},t.deleteTenant=function(){t.model.loadingTenant=!0,l.deleteTenant(t.model.selectedTenant.id).then(function(){t.model.loadingTenant=!1,c(),u()})};var c=function(){delete t.model.tenants,delete t.model.selectedTenant},u=function(e){null!==t.model.tenants&&void 0!==t.model.tenants&&(t.model.tenants.length=0),t.model.loading=!0,l.getTenants().then(function(o){if(t.model.tenants=o,e)for(var n=0;o.length>n;n++)o[n].id===e&&t.selectTenant(e);else t.model.lockTenant&&o.length>0&&t.selectTenant(o[0].id);t.model.loading=!1})};d&&u(),t.selectedAlfrescoRepository=void 0,t.selectedAlfrescoRepositoryClone=void 0;var p=o.instant("IDM.TENANT-MGMT.ALFRESCO-REPO-ID"),m=o.instant("IDM.TENANT-MGMT.ALFRESCO-REPO-NAME"),f=o.instant("IDM.TENANT-MGMT.ALFRESCO-REPO-TENANT"),g=o.instant("IDM.TENANT-MGMT.ALFRESCO-REPO-URL"),h=[{field:"id",displayName:p,allowCellFocus:!1},{field:"name",displayName:m,allowCellFocus:!1},{field:"alfrescoTenantId",displayName:f,allowCellFocus:!1},{field:"repositoryUrl",displayName:g,allowCellFocus:!1}];t.gridOptionsAlfrescoRepositories={data:t.alfrescoRepositories.data,headerRowHeight:28,enableRowSelection:!0,enableCellSelection:!1,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,columnDefs:h},t.gridOptionsAlfrescoRepositories.onRegisterApi=function(e){t.gridApiAlfrescoRepositories=e,e.selection.on.rowSelectionChanged(t,function(e){e.isSelected?(t.selectedAlfrescoRepository=e.entity,t.selectedAlfrescoRepositoryClone={id:e.entity.id,name:e.entity.name,alfrescoTenantId:e.entity.alfrescoTenantId,repositoryUrl:e.entity.repositoryUrl,shareUrl:e.entity.shareUrl,version:e.entity.version},t.focusFirstFieldAlfrescoRepository()):(t.selectedAlfrescoRepository=void 0,t.selectedAlfrescoRepositoryClone=void 0)})},t.focusFirstFieldAlfrescoRepository=function(){r(function(){var e=document.getElementById("alfrescoRepoNameField");e&&e.focus()},100)},t.showAddNewAlfrescoRepository=function(){t.editAlfrescoRepository={name:"",tenantId:t.model.selectedTenant.id,alfrescoTenantId:"",repositoryUrl:"",shareUrl:"",version:""},t.gridApiAlfrescoRepositories.selection.clearSelectedRows(),_internalCreateModal({scope:t,template:"views/popup/idm-tenant-repo-create.html",show:!0},i,t)},t.showEditAlfrescoRepository=function(){t.editAlfrescoRepository={id:t.selectedAlfrescoRepository.id,name:t.selectedAlfrescoRepository.name,tenantId:t.selectedAlfrescoRepository.tenantId,alfrescoTenantId:t.selectedAlfrescoRepository.alfrescoTenantId,repositoryUrl:t.selectedAlfrescoRepository.repositoryUrl,shareUrl:t.selectedAlfrescoRepository.shareUrl,useShareConnector:t.selectedAlfrescoRepository.useShareConnector,secret:null,version:t.selectedAlfrescoRepository.version},t.shareConnectorSecretPlaceholder=t.selectedAlfrescoRepository.useShareConnector?"IDM.TENANT-MGMT.ALFRESCO-REPO-SECRET-PLACEHOLDER":"",t.gridApiAlfrescoRepositories.selection.clearSelectedRows(),_internalCreateModal({scope:t,template:"views/popup/idm-tenant-repo-create.html",show:!0},i,t)},t.removeAlfrescoRepository=function(){t.selectedAlfrescoRepository&&l.deleteAlfrescoRepository(t.selectedAlfrescoRepository).then(function(){var e=t.alfrescoRepositories.data.indexOf(t.selectedAlfrescoRepository);t.gridApiAlfrescoRepositories.selection.toggleRowSelection(t.selectedAlfrescoRepository),t.alfrescoRepositories.data.splice(e,1),r(function(){t.alfrescoRepositories.data.length>0?t.gridApiAlfrescoRepositories.selection.toggleRowSelection(t.alfrescoRepositories.data[0]):t.selectedAlfrescoRepository=void 0})})},t.createOrUpdateAlfrescoRepository=function(e){e.id?l.updateAlfrescoRepository(e).then(function(e){t.selectedAlfrescoRepository.name=e.name,t.selectedAlfrescoRepository.alfrescoTenantId=e.alfrescoTenantId,t.selectedAlfrescoRepository.repositoryUrl=e.repositoryUrl,t.selectedAlfrescoRepository.shareUrl=e.shareUrl,t.selectedAlfrescoRepository.useShareConnector=e.useShareConnector,t.selectedAlfrescoRepository.version=e.version}):l.createAlfrescoRepository(e).then(function(o){e.id=o.id,t.alfrescoRepositories.data.push(e),t.gridApiAlfrescoRepositories.selection.clearSelectedRows(),r(function(){t.gridApiAlfrescoRepositories.selection.toggleRowSelection(e)})})}}]),activitiApp.controller("UploadTenantLogoController",["$rootScope","$scope","Upload","$modal",function(e,t,o){t.popup={loading:!1},t.onFileSelect=function(e,n){for(var r=0;e.length>r;r++){var a,i=e[r];a=n?ACTIVITI.CONFIG.contextRoot+"/app/rest/tenants/"+t.model.selectedTenant.id+"/logo/text":ACTIVITI.CONFIG.contextRoot+"/app/rest/tenants/"+t.model.selectedTenant.id+"/logo",o.upload({url:a,method:"POST",file:i}).progress(function(e){t.popup.loading=!0,t.popup.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(e){t.popup.loading=!1,t.model.selectedTenant.logoImageId=e.id,t.$hide(),t.selectTenant(t.model.selectedTenant.id)}).error(function(e){e&&e.message&&(t.popup.errorMessage=e.message),t.popup.error=!0,t.popup.loading=!1})}},t.cancel=function(){t.popup.loading||t.$hide()}}]),activitiApp.controller("EndpointConfiguratorController",["$rootScope","$scope","$translate","$timeout","$modal","IdmService",function(e,t,o,n,r,a){t.selectedBasicAuthConfiguration=void 0,t.basicAuthConfigurations=[],t.loadBasicAuthentications=function(){t.loadingBasicAuths=!0,t.basicAuthConfigurations.length=0,a.getAllBasicAuthentications(t.model.selectedTenant.id).then(function(e){for(var o=0;e.length>o;o++)t.basicAuthConfigurations.push(e[o]);t.loadingBasicAuths=!1})};var i=o.instant("IDM.TENANT-MGMT.ENDPOINT_CONFIGURATOR.BASIC-AUTH-NAME-HEADER"),l=o.instant("IDM.TENANT-MGMT.ENDPOINT_CONFIGURATOR.BASIC-AUTH-USERNAME-HEADER"),d=[{field:"name",displayName:i,allowCellFocus:!1},{field:"username",displayName:l,allowCellFocus:!1}];t.gridOptionsBasicAuth={data:t.basicAuthConfigurations,headerRowHeight:28,enableRowSelection:!0,enableCellSelection:!1,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,columnDefs:d},t.gridOptionsBasicAuth.onRegisterApi=function(e){t.gridApiBasicAuth=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedBasicAuthConfiguration=e.isSelected?e.entity:void 0})},t.showAddNewBasicAuthConfiguration=function(){t.gridApiBasicAuth.selection.clearSelectedRows(),t.editBasicAuthConfiguration={name:"",username:"",password:""},_internalCreateModal({scope:t,template:"views/popup/idm-tenant-basicauth-edit.html",show:!0},r,t)},t.showEditBasicAuthConfiguration=function(){t.editBasicAuthConfiguration={id:t.selectedBasicAuthConfiguration.id,name:t.selectedBasicAuthConfiguration.name,username:t.selectedBasicAuthConfiguration.username},t.gridApiBasicAuth.selection.clearSelectedRows(),_internalCreateModal({scope:t,template:"views/popup/idm-tenant-basicauth-edit.html",show:!0},r,t)},t.removeBasicAuthConfiguration=function(){t.selectedBasicAuthConfiguration&&a.removeBasicAuthConfiguration(t.selectedBasicAuthConfiguration.id,t.model.selectedTenant.id).then(function(){var e=t.basicAuthConfigurations.indexOf(t.selectedBasicAuthConfiguration);t.gridApiBasicAuth.selection.toggleRowSelection(t.selectedBasicAuthConfiguration),t.basicAuthConfigurations.splice(e,1),n(function(){t.basicAuthConfigurations.length>0?t.gridApiBasicAuth.selection.toggleRowSelection(t.basicAuthConfigurations[0]):t.selectedBasicAuthConfiguration=void 0})})},t.createOrUpdateBasicAuthConfiguration=function(e){e.id?a.updateBasicAuthentication(e,t.model.selectedTenant.id).then(function(e){t.selectedBasicAuthConfiguration.name=e.name,t.selectedBasicAuthConfiguration.username=e.username,n(function(){t.gridApiBasicAuth.selection.toggleRowSelection(t.selectedBasicAuthConfiguration)});for(var o=0;t.endpointConfigurations.length>o;o++)t.endpointConfigurations[o].basicAuthId===e.id&&(t.endpointConfigurations[o].basicAuthName=e.name)}):a.createBasicAuthentication(e,t.model.selectedTenant.id).then(function(o){e.id=o.id,t.basicAuthConfigurations.push(e),t.gridApiBasicAuth.selection.clearSelectedRows(),n(function(){t.gridApiBasicAuth.selection.toggleRowSelection(e)})})},t.loadBasicAuthentications(),t.selectedEndpointConfiguration=void 0,t.endpointConfigurations=[];var s=[];s.nameLabel=o.instant("IDM.TENANT-MGMT.ENDPOINT_CONFIGURATOR.ENDPOINT-NAME-HEADER"),s.protocolLabel=o.instant("IDM.TENANT-MGMT.ENDPOINT_CONFIGURATOR.ENDPOINT-PROTOCOL-HEADER"),s.hostLabel=o.instant("IDM.TENANT-MGMT.ENDPOINT_CONFIGURATOR.ENDPOINT-HOST-HEADER"),s.portLabel=o.instant("IDM.TENANT-MGMT.ENDPOINT_CONFIGURATOR.ENDPOINT-PORT-HEADER"),s.pathLabel=o.instant("IDM.TENANT-MGMT.ENDPOINT_CONFIGURATOR.ENDPOINT-PATH-HEADER"),s.basicAuthLabel=o.instant("IDM.TENANT-MGMT.ENDPOINT_CONFIGURATOR.ENDPOINT-BASIC-AUTH-HEADER");var c=[{field:"name",displayName:s.nameLabel,allowCellFocus:!1},{field:"host",displayName:s.hostLabel,allowCellFocus:!1},{field:"path",displayName:s.pathLabel,allowCellFocus:!1},{field:"basicAuthName",displayName:s.basicAuthLabel,allowCellFocus:!1}];t.gridOptionsEndpoint={data:t.endpointConfigurations,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,columnDefs:c},t.gridOptionsEndpoint.onRegisterApi=function(e){t.gridApiEndpoint=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedEndpointConfiguration=e.isSelected?e.entity:void 0})},t.showAddNewEndpointConfiguration=function(){t.gridApiEndpoint.selection.clearSelectedRows(),t.editEndpointConfiguration={name:"",protocol:"HTTPS",host:"",port:"",path:"",basicAuthId:"",basicAuthName:"",requestHeaders:[]},_internalCreateModal({scope:t,template:"views/popup/idm-tenant-endpoint-edit.html",show:!0},r,t)},t.showEditEndpointConfiguration=function(){t.gridApiEndpoint.selection.clearSelectedRows(),t.editEndpointConfiguration={id:t.selectedEndpointConfiguration.id,name:t.selectedEndpointConfiguration.name,protocol:t.selectedEndpointConfiguration.protocol,host:t.selectedEndpointConfiguration.host,port:t.selectedEndpointConfiguration.port,path:t.selectedEndpointConfiguration.path,basicAuthId:t.selectedEndpointConfiguration.basicAuthId,basicAuthName:t.selectedEndpointConfiguration.basicAuthName,requestHeaders:t.selectedEndpointConfiguration.requestHeaders},_internalCreateModal({scope:t,template:"views/popup/idm-tenant-endpoint-edit.html",show:!0},r,t)},t.removeEndpointConfiguration=function(){t.selectedEndpointConfiguration&&a.removeEndpointConfiguration(t.selectedEndpointConfiguration.id,t.model.selectedTenant.id).then(function(){var e=t.endpointConfigurations.indexOf(t.selectedEndpointConfiguration);t.gridApiEndpoint.selection.toggleRowSelection(t.selectedEndpointConfiguration),t.endpointConfigurations.splice(e,1),n(function(){t.endpointConfigurations.length>0?t.gridApiEndpoint.selection.toggleRowSelection(t.endpointConfigurations[0]):t.selectedEndpointConfiguration=void 0})})},t.loadEndpointConfigurations=function(){t.loadingEndpointConfigurations=!0,t.endpointConfigurations.length=0,a.getAllEndpointConfigurations(t.model.selectedTenant.id).then(function(e){for(var o=0;e.length>o;o++)t.endpointConfigurations.push(e[o]);t.loadingEndpointConfigurations=!1})},t.createOrUpdateEndpointConfiguration=function(e){if(e.requestHeaders&&e.requestHeaders.length>0){for(var o=[],r=0;e.requestHeaders.length>r;r++)e.requestHeaders[r].name&&""!==e.requestHeaders[r].name&&o.push(e.requestHeaders[r]);e.requestHeaders=o}e.id?(a.updateEndpointConfiguration(e,t.model.selectedTenant.id).then(function(e){t.selectedEndpointConfiguration.name=e.name,t.selectedEndpointConfiguration.protocol=e.protocol,t.selectedEndpointConfiguration.host=e.host,t.selectedEndpointConfiguration.port=e.port,t.selectedEndpointConfiguration.path=e.path,t.selectedEndpointConfiguration.basicAuthId=e.basicAuthId,t.selectedEndpointConfiguration.basicAuthName=e.basicAuthName,t.selectedEndpointConfiguration.requestHeaders=e.requestHeaders}),n(function(){t.gridApiEndpoint.selection.toggleRowSelection(t.selectedEndpointConfiguration)})):a.createEndpointConfiguration(e,t.model.selectedTenant.id).then(function(o){e.id=o.id,e.basicAuthName=o.basicAuthName,t.endpointConfigurations.push(e),t.gridApiEndpoint.selection.clearSelectedRows(),n(function(){t.gridApiEndpoint.selection.toggleRowSelection(e)})})},t.endPointProtocols=[{id:"HTTP",label:"HTTP"},{id:"HTTPS",label:"HTTPS"}],t.loadEndpointConfigurations()}]),activitiApp.controller("IdmTenantEventController",["$rootScope","$scope","$modal","IdmService",function(e,t,o,n){t.model.loadingTenantEvents=!0,n.getTenantEvents(t.model.selectedTenant.id).then(function(e){t.model.tenantEvents=e,t.model.loadingTenantEvents=!1})}]),activitiApp.controller("IdmDocumentTemplateController",["$rootScope","$scope","$modal","Upload","$timeout","DocumentTemplateService",function(e,t,o,n,r,a){t.documentTemplateModel={nameFilter:"",sort:"sort_by_name_asc",page:0,pageSize:50,possibleSorts:[{id:"sort_by_name_asc",title:"IDM.TENANT-MGMT.DOCUMENT-TEMPLATE.SORT-NAME-ASC"},{id:"sort_by_name_desc",title:"IDM.TENANT-MGMT.DOCUMENT-TEMPLATE.SORT-NAME-DESC"},{id:"sort_by_create_date_asc",title:"IDM.TENANT-MGMT.DOCUMENT-TEMPLATE.SORT-CREATED-ASC"},{id:"sort_by_create_date_desc",title:"IDM.TENANT-MGMT.DOCUMENT-TEMPLATE.SORT-CREATED-DESC"}]};
var i=function(){t.documentTemplateModel.loadingDocumentTemplates=!0,a.findAllDocumentTemplates(t.model.selectedTenant.id,t.documentTemplateModel.nameFilter,t.documentTemplateModel.sort,t.documentTemplateModel.page,t.documentTemplateModel.pageSize).then(function(e){t.documentTemplateModel.templates=e,t.documentTemplateModel.moreTemplates=e.total>(t.documentTemplateModel.page+1)*t.documentTemplateModel.pageSize;for(var o=0;t.documentTemplateModel.templates.data.length>o;o++)t.documentTemplateModel.templates.data[o].downloadUrl=ACTIVITI.CONFIG.contextRoot+"/app/rest/document-templates/"+t.documentTemplateModel.templates.data[o].id+"/file?version="+Date.now();t.documentTemplateModel.loadingDocumentTemplates=!1})};t.showUploadTemplateModal=function(){t.documentTemplateModel.selectedDocumentTemplate=void 0,t.showUploadTemplateModalInternal()},t.showUploadTemplateModalInternal=function(){t.documentTemplateModel.error=void 0,t.documentTemplateModel.errorMessage=void 0,t.uploadNewPopup=_internalCreateModal({template:"views/popup/upload-new-document-template.html?version="+Date.now(),scope:t},o,t)},t.cancelUploadNew=function(){t.uploadNewPopup.$scope.$hide(),t.documentTemplateModel.selectedDocumentTemplate=void 0},t.sortChanged=function(){t.documentTemplateModel.page=0,i()},t.refreshDelayed=function(){t.model.waiting?t.model.delayed=!0:t.scheduleDelayedRefresh()},t.scheduleDelayedRefresh=function(){t.model.waiting=!0,r(function(){t.model.waiting=!1,t.model.delayed?(t.model.delayed=!1,t.scheduleDelayedRefresh()):(t.documentTemplateModel.page=0,i())},100)},t.onNewUploadSelected=function(e,o){for(var r=0;e.length>r;r++){var a=e[r],l=a.name.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"}),d=ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/document-templates";null!==t.documentTemplateModel.selectedDocumentTemplate&&void 0!==t.documentTemplateModel.selectedDocumentTemplate&&(d+="/"+t.documentTemplateModel.selectedDocumentTemplate.id),o&&(d+="/text"),n.upload({url:d,method:"POST",params:{tenantId:t.model.selectedTenant.id},file:a,fileName:l}).progress(function(e){t.model.loading=!0,t.model.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(){t.documentTemplateModel.sort="sort_by_create_date_desc",t.documentTemplateModel.page=0,i(),t.model.loading=!1,t.uploadNewPopup.$scope.$hide()}).error(function(e){e&&e.message&&(t.documentTemplateModel.errorMessage=e.message),t.documentTemplateModel.error=!0,t.model.loading=!1})}},t.showPreviousTemplates=function(){t.documentTemplateModel.page--,i()},t.showNextTemplates=function(){t.documentTemplateModel.page++,i()},t.showUploadNewDocumentTemplateVersion=function(e){t.documentTemplateModel.selectedDocumentTemplate=e,t.showUploadTemplateModalInternal()},t.showDeleteTemplateModal=function(e){t.documentTemplateModel.documentTemplateToDelete=e,_internalCreateModal({scope:t,template:"views/popup/delete-document-template.html?version="+Date.now(),show:!0},o,t)},t.deleteDocumentTemplate=function(){a.deleteDocumentTemplate(t.documentTemplateModel.documentTemplateToDelete.id).then(function(){t.documentTemplateModel.documentTemplateToDelete=void 0,i()})},i()}]),activitiApp.controller("IdmEmailTemplateController",["$rootScope","$scope","$modal","$q","$timeout","$http",function(e,t,o,n,r,a){function i(){d({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/email-templates/system",params:{tenantId:t.model.selectedTenant.id}}).then(function(e){t.emailTemplateModel.systemTemplates=e})}function l(){t.emailTemplateModel.loadingEmailTemplates=!0,d({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/email-templates/custom",params:{tenantId:t.model.selectedTenant.id,nameFilter:t.emailTemplateModel.nameFilter,start:t.emailTemplateModel.page,size:t.emailTemplateModel.pageSize,sort:t.emailTemplateModel.sort}}).then(function(e){t.emailTemplateModel.loadingEmailTemplates=!1,t.emailTemplateModel.templates=e,t.emailTemplateModel.moreTemplates=e.total>(t.emailTemplateModel.page+1)*t.emailTemplateModel.pageSize})}t.emailTemplateModel={activeTab:"system",nameFilter:"",sort:"sort_by_name_asc",page:0,pageSize:50,possibleSorts:[{id:"sort_by_name_asc",title:"IDM.TENANT-MGMT.EMAIL-TEMPLATE.SORT-NAME-ASC"},{id:"sort_by_name_desc",title:"IDM.TENANT-MGMT.EMAIL-TEMPLATE.SORT-NAME-DESC"},{id:"sort_by_create_date_asc",title:"IDM.TENANT-MGMT.EMAIL-TEMPLATE.SORT-CREATED-ASC"},{id:"sort_by_create_date_desc",title:"IDM.TENANT-MGMT.EMAIL-TEMPLATE.SORT-CREATED-DESC"}]};var d=function(e){var t=n.defer();return a(e).success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise};t.refreshDelayed=function(){t.model.waiting?t.model.delayed=!0:t.scheduleDelayedRefresh()},t.scheduleDelayedRefresh=function(){t.model.waiting=!0,r(function(){t.model.waiting=!1,t.model.delayed?(t.model.delayed=!1,t.scheduleDelayedRefresh()):(t.emailTemplateModel.page=0,l())},100)},t.showPreviousTemplates=function(){t.emailTemplateModel.page--,l()},t.showNextTemplates=function(){t.emailTemplateModel.page++,l()},t.sortChanged=function(){t.emailTemplateModel.page=0,l()},t.showEditTemplate=function(e){t.emailTemplateModel.errorMessage=void 0;var n=ACTIVITI.CONFIG.contextRoot+"/app/rest/email-templates/";t.emailTemplateModel.errorMessage=void 0,n+=e.systemTemplateId?"system/"+e.systemTemplateId:"custom/"+e.id,d({method:"GET",url:n,params:{tenantId:t.model.selectedTenant.id}}).then(function(e){t.emailTemplateModel.selectedTemplate=e,t.editPopup=_internalCreateModal({template:"views/popup/edit-email-template.html?version="+Date.now(),scope:t},o,t)})},t.showCreateTemplate=function(){t.emailTemplateModel.error=void 0,t.emailTemplateModel.errorMessage=void 0,t.emailTemplateModel.selectedTemplate={tenantId:t.model.selectedTenant.id},t.editPopup=_internalCreateModal({template:"views/popup/edit-email-template.html?version="+Date.now(),scope:t},o,t)},t.updateTemplate=function(){var e=ACTIVITI.CONFIG.contextRoot+"/app/rest/email-templates/",o="PUT";t.emailTemplateModel.selectedTemplate.systemTemplateId?e+="system/"+t.emailTemplateModel.selectedTemplate.systemTemplateId:(e+="custom",t.emailTemplateModel.selectedTemplate.id?e+="/"+t.emailTemplateModel.selectedTemplate.id:o="POST"),a({method:o,url:e,data:t.emailTemplateModel.selectedTemplate}).success(function(){t.editPopup.$scope.$hide(),t.editPopup=void 0,t.emailTemplateModel.selectedTemplate.systemTemplateId?i():l()}).error(function(e){t.emailTemplateModel.errorMessage=e.message})},t.resetTemplate=function(){d({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/email-templates/system/"+t.emailTemplateModel.selectedTemplate.systemTemplateId,params:{tenantId:t.model.selectedTenant.id}}).then(function(e){t.emailTemplateModel.selectedTemplate=e,i()})},t.showDeleteTemplate=function(e){t.emailTemplateModel.emailTemplateToDelete=e,_internalCreateModal({scope:t,template:"views/popup/delete-email-template.html?version="+Date.now(),show:!0},o,t)},t.deleteEmailTemplate=function(){d({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/email-templates/custom/"+t.emailTemplateModel.emailTemplateToDelete.id,params:{tenantId:t.model.selectedTenant.id}}).then(function(){l()})},i(),l()}]),activitiApp.controller("IdmTenantConfigController",["$rootScope","$scope","$modal","Upload","$timeout","$translate","IdmService",function(e,t,o,n,r,a,i){t.tenantConfigs={data:[]},t.model.boxMetaDataSupport=!1,t.model.decisionTableValidation=!0,t.model.passwordMinLength=4,t.model.involvedUsersCanEditForms=!0,t.model.globalDateFormat="D-M-YYYY",t.loadTenantConfigs=function(){var e=t.model.selectedTenant.id;t.tenantConfigs.data.length=0,t.model.boxMetaDataSupportProperty={propertyKey:"boxMetaDataSupport",propertyValue:!1,tenantId:e},t.model.involvedUsersCanEditFormsProperty={propertyKey:"involved-users.can-edit-forms",propertyValue:!0,tenantId:e},t.model.decisionTableValidationProperty={propertyKey:"validator.editor.dmn.expression",propertyValue:!1,tenantId:e},t.model.passwordMinLengthProperty={propertyKey:"security.password.constraints.min-length",propertyValue:t.model.passwordMinLength,tenantId:e},t.model.globalDateFormatProperty={propertyKey:"global-date-format",propertyValue:t.model.globalDateFormat,tenantId:e},i.getAllTenantConfigs(e).then(function(e){for(var o=0;e.data.length>o;o++)"boxMetaDataSupport"===e.data[o].propertyKey?(t.model.boxMetaDataSupportProperty=e.data[o],t.model.boxMetaDataSupport=t.model.boxMetaDataSupportProperty.propertyValue):"involved-users.can-edit-forms"===e.data[o].propertyKey?(t.model.involvedUsersCanEditFormsProperty=e.data[o],t.model.involvedUsersCanEditForms=t.model.involvedUsersCanEditFormsProperty.propertyValue):"validator.editor.dmn.expression"===e.data[o].propertyKey?(t.model.decisionTableValidationProperty=e.data[o],t.model.decisionTableValidation=t.model.decisionTableValidationProperty.propertyValue):"security.password.constraints.min-length"===e.data[o].propertyKey?(t.model.passwordMinLengthProperty=e.data[o],t.model.passwordMinLength=t.model.passwordMinLengthProperty.propertyValue):"global-date-format"===e.data[o].propertyKey&&(t.model.globalDateFormatProperty=e.data[o],t.model.globalDateFormat=t.model.globalDateFormatProperty.propertyValue)})},t.updateBoxMetaDataSupport=function(){t.model.boxMetaDataSupportProperty.propertyValue=t.model.boxMetaDataSupport,t.createOrUpdateTenantConfig(t.model.boxMetaDataSupportProperty)},t.updateInvolvedUsersCanEditForms=function(){t.model.involvedUsersCanEditFormsProperty.propertyValue=t.model.involvedUsersCanEditForms,t.createOrUpdateTenantConfig(t.model.involvedUsersCanEditFormsProperty)},t.updateDecisionTableValidation=function(){t.model.decisionTableValidationProperty.propertyValue=t.model.decisionTableValidation,t.createOrUpdateTenantConfig(t.model.decisionTableValidationProperty)},t.updatePasswordMinLength=function(){t.model.passwordMinLengthProperty.propertyValue=t.model.passwordMinLength,t.createOrUpdateTenantConfig(t.model.passwordMinLengthProperty)},t.updateGlobalDateFormat=function(){t.model.globalDateFormatProperty.propertyValue=t.model.globalDateFormat,t.createOrUpdateTenantConfig(t.model.globalDateFormatProperty)},t.createOrUpdateTenantConfig=function(e){function o(e){"boxMetaDataSupport"===e.propertyKey?t.model.boxMetaDataSupportProperty=e:"involved-users.can-edit-forms"===e.propertyKey?t.model.involvedUsersCanEditFormsProperty=e:"validator.editor.dmn.expression"===e.propertyKey?t.model.decisionTableValidationProperty=e:"security.password.constraints.min-length"===e.propertyKey?t.model.passwordMinLengthProperty=e:"global-date-format"===e.propertyKey&&(t.model.globalDateFormatProperty=e)}if(e.id)i.updateTenantConfig(e).then(function(e){o(e)});else{var n={propertyKey:e.propertyKey,propertyValue:e.propertyValue,tenantId:t.model.selectedTenant.id};i.createTenantConfig(n).then(function(e){o(e)})}},t.loadTenantConfigs()}]),activitiApp.controller("EndpointRequestHeadersController",["$rootScope","$scope","$q","$translate","$http","$timeout","$location","$modal","$routeParams","$popover","uiGridConstants",function(e,t,o,n,r,a,i,l,d,s,c){t.selectedRequestHeaders=[],t.labels=[],t.showRequestHeaders=!0,t.editEndpointConfiguration.requestHeaders&&0!==t.editEndpointConfiguration.requestHeaders.length||(t.editEndpointConfiguration.requestHeaders=[],t.showRequestHeaders=!1),t.selectedRequestHeader=void 0,t.labels.nameLabel=n.instant("IDM.TENANT-MGMT.ENDPOINT_CONFIGURATOR.REQUEST-HEADER-NAME"),t.labels.valueLabel=n.instant("IDM.TENANT-MGMT.ENDPOINT_CONFIGURATOR.REQUEST-HEADER-VALUE"),t.gridOptions={data:t.editEndpointConfiguration.requestHeaders,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableColumnMenus:!1,enableSorting:!1,columnDefs:[{field:"name",displayName:t.labels.nameLabel,cellClass:function(e,t,o){return""===e.getCellValue(t,o)||0==e.getCellValue(t,o)?"dynamicTable-cellError":void 0}},{field:"value",displayName:t.labels.valueLabel,cellClass:function(e,t,o){return""===e.getCellValue(t,o)||0==e.getCellValue(t,o)?"dynamicTable-cellError":void 0}}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedRequestHeader=e.entity,t.focusFirstField()})},t.focusFirstField=function(){a(function(){var e=document.getElementById("headerName");e&&e.focus()},100)},t.$watch("selectedRequestHeader.name",function(){t.gridApi.core.notifyDataChange(c.dataChange.ALL)},!0),t.$watch("selectedRequestHeader.value",function(){t.gridApi.core.notifyDataChange(c.dataChange.ALL)},!0),t.removeDynamicTableOption=function(e){t.selectedRequestHeader.options.splice(e,1)},t.addNewDefinition=function(){var e={name:"",value:""};t.editEndpointConfiguration.requestHeaders.push(e),t.gridApi.selection.clearSelectedRows(),a(function(){t.gridApi.selection.toggleRowSelection(e)})},t.removeDefinition=function(){if(t.selectedRequestHeader){var e=t.editEndpointConfiguration.requestHeaders.indexOf(t.selectedRequestHeader);t.gridApi.selection.toggleRowSelection(t.selectedRequestHeader),t.editEndpointConfiguration.requestHeaders.splice(e,1),a(function(){t.editEndpointConfiguration.requestHeaders.length>0?t.gridApi.selection.toggleRowSelection(t.editEndpointConfiguration.requestHeaders[0]):t.selectedRequestHeader=void 0})}},t.moveDefinitionUp=function(){if(t.selectedRequestHeader){var e=t.editEndpointConfiguration.requestHeaders.indexOf(t.selectedRequestHeader);if(0!=e){var o=t.editEndpointConfiguration.requestHeaders[e];t.editEndpointConfiguration.requestHeaders.splice(e,1),t.gridApi.selection.clearSelectedRows(),a(function(){t.editEndpointConfiguration.requestHeaders.splice(e+-1,0,o),a(function(){t.gridApi.selection.toggleRowSelection(o)})})}}},t.moveDefinitionDown=function(){if(t.selectedRequestHeader){var e=t.editEndpointConfiguration.requestHeaders.indexOf(t.selectedRequestHeader);if(e!=t.editEndpointConfiguration.requestHeaders.length-1){var o=t.editEndpointConfiguration.requestHeaders[e];t.editEndpointConfiguration.requestHeaders.splice(e,1),t.gridApi.selection.clearSelectedRows(),a(function(){t.editEndpointConfiguration.requestHeaders.splice(e+1,0,o),a(function(){t.gridApi.selection.toggleRowSelection(o)})})}}}}]),activitiApp.controller("IdmDataSourceController",["$rootScope","$scope","$translate","$timeout","$modal","IdmService",function(e,t,o,n,r,a){t.selectedDataSource=void 0,t.dataSources=[];var i=[];i.nameLabel=o.instant("IDM.TENANT-MGMT.DATA-SOURCE.NAME"),i.jdbcUrlLabel=o.instant("IDM.TENANT-MGMT.DATA-SOURCE.JDBC-URL");var l=[{field:"name",displayName:i.nameLabel,allowCellFocus:!1},{field:"config.jdbcUrl",displayName:i.jdbcUrlLabel,allowCellFocus:!1}];t.gridOptionsDataSource={data:t.dataSources,headerRowHeight:28,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,columnDefs:l},t.gridOptionsDataSource.onRegisterApi=function(e){t.gridApiDataSource=e,e.selection.on.rowSelectionChanged(t,function(e){t.selectedDataSource=e.isSelected?e.entity:void 0})},t.hideChecker=function(){t.hideCheckResult=!0},t.showAddNewDataSource=function(){t.gridApiDataSource.selection.clearSelectedRows(),t.editDataSource={name:"",config:{jdbcUrl:"",driverClass:"",username:"",password:""}},_internalCreateModal({scope:t,template:"views/popup/idm-tenant-datasource-edit.html",show:!0},r,t)},t.showEditDataSource=function(){t.gridApiDataSource.selection.clearSelectedRows(),t.editDataSource={id:t.selectedDataSource.id,name:t.selectedDataSource.name,config:t.selectedDataSource.config},_internalCreateModal({scope:t,template:"views/popup/idm-tenant-datasource-edit.html",show:!0},r,t)},t.removeDataSource=function(){t.selectedDataSource&&a.removeDataSource(t.selectedDataSource.id,t.model.selectedTenant.id).then(function(){var e=t.dataSources.indexOf(t.selectedDataSource);t.gridApiDataSource.selection.toggleRowSelection(t.selectedDataSource),t.dataSources.splice(e,1),n(function(){t.dataSources.length>0?t.gridApiDataSource.selection.toggleRowSelection(t.dataSources[0]):t.selectedDataSource=void 0})})},t.checkDataSource=function(e){t.checkResultMessage=null,t.checkResultMessageColor=null,t.errorMessage=null,t.loading=!0,a.checkDataSource(e).then(function(e){e.connected===!0?(t.checkResultMessage=o.instant("IDM.TENANT-MGMT.DATA-SOURCE.SUCCESS"),t.checkResultMessageColor="green"):(t.checkResultMessage=o.instant("IDM.TENANT-MGMT.DATA-SOURCE.FAIL"),t.errorMessage=e.errorMessage,t.checkResultMessageColor="red"),t.loading=!1,t.hideCheckResult=!1})},t.loadDataSources=function(){t.loadingDataSources=!0,t.dataSources.length=0,a.getAllDataSources(t.model.selectedTenant.id).then(function(e){if(e.data)for(var o=0;e.data.length>o;o++)t.dataSources.push(e.data[o]);t.loadingDataSources=!1})},t.createOrUpdateDataSource=function(e){e.id?(a.updateDataSource(e,t.model.selectedTenant.id).then(function(e){t.selectedDataSource.name=e.name,t.selectedDataSource.config=e.config}),n(function(){t.gridApiDataSource.selection.toggleRowSelection(t.selectedDataSource)})):a.createDataSource(e,t.model.selectedTenant.id).then(function(o){e.id=o.id,e.name=o.name,t.dataSources.push(e),t.gridApiDataSource.selection.clearSelectedRows(),n(function(){t.gridApiDataSource.selection.toggleRowSelection(e)})})},t.loadDataSources()}]),activitiApp.controller("IdmUserMgmtController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","IdmService",function(e,t,o,n,r,a,i,l){if(e.hasTenantManagementCapability()||e.hasTenantAdminCapability()||a.path("/profile"),t.model={loading:!1,statusFilters:[{id:"all",name:o.instant("IDM.USER-MGMT.FILTERS.STATUS-ANY")},{id:"active",name:o.instant("IDM.USER-MGMT.FILTERS.STATUS-ACTIVE")},{id:"inactive",name:o.instant("IDM.USER-MGMT.FILTERS.STATUS-INACTIVE")},{id:"pending",name:o.instant("IDM.USER-MGMT.FILTERS.STATUS-PENDING")},{id:"deleted",name:o.instant("IDM.USER-MGMT.FILTERS.STATUS-DELETED")}],typeFilters:[{id:"all",name:o.instant("IDM.USER-MGMT.FILTERS.TYPE-ANY")},{id:"trial",name:o.instant("IDM.USER-MGMT.FILTERS.TYPE-TRIAL")},{id:"enterprise",name:o.instant("IDM.USER-MGMT.FILTERS.TYPE-ENTERPRISE")}],sorts:[{id:"createdDesc",name:o.instant("IDM.USER-MGMT.FILTERS.SORT-DATE-NEWEST")},{id:"createdAsc",name:o.instant("IDM.USER-MGMT.FILTERS.SORT-DATE-OLDEST")},{id:"emailAsc",name:o.instant("IDM.USER-MGMT.FILTERS.SORT-EMAIL-A")},{id:"emailDesc",name:o.instant("IDM.USER-MGMT.FILTERS.SORT-EMAIL-Z")}],waiting:!1,delayed:!1,selectedUsers:{},selectedUserCount:0,start:0},t.model.activeStatusFilter=t.model.statusFilters[0],t.model.activeTypeFilter=t.model.typeFilters[0],t.model.activeSort=t.model.sorts[0],t.loadUserSummary=function(){t.model.loading=!0;var o={};-1!==e.common.selectedTenantId&&(o.tenantId=e.common.selectedTenantId),n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/users/summary",params:o}).success(function(e){t.model.summary=e}).error(function(t,o){403==o&&e.backToLanding()})},t.clearSelectedUsers=function(){t.model.selectedUsers={},t.model.selectedUserCount=0},t.loadUsers=function(){t.clearSelectedUsers(),t.model.loading=!0;var o={status:t.model.activeStatusFilter.id,accountType:t.model.activeTypeFilter.id,filter:t.model.pendingFilterText,company:t.model.pendingCompanyText,sort:t.model.activeSort.id,start:t.model.start};-1!==e.common.selectedTenantId&&(o.tenantId=e.common.selectedTenantId),n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/users",params:o}).success(function(e){e.moreUsers=e.start+e.size<e.total,t.model.users=e,t.model.loading=!1}).error(function(e,o){t.model.loading=!1,403==o&&console.log("Forbidden!")})},t.refreshDelayed=function(){t.model.waiting?t.model.delayed=!0:t.scheduleDelayedRefresh()},t.scheduleDelayedRefresh=function(){t.model.waiting=!0,r(function(){t.model.waiting=!1,t.model.delayed?(t.model.delayed=!1,t.scheduleDelayedRefresh()):(t.model.start=0,t.loadUsers(),t.loadUserSummary())},100)},t.showNextUsers=function(){t.model.users&&(t.model.start=t.model.users.start+t.model.users.size,t.loadUsers())},t.showPreviousUsers=function(){t.model.users&&(t.model.start=Math.max(0,t.model.users.start-t.model.users.size),t.loadUsers())},t.activateStatusFilter=function(e){t.model.activeStatusFilter=e,t.model.start=0,t.loadUsers()},t.activateTypeFilter=function(e){t.model.activeTypeFilter=e,t.model.start=0,t.loadUsers()},t.activateSort=function(e){t.model.activeSort=e,t.model.start=0,t.loadUsers()},t.toggleUserSelection=function(e){t.model.selectedUsers[e.id]?(delete t.model.selectedUsers[e.id],t.model.selectedUserCount-=1):(t.model.selectedUsers[e.id]=!0,t.model.selectedUserCount+=1)},t.editUserStatus=function(){t.model.mode="status",_internalCreateModal({scope:t,template:"views/popup/idm-user-status-edit.html",show:!0},i,t)},t.addUser=function(){t.model.errorMessage=void 0,t.model.user=void 0,_internalCreateModal({scope:t,template:"views/popup/idm-user-create.html?version="+(new Date).getTime(),show:!0},i,t)},t.editUserAccountType=function(){t.model.mode="type",_internalCreateModal({scope:t,template:"views/popup/idm-user-type-edit.html",show:!0},i,t)},t.editUserDetails=function(){t.model.user=void 0;var e=t.getSelectedUsers();e&&1==e.length&&(t.model.user=e[0]),t.model.errorMessage=void 0,_internalCreateModal({scope:t,template:"views/popup/idm-user-create.html?version="+(new Date).getTime(),show:!0},i,t)},t.editUserPassword=function(){t.model.mode="password",_internalCreateModal({scope:t,template:"views/popup/idm-user-password-change.html",show:!0},i,t)},t.editUserPrimaryGroup=function(){t.model.mode="primaryGroup",_internalCreateModal({scope:t,template:"views/popup/idm-user-primary-group-change.html",show:!0},i,t)},t.editUserTenant=function(){t.model.mode="tenant",_internalCreateModal({scope:t,template:"views/popup/idm-user-tenant-change.html",show:!0},i,t)},t.getSelectedUsers=function(){for(var e=[],o=0;t.model.users.size>o;o++){var n=t.model.users.data[o];if(n)for(var r in t.model.selectedUsers)if(n.id==r){e.push(n);break}}return e},t.getTenantNameForUser=function(e){if(t.model.tenants&&e.tenantId)for(var o=0;t.model.tenants.length>o;o++)if(t.model.tenants[o].id===e.tenantId)return t.model.tenants[o].name;return""},t.hasTenantManagementCapability()){var d=function(){t.model.loading=!0,l.getTenants().then(function(n){if(t.model.tenants=[{id:-1,name:o.instant("IDM.GENERAL.NO-TENANT")}],e.common.selectedTenantId||(e.common.selectedTenantId=-1),n&&n.length>0)for(var r=0;n.length>r;r++)t.model.tenants.push(n[r]);t.model.loading=!1})};d()}else t.hasTenantAdminCapability&&(e.common.selectedTenantId=t.account.tenantId);t.loadUsers(),t.loadUserSummary()}]),activitiApp.controller("IdmCreateUserPopupController",["$rootScope","$scope","$http","$translate","IdmService","SystemPropertiesService",function(e,t,o,n,r,a){t.model.passwordConstraintMinValue=4,t.model.passwordRegularExpression="",(null===t.model.user||void 0===t.model.user)&&(t.model.user={status:t.model.statusFilters[1],type:t.model.typeFilters[2],tenantId:-1},t.hasTenantAdminCapability()&&(t.model.user.tenantId=e.common.selectedTenantId)),t.$watch("model.user.tenantId",function(e){t.model.loading=!0,a.getPasswordValidationConstraints(e).then(function(e){e&&(t.model.passwordConstraintMinValue=e.minLength,t.model.passwordRegularExpression=e.regularExpression,t.model.passwordCriteriaMessage=e.passwordCriteriaMessage?n.instant("IDM.PROFILE-MGMT.POPUP."+e.passwordCriteriaMessage):null,t.model.loading=!1)})}),t.checkPasswordMinLength=function(){var e=t.model.user&&(!t.model.user.password||t.model.user.password.length<t.model.passwordConstraintMinValue);return e&&(t.model.user.passwordErrorMessage=n.instant("IDM.PROFILE-MGMT.POPUP.CHANGE-PASSWORD-TOO-SHORT",{minLength:t.model.passwordConstraintMinValue})),e},t.checkPasswordRegEx=function(){var e=!1;return t.model.passwordRegularExpression&&(e=t.model.user&&(!t.model.user.password||!t.model.user.password.match(t.model.passwordRegularExpression)),e&&(t.model.user.passwordErrorMessage=n.instant("IDM.PROFILE-MGMT.POPUP.CHANGE-PASSWORD-NOT-IN-CRITERIA",{criteria:t.model.passwordCriteriaMessage}))),e},t.invalidUserPassword=function(){return t.checkPasswordMinLength()||t.checkPasswordRegEx()},t.createNewUser=function(){if(t.model.user.email&&t.model.user.status&&t.model.user.type){var n=t.model;n.loading=!0;var r={email:n.user.email,firstName:n.user.firstName,lastName:n.user.lastName,status:n.user.status.id,type:n.user.type.id,password:n.user.password,company:n.user.company};t.model.user.tenantId>0&&(r.tenantId=t.model.user.tenantId),o({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/users",data:r}).success(function(){e.addAlert("New user created","info"),t.loadUsers(),t.loadUserSummary(),t.model.loading=!1,t.$hide()}).error(function(o,n){t.model.loading=!1,o&&o.message?e.addAlert(o.message,"error"):e.addAlert("Error while updating user status","error"),403==n?t.model.errorMessage="Forbidden":409==n?t.model.errorMessage="A user with that email address already exists":t.$hide()})}},t.editUserDetails=function(){if(t.model.user.email){var n=t.model;n.loading=!0;var r={email:n.user.email,firstName:n.user.firstName,lastName:n.user.lastName,company:n.user.company};o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/users/"+t.model.user.id,data:r}).success(function(){t.loadUsers(),t.loadUserSummary(),t.model.loading=!1,t.$hide()}).error(function(o,n){t.model.loading=!1,o&&o.message?e.addAlert(o.message,"error"):e.addAlert("Error while updating user status","error"),403==n?t.model.errorMessage="Forbidden":409==n?t.model.errorMessage="A user with that email address already exists":t.$hide()})}},t.setStatus=function(e){t.model.user.status=e},t.setType=function(e){t.model.user.type=e},t.cancel=function(){t.model.loading||t.$hide()}}]),activitiApp.controller("IdmUserBulkUpdatePopupController",["$rootScope","$scope","$http","$translate","SystemPropertiesService",function(e,t,o,n,r){t.model.updateUsers="status"==t.model.mode?{status:t.model.statusFilters[1],sendNotifications:!1}:"type"==t.model.mode?{type:t.model.typeFilters[1]}:"password"==t.model.mode?{password:""}:"primaryGroup"==t.model.mode?{primaryGroupId:""}:{tenantId:e.common.selectedTenantId},t.passwordMinLength=4,t.passwordRegExp="",r.getPasswordValidationConstraints(null).then(function(e){e&&(t.passwordMinLength=e.minLength,t.passwordRegExp=e.regularExpression,t.passwordCriteriaMessage=e.passwordCriteriaMessage?n.instant("IDM.PROFILE-MGMT.POPUP."+e.passwordCriteriaMessage):null)}),t.passwordsNotMatching=function(){return t.model.updateUsers.password&&t.model.updateUsers.password.length>0&&t.model.updateUsers.repeatPassword&&t.model.updateUsers.repeatPassword.length>0?t.model.updateUsers.password!==t.model.updateUsers.repeatPassword:!1},t.passwordsValidMinLength=function(){return t.model.updateUsers.password&&t.model.updateUsers.password.length>=t.passwordMinLength?!0:!1},t.passwordInvalidMatch=function(){var e=!1;return t.passwordRegExp&&(e=!!t.model.updateUsers.password&&!t.model.updateUsers.password.match(t.passwordRegExp)),e},t.isPasswordInvalid=function(){return t.passwordInvalidMatch()||!t.passwordsValidMinLength()||t.passwordsNotMatching()},t.updateUsers=function(){t.model.loading=!0;for(var n=t.getSelectedUsers(),r=[],a=0;n.length>a;a++){var i=n[a];i&&i.id&&r.push(i.id)}var l={users:r};"status"==t.model.mode?(l.status=t.model.updateUsers.status.id,l.sendNotifications=t.model.updateUsers.sendNotifications):"type"==t.model.mode?l.accountType=t.model.updateUsers.type.id:"password"==t.model.mode?l.password=t.model.updateUsers.password:"primaryGroup"==t.model.mode?l.primaryGroupId=t.model.updateUsers.primaryGroupId||-1:l.tenantId=t.model.updateUsers.tenantId,o({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/users",data:l}).success(function(){t.$hide(),t.model.loading=!1,e.addAlert(t.model.selectedUserCount+" user(s) updated","info"),t.loadUsers(),t.loadUserSummary()}).error(function(o,n){t.model.loading=!1,o&&o.message?e.addAlert(o.message,"error"):e.addAlert("Error while updating user status","error"),t.$hide(),403==n&&console.log("Not permitted!")})},t.setStatus=function(e){t.model.updateUsers.status=e},t.setType=function(e){t.model.updateUsers.type=e},t.cancel=function(){t.model.loading||t.$hide()}}]),activitiApp.controller("IdmSystemGroupMgmtController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$popover","IdmService",function(e,t,o,n,r,a,i,l,d){var s=!0;e.hasTenantManagementCapability()||e.hasTenantAdminCapability()||(s=!1,a.path("/profile")),t.model={loading:!0},t.showCreateGroupPopup=function(){t.model.editedGroup={},_internalCreateModal({scope:t,template:"views/popup/idm-group-create.html",show:!0},i,t)};var c=function(){t.model.loadingUsers=!0,d.getUsersForGroup(t.model.selectedGroup.id,t.model.userFilter,t.model.userPage,t.model.pageSize).then(function(e){t.model.users=e,t.model.moreUsers=t.model.selectedGroup.userCount>(t.model.userPage+1)*t.model.pageSize,t.model.loadingUsers=!1})},u=function(){t.model.loadingGroups=!0,d.getGroupsForSystemGroup(t.model.selectedGroup.id).then(function(e){t.model.organizationalGroups=e,t.model.currentGroupIds=[];for(var o=0;e.length>o;o++)t.model.currentGroupIds.push(e[o].id);t.model.loadingGroups=!1})};t.selectGroup=function(e){t.model.loadingGroup=!0,d.getGroup(e,!1,!0).then(function(e){t.model.selectedGroup=e,t.model.loadingGroup=!1,t.model.userPage=0,t.model.pageSize=50,c(),u()})},t.showPreviousUsers=function(){t.model.userPage--,c()},t.showNextUsers=function(){t.model.userPage++,c()},t.refreshDelayed=function(){t.model.waiting?t.model.delayed=!0:t.scheduleDelayedRefresh()},t.scheduleDelayedRefresh=function(){t.model.waiting=!0,r(function(){t.model.waiting=!1,t.model.delayed?(t.model.delayed=!1,t.scheduleDelayedRefresh()):(t.model.userPage=0,c())},100)},t.saveGroup=function(){t.model.editedGroup.id?(t.model.loadingGroup=!0,d.updateGroup(t.model.editedGroup.id,e.common.selectedTenantId,t.model.editedGroup).then(function(e){t.model.selectedGroup=e;for(var o=0;t.model.groups.length>o;o++)t.model.groups[o].id===e.id&&(t.model.groups[o].name=e.name);t.model.loadingGroup=!1})):(t.model.loading=!0,d.createGroup(t.model.editedGroup,e.common.selectedTenantId).then(function(e){t.fetchGroups(e.id),t.model.loading=!1}))},t.showDeleteGroupModal=function(){_internalCreateModal({scope:t,template:"views/popup/idm-delete-group.html",show:!0},i,t)},t.deleteGroup=function(){t.model.loading=!0,d.deleteGroup(t.model.selectedGroup.id).then(function(){t.model.loading=!1,p(),t.fetchGroups()})};var p=function(){delete t.model.groups,delete t.model.selectedGroup};if(t.showEditGroupModal=function(){t.model.editedGroup=t.model.selectedGroup,_internalCreateModal({scope:t,template:"views/popup/idm-group-create.html",show:!0},i,t)},t.showRemoveMemberModal=function(e){t.model.userToRemove=e,_internalCreateModal({scope:t,template:"views/popup/idm-group-member-delete.html",show:!0},i,t)},t.deleteGroupMember=function(){d.deleteGroupMember(t.model.selectedGroup.id,t.model.userToRemove.id).then(function(){for(var e=0;t.model.users.data.length>e;e++)if(t.model.users.data[e].id===t.model.userToRemove.id){t.model.users.data.splice(e,1),delete t.model.userToRemove;break}c()})},t.addGroupMember=function(e){d.addGroupMember(t.model.selectedGroup.id,e.id).then(function(){t.selectGroup(t.model.selectedGroup.id)})},t.addAllUsers=function(){t.model.loadingUsers=!0,d.addAllUsers(t.model.selectedGroup.id).then(function(){t.model.loadingUsers=!1,t.selectGroup(t.model.selectedGroup.id)})},t.showRemoveCapabilityModal=function(e){t.model.capabilityToRemove=e,t.deleteCapabilityModal=_internalCreateModal({scope:t,template:"views/popup/idm-group-capability-delete.html",show:!0},i,t)},t.deleteCapability=function(){t.model.deletingCapability=!0,d.deleteGroupCapability(t.model.selectedGroup.id,t.model.capabilityToRemove.id).then(function(){for(var e=0;t.model.selectedGroup.capabilities.length>e;e++)if(t.model.selectedGroup.capabilities[e].id===t.model.capabilityToRemove.id){t.model.selectedGroup.capabilities.splice(e,1),delete t.model.capabilityToRemove;
break}t.model.deletingCapability=!1,t.deleteCapabilityModal.hide()})},t.showAddCapabilityPopover=function(e){t.addCapabilityPopover&&(t.addCapabilityPopover.$scope.$destroy(),t.addCapabilityPopover.destroy(),delete t.addCapabilityPopover),t.addCapabilityPopover=l(angular.element(e.target),{template:"views/popover/add-group-capability-popover.html",placement:"bottom-left",show:!0,scope:t}),t.addCapabilityPopover.$scope.$on("tooltip.hide",function(){t.addCapabilityPopover.$scope.$destroy(),t.addCapabilityPopover.destroy(),delete t.addCapabilityPopover})},t.addOrganizationalGroup=function(e){d.addGroupToSystemGroup(t.model.selectedGroup.id,e.id).then(function(){u()})},t.deleteOrganizationalGroup=function(e){t.model.loadingGroups=!0,d.deleteGroupFromSystemGroup(t.model.selectedGroup.id,e.id).then(function(){u()})},t.fetchGroups=function(o){t.model.loading=!0,p();var n;-1!==e.common.selectedTenantId&&(n=e.common.selectedTenantId),d.getGroups(n).then(function(e){if(t.model.groups=e,o)for(var n=0;e.length>n;n++)e[n].id===o&&t.selectGroup(o);t.model.loading=!1})},t.hasTenantManagementCapability()){var m=function(){t.model.loading=!0,d.getTenants().then(function(n){if(t.model.tenants=[{id:-1,name:o.instant("IDM.GENERAL.NO-TENANT")}],e.common.selectedTenantId||(e.common.selectedTenantId=-1),n&&n.length>0){for(var r=0;n.length>r;r++)t.model.tenants.push(n[r]);t.model.loading=!1}})};m()}else t.hasTenantAdminCapability&&(e.common.selectedTenantId=t.account.tenantId);s&&t.fetchGroups()}]),activitiApp.controller("AddCapabilityPopoverController",["$rootScope","$scope","$translate","$q","IdmService",function(e,t,o,n,r){t.model.capabilitiesLoading=!0,t.model.selectedCapabilities=[],t.model.potentialCapabilities=[],t.model.nrSelectedCapabilities=0,r.getPotentialCapabilities(t.model.selectedGroup.id).then(function(e){t.model.potentialCapabilities=e,t.model.capabilitiesLoading=!1}),t.selectCapability=function(e){var o=t.model.selectedCapabilities.indexOf(e);o>=0?t.model.selectedCapabilities.splice(o,1):t.model.selectedCapabilities.push(e),t.model.nrSelectedCapabilities=t.model.selectedCapabilities.length},t.isSelectedCapability=function(e){return t.model.selectedCapabilities.indexOf(e)>=0},t.addCapabilitiesToGroup=function(){t.model.capabilitiesLoading=!0,r.addGroupCapabilities(t.model.selectedGroup.id,t.model.selectedCapabilities).then(function(){t.addCapabilityPopover.$scope.$destroy(),t.addCapabilityPopover.destroy(),t.addCapabilityPopover=void 0,t.model.capabilitiesLoading=!1,e.addAlertPromise(o("IDM.SYSTEM-GROUP-MGMT.CAPABILITIES-ADDED")),t.selectGroup(t.model.selectedGroup.id)})}}]),activitiApp.controller("IdmFunctionalGroupMgmtController",["$rootScope","$scope","$translate","$http","$timeout","$location","$modal","$popover","IdmService",function(e,t,o,n,r,a,i,l,d){var s=!0;e.hasTenantManagementCapability()||e.hasTenantAdminCapability()||(s=!1,a.path("/profile")),t.model={loading:!0,expanded:{}},t.showCreateGroupPopup=function(){t.model.editedGroup={},_internalCreateModal({scope:t,template:"views/popup/idm-group-create.html",show:!0},i,t)},t.groupListToParentMap=function(e){var t=function(e,o,n){if(e&&e.length>0)for(var r=0;e.length>r;r++)o&&(n[e[r].id]=o),t(e[r].groups,e[r],n)},o={};return t(e,void 0,o),o};var c=function(){t.model.loadingUsers=!0,d.getUsersForGroup(t.model.selectedGroup.id,t.model.userFilter,t.model.userPage,t.model.pageSize).then(function(e){t.model.users=e,t.model.moreUsers=t.model.selectedGroup.userCount>(t.model.userPage+1)*t.model.pageSize,t.model.loadingUsers=!1})};t.selectGroup=function(e,o){var n=!0;(null===o||void 0===o||o===!1)&&e&&t.model.selectedGroup&&e===t.model.selectedGroup.id&&(n=!1);var r=function(){var e=t.model.expanded[t.model.selectedGroup.id];t.model.expanded[t.model.selectedGroup.id]=null===e||void 0===e?!0:!e};n?(t.model.loadingGroup=!0,d.getGroup(e).then(function(e){t.model.selectedGroup=e,t.model.expanded[e.id]=!0;for(var o=t.groupListToParentMap(t.model.groups),n=o[e.id];n;)t.model.expanded[n.id]=!0,n=o[n.id];t.model.userPage=0,t.model.pageSize=50,c(),t.model.loadingGroup=!1})):r()},t.showPreviousUsers=function(){t.model.userPage--,c()},t.showNextUsers=function(){t.model.userPage++,c()},t.refreshDelayed=function(){t.model.waiting?t.model.delayed=!0:t.scheduleDelayedRefresh()},t.scheduleDelayedRefresh=function(){t.model.waiting=!0,r(function(){t.model.waiting=!1,t.model.delayed?(t.model.delayed=!1,t.scheduleDelayedRefresh()):(t.model.userPage=0,c())},100)},t.saveGroup=function(){t.model.editedGroup.id?(t.model.loadingGroup=!0,d.updateGroup(t.model.editedGroup.id,e.common.selectedTenantId,t.model.editedGroup).then(function(e){t.model.selectedGroup=e;for(var o=0;t.model.groups.length>o;o++)t.model.groups[o].id===e.id&&(t.model.groups[o].name=e.name);t.model.loadingGroup=!1})):(t.model.loading=!0,d.createGroup(t.model.editedGroup,e.common.selectedTenantId,1).then(function(e){t.fetchGroups(e.id),t.model.loading=!1}))},t.showDeleteGroupModal=function(){_internalCreateModal({scope:t,template:"views/popup/idm-delete-group.html",show:!0},i,t)},t.deleteGroup=function(){t.model.loading=!0,d.deleteGroup(t.model.selectedGroup.id).then(function(){t.model.loading=!1,u(),t.fetchGroups()})},t.showActivateGroupModal=function(){_internalCreateModal({scope:t,template:"views/popup/idm-activate-group.html",show:!0},i,t)},t.activateGroup=function(){t.model.loading=!0,d.activateGroup(t.model.selectedGroup.id).then(function(){t.model.loading=!1,u(),t.fetchGroups()})};var u=function(){delete t.model.groups,delete t.model.selectedGroup};if(t.showEditGroupModal=function(){t.model.editedGroup=t.model.selectedGroup,_internalCreateModal({scope:t,template:"views/popup/idm-group-create.html",show:!0},i,t)},t.showRemoveMemberModal=function(e){t.model.userToRemove=e,_internalCreateModal({scope:t,template:"views/popup/idm-group-member-delete.html",show:!0},i,t)},t.deleteGroupMember=function(){d.deleteGroupMember(t.model.selectedGroup.id,t.model.userToRemove.id).then(function(){for(var e=0;t.model.users.data.length>e;e++)if(t.model.users.data[e].id===t.model.userToRemove.id){t.model.users.data.splice(e,1),delete t.model.userToRemove;break}c()})},t.addGroupMember=function(e){d.addGroupMember(t.model.selectedGroup.id,e.id).then(function(){t.selectGroup(t.model.selectedGroup.id,!0)})},t.addGroupManager=function(e){d.addGroupManager(t.model.selectedGroup.id,e.id).then(function(){t.selectGroup(t.model.selectedGroup.id,!0)})},t.removeGroupManager=function(e){d.removeGroupManager(t.model.selectedGroup.id,e.id).then(function(){t.selectGroup(t.model.selectedGroup.id,!0)})},t.showCreateSubgroupPopup=function(){t.model.editedGroup={parentGroupId:t.model.selectedGroup.id},_internalCreateModal({scope:t,template:"views/popup/idm-group-create.html",show:!0},i,t)},t.fetchGroups=function(o){t.model.loading=!0,u();var n;-1!==e.common.selectedTenantId&&(n=e.common.selectedTenantId),d.getFunctionalGroups(n).then(function(e){t.model.groups=e;var n;for(t.model.expanded={},o&&t.selectGroup(o),n=0;e.length>n;n++)t.model.expanded[e[n].id]=!0;t.model.loading=!1})},t.hasTenantManagementCapability()){var p=function(){t.model.loading=!0,d.getTenants().then(function(n){if(t.model.tenants=[{id:-1,name:o.instant("IDM.GENERAL.NO-TENANT")}],e.common.selectedTenantId||(e.common.selectedTenantId=-1),n&&n.length>0){for(var r=0;n.length>r;r++)t.model.tenants.push(n[r]);t.model.loading=!1}})};p()}else t.hasTenantAdminCapability&&(e.common.selectedTenantId=t.account.tenantId);s&&t.fetchGroups()}]),activitiApp.controller("IdmProfileMgmtController",["$rootScope","$scope","$modal","$window","IdmService","$translate","SystemPropertiesService",function(e,t,o,n,r,a,i){t.model={loading:!0,passwordConstraintMinValue:4,passwordRegularExpression:"",passwordCriteriaMessage:""},t.showUploadPictureModal=function(){_internalCreateModal({scope:t,template:"views/popup/idm-profile-picture-upload.html",show:!0},o,t)},t.resetEditing=function(){t.model.editingEmail=!1,t.model.editingFirstName=!1,t.model.editingLastName=!1,t.model.editingCompany=!1},t.profileChanged=function(){t.model.passwordErrorMessage=!1,this.profileform.$valid&&(t.model.loading=!0,r.updateProfileDetails(t.model.profile,function(){t.resetEditing(),t.loadProfile(),e.addAlert("Profile Uploaded","info")},function(o,n){t.model.passwordErrorMessage=!0,t.model.loading=!1,409===n&&(t.model.profile.emailErrorMessage=a.instant(o.message)),o&&o.message?e.addAlert(o.message,"error"):o&&o.messageKey?e.addAlertPromise(a(o.messageKey),"error"):e.addAlertPromise(a("GENERAL.ERROR.GENERIC"),"error")}))},t.showPassword=!1,t.togglePassword=function(){t.showPassword=!t.showPassword},t.isActivePassword=function(){return t.showPassword},t.getPasswordType=function(){return t.showPassword===!0?"text":"password"},t.showSecurityPassword=function(){return this.profileform.$dirty&&t.isFormFieldsValid(this.profileform)&&this.isFormFieldsChange()||t.model.passwordErrorMessage},t.isFormFieldsValid=function(e){return t.isFirstNameValid(e)&&t.isCompanyValid(e)&&t.isLastNameValid(e)&&t.isEmailValid(e)},t.isFormFieldsChange=function(){return this.resetPasswordError(),t.model.profile.firstNameChanged()||t.model.profile.emailChanged()||t.model.profile.companyChanged()||t.model.profile.lastNameChanged()},t.isUpdateProfileButtonEnabled=function(){return this.profileform.$dirty&&this.profileform.$valid&&void 0!==this.profileform.password},t.isFirstNameValid=function(e){return void 0===e.firstName||e.firstName&&e.firstName.$valid},t.isCompanyValid=function(e){return void 0===e.company||e.company&&e.company.$valid},t.isLastNameValid=function(e){return void 0===e.lastName||e.lastName&&e.lastName.$valid},t.isEmailValid=function(e){return void 0===e.email||e.email&&e.email.$valid},t.resetPasswordError=function(){t.model.passwordErrorMessage=!1},t.showChangePasswordModal=function(){t.model.changePassword={},_internalCreateModal({scope:t,template:"views/popup/idm-change-password.html",show:!0},o,t)},t.loadAlfrescoRepositories=function(){r.getAllAlfrescoRepositories(void 0,!0).then(function(e){t.alfrescoRepositories=e})},t.loadBoxRepositories=function(){t.checkBoxRepositoryIsEnabled(function(){t.boxRepositoryIsEnabled&&(t.boxRepository={name:"Box cloud"},r.loadBoxRepositoryAccount(t.model.profile.id).then(function(e){t.boxRepository.authenticationURL=e.authenticationURL,t.boxRepository.ownerEmail=e.ownerEmail,t.boxRepository.expireDate=e.expireDate}))})},t.checkBoxRepositoryIsEnabled=function(e){r.checkBoxRepositoryIsEnabled().then(function(o){t.boxRepositoryIsEnabled=o,e&&e.apply()})},t.configureBoxRepository=function(){t.model.editedRepository={authenticationURL:t.boxRepository.authenticationURL,ownerEmail:t.boxRepository.ownerEmail,edit:void 0!=t.boxRepository.ownerEmail,expireDate:t.boxRepository.expireDate},_internalCreateModal({scope:t,template:"views/popup/idm-user-box-account-authorize.html",show:!0},o,t)},t.isWaitingResponse=function(){return t.model.editedRepository.waiting===!0},t.credentialsProvided=function(){return t.model.editedRepository.accountUsername&&t.model.editedRepository.accountUsername.length>0&&t.model.editedRepository.password&&t.model.editedRepository.password.length>0},t.authorizeAndSaveBoxRepository=function(){if(t.model.editedRepository){var e=angular.element(n),o=(e.width()-500)/2,r=(e.height()-600)/2,a=n.open(t.model.editedRepository.authenticationURL,"alfrescoAuth","width= 500, height=600, toolbar=no, status=no, titlebar=no, location=no, menubar=no, top="+r+", left="+o);n.contentAccountAuthConfirmed=function(){t.$apply(function(){a.close(),t.loadBoxRepositories()})},n.contentAccountAuthFailed=function(e,o){t.$apply(function(){a.close(),t.showErrorModal(e,o)})}}},t.showErrorModal=function(e,n){t.errorModel={error:e,details:n},_internalCreateModal({scope:t,template:"views/popup/idm-error-popup.html",show:!0},o,t)},t.removeBoxRepository=function(){r.deleteBoxRepositoryAccount(t.model.profile.id).then(function(){t.loadBoxRepositories()})},t.configureAlfrescoRepository=function(e){t.model.editedRepository={accountUsername:e.accountUsername,id:e.id,edit:void 0!=e.accountUsername,password:"",name:e.name},_internalCreateModal({scope:t,template:"views/popup/idm-user-alfresco-account-create.html",show:!0},o,t)},t.saveAlfrescoRepository=function(e){t.model.editedRepository.error=!1,t.model.editedRepository.errorMessage="",t.model.editedRepository&&(t.model.editedRepository.waiting=!0,t.model.editedRepository.edit?r.updateAlfrescoRepositoryAccount(t.model.editedRepository.id,t.model.editedRepository.accountUsername,t.model.editedRepository.password).then(function(){t.loadAlfrescoRepositories(),t.model.editedRepository.error=!1,t.model.editedRepository.waiting=!1,e&&"function"==typeof e&&e()},function(e){t.model.editedRepository.waiting=!1,t.model.editedRepository.error=!0,e&&(t.model.editedRepository.errorMessage=e.message)}):r.createAlfrescoRepositoryAccount(t.model.editedRepository.id,t.model.editedRepository.accountUsername,t.model.editedRepository.password).then(function(){t.loadAlfrescoRepositories(),t.model.editedRepository.waiting=!1,t.model.editedRepository.error=!1,e&&"function"==typeof e&&e()},function(e){t.model.editedRepository.waiting=!1,t.model.editedRepository.error=!0,e&&(t.model.editedRepository.errorMessage=e.message)}))},t.removeAlfrescoRepository=function(e){r.deleteAlfrescoRepositoryAccount(e.id).then(function(){t.loadAlfrescoRepositories()})},t.loadProfile=function(){r.getProfile().then(function(e){t.model.originalEmail=e.email,t.model.originalFirstName=e.firstName,t.model.originalLastName=e.lastName,t.model.originalCompany=e.company,t.model.profile=e,t.model.profile.emailChanged=function(){return t.model.profile.hasEmail()?t.model.originalEmail!==t.model.profile.email:!1},t.model.profile.hasEmail=function(){return null!==t.model.profile.email&&void 0!==t.model.profile.email&&""!==t.model.profile.email},t.model.profile.firstNameChanged=function(){return t.model.profile.hasFirstName()?t.model.originalFirstName!==t.model.profile.firstName:!1},t.model.profile.hasFirstName=function(){return""===t.model.profile.firstName||t.model.profile.firstName&&t.model.profile.firstName.length>0},t.model.profile.lastNameChanged=function(){return t.model.profile.hasLastName()?t.model.originalLastName!==t.model.profile.lastName:!1},t.model.profile.hasLastName=function(){return t.model.profile.lastName&&t.model.profile.lastName.length>0},t.model.profile.companyChanged=function(){return t.model.profile.hasCompany()?t.model.originalCompany!==t.model.profile.company:!1},t.model.profile.hasCompany=function(){return""===t.model.profile.company||t.model.profile.company&&t.model.profile.company.length>0},t.model.profile.hasPassword=function(){return null!==t.model.profile.password&&void 0!==t.model.profile.password&&""!==t.model.profile.password},t.model.loading=!1,t.retrieveTennantProperty(e.tenantId),e.tenantId&&t.loadAlfrescoRepositories(),t.loadBoxRepositories()})},t.loadProfile(),r.getIdmInfo().then(function(e){t.model.showChangePasswordButton=null!==e&&void 0!==e&&"default"===e}),t.retrieveTennantProperty=function(e){t.model.loading=!1,i.getPasswordValidationConstraints(e).then(function(e){e&&(t.model.passwordConstraintMinValue=e.minLength,t.model.passwordRegularExpression=e.regularExpression,t.model.passwordCriteriaMessage=e.passwordCriteriaMessage?a.instant("IDM.PROFILE-MGMT.POPUP."+e.passwordCriteriaMessage):null,t.model.loading=!1)})}}]),activitiApp.controller("UploadUserPictureController",["$rootScope","$scope","Upload",function(e,t,o){t.popup={loading:!1},t.onFileSelect=function(e){for(var n=0;e.length>n;n++){var r=e[n];o.upload({url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/profile-picture",method:"POST",file:r}).progress(function(e){t.popup.loading=!0,t.popup.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(){t.popup.loading=!1,t.$hide(),t.loadProfile()}).error(function(e){e&&e.message&&(t.popup.errorMessage=e.message),t.popup.error=!0,t.popup.loading=!1})}},t.cancel=function(){t.popup.loading||t.$hide()}}]),activitiApp.controller("IdmChangePasswordController",["$rootScope","$scope","IdmService","$translate",function(e,t,o){t.isConfirmButtonDisabled=function(){return!t.model.changePassword.originalPassword||0===t.model.changePassword.originalPassword.length||!t.model.changePassword.newPassword||0===t.model.changePassword.newPassword.length||!t.model.changePassword.newPassword2||0===t.model.changePassword.newPassword2.length||t.model.changePassword.newPassword!==t.model.changePassword.newPassword2||t.model.changePassword.newPassword.length<t.model.passwordConstraintMinValue},t.showPasswordsDontMatch=function(){var e=t.model.changePassword.originalPassword&&t.model.changePassword.originalPassword.length>0&&t.model.changePassword.newPassword&&t.model.changePassword.newPassword.length>0&&t.model.changePassword.newPassword2&&t.model.changePassword.newPassword2.length>0&&t.model.changePassword.newPassword!==t.model.changePassword.newPassword2;return e},t.isPasswordInvalid=function(){var e=t.isPasswordsTooShort()||t.isPasswordsNotMatchingCriteria();return e},t.isPasswordsTooShort=function(){return!t.model.changePassword.newPassword||t.model.changePassword.newPassword.length<t.model.passwordConstraintMinValue},t.isPasswordsNotMatchingCriteria=function(){var e=!1;return t.model.passwordRegularExpression&&(e=!t.model.changePassword.newPassword||!t.model.changePassword.newPassword.match(t.model.passwordRegularExpression)),e},t.changePassword=function(){t.model.changePassword.error=!1,o.changePassword(t.model.changePassword.originalPassword,t.model.changePassword.newPassword).then(function(){t.$hide()},function(){t.model.changePassword.error=!0})}}]),activitiModule.service("UserService",["$http","$q",function(e,t){var o=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getFilteredUsers=function(e,t,n,r,a){var i={};return"string"==typeof e?i.filter=e:i=e,t&&(i.excludeTaskId=t),n&&(i.excludeProcessId=n),r&&r>0&&(i.tenantId=r),a&&a.id&&(i.groupId=a.id),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/workflow-users",params:i})},this.getFilteredUsersStrict=function(e,t,n){var r={};return r.status="active",null!==e&&void 0!==e&&(r.filter=e),null!==t&&void 0!==t&&t>-1&&(r.tenantId=t),n&&n.id&&(r.groupId=n.id),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/admin/users",params:r})},this.getRecentUsers=function(e,t){var n={};return t&&(n.excludeTaskId=t),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/workflow-users/"+e+"/recent-users",params:n})}}]),function(){angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(e,t){return{loginConfirmed:function(o,n){var r=n||function(e){return e};e.$broadcast("event:auth-loginConfirmed",o),t.retryAll(r)},loginCancelled:function(o,n){t.rejectAll(n),e.$broadcast("event:auth-loginCancelled",o)}}}]).config(["$httpProvider",function(e){var t=["$rootScope","$q","httpBuffer","$translate",function(e,t,o,n){return{responseError:function(r){if(401===r.status&&!r.config.ignoreAuthModule){var a=t.defer();return o.append(r.config,a),e.$broadcast("event:auth-loginRequired",r),a.promise}return 401===r.status&&(e.invalidCredentials=!0),r.status>=500&&599>=r.status&&r.config&&!r.config.ignoreErrors&&(r.data&&r.data.messageKey?e.addAlertPromise(n(r.data.messageKey),"error"):r.data&&r.data.message?e.addAlert(r.data.message,"error"):e.addAlertPromise(n("GENERAL.ERROR.GENERIC"),"error")),t.reject(r)}}}];e.interceptors.push(t)}]),angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(e){function t(t,n){function r(e){n.resolve(e)}function a(e){n.reject(e)}o=o||e.get("$http"),o(t).then(r,a)}var o,n=[];return{append:function(e,t){n.push({config:e,deferred:t})},rejectAll:function(e){if(e)for(var t=0;n.length>t;++t)n[t].deferred.reject(e);n=[]},retryAll:function(e){for(var o=0;n.length>o;++o)t(e(n[o].config),n[o].deferred);n=[]}}}])}(),activitiApp.factory("AuthenticationSharedService",["$rootScope","$http","authService","$q","$location","$window",function(e,t,o,n){return{authenticate:function(){var o=n.defer();return t.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/authenticate",{ignoreErrors:!0,ignoreAuthModule:"ignoreAuthModule"}).success(function(){var n=ACTIVITI.CONFIG.contextRoot+"/app/rest/account";ACTIVITI.CONFIG.integrationProfile&&(n+="?includeApps=true"),t.get(n).success(function(t){e.account=t,e.invalidCredentials=!1,e.$broadcast("event:auth-authConfirmed"),o.resolve()}).error(function(t){o.reject(t),e.$broadcast("event:auth-loginRequired")})}).error(function(t){o.reject(t),e.$broadcast("event:auth-loginRequired")}),o.promise},login:function(n){var r="j_username="+encodeURIComponent(n.username)+"&j_password="+encodeURIComponent(n.password)+"&_spring_security_remember_me=true&submit=Login";t.post(ACTIVITI.CONFIG.contextRoot+"/app/authentication",r,{headers:{"Content-Type":"application/x-www-form-urlencoded"},ignoreAuthModule:"ignoreAuthModule"}).success(function(t,r,a,i){e.authenticationError=!1,n.success&&n.success(t,r,a,i),o.loginConfirmed()}).error(function(t,o,r,a){e.$broadcast("event:auth-loginFailed"),n.error&&n.error(t,o,r,a)})},logout:function(){e.authenticated=!1,e.authenticationError=!1,t.get(ACTIVITI.CONFIG.contextRoot+"/app/logout").success(function(){e.login=null,e.authenticated=!1,o.loginCancelled({isFromLogout:!0})})},hasCapability:function(t){return e.account&&e.account.capabilities?e.account.capabilities.indexOf(t)>-1:!1},hasTenantManagementCapability:function(){return this.hasCapability("tenant-mgmt")},hasTenantAdminCapability:function(){return this.hasCapability("tenant-admin")},hasAccessReportsCapability:function(){return this.hasCapability("access-reports")}}}]),activitiModule.directive("appLinks",["$popover","$timeout","appResourceRoot",function(e){return{restrict:"E",templateUrl:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/app-links-button.html",replace:!0,link:function(){},scope:{},controller:["$scope","$element","RuntimeAppDefinitionService","$translate",function(t,o,n,r){var a;t.goToLink=function(e){t.onDestroyPopover(),window.location.href=e},t.onDestroyPopover=function(){a&&(a.$scope.$destroy(),a.destroy(),a=void 0)},t.showAppLinks=function(){t.apps=[],n.getApplications().then(function(e){for(var o=e.defaultApps.concat(e.customApps),n=0;o.length>n;n++){var a=o[n];if(null!==a.pages&&void 0!==a.pages&&a.pages.length>0){for(var i=0,l=0;a.pages.length>l;l++){var d={};d.name=a.pages[l],d.theme=a.theme,d.icon=a.icon,null!==a.defaultAppId&&void 0!==a.defaultAppId?(d.titleKey=a.titleKey+"-"+d.name.toUpperCase(),d.fixedUrl=a.fixedUrl+"#/"+a.pages[l]):(d.titleKey=r.instant("APP.CUSTOM-APP.TITLE-"+d.name.toUpperCase(),a),d.fixedUrl=a.fixedBaseUrl+a.pages[l]),o.splice(n+l+1,0,d),i++}o.splice(n,1),n=n+i-1}}t.apps=o}),a=e(o,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/app-links-popover.html",placement:"bottom-right",show:!0,scope:t,autoClose:!0}),a.$scope.$on("tooltip.hide",function(){t.onDestroyPopover()})}}]}}]),activitiModule.directive("variableIdentifier",["$rootScope","$timeout",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){function r(e,t){var o="",n=0;for(n=0;e.length>n;n++)t.test(o+e[n])&&(o+=e[n]);return o}e.identifierRegExp=/^[a-zA-Z][_a-zA-Z0-9]*$/,e.forbidenNames=["abstract","continue","for","new","switch","assert","default","if","package","synchronized","boolean","do","goto","private","this","break","double","implements","protected","throw","byte","else","import","public","throws","case","enum","instanceof","return","transient","catch","extends","int","short","try","char","final","interface","static","void","class","finally","long","strictfp","volatile","const","float","native","super","while","null"],e.$watch(o.ngModel,function(t){var a=!0;if(t&&t.length>0){var i=r(t,e.identifierRegExp);i!=t?(n.$setViewValue(i),n.$render()):a=e.identifierRegExp.test(i)?-1==e.forbidenNames.indexOf(i):!1}n.$setValidity(o.ngModel,a)})}}}]),activitiModule.directive("ngTrim",function(){return{require:"ngModel",priority:300,link:function(e,t,o,n){"false"===o.ngTrim&&n.$parsers.unshift(function(){return t.val()})}}}),activitiModule.directive("spacelessValue",["$rootScope","$timeout",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){function r(e,t){var o="",n=0;for(n=0;e.length>n;n++)t.test(o+e[n])&&(o+=e[n]);return o}e.identifierRegExp=/^\S*$/,e.$watch(o.ngModel,function(t){var a=!0;if(t&&t.length>0){var i=r(t,e.identifierRegExp);i!=t?(n.$setViewValue(i),n.$render()):e.identifierRegExp.test(i)||(a=!1)}n.$setValidity(o.ngModel,a)})}}}]),angular.module("activiti.common").filter("dateformat",function(){return function(e,t){return e?"fromNow"===t?moment(e).fromNow():"fromNowFull"===t?moment(e).fromNow()+" ("+moment(e).format("MMMM Do YYYY")+")":t?moment(e).format(t):moment(e).calendar():""}}).filter("dateonlyformat",function(){return function(e,t){return e?(e=e.split("T")[0],"fromNow"===t?moment(e).fromNow():"fromNowFull"===t?moment(e).fromNow()+" ("+moment(e).format("MMMM Do YYYY")+")":t?moment(e).format(t):moment(e).calendar()):""}}).filter("validdateformat",function(){return function(e,t){var o;return e&&(o="fromNow"===t?moment(e).fromNow():"fromNowFull"===t?moment(e).fromNow()+" ("+moment(e).format("MMMM Do YYYY")+")":t?moment(e).format(t):moment(e).calendar(),0==moment(o).isValid()&&(o="")),o}}).filter("momentToAngularFormat",function(){return function(e){return e?(e=e.replace(/D/g,"d"),e=e.replace(/Y/g,"y")):void 0}}),activitiModule.directive("restrictInput",["$parse",function(){return{restrict:"A",require:"ngModel",priority:1002,link:function(e,t,o,n){function r(e){var t=e.toUpperCase(),o=t.replace(/-D-/,"-DD-").replace(/^D-/,"DD-").replace(/-D$/,"-DD"),n=t.replace(/-M-/,"-MM-").replace(/^M-/,"MM-").replace(/-M$/,"-MM"),r=o.replace(/-M-/,"-MM-").replace(/^M-/,"MM-").replace(/-M$/,"-MM");return[t,o,n,r]}function a(e,t){if(void 0===e||null==e||""===e)return!0;if(e.length>t.length)return!1;for(var o=0;Math.min(t.length,e.length)>o;o++){var n=t[o];if(n.toUpperCase().match(/D|M|Y/)){if(null==e[o].match(/\d/))return!1}else if(e[o]!=n)return!1}return!0}var i=o.restrictInput;(void 0==i||null==i||""==i)&&(i=o.dateFormat),e.field&&(e.field.acceptedFormat=i);var l=r(i),d=!1;(void 0==i||null==i||""==i)&&(d=!0);var s=n.$render;n.$render=function(){t.val(n.$viewValue),n.$dateValue&&!isNaN(n.$dateValue.getTime())&&s&&s()},n.$parsers.unshift(function(e){if(d)return e;for(var t=!1,o=0;l.length>o&&!t;o++)t|=a(e,l[o]);return t?(n.$lastValidText=e,(void 0===e||null==e||""===e)&&(n.$dateValue=null),e):(n.$dateValue=null,n.$setViewValue(n.$lastValidText),n.$render(),n.$lastValidText)})}}}]),activitiModule.directive("autoHeight",["$rootScope","$timeout",function(e,t){return{restrict:"AC",scope:{toWatch:"=autoHeight"},compile:function(){return function(o,n,r){var a=0;r.offset&&(a=parseInt(r.offset),(0/0==a||void 0==a)&&(a=0));var i=function(e){t(function(){var t=e.parent().outerHeight()-a,o=!1;e.parent().children().filter(":visible").each(function(){o||(e[0]==this?o=!0:t-=angular.element(this).outerHeight())}),o&&e.height(t)},0)};o.$watch("toWatch",function(){i(n)}),o.unregisterWatcher&&o.unregisterWatcher(),o.unregisterWatcher=e.$watch("window.height",function(){i(n)}),o.unregisterForceWatcher&&o.unregisterForceWatcher(),o.unregisterForceWatcher=e.$watch("window.forceRefresh",function(){i(n)}),o.$on("$destroy",function(){o.unregisterWatcher&&o.unregisterWatcher(),o.unregisterForceWatcher&&o.unregisterForceWatcher()})}}}}]),activitiModule.directive("scrollToActive",["$timeout",function(e){return{restrict:"AC",scope:{toWatch:"=scrollToActiveModel"},compile:function(){return function(t,o,n){t.$watch("toWatch",function(){e(function(){var e=n.useParent,t=n.offsetTop;t&&(t=parseInt(t),0/0==t&&(t=0)),t||(t=0);var r=o.children(".active");if(r&&r.length>0){var a=angular.element(r[0]);e&&(o=angular.element(o.parent()));var i=a.position().top-o.position().top+o.scrollTop(),l=i+a.outerHeight(),d=o.scrollTop()+o.innerHeight(),s=d-o.innerHeight();s>=i?o.scrollTop(i-a.outerHeight()-t):l>d&&o.scrollTop(s+a.outerHeight()-t)}},0)})}}}}]),activitiModule.directive("autoScroll",["$timeout",function(e){return{restrict:"AC",compile:function(){return function(t,o){t.$on("tooltip.show",function(){e(function(){for(var e=o[0];e&&!(e.className&&e.className.indexOf("scroll-container")>=0);)e=e.parentNode;if(e){e=angular.element(e);var t=o.offset().top-e.offset().top+o.scrollTop(),n=t+o.outerHeight();n+30>=e.outerHeight()&&e.scrollTop(t)}},50)})}}}}]),activitiModule.directive("userName",function(){var e={};return e.template='{{user.firstName && user.firstName || ""}} {{user.lastName && user.lastName || ""}} {{ (user.email && !user.firstName && !user.lastName) && user.email || ""}}',e.scope={user:"=userName"},e}),activitiModule.directive("clickAnywhere",["$document","$parse",function(e,t){var o=function(o,n,r){var a=r.clickAnywhere,i=t(a),l=r.ignore,d=r.ignoreClass,s="true"==r.ignorePopupEvents,c=function(e){for(var t=e.target;t;){if(t==n[0]||l&&t.id==l||d&&t.className&&t.className.indexOf(d)>=0)return e.stopPropagation(),e.preventDefault(),void 0;t=t.parentNode}o.$apply(function(){i(o,{$event:e})})};e.on("click",c),o.$on("$destroy",function(){e.off("click",c)});var u=o.$on("tooltip.hide",function(){s||(e.off("click",c),u())})};return o}]),activitiModule.directive("autoFocus",["$timeout","$parse",function(e,t){return{restrict:"AC",compile:function(o,n){var r;return n.selectText&&(r=t(n.selectText)),function(t,o,n){var a=void 0!==n.focusFirstChild;e(function(){if(a){var e=o.find("input");e&&e.length>0&&(e[0].focus(),r&&r(t.$parent)&&input[0].setSelectionRange(0,input[0].value.length))}else o[0].focus(),r&&r(t.$parent)&&o[0].setSelectionRange(0,o[0].value.length)},100)}}}}]),activitiModule.directive("focusWhen",["$timeout",function(e){return{link:function(t,o,n){t.$watch(n.ngFocus,function(t){angular.isDefined(t)&&t&&e(function(){o[0].focus()})},!0),o.bind("blur",function(){angular.isDefined(n.ngFocusLost)&&t.safeApply(n.ngFocusLost)})}}}]),activitiModule.directive("loading",[function(){var e={};return e.restrict="A",e.template='<div class="loading" ng-show="loading"><div class="l1"></div><div class="l2"></div><div class="l3"></div></div>',e.scope={loading:"=loading",loadingText:"=loadingText"},e}]),activitiModule.directive("activitiFixDropdownBug",function(){return{restrict:"AEC",link:function(e,t){t.on("hidden.bs.dropdown	",function(){t.show()})}}}),activitiModule.directive("userLink",function(){var e={};return e.template='{{user.firstName && user.firstName || ""}} {{user.lastName && user.lastName || ""}} {{ (user.email && !user.firstName && !user.lastName) && user.email || ""}}',e.scope={user:"=userLink"},e.compile=function(e){e.addClass("people-link")},e}),activitiModule.directive("formField",function(){var e={};return e.template=' {{field.name || ""}} - {{field.id}}',e.scope={field:"=formField"},e.compile=function(e){e.addClass("form-field")},e}),activitiModule.directive("customKeys",["$parse",function(e){var t={};return t.compile=function(t,o){var n,r,a,i;return o.upPressed&&(n=e(o.upPressed)),o.downPressed&&(r=e(o.downPressed)),o.enterPressed&&(a=e(o.enterPressed)),o.escapePressed&&(i=e(o.escapePressed)),function(e,t){t.on("keyup",function(t){38===t.keyCode?e.$apply(function(){n&&n(e,{$event:t})}):40===t.keyCode?e.$apply(function(){r&&r(e,{$event:t})}):13===t.keyCode?e.$apply(function(){a&&a(e,{$event:t})}):27===t.keyCode&&e.$apply(function(){i&&i(e,{$event:t})})}),t.on("keydown",t,function(e){(38===e.keyCode||40===e.keyCode||13===e.keyCode||27===e.keyCode)&&e.preventDefault()})}},t}]),activitiModule.directive("delayedModel",["$timeout",function(e){return{scope:{targetModel:"=delayedModel"},link:function(t,o,n){o.val(t.targetModel),t.$watch("targetModel",function(n,a){r&&e.cancel(r),n!==a&&o.val(t.targetModel)});var r;o.on("keyup paste search",function(){o.val()!==t.targetModel&&(r&&e.cancel(r),r=e(function(){t.targetModel=o[0].value,o.val(t.targetModel),t.$apply()
},n.delay||200))})}}}]),activitiModule.directive("ngDebounce",["$timeout",function(e){return{restrict:"A",require:"ngModel",priority:99,link:function(t,o,n,r){if("radio"!==n.type&&"checkbox"!==n.type){o.unbind("input");var a;o.bind("input",function(){e.cancel(a),a=e(function(){t.$apply(function(){r.$setViewValue(o.val())})},n.ngDebounce||1e3)}),o.bind("blur",function(){t.$apply(function(){r.$setViewValue(o.val())})})}}}}]),activitiModule.directive("externalContentAuthenticator",["$parse","$timeout",function(){var e={};return e.restrict="A",e.templateUrl=ACTIVITI.CONFIG.webContextRoot+"/views/common/templates/external-content-authenticator-template.html",e.scope={taskId:"=taskId",accountType:"@accountType"},e.controller=["$scope","$element","ContentAccountService","$modal","$window","$translate","$rootScope",function(e,t,o,n,r,a,i){e.$on("integration.account.error",function(t,o){e.currentAccount&&o==e.currentAccount.serviceId&&e.contentBrowseModal&&("alfresco-cloud"===o?a("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"google-drive"===o?a("INTEGRATION.ALERT.GOOGLE-DRIVE-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"box"===o&&a("INTEGRATION.ALERT.BOX-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}))}),e.openAuthenticationPopup=function(t,o){e.openContentAccountAuth(t,o)},e.clearPopupError=function(){e.contentBrowseModal&&(e.contentBrowseModal.$scope.errorMessage=void 0)},e.$on("integration.account.autherror",function(t,o){o&&(e.contentAccounts[o].authorized=!1,"alfresco-cloud"===o?a("INTEGRATION.ALERT.ALFRESCO-CLOUD-NOT-AUTHORIZED").then(function(t){i.addAlert(t,"error"),e.errorMessage=t}):"google-drive"===o?a("INTEGRATION.ALERT.GOOGLE-DRIVE-NOT-AUTHORIZED").then(function(t){i.addAlert(t,"error"),e.errorMessage=t}):"box"===o&&a("INTEGRATION.ALERT.BOX-NOT-AUTHORIZED").then(function(t){i.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide())}),e.openContentAccountAuth=function(t,o){var n=angular.element(r),a=(n.width()-500)/2,i=(n.height()-400)/2,l=r.open(e.contentAccounts[o].authorizationUrl,o,"width= 500, height=400, toolbar=no, status=no, titlebar=no, location=no, menubar=no, top="+i+", left="+a);r.contentAccountAuthConfirmed=function(){e.$apply(function(){e.contentAccounts[o].authorizationUrl=void 0,e.contentAccounts[o].authorized=!0,e.currentAccount=e.contentAccounts[o],l.close(),e.$emit("task-completed",{taskId:e.taskId})})},r.contentAccountAuthFailed=function(t,o){e.$apply(function(){l.close(),e.showErrorModal(t,o)})}},e.showErrorModal=function(t,o){e.errorModel={error:t,details:o},_internalCreateModal({scope:e,template:"views/popup/error-popup.html",show:!0},n,e)},e.loadAccounts=function(){e.contentAccounts={loading:!0},o.getAccounts().then(function(t){if(t&&t.data)for(var o=0;t.data.length>o;o++){var n=t.data[o];e.contentAccounts[n.serviceId]=n}e.contentAccounts.rawList=t.data,e.contentAccounts.loading=!1})},e.loadAccounts()}],e}]),activitiModule.directive("externalContent",["$rootScope","$parse","$timeout",function(e,t,o){var n={};return n.restrict="A",n.templateUrl=ACTIVITI.CONFIG.webContextRoot+"/views/common/templates/external-content-template.html",n.scope={taskId:"=taskId",processInstanceId:"=formDefinition",folderSelect:"=folderSelect",linkOnly:"=linkOnly",preSelectedAccount:"=account",uploadInProgress:"=uploadInProgress",isRelatedContent:"=isRelatedContent",contentSource:"=?contentSource",allowMultiple:"=allowMultiple"},n.link=function(n,r,a){n.readOnly=e.readOnly,a.onContentUpload&&(n.uploadedCallback=t(a.onContentUpload)),a.onFolderSelect&&(n.folderSelectCallback=t(a.onFolderSelect)),a.onUploadInProgress&&(n.uploadInProgressCallback=t(a.onUploadInProgress)),o(function(){r.find("div.select-file").click(function(){r.find('input[type="file"]').click()})},200)},n.controller=["$scope","$element","RelatedContentService","ContentAccountService","$modal","$window","$translate","$rootScope",function(e,t,o,n,r,a,i,l){e.uploadModel={uploading:!1},e.BOX_DRIVE_ACCOUNT_ID="box",e.GOOGLE_DRIVE_ACCOUNT_ID="google-drive",e.ALFRESCO_ACCOUNT_ID_PREFIX="alfresco-",e.ALFRESCO_CLOUD_ACCOUNT_ID="alfresco-cloud",e.ALL_SOURCES_ACCOUNT_ID="all-file-sources",e.LOCAL_FILE_ACCOUNT_ID="local-file",e.filterNavigableContent=function(t){return!t.folder||(!e.contentSource||e.contentSource&&!e.contentSource.notAllowNavigateFolders)&&t.folder},e.browseButtonIsVisible=function(){return!e.linkOnly&&(e.contentSource&&(e.contentSource.serviceId===e.ALL_SOURCES_ACCOUNT_ID||e.contentSource.serviceId===e.LOCAL_FILE_ACCOUNT_ID)||!e.contentSource)},e.contentAccountsByServiceId=function(t){return!e.contentSource||e.contentSource.serviceId===e.ALL_SOURCES_ACCOUNT_ID||e.contentSource.serviceId===t.serviceId||e.contentSource.serviceId.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX&&t.name&&e.contentSource.name===t.name},e.selectFolder=function(t){if(e.preSelectedAccount||e.folderSelect){var o=e.folderSelect;if(o.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX){if(e.preSelectedAccount.name){var n=!1;for(var r in e.contentAccounts){var a=e.contentAccounts[r];a.serviceId&&e.preSelectedAccount.serviceId===a.serviceId&&(n=!0)}if(!n)for(var r in e.contentAccounts){var a=e.contentAccounts[r];a.serviceId&&a.name&&e.preSelectedAccount.name===a.name&&(e.preSelectedAccount=a)}}o=e.ALFRESCO_CLOUD_ACCOUNT_ID}(o===e.ALFRESCO_CLOUD_ACCOUNT_ID||o===e.GOOGLE_DRIVE_ACCOUNT_ID||o===e.BOX_DRIVE_ACCOUNT_ID)&&e.browseRepositoryContent(t,o,e.preSelectedAccount)}},e.$on("integration.account.error",function(t,o){e.currentAccount&&o==e.currentAccount.serviceId&&e.contentBrowseModal&&("alfresco-cloud"===o?i("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"google-drive"===o?i("INTEGRATION.ALERT.GOOGLE-DRIVE-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"box"===o?i("INTEGRATION.ALERT.BOX-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):i("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}))}),e.clearPopupError=function(){e.contentBrowseModal&&(e.contentBrowseModal.$scope.errorMessage=void 0)},e.$on("integration.account.autherror",function(t,o){o&&(e.contentAccounts[o].authorized=!1,o===e.ALFRESCO_CLOUD_ACCOUNT_ID?(i("INTEGRATION.ALERT.ALFRESCO-CLOUD-NOT-AUTHORIZED").then(function(t){l.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()):o==e.GOOGLE_DRIVE_ACCOUNT_ID?(i("INTEGRATION.ALERT.GOOGLE-DRIVE-NOT-AUTHORIZED").then(function(t){l.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()):"box"==o&&(i("INTEGRATION.ALERT.BOX-NOT-AUTHORIZED").then(function(t){l.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()))}),e.openFileSelect=function(t){e.errorMessage=void 0;var o=angular.element(t).parent();o.children("input").click()},e.confirmFolderSelection=function(){if(e.currentFolderTree&&e.folderSelectCallback){var t=e.createContentBrowserPayload(e.currentAccount);e.folderSelectCallback(e.$parent,{folder:t}),e.contentBrowseModal.$scope.$hide()}},e.confirmBoxFolderSelection=function(){var t=0;if(e.folderSelectCallback){var o="";e.currentFolderTree&&e.currentFolderTree.length>0?(o=e.pathFromFolderTree(e.currentFolderTree),t=e.currentFolderTree[e.currentFolderTree.length-1].id):(o+="/",t=0);var n={account:{id:e.currentAccount.serviceId,name:e.currentAccount.name},path:{id:t,title:o}};e.folderSelectCallback(e.$parent,{folder:n}),e.contentBrowseModal.$scope.$hide()}},e.onFileSelect=function(t,n){if(e.errorMessage=void 0,!e.linkOnly&&(e.errorMessage=void 0,!e.folderSelect&&!e.uploadModel.uploading&&t.length>0))for(var r=0;t.length>r;r++){e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!0}),e.uploadModel.uploading=!0;var a=t[r];e.clearPopupError(),o.addRelatedContent(e.taskId,e.processInstanceId,a,n,e.isRelatedContent).progress(function(t){e.uploadModel.uploadProgress=parseInt(100*t.loaded/t.total)}).then(function(t){e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!1}),e.uploadModel.uploading=!1,e.uploadedCallback&&e.uploadedCallback(e.$parent,{content:t})},function(t){if(e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!1}),t&&t.messageKey){var o={};t.customData&&(o.quota=e.formatFileSize(t.customData.quota)),i(t.messageKey,o).then(function(t){e.errorMessage=t})}e.uploadModel.uploading=!1})}},e.selectAccountContent=function(t,o){e.currentAccount=o,o.serviceId===e.GOOGLE_DRIVE_ACCOUNT_ID?e.selectGoogleDriveContent(t):o.serviceId==e.BOX_DRIVE_ACCOUNT_ID?e.selectBoxContent(t):e.browseRepositoryContent(t,e.ALFRESCO_CLOUD_ACCOUNT_ID,o)},e.selectGoogleDriveContent=function(t){e.errorMessage=void 0,e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].authorized?e.openGoogleDriveBrowser(t):e.openContentAccountAuth(t,e.GOOGLE_DRIVE_ACCOUNT_ID))},e.selectBoxContent=function(t){e.errorMessage=void 0,e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].authorized?e.openBoxBrowser(t):e.openContentAccountAuth(t,e.BOX_DRIVE_ACCOUNT_ID))},e.browseRepositoryContent=function(t,o,n){n&&n.serviceId!==e.BOX_DRIVE_ACCOUNT_ID&&n.serviceId!==e.ALFRESCO_CLOUD_ACCOUNT_ID&&n.serviceId!==e.GOOGLE_DRIVE_ACCOUNT_ID?(e.currentAccount=n,e.openContentAccountBrowser(t,o)):(e.errorMessage=void 0,e.account&&e.account.authorized?(e.currentAccount=n,e.openContentAccountBrowser(t,o)):e.contentAccounts[o]&&e.contentAccounts[o].authorized?(e.currentAccount=e.contentAccounts[o],e.openContentAccountBrowser(t,o)):e.openContentAccountAuth(t,o))},e.openContentAccountAuth=function(t,o){var n=angular.element(a),r=(n.width()-500)/2,i=(n.height()-400)/2,l=a.open(e.contentAccounts[o].authorizationUrl,o,"width= 500, height=400, toolbar=no, status=no, titlebar=no, location=no, menubar=no, top="+i+", left="+r);a.contentAccountAuthConfirmed=function(){e.$apply(function(){e.contentAccounts[o].authorizationUrl=void 0,e.contentAccounts[o].authorized=!0,e.currentAccount=e.contentAccounts[o],l.close(),e.openContentAccountBrowser(t,o)})},a.contentAccountAuthFailed=function(t,o){e.$apply(function(){l.close(),e.showErrorModal(t,o)})}},e.showErrorModal=function(t,o){e.errorModel={error:t,details:o},_internalCreateModal({scope:e,template:"views/popup/error-popup.html",show:!0},r,e)},e.openContentAccountBrowser=function(t,o){o===e.GOOGLE_DRIVE_ACCOUNT_ID?e.openGoogleDriveBrowser(t):o===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.openAlfrescoBrowser(t):o===e.BOX_DRIVE_ACCOUNT_ID&&e.openBoxBrowser(t)},e.loadLastPath=function(t){e.currentFolderTree=angular.copy(e.currentAccount.lastPath.currentFolderTree),e.selectedNetwork=angular.copy(e.currentAccount.lastPath.selectedNetwork),e.selectedSite=angular.copy(e.currentAccount.lastPath.selectedSite),e.alfrescoSites=angular.copy(e.currentAccount.lastPath.alfrescoSites),t===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.loadLastPathAlfrescoCloud():t===e.BOX_DRIVE_ACCOUNT_ID?e.loadLastPathBox():t===e.GOOGLE_DRIVE_ACCOUNT_ID&&e.loadLastPathGoogleDrive()},e.loadLastPathAlfrescoCloud=function(){e.currentContent.data=[angular.copy(e.currentAccount.lastPath.currentContent)]},e.loadLastPathGoogleDrive=function(){e.googleDriveFiles.data=[angular.copy(e.currentAccount.lastPath.googleDriveFiles)]},e.loadLastPathBox=function(){e.boxFiles.data=[angular.copy(e.currentAccount.lastPath.boxFiles)]},e.saveLastPath=function(t,o){e.currentAccount.lastPath={},e.currentAccount.rememberPath=!0,e.currentAccount.lastPath.currentFolderTree=angular.copy(e.currentFolderTree),e.currentAccount.lastPath.selectedNetwork=angular.copy(e.selectedNetwork),e.currentAccount.lastPath.selectedSite=angular.copy(e.selectedSite),e.currentAccount.lastPath.alfrescoSites=angular.copy(e.alfrescoSites),t===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.saveLastPathAlfrescoCloud(o):t===e.BOX_DRIVE_ACCOUNT_ID?e.saveLastPathBox(o):t===e.GOOGLE_DRIVE_ACCOUNT_ID&&e.saveLastPathGoogleDrive(o)},e.saveLastPathAlfrescoCloud=function(t){e.currentAccount.lastPath.currentContent=angular.copy(t)},e.saveLastPathGoogleDrive=function(t){e.currentAccount.lastPath.googleDriveFiles=angular.copy(t)},e.saveLastPathBox=function(t){e.currentAccount.lastPath.boxFiles=angular.copy(t)},e.openAlfrescoBrowser=function(){if(e.currentAccount.rememberPath?e.loadLastPath(e.ALFRESCO_CLOUD_ACCOUNT_ID):(e.currentFolderTree=[],e.selectedNetwork=void 0,e.selectedSite=void 0,e.selectedFolder=void 0,e.alfrescoSites=void 0),e.contentSource&&e.contentSource.serviceId.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX){var t=e.contentSource.selectedFolder;t&&(e.selectedNetwork={id:t.network},e.selectedSite={id:t.siteId,title:t.site},e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.currentAccount.rememberPath?e.loadFolderContent():e.contentSource&&e.contentSource.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.loadAlfrescoNetworks(function(){e.loadAlfrescoSites(e.loadFolderContent)}):e.currentAccount&&e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?(e.uploadModel.noNetwork=!1,e.loadAlfrescoNetworks()):(e.uploadModel.noNetwork=!0,e.loadAlfrescoSites(e.loadFolderContent)),e.createContentBrowserPayload=function(t){var o=e.pathFromFolderTree(e.currentFolderTree),n=null;e.currentFolderTree.length>0&&(n=e.currentFolderTree[e.currentFolderTree.length-1].id);var r={path:{id:n,title:o,folderTree:e.currentFolderTree}};return e.uploadModel.noNetwork?r.account={id:t.serviceId,name:t.name}:r.network=e.selectedNetwork.id,r.site={id:e.selectedSite.id,title:e.selectedSite.title},r},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-alfresco-cloud.html",show:!0,scope:e},r,e)},e.selectNetwork=function(t){e.currentAccount.loading||e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID&&(e.selectedNetwork=t,e.selectedSite=void 0,e.alfrescoSites=void 0,t&&e.loadAlfrescoSites())},e.selectSite=function(t){e.currentAccount.loading||(e.selectedSite=t,e.alfrescoFolders=void 0,t?e.loadSiteContent():e.currentFolderTree=[])},e.loadAlfrescoNetworks=function(t){e.currentAccount.loading||(e.currentAccount.loading=!0,e.clearPopupError(),n.getNetworks().then(function(o){e.alfrescoNetworks=o,e.currentAccount.loading=!1,t&&t()}))},e.loadAlfrescoSites=function(t){e.currentAccount.loading||(e.currentAccount.loading=!0,e.clearPopupError(),e.currentAccount&&e.currentAccount.serviceId!==e.ALFRESCO_CLOUD_ACCOUNT_ID?n.getSites(e.currentAccount.serviceId).then(function(o){e.alfrescoSites=o,e.currentAccount.loading=!1,t&&t()}):e.selectedNetwork?n.getCloudSites(e.selectedNetwork.id).then(function(o){e.alfrescoSites=o,e.currentAccount.loading=!1,t&&t()}):(e.currentAccount.loading=!1,t&&t()))},e.loadSiteContent=function(){e.currentAccount.loading||(e.currentAccount.loading=!0,e.currentFolderTree=[],e.currentContent=void 0,e.clearPopupError(),e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?n.getCloudContentInSite(e.selectedNetwork.id,e.selectedSite.id).then(function(t){e.currentContent=t,e.currentAccount.loading=!1}):n.getContentInSite(e.currentAccount.serviceId,e.selectedSite.id).then(function(t){e.currentContent=t,e.currentAccount.loading=!1}))},e.navigateToFolder=function(t){var o=e.currentFolderTree[t];o&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),e.selectedFolder=o,e.loadFolderContent())},e.pathFromFolderTree=function(e){for(var t="",o=0;e.length>o;o++)o>0&&(t+=" > "),t+=e[o].title;return t},e.loadFolderContent=function(t){if(e.selectedFolder&&!e.currentAccount.loading){e.currentContent=void 0,e.currentAccount.loading=!0,e.clearPopupError();var o=e.pathFromFolderTree(e.currentFolderTree);e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?n.getCloudContentInFolderByPath(e.selectedNetwork.id,e.selectedSite.id,o).then(function(o){e.currentContent=o,e.currentAccount.loading=!1,t&&t()}).catch(function(){n.getCloudContentInFolder(e.selectedNetwork.id,e.selectedFolder.id).then(function(o){e.currentContent=o,e.currentAccount.loading=!1,t&&t()})}):n.getContentInFolderByPath(e.currentAccount.serviceId,e.selectedSite.id,o).then(function(o){e.currentContent=o,e.currentAccount.loading=!1,t&&t()}).catch(function(){n.getContentInFolder(e.currentAccount.serviceId,e.selectedFolder.id).then(function(o){e.currentContent=o,e.currentAccount.loading=!1,t&&t()})})}},e.openBoxBrowser=function(){if(e.currentAccount.rememberPath?e.loadLastPath(e.BOX_DRIVE_ACCOUNT_ID):e.currentFolderTree=[],e.contentSource&&e.contentSource.serviceId===e.BOX_DRIVE_ACCOUNT_ID){var t=e.contentSource.selectedFolder;t&&(e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.createContentBrowserPayload=function(t){var o=e.pathFromFolderTree(e.currentFolderTree),n=null;return e.currentFolderTree.length>0&&(n=e.currentFolderTree[e.currentFolderTree.length-1].id),{path:{id:n,title:o,folderTree:e.currentFolderTree},account:{id:t.serviceId,name:t.name}}},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-box.html",show:!0,scope:e},r,e),e.contentBrowseModal.$scope.$watch("filter",function(t){e.loadBoxFiles(t)})},e.navigateToBoxFolder=function(t){var o=e.currentFolderTree[t];o&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles(""))},e.navigateToBoxRoot=function(){e.currentFolderTree=[],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles("")},e.loadBoxFiles=function(t){e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].loading=!0),t||(e.boxFiles=void 0);var o;e.currentFolderTree&&e.currentFolderTree.length>0&&(o=e.currentFolderTree[e.currentFolderTree.length-1].id),n.getBoxFiles(t,o).then(function(t){e.boxFiles=t,e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].loading=!1})},e.openGoogleDriveBrowser=function(){if(e.currentAccount.rememberPath?e.loadLastPath(e.GOOGLE_DRIVE_ACCOUNT_ID):e.currentFolderTree=[],e.contentSource&&e.contentSource.serviceId===e.GOOGLE_DRIVE_ACCOUNT_ID){var t=e.contentSource.selectedFolder;t&&(e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.createContentBrowserPayload=function(t){var o=e.pathFromFolderTree(e.currentFolderTree),n=null;return e.currentFolderTree.length>0&&(n=e.currentFolderTree[e.currentFolderTree.length-1].id),{path:{id:n,title:o,folderTree:e.currentFolderTree},account:{id:t.serviceId,name:t.name}}},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-google-drive.html",show:!0,scope:e},r,e),e.contentBrowseModal.$scope.$watch("filter",function(t){e.loadGoogleDriveFiles(t)})},e.navigateToGoogleDriveFolder=function(t){var o=e.currentFolderTree[t];o&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles(""))},e.navigateToGoogleDriveRoot=function(){e.currentFolderTree=[],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles("")},e.loadGoogleDriveFiles=function(t){e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!0),t||(e.googleDriveFiles=void 0);var o;e.currentFolderTree&&e.currentFolderTree.length>0&&(o=e.currentFolderTree[e.currentFolderTree.length-1].id);var r=!1;e.contentSource&&e.contentSource.notAllowNavigateFolders&&1==e.contentSource.notAllowNavigateFolders&&(r=!0),n.getGoogleDriveFiles(t,o,r).then(function(t){e.googleDriveFiles=t,e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!1})},e.addContentFromSource=function(t,n,r,a,i,l,d){o.addRelatedContentFromSource(e.taskId,e.processInstanceId,t,n,r,a,i,e.linkOnly,e.isRelatedContent).then(function(t){e.uploadedCallback&&e.uploadedCallback(e.$parent,{content:t}),l&&l(t)},function(e){d&&d(e)})},e.boxContentSelected=function(t){t.folder?(e.currentFolderTree&&0!=e.currentFolderTree.length?e.currentFolderTree.push(t):e.currentFolderTree=[t],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles("")):(e.contentAccounts.box.loading=!0,e.saveLastPath(e.BOX_DRIVE_ACCOUNT_ID,t),e.addContentFromSource("box",t.id,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide()},function(){e.contentBrowseModal.$scope.$hide()}),t.title="Uploading: "+t.title,e.boxFiles.data=[t])},e.googleDriveContentSelected=function(t){t.folder?(e.currentFolderTree&&0!=e.currentFolderTree.length?e.currentFolderTree.push(t):e.currentFolderTree=[t],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles("")):(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!0,e.saveLastPath(e.GOOGLE_DRIVE_ACCOUNT_ID,t),e.addContentFromSource(e.GOOGLE_DRIVE_ACCOUNT_ID,t.id,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide()},function(){e.contentBrowseModal.$scope.$hide()}),t.title="Uploading: "+t.title,e.googleDriveFiles.data=[t])},e.selectAlfrescoContent=function(t){if(!e.currentAccount.loading)if(e.clearPopupError(),t.folder)e.currentFolderTree.push(t),e.selectedFolder=t,e.loadFolderContent();else if(!e.folderSelect){e.currentAccount.loading=!0,e.saveLastPath(e.ALFRESCO_CLOUD_ACCOUNT_ID,t);var o;o=e.currentAccount&&e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?t.id+"@"+e.selectedSite.id+"@"+e.selectedNetwork.id:t.id+"@"+e.selectedSite.id,e.addContentFromSource(e.currentAccount.serviceId,o,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide(),e.currentAccount.loading=!1},function(){e.contentBrowseModal.$scope.$hide(),e.currentAccount.loading=!1}),t.title="Uploading: "+t.title,e.currentContent.data=[t]}},e.formatFileSize=function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]},e.loadAccounts=function(){e.contentAccounts={loading:!0},n.getAccounts().then(function(t){if(t&&t.data)for(var o=0;t.data.length>o;o++){var n=t.data[o];e.contentAccounts[n.serviceId]=n}e.contentAccounts.rawList=t.data,e.contentAccounts.loading=!1})},e.loadAccounts()}],n}]),activitiModule.directive("selectPeoplePopover",["$rootScope","$http","$popover","appResourceRoot","UserService","SystemPropertiesService","$parse",function(e,t,o,n,r,a,i){var l={};return l.restrict="A",l.scope={excludeTaskId:"=excludeTaskId",excludeProcessId:"=excludeProcessId",excludeUserId:"=excludeUserId",excludeUserIds:"=excludeUserIds",tenantId:"=tenantId",type:"=type",restrictWithGroup:"=restrictWithGroup",selectPeopleFormFields:"=selectPeopleFormFields",ignoreContainer:"=ignoreContainer",emailModeDisabled:"=emailModeDisabled"},l.link=function(t,n,l){function d(e){h.popupModel.emailDisabled="true"===e||e===!0?!0:"false"===e||e===!1?!1:t.$eval(e)}var s="bottom";n.addClass("toggle-people-select"),l.placement&&(s=l.placement);var c=l.selectYourselfMode,u=!0;void 0!==l.closeOnSelect&&(u=l.closeOnSelect),t.popover=o(n,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/select-people-popover.html?"+Date.now(),placement:s});var p,m,f;l.onPeopleSelected&&(p=i(l.onPeopleSelected)),l.onCancel&&(m=i(l.onCancel)),l.onEmailSelected&&(f=i(l.onEmailSelected));var g="workflow";null!==t.type&&void 0!==t.type&&(g=t.type);var h=t.popover.$scope;h.title=l.popoverTitle,h.popupModel={emailMode:!1,showRecentResults:!1,userResults:[],userField:{},userFieldFilter:["people"],loading:!1},t.selectPeopleFormFields&&(h.popupModel.formFields=t.selectPeopleFormFields),(l.emailModeDisabled||t.emailModeDisabled)&&(d(t.emailModeDisabled||l.emailModeDisabled),l.hasOwnProperty("emailModeDisabled")&&t.$watch(l.emailModeDisabled,d),t.hasOwnProperty("emailModeDisabled")&&t.$watch("emailModeDisabled",d)),(void 0==h.popupModel.emailDisabled||0==h.popupModel.emailDisabled)&&a.getSystemProperties().then(function(e){h.popupModel.emailDisabled=!e.allowInvolveByEmail});var T=function(){if(h.popupModel.emailMode=!1,e.account&&e.account.capabilities){var t=e.account.capabilities.indexOf("tenant-mgmt")>-1||e.account.capabilities.indexOf("tenant-admin")>-1;t===!1&&(null===h.account.tenantId||void 0===h.account.tenantId)&&(h.popupModel.emailMode=!0)}};T(),h.setSearchType=function(){h.popupModel.userSourceType="search"},h.setFormFieldType=function(){h.popupModel.userSourceType="field"},h.$watch("popupModel.userField",function(){if(h.popupModel.userField&&h.popupModel.userField.id){if(p){var e={id:h.popupModel.userField.id,name:h.popupModel.userField.name,email:h.popupModel.userField.email,type:h.popupModel.userField.type};p(t.$parent,{userField:e}),h.popupModel.userField={}}(u||"true"===u)&&h.$hide()}}),h.$watch("popupModel.filter",function(){if(h.popupModel.filter&&h.popupModel.filter.length>0){h.popupModel.loading=!0;var e;e="idm"===g?r.getFilteredUsersStrict(h.popupModel.filter,t.tenantId,t.restrictWithGroup):r.getFilteredUsers(h.popupModel.filter,t.excludeTaskId,t.excludeProcessId,t.tenantId,t.restrictWithGroup),e.then(function(e){h.popupModel.showRecentResults=!1,h.popupModel.loading=!1;var o=[],n=null!==t.excludeUserId&&void 0!==t.excludeUserId,r=null!==t.excludeUserIds&&void 0!==t.excludeUserIds;if(n===!0||r===!0)for(var a=0;e.data.length>a;a++){var i=!1;n===!0&&e.data[a].id===t.excludeUserId&&(i=!0),r===!0&&t.excludeUserIds.indexOf(e.data[a].id)>=0&&(i=!0),i||o.push(e.data[a])}else o=e.data;h.popupModel.userResults=o,h.resetSelection()})}else h.resetSelection(),h.popupModel.userResults=[]}),h.resetSelection=function(){h.popupModel.selectedUser=void 0,h.popupModel.selectedIndex=-1},h.nextUser=function(){var e=h.popupModel.userResults;e&&e.length>0&&h.popupModel.selectedIndex<e.length-1&&(h.popupModel.selectedIndex+=1,h.popupModel.selectedUser=e[h.popupModel.selectedIndex])},h.previousUser=function(){var e=h.popupModel.userResults;e&&e.length>0&&h.popupModel.selectedIndex>0&&(h.popupModel.selectedIndex-=1,h.popupModel.selectedUser=e[h.popupModel.selectedIndex])},h.confirmUser=function(e){if(!e){var o=h.popupModel.userResults;h.popupModel.selectedIndex>=0&&h.popupModel.selectedIndex<o.length&&(e=o[h.popupModel.selectedIndex])}if(e)if(p&&p(t.$parent,{user:e}),"true"===u)h.$hide();else{var o=h.popupModel.userResults;o.splice(jQuery.inArray(e,o),1),h.popupModel.selectedIndex=0,h.popupModel.selectedUser=o[h.popupModel.selectedIndex]}},h.selectPersonByEmail=function(e){e&&f&&(f(t.$parent,{email:h.popupModel.email}),h.$hide())},h.getSelectYourselfLabelKey=function(){return"INVOLVE-PEOPLE."+c.toUpperCase()+"-YOURSELF"},h.isCurrentUserSelectable=function(){return c&&!(t.excludeUserId&&t.excludeUserId==e.account.id||t.excludeUserIds&&-1!=t.excludeUserIds.indexOf(e.account.id))},h.selectYourself=function(){p&&(p(t.$parent,{user:e.account}),h.$hide())},h.$on("tooltip.hide",function(){h.popupModel.showRecentResults&&h.popupModel.added&&(h.popupModel.recentUsers=[]),h.popupModel.userResults=[],h.popupModel.filter="",h.popupModel.emailMode=!1,T(),h.popupModel.added?h.popupModel.added=!1:m&&m(t.$parent)})},l}]),activitiModule.directive("selectFunctionalGroupPopover",["$rootScope","$http","$popover","FunctionalGroupService","$parse",function(e,t,o,n,r){var a={};return a.restrict="A",a.scope={type:"=type",restrictWithGroup:"=restrictWithGroup",excludeGroupIds:"=excludeGroupIds"},a.link=function(t,a,i){var l="bottom";a.addClass("toggle-functional-group-select"),i.placement&&(l=i.placement);var d=!0;void 0!==i.closeOnSelect&&(d=i.closeOnSelect),t.popover=o(a,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/select-functional-group-popover.html?"+Date.now(),placement:l});var s,c;i.onGroupSelected&&(s=r(i.onGroupSelected)),i.onCancel&&(c=r(i.onCancel));var u=t.popover.$scope;u.title=i.popoverTitle,u.popupModel={groupResults:[]},u.$watch("popupModel.filter",function(){if(u.popupModel.filter&&u.popupModel.filter.length>0){var o;null!==e.common&&void 0!==e.common&&null!==e.common.selectedTenantId&&void 0!==e.common.selectedTenantId&&(o=e.common.selectedTenantId>0?e.common.selectedTenantId:void 0),n.getFilteredGroups(u.popupModel.filter,t.restrictWithGroup,o).then(function(e){var o=[];if(null!=t.excludeGroupId&&t.excludeGroupId)for(var n=0;e.data.length>n;n++)e.data[n].id!==t.excludeGroupId&&o.push(e.data[n]);else if(null!=t.excludeGroupIds&&void 0!==t.excludeGroupIds)for(var n=0;e.data.length>n;n++)0>t.excludeGroupIds.indexOf(e.data[n].id)&&o.push(e.data[n]);else o=e.data;u.popupModel.groupResults=o,u.resetSelection()})}else u.resetSelection(),u.popupModel.groupResults=[]}),u.resetSelection=function(){u.popupModel.selectedGroup=void 0,u.popupModel.selectedIndex=-1},u.nextGroup=function(){var e=u.popupModel.groupResults;e&&e.length>0&&u.popupModel.selectedIndex<e.length-1&&(u.popupModel.selectedIndex+=1,u.popupModel.groupUser=e[u.popupModel.selectedIndex])},u.previousGroup=function(){var e=u.popupModel.groupResults;e&&e.length>0&&u.popupModel.selectedIndex>0&&(u.popupModel.selectedIndex-=1,u.popupModel.selectedGroup=e[u.popupModel.selectedIndex])},u.confirmGroup=function(e){if(!e){var o=u.popupModel.groupResults;u.popupModel.selectedIndex>=0&&u.popupModel.selectedIndex<o.length&&(e=o[u.popupModel.selectedIndex])}if(e)if(s&&s(t.$parent,{group:e}),"true"===d)u.$hide();else{var o=u.popupModel.groupResults;o.splice(jQuery.inArray(e,o),1),u.popupModel.selectedIndex=0,u.popupModel.selectedGroup=o[u.popupModel.selectedIndex]}},u.$on("tooltip.hide",function(){u.popupModel.groupResults=[],u.popupModel.filter="",u.popupModel.added?u.popupModel.added=!1:c&&c(t.$parent)})},a}]),activitiModule.directive("tabControl",["$compile","$http","$templateCache",function(e,t,o){var n=function(n,r){if(!n.activeTemplate||n.activeTemplate!=n.activeTab.id){var a=$(r.children()[1]),i=angular.element(r.children()[1]).scope();if(n.activeTemplate&&i!=n&&i.$destroy(),n.activeTab&&n.activeTab.templateUrl){var l=t.get(n.activeTab.templateUrl,{cache:o});l.success(function(e){a.html(e)}).then(function(){n.activeTemplate=n.activeTab.id,a.replaceWith(e(a.html())(n))})}else a.empty()}},r={};return r.restrict="A",r.replace=!0,r.transclude=!0,r.template='<div><div class="clearfix"><ul class="tabs clearfix"><li ng-repeat="tab in tabs" ng-class="{\'active\': tab.id == activeTab.id}"><a ng-click="tabClicked(tab)">{{tab.title && (tab.title | translate) || (tab.name | translate)}}</a></li></ul></div><div></div></div>',r.scope={possibleTabs:"=tabControl",model:"=model",activeTabReference:"=activeTab"},r.controller=["$scope","$element",function(e,t){e.refreshTabs=function(){for(var t=[],o=0;e.possibleTabs.length>o;o++){var n=e.possibleTabs[o];n.hide||t.push(n)}e.tabs=t},e.$watch("possibleTabs",function(){e.refreshTabs()},!0),e.$watch("activeTabReference",function(t){if(!e.activeTab||e.activeTab.id!=t){var o=e.findTab(t);o&&e.tabClicked(o)}}),e.findTab=function(t){if(e.possibleTabs)for(var o=0;e.possibleTabs.length>o;o++)if(e.possibleTabs[o].id==t)return e.possibleTabs[o];return void 0},e.tabClicked=function(o){o.hide&&(o.hide=!1,e.refreshTabs()),e.activeTab=o,e.activeTabReference=o?o.id:void 0,n(e,t)},e.refreshTabs(),e.tabs&&e.tabs.length>0&&(e.activeTabReference&&(e.activeTab=e.findTab(e.activeTabReference)),e.activeTab||(e.activeTab=e.tabs[0]),e.tabClicked(e.activeTab))}],r.link=n,r}]),activitiModule.directive("toggleDragover",["$document","$parse",function(e,t){var o=function(e,o,n){var r=n.toggleDragover,a=t(r),i=o[0];i.addEventListener("dragenter",function(){return e.$apply(function(){a(e,{over:!0})}),!1},!1),i.addEventListener("dragleave",function(){return e.$apply(function(){a(e,{over:!1})}),!1},!1)};return o}]),activitiModule.directive("editInPlace",function(){return{restrict:"E",scope:{value:"="},template:'<span ng-click="edit()" ng-bind="value"></span><span class="glyphicon glyphicon-pencil edit-in-place-icon"></span><input ng-model="value" class="inline-edit-value form-control" ng-blur="stopEdit()" custom-keys enter-pressed="stopEdit()">',link:function(e,t){angular.element(t.children()[1]);
var o=angular.element(t.children()[2]);t.addClass("edit-in-place"),e.editing=!1,e.edit=function(){e.editing=!0,t.addClass("active"),o[0].focus()},e.stopEdit=function(){e.editing=!1,t.removeClass("active")}}}});var _internalCreateModal=function(e,t,o){return null!==o&&void 0!==o?(o.modal=t(e),o.$on("$routeChangeStart",function(){o.modal&&o.modal.hide()}),o.modal):t(e)};activitiModule.directive("modalPropertyEditor",["$modal",function(e){return{restrict:"E",scope:!1,link:function(t,o,n){var r={template:n.template?n.template+"?version="+Date.now():null,scope:t};n.backdrop&&(r.backdrop=n.backdrop),n.keyboard&&(r.keyboard="true"===n.keyboard),_internalCreateModal(r,e,t)}}}]),activitiModule.directive("numberInputCheck",function(){return{require:"ngModel",link:function(e,t,o,n){var r={positiveOnly:o.numberPositiveOnly?!0:!1,moneyFraction:o.numberMoneyFraction?!0:!1};n.$parsers.push(function(e){var t;e&&0===e.indexOf("-")&&!r.positiveOnly?(t=e.substr(1).replace(/([^0-9])/g,""),t="-"+t):t=e.replace(/([^0-9])/g,"");var o=parseInt(t);return isNaN(o)||r.moneyFraction||(t=""+o),t!=e&&(n.$setViewValue(t),n.$render()),t})}}}),activitiModule.directive("numberMinValue",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){var r=function(e){var t=!0;if(o.numberMinValue)if(e){var r=parseFloat(o.numberMinValue),a=parseFloat(e);r>a&&(t=!1)}else t=!0;return n.$setValidity("numberMinValue",t),e};n.$parsers.push(r),o.$observe("numberMinValue",function(){return r(n.$viewValue)})}}}),activitiModule.directive("numberMaxValue",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){var r=function(e){var t=!0;if(o.numberMaxValue&&e){var r=parseFloat(o.numberMaxValue),a=parseFloat(e);a>r&&(t=!1)}return n.$setValidity("numberMaxValue",t),e};n.$parsers.push(r),o.$observe("numberMaxValue",function(){return r(n.$viewValue)})}}}),activitiModule.directive("maskedInput",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n){e(function(){var e=n.maskedInput;e&&o.mask(e,{placeholder:n.maskedInputPlaceholder,reverse:"true"===n.maskedInputReversed})})}}}]),activitiModule.directive("columnListScroll",["$rootScope","$timeout","$interval",function(e,t,o){return{restrict:"A",scope:{},link:function(e,n,r){n.addClass("column-container-scroll"),e.columnHeaderClass=r.columnListScroll||"column-header",e.updateHeight=function(){var t;e.header?t=e.header.outerHeight():n.parent().children("."+e.columnHeaderClass).each(function(){if(e.header=angular.element(this),e.header.addClass("column-header-fixed"),e.resizeSensor=new ResizeSensor(this,e.updateHeight),e.header.hasClass("ng-hide"))var n=o(function(){e.header.hasClass("ng-hide")||(o.cancel(n),e.updateHeight())},20,400,!1);else t=e.header.outerHeight()}),t&&(e.emptyChild||(e.emptyChild=n.children(".column-list-scroll-push")),e.emptyChild&&e.emptyChild.height(t))},t(e.updateHeight,1),e.$on("$destroy",function(){e.header&&e.resizeSensor.detach(e.header[0])})}}}]),activitiModule.directive("externalTarget",function(){return{restrict:"A",scope:{href:"@"},link:function(e,t,o){var n=t[0];e.$watch("href",function(){(n.protocol!=location.protocol||n.host!=location.host)&&(n.target=o.externalTarget)})}}}),activitiModule.config(["$httpProvider","$translateProvider",function(e){e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.get["Cache-Control"]="no-cache, no-store, must-revalidate",e.defaults.headers.get.Pragma="no-cache",e.defaults.headers.get.Expires="0"}]),function(){if(null!==ACTIVITI.CONFIG.isEventTrackingEnabled&&void 0!==ACTIVITI.CONFIG.isEventTrackingEnabled&&ACTIVITI.CONFIG.isEventTrackingEnabled===!0)if(null!==ACTIVITI.CONFIG.trackingCode&&void 0!==ACTIVITI.CONFIG.trackingCode){(function(e,t,o,n,r,a,i){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,a=t.createElement(o),i=t.getElementsByTagName(o)[0],a.async=1,a.src=n,i.parentNode.insertBefore(a,i)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");var e;e=null!==ACTIVITI.CONFIG.isDevMode&&void 0!==ACTIVITI.CONFIG.isDevMode&&ACTIVITI.CONFIG.isDevMode===!0?{cookieDomain:"none"}:"auto",ga("create",ACTIVITI.CONFIG.trackingCode,e),ga("require","displayfeatures"),ga("send","pageview")}else console.log("Could not initialise event tracking: no tracking code found (set property in ACTIVITI.CONFIG.trackingCode)")}(),activitiModule.run(["$rootScope","$location","EventTrackingService",function(e,t,o){e.$on("$locationChangeSuccess",function(){var e=t.url();null!==e&&void 0!==e&&e.length>0&&o.trackPageView(t.url())})}]),activitiModule.config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate","EventTrackingService",function(e,t){return function(o,n){if(e(o,n),o){var r;o&&o.stack&&(r=angular.toJson(o.stack)),r&&t.trackException(r,!1)}}}])}]),activitiModule.service("EventTrackingService",[function(){var e=function(){return null!==ACTIVITI.CONFIG.isEventTrackingEnabled&&void 0!==ACTIVITI.CONFIG.isEventTrackingEnabled&&ACTIVITI.CONFIG.isEventTrackingEnabled===!0},t=function(e){null!==ACTIVITI.CONFIG.isDevMode&&void 0!==ACTIVITI.CONFIG.isDevMode&&ACTIVITI.CONFIG.isDevMode===!0&&console.log("[Event Tracker] "+e)};this.trackPageView=function(o){e()&&(t("pageview : "+o),ga("set","page",o),ga("send","pageview"))},this.trackEvent=function(o,n,r,a){e()&&(t("custom event : "+o+" - "+n),ga("send","event",o,n,r,a))},this.trackException=function(o,n){e()&&(t("exception : "+o+", is fatal: "+n),ga("send","event","exception","webapp",o.substring(0,400)))}}]),activitiModule.filter("trackEvent",["EventTrackingService",function(e){return function(t,o,n,r,a){return e.trackEvent(o,n,r,a),t}}]),activitiApp.service("RuntimeAppDefinitionService",["$http","$q","$location","EventTrackingService","AuthenticationSharedService","appName",function(e,t,o,n,r,a){var i=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getApplications=function(){var e=r.hasTenantManagementCapability()||r.hasTenantAdminCapability(),t=[],n=o.absUrl(),l=n.indexOf("/#");l>=0&&(n=n.substring(0,l)),l=n.indexOf("?"),l>=0&&(n=n.substring(0,l)),"/"==n[n.length-1]&&(n=n.substring(0,n.length-1)),a.length>0&&n.substring(n.length-a.length)==a&&(n=n.substring(0,n.length-a.length-1));var d={editor:n+"/editor/",identity:n+"/idm/",workflow:n+"/workflow/",admin:"http://localhost:8080/activiti-admin",analytics:n+"/analytics/"},s=function(o){for(var r=JSON.parse(o),a=[],i=0;r.data.length>i;i++){var l=r.data[i];if(void 0!==l.defaultAppId&&null!==l.defaultAppId)if("kickstart"===l.defaultAppId)t.push({id:"kickstart",titleKey:"APP.KICKSTART.TITLE",descriptionKey:"APP.KICKSTART.DESCRIPTION",defaultAppId:l.defaultAppId,theme:"theme-1",icon:"icon icon-choice",fixedBaseUrl:d.editor+"/#/",fixedUrl:d.editor,pages:["processes","forms","apps","stencils","decision-tables","data-models"]});else if("tasks"===l.defaultAppId)t.push({id:"tasks",titleKey:"APP.TASKS.TITLE",descriptionKey:"APP.TASKS.DESCRIPTION",defaultAppId:l.defaultAppId,theme:"theme-2",icon:"icon icon-clock",fixedBaseUrl:d.workflow+"/#/",fixedUrl:d.workflow,pages:["tasks","processes","processes?mode=start"]});else if("identity"===l.defaultAppId){var s={id:"identity",titleKey:e?"APP.IDENTITY-MANAGEMENT.TITLE-TENANT-ADMIN":"APP.IDENTITY-MANAGEMENT.TITLE",descriptionKey:e?"APP.IDENTITY-MANAGEMENT.DESCRIPTION-TENANT-ADMIN":"APP.IDENTITY-MANAGEMENT.DESCRIPTION",defaultAppId:l.defaultAppId,theme:"theme-3",icon:"icon icon-user",fixedBaseUrl:d.identity+"/#/",fixedUrl:d.identity};e&&(s.pages=["tenant-mgmt","user-mgmt","system-group-mgmt","functional-group-mgmt","profile"]),t.push(s)}else"analytics"===l.defaultAppId&&t.push({id:"analytics",titleKey:"APP.ANALYTICS.TITLE",descriptionKey:"APP.ANALYTICS.DESCRIPTION",defaultAppId:l.defaultAppId,theme:"theme-6",icon:"glyphicon glyphicon-stats",fixedBaseUrl:d.analytics+"/#/",fixedUrl:d.analytics});else l.icon="glyphicon "+l.icon,l.fixedBaseUrl=n+"/workflow/#/apps/"+l.id+"/",l.fixedUrl=l.fixedBaseUrl+"tasks",l.pages=["tasks","processes","processes?mode=start"],l.deletable=!0,a.push(l)}return{defaultApps:t,customApps:a}};return i({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/runtime/app-definitions",transformResponse:s})},this.deleteAppDefinition=function(e){var t=i({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/runtime/app-definitions/"+e});return t.then(function(){n.trackEvent("landing","runtime-app-delete")}),t}}]),activitiModule.service("FunctionalGroupService",["$http","$q",function(e,t){var o=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getFilteredGroups=function(e,t,n){var r={};return null!==e&&void 0!==e&&(r.filter=e),t&&t.id&&(r.groupId=t.id),null!==n&&void 0!==n&&(r.tenantId=n),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/workflow-groups",params:r})}}]),angular.module("activitiApp").service("DocumentTemplateService",["$http","$q","$rootScope","$translate",function(e,t){var o=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.findAllDocumentTemplates=function(e,t,n,r,a){var i={tenantId:e,nameFilter:t,start:r,size:a,sort:n};return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/document-templates",params:i})},this.deleteDocumentTemplate=function(e){return o({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/document-templates/"+e})}}]),activitiApp.service("SystemPropertiesService",["$http","$q",function(e,t){var o=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getSystemProperties=function(){return o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties"})},this.getPasswordValidationConstraints=function(e){return(void 0===e||null===e)&&(e="-1"),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties/password-validation-constraints/"+e})},this.canInvolvedUsersEditForms=function(e){return(void 0===e||null===e)&&(e="-1"),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties/involved-users-can-edit-forms/"+e})},this.getGlobalDateFormat=function(e){return(void 0===e||null===e)&&(e="-1"),o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/system/properties/global-date-format/"+e})}}]),activitiApp.provider("licenseStatus",function(){var e=null;this.licenseStatusResolver=["$q","$rootScope","$http","$translate",function(t,o,n,r){if(o.licenseStatus)return e;var a=function(a){var i=t.defer();return n(a).success(function(t){o.readOnly="valid"!==t.status,o.multiTenantMode=t.multiTenant,o.allowLicenseUpload=t.allowUpload,t.warning?(o.licenseWarning=t.warning,o.addAlert(r.instant("COMMON.WARNING.APP-LICENSE-WARNING-"+t.warning.toUpperCase()),"error")):null==e&&o.readOnly&&(o.licenseStatus=t.status,o.addAlert(r.instant("COMMON.WARNING.APP-LICENSE-ISSUE-"+t.status.toUpperCase()),"error")),e=t.status,i.resolve(e)}).error(function(){o.authenticated&&o.addAlert(r.instant("COMMON.WARNING.APP-LICENSE-ISSUE-NOT-FOUND"),"error"),i.resolve("not-found")}),i.promise};return a({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/license"})}],this.$get=[function(){}]}),activitiApp.controller("AboutActivitiPopupCrtl",["$rootScope","$scope","$http","$translate","$interval","$dateFormatter",function(e,t,o,n,r,a){t.popup={loading:!0,activitiVersion:{},licenseHolder:""},o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/about-info"}).success(function(e){t.popup.licenseHolder=e.holder,t.popup.activitiVersion=e.versionInfo.edition+" v"+e.versionInfo.majorVersion+"."+e.versionInfo.minorVersion+"."+e.versionInfo.revisionVersion,t.popup.activitiVersionType=e.versionInfo.type,e.goodBeforeDate&&(t.popup.goodBeforeDate=a.formatDate(new Date(e.goodBeforeDate))),t.popup.loading=!1}).error(function(){t.popup.loading=!1}),t.cancel=function(){t.close()},t.close=function(){t.$hide()}}]),activitiModule.filter("startFrom",function(){return function(e,t){return e?(t=+t,e.slice(t)):[]}}),activitiModule.filter("regex",function(){return function(e,t,o){2==arguments.length&&(o=t);for(var n=RegExp(o),r=[],a=0;e.length>a;a++)n.test(e[a][t])&&r.push(e[a]);return r}}),activitiModule.filter("toDate",function(){return function(e,t){return e?moment(e,t||"DD-MM-YYYY").toDate():void 0}}),activitiModule.filter("decodeHtml",["$sce",function(e){var t=document.createElement("div");return function(o){return t.innerHTML=o,e.getTrustedHtml(e.trustAsHtml(t.textContent))}}]);