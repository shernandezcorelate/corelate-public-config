"use strict";var activitiApp=angular.module("activitiApp",["http-auth-interceptor","ngCookies","ngResource","ngSanitize","ngRoute","ngDragDrop","mgcrea.ngStrap","ngFileUpload","ngAnimate","pascalprecht.translate","nvd3ChartDirectives"]),activitiModule=activitiApp;activitiApp.config(["$routeProvider","$selectProvider","$datepickerProvider","$provide","$translateProvider",function(e,t,o,n,r){var i="analytics";n.value("appName",i);var a=ACTIVITI.CONFIG.webContextRoot+(ACTIVITI.CONFIG.webContextRoot?"/"+i+"/":"");n.value("appResourceRoot",a),angular.extend(t.defaults,{caretHtml:'&nbsp;<i class="icon icon-caret-down"></i>'}),angular.extend(o.defaults,{iconLeft:"icon icon-caret-left",iconRight:"icon icon-caret-right"});var c=["$rootScope","AuthenticationSharedService",function(e,t){return e.authenticated?(e.authenticated=!0,!0):t.authenticate()}];e.when("/reports",{templateUrl:a+"views/reports.html",controller:"ReportsController",resolve:{verify:c}}).otherwise({redirectTo:ACTIVITI.CONFIG.appDefaultRoute||"/reports"}),r.useSanitizeValueStrategy("sanitizeParameters"),r.useStaticFilesLoader({prefix:a+"i18n/",suffix:".json"}),r.preferredLanguage(window.ACTIVITI_PREFERRED_LOCALE)}]).run(["$rootScope","$timeout","$translate","$location","$http","$window","appResourceRoot",function(e,t,o,n,r,i,a){e.appResourceRoot=a,e.restRootUrl=function(){return ACTIVITI.CONFIG.contextRoot};var c=o.proposedLanguage();"de"!==c&&"en"!==c&&"es"!==c&&"fr"!==c&&"it"!==c&&o.use("en"),e.window={};var l=function(){e.window.width=i.innerWidth,e.window.height=i.innerHeight};angular.element(i).bind("resize",function(){e.$apply(l())}),e.$watch("window.forceRefresh",function(o){o&&t(function(){l(),e.window.forceRefresh=!1})}),l(),e.mainNavigation=[{id:"reports",title:"GENERAL.NAVIGATION.REPORTS",path:"/reports"}],e.mainPage=e.mainNavigation[0],e.setMainPage=function(t){e.mainPage=t,n.path(e.mainPage.path)},e.setMainPageById=function(t){for(var o=0;e.mainNavigation.length>o;o++)if(t==e.mainNavigation[o].id){e.mainPage=e.mainNavigation[o];break}},e.alerts={queue:[]},e.showAlert=function(o){o.queue.length>0?(o.current=o.queue.shift(),o.timeout=t(function(){0==o.queue.length?(o.current=void 0,o.timeout=void 0):e.showAlert(o)},"error"==o.current.type?5e3:1e3)):e.alerts.current=void 0},e.addAlert=function(t,o){var n={message:t,type:o};e.alerts.timeout?e.alerts.queue.push(n):(e.alerts.queue.push(n),e.showAlert(e.alerts))},e.dismissAlert=function(){e.alerts.timeout?(t.cancel(e.alerts.timeout),e.alerts.timeout=void 0,e.showAlert(e.alerts)):e.alerts.current=void 0},e.addAlertPromise=function(t,o){t&&t.then(function(t){e.addAlert(t,o)})},e.model={},e.root={},e.loadProcessDefinitions=function(){r({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/process-definitions?latest=true"}).success(function(t){e.root.processDefinitions=t.data}).error(function(e){console.log("Something went wrong: "+e)})},e.loadProcessDefinitions()}]).run(["$rootScope","$location","$window","AuthenticationSharedService","$translate","appName","$modal",function(e,t,o,n,r,i,a){var c="/"+i+"/";e.logout=function(){n.logout()},e.showAboutActiviti=function(){_internalCreateModal({template:"../views/modal/about-activiti.html?"+(new Date).getTime(),show:!0},a,e)};var l=function(e){var n,r=t.absUrl(),i=r.indexOf(c);n=null!==e&&void 0!==e&&void 0!==e.isFromLogout&&e.isFromLogout===!0?r.substring(0,i)+"/#login":r.substring(0,i)+"/#login?redirectUrl="+encodeURIComponent(o.location.pathname+o.location.hash),o.location.href==n?window.location.reload():o.location.href=n};e.$on("event:auth-loginRequired",function(){e.authenticated=!1,e.authenticationChecked=!0,l()}),e.$on("event:auth-authConfirmed",function(){e.authenticated=!0,e.authenticationChecked=!0,(""==t.path()||"#"==t.path()||"/login"==t.path())&&t.path("/")}),e.$on("event:auth-loginConfirmed",function(){n.authenticate()}),e.$on("event:auth-loginCancelled",function(t,o){e.authenticated=!1,l(o)}),e.$on("event:auth-loginFailed",function(){e.addAlertPromise(r("LOGIN.MESSAGES.ERROR.AUTHENTICATION"),"error")}),e.backToLanding=function(){var e=t.absUrl(),n=e.indexOf(c);n>=0&&(e=e.substring(0,n),e+="/"),o.location.href=e};var u=function(t){return e.account&&e.account.capabilities?e.account.capabilities.indexOf(t)>-1:!1};e.hasAccessReportsCapability=function(){return u("access-reports")}}]).filter("dateformat",function(){return function(e,t){return e?"fromNow"==t?moment(e).fromNow():"fromNowFull"==t?moment(e).fromNow()+" ("+moment(e).format("MMMM Do YYYY")+")":t?moment(e).format(t):moment(e).calendar():""}}).filter("username",function(){return function(e){return e?e.firstName?e.firstName+" "+e.lastName:e.lastName:""}}),nv.dev=!1,angular.module("activitiApp").directive("input",["$parse",function(e){return{restrict:"E",require:"?ngModel",link:function(t,o,n,r){function i(e){return e.format(c.format)}function a(e){return[i(e.startDate),i(e.endDate)].join(c.separator)}if("daterange"===n.type&&null!==r){var c={};c.format=n.format||"YYYY-MM-DD",c.separator=n.separator||" - ",c.minDate=n.minDate&&moment(n.minDate),c.maxDate=n.maxDate&&moment(n.maxDate),c.dateLimit=n.limit&&moment.duration.apply(this,n.limit.split(" ").map(function(e,t){return 0===t&&parseInt(e,10)||e})),c.ranges=n.ranges&&e(n.ranges)(t),c.locale=n.locale&&e(n.locale)(t),c.opens=n.opens&&e(n.opens)(t),r.$formatters.unshift(function(e){return e?e:""}),r.$parsers.unshift(function(e){return e}),r.$render=function(){r.$viewValue&&r.$viewValue.startDate&&o.val(a(r.$viewValue))},t.$watch(n.ngModel,function(e){return e&&e.startDate?(o.data("daterangepicker").startDate=e.startDate,o.data("daterangepicker").endDate=e.endDate,o.data("daterangepicker").updateView(),o.data("daterangepicker").updateCalendars(),o.data("daterangepicker").updateInputText(),void 0):(r.$setViewValue({startDate:moment().startOf("day"),endDate:moment().startOf("day")}),void 0)}),o.daterangepicker(c,function(e,o,n){t.$apply(function(){r.$setViewValue({startDate:e,endDate:o,rangeName:n}),r.$render()})})}}}}]),angular.module("activitiApp").service("ReportService",["$http","$q","EventTrackingService",function(e,t,o){var n=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getReports=function(){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/reports"})},this.generateDefaultReports=function(){return n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/default-reports"})},this.getReportParameters=function(e){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/report-params/"+e})},this.generateReport=function(e,t){var r=n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/report-params/"+e,data:t});return r.then(function(){o.trackEvent("reporting","generate-report")}),r},this.saveReport=function(e,t,r){r.__reportName=t;var i=n({method:"POST",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/reports/"+e,data:r});return i.then(function(){o.trackEvent("reporting","save-report")}),i},this.updateReport=function(e,t){return n({method:"PUT",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/reports/"+e,data:{name:t}})},this.deleteReport=function(e){var t=n({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/reports/"+e});return t.then(function(){o.trackEvent("reporting","delete-report")}),t},this.getTasksForProcessDefinitionId=function(e,t){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/report-params/"+e+"/tasks?processDefinitionId="+t})},this.getProcessDefinitions=function(){return n({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/reporting/process-definitions"})}}]),angular.module("activitiApp").controller("ReportsController",["$rootScope","$scope","$route","$translate","$q","$modal","ReportService","Utils",function(e,t,o,n,r,i,a,c){t.hasAccessReportsCapability()||t.backToLanding(),t.setMainPageById("reports"),t.model={loading:!0},t.generateDefaultReports=function(){t.model.loading=!0,a.generateDefaultReports().then(function(){o.reload()})};var l=function(){delete t.model.currentReport,delete t.model.currentReportData};t.showParameters=function(){return null!==t.model.currentReport&&void 0!==t.model.currentReport&&null!==t.model.currentReport.definition&&void 0!==t.model.currentReport.definition&&null!==t.model.currentReport.definition.parameters&&void 0!==t.model.currentReport.definition.parameters&&t.model.currentReport.definition.parameters.length>0},t.showReport=function(e){t.model.loading=!0,l(),a.getReportParameters(e).then(function(e){if(e.definition=JSON.parse(e.definition),null!==e.definition.parameters&&void 0!==e.definition.parameters)for(var o=0;e.definition.parameters.length>o;o++){var n=e.definition.parameters[o];if("dateRange"===n.type){if(null!==n.value&&void 0!==n.value){var r=n.value.rangeId;null!==r||void 0!==r?"today"===r?(n.value.startDate=moment().startOf("day"),n.value.endDate=moment().startOf("day")):"yesterday"===r?(n.value.startDate=moment().subtract("days",1).startOf("day"),n.value.endDate=moment().subtract("days",1).startOf("day")):"last7Days"===r?(n.value.startDate=moment().subtract("days",6).startOf("day"),n.value.endDate=moment().startOf("day")):"previousMonth"===r?(n.value.startDate=moment().subtract("month",1).startOf("month"),n.value.endDate=moment().subtract("month",1).endOf("month")):"currentYear"===r?(n.value.startDate=moment().startOf("year"),n.value.endDate=moment().startOf("day")):(n.value.startDate=moment(n.value.startDate),n.value.endDate=moment(n.value.endDate)):(n.value.startDate=moment(n.value.startDate),n.value.endDate=moment(n.value.endDate))}}else"duration"===n.type&&(n.durationUnit="sec",n.valueForUser=n.value)}t.model.currentReport=e,t.parameterValueUpdated()})};var u=function(){var e={};if(t.model.currentReport&&t.model.currentReport.definition&&t.model.currentReport.definition.parameters)for(var o=0;t.model.currentReport.definition.parameters.length>o;o++){var n=t.model.currentReport.definition.parameters[o];e[n.id]=n.value}return e};t.generateCurrentReport=function(){t.model.loading=!0;var e=u();a.generateReport(t.model.currentReport.id,e).then(function(e){t.model.currentReportData=e,t.model.loading=!1})},t.parameterValueUpdated=function(){var e=function(){if(t.model.currentReport&&t.model.currentReport.definition&&t.model.currentReport.definition.parameters){for(var e=0;t.model.currentReport.definition.parameters.length>e;e++)if(null===t.model.currentReport.definition.parameters[e].value||void 0==t.model.currentReport.definition.parameters[e].value||""===t.model.currentReport.definition.parameters[e].value)return!1;return!0}return!1};e()?t.generateCurrentReport():t.model.loading=!1},t.reportTitleChanged=function(){a.updateReport(t.model.currentReport.id,t.model.currentReport.name).then(function(){for(var e=0;t.model.reports.length>e;e++)t.model.reports[e].id===t.model.currentReport.id&&(t.model.reports[e].name=t.model.currentReport.name);t.model.currentReport.editingName=!1})},t.showSaveReportModal=function(){t.model.newReportName=t.model.currentReport.name+" ("+c.getCurrentDateAsFormattedShortString()+")",_internalCreateModal({scope:t,template:"views/modal/save-report-modal.html",show:!0},i,t)};var s=function(){"ENTERPRISE"===t.account.type.toUpperCase()?a.getReports().then(function(e){t.model.reports=e,t.model.loading=!1}):t.model.reports=[]};t.saveReport=function(){t.model.loading=!0;var e=u();a.saveReport(t.model.currentReport.id,t.model.newReportName,e).then(function(){t.model.loading=!1,s()})},t.showDeleteReportModal=function(){_internalCreateModal({scope:t,template:"views/modal/delete-report-modal.html",show:!0},i,t)},t.deleteReport=function(){t.model.loading=!0,a.deleteReport(t.model.currentReport.id).then(function(){l(),s()})},s()}]),angular.module("activitiApp").controller("ReportingParamProcessDefinitionSelectController",["$rootScope","$scope","ReportService",function(e,t,o){o.getProcessDefinitions().then(function(e){t.model.processDefinitions=e})}]),angular.module("activitiApp").controller("ReportingParamTaskSelectController",["$rootScope","$scope","ReportService",function(e,t,o){t.setParameter=function(e){if(e.dependsOn){for(var n,r=0;t.model.currentReport.definition.parameters.length>r;r++)if(e.dependsOn===t.model.currentReport.definition.parameters[r].id){n=r;break}void 0!=n&&n>=0&&t.$watch("model.currentReport.definition.parameters["+n+"].value",function(n){null!==n&&void 0!==n&&""!==n&&(e.taskNames&&(e.taskNames.length=0),o.getTasksForProcessDefinitionId(t.model.currentReport.id,n).then(function(t){e.taskNames=t}))},!1)}}}]),angular.module("activitiApp").controller("ReportingParamDateIntervalController",["$rootScope","$scope","$q","$translate",function(e,t,o,n){o.all([n("REPORTING.PARAMETER-WIDGETS.DATE-INTERVAL-OPTIONS.HOUR"),n("REPORTING.PARAMETER-WIDGETS.DATE-INTERVAL-OPTIONS.DAY"),n("REPORTING.PARAMETER-WIDGETS.DATE-INTERVAL-OPTIONS.WEEK"),n("REPORTING.PARAMETER-WIDGETS.DATE-INTERVAL-OPTIONS.MONTH"),n("REPORTING.PARAMETER-WIDGETS.DATE-INTERVAL-OPTIONS.YEAR")]).then(function(e){var o=[];o.push({id:"byHour",name:e[0]}),o.push({id:"byDay",name:e[1]}),o.push({id:"byWeek",name:e[2]}),o.push({id:"byMonth",name:e[3]}),o.push({id:"byYear",name:e[4]}),t.model.dateIntervalOptions=o})}]),angular.module("activitiApp").controller("ReportingParamDurationController",["$rootScope","$scope","$translate","$q",function(e,t,o,n){t.setParameter=function(e){e.durationUnit||(e.durationUnit="day")},n.all([o("REPORTING.PARAMETER-WIDGETS.DURATION.DAYS"),o("REPORTING.PARAMETER-WIDGETS.DURATION.HOURS"),o("REPORTING.PARAMETER-WIDGETS.DURATION.MINUTES"),o("REPORTING.PARAMETER-WIDGETS.DURATION.SECONDS")]).then(function(e){t.model.durationOptions=[{id:"day",name:e[0]},{id:"hour",name:e[1]},{id:"min",name:e[2]},{id:"sec",name:e[3]}]}),t.reportingParamDurationChanged=function(e){if(null===e.valueForUser||void 0===e.valueForUser)e.valueForUser=0;else{if(angular.isString(e.valueForUser))try{e.valueForUser=parseInt(e.valueForUser),isNaN(e.valueForUser)&&(e.valueForUser=0)}catch(o){e.valueForUser=0}"day"===e.durationUnit?e.value=60*60*24*e.valueForUser:"hour"===e.durationUnit?e.value=60*60*e.valueForUser:"min"===e.durationUnit?e.value=60*e.valueForUser:"sec"===e.durationUnit&&(e.value=e.valueForUser)}t.parameterValueUpdated()}}]),angular.module("activitiApp").controller("ReportingParamIntegerController",["$rootScope","$scope",function(e,t){t.reportingParamIntegerChanged=function(e){if(null===e.value||void 0===e.value)e.value=0;else if(angular.isString(e.value))try{e.value=parseInt(e.value),isNaN(e.value)&&(e.value=0)}catch(o){e.value=0}t.parameterValueUpdated()}}]),angular.module("activitiApp").controller("ReportingParamBooleanController",["$rootScope","$scope",function(e,t){t.reportingParamBooleanChanged=function(e){(null===e.value||void 0===e.value)&&(e.value=0),t.parameterValueUpdated()}}]),angular.module("activitiApp").controller("ReportingParamDateRangeController",["$rootScope","$scope","$q","$translate",function(e,t,o,n){var r={},i=[n("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.TODAY"),n("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.YESTERDAY"),n("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.LAST-7-DAYS"),n("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.PREVIOUS-MONTH"),n("REPORTING.PARAMETER-WIDGETS.DATE-RANGE.CURRENT-YEAR")];o.all(i).then(function(e){var o={};o[e[0]]=[moment().startOf("day"),moment().endOf("day")],r[e[0]]="today",o[e[1]]=[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],r[e[1]]="yesterday",o[e[2]]=[moment().subtract("days",7).startOf("day"),moment().startOf("day")],r[e[2]]="last7Days",o[e[3]]=[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")],r[e[3]]="previousMonth",o[e[4]]=[moment().startOf("year"),moment().startOf("day")],r[e[4]]="currentYear",t.model.specialRanges=o}),t.dateRangeChanged=function(e){o.all(i).then(function(){var o;e&&e.value&&e.value.rangeName&&(o=r[e.value.rangeName]),(null===o||void 0===o)&&e&&e.value&&e.value.startDate.startOf("day").isSame(moment().startOf("day"))&&e.value.endDate.startOf("day").isSame(moment().startOf("day"))&&(o="today",e.value.endDate=moment().endOf("day")),null!==o&&void 0!==o&&(delete e.value.rangeName,e.value.rangeId=o),t.parameterValueUpdated()})}}]),angular.module("activitiApp").controller("ChartWidgetController",["$scope","$q","$translate",function(e,t,o){e.getTranslationOrValue=function(e){return null!==e&&void 0!==e&&e.length>0&&"__KEY_"==e.substring(0,6)?o.instant(e.substring(6,e.length)):e},e.xFunction=function(){return function(e){return e.key}},e.yFunction=function(){return function(e){return e.y}},e.xAxisTickFormatFunction=function(e){return function(t){if(null!==e&&void 0!==e){if("date_day"===e)return moment(new Date(t)).format("DD");if("date_month"===e)return moment(new Date(t)).format("MMMM");if("date_year"===e)return moment(new Date(t)).format("YYYY")}return t}},e.yAxisTickFormatFunction=function(e){return function(t){if(null!==e&&void 0!==e&&"count"===e){var o=""+t;if(-1!==o.indexOf("."))return""}return t}},e.toolTipContentFunctionXtoY=function(){return function(e,t,o){return" "+e+" : "+o.value+" "}},e.toolTipContentFunction=function(e){return function(t,o,n,r){if("date"===e){var i=n;return i&&".0"==i.match(".0$")&&(i=i.substring(0,i.length-2)),d3.time.format("%B %e, %Y")(new Date(r.point[0]))+" : "+i}return n}},e.generateChartId=function(){e.model.nextChartId||(e.model.nextChartId=0);var t=e.model.nextChartId++;return t},e.calculateChartWidth=function(){var e=jQuery("#report").width();return e>300&&(e-=100),100>e&&(e=100),e>700&&(e=700),e},e.calculateChartHeight=function(){return 3*(e.calculateChartWidth()/4)},e.colorFunction=function(e){return function(t,o){return e.customColors[o]}}}]),angular.module("activitiApp").controller("ReportingProcessDefinitionHeatMapController",["$rootScope","$scope","$timeout","$translate","appResourceRoot","ResourceService",function(e,t,o,n,r,i){var a=function(e,n,a){t.element.loading=!0,t.element&&n&&o(function(){var o=jQuery("#bpmnModel"),c=function(){o.empty();var e=jQuery(".qtip");e&&e.length>0&&e.qtip("destroy",!0)};c(),t.$on("$destroy",function(){c()}),o.attr("data-process-definition-id",t.element.processDefinitionId),o.attr("data-model-type","process-definition");var l={};for(var u in n)if(n.hasOwnProperty(u)){var s=n[u],d=(120-1.2*s)/360;l[u]="hsb("+d+", 1, 1)"}o.attr("data-activity-color-mapping",JSON.stringify(l)),o.attr("data-activity-opacity","0.6");var p={};for(var u in e)e.hasOwnProperty(u)&&(p[u]=" "+e[u]+" "+a);o.attr("data-activity-tooltips",JSON.stringify(p));var f=r+"../display/displaymodel.html?version="+Date.now(),Y=window.define;window.define=void 0,i.loadFromHtml(f,function(){window.define=Y,t.element.loading=!1})},100)};t.metricChanged=function(){"totalCount"===t.element.currentMetric?a(t.element.totalCountValues,t.element.totalCountsPercentages,n.instant("REPORTING.DEFAULT-REPORTS.PROCESS-HEAT-MAP.METRIC-TOTAL-COUNT-TOOLTIP")):"totalTime"===t.element.currentMetric?a(t.element.totalTimeValues,t.element.totalTimePercentages,n.instant("REPORTING.DEFAULT-REPORTS.PROCESS-HEAT-MAP.METRIC-TOTAL-TIME-TOOLTIP")):"avgTime"===t.element.currentMetric&&a(t.element.avgTimeValues,t.element.avgTimePercentages,n.instant("REPORTING.DEFAULT-REPORTS.PROCESS-HEAT-MAP.METRIC-AVERAGE-TIME-TOOLTIP"))},t.element.currentMetric="totalCount",t.metricChanged()}]),angular.module("activitiApp").service("Utils",[function(){this.getCurrentDateAsFormattedShortString=function(){var e={"ar-SA":"DD/MM/YY","bg-BG":"DD.M.YYYY","ca-ES":"DD/MM/YYYY","zh-TW":"YYYY/M/DD","cs-CZ":"DD.M.YYYY","da-DK":"DD-MM-YYYY","de-DE":"DD.MM.YYYY","el-GR":"d/M/YYYY","en-US":"M/DD/YYYY","fi-FI":"DD.M.YYYY","fr-FR":"DD/MM/YYYY","he-IL":"DD/MM/YYYY","hu-HU":"YYYY. MM. DD.","is-IS":"DD.M.YYYY","it-IT":"DD/MM/YYYY","ja-JP":"YYYY/MM/DD","ko-KR":"YYYY-MM-DD","nl-NL":"DD-M-YYYY","nb-NO":"DD.MM.YYYY","pl-PL":"YYYY-MM-DD","pt-BR":"DD/M/YYYY","ro-RO":"DD.MM.YYYY","ru-RU":"DD.MM.YYYY","hr-HR":"DD.M.YYYY","sk-SK":"DD. M. YYYY","sq-AL":"YYYY-MM-DD","sv-SE":"YYYY-MM-DD","th-TH":"DD/M/YYYY","tr-TR":"DD.MM.YYYY","ur-PK":"DD/MM/YYYY","id-ID":"DD/MM/YYYY","uk-UA":"DD.MM.YYYY","be-BY":"DD.MM.YYYY","sl-SI":"DD.M.YYYY","et-EE":"DD.MM.YYYY","lv-LV":"YYYY.MM.DD.","lt-LT":"YYYY.MM.DD","fa-IR":"MM/DD/YYYY","vi-VN":"DD/MM/YYYY","hY-AM":"DD.MM.YYYY","az-Latn-AZ":"DD.MM.YYYY","eu-ES":"YYYY/MM/DD","mk-MK":"DD.MM.YYYY","af-ZA":"YYYY/MM/DD","ka-GE":"DD.MM.YYYY","fo-FO":"DD-MM-YYYY","hi-IN":"DD-MM-YYYY","ms-MY":"DD/MM/YYYY","kk-KZ":"DD.MM.YYYY","kY-KG":"DD.MM.YY","sw-KE":"M/d/YYYY","uz-Latn-UZ":"DD/MM YYYY","tt-RU":"DD.MM.YYYY","pa-IN":"DD-MM-YY","gu-IN":"DD-MM-YY","ta-IN":"DD-MM-YYYY","te-IN":"DD-MM-YY","kn-IN":"DD-MM-YY","mr-IN":"DD-MM-YYYY","sa-IN":"DD-MM-YYYY","mn-MN":"YY.MM.DD","gl-ES":"DD/MM/YY","kok-IN":"DD-MM-YYYY","sYr-SY":"DD/MM/YYYY","dv-MV":"DD/MM/YY","ar-IQ":"DD/MM/YYYY","zh-CN":"YYYY/M/DD","de-CH":"DD.MM.YYYY","en-GB":"DD/MM/YYYY","es-MX":"DD/MM/YYYY","fr-BE":"d/MM/YYYY","it-CH":"DD.MM.YYYY","nl-BE":"d/MM/YYYY","nn-NO":"DD.MM.YYYY","pt-PT":"DD-MM-YYYY","sr-Latn-CS":"DD.M.YYYY","sv-FI":"DD.M.YYYY","az-CYrl-AZ":"DD.MM.YYYY","ms-BN":"DD/MM/YYYY","uz-CYrl-UZ":"DD.MM.YYYY","ar-EG":"DD/MM/YYYY","zh-HK":"d/M/YYYY","de-AT":"DD.MM.YYYY","en-AU":"d/MM/YYYY","es-ES":"DD/MM/YYYY","fr-CA":"YYYY-MM-DD","sr-CYrl-CS":"d.M.YYYY","ar-LY":"DD/MM/YYYY","zh-SG":"d/M/YYYY","de-LU":"DD.MM.YYYY","en-CA":"DD/MM/YYYY","es-GT":"DD/MM/YYYY","fr-CH":"DD.MM.YYYY","ar-DZ":"DD-MM-YYYY","zh-MO":"DD/M/YYYY","de-LI":"DD.MM.YYYY","en-NZ":"DD/MM/YYYY","es-CR":"DD/MM/YYYY","fr-LU":"DD/MM/YYYY","ar-MA":"DD-MM-YYYY","en-IE":"DD/MM/YYYY","es-PA":"MM/DD/YYYY","fr-MC":"DD/MM/YYYY","ar-TN":"DD-MM-YYYY","en-ZA":"YYYY/MM/DD","es-DO":"DD/MM/YYYY","ar-OM":"DD/MM/YYYY","en-JM":"DD/MM/YYYY","es-VE":"DD/MM/YYYY","ar-YE":"DD/MM/YYYY","en-029":"MM/DD/YYYY","es-CO":"DD/MM/YYYY","ar-SY":"DD/MM/YYYY","en-BZ":"DD/MM/YYYY","es-PE":"DD/MM/YYYY","ar-JO":"DD/MM/YYYY","en-TT":"DD/MM/YYYY","es-AR":"DD/MM/YYYY","ar-LB":"DD/MM/YYYY","en-ZW":"M/DD/YYYY","es-EC":"DD/MM/YYYY","ar-KW":"DD/MM/YYYY","en-PH":"M/DD/YYYY","es-CL":"DD-MM-YYYY","ar-AE":"DD/MM/YYYY","es-UY":"DD/MM/YYYY","ar-BH":"DD/MM/YYYY","es-PY":"DD/MM/YYYY","ar-QA":"DD/MM/YYYY","es-BO":"DD/MM/YYYY","es-SV":"DD/MM/YYYY","es-HN":"DD/MM/YYYY","es-NI":"DD/MM/YYYY","es-PR":"DD/MM/YYYY","am-ET":"d/M/YYYY","tzm-Latn-DZ":"DD-MM-YYYY","iu-Latn-CA":"d/MM/YYYY","sma-NO":"DD.MM.YYYY","mn-Mong-CN":"YYYY/M/DD","gd-GB":"DD/MM/YYYY","en-MY":"DD/M/YYYY","prs-AF":"DD/MM/YY","bn-BD":"DD-MM-YY","wo-SN":"DD/MM/YYYY","rw-RW":"M/d/YYYY","qut-GT":"DD/MM/YYYY","sah-RU":"MM.DD.YYYY","gsw-FR":"DD/MM/YYYY","co-FR":"DD/MM/YYYY","oc-FR":"DD/MM/YYYY","mi-NZ":"DD/MM/YYYY","ga-IE":"DD/MM/YYYY","se-SE":"YYYY-MM-DD","br-FR":"DD/MM/YYYY","smn-FI":"DD.M.YYYY","moh-CA":"M/DD/YYYY","arn-CL":"DD-MM-YYYY","ii-CN":"YYYY/M/DD","dsb-DE":"d. M. YYYY","ig-NG":"d/M/YYYY","kl-GL":"DD-MM-YYYY","lb-LU":"DD/MM/YYYY","ba-RU":"DD.MM.YY","nso-ZA":"YYYY/MM/DD","quz-BO":"DD/MM/YYYY","Yo-NG":"DD/M/YYYY","ha-Latn-NG":"DD/M/YYYY","fil-PH":"M/DD/YYYY","ps-AF":"DD/MM/YY","fY-NL":"DD-M-YYYY","ne-NP":"M/DD/YYYY","se-NO":"DD.MM.YYYY","iu-Cans-CA":"DD/M/YYYY","sr-Latn-RS":"DD.M.YYYY","si-LK":"YYYY-MM-DD","sr-CYrl-RS":"DD.M.YYYY","lo-LA":"DD/MM/YYYY","km-KH":"YYYY-MM-DD","cY-GB":"DD/MM/YYYY","bo-CN":"YYYY/M/DD","sms-FI":"DD.M.YYYY","as-IN":"DD-MM-YYYY","ml-IN":"DD-MM-YY","en-IN":"DD-MM-YYYY","or-IN":"DD-MM-YY","bn-IN":"DD-MM-YY","tk-TM":"DD.MM.YY","bs-Latn-BA":"DD.M.YYYY","mt-MT":"DD/MM/YYYY","sr-CYrl-ME":"DD.M.YYYY","se-FI":"DD.M.YYYY","zu-ZA":"YYYY/MM/DD","xh-ZA":"YYYY/MM/DD","tn-ZA":"YYYY/MM/DD","hsb-DE":"DD. M. YYYY","bs-CYrl-BA":"DD.M.YYYY","tg-CYrl-TJ":"DD.MM.YY","sr-Latn-BA":"DD.M.YYYY","smj-NO":"DD.MM.YYYY","rm-CH":"DD/MM/YYYY","smj-SE":"YYYY-MM-DD","quz-EC":"DD/MM/YYYY","quz-PE":"DD/MM/YYYY","hr-BA":"DD.M.YYYY.","sr-Latn-ME":"DD.M.YYYY","sma-SE":"YYYY-MM-DD","en-SG":"DD/M/YYYY","ug-CN":"YYYY-M-DD","sr-CYrl-BA":"DD.M.YYYY","es-US":"M/DD/YYYY"};return moment().format(e[navigator.language]||"DD/MM/YYYY")}}]),function(){angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(e,t){return{loginConfirmed:function(o,n){var r=n||function(e){return e};e.$broadcast("event:auth-loginConfirmed",o),t.retryAll(r)},loginCancelled:function(o,n){t.rejectAll(n),e.$broadcast("event:auth-loginCancelled",o)}}}]).config(["$httpProvider",function(e){var t=["$rootScope","$q","httpBuffer","$translate",function(e,t,o,n){return{responseError:function(r){if(401===r.status&&!r.config.ignoreAuthModule){var i=t.defer();return o.append(r.config,i),e.$broadcast("event:auth-loginRequired",r),i.promise}return 401===r.status&&(e.invalidCredentials=!0),r.status>=500&&599>=r.status&&r.config&&!r.config.ignoreErrors&&(r.data&&r.data.messageKey?e.addAlertPromise(n(r.data.messageKey),"error"):r.data&&r.data.message?e.addAlert(r.data.message,"error"):e.addAlertPromise(n("GENERAL.ERROR.GENERIC"),"error")),t.reject(r)}}}];e.interceptors.push(t)}]),angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(e){function t(t,n){function r(e){n.resolve(e)}function i(e){n.reject(e)}o=o||e.get("$http"),o(t).then(r,i)}var o,n=[];return{append:function(e,t){n.push({config:e,deferred:t})},rejectAll:function(e){if(e)for(var t=0;n.length>t;++t)n[t].deferred.reject(e);n=[]},retryAll:function(e){for(var o=0;n.length>o;++o)t(e(n[o].config),n[o].deferred);n=[]}}}])}(),activitiApp.factory("AuthenticationSharedService",["$rootScope","$http","authService","$q","$location","$window",function(e,t,o,n){return{authenticate:function(){var o=n.defer();return t.get(ACTIVITI.CONFIG.contextRoot+"/app/rest/authenticate",{ignoreErrors:!0,ignoreAuthModule:"ignoreAuthModule"}).success(function(){var n=ACTIVITI.CONFIG.contextRoot+"/app/rest/account";ACTIVITI.CONFIG.integrationProfile&&(n+="?includeApps=true"),t.get(n).success(function(t){e.account=t,e.invalidCredentials=!1,e.$broadcast("event:auth-authConfirmed"),o.resolve()}).error(function(t){o.reject(t),e.$broadcast("event:auth-loginRequired")})}).error(function(t){o.reject(t),e.$broadcast("event:auth-loginRequired")}),o.promise},login:function(n){var r="j_username="+encodeURIComponent(n.username)+"&j_password="+encodeURIComponent(n.password)+"&_spring_security_remember_me=true&submit=Login";t.post(ACTIVITI.CONFIG.contextRoot+"/app/authentication",r,{headers:{"Content-Type":"application/x-www-form-urlencoded"},ignoreAuthModule:"ignoreAuthModule"}).success(function(t,r,i,a){e.authenticationError=!1,n.success&&n.success(t,r,i,a),o.loginConfirmed()}).error(function(t,o,r,i){e.$broadcast("event:auth-loginFailed"),n.error&&n.error(t,o,r,i)})},logout:function(){e.authenticated=!1,e.authenticationError=!1,t.get(ACTIVITI.CONFIG.contextRoot+"/app/logout").success(function(){e.login=null,e.authenticated=!1,o.loginCancelled({isFromLogout:!0})})},hasCapability:function(t){return e.account&&e.account.capabilities?e.account.capabilities.indexOf(t)>-1:!1},hasTenantManagementCapability:function(){return this.hasCapability("tenant-mgmt")},hasTenantAdminCapability:function(){return this.hasCapability("tenant-admin")},hasAccessReportsCapability:function(){return this.hasCapability("access-reports")}}}]),activitiModule.directive("appLinks",["$popover","$timeout","appResourceRoot",function(e){return{restrict:"E",templateUrl:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/app-links-button.html",replace:!0,link:function(){},scope:{},controller:["$scope","$element","RuntimeAppDefinitionService","$translate",function(t,o,n,r){var i;t.goToLink=function(e){t.onDestroyPopover(),window.location.href=e},t.onDestroyPopover=function(){i&&(i.$scope.$destroy(),i.destroy(),i=void 0)},t.showAppLinks=function(){t.apps=[],n.getApplications().then(function(e){for(var o=e.defaultApps.concat(e.customApps),n=0;o.length>n;n++){var i=o[n];if(null!==i.pages&&void 0!==i.pages&&i.pages.length>0){for(var a=0,c=0;i.pages.length>c;c++){var l={};l.name=i.pages[c],l.theme=i.theme,l.icon=i.icon,null!==i.defaultAppId&&void 0!==i.defaultAppId?(l.titleKey=i.titleKey+"-"+l.name.toUpperCase(),l.fixedUrl=i.fixedUrl+"#/"+i.pages[c]):(l.titleKey=r.instant("APP.CUSTOM-APP.TITLE-"+l.name.toUpperCase(),i),l.fixedUrl=i.fixedBaseUrl+i.pages[c]),o.splice(n+c+1,0,l),a++}o.splice(n,1),n=n+a-1}}t.apps=o}),i=e(o,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/app-links-popover.html",placement:"bottom-right",show:!0,scope:t,autoClose:!0}),i.$scope.$on("tooltip.hide",function(){t.onDestroyPopover()})}}]}}]),activitiModule.directive("variableIdentifier",["$rootScope","$timeout",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){function r(e,t){var o="",n=0;for(n=0;e.length>n;n++)t.test(o+e[n])&&(o+=e[n]);return o}e.identifierRegExp=/^[a-zA-Z][_a-zA-Z0-9]*$/,e.forbidenNames=["abstract","continue","for","new","switch","assert","default","if","package","synchronized","boolean","do","goto","private","this","break","double","implements","protected","throw","byte","else","import","public","throws","case","enum","instanceof","return","transient","catch","extends","int","short","try","char","final","interface","static","void","class","finally","long","strictfp","volatile","const","float","native","super","while","null"],e.$watch(o.ngModel,function(t){var i=!0;if(t&&t.length>0){var a=r(t,e.identifierRegExp);a!=t?(n.$setViewValue(a),n.$render()):i=e.identifierRegExp.test(a)?-1==e.forbidenNames.indexOf(a):!1}n.$setValidity(o.ngModel,i)})}}}]),activitiModule.directive("ngTrim",function(){return{require:"ngModel",priority:300,link:function(e,t,o,n){"false"===o.ngTrim&&n.$parsers.unshift(function(){return t.val()})}}}),activitiModule.directive("spacelessValue",["$rootScope","$timeout",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){function r(e,t){var o="",n=0;for(n=0;e.length>n;n++)t.test(o+e[n])&&(o+=e[n]);return o}e.identifierRegExp=/^\S*$/,e.$watch(o.ngModel,function(t){var i=!0;if(t&&t.length>0){var a=r(t,e.identifierRegExp);a!=t?(n.$setViewValue(a),n.$render()):e.identifierRegExp.test(a)||(i=!1)}n.$setValidity(o.ngModel,i)})}}}]),activitiModule.directive("restrictInput",["$parse",function(){return{restrict:"A",require:"ngModel",priority:1002,link:function(e,t,o,n){function r(e){var t=e.toUpperCase(),o=t.replace(/-D-/,"-DD-").replace(/^D-/,"DD-").replace(/-D$/,"-DD"),n=t.replace(/-M-/,"-MM-").replace(/^M-/,"MM-").replace(/-M$/,"-MM"),r=o.replace(/-M-/,"-MM-").replace(/^M-/,"MM-").replace(/-M$/,"-MM");return[t,o,n,r]}function i(e,t){if(void 0===e||null==e||""===e)return!0;if(e.length>t.length)return!1;for(var o=0;Math.min(t.length,e.length)>o;o++){var n=t[o];if(n.toUpperCase().match(/D|M|Y/)){if(null==e[o].match(/\d/))return!1}else if(e[o]!=n)return!1}return!0}var a=o.restrictInput;(void 0==a||null==a||""==a)&&(a=o.dateFormat),e.field.acceptedFormat=a;var c=r(a),l=!1;(void 0==a||null==a||""==a)&&(l=!0);var u=n.$render;n.$render=function(){t.val(n.$viewValue),n.$dateValue&&!isNaN(n.$dateValue.getTime())&&u&&u()},n.$parsers.unshift(function(e){if(l)return e;for(var t=!1,o=0;c.length>o&&!t;o++)t|=i(e,c[o]);return t?(n.$lastValidText=e,(void 0===e||null==e||""===e)&&(n.$dateValue=null),e):(n.$dateValue=null,n.$setViewValue(n.$lastValidText),n.$render(),n.$lastValidText)})}}}]),activitiModule.directive("autoHeight",["$rootScope","$timeout",function(e,t){return{restrict:"AC",scope:{toWatch:"=autoHeight"},compile:function(){return function(o,n,r){var i=0;r.offset&&(i=parseInt(r.offset),(0/0==i||void 0==i)&&(i=0));var a=function(e){t(function(){var t=e.parent().outerHeight()-i,o=!1;e.parent().children().filter(":visible").each(function(){o||(e[0]==this?o=!0:t-=angular.element(this).outerHeight())}),o&&e.height(t)},0)};o.$watch("toWatch",function(){a(n)}),o.unregisterWatcher&&o.unregisterWatcher(),o.unregisterWatcher=e.$watch("window.height",function(){a(n)}),o.unregisterForceWatcher&&o.unregisterForceWatcher(),o.unregisterForceWatcher=e.$watch("window.forceRefresh",function(){a(n)
}),o.$on("$destroy",function(){o.unregisterWatcher&&o.unregisterWatcher(),o.unregisterForceWatcher&&o.unregisterForceWatcher()})}}}}]),activitiModule.directive("scrollToActive",["$timeout",function(e){return{restrict:"AC",scope:{toWatch:"=scrollToActiveModel"},compile:function(){return function(t,o,n){t.$watch("toWatch",function(){e(function(){var e=n.useParent,t=n.offsetTop;t&&(t=parseInt(t),0/0==t&&(t=0)),t||(t=0);var r=o.children(".active");if(r&&r.length>0){var i=angular.element(r[0]);e&&(o=angular.element(o.parent()));var a=i.position().top-o.position().top+o.scrollTop(),c=a+i.outerHeight(),l=o.scrollTop()+o.innerHeight(),u=l-o.innerHeight();u>=a?o.scrollTop(a-i.outerHeight()-t):c>l&&o.scrollTop(u+i.outerHeight()-t)}},0)})}}}}]),activitiModule.directive("autoScroll",["$timeout",function(e){return{restrict:"AC",compile:function(){return function(t,o){t.$on("tooltip.show",function(){e(function(){for(var e=o[0];e&&!(e.className&&e.className.indexOf("scroll-container")>=0);)e=e.parentNode;if(e){e=angular.element(e);var t=o.offset().top-e.offset().top+o.scrollTop(),n=t+o.outerHeight();n+30>=e.outerHeight()&&e.scrollTop(t)}},50)})}}}}]),activitiModule.directive("userName",function(){var e={};return e.template='{{user.firstName && user.firstName || ""}} {{user.lastName && user.lastName || ""}} {{ (user.email && !user.firstName && !user.lastName) && user.email || ""}}',e.scope={user:"=userName"},e}),activitiModule.directive("clickAnywhere",["$document","$parse",function(e,t){var o=function(o,n,r){var i=r.clickAnywhere,a=t(i),c=r.ignore,l=r.ignoreClass,u="true"==r.ignorePopupEvents,s=function(e){for(var t=e.target;t;){if(t==n[0]||c&&t.id==c||l&&t.className&&t.className.indexOf(l)>=0)return e.stopPropagation(),e.preventDefault(),void 0;t=t.parentNode}o.$apply(function(){a(o,{$event:e})})};e.on("click",s),o.$on("$destroy",function(){e.off("click",s)});var d=o.$on("tooltip.hide",function(){u||(e.off("click",s),d())})};return o}]),activitiModule.directive("autoFocus",["$timeout","$parse",function(e,t){return{restrict:"AC",compile:function(o,n){var r;return n.selectText&&(r=t(n.selectText)),function(t,o,n){var i=void 0!==n.focusFirstChild;e(function(){if(i){var e=o.find("input");e&&e.length>0&&(e[0].focus(),r&&r(t.$parent)&&input[0].setSelectionRange(0,input[0].value.length))}else o[0].focus(),r&&r(t.$parent)&&o[0].setSelectionRange(0,o[0].value.length)},100)}}}}]),activitiModule.directive("focusWhen",["$timeout",function(e){return{link:function(t,o,n){t.$watch(n.ngFocus,function(t){angular.isDefined(t)&&t&&e(function(){o[0].focus()})},!0),o.bind("blur",function(){angular.isDefined(n.ngFocusLost)&&t.safeApply(n.ngFocusLost)})}}}]),activitiModule.directive("loading",[function(){var e={};return e.restrict="A",e.template='<div class="loading" ng-show="loading"><div class="l1"></div><div class="l2"></div><div class="l3"></div></div>',e.scope={loading:"=loading",loadingText:"=loadingText"},e}]),activitiModule.directive("activitiFixDropdownBug",function(){return{restrict:"AEC",link:function(e,t){t.on("hidden.bs.dropdown	",function(){t.show()})}}}),activitiModule.directive("userLink",function(){var e={};return e.template='{{user.firstName && user.firstName || ""}} {{user.lastName && user.lastName || ""}} {{ (user.email && !user.firstName && !user.lastName) && user.email || ""}}',e.scope={user:"=userLink"},e.compile=function(e){e.addClass("people-link")},e}),activitiModule.directive("formField",function(){var e={};return e.template=' {{field.name || ""}} - {{field.id}}',e.scope={field:"=formField"},e.compile=function(e){e.addClass("form-field")},e}),activitiModule.directive("customKeys",["$parse",function(e){var t={};return t.compile=function(t,o){var n,r,i,a;return o.upPressed&&(n=e(o.upPressed)),o.downPressed&&(r=e(o.downPressed)),o.enterPressed&&(i=e(o.enterPressed)),o.escapePressed&&(a=e(o.escapePressed)),function(e,t){t.on("keyup",function(t){38===t.keyCode?e.$apply(function(){n&&n(e,{$event:t})}):40===t.keyCode?e.$apply(function(){r&&r(e,{$event:t})}):13===t.keyCode?e.$apply(function(){i&&i(e,{$event:t})}):27===t.keyCode&&e.$apply(function(){a&&a(e,{$event:t})})}),t.on("keydown",t,function(e){(38===e.keyCode||40===e.keyCode||13===e.keyCode||27===e.keyCode)&&e.preventDefault()})}},t}]),activitiModule.directive("delayedModel",["$timeout",function(e){return{scope:{targetModel:"=delayedModel"},link:function(t,o,n){o.val(t.targetModel),t.$watch("targetModel",function(n,i){r&&e.cancel(r),n!==i&&o.val(t.targetModel)});var r;o.on("keyup paste search",function(){o.val()!==t.targetModel&&(r&&e.cancel(r),r=e(function(){t.targetModel=o[0].value,o.val(t.targetModel),t.$apply()},n.delay||200))})}}}]),activitiModule.directive("ngDebounce",["$timeout",function(e){return{restrict:"A",require:"ngModel",priority:99,link:function(t,o,n,r){if("radio"!==n.type&&"checkbox"!==n.type){o.unbind("input");var i;o.bind("input",function(){e.cancel(i),i=e(function(){t.$apply(function(){r.$setViewValue(o.val())})},n.ngDebounce||1e3)}),o.bind("blur",function(){t.$apply(function(){r.$setViewValue(o.val())})})}}}}]),activitiModule.directive("externalContentAuthenticator",["$parse","$timeout",function(){var e={};return e.restrict="A",e.templateUrl=ACTIVITI.CONFIG.webContextRoot+"/views/common/templates/external-content-authenticator-template.html",e.scope={taskId:"=taskId",accountType:"@accountType"},e.controller=["$scope","$element","ContentAccountService","$modal","$window","$translate","$rootScope",function(e,t,o,n,r,i,a){e.$on("integration.account.error",function(t,o){e.currentAccount&&o==e.currentAccount.serviceId&&e.contentBrowseModal&&("alfresco-cloud"===o?i("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"google-drive"===o?i("INTEGRATION.ALERT.GOOGLE-DRIVE-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}):"box"===o&&i("INTEGRATION.ALERT.BOX-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}))}),e.openAuthenticationPopup=function(t,o){e.openContentAccountAuth(t,o)},e.clearPopupError=function(){e.contentBrowseModal&&(e.contentBrowseModal.$scope.errorMessage=void 0)},e.$on("integration.account.autherror",function(t,o){o&&(e.contentAccounts[o].authorized=!1,"alfresco-cloud"===o?i("INTEGRATION.ALERT.ALFRESCO-CLOUD-NOT-AUTHORIZED").then(function(t){a.addAlert(t,"error"),e.errorMessage=t}):"google-drive"===o?i("INTEGRATION.ALERT.GOOGLE-DRIVE-NOT-AUTHORIZED").then(function(t){a.addAlert(t,"error"),e.errorMessage=t}):"box"===o&&i("INTEGRATION.ALERT.BOX-NOT-AUTHORIZED").then(function(t){a.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide())}),e.openContentAccountAuth=function(t,o){var n=angular.element(r),i=(n.width()-500)/2,a=(n.height()-400)/2,c=r.open(e.contentAccounts[o].authorizationUrl,o,"width= 500, height=400, toolbar=no, status=no, titlebar=no, location=no, menubar=no, top="+a+", left="+i);r.contentAccountAuthConfirmed=function(){e.$apply(function(){e.contentAccounts[o].authorizationUrl=void 0,e.contentAccounts[o].authorized=!0,e.currentAccount=e.contentAccounts[o],c.close(),e.$emit("task-completed",{taskId:e.taskId})})}},e.loadAccounts=function(){e.contentAccounts={loading:!0},o.getAccounts().then(function(t){if(t&&t.data)for(var o=0;t.data.length>o;o++){var n=t.data[o];e.contentAccounts[n.serviceId]=n}e.contentAccounts.rawList=t.data,e.contentAccounts.loading=!1})},e.loadAccounts()}],e}]),activitiModule.directive("externalContent",["$parse","$timeout",function(e,t){var o={};return o.restrict="A",o.templateUrl=ACTIVITI.CONFIG.webContextRoot+"/views/common/templates/external-content-template.html",o.scope={taskId:"=taskId",processInstanceId:"=formDefinition",folderSelect:"=folderSelect",linkOnly:"=linkOnly",preSelectedAccount:"=account",uploadInProgress:"=uploadInProgress",isRelatedContent:"=isRelatedContent",contentSource:"=?contentSource"},o.link=function(o,n,r){r.onContentUpload&&(o.uploadedCallback=e(r.onContentUpload)),r.onFolderSelect&&(o.folderSelectCallback=e(r.onFolderSelect)),r.onUploadInProgress&&(o.uploadInProgressCallback=e(r.onUploadInProgress)),t(function(){n.find("div.select-file").click(function(){n.find('input[type="file"]').click()})},200)},o.controller=["$scope","$element","RelatedContentService","ContentAccountService","$modal","$window","$translate","$rootScope",function(e,t,o,n,r,i,a,c){e.uploadModel={uploading:!1},e.BOX_DRIVE_ACCOUNT_ID="box",e.GOOGLE_DRIVE_ACCOUNT_ID="google-drive",e.ALFRESCO_ACCOUNT_ID_PREFIX="alfresco-",e.ALFRESCO_CLOUD_ACCOUNT_ID="alfresco-cloud",e.ALL_SOURCES_ACCOUNT_ID="all-file-sources",e.LOCAL_FILE_ACCOUNT_ID="local-file",e.filterNavigableContent=function(t){return!t.folder||(!e.contentSource||e.contentSource&&!e.contentSource.notAllowNavigateFolders)&&t.folder},e.browseButtonIsVisible=function(){return!e.linkOnly&&(e.contentSource&&(e.contentSource.serviceId===e.ALL_SOURCES_ACCOUNT_ID||e.contentSource.serviceId===e.LOCAL_FILE_ACCOUNT_ID)||!e.contentSource)},e.contentAccountsByServiceId=function(t){return!e.contentSource||e.contentSource.serviceId===e.ALL_SOURCES_ACCOUNT_ID||e.contentSource.serviceId===t.serviceId},e.selectFolder=function(t){if(e.preSelectedAccount||e.folderSelect){var o=e.folderSelect;o.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX&&(o=e.ALFRESCO_CLOUD_ACCOUNT_ID),(o===e.ALFRESCO_CLOUD_ACCOUNT_ID||o===e.GOOGLE_DRIVE_ACCOUNT_ID||o===e.BOX_DRIVE_ACCOUNT_ID)&&e.browseRepositoryContent(t,o,e.preSelectedAccount)}},e.$on("integration.account.error",function(t,o){e.currentAccount&&o==e.currentAccount.serviceId&&(e.contentBrowseModal&&a("INTEGRATION.ALERT.ALFRESCO-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}),e.contentBrowseModal&&a("INTEGRATION.ALERT.BOX-ERROR").then(function(t){e.contentBrowseModal.$scope.errorMessage=t,e.currentAccount.loading=!1}))}),e.clearPopupError=function(){e.contentBrowseModal&&(e.contentBrowseModal.$scope.errorMessage=void 0)},e.$on("integration.account.autherror",function(t,o){o&&(e.contentAccounts[o].authorized=!1,o===e.ALFRESCO_CLOUD_ACCOUNT_ID?(a("INTEGRATION.ALERT.ALFRESCO-CLOUD-NOT-AUTHORIZED").then(function(t){c.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()):o==e.GOOGLE_DRIVE_ACCOUNT_ID?(a("INTEGRATION.ALERT.GOOGLE-DRIVE-NOT-AUTHORIZED").then(function(t){c.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()):"box"==o&&(a("INTEGRATION.ALERT.BOX-NOT-AUTHORIZED").then(function(t){c.addAlert(t,"error"),e.errorMessage=t}),e.contentBrowseModal&&e.contentBrowseModal.$scope.$hide()))}),e.openFileSelect=function(t){e.errorMessage=void 0;var o=angular.element(t).parent();o.children("input").click()},e.confirmFolderSelection=function(){if(e.currentFolderTree&&e.folderSelectCallback){var t=e.createContentBrowserPayload(e.currentAccount);e.folderSelectCallback(e.$parent,{folder:t}),e.contentBrowseModal.$scope.$hide()}},e.confirmBoxFolderSelection=function(){var t=0;if(e.folderSelectCallback){var o="";if(e.currentFolderTree&&e.currentFolderTree.length>0){for(var n=0;e.currentFolderTree.length>n;n++)n>0&&(o+=" > "),o+=e.currentFolderTree[n].title;t=e.currentFolderTree[e.currentFolderTree.length-1].id}else o+="/",t=0;var r={account:{id:e.currentAccount.serviceId,name:e.currentAccount.name},path:{id:t,title:o}};e.folderSelectCallback(e.$parent,{folder:r}),e.contentBrowseModal.$scope.$hide()}},e.onFileSelect=function(t,n){if(e.errorMessage=void 0,!e.linkOnly&&(e.errorMessage=void 0,!e.folderSelect&&!e.uploadModel.uploading&&t.length>0)){e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!0}),e.uploadModel.uploading=!0;var r=t[0];e.clearPopupError(),o.addRelatedContent(e.taskId,e.processInstanceId,r,n,e.isRelatedContent).progress(function(t){e.uploadModel.uploadProgress=parseInt(100*t.loaded/t.total)}).then(function(t){e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!1}),e.uploadModel.uploading=!1,e.uploadedCallback&&e.uploadedCallback(e.$parent,{content:t})},function(t){if(e.uploadInProgressCallback&&e.uploadInProgressCallback(e.$parent,{status:!1}),t&&t.messageKey){var o={};t.customData&&(o.quota=e.formatFileSize(t.customData.quota)),a(t.messageKey,o).then(function(t){e.errorMessage=t})}e.uploadModel.uploading=!1})}},e.selectAccountContent=function(t,o){e.currentAccount=o,o.serviceId===e.GOOGLE_DRIVE_ACCOUNT_ID?e.selectGoogleDriveContent(t):o.serviceId==e.BOX_DRIVE_ACCOUNT_ID?e.selectBoxContent(t):e.browseRepositoryContent(t,e.ALFRESCO_CLOUD_ACCOUNT_ID,o)},e.selectGoogleDriveContent=function(t){e.errorMessage=void 0,e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].authorized?e.openGoogleDriveBrowser(t):e.openContentAccountAuth(t,e.GOOGLE_DRIVE_ACCOUNT_ID))},e.selectBoxContent=function(t){e.errorMessage=void 0,e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].authorized?e.openBoxBrowser(t):e.openContentAccountAuth(t,e.BOX_DRIVE_ACCOUNT_ID))},e.browseRepositoryContent=function(t,o,n){n&&n.serviceId!==e.BOX_DRIVE_ACCOUNT_ID&&n.serviceId!==e.ALFRESCO_CLOUD_ACCOUNT_ID&&n.serviceId!==e.GOOGLE_DRIVE_ACCOUNT_ID?(e.currentAccount=n,e.openContentAccountBrowser(t,o)):(e.errorMessage=void 0,e.account&&e.account.authorized?(e.currentAccount=n,e.openContentAccountBrowser(t,o)):e.contentAccounts[o]&&e.contentAccounts[o].authorized?(e.currentAccount=e.contentAccounts[o],e.openContentAccountBrowser(t,o)):e.openContentAccountAuth(t,o))},e.openContentAccountAuth=function(t,o){var n=angular.element(i),r=(n.width()-500)/2,a=(n.height()-400)/2,c=i.open(e.contentAccounts[o].authorizationUrl,o,"width= 500, height=400, toolbar=no, status=no, titlebar=no, location=no, menubar=no, top="+a+", left="+r);i.contentAccountAuthConfirmed=function(){e.$apply(function(){e.contentAccounts[o].authorizationUrl=void 0,e.contentAccounts[o].authorized=!0,e.currentAccount=e.contentAccounts[o],c.close(),e.openContentAccountBrowser(t,o)})}},e.openContentAccountBrowser=function(t,o){o===e.GOOGLE_DRIVE_ACCOUNT_ID?e.openGoogleDriveBrowser(t):o===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.openAlfrescoBrowser(t):o===e.BOX_DRIVE_ACCOUNT_ID&&e.openBoxBrowser(t)},e.openAlfrescoBrowser=function(){if(e.currentFolderTree=[],e.selectedNetwork=void 0,e.selectedSite=void 0,e.alfrescoSites=void 0,e.contentSource&&e.contentSource.serviceId.substring(0,9)===e.ALFRESCO_ACCOUNT_ID_PREFIX){var t=e.contentSource.selectedFolder;t&&(e.selectedNetwork={id:t.network},e.selectedSite={id:t.siteId,title:t.site},e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.contentSource&&e.contentSource.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?e.loadAlfrescoNetworks(function(){e.loadAlfrescoSites(e.loadFolderContent)}):e.currentAccount&&e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?(e.uploadModel.noNetwork=!1,e.loadAlfrescoNetworks()):(e.uploadModel.noNetwork=!0,e.loadAlfrescoSites(e.loadFolderContent)),e.createContentBrowserPayload=function(t){for(var o="",n=0;e.currentFolderTree.length>n;n++)n>0&&(o+=" > "),o+=e.currentFolderTree[n].title;var r=null;e.currentFolderTree.length>0&&(r=e.currentFolderTree[e.currentFolderTree.length-1].id);var i={path:{id:r,title:o,folderTree:e.currentFolderTree}};return e.uploadModel.noNetwork?i.account={id:t.serviceId,name:t.name}:i.network=e.selectedNetwork.id,i.site={id:e.selectedSite.id,title:e.selectedSite.title},i},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-alfresco-cloud.html",show:!0,scope:e},r,e)},e.selectNetwork=function(t){e.currentAccount.loading||e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID&&(e.selectedNetwork=t,e.selectedSite=void 0,e.alfrescoSites=void 0,t&&e.loadAlfrescoSites())},e.selectSite=function(t){e.currentAccount.loading||(e.selectedSite=t,e.alfrescoFolders=void 0,t&&e.loadSiteContent())},e.loadAlfrescoNetworks=function(t){e.currentAccount.loading||(e.currentAccount.loading=!0,e.clearPopupError(),n.getNetworks().then(function(o){e.alfrescoNetworks=o,e.currentAccount.loading=!1,t&&t()}))},e.loadAlfrescoSites=function(t){e.currentAccount.loading||(e.currentAccount.loading=!0,e.clearPopupError(),e.currentAccount&&e.currentAccount.serviceId!==e.ALFRESCO_CLOUD_ACCOUNT_ID?n.getSites(e.currentAccount.serviceId).then(function(o){e.alfrescoSites=o,e.currentAccount.loading=!1,t&&t()}):e.selectedNetwork?n.getCloudSites(e.selectedNetwork.id).then(function(o){e.alfrescoSites=o,e.currentAccount.loading=!1,t&&t()}):(e.currentAccount.loading=!1,t&&t()))},e.loadSiteContent=function(){e.currentAccount.loading||(e.currentAccount.loading=!0,e.currentFolderTree=[],e.currentContent=void 0,e.clearPopupError(),e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?n.getCloudContentInSite(e.selectedNetwork.id,e.selectedSite.id).then(function(t){e.currentContent=t,e.currentAccount.loading=!1}):n.getContentInSite(e.currentAccount.serviceId,e.selectedSite.id).then(function(t){e.currentContent=t,e.currentAccount.loading=!1}))},e.navigateToFolder=function(t){var o=e.currentFolderTree[t];o&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),e.selectedFolder=o,e.loadFolderContent())},e.loadFolderContent=function(t){e.selectedFolder&&(e.currentAccount.loading||(e.currentContent=void 0,e.currentAccount.loading=!0,e.clearPopupError(),e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?n.getCloudContentInFolder(e.selectedNetwork.id,e.selectedFolder.id).then(function(o){e.currentContent=o,e.currentAccount.loading=!1,t&&t()}):n.getContentInFolder(e.currentAccount.serviceId,e.selectedFolder.id).then(function(o){e.currentContent=o,e.currentAccount.loading=!1,t&&t()})))},e.openBoxBrowser=function(){if(e.currentFolderTree=[],e.contentSource&&e.contentSource.serviceId===e.BOX_DRIVE_ACCOUNT_ID){var t=e.contentSource.selectedFolder;t&&(e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.createContentBrowserPayload=function(t){for(var o="/",n=0;e.currentFolderTree.length>n;n++)n>0&&(o+=" > "),o+=e.currentFolderTree[n].title;var r=null;return e.currentFolderTree.length>0&&(r=e.currentFolderTree[e.currentFolderTree.length-1].id),{path:{id:r,title:o,folderTree:e.currentFolderTree},account:{id:t.serviceId,name:t.name}}},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-box.html",show:!0,scope:e},r,e),e.contentBrowseModal.$scope.$watch("filter",function(t){e.loadBoxFiles(t)})},e.navigateToBoxFolder=function(t){var o=e.currentFolderTree[t];o&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles(""))},e.navigateToBoxRoot=function(){e.currentFolderTree=[],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles("")},e.loadBoxFiles=function(t){e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].loading=!0),t||(e.boxFiles=void 0);var o;e.currentFolderTree&&e.currentFolderTree.length>0&&(o=e.currentFolderTree[e.currentFolderTree.length-1].id),n.getBoxFiles(t,o).then(function(t){e.boxFiles=t,e.contentAccounts[e.BOX_DRIVE_ACCOUNT_ID].loading=!1})},e.openGoogleDriveBrowser=function(){if(e.currentFolderTree=[],e.contentSource&&e.contentSource.serviceId===e.GOOGLE_DRIVE_ACCOUNT_ID){var t=e.contentSource.selectedFolder;t&&(e.selectedFolder={id:t.pathId},e.currentFolderTree=t.folderTree)}e.createContentBrowserPayload=function(t){for(var o="",n=0;e.currentFolderTree.length>n;n++)n>0&&(o+=" > "),o+=e.currentFolderTree[n].title;var r=null;return e.currentFolderTree.length>0&&(r=e.currentFolderTree[e.currentFolderTree.length-1].id),{path:{id:r,title:o,folderTree:e.currentFolderTree},account:{id:t.serviceId,name:t.name}}},e.contentBrowseModal=_internalCreateModal({template:ACTIVITI.CONFIG.webContextRoot+"/views/common/modal/browse-google-drive.html",show:!0,scope:e},r,e),e.contentBrowseModal.$scope.$watch("filter",function(t){e.loadGoogleDriveFiles(t)})},e.navigateToGoogleDriveFolder=function(t){var o=e.currentFolderTree[t];o&&(e.currentFolderTree.splice(t+1,e.currentFolderTree.length-t-1),""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles(""))},e.navigateToGoogleDriveRoot=function(){e.currentFolderTree=[],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles("")},e.loadGoogleDriveFiles=function(t){e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID]&&(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!0),t||(e.googleDriveFiles=void 0);var o;e.currentFolderTree&&e.currentFolderTree.length>0&&(o=e.currentFolderTree[e.currentFolderTree.length-1].id);var r=!1;e.contentSource&&e.contentSource.notAllowNavigateFolders&&1==e.contentSource.notAllowNavigateFolders&&(r=!0),n.getGoogleDriveFiles(t,o,r).then(function(t){e.googleDriveFiles=t,e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!1})},e.addContentFromSource=function(t,n,r,i,a,c,l){o.addRelatedContentFromSource(e.taskId,e.processInstanceId,t,n,r,i,a,e.linkOnly,e.isRelatedContent).then(function(t){e.uploadedCallback&&e.uploadedCallback(e.$parent,{content:t}),c&&c(t)},function(e){l&&l(e)})},e.boxContentSelected=function(t){t.folder?(e.currentFolderTree&&0!=e.currentFolderTree.length?e.currentFolderTree.push(t):e.currentFolderTree=[t],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadBoxFiles("")):(e.contentAccounts.box.loading=!0,e.addContentFromSource("box",t.id,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide()},function(){e.contentBrowseModal.$scope.$hide()}),t.title="Uploading: "+t.title,e.boxFiles.data=[t])},e.googleDriveContentSelected=function(t){t.folder?(e.currentFolderTree&&0!=e.currentFolderTree.length?e.currentFolderTree.push(t):e.currentFolderTree=[t],""!=e.contentBrowseModal.$scope.filter?e.contentBrowseModal.$scope.filter="":e.loadGoogleDriveFiles("")):(e.contentAccounts[e.GOOGLE_DRIVE_ACCOUNT_ID].loading=!0,e.addContentFromSource(e.GOOGLE_DRIVE_ACCOUNT_ID,t.id,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide()},function(){e.contentBrowseModal.$scope.$hide()}),t.title="Uploading: "+t.title,e.googleDriveFiles.data=[t])},e.selectAlfrescoContent=function(t){if(!e.currentAccount.loading)if(e.clearPopupError(),t.folder)e.currentFolderTree.push(t),e.selectedFolder=t,e.loadFolderContent();else if(!e.folderSelect){e.currentAccount.loading=!0;var o;o=e.currentAccount&&e.currentAccount.serviceId===e.ALFRESCO_CLOUD_ACCOUNT_ID?t.id+"@"+e.selectedSite.id+"@"+e.selectedNetwork.id:t.id+"@"+e.selectedSite.id,e.addContentFromSource(e.currentAccount.serviceId,o,t.title,t.mimeType,t.simpleType,function(){e.contentBrowseModal.$scope.$hide(),e.currentAccount.loading=!1},function(){e.contentBrowseModal.$scope.$hide(),e.currentAccount.loading=!1}),t.title="Uploading: "+t.title,e.currentContent.data=[t]}},e.formatFileSize=function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]},e.loadAccounts=function(){e.contentAccounts={loading:!0},n.getAccounts().then(function(t){if(t&&t.data)for(var o=0;t.data.length>o;o++){var n=t.data[o];e.contentAccounts[n.serviceId]=n}e.contentAccounts.rawList=t.data,e.contentAccounts.loading=!1})},e.loadAccounts()}],o}]),activitiModule.directive("selectPeoplePopover",["$rootScope","$http","$popover","appResourceRoot","UserService","SystemPropertiesService","$parse",function(e,t,o,n,r,i,a){var c={};return c.restrict="A",c.scope={excludeTaskId:"=excludeTaskId",excludeProcessId:"=excludeProcessId",excludeUserId:"=excludeUserId",excludeUserIds:"=excludeUserIds",tenantId:"=tenantId",type:"=type",restrictWithGroup:"=restrictWithGroup",selectPeopleFormFields:"=selectPeopleFormFields",ignoreContainer:"=ignoreContainer",emailModeDisabled:"=emailModeDisabled"},c.link=function(t,n,c){var l="bottom";n.addClass("toggle-people-select"),c.placement&&(l=c.placement);var u=c.selectYourselfMode,s=!0;void 0!==c.closeOnSelect&&(s=c.closeOnSelect),t.popover=o(n,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/select-people-popover.html?"+Date.now(),placement:l});var d,p,f;c.onPeopleSelected&&(d=a(c.onPeopleSelected)),c.onCancel&&(p=a(c.onCancel)),c.onEmailSelected&&(f=a(c.onEmailSelected));var Y="workflow";null!==t.type&&void 0!==t.type&&(Y=t.type);var v=t.popover.$scope;if(v.title=c.popoverTitle,v.popupModel={emailMode:!1,showRecentResults:!1,userResults:[],userField:{},userFieldFilter:["people"],loading:!1},t.selectPeopleFormFields&&(v.popupModel.formFields=t.selectPeopleFormFields),c.emailModeDisabled||t.emailModeDisabled){var m=t.emailModeDisabled||c.emailModeDisabled;("true"===m||m===!0)&&(v.popupModel.emailDisabled=!0)}(void 0==v.popupModel.emailDisabled||0==v.popupModel.emailDisabled)&&i.getSystemProperties().then(function(e){v.popupModel.emailDisabled=!e.allowInvolveByEmail});var M=function(){if(v.popupModel.emailMode=!1,e.account&&e.account.capabilities){var t=e.account.capabilities.indexOf("tenant-mgmt")>-1||e.account.capabilities.indexOf("tenant-admin")>-1;t===!1&&(null===v.account.tenantId||void 0===v.account.tenantId)&&(v.popupModel.emailMode=!0)}};M(),v.setSearchType=function(){v.popupModel.userSourceType="search"},v.setFormFieldType=function(){v.popupModel.userSourceType="field"},v.$watch("popupModel.userField",function(){if(v.popupModel.userField&&v.popupModel.userField.id){if(d){var e={id:v.popupModel.userField.id,name:v.popupModel.userField.name,email:v.popupModel.userField.email,type:v.popupModel.userField.type};d(t.$parent,{userField:e}),v.popupModel.userField={}}(s||"true"===s)&&v.$hide()}}),v.$watch("popupModel.filter",function(){if(v.popupModel.filter&&v.popupModel.filter.length>0){v.popupModel.loading=!0;var e;e="idm"===Y?r.getFilteredUsersStrict(v.popupModel.filter,t.tenantId,t.restrictWithGroup):r.getFilteredUsers(v.popupModel.filter,t.excludeTaskId,t.excludeProcessId,t.tenantId,t.restrictWithGroup),e.then(function(e){v.popupModel.showRecentResults=!1,v.popupModel.loading=!1;var o=[],n=null!==t.excludeUserId&&void 0!==t.excludeUserId,r=null!==t.excludeUserIds&&void 0!==t.excludeUserIds;if(n===!0||r===!0)for(var i=0;e.data.length>i;i++){var a=!1;n===!0&&e.data[i].id===t.excludeUserId&&(a=!0),r===!0&&t.excludeUserIds.indexOf(e.data[i].id)>=0&&(a=!0),a||o.push(e.data[i])}else o=e.data;v.popupModel.userResults=o,v.resetSelection()})}else v.resetSelection(),v.popupModel.userResults=[]}),v.resetSelection=function(){v.popupModel.selectedUser=void 0,v.popupModel.selectedIndex=-1},v.nextUser=function(){var e=v.popupModel.userResults;e&&e.length>0&&v.popupModel.selectedIndex<e.length-1&&(v.popupModel.selectedIndex+=1,v.popupModel.selectedUser=e[v.popupModel.selectedIndex])},v.previousUser=function(){var e=v.popupModel.userResults;e&&e.length>0&&v.popupModel.selectedIndex>0&&(v.popupModel.selectedIndex-=1,v.popupModel.selectedUser=e[v.popupModel.selectedIndex])},v.confirmUser=function(e){if(!e){var o=v.popupModel.userResults;v.popupModel.selectedIndex>=0&&v.popupModel.selectedIndex<o.length&&(e=o[v.popupModel.selectedIndex])}if(e)if(d&&d(t.$parent,{user:e}),"true"===s)v.$hide();else{var o=v.popupModel.userResults;o.splice(jQuery.inArray(e,o),1),v.popupModel.selectedIndex=0,v.popupModel.selectedUser=o[v.popupModel.selectedIndex]}},v.selectPersonByEmail=function(e){e&&f&&(f(t.$parent,{email:v.popupModel.email}),v.$hide())},v.getSelectYourselfLabelKey=function(){return"INVOLVE-PEOPLE."+u.toUpperCase()+"-YOURSELF"},v.isCurrentUserSelectable=function(){return u&&!(t.excludeUserId&&t.excludeUserId==e.account.id||t.excludeUserIds&&-1!=t.excludeUserIds.indexOf(e.account.id))},v.selectYourself=function(){d&&(d(t.$parent,{user:e.account}),v.$hide())},v.$on("tooltip.hide",function(){v.popupModel.showRecentResults&&v.popupModel.added&&(v.popupModel.recentUsers=[]),v.popupModel.userResults=[],v.popupModel.filter="",v.popupModel.emailMode=!1,M(),v.popupModel.added?v.popupModel.added=!1:p&&p(t.$parent)})},c}]),activitiModule.directive("selectFunctionalGroupPopover",["$rootScope","$http","$popover","FunctionalGroupService","$parse",function(e,t,o,n,r){var i={};return i.restrict="A",i.scope={type:"=type",restrictWithGroup:"=restrictWithGroup",excludeGroupIds:"=excludeGroupIds"},i.link=function(t,i,a){var c="bottom";i.addClass("toggle-functional-group-select"),a.placement&&(c=a.placement);var l=!0;void 0!==a.closeOnSelect&&(l=a.closeOnSelect),t.popover=o(i,{template:ACTIVITI.CONFIG.webContextRoot+"/views/common/popover/select-functional-group-popover.html?"+Date.now(),placement:c});var u,s;a.onGroupSelected&&(u=r(a.onGroupSelected)),a.onCancel&&(s=r(a.onCancel));var d=t.popover.$scope;d.title=a.popoverTitle,d.popupModel={groupResults:[]},d.$watch("popupModel.filter",function(){if(d.popupModel.filter&&d.popupModel.filter.length>0){var o;null!==e.common&&void 0!==e.common&&null!==e.common.selectedTenantId&&void 0!==e.common.selectedTenantId&&(o=e.common.selectedTenantId>0?e.common.selectedTenantId:void 0),n.getFilteredGroups(d.popupModel.filter,t.restrictWithGroup,o).then(function(e){var o=[];if(null!=t.excludeGroupId&&t.excludeGroupId)for(var n=0;e.data.length>n;n++)e.data[n].id!==t.excludeGroupId&&o.push(e.data[n]);else if(null!=t.excludeGroupIds&&void 0!==t.excludeGroupIds)for(var n=0;e.data.length>n;n++)0>t.excludeGroupIds.indexOf(e.data[n].id)&&o.push(e.data[n]);else o=e.data;d.popupModel.groupResults=o,d.resetSelection()})}else d.resetSelection(),d.popupModel.groupResults=[]}),d.resetSelection=function(){d.popupModel.selectedGroup=void 0,d.popupModel.selectedIndex=-1},d.nextGroup=function(){var e=d.popupModel.groupResults;e&&e.length>0&&d.popupModel.selectedIndex<e.length-1&&(d.popupModel.selectedIndex+=1,d.popupModel.groupUser=e[d.popupModel.selectedIndex])},d.previousGroup=function(){var e=d.popupModel.groupResults;e&&e.length>0&&d.popupModel.selectedIndex>0&&(d.popupModel.selectedIndex-=1,d.popupModel.selectedGroup=e[d.popupModel.selectedIndex])},d.confirmGroup=function(e){if(!e){var o=d.popupModel.groupResults;d.popupModel.selectedIndex>=0&&d.popupModel.selectedIndex<o.length&&(e=o[d.popupModel.selectedIndex])}if(e)if(u&&u(t.$parent,{group:e}),"true"===l)d.$hide();else{var o=d.popupModel.groupResults;o.splice(jQuery.inArray(e,o),1),d.popupModel.selectedIndex=0,d.popupModel.selectedGroup=o[d.popupModel.selectedIndex]}},d.$on("tooltip.hide",function(){d.popupModel.groupResults=[],d.popupModel.filter="",d.popupModel.added?d.popupModel.added=!1:s&&s(t.$parent)})},i}]),activitiModule.directive("tabControl",["$compile","$http","$templateCache",function(e,t,o){var n=function(n,r){if(!n.activeTemplate||n.activeTemplate!=n.activeTab.id){var i=$(r.children()[1]),a=angular.element(r.children()[1]).scope();if(n.activeTemplate&&a!=n&&a.$destroy(),n.activeTab&&n.activeTab.templateUrl){var c=t.get(n.activeTab.templateUrl,{cache:o});c.success(function(e){i.html(e)}).then(function(){n.activeTemplate=n.activeTab.id,i.replaceWith(e(i.html())(n))})}else i.empty()}},r={};return r.restrict="A",r.replace=!0,r.transclude=!0,r.template='<div><div class="clearfix"><ul class="tabs clearfix"><li ng-repeat="tab in tabs" ng-class="{\'active\': tab.id == activeTab.id}"><a ng-click="tabClicked(tab)">{{tab.title && (tab.title | translate) || (tab.name | translate)}}</a></li></ul></div><div></div></div>',r.scope={possibleTabs:"=tabControl",model:"=model",activeTabReference:"=activeTab"},r.controller=["$scope","$element",function(e,t){e.refreshTabs=function(){for(var t=[],o=0;e.possibleTabs.length>o;o++){var n=e.possibleTabs[o];n.hide||t.push(n)}e.tabs=t},e.$watch("possibleTabs",function(){e.refreshTabs()},!0),e.$watch("activeTabReference",function(t){if(!e.activeTab||e.activeTab.id!=t){var o=e.findTab(t);o&&e.tabClicked(o)}}),e.findTab=function(t){if(e.possibleTabs)for(var o=0;e.possibleTabs.length>o;o++)if(e.possibleTabs[o].id==t)return e.possibleTabs[o];
return void 0},e.tabClicked=function(o){o.hide&&(o.hide=!1,e.refreshTabs()),e.activeTab=o,e.activeTabReference=o?o.id:void 0,n(e,t)},e.refreshTabs(),e.tabs&&e.tabs.length>0&&(e.activeTabReference&&(e.activeTab=e.findTab(e.activeTabReference)),e.activeTab||(e.activeTab=e.tabs[0]),e.tabClicked(e.activeTab))}],r.link=n,r}]),activitiModule.directive("toggleDragover",["$document","$parse",function(e,t){var o=function(e,o,n){var r=n.toggleDragover,i=t(r),a=o[0];a.addEventListener("dragenter",function(){return e.$apply(function(){i(e,{over:!0})}),!1},!1),a.addEventListener("dragleave",function(){return e.$apply(function(){i(e,{over:!1})}),!1},!1)};return o}]),activitiModule.directive("editInPlace",function(){return{restrict:"E",scope:{value:"="},template:'<span ng-click="edit()" ng-bind="value"></span><span class="glyphicon glyphicon-pencil edit-in-place-icon"></span><input ng-model="value" class="inline-edit-value form-control" ng-blur="stopEdit()" custom-keys enter-pressed="stopEdit()">',link:function(e,t){angular.element(t.children()[1]);var o=angular.element(t.children()[2]);t.addClass("edit-in-place"),e.editing=!1,e.edit=function(){e.editing=!0,t.addClass("active"),o[0].focus()},e.stopEdit=function(){e.editing=!1,t.removeClass("active")}}}});var _internalCreateModal=function(e,t,o){return null!==o&&void 0!==o?(o.modal=t(e),o.$on("$routeChangeStart",function(){o.modal&&o.modal.hide()}),o.modal):t(e)};activitiModule.directive("numberInputCheck",function(){return{require:"ngModel",link:function(e,t,o,n){n.$parsers.push(function(e){var t;return e&&0==e.indexOf("-")?(t=e.substr(1).replace(/([^0-9])/g,""),t="-"+t):t=e.replace(/([^0-9])/g,""),t!=e&&(n.$setViewValue(t),n.$render()),t})}}}),activitiModule.directive("columnListScroll",["$rootScope","$timeout","$interval",function(e,t,o){return{restrict:"A",scope:{},link:function(e,n,r){n.addClass("column-container-scroll"),e.columnHeaderClass=r.columnListScroll||"column-header",e.updateHeight=function(){var t;e.header?t=e.header.outerHeight():n.parent().children("."+e.columnHeaderClass).each(function(){if(e.header=angular.element(this),e.header.addClass("column-header-fixed"),e.resizeSensor=new ResizeSensor(this,e.updateHeight),e.header.hasClass("ng-hide"))var n=o(function(){e.header.hasClass("ng-hide")||(o.cancel(n),e.updateHeight())},20,400,!1);else t=e.header.outerHeight()}),t&&(e.emptyChild||(e.emptyChild=n.children(".column-list-scroll-push")),e.emptyChild&&e.emptyChild.height(t))},t(e.updateHeight,1),e.$on("$destroy",function(){e.header&&e.resizeSensor.detach(e.header[0])})}}}]),activitiModule.directive("externalTarget",function(){return{restrict:"A",scope:{href:"@"},link:function(e,t,o){var n=t[0];e.$watch("href",function(){(n.protocol!=location.protocol||n.host!=location.host)&&(n.target=o.externalTarget)})}}}),activitiModule.config(["$httpProvider","$translateProvider",function(e){e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.get["Cache-Control"]="no-cache, no-store, must-revalidate",e.defaults.headers.get.Pragma="no-cache",e.defaults.headers.get.Expires="0"}]),function(){if(null!==ACTIVITI.CONFIG.isEventTrackingEnabled&&void 0!==ACTIVITI.CONFIG.isEventTrackingEnabled&&ACTIVITI.CONFIG.isEventTrackingEnabled===!0)if(null!==ACTIVITI.CONFIG.trackingCode&&void 0!==ACTIVITI.CONFIG.trackingCode){(function(e,t,o,n,r,i,a){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,i=t.createElement(o),a=t.getElementsByTagName(o)[0],i.async=1,i.src=n,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");var e;e=null!==ACTIVITI.CONFIG.isDevMode&&void 0!==ACTIVITI.CONFIG.isDevMode&&ACTIVITI.CONFIG.isDevMode===!0?{cookieDomain:"none"}:"auto",ga("create",ACTIVITI.CONFIG.trackingCode,e),ga("require","displayfeatures"),ga("send","pageview")}else console.log("Could not initialise event tracking: no tracking code found (set property in ACTIVITI.CONFIG.trackingCode)")}(),activitiModule.run(["$rootScope","$location","EventTrackingService",function(e,t,o){e.$on("$locationChangeSuccess",function(){var e=t.url();null!==e&&void 0!==e&&e.length>0&&o.trackPageView(t.url())})}]),activitiModule.config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate","EventTrackingService",function(e,t){return function(o,n){if(e(o,n),o){var r;o&&o.stack&&(r=angular.toJson(o.stack)),r&&t.trackException(r,!1)}}}])}]),activitiModule.service("EventTrackingService",[function(){var e=function(){return null!==ACTIVITI.CONFIG.isEventTrackingEnabled&&void 0!==ACTIVITI.CONFIG.isEventTrackingEnabled&&ACTIVITI.CONFIG.isEventTrackingEnabled===!0},t=function(e){null!==ACTIVITI.CONFIG.isDevMode&&void 0!==ACTIVITI.CONFIG.isDevMode&&ACTIVITI.CONFIG.isDevMode===!0&&console.log("[Event Tracker] "+e)};this.trackPageView=function(o){e()&&(t("pageview : "+o),ga("set","page",o),ga("send","pageview"))},this.trackEvent=function(o,n,r,i){e()&&(t("custom event : "+o+" - "+n),ga("send","event",o,n,r,i))},this.trackException=function(o,n){e()&&(t("exception : "+o+", is fatal: "+n),ga("send","event","exception","webapp",o.substring(0,400)))}}]),activitiModule.filter("trackEvent",["EventTrackingService",function(e){return function(t,o,n,r,i){return e.trackEvent(o,n,r,i),t}}]),activitiModule.service("ResourceService",["$http","$q","appResourceRoot",function(e,t,o){function n(e,t){var n=o+e;if(!t||!c[n])if(t&&(c[n]=!0),document.createStyleSheet)try{document.createStyleSheet(e)}catch(r){}else{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.media="all",i.href=n,document.getElementsByTagName("head")[0].appendChild(i)}}function r(e,t,n){var r=o+e;if(n&&c[r]&&t)t();else{n&&(c[r]=!0);var i=document.createElement("script");if(i.type="text/javascript",i.src=r,t){var a=!1;i.onload=i.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,t())}}var l=document.getElementsByTagName("head")[0];l.appendChild(i)}}function i(e,t,o){function n(){var i=e.shift();i?r.call(this,i,n.bind(this),o):t&&t()}n.call(this)}function a(t,o,r){e.get(t).success(function(e){var t;if(window.DOMParser){var a=new DOMParser;t=a.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e);for(var c,l=t.getElementsByTagName("link"),u=[],s=0,d=l.length;d>s;s++)c=l[s].getAttribute("href"),c&&n(c,r);for(l=t.getElementsByTagName("script"),s=0,d=l.length;d>s;s++)c=l[s].getAttribute("src"),c&&u.push(c);i(u,o,r)})}var c={};this.loadFromHtml=a,this.loadScript=r,this.loadStylesheet=n}]),activitiApp.service("RuntimeAppDefinitionService",["$http","$q","$location","EventTrackingService","AuthenticationSharedService","appName",function(e,t,o,n,r,i){var a=function(o){var n=t.defer();return e(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise};this.getApplications=function(){var e=r.hasTenantManagementCapability()||r.hasTenantAdminCapability(),t=[],n=o.absUrl(),c=n.indexOf("/#");c>=0&&(n=n.substring(0,c)),c=n.indexOf("?"),c>=0&&(n=n.substring(0,c)),"/"==n[n.length-1]&&(n=n.substring(0,n.length-1)),i.length>0&&n.substring(n.length-i.length)==i&&(n=n.substring(0,n.length-i.length-1));var l={editor:n+"/editor/",identity:n+"/idm/",workflow:n+"/workflow/",admin:"http://localhost:8080/activiti-admin",analytics:n+"/analytics/"},u=function(o){for(var r=JSON.parse(o),i=[],a=0;r.data.length>a;a++){var c=r.data[a];if(void 0!==c.defaultAppId&&null!==c.defaultAppId)if("kickstart"===c.defaultAppId)t.push({id:"kickstart",titleKey:"APP.KICKSTART.TITLE",descriptionKey:"APP.KICKSTART.DESCRIPTION",defaultAppId:c.defaultAppId,theme:"theme-1",icon:"icon icon-choice",fixedBaseUrl:l.editor+"/#/",fixedUrl:l.editor,pages:["processes","forms","apps","stencils","decision-tables"]});else if("tasks"===c.defaultAppId)t.push({id:"tasks",titleKey:"APP.TASKS.TITLE",descriptionKey:"APP.TASKS.DESCRIPTION",defaultAppId:c.defaultAppId,theme:"theme-2",icon:"icon icon-clock",fixedBaseUrl:l.workflow+"/#/",fixedUrl:l.workflow,pages:["tasks","processes","processes?mode=start"]});else if("identity"===c.defaultAppId){var u={id:"identity",titleKey:e?"APP.IDENTITY-MANAGEMENT.TITLE-TENANT-ADMIN":"APP.IDENTITY-MANAGEMENT.TITLE",descriptionKey:e?"APP.IDENTITY-MANAGEMENT.DESCRIPTION-TENANT-ADMIN":"APP.IDENTITY-MANAGEMENT.DESCRIPTION",defaultAppId:c.defaultAppId,theme:"theme-3",icon:"icon icon-user",fixedBaseUrl:l.identity+"/#/",fixedUrl:l.identity};e&&(u.pages=["tenant-mgmt","user-mgmt","system-group-mgmt","functional-group-mgmt","profile"]),t.push(u)}else"analytics"===c.defaultAppId&&t.push({id:"analytics",titleKey:"APP.ANALYTICS.TITLE",descriptionKey:"APP.ANALYTICS.DESCRIPTION",defaultAppId:c.defaultAppId,theme:"theme-6",icon:"glyphicon glyphicon-stats",fixedBaseUrl:l.analytics+"/#/",fixedUrl:l.analytics});else c.icon="glyphicon "+c.icon,c.fixedBaseUrl=n+"/workflow/#/apps/"+c.id+"/",c.fixedUrl=c.fixedBaseUrl+"tasks",c.pages=["tasks","processes","processes?mode=start"],c.deletable=!0,i.push(c)}return{defaultApps:t,customApps:i}};return a({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/runtime/app-definitions",transformResponse:u})},this.deleteAppDefinition=function(e){var t=a({method:"DELETE",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/runtime/app-definitions/"+e});return t.then(function(){n.trackEvent("landing","runtime-app-delete")}),t}}]),activitiApp.controller("AboutActivitiPopupCrtl",["$rootScope","$scope","$http","$translate","$interval","$dateFormatter",function(e,t,o,n,r,i){t.popup={loading:!0,activitiVersion:{},licenseHolder:""},o({method:"GET",url:ACTIVITI.CONFIG.contextRoot+"/app/rest/about-info"}).success(function(e){t.popup.licenseHolder=e.holder,t.popup.activitiVersion=e.versionInfo.edition+" v"+e.versionInfo.majorVersion+"."+e.versionInfo.minorVersion+"."+e.versionInfo.revisionVersion,t.popup.activitiVersionType=e.versionInfo.type,e.goodBeforeDate&&(t.popup.goodBeforeDate=i.formatDate(new Date(e.goodBeforeDate))),t.popup.loading=!1}).error(function(){t.popup.loading=!1}),t.cancel=function(){t.close()},t.close=function(){t.$hide()}}]);